var PlayerController=pc.createScript("playerController");const MAX_FROM_CENTER=14;PlayerController.prototype.initialize=function(){const t=sessionStorage.getItem("character")||"knight";this.entity.findByName("knight").enabled="knight"==t,this.entity.findByName("rogue").enabled="rogue"==t,this.entity.findByName("mage").enabled="mage"==t,"knight"==t&&this.entity.findByName("WeaponsController").script.weaponsController.init("heroWeaponOne"),"rogue"==t&&this.entity.findByName("WeaponsController").script.weaponsController.init("heroWeaponTwo"),"mage"==t&&this.entity.findByName("WeaponsController").script.weaponsController.init("heroWeaponThree"),this.moveSpeed=6,this.maxHealth=40,this.health=this.maxHealth,this.xp=0,this.level=1,this.totalXP=0,this.toNextLevel=2,this.velocity=new pc.Vec3(0,0,0),this.costume=this.entity.findByName(t),this.worldcenter=new pc.Vec3(0,0,0),this.healthbar=this.entity.findByName("HealthFill"),this.healthbar.setLocalScale(1,1,1),this.app.on("Time:end",this.handleTimeEnd,this),this.entity.once("destroy",(()=>{this.app.off("Time:end",this.handleTimeEnd,this)}),this),this.joystick=this.app.root.findByName("Left Fixed Touch Joystick").script.touchJoystick},PlayerController.prototype.handleTimeEnd=function(){this.entity.findByName("WeaponsController").enabled=!1},PlayerController.prototype.addXP=function(t){this.xp+=t,this.totalXP+=t,this.entity.sound.play("xp"),this.app.fire("Player:xp",{entity:this.entity,value:t,player:this}),this.xp>=this.toNextLevel&&(this.xp=0,this.level++,this.toNextLevel=2+Math.floor(this.level*this.level*.25),this.app.fire("Player:levelup",{entity:this.entity,player:this,value:this.level}))},PlayerController.prototype.addBonusXP=function(t){this.totalXP+=t,this.entity.sound.play("xp"),this.app.fire("Player:xp",{entity:this.entity,value:t,player:this})},PlayerController.prototype.getVelocity=function(){return new pc.Vec3(this.velocity.x,this.velocity.y,this.velocity.z)},PlayerController.prototype.addHealth=function(t){this.health=Math.min(100,this.health+t),this.app.fire("Player:add_health",{entity:this.entity,value:t}),this.updateHealthbar()},PlayerController.prototype.damage=function(t){this.health<=0||(this.health=Math.max(0,this.health-t),this.updateHealthbar(),this.app.fire("Player:damage",{entity:this.entity,value:t}),this.entity.sound.play("damage"),this.health<=0&&(this.costume.anim.setBoolean("dead",!0),this.app.fire("Player:dead",{entity:this.entity,value:t}),this.entity.sound.play("dead"),this.entity.findByName("WeaponsController").enabled=!1))},PlayerController.prototype.updateHealthbar=function(t){this.healthbar.setLocalScale(Math.max(0,Math.min(1,this.health/this.maxHealth)),1,1)},PlayerController.prototype.hasWeaponUnlocked=function(t){return this.entity.findByName(t)?.enabled},PlayerController.prototype.update=function(t){if(this.health<=0)return;let e=this.joystick.enabled?this.joystick.axisX:0,i=this.joystick.enabled?-1*this.joystick.axisY:0;(this.app.keyboard.isPressed(pc.KEY_LEFT)||this.app.keyboard.isPressed(pc.KEY_A))&&(e=-1),(this.app.keyboard.isPressed(pc.KEY_RIGHT)||this.app.keyboard.isPressed(pc.KEY_D))&&(e+=1),(this.app.keyboard.isPressed(pc.KEY_DOWN)||this.app.keyboard.isPressed(pc.KEY_S))&&(i+=1),(this.app.keyboard.isPressed(pc.KEY_UP)||this.app.keyboard.isPressed(pc.KEY_W))&&(i-=1);const s=e*this.moveSpeed*t,a=i*this.moveSpeed*t;this.velocity.x=s,this.velocity.z=a,this.velocity.normalize();const o=this.entity.getPosition();let n=new pc.Vec3(o.x+s,o.y,o.z+a);n.x=pc.math.clamp(n.x,-16,16),n.z=pc.math.clamp(n.z,-16,16),this.entity.setPosition(n);const h=this.costume.anim.getBoolean("running");0!=s||0!=a?(h||this.costume.anim.setBoolean("running",!0),this.costume.lookAt(this.entity.getPosition().add(new pc.Vec3(-s,0,-a)))):h&&this.costume.anim.setBoolean("running",!1)};var CameraController=pc.createScript("cameraController");CameraController.prototype.initialize=function(t,e,a){this.player=this.app.root.findByName("Hero"),this.playerController=this.player.script.playerController,this.app.on("Player:dead",this.onPlayerDead,this),this.entity.once("destroy",(()=>{this.app.off("Player:dead",this.onPlayerDead,this)}),this)},CameraController.prototype.onPlayerDead=function(){this.playerdead=!0,this.angle=0},CameraController.prototype.update=function(t){const e=this.player.getPosition();let a=e.y+20,r=e.z+25;e.z>0&&(a+=e.z/14*10,r-=e.z/14*10),this.playerdead&&(r=e.z+1,this.angle+=360*t),this.entity.setPosition(Math.max(-10,Math.min(10,e.x)),a,r),this.entity.lookAt(e.x,e.y,e.z)};var GameController=pc.createScript("gameController");GameController.prototype.initialize=function(){this.stats={playerXP:0,playerLevel:0,enemiesKilled:0,completed:!1};const t=[["Enemy:dead","onEnemyDead"],["Player:dead","onPlayerDead"],["Player:xp","onPlayerAddXP"],["Player:levelup","onPlayerLevelUp"],["Time:end","onTimeEnd"]];t.forEach((t=>this.app.on(t[0],this[t[1]],this))),this.entity.once("destroy",(()=>t.forEach((t=>this.app.off(t[0],this[t[1]],this)))),this)},GameController.prototype.onPlayerLevelUp=function({value:t,player:e}){this.stats.playerLevel=t,this.app.timeScale=0,this.app.root.findByName("GameHudController").script.gameHudController.showLevelUpScreen()},GameController.prototype.onPlayerAddXP=function({value:t}){this.stats.playerXP+=t},GameController.prototype.onEnemyDead=function(){this.stats.enemiesKilled++},GameController.prototype.onTimeEnd=function(){this.stats.completed=!0,this.onPlayerDead()},GameController.prototype.onPlayerDead=function(){this.stats.time=Math.floor(this.entity.findByName("TimeController").script.timeController.runTime),this.stats.score=this.stats.playerXP+this.stats.time,this.stats.completed&&(this.stats.score*=2);const t=localStorage.getItem("playerdata_2"),e=t?JSON.parse(t):{};(!e.bestScore||this.stats.score>e.bestScore)&&(e.bestScore=this.stats.score,this.stats.newBestScore=!0),(!e.bestTime||this.stats.time>e.bestTime)&&(e.bestTime=this.stats.time,this.stats.newBestTime=!0),e.totalRuns=e.totalRuns?e.totalRuns+1:1,e.totalTime=e.totalTime?e.totalTime+this.stats.time:this.stats.time,e.totalScore=e.totalScore?e.totalScore+this.stats.score:this.stats.score,localStorage.setItem("playerdata_2",JSON.stringify(e)),sessionStorage.setItem("playerrun",JSON.stringify(this.stats)),this.app.root.findByName("GameHudController").script.gameHudController.showGameEndScreen()};var Bullet=pc.createScript("bullet");Bullet.attributes.add("speed",{type:"number",default:10}),Bullet.prototype.initialize=function(){this.alive=0,this.damage=5,this.entity.collision.on("triggerenter",this.onTriggerEnter,this),this.on("enable",(()=>{const t=this.entity.findByName("DamageParticles");t.particlesystem.reset(),t.particlesystem.play()}),this)},Bullet.prototype.setTarget=function(t){this.target=t,this.target&&this.target.on("destroy",(()=>{this.target=null,this.entity.destroy()}),this)},Bullet.prototype.update=function(t){if(this.target){const t=this.target.getPosition();t.y=this.entity.position.y,this.entity.lookAt(t)}this.entity.translateLocal(0,0,-this.speed*t),this.alive+=t;const e=this.entity.getPosition();(Math.abs(e.x)>18||Math.abs(e.z)>18||this.alive>5)&&this.entity.destroy()},Bullet.prototype.onTriggerEnter=function(t){t&&t.tags.has("enemy")&&(t.script.enemyObject.damage(this.damage),t==this.target&&this.entity.destroy())};var DamageDisplayManager=pc.createScript("damageDisplayManager");DamageDisplayManager.prototype.initialize=function(){for(this._counterPool=[],this.player=this.app.root.findByName("Hero"),this.templateCounter=this.app.assets.get("164459124");this._counterPool.length<20;)this.createNewCounter();const e=[["Enemy:damage","onEnemyDamage"],["Player:damage","onPlayerDamage"],["Player:dead","onPlayerDead"],["Player:add_health","onPlayerAddHealth"],["Player:xp","onPlayerAddXP"],["Player:levelup","onPlayerLevelUp"],["Weapons:upgrade","onWeaponsUpgraded"]];e.forEach((e=>this.app.on(e[0],this[e[1]],this))),this.entity.once("destroy",(()=>e.forEach((e=>this.app.off(e[0],this[e[1]],this)))),this)},Object.assign(DamageDisplayManager.prototype,{onEnemyDamage:function({entity:e,value:t}){this.display(e.getPosition(),t,pc.Color.YELLOW)},onPlayerDamage:function({entity:e,value:t}){this.display(e.getPosition(),t,pc.Color.RED)},onPlayerDead:function({entity:e,value:t}){this.display(e.getPosition(),"DEAD",pc.Color.RED)},onPlayerAddHealth:function({entity:e,value:t}){this.display(e.getPosition(),t,pc.Color.GREEN)},onPlayerAddXP:function({entity:e,value:t}){this.display(e.getPosition(),t,pc.Color.CYAN)},onPlayerLevelUp:function({entity:e,value:t}){this.display(e.getPosition(),"LEVEL UP!",pc.Color.YELLOW)}}),DamageDisplayManager.prototype.getAvailableCounter=function(){for(let e=0;e<this._counterPool.length;e++)if(!this._counterPool[e].enabled)return this._counterPool[e];return this.createNewCounter()},DamageDisplayManager.prototype.createNewCounter=function(){var e=this.templateCounter.resource.instantiate();return e.enabled=!1,this.app.root.addChild(e),this._counterPool.push(e),e},DamageDisplayManager.prototype.display=function(e,t,o){const a=this.getAvailableCounter();a.setPosition(e.x,e.y+3.5,e.z),a.element.text=t,a.element.color=o,a.element.opacity=1,a.setLocalScale(1,1,1),a.enabled=!0},DamageDisplayManager.prototype.update=function(e){for(let t=0;t<this._counterPool.length;t++)if(this._counterPool[t].enabled){this._counterPool[t].element.opacity-=e;const o=this._counterPool[t].localScale;this._counterPool[t].setLocalScale(o.x-e,o.y-e,o.z-e);const a=this._counterPool[t].getPosition();a.y+=5*e,this._counterPool[t].setPosition(a.x,a.y,a.z),this._counterPool[t].element.opacity<0&&(this._counterPool[t].enabled=!1)}};var EnemyObject=pc.createScript("enemyObject");const ATTACK_RANGE=1.65,STOP_RANGE=1.5;EnemyObject.prototype.initialize=function(){switch(this.entity.name){case"Mob 2":this.speed=2.5,this.health=5;break;case"Mob 3":this.speed=3,this.health=7;break;case"Mob 4":this.speed=3.5,this.health=9;break;default:this.speed=2,this.health=3}this.player=this.app.root.findByName("Hero"),this.attckDamage=3,this.attackRange=1,this.attackDelay=1,this.attackDuration=.5,this.lastAttack=0,this.attackParticles=this.entity.findByName("ParticlesAttack").particlesystem,this.light=this.entity.findByName("Omni Light").light,this.app.on("Player:dead",this.onPlayerDead,this),this.app.on("Time:end",this.onPlayerDead,this),this.entity.once("destroy",(()=>{this.app.off("Player:dead",this.onPlayerDead,this),this.app.on("Time:end",this.onPlayerDead,this)}),this)},EnemyObject.prototype.onPlayerDead=function(){this.playerDead=!0},EnemyObject.prototype.update=function(t){if(this.playerDead){const i=this.entity.getPosition(),e=i.normalize(),a=this.speed*t*3,s=i.clone().mul(new pc.Vec3(30,1,30)).add(e);return this.entity.lookAt(s.x,0,s.z),this.entity.translateLocal(0,0,-a),void((new pc.Vec3).distance(this.entity.getPosition())>30&&this.entity.destroy())}if(this.attacking)return this.light.intensity=3,this.lastAttack+=t,void(this.lastAttack>this.attackDelay+this.attackDuration&&(this.lastAttack=0,this.attacking=!1));this.light.intensity=.25;const i=this.entity.getPosition(),e=this.player.getPosition(),a=i.distance(e);if(this.lastAttack+=t,this.entity.lookAt(this.player.position.x,0,this.player.position.z),a>1.5){let i=this.speed*t;a>10&&(i*=1.25),a>18?i*=2:i=Math.min(1,a/2)*this.speed*t,this.entity.translateLocal(0,0,-i)}a<=1.65&&this.lastAttack>=this.attackDelay&&(this.attacking=!0,this.lastAttack=this.attackDelay,this.player.script.playerController.damage(this.attckDamage),this.attackParticles.reset(),this.attackParticles.play())},EnemyObject.prototype.damage=function(t){this.health-=t,this.app.fire("Enemy:damage",{entity:this.entity,value:t}),this.entity.sound.play("damage"),this.health<=0&&(this.app.fire("Enemy:dead",{entity:this.entity,value:t}),this.entity.destroy())};var EnemyController=pc.createScript("enemyController");const ENEMIES=[{id:"164236620",afterWave:0},{id:"164676329",afterWave:5},{id:"164676330",afterWave:10},{id:"164676331",afterWave:15}],SPAWN_DISTANCE=18;EnemyController.prototype.initialize=function(){this.player=this.app.root.findByName("Hero"),this.enemySpawnDelay=3,this.enemySpawnLast=3,this.enemiesPerWave=1,this.enemyWavesSpawned=0,this.enemies=[],this.app.on("Player:dead",this.onPlayerDead,this),this.app.on("Time:end",this.onPlayerDead,this),this.app.on("Enemy:dead",this.onEnemyDead,this),this.entity.once("destroy",(()=>{this.app.off("Player:dead",this.onPlayerDead,this),this.app.off("Enemy:dead",this.onEnemyDead,this),this.app.off("Time:end",this.onPlayerDead,this)}),this)},Object.assign(EnemyController.prototype,{onEnemyDead:function(e){this.entity.sound.play("enemy_dead"),this.enemies=this.enemies.filter((t=>t!=e.entity))},onPlayerDead:function(e){this.playerdead=!0},update:function(e){if(!this.playerdead&&(this.enemySpawnLast+=e,this.enemySpawnLast>this.enemySpawnDelay)){for(let e=0;e<this.enemiesPerWave;e++)this.spawnEnemy();this.enemyWavesSpawned++,this.enemyWavesSpawned<10?this.enemiesPerWave+=.5:this.enemiesPerWave+=.1,this.enemySpawnLast=0,console.log(`${this.enemyWavesSpawned} : ${this.enemiesFlipped+", "+this.enemiesPerWave} - ${this.enemySpawnDelay}`)}},spawnEnemy:function(){console.log("\t - spawn enemy");const e=ENEMIES.filter((e=>e.afterWave<=this.enemyWavesSpawned));var t=this.app.assets.get(e[Math.floor(Math.random()*e.length)].id).resource.instantiate();Math.random();const a=this.player.getPosition(),n=Math.random()>.5,i=n?Math.random()>.5?-18:18:36*Math.random()-18,s=n?36*Math.random()-18:Math.random()>.5?-18:18;t.setPosition(i,a.y,s),this.app.root.addChild(t),this.enemies.push(t)}});var XpBubble=pc.createScript("xpBubble");XpBubble.attributes.add("xp",{type:"number",default:2}),XpBubble.prototype.initialize=function(){this.player=this.app.root.findByName("Hero")},XpBubble.prototype.update=function(t){const e=this.player.getPosition();this.attracted&&(this.entity.lookAt(e.x,0,e.z),this.entity.translateLocal(0,0,-20*t))},XpBubble.prototype.reset=function(){this.attracted=!1};"undefined"!=typeof document&&(
/*! FPSMeter 0.3.1 - 9th May 2013 | https://github.com/Darsain/fpsmeter */
function(t,e){function s(t,e){for(var n in e)try{t.style[n]=e[n]}catch(t){}return t}function H(t){return null==t?String(t):"object"==typeof t||"function"==typeof t?Object.prototype.toString.call(t).match(/\s([a-z]+)/i)[1].toLowerCase()||"object":typeof t}function R(t,e){if("array"!==H(e))return-1;if(e.indexOf)return e.indexOf(t);for(var n=0,o=e.length;n<o;n++)if(e[n]===t)return n;return-1}function I(){var t,e=arguments;for(t in e[1])if(e[1].hasOwnProperty(t))switch(H(e[1][t])){case"object":e[0][t]=I({},e[0][t],e[1][t]);break;case"array":e[0][t]=e[1][t].slice(0);break;default:e[0][t]=e[1][t]}return 2<e.length?I.apply(null,[e[0]].concat(Array.prototype.slice.call(e,2))):e[0]}function N(t){return 1===(t=Math.round(255*t).toString(16)).length?"0"+t:t}function S(t,e,n,o){t.addEventListener?t[o?"removeEventListener":"addEventListener"](e,n,!1):t.attachEvent&&t[o?"detachEvent":"attachEvent"]("on"+e,n)}function D(t,e){function g(t,e,n,o){return h[0|t][Math.round(Math.min((e-n)/(o-n)*M,M))]}function r(){F.legend.fps!==q&&(F.legend.fps=q,F.legend[c]=q?"FPS":"ms"),b=q?v.fps:v.duration,F.count[c]=999<b?"999+":b.toFixed(99<b?0:O.decimals)}function m(){for(l=n(),P<l-O.threshold&&(v.fps-=v.fps/Math.max(1,60*O.smoothing/O.interval),v.duration=1e3/v.fps),w=O.history;w--;)T[w]=0===w?v.fps:T[w-1],j[w]=0===w?v.duration:j[w-1];if(r(),O.heat){if(z.length)for(w=z.length;w--;)z[w].el.style[o[z[w].name].heatOn]=q?g(o[z[w].name].heatmap,v.fps,0,O.maxFps):g(o[z[w].name].heatmap,v.duration,O.threshold,0);if(F.graph&&o.column.heatOn)for(w=C.length;w--;)C[w].style[o.column.heatOn]=q?g(o.column.heatmap,T[w],0,O.maxFps):g(o.column.heatmap,j[w],O.threshold,0)}if(F.graph)for(y=0;y<O.history;y++)C[y].style.height=(q?T[y]?Math.round(x/O.maxFps*Math.min(T[y],O.maxFps)):0:j[y]?Math.round(x/O.threshold*Math.min(j[y],O.threshold)):0)+"px"}function k(){20>O.interval?(p=i(k),m()):(p=setTimeout(k,O.interval),f=i(m))}function G(t){(t=t||window.event).preventDefault?(t.preventDefault(),t.stopPropagation()):(t.returnValue=!1,t.cancelBubble=!0),v.toggle()}function U(){O.toggleOn&&S(F.container,O.toggleOn,G,1),t.removeChild(F.container)}function V(){if(F.container&&U(),o=D.theme[O.theme],!(h=o.compiledHeatmaps||[]).length&&o.heatmaps.length){for(y=0;y<o.heatmaps.length;y++)for(h[y]=[],w=0;w<=M;w++){var e,n=h[y],a=w;e=.33/M*w;var i=o.heatmaps[y].saturation,l=o.heatmaps[y].lightness,p=void 0,c=void 0,u=void 0,d=u=void 0,f=p=c=void 0;f=void 0;0===(u=.5>=l?l*(1+i):l+i-l*i)?e="#000":(c=(u-(d=2*l-u))/u,f=(e*=6)-(p=Math.floor(e)),f*=u*c,0===p||6===p?(p=u,c=d+f,u=d):1===p?(p=u-f,c=u,u=d):2===p?(p=d,c=u,u=d+f):3===p?(p=d,c=u-f):4===p?(p=d+f,c=d):(p=u,c=d,u-=f),e="#"+N(p)+N(c)+N(u)),n[a]=e}o.compiledHeatmaps=h}for(var b in F.container=s(document.createElement("div"),o.container),F.count=F.container.appendChild(s(document.createElement("div"),o.count)),F.legend=F.container.appendChild(s(document.createElement("div"),o.legend)),F.graph=O.graph?F.container.appendChild(s(document.createElement("div"),o.graph)):0,z.length=0,F)F[b]&&o[b].heatOn&&z.push({name:b,el:F[b]});if(C.length=0,F.graph)for(F.graph.style.width=O.history*o.column.width+(O.history-1)*o.column.spacing+"px",w=0;w<O.history;w++)C[w]=F.graph.appendChild(s(document.createElement("div"),o.column)),C[w].style.position="absolute",C[w].style.bottom=0,C[w].style.right=w*o.column.width+w*o.column.spacing+"px",C[w].style.width=o.column.width+"px",C[w].style.height="0px";s(F.container,O),r(),t.appendChild(F.container),F.graph&&(x=F.graph.clientHeight),O.toggleOn&&("click"===O.toggleOn&&(F.container.style.cursor="pointer"),S(F.container,O.toggleOn,G))}"object"===H(t)&&undefined===t.nodeType&&(e=t,t=document.body),t||(t=document.body);var o,h,l,p,f,x,b,w,y,v=this,O=I({},D.defaults,e||{}),F={},C=[],M=100,z=[],E=O.threshold,A=0,P=n()-E,T=[],j=[],q="fps"===O.show;v.options=O,v.fps=0,v.duration=0,v.isPaused=0,v.tickStart=function(){A=n()},v.tick=function(){l=n(),E+=(l-P-E)/O.smoothing,v.fps=1e3/E,v.duration=A<P?E:l-A,P=l},v.pause=function(){return p&&(v.isPaused=1,clearTimeout(p),a(p),a(f),p=f=0),v},v.resume=function(){return p||(v.isPaused=0,k()),v},v.set=function(t,e){return O[t]=e,q="fps"===O.show,-1!==R(t,u)&&V(),-1!==R(t,d)&&s(F.container,O),v},v.showDuration=function(){return v.set("show","ms"),v},v.showFps=function(){return v.set("show","fps"),v},v.toggle=function(){return v.set("show",q?"ms":"fps"),v},v.hide=function(){return v.pause(),F.container.style.display="none",v},v.show=function(){return v.resume(),F.container.style.display="block",v},v.destroy=function(){v.pause(),U(),v.tick=v.tickStart=function(){}},V(),k()}var n,o=t.performance;n=o&&(o.now||o.webkitNow)?o[o.now?"now":"webkitNow"].bind(o):function(){return+new Date};for(var a=t.cancelAnimationFrame||t.cancelRequestAnimationFrame,i=t.requestAnimationFrame,h=0,l=0,p=(o=["moz","webkit","o"]).length;l<p&&!a;++l)i=(a=t[o[l]+"CancelAnimationFrame"]||t[o[l]+"CancelRequestAnimationFrame"])&&t[o[l]+"RequestAnimationFrame"];a||(i=function(e){var o=n(),a=Math.max(0,16-(o-h));return h=o+a,t.setTimeout((function(){e(o+a)}),a)},a=function(t){clearTimeout(t)});var c="string"===H(document.createElement("div").textContent)?"textContent":"innerText";D.extend=I,window.FPSMeter=D,D.defaults={interval:100,smoothing:10,show:"fps",toggleOn:"click",decimals:1,maxFps:60,threshold:100,position:"absolute",zIndex:10,left:"5px",top:"5px",right:"auto",bottom:"auto",margin:"0 0 0 0",theme:"dark",heat:0,graph:0,history:20};var u=["toggleOn","theme","heat","graph","history"],d="position zIndex left top right bottom margin".split(" ")}(window),function(t,e){e.theme={};var n=e.theme.base={heatmaps:[],container:{heatOn:null,heatmap:null,padding:"5px",minWidth:"95px",height:"30px",lineHeight:"30px",textAlign:"right",textShadow:"none"},count:{heatOn:null,heatmap:null,position:"absolute",top:0,right:0,padding:"5px 10px",height:"30px",fontSize:"24px",fontFamily:"Consolas, Andale Mono, monospace",zIndex:2},legend:{heatOn:null,heatmap:null,position:"absolute",top:0,left:0,padding:"5px 10px",height:"30px",fontSize:"12px",lineHeight:"32px",fontFamily:"sans-serif",textAlign:"left",zIndex:2},graph:{heatOn:null,heatmap:null,position:"relative",boxSizing:"padding-box",MozBoxSizing:"padding-box",height:"100%",zIndex:1},column:{width:4,spacing:1,heatOn:null,heatmap:null}};e.theme.dark=e.extend({},n,{heatmaps:[{saturation:.8,lightness:.8}],container:{background:"#222",color:"#fff",border:"1px solid #1a1a1a",textShadow:"1px 1px 0 #222"},count:{heatOn:"color"},column:{background:"#3f3f3f"}}),e.theme.light=e.extend({},n,{heatmaps:[{saturation:.5,lightness:.5}],container:{color:"#666",background:"#fff",textShadow:"1px 1px 0 rgba(255,255,255,.5), -1px -1px 0 rgba(255,255,255,.5)",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},count:{heatOn:"color"},column:{background:"#eaeaea"}}),e.theme.colorful=e.extend({},n,{heatmaps:[{saturation:.5,lightness:.6}],container:{heatOn:"backgroundColor",background:"#888",color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.2)",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},column:{background:"#777",backgroundColor:"rgba(0,0,0,.2)"}}),e.theme.transparent=e.extend({},n,{heatmaps:[{saturation:.8,lightness:.5}],container:{padding:0,color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.5)"},count:{padding:"0 5px",height:"40px",lineHeight:"40px"},legend:{padding:"0 5px",height:"40px",lineHeight:"42px"},graph:{height:"40px"},column:{width:5,background:"#999",heatOn:"backgroundColor",opacity:.5}})}(window,FPSMeter));var Fps=pc.createScript("fps");Fps.prototype.initialize=function(){this.fps=new FPSMeter({heat:!0,graph:!0})},Fps.prototype.update=function(t){this.fps.tick()};var HeroWeaponTwo=pc.createScript("heroWeaponTwo");HeroWeaponTwo.prototype.initialize=function(){this.angle=0,this.damage=2,this.speed=1,this.id="heroWeaponTwo",this.ball=this.entity.findByName("ball"),this.balls=[this.ball],this.balls.forEach((t=>{t.collision.on("triggerenter",this.handleTriggerEnter,this)})),this.balls[0].enabled=!0,this.positionBalls(this.balls)},Object.assign(HeroWeaponTwo.prototype,{upgrade:function({quantity:t,damage:e,speed:i}){if(t)for(;t--;){const t=this.ball.clone();t.collision.on("triggerenter",this.handleTriggerEnter,this),this.entity.addChild(t),this.balls.push(t),this.positionBalls(this.balls)}e&&(this.damage+=e),i&&(this.speed+=i)}}),HeroWeaponTwo.prototype.positionBalls=function(t){const e=360/t.length*pc.math.DEG_TO_RAD;t.forEach(((t,i)=>{const o=i*e,s=4.5*Math.cos(o),a=4.5*Math.sin(o);t.setLocalPosition(s,.5,a)}))},HeroWeaponTwo.prototype.handleTriggerEnter=function(t){t&&t.tags.has("enemy")&&t.script.enemyObject.damage(this.damage)},HeroWeaponTwo.prototype.update=function(t){this.angle+=t*this.speed*180,this.entity.setEulerAngles(0,this.angle,0)};var XpBubbleManager=pc.createScript("xpBubbleManager");XpBubbleManager.prototype.initialize=function(){for(this.xpPool=[],this.xpTemplate=this.app.assets.get("164700344");this.xpPool<25;)this.createXPBubble();this.app.on("Enemy:dead",this._onEnemyDead,this),this.app.on("Player:dead",this.onPlayerDead,this),this.entity.once("destroy",(()=>{this.app.off("Enemy:dead",this._onEnemyDead,this),this.app.off("Player:dead",this.onPlayerDead,this)}),this)},XpBubble.prototype.onPlayerDead=function(){this.xpPool.forEach((e=>e.enabled=!1))},XpBubbleManager.prototype._onEnemyDead=function({entity:e}){this.spawnXPBubble(e.getPosition())},XpBubbleManager.prototype.spawnXPBubble=function(e){let t=this.xpPool.find((e=>!e.enabled))||this.createXPBubble();t.setPosition(e.x,e.y,e.z),t.script.xpBubble.reset(),t.enabled=!0},XpBubbleManager.prototype.createXPBubble=function(){var e=this.xpTemplate.resource.instantiate();return e.enabled=!1,this.xpPool.push(e),this.app.root.addChild(e),e};var HeroWeaponOne=pc.createScript("heroWeaponOne");HeroWeaponOne.prototype.initialize=function(){this.id="heroWeaponOne",this.fireLast=0,this.bullets=[],this.bulletTemplate=this.app.assets.get("164453980").resource.instantiate(),this.bulletTemplate.enabled=!1,this.player=this.app.root.findByName("Hero").script.playerController,this.enemyController=this.app.root.findByName("EnemyController").script.enemyController,this.fireQuantity=1,this.fireDelay=1,this.fireDamage=1},Object.assign(HeroWeaponOne.prototype,{upgrade:function({quantity:e,damage:t,delay:i}){e&&(this.fireQuantity+=e),t&&(this.fireDamage+=t),i&&(this.fireDelay-=i)},update:function(e){this.fireLast+=e,this.fireLast>=this.fireDelay&&this.fire()},fire:function(){this.fireLast=0;const e=this.entity.getPosition();if(!this.enemyController)return;const t=[...this.enemyController.enemies];if(t?.length){t.sort(((t,i)=>e.distance(t.getPosition())-e.distance(i.getPosition()))),this.entity.sound.play("sfx");for(let s=0;s<this.fireQuantity;s++){var i=this.getAvailableBullet();if(i.enabled=!0,i.setPosition(e.x,e.y+1,e.z),i.setEulerAngles(0,s,0),i.script.bullet.setTarget(t.shift()),i.script.bullet.damage=this.fireDamage,!t.length)break}}},getAvailableBullet:function(){var e=this.bulletTemplate.clone();return this.app.root.addChild(e),this.bullets.push(e),e}});var Billboard=pc.createScript("billboard");Billboard.prototype.initialize=function(){this.camera=this.app.root.findByName("Camera")},Billboard.prototype.update=function(t){this.entity.setRotation(this.camera.getRotation())};var UiScreenUpgrade=pc.createScript("uiScreenUpgrade");UiScreenUpgrade.prototype.initialize=function(e,t,n){this.player=this.app.root.findByName("Hero").script.playerController,this.weaponTeamplte=this.entity.findByName("WeaponTemplate"),this.weaponTeamplte.enabled=!1,this.weaponContainer=this.entity.findByName("WeaponContainer"),this.weaponsController=this.app.root.findByName("WeaponsController").script.weaponsController,this.weaponPanels=[];for(let e=0;e<4;e++){const t=this.weaponTeamplte.clone();t.setLocalPosition(0,45*-e,0),t.config={title:t.findByName("Title").element,description:t.findByName("Description").element,button:t.findByName("Button").button},t.config.button.on("click",this.onPanelButton,this),this.weaponContainer.addChild(t),this.weaponPanels.push(t)}this.on("enable",(()=>this.displayOptions())),this.displayOptions()},Object.assign(UiScreenUpgrade.prototype,{onPanelButton(e,t,n){this.weaponsController.applyWeaponUpgrade(e.element.entity.button.upgrade),this.app.timeScale=1,this.entity.enabled=!1,this.app.root.findByName("GameHudController").script.gameHudController.showScreen("hud")},displayOptions(){const e=this.weaponsController.chooseUpgradeOptions();this.weaponPanels.forEach(((t,n)=>{const o=e[n];o?(t.config.title.text=o.weapon.name,t.config.description.text=o.upgrade.description,t.config.upgrade=o,t.config.button.upgrade=o,t.enabled=!0):t.enabled=!1}))}});const SURVIVOR={WEAPONS:[{id:"heroWeaponOne",name:"Missiles",description:["Launch one missile every 1 second","Launch two missiles every 1 second","Launch three missiles every 1 second","Launch four missiles every 1 second","Launch five missiles every 1 second","Launch six missiles every 1 second"]},{id:"weapon_two",name:"Spinning Orbs",description:["One spinning orbs that orbits the hero","Two spinning orbs that orbits the hero","Three spinning orbs that orbits the hero","Four spinning orbs that orbits the hero","Five spinning orbs that orbits the hero","Six spinning orbs that orbits the hero"]},{id:"weapon_three",name:"Lightning",description:["Triggers one enemy targeting lighting bolt every 2 seconds","Triggers two enemy targeting lighting bolts every 2 seconds","Triggers three enemy targeting lighting bolts every 2 seconds","Triggers four enemy targeting lighting bolts every 2 seconds","Triggers five enemy targeting lighting bolts every 2 seconds","Triggers six enemy targeting lighting bolts every 2 seconds"]},{id:"magnet",name:"Magnet",description:["Increase radius hero collects point orbs to 1","Increase radius hero collects point orbs to 2","Increase radius hero collects point orbs to 3","Increase radius hero collects point orbs to 4","Increase radius hero collects point orbs to 5","Increase radius hero collects point orbs to 6","Increase radius hero collects point orbs to 7"]},{id:"regen",name:"Regen",description:["Slow increases hero health over time"]},{id:"xp_collector",name:"XP",description:["Increase the amount of xp earnt by 1"]}]};var Constants=pc.createScript("constants");Constants.prototype.initialize=function(){};var WeaponsController=pc.createScript("weaponsController");WeaponsController.Weapons={heroWeaponOne:{name:"Missiles",disabledOnStart:!0,description:"Fires a missile at nearest target every 1 second",upgrades:[{id:1,description:"Fires one more missile",maxUpgrades:1,quantity:1,initial:!0},{id:1,description:"Fires one more missile",maxUpgrades:5,quantity:1},{id:2,description:"Increases missile damage",maxUpgrades:5,damage:1},{id:3,description:"Reduces cooldown by 0.1 seconds",maxUpgrades:5,delay:.1}]},heroWeaponTwo:{name:"Orbiting Orbs",disabledOnStart:!0,description:"Adds an orb that orbits the player damaging anything it touches.",upgrades:[{id:1,description:"Adds one more orb",maxUpgrades:1,quantity:1,initial:!0},{id:1,description:"Adds one more orb",maxUpgrades:5,quantity:1},{id:2,description:"Increases orb damage",maxUpgrades:5,damage:1},{id:3,description:"Increases orbit speed by 0.1",maxUpgrades:5,speed:.1}]},heroWeaponThree:{name:"Lightning Bolts",disabledOnStart:!0,description:"Targets a random enemy with a bolt of lightening every 3 seconds.",upgrades:[{id:1,description:"Adds one more lightning bolt",maxUpgrades:1,quantity:1,initial:!0},{id:1,description:"Adds one more lightning bolt",maxUpgrades:5,quantity:1},{id:2,description:"Increases lightning bolt area of effect",maxUpgrades:5,damage:1},{id:3,description:"Reduces cooldown by 0.2 seconds",maxUpgrades:5,delay:.2}]},playerModifiers:{name:"XP",description:"Attracts xp gems to the player",upgrades:[{id:1,description:"Increases xp collected by 1",maxUpgrades:3,xp:!0}]},heroRegen:{name:"Regen Bubble",disabledOnStart:!0,description:"Adds one health point every two seconds",upgrades:[{id:1,description:"Adds one more health point per tick",maxUpgrades:1,quantity:1}]}},WeaponsController.prototype.initialize=function(){},WeaponsController.prototype.init=function(e){this.app.on("Weapons:unlock",this.handleWeaponUnlocked,this),this.entity.once("destroy",(()=>{this.app.off("Weapons:unlock",this.handleWeaponUnlocked,this)}),this),this.player=this.app.root.findByName("Hero").script.playerController,this.weaponUpgrades=Object.keys(WeaponsController.Weapons).reduce(((e,n)=>(e[n]||(e[n]=[]),WeaponsController.Weapons[n].upgrades.forEach((a=>{for(let i=0;i<a.maxUpgrades;i++)e[n].push({weapon:{...WeaponsController.Weapons[n],id:n},upgrade:{...a,id:a.id+"-"+i}})})),e[n].sort(((e,n)=>e.upgrade.initial&&n.upgrade.initial?0:e.upgrade.initial&&!n.upgrade.initial?-1:!e.upgrade.initial&&n.upgrade.initial?1:Math.random()-.5)),WeaponsController.Weapons[n].disabledOnStart&&(this.entity.findByName(n).enabled=!1),e)),{}),this.enableWeapon(e)},Object.assign(WeaponsController.prototype,{enableWeapon:function(e){this.entity.findByName(e).enabled=!0},applyWeaponUpgrade:function(e){if("bonus_xp"!=e.id){if(e.upgrade.unlock){const n=this.entity.findByName(e.weapon.id);n&&(n.enabled=!0)}else if(this.weaponUpgrades[e.weapon.id]){this.weaponUpgrades[e.weapon.id]=this.weaponUpgrades[e.weapon.id].filter((n=>n.upgrade.id!==e.upgrade.id));const n=this.entity.findByName(e.weapon.id);if(!n)return;n.script[e.weapon.id].upgrade(e.upgrade)}}else this.player.addBonusXP(e.upgrade.xp)},hasUnlockedWeapon:function(e){return this.entity.findByName(e)?.enabled},chooseUpgradeOptions:function(){const e=[],n=[];Object.keys(this.weaponUpgrades).forEach((a=>{if(this.hasUnlockedWeapon(a)){const n=this.weaponUpgrades[a][0];n&&e.push(n)}else n.push({id:a,weapon:{...WeaponsController.Weapons[a],id:a},upgrade:{unlock:a,description:WeaponsController.Weapons[a].description}})})),e.sort((()=>-.5*Math.random())),n.sort((()=>-.5*Math.random()));const a=[];if(n.length){const i=e.length<2?2-e.length:2;for(let e=0;e<i&&n.length;e++)a.push(n.shift())}for(;a.length<4&&e.length;)a.push(e.shift());return 0==a.length?[{id:"bonus_xp",weapon:{name:"Bonus XP",id:"bonus_xp"},upgrade:{description:"Add 100 bonus xp points",xp:100}}]:(a.sort((()=>Math.random()-.5)),a)}}),WeaponsController.prototype.handleWeaponUnlocked=function(e){const n=this.entity.findByName(e.weapon);n&&(n.enabled=!0,this.app.fire("Weapons:unlocked",{weapon:e.weapon}))};var HeroWeaponThree=pc.createScript("heroWeaponThree");HeroWeaponThree.prototype.initialize=function(){this.enemyController=this.app.root.findByName("EnemyController").script.enemyController,this.id="weapon_three",this.bolt=this.entity.findByName("bolt"),this.bolt.burst=this.bolt.findByName("burst"),this.bolts=[this.bolt],this.fireDamage=5,this.fireDelay=3,this.boltLast=0,this.areaOfEffect=1},Object.assign(HeroWeaponThree.prototype,{upgrade:function({quantity:t,damage:e,delay:i}){if(t)for(;t--;){const t=this.bolt.clone();t.burst=t.findByName("burst"),this.entity.addChild(t),this.bolts.push(t)}e&&(this.areaOfEffect+=e),i&&(this.fireDelay-=i)}}),HeroWeaponThree.prototype.update=function(t){if(this.boltLast+=t,this.boltLast>this.fireDelay){this.boltLast=0;const t=[...this.enemyController.enemies].filter((t=>pc.Vec2.ZERO.distance(t.getPosition())<15));if(!t.length)return;const e=[];for(;e.length<this.bolts.length&&0!=t.length;){const i=Math.floor(Math.random()*t.length);e.push(t[i]),t.splice(i,1)}this.entity.sound.play("sfx"),e.forEach(((e,i)=>{const s=this.bolts[i],o=e.getPosition();s.setPosition(o.x,10,o.z),e.script.enemyObject.damage(this.fireDamage),s.particlesystem.reset(),s.particlesystem.play(),s.burst.particlesystem.reset(),s.burst.particlesystem.play();for(let e=0;e<t.length;e++){o.distance(t[e].getPosition())<this.areaOfEffect&&(t[e].script.enemyObject.damage(this.fireDamage),t.splice(e,1),e--)}}))}};var Magnet=pc.createScript("magnet");Magnet.prototype.initialize=function(){this.radius=5,this.id="magnet",this.entity.collision.on("triggerenter",(t=>{t.script.xpBubble&&(t.script.xpBubble.attracted=!0)})),this.entity.collision.radius=this.radius},Magnet.prototype.upgrade=function(t){this.radius+=1,this.entity.collision.radius=this.radius};var HeroRegen=pc.createScript("heroRegen");HeroRegen.prototype.initialize=function(){this.player=this.app.root.findByName("Hero").script.playerController,this.id="regen",this.regenDelay=2,this.regenNext=0,this.regenValue=1,this.level=1},HeroRegen.prototype.upgrade=function(e){this.level++},HeroRegen.prototype.update=function(e){this.regenNext+=e,this.regenNext>=this.regenDelay&&(this.player.addHealth(this.level),this.regenNext=0)};var UiXpbar=pc.createScript("uiXpbar");UiXpbar.prototype.initialize=function(){this.player=this.app.root.findByName("Hero").script.playerController,this.labelLevel=this.entity.findByName("txt_level"),this.labelTime=this.entity.findByName("txt_time"),this.timeController=this.app.root.findByName("TimeController").script.timeController,this.xpBarFill=this.entity.findByName("xpbarfill"),this.app.on("Player:xp",this.onPlayerXP,this),this.app.on("Player:levelup",this.onPlayerLevelUp,this),this.entity.once("destroy",(()=>{this.app.off("Player:levelup",this.onPlayerLevelUp,this),this.app.off("Player:xp",this.onPlayerXP,this)}),this),this.onPlayerXP(),this.onPlayerLevelUp(),this.on("enabled",this.onPlayerXP,this)},UiXpbar.prototype.update=function(){this.labelTime.element.text=this.convertToTime(this.timeController.runTime)},UiXpbar.prototype.onPlayerXP=function(){const t=this.player.toNextLevel,e=this.player.xp/t;this.xpBarFill.setLocalScale(Math.max(0,Math.min(1,e)),1,1)},UiXpbar.prototype.onPlayerLevelUp=function(){this.labelLevel.element.text="lvl : "+this.player.level;const t=this.player.toNextLevel,e=this.player.xp/t;this.xpBarFill.setLocalScale(Math.max(0,Math.min(1,e)),1,1)},UiXpbar.prototype.convertToTime=function(t){t=Math.floor(t);const e=Math.floor(t/60),i=t%60;return`${String(e).padStart(2,"0")}:${String(i).padStart(2,"0")}`};var GameHudController=pc.createScript("gameHudController");GameHudController.prototype.initialize=function(){this.uiLevelUp=this.entity.findByName("UiLevelUp"),this.uiGameOver=this.entity.findByName("UIGameEnd"),this.uiGameHud=this.entity.findByName("UiHud"),this.uiOnboard=this.entity.findByName("UIOnboarding"),this.uiLevelUp.enabled=!1,localStorage.getItem("onboarded_02")?this.showScreen("game"):(this.app.timeScale=0,localStorage.setItem("onboarded","true"),this.showScreen("onboarding"))},Object.assign(GameHudController.prototype,{showLevelUpScreen:function(){this.showScreen("levelup")},showGameEndScreen:function(){this.showScreen("gameover")},showScreen:function(e){this.uiOnboard.enabled="onboarding"==e,this.uiGameOver.enabled="gameover"==e,this.uiLevelUp.enabled="levelup"==e,this.uiGameHud.enabled="onboarding"!=e&&"gameover"!=e&&"levelup"!=e}});var HeroXpcollector=pc.createScript("heroXpcollector");HeroXpcollector.prototype.initialize=function(){this.id="xp_collector",this.level=1,this.player=this.app.root.findByName("Hero").script.playerController,this.player.entity.collision.on("collisionstart",this.onPlayerCollision,this)},Object.assign(HeroXpcollector.prototype,{upgrade:function(o){this.level++},onPlayerCollision:function(o){"XP"==o.other.name&&(o.other.enabled=!1,this.player.addXP(this.level))}});var ParticleController=pc.createScript("particleController");ParticleController.prototype.initialize=function(){for(this.particlesDeath=[],this.particlesDeathTemplate=this.entity.findByName("ParticlesEnemyKilled");this.particlesDeath.length<20;){const t=this.particlesDeathTemplate.clone();t.enabled=!0,this.particlesDeath.push(t)}this.app.on("Enemy:dead",this.onEnemyDead,this),this.entity.once("destroy",(()=>{this.app.off("Enemy:dead",this.onEnemyDead,this)}),this)},Object.assign(ParticleController.prototype,{onEnemyDead:function(t){const e=pc.now();let i=this.particlesDeath.find((t=>!t._lastLauched||e-t._lastLauched>1200));i||(i=this.particlesDeathTemplate.clone(),this.particlesDeath.push(i)),i&&(i.setPosition(t.entity.getPosition().add(new pc.Vec3(0,1,0))),i.particlesystem.reset(),i.particlesystem.play(),i._lastLauched=e)}}),ParticleController.prototype.update=function(t){};var UiBtnStartNewGame=pc.createScript("uiBtnStartNewGame");UiBtnStartNewGame.prototype.initialize=function(){this.entity.button.on("click",(function(t){this.app.root.findByName("Camera").enabbled=!1,this.app.scenes.changeScene("CharacterSelect")}),this)},UiBtnStartNewGame.prototype.update=function(t){};var PlayerModifiers=pc.createScript("playerModifiers");PlayerModifiers.prototype.initialize=function(){this.xp=this.entity.findByName("xp_collector").script.heroXpcollector,this.magnet=this.entity.findByName("magnet").script.magnet},Object.assign(PlayerModifiers.prototype,{upgrade:function({magnet:e,xp:t}){t&&this.xp.upgrade(),e&&this.magnet.upgrade()}});var TimeController=pc.createScript("timeController");TimeController.prototype.initialize=function(){this.runTime=0,this.maxTime=300},TimeController.prototype.update=function(i){this.runTime+=i,this.runTime>=this.maxTime&&this.app.fire("Time:end")};var UiScreenGameOver=pc.createScript("uiScreenGameOver");UiScreenGameOver.prototype.initialize=function(){this.entity.on("enabled",this.popuplate,this),this.popuplate()},UiScreenGameOver.prototype.popuplate=function(e){let t=sessionStorage.getItem("playerrun");t&&(t=JSON.parse(t),t.completed?(this.entity.findByName("Title").element.text="COMPLETE!",this.entity.findByName("bonus").enabled=!0):(this.entity.findByName("bonus").enabled=!1,this.entity.findByName("Title").element.text="GAME OVER"),this.entity.findByName("time").findByName("value").element.text=this.convertToTime(Math.round(t.time)),this.entity.findByName("xp").findByName("value").element.text=t.playerXP,this.entity.findByName("score").findByName("value").element.text=t.score,this.entity.findByName("new_time").enabled=t.newBestTime,this.entity.findByName("new_score").enabled=t.newBestScore,this.entity.findByName("BtnContinue").button.on("click",(function(){this.app.scenes.changeScene("MainMenu")}),this))},UiScreenGameOver.prototype.convertToTime=function(e){const t=Math.floor(e/60),n=e%60;return`${String(t).padStart(2,"0")}:${String(n).padStart(2,"0")}`};var UiMainMenu=pc.createScript("uiMainMenu");UiMainMenu.prototype.initialize=function(){this.app.root.addComponent("sound"),this.app.root.sound.addSlot("music",{asset:this.app.assets.get("164862739"),loop:!0,autoPlay:!0,volume:.2});let t=localStorage.getItem("playerdata_2");t&&(t=JSON.parse(t),this.entity.findByName("total_runs").findByName("value").element.text=t.totalRuns,this.entity.findByName("average_time").findByName("value").element.text=this.convertToTime(Math.round(t.totalTime/t.totalRuns)),this.entity.findByName("average_score").findByName("value").element.text=Math.round(t.totalScore/t.totalRuns),this.entity.findByName("best_time").findByName("value").element.text=this.convertToTime(t.bestTime||0),this.entity.findByName("best_score").findByName("value").element.text=t.bestScore||0)},UiMainMenu.prototype.convertToTime=function(t){const e=Math.floor(t/60),a=t%60;return`${String(e).padStart(2,"0")}:${String(a).padStart(2,"0")}`};var UiCharacterSelect=pc.createScript("uiCharacterSelect");const HEROS=[{name:"Rogue",desc:"Starts with orbiting orbs"},{name:"Knight",desc:"Starts with missiles"},{name:"Mage",desc:"Starts with lightning bolts"}];UiCharacterSelect.prototype.initialize=function(){this.charIndex=1,this.app.root.findByName("btn_next").button.on("click",(()=>{this.charIndex++,this.charIndex>2&&(this.charIndex=0),this.setCharacter(this.charIndex)})),this.app.root.findByName("btn_prev").button.on("click",(()=>{this.charIndex--,this.charIndex<0&&(this.charIndex=2),this.setCharacter(this.charIndex)})),this.app.root.findByName("btn_play").button.on("click",(()=>{sessionStorage.setItem("character",HEROS[this.charIndex].name.toLowerCase()),this.app.scenes.changeScene("GameScene")})),this.camera=this.app.root.findByName("Camera"),this.light=this.app.root.findByName("Spot Light"),this.setCharacter(this.charIndex)},UiCharacterSelect.prototype.setCharacter=function(t){this.charIndex=t,this.app.root.findByName("hero_name").element.text=HEROS[t].name,this.app.root.findByName("hero_start").element.text=HEROS[t].desc},UiCharacterSelect.prototype.update=function(t){const e=2*this.charIndex-2,a=this.camera.getPosition(),i=this.light.getPosition();if(a.x!=e){const h=100*t,s=Math.abs(a.x-e),n=Math.min(h,s),r=e>a.x?1:-1;this.camera.setPosition(a.x+n*r,a.y,a.z),this.light.setPosition(a.x+n*r,i.y,i.z)}};var Uionboarding=pc.createScript("uionboarding");Uionboarding.prototype.initialize=function(){this.entity.findByName("BtnContinue").button.on("click",(function(){this.app.timeScale=1,this.entity.enabled=!1,this.app.root.findByName("GameHudController").script.gameHudController.showScreen("hud")}),this)},Uionboarding.prototype.update=function(i){};var TouchJoystick=pc.createScript("touchJoystick");TouchJoystick.attributes.add("identifier",{type:"string",default:"joystick0",title:"Idenitifier",description:"A unique name for the joystick to refer to it by in the API. Joysticks are also buttons so this will also be the name of button in the API. It will give a warning in browser tools if the name is not unique."}),TouchJoystick.attributes.add("type",{type:"string",default:"fixed",enum:[{"Fixed in place":"fixed"},{"Move to first touch and fixed":"relative"},{"Move to first touch and drags":"drag"}],title:"Type",description:"Set type of behavior for the joystick."}),TouchJoystick.attributes.add("baseEntity",{type:"entity",title:"Base Entity",description:"Image Element Entity that shows the base of the joystick."}),TouchJoystick.attributes.add("nubEntity",{type:"entity",title:"Nub Entity",description:"Image Element Entity that shows the nub (top) of the joystick."}),TouchJoystick.attributes.add("axisDeadZone",{type:"number",default:10,title:"Axis Dead Zone",description:"The number of UI units from the position of the Base Entity where input is not registered."}),TouchJoystick.attributes.add("axisRange",{type:"number",default:50,title:"Axis Range",description:"The number of UI units from the position of the Base Entity that the Nub Entity can move to and is the maximum range"}),TouchJoystick.attributes.add("hideOnRelease",{type:"boolean",default:!1,title:"Hide on Release",description:"Will only show the joystick when the user is using it and will hide it on touch end. This is commonly used if you don't want the joystick to block what's being shown on screen."}),TouchJoystick.attributes.add("positionOnRelease",{type:"string",default:"stay",enum:[{Stay:"stay"},{Original:"original"},{"Last start":"lastStart"}],title:"Position on Release",description:"Where to move the joystick on release and can help keep the screen tidy so that there are clear areas to show the game and arrange controls."}),TouchJoystick.attributes.add("vibrationPress",{type:"number",default:0,title:"Vibration duration (ms)",description:"If the device supports vibration with 'Navigator.vibrate', it will vibrate for the duration set here on touch down.Set to 0 to disable."}),TouchJoystick.prototype.initialize=function(){window.touchJoypad&&void 0!==window.touchJoypad.sticks[this.identifier]?console.warn("Touch joystick identifier already used, please use another for Entity: "+this.entity.name):(this._originalLocalPosition=this.baseEntity.getLocalPosition().clone(),this._lastPointerDownPosition=new pc.Vec3,this._setAxisValues(0,0),this._inputDown=!1,this._pointerId=-1,this._canVibrate=!!navigator.vibrate,this._setButtonState(!1),this.on("state",(t=>{this._setEvents(t?"on":"off")})),this.on("destroy",(()=>{window.touchJoypad&&(window.touchJoypad.sticks[this.identifier]=void 0)})),this._setEvents("on"))},TouchJoystick.prototype._setEvents=function(t){this._setAxisValues(0,0),this._pointerDown=!1,this._pointerId=-1,this.baseEntity.enabled=!this.hideOnRelease,this.entity.element[t]("mousedown",this._onMouseDown,this),this.entity.element[t]("mousemove",this._onMouseMove,this),this.entity.element[t]("mouseup",this._onMouseUp,this),this.app.touch&&(this.entity.element[t]("touchstart",this._onTouchDown,this),this.entity.element[t]("touchmove",this._onTouchMove,this),this.entity.element[t]("touchend",this._onTouchUp,this),this.entity.element[t]("touchcancel",this._onTouchUp,this))},TouchJoystick.__uiPos=new pc.Vec2,TouchJoystick.prototype.screenToUi=function(t){const i=TouchJoystick.__uiPos,o=this.app.graphicsDevice.canvas.clientWidth,e=this.app.graphicsDevice.canvas.clientHeight;return i.x=t.x/o,i.y=t.y/e,i.mulScalar(2).subScalar(1),i.y*=-1,i},TouchJoystick.prototype._onMouseDown=function(t){t.id=0,this._onPointerDown(t),this._pointerDown&&t.stopPropagation()},TouchJoystick.prototype._onMouseMove=function(t){t.id=0,this._onPointerMove(t),this._pointerDown&&t.stopPropagation()},TouchJoystick.prototype._onMouseUp=function(t){t.id=0,this._pointerDown&&t.stopPropagation(),this._onPointerUp(t)},TouchJoystick.prototype._onTouchDown=function(t){if(this._pointerDown)return;const i=this._pointerDown;t.id=t.touch.identifier,this._onPointerDown(t),!i&&this._pointerDown&&t.stopPropagation()},TouchJoystick.prototype._onTouchMove=function(t){t.id=t.touch.identifier,this._onPointerMove(t),this._pointerDown&&t.stopPropagation(),t.event.preventDefault()},TouchJoystick.prototype._onTouchUp=function(t){this._pointerDown&&(t.id=t.touch.identifier,this._onPointerUp(t),t.stopPropagation()),t.event.preventDefault()},TouchJoystick.prototype._onPointerDown=function(t){const i=this.screenToUi(t);switch(this.type){case"drag":case"relative":this.baseEntity.setPosition(i.x,i.y,0),this.nubEntity.setLocalPosition(0,0,0),this._pointerDown=!0;break;case"fixed":this.nubEntity.setPosition(i.x,i.y,0),this._updateAxisValuesFromNub(),this._pointerDown=!0}this._pointerDown&&(this._canVibrate&&0!==this.vibrationPress&&navigator.vibrate(this.vibrationPress),this._pointerId=t.id?t.id:0,this._setButtonState(!0),this._lastPointerDownPosition.copy(this.baseEntity.getLocalPosition()),this.baseEntity.enabled=!0,this._onPointerMove(t))},TouchJoystick.__tempNubPos=new pc.Vec3,TouchJoystick.__tempBasePos=new pc.Vec3,TouchJoystick.prototype._onPointerMove=function(t){if(this._pointerDown&&this._pointerId==t.id){const i=this.screenToUi(t),o=this.axisRange*this.axisRange;this.nubEntity.setPosition(i.x,i.y,0);const e=TouchJoystick.__tempNubPos;e.copy(this.nubEntity.getLocalPosition());if(e.lengthSq()>=o){if("drag"===this.type){const t=e.length()-this.axisRange,i=TouchJoystick.__tempBasePos;i.copy(e),i.normalize().mulScalar(t),i.add(this.baseEntity.getLocalPosition()),this.baseEntity.setLocalPosition(i)}e.normalize().mulScalar(this.axisRange),this.nubEntity.setLocalPosition(e)}this._updateAxisValuesFromNub()}},TouchJoystick.prototype._onPointerUp=function(t){if(this._pointerDown&&this._pointerId==t.id){switch(this.nubEntity.setLocalPosition(0,0,0),this.hideOnRelease&&(this.baseEntity.enabled=!1),this.positionOnRelease){case"original":this.baseEntity.setLocalPosition(this._originalLocalPosition);break;case"lastStart":this.baseEntity.setLocalPosition(this._lastPointerDownPosition)}this._pointerId=-1,this._updateAxisValuesFromNub(),this._setButtonState(!1),this._pointerDown=!1}},TouchJoystick.prototype._updateAxisValuesFromNub=function(){const t=this.axisRange-this.axisDeadZone,i=this.nubEntity.getLocalPosition(),o=Math.sign(i.x),e=Math.sign(i.y),s=pc.math.clamp(Math.abs(i.x)-this.axisDeadZone,0,t)*o,n=pc.math.clamp(Math.abs(i.y)-this.axisDeadZone,0,t)*e;this._setAxisValues(s/t,n/t)},TouchJoystick.prototype._setAxisValues=function(t,i){window.touchJoypad&&(window.touchJoypad.sticks[this.identifier]={x:t,y:i}),this.axisX=t,this.axisY=i},TouchJoystick.prototype._setButtonState=function(t){window.touchJoypad&&(window.touchJoypad.buttonStates[this.identifier]=t?Date.now():null),this._state=t};!function(){const t={},n={},o={buttons:{isPressed:function(t){return!!n[t]},wasPressed:function(o){const e=n[o],s=t[o];return void 0!==n[o]&&(!s&&e)},wasReleased:function(o){const e=n[o],s=t[o];return void 0!==n[o]&&(s&&!e)},wasTapped:function(n){if(this.wasReleased(n)){return Date.now()-t[n]<=200}return!1}},sticks:{}};o.buttonStates=n;pc.Application.getApplication().on("update",(()=>{for(const o of Object.keys(n)){const e=n[o];t[o]=e}})),window.touchJoypad=o}();var TouchButton=pc.createScript("touchButton");TouchButton.attributes.add("identifier",{type:"string",default:"button0",title:"Identifier",description:"A unique name for the button to refer to it by in the API. Will give a warning in browser tools if the name is not unique."}),TouchButton.attributes.add("vibration",{type:"number",default:0,title:"Vibration duration (ms)",description:"If the device supports vibration with 'Navigator.vibrate', it will vibrate for the duration set here on touch down.Set to 0 to disable."}),TouchButton.prototype.initialize=function(){window.touchJoypad&&void 0!==window.touchJoypad.buttonStates[this.identifier]?console.warn("Touch button identifier already used, please use another for Entity: "+this.entity.name):(this._canVibrate=!!navigator.vibrate,this._setState(!1),this.on("state",(t=>{this._setEvents(t?"on":"off")})),this.on("destroy",(()=>{window.touchJoypad&&(window.touchJoypad.buttonStates[this.identifier]=void 0)})),this._setEvents("on"))},TouchButton.prototype._setEvents=function(t){this._state=!1,this.entity.element[t]("mousedown",this._onMouseDown,this),this.entity.element[t]("mouseup",this._onMouseUp,this),this.app.touch&&(this.entity.element[t]("touchstart",this._onTouchDown,this),this.entity.element[t]("touchend",this._onTouchUp,this),this.entity.element[t]("touchcancel",this._onTouchUp,this))},TouchButton.prototype._onMouseDown=function(t){this._state||(this._onPointerDown(),t.stopPropagation())},TouchButton.prototype._onMouseUp=function(t){this._state&&(this._onPointerUp(),t.stopPropagation())},TouchButton.prototype._onTouchDown=function(t){this._state||(this._onPointerDown(),t.stopPropagation())},TouchButton.prototype._onTouchUp=function(t){this._state&&(this._onPointerUp(),t.stopPropagation()),t.event.preventDefault()},TouchButton.prototype._onPointerDown=function(){this._canVibrate&&0!==this.vibration&&navigator.vibrate(this.vibration),this._setState(!0)},TouchButton.prototype._onPointerUp=function(){this._setState(!1)},TouchButton.prototype._setState=function(t){window.touchJoypad&&(window.touchJoypad.buttonStates[this.identifier]=t?Date.now():null),this._state=t};