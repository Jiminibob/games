{"version":3,"file":"index-5f00d907.js","sources":["../../node_modules/playcanvas/build/playcanvas.mjs/polyfill/OESVertexArrayObject.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/constants.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/core.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/tracing.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/event-handle.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/event-handler.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/events.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/guid.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/path.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/platform.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/string.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/indexed-list.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/wasm-module.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/read-stream.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/sorted-loop-array.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/tags.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/time.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/uri.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/math/constants.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/math/math.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/math/color.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/math/curve-evaluator.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/math/curve.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/math/curve-set.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/math/float-packing.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/math/vec3.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/math/mat3.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/math/vec2.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/math/vec4.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/math/mat4.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/math/quat.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/shape/bounding-box.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/shape/bounding-sphere.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/shape/frustum.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/shape/ray.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/shape/plane.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/audio/constants.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/constants.js","../../node_modules/playcanvas/build/playcanvas.mjs/_virtual/_rollupPluginBabelHelpers.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/math/bit-packing.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/blend-state.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/depth-state.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/version.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/versioned-object.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/scope-id.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/scope-space.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/vertex-buffer.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/hash.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/string-ids.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/vertex-format.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/stencil-parameters.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/graphics-device.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/render-target.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/uniform-buffer-format.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/bind-group-format.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/texture-utils.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/preprocessor.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/shader.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/bind-group.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/dynamic-buffers.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/uniform-buffer.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/gpu-profiler.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/texture.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/webgl/webgl-buffer.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/webgl/webgl-vertex-buffer.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/webgl/webgl-index-buffer.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/webgl/webgl-shader-input.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/device-cache.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/webgl/webgl-shader.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/webgl/webgl-texture.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/webgl/webgl-render-target.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/shader-chunks/frag/gles2.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/shader-chunks/frag/gles3.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/shader-chunks/vert/gles3.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/shader-chunks/frag/webgpu.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/shader-chunks/vert/webgpu.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/shader-chunks/frag/shared.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/shader-utils.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/webgl/webgl-gpu-profiler.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/webgl/webgl-graphics-device.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/index-buffer.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/render-pass.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/vertex-iterator.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/input/constants.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/net/http.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/audio/capabilities.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/audio/channel.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/audio/channel3d.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/sound/listener.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/sound/manager.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/sound/sound.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/sound/instance.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/sound/instance3d.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/constants.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/ref-counted-object.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/graphics-device-access.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/mesh.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/procedural.js","../../node_modules/playcanvas/build/playcanvas.mjs/platform/graphics/shader-processor-options.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/alphaTest.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/ambientConstant.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/ambientEnv.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/ambientSH.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/ao.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/aoDetailMap.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/aoDiffuseOcc.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/aoSpecOcc.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/aoSpecOccConst.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/aoSpecOccConstSimple.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/aoSpecOccSimple.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/base.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/vert/base.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/baseNineSliced.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/vert/baseNineSliced.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/baseNineSlicedTiled.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/biasConst.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/blurVSM.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/clearCoat.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/clearCoatGloss.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/clearCoatNormal.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/clusteredLightUtils.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/clusteredLightCookies.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/clusteredLightShadows.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/clusteredLight.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/combine.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/cookie.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/cubeMapProjectBox.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/cubeMapProjectNone.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/cubeMapRotate.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/debug-output.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/debug-process-frontend.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/frag/decode.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/detailModes.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/diffuse.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/diffuseDetailMap.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/emissive.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/frag/encode.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/end.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/vert/end.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/frag/envAtlas.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/frag/envConst.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/frag/envMultiply.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/extension.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/vert/extension.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/falloffInvSquared.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/falloffLinear.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/frag/fixCubemapSeamsNone.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/frag/fixCubemapSeamsStretch.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/float-unpacking.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/fogExp.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/fogExp2.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/fogLinear.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/fogNone.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/fresnelSchlick.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/frag/fullscreenQuad.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/vert/fullscreenQuad.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/frag/gamma1_0.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/frag/gamma2_2.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/gloss.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/iridescenceDiffraction.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/iridescence.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/iridescenceThickness.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/vert/instancing.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/ior.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/lightDiffuseLambert.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/lightDirPoint.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/lightmapAdd.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/lightmapDirAdd.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/lightmapDir.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/lightmapSingle.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/lightSpecularAnisoGGX.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/lightSpecularBlinn.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/lightSpecularPhong.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/lightSheen.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/frag/linearizeDepth.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/litShaderArgs.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/ltc.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/metalness.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/frag/msdf.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/metalnessModulate.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/vert/msdf.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/vert/normal.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/normalDetailMap.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/vert/normalInstanced.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/normalMap.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/vert/normalSkinned.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/normalXY.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/normalXYZ.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/opacity.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/output.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/outputAlpha.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/outputAlphaOpaque.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/outputAlphaPremul.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/frag/outputTex2D.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/frag/packDepth.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/sheen.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/sheenGloss.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/parallax.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/frag/particle.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/vert/particle.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/vert/particleAnimFrameClamp.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/vert/particleAnimFrameLoop.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/vert/particleAnimTex.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/frag/particleInputFloat.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/frag/particleInputRgba8.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/frag/particleOutputFloat.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/frag/particleOutputRgba8.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/frag/particleUpdaterAABB.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/frag/particleUpdaterEnd.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/frag/particleUpdaterInit.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/frag/particleUpdaterNoRespawn.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/frag/particleUpdaterOnStop.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/frag/particleUpdaterRespawn.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/frag/particleUpdaterSphere.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/frag/particleUpdaterStart.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/vert/particle_billboard.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/frag/particle_blendAdd.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/frag/particle_blendMultiply.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/frag/particle_blendNormal.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/vert/particle_cpu.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/vert/particle_cpu_end.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/vert/particle_customFace.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/frag/particle_end.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/vert/particle_end.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/frag/particle_halflambert.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/vert/particle_init.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/frag/particle_lambert.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/frag/particle_lighting.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/vert/particle_localShift.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/vert/particle_mesh.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/vert/particle_normal.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/frag/particle_normalMap.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/vert/particle_pointAlong.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/frag/particle_soft.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/vert/particle_soft.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/vert/particle_stretch.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/vert/particle_TBN.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/particle/vert/particle_wrap.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/reflDir.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/reflDirAniso.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/reflectionCC.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/reflectionCube.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/reflectionEnvHQ.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/reflectionEnv.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/reflectionSphere.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/reflectionSphereLow.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/reflectionSheen.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/refractionCube.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/refractionDynamic.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/frag/reproject.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/frag/screenDepth.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/shadowCascades.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/shadowEVSM.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/shadowEVSMn.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/shadowPCSS.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/shadowSampleCoord.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/shadowStandard.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/shadowStandardGL2.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/shadowVSM8.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/shadowVSM_common.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/vert/skinBatchConst.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/vert/skinBatchTex.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/vert/skinConst.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/vert/skinTex.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/skybox/frag/skyboxEnv.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/skybox/frag/skyboxHDR.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/skybox/vert/skybox.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/specular.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/frag/spherical.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/specularityFactor.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/spot.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/start.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/vert/start.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/startNineSliced.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/startNineSlicedTiled.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/storeEVSM.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/vert/tangentBinormal.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/TBN.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/TBNderivative.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/TBNfast.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/TBNObjectSpace.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/textureSample.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/thickness.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/frag/tonemappingAces.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/frag/tonemappingAces2.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/frag/tonemappingFilmic.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/frag/tonemappingHejl.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/frag/tonemappingLinear.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/frag/tonemappingNone.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/vert/transform.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/common/vert/transformDecl.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/standard/frag/transmission.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/vert/uv0.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/vert/uv1.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/frag/viewDir.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lit/vert/viewNormal.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/chunks.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/get-program-library.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/programs/shader-generator.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/utils.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/graphics/quad-render.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/graphics/render-pass-quad.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/graphics/quad-render-utils.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-pass.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/programs/basic.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/materials/default-material.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/materials/material.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/materials/basic-material.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/batching/batch.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/batching/batch-group.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/skin-instance.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/batching/skin-batch-instance.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/graph-node.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/ref-counted-cache.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/graphics/lightmap-cache.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/mesh-instance.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/batching/batch-manager.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/graphics/render-pass-color-grab.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/graphics/render-pass-depth-grab.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/graphics/render-pass-depth.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/camera.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/programs/lit-shader-options.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/materials/lit-material-options-builder.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunk-builder.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunk-utils.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/renderer/light-camera.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/lighting/lights-buffer.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/programs/lit-shader.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/programs/lit-options-utils.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/lighting/world-clusters.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/renderer/shadow-map.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/lighting/light-texture-atlas.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/graphics/light-cube.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/renderer/shadow-map-cache.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/renderer/render-pass-shadow-local-non-clustered.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/renderer/shadow-renderer-local.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/renderer/render-pass-shadow-directional.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/renderer/shadow-renderer-directional.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/renderer/shadow-renderer.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/renderer/world-clusters-allocator.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/renderer/render-pass-cookie-renderer.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/renderer/render-pass-shadow-local-clustered.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/renderer/render-pass-update-clustered.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/renderer/renderer.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/composition/render-action.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/math/random.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/graphics/reproject-texture.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/graphics/env-lighting.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/materials/standard-material-options.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/programs/standard.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/materials/standard-material-options-builder.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/materials/standard-material-parameters.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/materials/standard-material.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/renderer/render-pass-render-actions.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/renderer/render-pass-postprocessing.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/renderer/forward-renderer.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/layer.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/sort.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/composition/layer-composition.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/light.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/lighting/lighting-params.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/morph-instance.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/model.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/morph.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/morph-target.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/programs/particle.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/particle-system/cpu-updater.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/particle-system/gpu-updater.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/particle-system/particle-emitter.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/programs/skybox.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/sky.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/immediate/immediate-batch.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/immediate/immediate-batches.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/immediate/immediate.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/scene.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/skin.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/sprite.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/texture-atlas.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/animation/animation.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/animation/skeleton.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/program-library.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lightmapper/frag/bakeDirLmEnd.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lightmapper/frag/bakeLmEnd.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lightmapper/frag/dilate.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/lightmapper/frag/bilateralDeNoise.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/shader-lib/chunks/chunks-lightmapper.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/constants.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/globals.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/script/script-types.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/script.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/frame-graph.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/area-light-luts.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/i18n/constants.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/i18n/utils.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/asset/constants.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/asset/asset-file.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/asset/asset.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/tags-cache.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/asset/asset-registry.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/bundle/bundle-registry.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/registry.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/bundle/bundle.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/handlers/untar.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/handlers/bundle.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/handlers/loader.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/i18n/i18n-parser.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/i18n/i18n.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/script/script-registry.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/entity.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/scene-registry-item.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/scene-registry.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/stats.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/app-base.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/app-options.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/lightmapper/bake-light.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/lightmapper/bake-light-simple.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/lightmapper/bake-light-ambient.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/lightmapper/bake-mesh-node.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/lightmapper/lightmap-filters.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/lightmapper/lightmapper.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/component.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/system.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/anim/constants.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/anim/evaluator/anim-cache.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/anim/evaluator/anim-snapshot.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/anim/evaluator/anim-clip.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/anim/controller/constants.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/anim/evaluator/anim-blend.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/anim/evaluator/anim-target-value.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/anim/evaluator/anim-evaluator.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/anim/evaluator/anim-events.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/anim/evaluator/anim-track.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/anim/binder/anim-binder.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/anim/evaluator/anim-target.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/anim/binder/default-anim-binder.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/animation/component.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/animation/data.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/animation/system.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/anim/controller/anim-node.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/anim/controller/anim-blend-tree.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/anim/controller/anim-blend-tree-1d.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/anim/controller/anim-blend-tree-2d-cartesian.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/anim/controller/anim-blend-tree-2d-directional.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/anim/controller/anim-blend-tree-direct.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/anim/controller/anim-state.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/anim/controller/anim-transition.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/anim/controller/anim-controller.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/anim/component-binder.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/anim/component-layer.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/anim/state-graph/anim-state-graph.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/anim/component.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/anim/data.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/anim/system.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/audio-listener/component.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/audio-listener/data.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/audio-listener/system.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/audio-source/component.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/audio-source/data.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/audio-source/system.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/utils/entity-reference.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/button/constants.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/element/constants.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/button/component.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/button/data.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/button/system.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/collision/component.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/collision/data.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/rigid-body/constants.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/collision/trigger.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/collision/system.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/element/image-element.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/asset/asset-localized.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/font/constants.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/element/markup.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/element/text-element.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/element/component.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/element/data.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/element/system.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/joint/constants.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/joint/component.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/joint/data.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/joint/system.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/layout-child/component.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/layout-child/data.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/layout-child/system.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/layout-group/constants.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/layout-group/layout-calculator.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/layout-group/component.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/layout-group/data.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/layout-group/system.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/model/component.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/model/data.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/model/system.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/particle-system/component.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/particle-system/data.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/particle-system/system.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/skin-instance-cache.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/asset/asset-reference.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/render/component.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/render/data.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/render/system.js","../../node_modules/playcanvas/build/playcanvas.mjs/core/object-pool.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/rigid-body/component.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/rigid-body/data.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/rigid-body/system.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/screen/constants.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/screen/component.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/screen/data.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/screen/system.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/script-legacy/component.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/script-legacy/data.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/script-legacy/system.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/element/element-drag-helper.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/scroll-view/constants.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/scroll-view/component.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/scroll-view/data.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/scroll-view/system.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/scrollbar/component.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/scrollbar/data.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/scrollbar/system.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/sound/slot.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/sound/component.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/sound/data.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/sound/system.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/sprite/constants.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/sprite/sprite-animation-clip.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/sprite/component.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/sprite/data.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/sprite/system.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/zone/component.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/zone/data.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/zone/system.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/camera/post-effect-queue.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/camera/component.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/camera/data.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/camera/system.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/light/component.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/light/data.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/light/system.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/script/script-attributes.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/script/constants.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/script/component.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/script/data.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/components/script/system.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/render.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/handlers/render.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/anim/evaluator/anim-curve.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/anim/evaluator/anim-data.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/parsers/draco-worker.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/parsers/draco-decoder.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/parsers/glb-parser.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/handlers/animation.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/handlers/anim-clip.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/handlers/anim-state-graph.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/handlers/audio.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/handlers/binary.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/parsers/glb-container-resource.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/parsers/glb-container-parser.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/handlers/container.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/handlers/css.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/handlers/cubemap.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/handlers/folder.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/font/font.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/handlers/font.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/compress/compress-utils.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/compress/decompress.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/parsers/scene.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/handlers/scene-utils.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/handlers/hierarchy.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/handlers/html.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/handlers/json.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/materials/standard-material-validator.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/parsers/material/json-standard-material.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/handlers/material.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/parsers/glb-model.js","../../node_modules/playcanvas/build/playcanvas.mjs/scene/skin-partition.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/parsers/json-model.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/handlers/model.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/handlers/scene.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/handlers/script.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/handlers/shader.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/handlers/sprite.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/template.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/handlers/template.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/handlers/text.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/handlers/texture-atlas.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/handlers/basis-worker.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/handlers/basis.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/parsers/texture/basis.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/parsers/texture/img.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/parsers/texture/ktx.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/parsers/texture/ktx2.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/parsers/texture/dds.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/parsers/texture/hdr.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/handlers/texture.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/xr/constants.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/xr/xr-depth-sensing.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/xr/xr-dom-overlay.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/xr/xr-hit-test-source.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/xr/xr-hit-test.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/xr/xr-tracked-image.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/xr/xr-image-tracking.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/xr/xr-finger.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/xr/xr-joint.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/xr/xr-hand.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/xr/xr-input-source.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/xr/xr-input.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/xr/xr-light-estimation.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/xr/xr-plane.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/xr/xr-plane-detection.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/xr/xr-anchor.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/xr/xr-anchors.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/xr/xr-manager.js","../../node_modules/playcanvas/build/playcanvas.mjs/framework/application.js","../../src/js/main.js"],"sourcesContent":["var glErrorShadow = {};\nfunction error(msg) {\n\tif (window.console && window.console.error) {\n\t\twindow.console.error(msg);\n\t}\n}\nfunction log(msg) {\n\tif (window.console && window.console.log) {\n\t\twindow.console.log(msg);\n\t}\n}\nfunction synthesizeGLError(err, opt_msg) {\n\tglErrorShadow[err] = true;\n\tif (opt_msg !== undefined) {\n\t\terror(opt_msg);\n\t}\n}\nfunction wrapGLError(gl) {\n\tvar f = gl.getError;\n\tgl.getError = function () {\n\t\tvar err;\n\t\tdo {\n\t\t\terr = f.apply(gl);\n\t\t\tif (err != gl.NO_ERROR) {\n\t\t\t\tglErrorShadow[err] = true;\n\t\t\t}\n\t\t} while (err != gl.NO_ERROR);\n\t\tfor (var err in glErrorShadow) {\n\t\t\tif (glErrorShadow[err]) {\n\t\t\t\tdelete glErrorShadow[err];\n\t\t\t\treturn parseInt(err);\n\t\t\t}\n\t\t}\n\t\treturn gl.NO_ERROR;\n\t};\n}\nvar WebGLVertexArrayObjectOES = function WebGLVertexArrayObjectOES(ext) {\n\tvar gl = ext.gl;\n\tthis.ext = ext;\n\tthis.isAlive = true;\n\tthis.hasBeenBound = false;\n\tthis.elementArrayBuffer = null;\n\tthis.attribs = new Array(ext.maxVertexAttribs);\n\tfor (var n = 0; n < this.attribs.length; n++) {\n\t\tvar attrib = new WebGLVertexArrayObjectOES.VertexAttrib(gl);\n\t\tthis.attribs[n] = attrib;\n\t}\n\tthis.maxAttrib = 0;\n};\nWebGLVertexArrayObjectOES.VertexAttrib = function VertexAttrib(gl) {\n\tthis.enabled = false;\n\tthis.buffer = null;\n\tthis.size = 4;\n\tthis.type = gl.FLOAT;\n\tthis.normalized = false;\n\tthis.stride = 16;\n\tthis.offset = 0;\n\tthis.cached = \"\";\n\tthis.recache();\n};\nWebGLVertexArrayObjectOES.VertexAttrib.prototype.recache = function recache() {\n\tthis.cached = [this.size, this.type, this.normalized, this.stride, this.offset].join(\":\");\n};\nvar OESVertexArrayObject = function OESVertexArrayObject(gl) {\n\tvar self = this;\n\tthis.gl = gl;\n\twrapGLError(gl);\n\tvar original = this.original = {\n\t\tgetParameter: gl.getParameter,\n\t\tenableVertexAttribArray: gl.enableVertexAttribArray,\n\t\tdisableVertexAttribArray: gl.disableVertexAttribArray,\n\t\tbindBuffer: gl.bindBuffer,\n\t\tgetVertexAttrib: gl.getVertexAttrib,\n\t\tvertexAttribPointer: gl.vertexAttribPointer\n\t};\n\tgl.getParameter = function getParameter(pname) {\n\t\tif (pname == self.VERTEX_ARRAY_BINDING_OES) {\n\t\t\tif (self.currentVertexArrayObject == self.defaultVertexArrayObject) {\n\t\t\t\treturn null;\n\t\t\t} else {\n\t\t\t\treturn self.currentVertexArrayObject;\n\t\t\t}\n\t\t}\n\t\treturn original.getParameter.apply(this, arguments);\n\t};\n\tgl.enableVertexAttribArray = function enableVertexAttribArray(index) {\n\t\tvar vao = self.currentVertexArrayObject;\n\t\tvao.maxAttrib = Math.max(vao.maxAttrib, index);\n\t\tvar attrib = vao.attribs[index];\n\t\tattrib.enabled = true;\n\t\treturn original.enableVertexAttribArray.apply(this, arguments);\n\t};\n\tgl.disableVertexAttribArray = function disableVertexAttribArray(index) {\n\t\tvar vao = self.currentVertexArrayObject;\n\t\tvao.maxAttrib = Math.max(vao.maxAttrib, index);\n\t\tvar attrib = vao.attribs[index];\n\t\tattrib.enabled = false;\n\t\treturn original.disableVertexAttribArray.apply(this, arguments);\n\t};\n\tgl.bindBuffer = function bindBuffer(target, buffer) {\n\t\tswitch (target) {\n\t\t\tcase gl.ARRAY_BUFFER:\n\t\t\t\tself.currentArrayBuffer = buffer;\n\t\t\t\tbreak;\n\t\t\tcase gl.ELEMENT_ARRAY_BUFFER:\n\t\t\t\tself.currentVertexArrayObject.elementArrayBuffer = buffer;\n\t\t\t\tbreak;\n\t\t}\n\t\treturn original.bindBuffer.apply(this, arguments);\n\t};\n\tgl.getVertexAttrib = function getVertexAttrib(index, pname) {\n\t\tvar vao = self.currentVertexArrayObject;\n\t\tvar attrib = vao.attribs[index];\n\t\tswitch (pname) {\n\t\t\tcase gl.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:\n\t\t\t\treturn attrib.buffer;\n\t\t\tcase gl.VERTEX_ATTRIB_ARRAY_ENABLED:\n\t\t\t\treturn attrib.enabled;\n\t\t\tcase gl.VERTEX_ATTRIB_ARRAY_SIZE:\n\t\t\t\treturn attrib.size;\n\t\t\tcase gl.VERTEX_ATTRIB_ARRAY_STRIDE:\n\t\t\t\treturn attrib.stride;\n\t\t\tcase gl.VERTEX_ATTRIB_ARRAY_TYPE:\n\t\t\t\treturn attrib.type;\n\t\t\tcase gl.VERTEX_ATTRIB_ARRAY_NORMALIZED:\n\t\t\t\treturn attrib.normalized;\n\t\t\tdefault:\n\t\t\t\treturn original.getVertexAttrib.apply(this, arguments);\n\t\t}\n\t};\n\tgl.vertexAttribPointer = function vertexAttribPointer(indx, size, type, normalized, stride, offset) {\n\t\tvar vao = self.currentVertexArrayObject;\n\t\tvao.maxAttrib = Math.max(vao.maxAttrib, indx);\n\t\tvar attrib = vao.attribs[indx];\n\t\tattrib.buffer = self.currentArrayBuffer;\n\t\tattrib.size = size;\n\t\tattrib.type = type;\n\t\tattrib.normalized = normalized;\n\t\tattrib.stride = stride;\n\t\tattrib.offset = offset;\n\t\tattrib.recache();\n\t\treturn original.vertexAttribPointer.apply(this, arguments);\n\t};\n\tif (gl.instrumentExtension) {\n\t\tgl.instrumentExtension(this, \"OES_vertex_array_object\");\n\t}\n\tgl.canvas.addEventListener('webglcontextrestored', function () {\n\t\tlog(\"OESVertexArrayObject emulation library context restored\");\n\t\tself.reset_();\n\t}, true);\n\tthis.reset_();\n};\nOESVertexArrayObject.prototype.VERTEX_ARRAY_BINDING_OES = 0x85B5;\nOESVertexArrayObject.prototype.reset_ = function reset_() {\n\tvar contextWasLost = this.vertexArrayObjects !== undefined;\n\tif (contextWasLost) {\n\t\tfor (var ii = 0; ii < this.vertexArrayObjects.length; ++ii) {\n\t\t\tthis.vertexArrayObjects.isAlive = false;\n\t\t}\n\t}\n\tvar gl = this.gl;\n\tthis.maxVertexAttribs = gl.getParameter(gl.MAX_VERTEX_ATTRIBS);\n\tthis.defaultVertexArrayObject = new WebGLVertexArrayObjectOES(this);\n\tthis.currentVertexArrayObject = null;\n\tthis.currentArrayBuffer = null;\n\tthis.vertexArrayObjects = [this.defaultVertexArrayObject];\n\tthis.bindVertexArrayOES(null);\n};\nOESVertexArrayObject.prototype.createVertexArrayOES = function createVertexArrayOES() {\n\tvar arrayObject = new WebGLVertexArrayObjectOES(this);\n\tthis.vertexArrayObjects.push(arrayObject);\n\treturn arrayObject;\n};\nOESVertexArrayObject.prototype.deleteVertexArrayOES = function deleteVertexArrayOES(arrayObject) {\n\tarrayObject.isAlive = false;\n\tthis.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(arrayObject), 1);\n\tif (this.currentVertexArrayObject == arrayObject) {\n\t\tthis.bindVertexArrayOES(null);\n\t}\n};\nOESVertexArrayObject.prototype.isVertexArrayOES = function isVertexArrayOES(arrayObject) {\n\tif (arrayObject && arrayObject instanceof WebGLVertexArrayObjectOES) {\n\t\tif (arrayObject.hasBeenBound && arrayObject.ext == this) {\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n};\nOESVertexArrayObject.prototype.bindVertexArrayOES = function bindVertexArrayOES(arrayObject) {\n\tvar gl = this.gl;\n\tif (arrayObject && !arrayObject.isAlive) {\n\t\tsynthesizeGLError(gl.INVALID_OPERATION, \"bindVertexArrayOES: attempt to bind deleted arrayObject\");\n\t\treturn;\n\t}\n\tvar original = this.original;\n\tvar oldVAO = this.currentVertexArrayObject;\n\tthis.currentVertexArrayObject = arrayObject || this.defaultVertexArrayObject;\n\tthis.currentVertexArrayObject.hasBeenBound = true;\n\tvar newVAO = this.currentVertexArrayObject;\n\tif (oldVAO == newVAO) {\n\t\treturn;\n\t}\n\tif (!oldVAO || newVAO.elementArrayBuffer != oldVAO.elementArrayBuffer) {\n\t\toriginal.bindBuffer.call(gl, gl.ELEMENT_ARRAY_BUFFER, newVAO.elementArrayBuffer);\n\t}\n\tvar currentBinding = this.currentArrayBuffer;\n\tvar maxAttrib = Math.max(oldVAO ? oldVAO.maxAttrib : 0, newVAO.maxAttrib);\n\tfor (var n = 0; n <= maxAttrib; n++) {\n\t\tvar attrib = newVAO.attribs[n];\n\t\tvar oldAttrib = oldVAO ? oldVAO.attribs[n] : null;\n\t\tif (!oldVAO || attrib.enabled != oldAttrib.enabled) {\n\t\t\tif (attrib.enabled) {\n\t\t\t\toriginal.enableVertexAttribArray.call(gl, n);\n\t\t\t} else {\n\t\t\t\toriginal.disableVertexAttribArray.call(gl, n);\n\t\t\t}\n\t\t}\n\t\tif (attrib.enabled) {\n\t\t\tvar bufferChanged = false;\n\t\t\tif (!oldVAO || attrib.buffer != oldAttrib.buffer) {\n\t\t\t\tif (currentBinding != attrib.buffer) {\n\t\t\t\t\toriginal.bindBuffer.call(gl, gl.ARRAY_BUFFER, attrib.buffer);\n\t\t\t\t\tcurrentBinding = attrib.buffer;\n\t\t\t\t}\n\t\t\t\tbufferChanged = true;\n\t\t\t}\n\t\t\tif (bufferChanged || attrib.cached != oldAttrib.cached) {\n\t\t\t\toriginal.vertexAttribPointer.call(gl, n, attrib.size, attrib.type, attrib.normalized, attrib.stride, attrib.offset);\n\t\t\t}\n\t\t}\n\t}\n\tif (this.currentArrayBuffer != currentBinding) {\n\t\toriginal.bindBuffer.call(gl, gl.ARRAY_BUFFER, this.currentArrayBuffer);\n\t}\n};\nconst setupVertexArrayObject = function setupVertexArrayObject(gl) {\n\tif (gl.getSupportedExtensions) {\n\t\tvar exts = gl.getSupportedExtensions();\n\t\tif (exts.indexOf(\"OES_vertex_array_object\") != -1) {\n\t\t\treturn;\n\t\t}\n\t} else if (gl.getExtension) {\n\t\tvar vao = gl.getExtension(\"OES_vertex_array_object\");\n\t\tif (vao) {\n\t\t\treturn;\n\t\t}\n\t}\n\tif (gl.getSupportedExtensions) {\n\t\tvar original_getSupportedExtensions = gl.getSupportedExtensions;\n\t\tgl.getSupportedExtensions = function getSupportedExtensions() {\n\t\t\tvar list = original_getSupportedExtensions.call(this) || [];\n\t\t\tlist.push(\"OES_vertex_array_object\");\n\t\t\treturn list;\n\t\t};\n\t}\n\tvar original_getExtension = gl.getExtension;\n\tgl.getExtension = function getExtension(name) {\n\t\tif (name == \"OES_vertex_array_object\") {\n\t\t\tif (!gl.__OESVertexArrayObject) {\n\t\t\t\tgl.__OESVertexArrayObject = new OESVertexArrayObject(gl);\n\t\t\t}\n\t\t\treturn gl.__OESVertexArrayObject;\n\t\t}\n\t\tif (original_getExtension) {\n\t\t\treturn original_getExtension.call(this, name);\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t};\n};\n\nexport { setupVertexArrayObject };\n","const TRACEID_RENDER_FRAME = 'RenderFrame';\nconst TRACEID_RENDER_FRAME_TIME = 'RenderFrameTime';\nconst TRACEID_RENDER_PASS = 'RenderPass';\nconst TRACEID_RENDER_PASS_DETAIL = 'RenderPassDetail';\nconst TRACEID_RENDER_ACTION = 'RenderAction';\nconst TRACEID_RENDER_TARGET_ALLOC = 'RenderTargetAlloc';\nconst TRACEID_TEXTURE_ALLOC = 'TextureAlloc';\nconst TRACEID_SHADER_ALLOC = 'ShaderAlloc';\nconst TRACEID_SHADER_COMPILE = 'ShaderCompile';\nconst TRACEID_VRAM_TEXTURE = 'VRAM.Texture';\nconst TRACEID_VRAM_VB = 'VRAM.Vb';\nconst TRACEID_VRAM_IB = 'VRAM.Ib';\nconst TRACEID_BINDGROUP_ALLOC = 'BindGroupAlloc';\nconst TRACEID_BINDGROUPFORMAT_ALLOC = 'BindGroupFormatAlloc';\nconst TRACEID_RENDERPIPELINE_ALLOC = 'RenderPipelineAlloc';\nconst TRACEID_COMPUTEPIPELINE_ALLOC = 'ComputePipelineAlloc';\nconst TRACEID_PIPELINELAYOUT_ALLOC = 'PipelineLayoutAlloc';\nconst TRACE_ID_ELEMENT = \"Element\";\nconst TRACEID_TEXTURES = 'Textures';\nconst TRACEID_RENDER_QUEUE = 'RenderQueue';\nconst TRACEID_GPU_TIMINGS = 'GpuTimings';\n\nexport { TRACEID_BINDGROUPFORMAT_ALLOC, TRACEID_BINDGROUP_ALLOC, TRACEID_COMPUTEPIPELINE_ALLOC, TRACEID_GPU_TIMINGS, TRACEID_PIPELINELAYOUT_ALLOC, TRACEID_RENDERPIPELINE_ALLOC, TRACEID_RENDER_ACTION, TRACEID_RENDER_FRAME, TRACEID_RENDER_FRAME_TIME, TRACEID_RENDER_PASS, TRACEID_RENDER_PASS_DETAIL, TRACEID_RENDER_QUEUE, TRACEID_RENDER_TARGET_ALLOC, TRACEID_SHADER_ALLOC, TRACEID_SHADER_COMPILE, TRACEID_TEXTURES, TRACEID_TEXTURE_ALLOC, TRACEID_VRAM_IB, TRACEID_VRAM_TEXTURE, TRACEID_VRAM_VB, TRACE_ID_ELEMENT };\n","const version = '1.67.3';\nconst revision = '5c05b47f6';\nconst config = {};\nconst common = {};\nconst apps = {};\nconst data = {};\nconst _typeLookup = function () {\n\tconst result = {};\n\tconst names = ['Array', 'Object', 'Function', 'Date', 'RegExp', 'Float32Array'];\n\tfor (let i = 0; i < names.length; i++) result['[object ' + names[i] + ']'] = names[i].toLowerCase();\n\treturn result;\n}();\nfunction type(obj) {\n\tif (obj === null) {\n\t\treturn 'null';\n\t}\n\tconst type = typeof obj;\n\tif (type === 'undefined' || type === 'number' || type === 'string' || type === 'boolean') {\n\t\treturn type;\n\t}\n\treturn _typeLookup[Object.prototype.toString.call(obj)];\n}\nfunction extend(target, ex) {\n\tfor (const prop in ex) {\n\t\tconst copy = ex[prop];\n\t\tif (type(copy) === 'object') {\n\t\t\ttarget[prop] = extend({}, copy);\n\t\t} else if (type(copy) === 'array') {\n\t\t\ttarget[prop] = extend([], copy);\n\t\t} else {\n\t\t\ttarget[prop] = copy;\n\t\t}\n\t}\n\treturn target;\n}\n\nexport { apps, common, config, data, extend, revision, type, version };\n","class Tracing {\n\tstatic set(channel, enabled = true) {}\n\tstatic get(channel) {\n\t\treturn Tracing._traceChannels.has(channel);\n\t}\n}\nTracing._traceChannels = new Set();\nTracing.stack = false;\n\nexport { Tracing };\n","import './tracing.js';\n\nclass EventHandle {\n\tconstructor(handler, name, callback, scope, once = false) {\n\t\tthis.handler = void 0;\n\t\tthis.name = void 0;\n\t\tthis.callback = void 0;\n\t\tthis.scope = void 0;\n\t\tthis._once = void 0;\n\t\tthis._removed = false;\n\t\tthis.handler = handler;\n\t\tthis.name = name;\n\t\tthis.callback = callback;\n\t\tthis.scope = scope;\n\t\tthis._once = once;\n\t}\n\toff() {\n\t\tif (this._removed) return;\n\t\tthis.handler.off(this.name, this.callback, this.scope);\n\t}\n\ton(name, callback, scope = this) {\n\t\treturn this.handler._addCallback(name, callback, scope, false);\n\t}\n\tonce(name, callback, scope = this) {\n\t\treturn this.handler._addCallback(name, callback, scope, true);\n\t}\n\tset removed(value) {\n\t\tif (!value) return;\n\t\tthis._removed = true;\n\t}\n\tget removed() {\n\t\treturn this._removed;\n\t}\n}\n\nexport { EventHandle };\n","import { EventHandle } from './event-handle.js';\n\nclass EventHandler {\n\tconstructor() {\n\t\tthis._callbacks = new Map();\n\t\tthis._callbackActive = new Map();\n\t}\n\tinitEventHandler() {\n\t\tthis._callbacks = new Map();\n\t\tthis._callbackActive = new Map();\n\t}\n\t_addCallback(name, callback, scope, once) {\n\t\tif (!this._callbacks.has(name)) this._callbacks.set(name, []);\n\t\tif (this._callbackActive.has(name)) {\n\t\t\tconst callbackActive = this._callbackActive.get(name);\n\t\t\tif (callbackActive && callbackActive === this._callbacks.get(name)) {\n\t\t\t\tthis._callbackActive.set(name, callbackActive.slice());\n\t\t\t}\n\t\t}\n\t\tconst evt = new EventHandle(this, name, callback, scope, once);\n\t\tthis._callbacks.get(name).push(evt);\n\t\treturn evt;\n\t}\n\ton(name, callback, scope = this) {\n\t\treturn this._addCallback(name, callback, scope, false);\n\t}\n\tonce(name, callback, scope = this) {\n\t\treturn this._addCallback(name, callback, scope, true);\n\t}\n\toff(name, callback, scope) {\n\t\tif (name) {\n\t\t\tif (this._callbackActive.has(name) && this._callbackActive.get(name) === this._callbacks.get(name)) this._callbackActive.set(name, this._callbackActive.get(name).slice());\n\t\t} else {\n\t\t\tfor (const [key, callbacks] of this._callbackActive) {\n\t\t\t\tif (!this._callbacks.has(key)) continue;\n\t\t\t\tif (this._callbacks.get(key) !== callbacks) continue;\n\t\t\t\tthis._callbackActive.set(key, callbacks.slice());\n\t\t\t}\n\t\t}\n\t\tif (!name) {\n\t\t\tfor (const callbacks of this._callbacks.values()) {\n\t\t\t\tfor (let i = 0; i < callbacks.length; i++) {\n\t\t\t\t\tcallbacks[i].removed = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._callbacks.clear();\n\t\t} else if (!callback) {\n\t\t\tconst callbacks = this._callbacks.get(name);\n\t\t\tif (callbacks) {\n\t\t\t\tfor (let i = 0; i < callbacks.length; i++) {\n\t\t\t\t\tcallbacks[i].removed = true;\n\t\t\t\t}\n\t\t\t\tthis._callbacks.delete(name);\n\t\t\t}\n\t\t} else {\n\t\t\tconst callbacks = this._callbacks.get(name);\n\t\t\tif (!callbacks) return this;\n\t\t\tfor (let i = 0; i < callbacks.length; i++) {\n\t\t\t\tif (callbacks[i].callback !== callback) continue;\n\t\t\t\tif (scope && callbacks[i].scope !== scope) continue;\n\t\t\t\tcallbacks[i].removed = true;\n\t\t\t\tcallbacks.splice(i, 1);\n\t\t\t\ti--;\n\t\t\t}\n\t\t\tif (callbacks.length === 0) this._callbacks.delete(name);\n\t\t}\n\t\treturn this;\n\t}\n\tfire(name, arg1, arg2, arg3, arg4, arg5, arg6, arg7, arg8) {\n\t\tif (!name) return this;\n\t\tconst callbacksInitial = this._callbacks.get(name);\n\t\tif (!callbacksInitial) return this;\n\t\tlet callbacks;\n\t\tif (!this._callbackActive.has(name)) {\n\t\t\tthis._callbackActive.set(name, callbacksInitial);\n\t\t} else if (this._callbackActive.get(name) !== callbacksInitial) {\n\t\t\tcallbacks = callbacksInitial.slice();\n\t\t}\n\t\tfor (let i = 0; (callbacks || this._callbackActive.get(name)) && i < (callbacks || this._callbackActive.get(name)).length; i++) {\n\t\t\tconst evt = (callbacks || this._callbackActive.get(name))[i];\n\t\t\tif (!evt.callback) continue;\n\t\t\tevt.callback.call(evt.scope, arg1, arg2, arg3, arg4, arg5, arg6, arg7, arg8);\n\t\t\tif (evt._once) {\n\t\t\t\tconst existingCallback = this._callbacks.get(name);\n\t\t\t\tconst ind = existingCallback ? existingCallback.indexOf(evt) : -1;\n\t\t\t\tif (ind !== -1) {\n\t\t\t\t\tif (this._callbackActive.get(name) === existingCallback) this._callbackActive.set(name, this._callbackActive.get(name).slice());\n\t\t\t\t\tconst _callbacks = this._callbacks.get(name);\n\t\t\t\t\tif (!_callbacks) continue;\n\t\t\t\t\t_callbacks[ind].removed = true;\n\t\t\t\t\t_callbacks.splice(ind, 1);\n\t\t\t\t\tif (_callbacks.length === 0) this._callbacks.delete(name);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (!callbacks) this._callbackActive.delete(name);\n\t\treturn this;\n\t}\n\thasEvent(name) {\n\t\tvar _this$_callbacks$get;\n\t\treturn !!((_this$_callbacks$get = this._callbacks.get(name)) != null && _this$_callbacks$get.length);\n\t}\n}\n\nexport { EventHandler };\n","import { EventHandler } from './event-handler.js';\n\nconst events = {\n\tattach: function (target) {\n\t\tconst ev = events;\n\t\ttarget._addCallback = ev._addCallback;\n\t\ttarget.on = ev.on;\n\t\ttarget.off = ev.off;\n\t\ttarget.fire = ev.fire;\n\t\ttarget.once = ev.once;\n\t\ttarget.hasEvent = ev.hasEvent;\n\t\tEventHandler.prototype.initEventHandler.call(target);\n\t\treturn target;\n\t},\n\t_addCallback: EventHandler.prototype._addCallback,\n\ton: EventHandler.prototype.on,\n\toff: EventHandler.prototype.off,\n\tfire: EventHandler.prototype.fire,\n\tonce: EventHandler.prototype.once,\n\thasEvent: EventHandler.prototype.hasEvent\n};\n\nexport { events };\n","const guid = {\n\tcreate: function () {\n\t\treturn 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n\t\t\tconst r = Math.random() * 16 | 0;\n\t\t\tconst v = c === 'x' ? r : r & 0x3 | 0x8;\n\t\t\treturn v.toString(16);\n\t\t});\n\t}\n};\n\nexport { guid };\n","import './tracing.js';\n\nconst path = {\n\tdelimiter: '/',\n\tjoin: function () {\n\t\tconst num = arguments.length;\n\t\tlet result = arguments[0];\n\t\tfor (let index = 0; index < num - 1; ++index) {\n\t\t\tconst one = arguments[index];\n\t\t\tconst two = arguments[index + 1];\n\t\t\tif (two[0] === path.delimiter) {\n\t\t\t\tresult = two;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (one && two && one[one.length - 1] !== path.delimiter && two[0] !== path.delimiter) {\n\t\t\t\tresult += path.delimiter + two;\n\t\t\t} else {\n\t\t\t\tresult += two;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t},\n\tnormalize: function (pathname) {\n\t\tconst lead = pathname.startsWith(path.delimiter);\n\t\tconst trail = pathname.endsWith(path.delimiter);\n\t\tconst parts = pathname.split('/');\n\t\tlet result = '';\n\t\tlet cleaned = [];\n\t\tfor (let i = 0; i < parts.length; i++) {\n\t\t\tif (parts[i] === '') continue;\n\t\t\tif (parts[i] === '.') continue;\n\t\t\tif (parts[i] === '..' && cleaned.length > 0) {\n\t\t\t\tcleaned = cleaned.slice(0, cleaned.length - 2);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (i > 0) cleaned.push(path.delimiter);\n\t\t\tcleaned.push(parts[i]);\n\t\t}\n\t\tresult = cleaned.join('');\n\t\tif (!lead && result[0] === path.delimiter) {\n\t\t\tresult = result.slice(1);\n\t\t}\n\t\tif (trail && result[result.length - 1] !== path.delimiter) {\n\t\t\tresult += path.delimiter;\n\t\t}\n\t\treturn result;\n\t},\n\tsplit: function (pathname) {\n\t\tconst lastDelimiterIndex = pathname.lastIndexOf(path.delimiter);\n\t\tif (lastDelimiterIndex !== -1) {\n\t\t\treturn [pathname.substring(0, lastDelimiterIndex), pathname.substring(lastDelimiterIndex + 1)];\n\t\t}\n\t\treturn [\"\", pathname];\n\t},\n\tgetBasename: function (pathname) {\n\t\treturn path.split(pathname)[1];\n\t},\n\tgetDirectory: function (pathname) {\n\t\treturn path.split(pathname)[0];\n\t},\n\tgetExtension: function (pathname) {\n\t\tconst ext = pathname.split('?')[0].split('.').pop();\n\t\tif (ext !== pathname) {\n\t\t\treturn '.' + ext;\n\t\t}\n\t\treturn '';\n\t},\n\tisRelativePath: function (pathname) {\n\t\treturn pathname.charAt(0) !== '/' && pathname.match(/:\\/\\//) === null;\n\t},\n\textractPath: function (pathname) {\n\t\tlet result = '';\n\t\tconst parts = pathname.split('/');\n\t\tlet i = 0;\n\t\tif (parts.length > 1) {\n\t\t\tif (path.isRelativePath(pathname)) {\n\t\t\t\tif (parts[0] === '.') {\n\t\t\t\t\tfor (i = 0; i < parts.length - 1; ++i) {\n\t\t\t\t\t\tresult += i === 0 ? parts[i] : '/' + parts[i];\n\t\t\t\t\t}\n\t\t\t\t} else if (parts[0] === '..') {\n\t\t\t\t\tfor (i = 0; i < parts.length - 1; ++i) {\n\t\t\t\t\t\tresult += i === 0 ? parts[i] : '/' + parts[i];\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tresult = '.';\n\t\t\t\t\tfor (i = 0; i < parts.length - 1; ++i) {\n\t\t\t\t\t\tresult += '/' + parts[i];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (i = 0; i < parts.length - 1; ++i) {\n\t\t\t\t\tresult += i === 0 ? parts[i] : '/' + parts[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n};\n\nexport { path };\n","const detectPassiveEvents = () => {\n\tlet result = false;\n\ttry {\n\t\tconst opts = Object.defineProperty({}, 'passive', {\n\t\t\tget: function () {\n\t\t\t\tresult = true;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t\twindow.addEventListener('testpassive', null, opts);\n\t\twindow.removeEventListener('testpassive', null, opts);\n\t} catch (e) {}\n\treturn result;\n};\nconst ua = typeof navigator !== 'undefined' ? navigator.userAgent : '';\nconst environment = typeof window !== 'undefined' ? 'browser' : 'node';\nconst platformName = /android/i.test(ua) ? 'android' : /ip([ao]d|hone)/i.test(ua) ? 'ios' : /windows/i.test(ua) ? 'windows' : /mac os/i.test(ua) ? 'osx' : /linux/i.test(ua) ? 'linux' : /cros/i.test(ua) ? 'cros' : null;\nconst browserName = environment !== 'browser' ? null : /(Chrome\\/|Chromium\\/|Edg.*\\/)/.test(ua) ? 'chrome' : /Safari\\//.test(ua) ? 'safari' : /Firefox\\//.test(ua) ? 'firefox' : 'other';\nconst xbox = /xbox/i.test(ua);\nconst touch = environment === 'browser' && ('ontouchstart' in window || 'maxTouchPoints' in navigator && navigator.maxTouchPoints > 0);\nconst gamepads = environment === 'browser' && (!!navigator.getGamepads || !!navigator.webkitGetGamepads);\nconst workers = typeof Worker !== 'undefined';\nconst passiveEvents = detectPassiveEvents();\nconst platform = {\n\tname: platformName,\n\tenvironment: environment,\n\tglobal: environment === 'browser' ? window : global,\n\tbrowser: environment === 'browser',\n\tdesktop: ['windows', 'osx', 'linux', 'cros'].includes(platformName),\n\tmobile: ['android', 'ios'].includes(platformName),\n\tios: platformName === 'ios',\n\tandroid: platformName === 'android',\n\txbox: xbox,\n\tgamepads: gamepads,\n\ttouch: touch,\n\tworkers: workers,\n\tpassiveEvents: passiveEvents,\n\tbrowserName: browserName\n};\n\nexport { platform };\n","const ASCII_LOWERCASE = 'abcdefghijklmnopqrstuvwxyz';\nconst ASCII_UPPERCASE = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';\nconst ASCII_LETTERS = ASCII_LOWERCASE + ASCII_UPPERCASE;\nconst HIGH_SURROGATE_BEGIN = 0xD800;\nconst HIGH_SURROGATE_END = 0xDBFF;\nconst LOW_SURROGATE_BEGIN = 0xDC00;\nconst LOW_SURROGATE_END = 0xDFFF;\nconst ZERO_WIDTH_JOINER = 0x200D;\nconst REGIONAL_INDICATOR_BEGIN = 0x1F1E6;\nconst REGIONAL_INDICATOR_END = 0x1F1FF;\nconst FITZPATRICK_MODIFIER_BEGIN = 0x1F3FB;\nconst FITZPATRICK_MODIFIER_END = 0x1F3FF;\nconst DIACRITICAL_MARKS_BEGIN = 0x20D0;\nconst DIACRITICAL_MARKS_END = 0x20FF;\nconst VARIATION_MODIFIER_BEGIN = 0xFE00;\nconst VARIATION_MODIFIER_END = 0xFE0F;\nfunction getCodePointData(string, i = 0) {\n\tconst size = string.length;\n\tif (i < 0 || i >= size) {\n\t\treturn null;\n\t}\n\tconst first = string.charCodeAt(i);\n\tif (size > 1 && first >= HIGH_SURROGATE_BEGIN && first <= HIGH_SURROGATE_END) {\n\t\tconst second = string.charCodeAt(i + 1);\n\t\tif (second >= LOW_SURROGATE_BEGIN && second <= LOW_SURROGATE_END) {\n\t\t\treturn {\n\t\t\t\tcode: (first - HIGH_SURROGATE_BEGIN) * 0x400 + second - LOW_SURROGATE_BEGIN + 0x10000,\n\t\t\t\tlong: true\n\t\t\t};\n\t\t}\n\t}\n\treturn {\n\t\tcode: first,\n\t\tlong: false\n\t};\n}\nfunction isCodeBetween(string, begin, end) {\n\tif (!string) return false;\n\tconst codeData = getCodePointData(string);\n\tif (codeData) {\n\t\tconst code = codeData.code;\n\t\treturn code >= begin && code <= end;\n\t}\n\treturn false;\n}\nfunction numCharsToTakeForNextSymbol(string, index) {\n\tif (index === string.length - 1) {\n\t\treturn 1;\n\t}\n\tif (isCodeBetween(string[index], HIGH_SURROGATE_BEGIN, HIGH_SURROGATE_END)) {\n\t\tconst first = string.substring(index, index + 2);\n\t\tconst second = string.substring(index + 2, index + 4);\n\t\tif (isCodeBetween(second, FITZPATRICK_MODIFIER_BEGIN, FITZPATRICK_MODIFIER_END) || isCodeBetween(first, REGIONAL_INDICATOR_BEGIN, REGIONAL_INDICATOR_END) && isCodeBetween(second, REGIONAL_INDICATOR_BEGIN, REGIONAL_INDICATOR_END)) {\n\t\t\treturn 4;\n\t\t}\n\t\tif (isCodeBetween(second, VARIATION_MODIFIER_BEGIN, VARIATION_MODIFIER_END)) {\n\t\t\treturn 3;\n\t\t}\n\t\treturn 2;\n\t}\n\tif (isCodeBetween(string[index + 1], VARIATION_MODIFIER_BEGIN, VARIATION_MODIFIER_END)) {\n\t\treturn 2;\n\t}\n\treturn 1;\n}\nconst string = {\n\tASCII_LOWERCASE: ASCII_LOWERCASE,\n\tASCII_UPPERCASE: ASCII_UPPERCASE,\n\tASCII_LETTERS: ASCII_LETTERS,\n\tformat: function (s, ...args) {\n\t\tfor (let i = 0; i < args.length; i++) {\n\t\t\ts = s.replace(`{${i}}`, args[i]);\n\t\t}\n\t\treturn s;\n\t},\n\tgetCodePoint: function (string, i) {\n\t\tconst codePointData = getCodePointData(string, i);\n\t\treturn codePointData && codePointData.code;\n\t},\n\tgetCodePoints: function (string) {\n\t\tif (typeof string !== 'string') {\n\t\t\tthrow new TypeError('Not a string');\n\t\t}\n\t\tlet i = 0;\n\t\tconst arr = [];\n\t\tlet codePoint;\n\t\twhile (!!(codePoint = getCodePointData(string, i))) {\n\t\t\tarr.push(codePoint.code);\n\t\t\ti += codePoint.long ? 2 : 1;\n\t\t}\n\t\treturn arr;\n\t},\n\tgetSymbols: function (string) {\n\t\tif (typeof string !== 'string') {\n\t\t\tthrow new TypeError('Not a string');\n\t\t}\n\t\tlet index = 0;\n\t\tconst length = string.length;\n\t\tconst output = [];\n\t\tlet take = 0;\n\t\tlet ch;\n\t\twhile (index < length) {\n\t\t\ttake += numCharsToTakeForNextSymbol(string, index + take);\n\t\t\tch = string[index + take];\n\t\t\tif (isCodeBetween(ch, DIACRITICAL_MARKS_BEGIN, DIACRITICAL_MARKS_END)) {\n\t\t\t\tch = string[index + take++];\n\t\t\t}\n\t\t\tif (isCodeBetween(ch, VARIATION_MODIFIER_BEGIN, VARIATION_MODIFIER_END)) {\n\t\t\t\tch = string[index + take++];\n\t\t\t}\n\t\t\tif (ch && ch.charCodeAt(0) === ZERO_WIDTH_JOINER) {\n\t\t\t\tch = string[index + take++];\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst char = string.substring(index, index + take);\n\t\t\toutput.push(char);\n\t\t\tindex += take;\n\t\t\ttake = 0;\n\t\t}\n\t\treturn output;\n\t},\n\tfromCodePoint: function () {\n\t\tconst chars = [];\n\t\tlet current;\n\t\tlet codePoint;\n\t\tlet units;\n\t\tfor (let i = 0; i < arguments.length; ++i) {\n\t\t\tcurrent = Number(arguments[i]);\n\t\t\tcodePoint = current - 0x10000;\n\t\t\tunits = current > 0xFFFF ? [(codePoint >> 10) + 0xD800, codePoint % 0x400 + 0xDC00] : [current];\n\t\t\tchars.push(String.fromCharCode.apply(null, units));\n\t\t}\n\t\treturn chars.join('');\n\t}\n};\n\nexport { string };\n","class IndexedList {\n\tconstructor() {\n\t\tthis._list = [];\n\t\tthis._index = {};\n\t}\n\tpush(key, item) {\n\t\tif (this._index[key]) {\n\t\t\tthrow Error('Key already in index ' + key);\n\t\t}\n\t\tconst location = this._list.push(item) - 1;\n\t\tthis._index[key] = location;\n\t}\n\thas(key) {\n\t\treturn this._index[key] !== undefined;\n\t}\n\tget(key) {\n\t\tconst location = this._index[key];\n\t\tif (location !== undefined) {\n\t\t\treturn this._list[location];\n\t\t}\n\t\treturn null;\n\t}\n\tremove(key) {\n\t\tconst location = this._index[key];\n\t\tif (location !== undefined) {\n\t\t\tthis._list.splice(location, 1);\n\t\t\tdelete this._index[key];\n\t\t\tfor (key in this._index) {\n\t\t\t\tconst idx = this._index[key];\n\t\t\t\tif (idx > location) {\n\t\t\t\t\tthis._index[key] = idx - 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\tlist() {\n\t\treturn this._list;\n\t}\n\tclear() {\n\t\tthis._list.length = 0;\n\t\tfor (const prop in this._index) {\n\t\t\tdelete this._index[prop];\n\t\t}\n\t}\n}\n\nexport { IndexedList };\n","const cachedResult = func => {\n\tconst uninitToken = {};\n\tlet result = uninitToken;\n\treturn () => {\n\t\tif (result === uninitToken) {\n\t\t\tresult = func();\n\t\t}\n\t\treturn result;\n\t};\n};\nclass Impl {\n\tstatic loadScript(url, callback) {\n\t\tconst s = document.createElement('script');\n\t\ts.setAttribute('src', url);\n\t\ts.onload = () => {\n\t\t\tcallback(null);\n\t\t};\n\t\ts.onerror = () => {\n\t\t\tcallback(`Failed to load script='${url}'`);\n\t\t};\n\t\tdocument.body.appendChild(s);\n\t}\n\tstatic loadWasm(moduleName, config, callback) {\n\t\tconst loadUrl = Impl.wasmSupported() && config.glueUrl && config.wasmUrl ? config.glueUrl : config.fallbackUrl;\n\t\tif (loadUrl) {\n\t\t\tImpl.loadScript(loadUrl, err => {\n\t\t\t\tif (err) {\n\t\t\t\t\tcallback(err, null);\n\t\t\t\t} else {\n\t\t\t\t\tconst module = window[moduleName];\n\t\t\t\t\twindow[moduleName] = undefined;\n\t\t\t\t\tmodule({\n\t\t\t\t\t\tlocateFile: () => config.wasmUrl,\n\t\t\t\t\t\tonAbort: () => {\n\t\t\t\t\t\t\tcallback('wasm module aborted.');\n\t\t\t\t\t\t}\n\t\t\t\t\t}).then(instance => {\n\t\t\t\t\t\tcallback(null, instance);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tcallback('No supported wasm modules found.', null);\n\t\t}\n\t}\n\tstatic getModule(name) {\n\t\tif (!Impl.modules.hasOwnProperty(name)) {\n\t\t\tImpl.modules[name] = {\n\t\t\t\tconfig: null,\n\t\t\t\tinitializing: false,\n\t\t\t\tinstance: null,\n\t\t\t\tcallbacks: []\n\t\t\t};\n\t\t}\n\t\treturn Impl.modules[name];\n\t}\n\tstatic initialize(moduleName, module) {\n\t\tif (module.initializing) {\n\t\t\treturn;\n\t\t}\n\t\tconst config = module.config;\n\t\tif (config.glueUrl || config.wasmUrl || config.fallbackUrl) {\n\t\t\tmodule.initializing = true;\n\t\t\tImpl.loadWasm(moduleName, config, (err, instance) => {\n\t\t\t\tif (err) {\n\t\t\t\t\tif (config.errorHandler) {\n\t\t\t\t\t\tconfig.errorHandler(err);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.error(`failed to initialize module=${moduleName} error=${err}`);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tmodule.instance = instance;\n\t\t\t\t\tmodule.callbacks.forEach(callback => {\n\t\t\t\t\t\tcallback(instance);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n}\nImpl.modules = {};\nImpl.wasmSupported = cachedResult(() => {\n\ttry {\n\t\tif (typeof WebAssembly === \"object\" && typeof WebAssembly.instantiate === \"function\") {\n\t\t\tconst module = new WebAssembly.Module(Uint8Array.of(0x0, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00));\n\t\t\tif (module instanceof WebAssembly.Module) return new WebAssembly.Instance(module) instanceof WebAssembly.Instance;\n\t\t}\n\t} catch (e) {}\n\treturn false;\n});\nclass WasmModule {\n\tstatic setConfig(moduleName, config) {\n\t\tconst module = Impl.getModule(moduleName);\n\t\tmodule.config = config;\n\t\tif (module.callbacks.length > 0) {\n\t\t\tImpl.initialize(moduleName, module);\n\t\t}\n\t}\n\tstatic getConfig(moduleName) {\n\t\tvar _Impl$modules;\n\t\treturn (_Impl$modules = Impl.modules) == null || (_Impl$modules = _Impl$modules[moduleName]) == null ? void 0 : _Impl$modules.config;\n\t}\n\tstatic getInstance(moduleName, callback) {\n\t\tconst module = Impl.getModule(moduleName);\n\t\tif (module.instance) {\n\t\t\tcallback(module.instance);\n\t\t} else {\n\t\t\tmodule.callbacks.push(callback);\n\t\t\tif (module.config) {\n\t\t\t\tImpl.initialize(moduleName, module);\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport { WasmModule };\n","class ReadStream {\n\tconstructor(arraybuffer) {\n\t\tthis.arraybuffer = arraybuffer;\n\t\tthis.dataView = new DataView(arraybuffer);\n\t\tthis.offset = 0;\n\t\tthis.stack = [];\n\t}\n\tget remainingBytes() {\n\t\treturn this.dataView.byteLength - this.offset;\n\t}\n\treset(offset = 0) {\n\t\tthis.offset = offset;\n\t}\n\tskip(bytes) {\n\t\tthis.offset += bytes;\n\t}\n\talign(bytes) {\n\t\tthis.offset = this.offset + bytes - 1 & ~(bytes - 1);\n\t}\n\t_inc(amount) {\n\t\tthis.offset += amount;\n\t\treturn this.offset - amount;\n\t}\n\treadChar() {\n\t\treturn String.fromCharCode(this.dataView.getUint8(this.offset++));\n\t}\n\treadChars(numChars) {\n\t\tlet result = '';\n\t\tfor (let i = 0; i < numChars; ++i) {\n\t\t\tresult += this.readChar();\n\t\t}\n\t\treturn result;\n\t}\n\treadU8() {\n\t\treturn this.dataView.getUint8(this.offset++);\n\t}\n\treadU16() {\n\t\treturn this.dataView.getUint16(this._inc(2), true);\n\t}\n\treadU32() {\n\t\treturn this.dataView.getUint32(this._inc(4), true);\n\t}\n\treadU64() {\n\t\treturn this.readU32() + 2 ** 32 * this.readU32();\n\t}\n\treadU32be() {\n\t\treturn this.dataView.getUint32(this._inc(4), false);\n\t}\n\treadArray(result) {\n\t\tfor (let i = 0; i < result.length; ++i) {\n\t\t\tresult[i] = this.readU8();\n\t\t}\n\t}\n\treadLine() {\n\t\tconst view = this.dataView;\n\t\tlet result = '';\n\t\twhile (true) {\n\t\t\tif (this.offset >= view.byteLength) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tconst c = String.fromCharCode(this.readU8());\n\t\t\tif (c === '\\n') {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tresult += c;\n\t\t}\n\t\treturn result;\n\t}\n}\n\nexport { ReadStream };\n","class SortedLoopArray {\n\tconstructor(args) {\n\t\tthis.items = [];\n\t\tthis.length = 0;\n\t\tthis.loopIndex = -1;\n\t\tthis._sortBy = void 0;\n\t\tthis._sortHandler = void 0;\n\t\tthis._sortBy = args.sortBy;\n\t\tthis._sortHandler = this._doSort.bind(this);\n\t}\n\t_binarySearch(item) {\n\t\tlet left = 0;\n\t\tlet right = this.items.length - 1;\n\t\tconst search = item[this._sortBy];\n\t\tlet middle;\n\t\tlet current;\n\t\twhile (left <= right) {\n\t\t\tmiddle = Math.floor((left + right) / 2);\n\t\t\tcurrent = this.items[middle][this._sortBy];\n\t\t\tif (current <= search) {\n\t\t\t\tleft = middle + 1;\n\t\t\t} else if (current > search) {\n\t\t\t\tright = middle - 1;\n\t\t\t}\n\t\t}\n\t\treturn left;\n\t}\n\t_doSort(a, b) {\n\t\tconst sortBy = this._sortBy;\n\t\treturn a[sortBy] - b[sortBy];\n\t}\n\tinsert(item) {\n\t\tconst index = this._binarySearch(item);\n\t\tthis.items.splice(index, 0, item);\n\t\tthis.length++;\n\t\tif (this.loopIndex >= index) {\n\t\t\tthis.loopIndex++;\n\t\t}\n\t}\n\tappend(item) {\n\t\tthis.items.push(item);\n\t\tthis.length++;\n\t}\n\tremove(item) {\n\t\tconst idx = this.items.indexOf(item);\n\t\tif (idx < 0) return;\n\t\tthis.items.splice(idx, 1);\n\t\tthis.length--;\n\t\tif (this.loopIndex >= idx) {\n\t\t\tthis.loopIndex--;\n\t\t}\n\t}\n\tsort() {\n\t\tconst current = this.loopIndex >= 0 ? this.items[this.loopIndex] : null;\n\t\tthis.items.sort(this._sortHandler);\n\t\tif (current !== null) {\n\t\t\tthis.loopIndex = this.items.indexOf(current);\n\t\t}\n\t}\n}\n\nexport { SortedLoopArray };\n","import { EventHandler } from './event-handler.js';\n\nclass Tags extends EventHandler {\n\tconstructor(parent) {\n\t\tsuper();\n\t\tthis._index = {};\n\t\tthis._list = [];\n\t\tthis._parent = parent;\n\t}\n\tadd() {\n\t\tlet changed = false;\n\t\tconst tags = this._processArguments(arguments, true);\n\t\tif (!tags.length) return changed;\n\t\tfor (let i = 0; i < tags.length; i++) {\n\t\t\tif (this._index[tags[i]]) continue;\n\t\t\tchanged = true;\n\t\t\tthis._index[tags[i]] = true;\n\t\t\tthis._list.push(tags[i]);\n\t\t\tthis.fire('add', tags[i], this._parent);\n\t\t}\n\t\tif (changed) this.fire('change', this._parent);\n\t\treturn changed;\n\t}\n\tremove() {\n\t\tlet changed = false;\n\t\tif (!this._list.length) return changed;\n\t\tconst tags = this._processArguments(arguments, true);\n\t\tif (!tags.length) return changed;\n\t\tfor (let i = 0; i < tags.length; i++) {\n\t\t\tif (!this._index[tags[i]]) continue;\n\t\t\tchanged = true;\n\t\t\tdelete this._index[tags[i]];\n\t\t\tthis._list.splice(this._list.indexOf(tags[i]), 1);\n\t\t\tthis.fire('remove', tags[i], this._parent);\n\t\t}\n\t\tif (changed) this.fire('change', this._parent);\n\t\treturn changed;\n\t}\n\tclear() {\n\t\tif (!this._list.length) return;\n\t\tconst tags = this._list.slice(0);\n\t\tthis._list = [];\n\t\tthis._index = {};\n\t\tfor (let i = 0; i < tags.length; i++) this.fire('remove', tags[i], this._parent);\n\t\tthis.fire('change', this._parent);\n\t}\n\thas() {\n\t\tif (!this._list.length) return false;\n\t\treturn this._has(this._processArguments(arguments));\n\t}\n\t_has(tags) {\n\t\tif (!this._list.length || !tags.length) return false;\n\t\tfor (let i = 0; i < tags.length; i++) {\n\t\t\tif (tags[i].length === 1) {\n\t\t\t\tif (this._index[tags[i][0]]) return true;\n\t\t\t} else {\n\t\t\t\tlet multiple = true;\n\t\t\t\tfor (let t = 0; t < tags[i].length; t++) {\n\t\t\t\t\tif (this._index[tags[i][t]]) continue;\n\t\t\t\t\tmultiple = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (multiple) return true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\tlist() {\n\t\treturn this._list.slice(0);\n\t}\n\t_processArguments(args, flat) {\n\t\tconst tags = [];\n\t\tlet tmp = [];\n\t\tif (!args || !args.length) return tags;\n\t\tfor (let i = 0; i < args.length; i++) {\n\t\t\tif (args[i] instanceof Array) {\n\t\t\t\tif (!flat) tmp = [];\n\t\t\t\tfor (let t = 0; t < args[i].length; t++) {\n\t\t\t\t\tif (typeof args[i][t] !== 'string') continue;\n\t\t\t\t\tif (flat) {\n\t\t\t\t\t\ttags.push(args[i][t]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttmp.push(args[i][t]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!flat && tmp.length) tags.push(tmp);\n\t\t\t} else if (typeof args[i] === 'string') {\n\t\t\t\tif (flat) {\n\t\t\t\t\ttags.push(args[i]);\n\t\t\t\t} else {\n\t\t\t\t\ttags.push([args[i]]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn tags;\n\t}\n\tget size() {\n\t\treturn this._list.length;\n\t}\n}\n\nexport { Tags };\n","const now = typeof window !== 'undefined' && window.performance && window.performance.now ? performance.now.bind(performance) : Date.now;\n\nexport { now };\n","function createURI(options) {\n\tlet s = '';\n\tif ((options.authority || options.scheme) && (options.host || options.hostpath)) {\n\t\tthrow new Error('Can\\'t have \\'scheme\\' or \\'authority\\' and \\'host\\' or \\'hostpath\\' option');\n\t}\n\tif (options.host && options.hostpath) {\n\t\tthrow new Error('Can\\'t have \\'host\\' and \\'hostpath\\' option');\n\t}\n\tif (options.path && options.hostpath) {\n\t\tthrow new Error('Can\\'t have \\'path\\' and \\'hostpath\\' option');\n\t}\n\tif (options.scheme) {\n\t\ts += options.scheme + ':';\n\t}\n\tif (options.authority) {\n\t\ts += '//' + options.authority;\n\t}\n\tif (options.host) {\n\t\ts += options.host;\n\t}\n\tif (options.path) {\n\t\ts += options.path;\n\t}\n\tif (options.hostpath) {\n\t\ts += options.hostpath;\n\t}\n\tif (options.query) {\n\t\ts += '?' + options.query;\n\t}\n\tif (options.fragment) {\n\t\ts += '#' + options.fragment;\n\t}\n\treturn s;\n}\nconst re = /^(([^:\\/?#]+):)?(\\/\\/([^\\/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?/;\nclass URI {\n\tconstructor(uri) {\n\t\tthis.scheme = void 0;\n\t\tthis.authority = void 0;\n\t\tthis.path = void 0;\n\t\tthis.query = void 0;\n\t\tthis.fragment = void 0;\n\t\tconst result = uri.match(re);\n\t\tthis.scheme = result[2];\n\t\tthis.authority = result[4];\n\t\tthis.path = result[5];\n\t\tthis.query = result[7];\n\t\tthis.fragment = result[9];\n\t}\n\ttoString() {\n\t\tlet s = '';\n\t\tif (this.scheme) {\n\t\t\ts += this.scheme + ':';\n\t\t}\n\t\tif (this.authority) {\n\t\t\ts += '//' + this.authority;\n\t\t}\n\t\ts += this.path;\n\t\tif (this.query) {\n\t\t\ts += '?' + this.query;\n\t\t}\n\t\tif (this.fragment) {\n\t\t\ts += '#' + this.fragment;\n\t\t}\n\t\treturn s;\n\t}\n\tgetQuery() {\n\t\tconst result = {};\n\t\tif (this.query) {\n\t\t\tconst queryParams = decodeURIComponent(this.query).split('&');\n\t\t\tfor (const queryParam of queryParams) {\n\t\t\t\tconst pair = queryParam.split('=');\n\t\t\t\tresult[pair[0]] = pair[1];\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\tsetQuery(params) {\n\t\tlet q = '';\n\t\tfor (const key in params) {\n\t\t\tif (params.hasOwnProperty(key)) {\n\t\t\t\tif (q !== '') {\n\t\t\t\t\tq += '&';\n\t\t\t\t}\n\t\t\t\tq += encodeURIComponent(key) + '=' + encodeURIComponent(params[key]);\n\t\t\t}\n\t\t}\n\t\tthis.query = q;\n\t}\n}\n\nexport { URI, createURI };\n","const CURVE_LINEAR = 0;\nconst CURVE_SMOOTHSTEP = 1;\nconst CURVE_CATMULL = 2;\nconst CURVE_CARDINAL = 3;\nconst CURVE_SPLINE = 4;\nconst CURVE_STEP = 5;\n\nexport { CURVE_CARDINAL, CURVE_CATMULL, CURVE_LINEAR, CURVE_SMOOTHSTEP, CURVE_SPLINE, CURVE_STEP };\n","const math = {\n\tDEG_TO_RAD: Math.PI / 180,\n\tRAD_TO_DEG: 180 / Math.PI,\n\tclamp: function (value, min, max) {\n\t\tif (value >= max) return max;\n\t\tif (value <= min) return min;\n\t\treturn value;\n\t},\n\tintToBytes24: function (i) {\n\t\tconst r = i >> 16 & 0xff;\n\t\tconst g = i >> 8 & 0xff;\n\t\tconst b = i & 0xff;\n\t\treturn [r, g, b];\n\t},\n\tintToBytes32: function (i) {\n\t\tconst r = i >> 24 & 0xff;\n\t\tconst g = i >> 16 & 0xff;\n\t\tconst b = i >> 8 & 0xff;\n\t\tconst a = i & 0xff;\n\t\treturn [r, g, b, a];\n\t},\n\tbytesToInt24: function (r, g, b) {\n\t\tif (r.length) {\n\t\t\tb = r[2];\n\t\t\tg = r[1];\n\t\t\tr = r[0];\n\t\t}\n\t\treturn r << 16 | g << 8 | b;\n\t},\n\tbytesToInt32: function (r, g, b, a) {\n\t\tif (r.length) {\n\t\t\ta = r[3];\n\t\t\tb = r[2];\n\t\t\tg = r[1];\n\t\t\tr = r[0];\n\t\t}\n\t\treturn (r << 24 | g << 16 | b << 8 | a) >>> 0;\n\t},\n\tlerp: function (a, b, alpha) {\n\t\treturn a + (b - a) * math.clamp(alpha, 0, 1);\n\t},\n\tlerpAngle: function (a, b, alpha) {\n\t\tif (b - a > 180) {\n\t\t\tb -= 360;\n\t\t}\n\t\tif (b - a < -180) {\n\t\t\tb += 360;\n\t\t}\n\t\treturn math.lerp(a, b, math.clamp(alpha, 0, 1));\n\t},\n\tpowerOfTwo: function (x) {\n\t\treturn x !== 0 && !(x & x - 1);\n\t},\n\tnextPowerOfTwo: function (val) {\n\t\tval--;\n\t\tval |= val >> 1;\n\t\tval |= val >> 2;\n\t\tval |= val >> 4;\n\t\tval |= val >> 8;\n\t\tval |= val >> 16;\n\t\tval++;\n\t\treturn val;\n\t},\n\tnearestPowerOfTwo: function (val) {\n\t\treturn Math.pow(2, Math.round(Math.log(val) / Math.log(2)));\n\t},\n\trandom: function (min, max) {\n\t\tconst diff = max - min;\n\t\treturn Math.random() * diff + min;\n\t},\n\tsmoothstep: function (min, max, x) {\n\t\tif (x <= min) return 0;\n\t\tif (x >= max) return 1;\n\t\tx = (x - min) / (max - min);\n\t\treturn x * x * (3 - 2 * x);\n\t},\n\tsmootherstep: function (min, max, x) {\n\t\tif (x <= min) return 0;\n\t\tif (x >= max) return 1;\n\t\tx = (x - min) / (max - min);\n\t\treturn x * x * x * (x * (x * 6 - 15) + 10);\n\t},\n\troundUp: function (numToRound, multiple) {\n\t\tif (multiple === 0) return numToRound;\n\t\treturn Math.ceil(numToRound / multiple) * multiple;\n\t},\n\tbetween: function (num, a, b, inclusive) {\n\t\tconst min = Math.min(a, b);\n\t\tconst max = Math.max(a, b);\n\t\treturn inclusive ? num >= min && num <= max : num > min && num < max;\n\t}\n};\n\nexport { math };\n","import { math } from './math.js';\n\nvar _class;\nclass Color {\n\tconstructor(r = 0, g = 0, b = 0, a = 1) {\n\t\tthis.r = void 0;\n\t\tthis.g = void 0;\n\t\tthis.b = void 0;\n\t\tthis.a = void 0;\n\t\tconst length = r.length;\n\t\tif (length === 3 || length === 4) {\n\t\t\tthis.r = r[0];\n\t\t\tthis.g = r[1];\n\t\t\tthis.b = r[2];\n\t\t\tthis.a = r[3] !== undefined ? r[3] : 1;\n\t\t} else {\n\t\t\tthis.r = r;\n\t\t\tthis.g = g;\n\t\t\tthis.b = b;\n\t\t\tthis.a = a;\n\t\t}\n\t}\n\tclone() {\n\t\tconst cstr = this.constructor;\n\t\treturn new cstr(this.r, this.g, this.b, this.a);\n\t}\n\tcopy(rhs) {\n\t\tthis.r = rhs.r;\n\t\tthis.g = rhs.g;\n\t\tthis.b = rhs.b;\n\t\tthis.a = rhs.a;\n\t\treturn this;\n\t}\n\tequals(rhs) {\n\t\treturn this.r === rhs.r && this.g === rhs.g && this.b === rhs.b && this.a === rhs.a;\n\t}\n\tset(r, g, b, a = 1) {\n\t\tthis.r = r;\n\t\tthis.g = g;\n\t\tthis.b = b;\n\t\tthis.a = a;\n\t\treturn this;\n\t}\n\tlerp(lhs, rhs, alpha) {\n\t\tthis.r = lhs.r + alpha * (rhs.r - lhs.r);\n\t\tthis.g = lhs.g + alpha * (rhs.g - lhs.g);\n\t\tthis.b = lhs.b + alpha * (rhs.b - lhs.b);\n\t\tthis.a = lhs.a + alpha * (rhs.a - lhs.a);\n\t\treturn this;\n\t}\n\tfromString(hex) {\n\t\tconst i = parseInt(hex.replace('#', '0x'), 16);\n\t\tlet bytes;\n\t\tif (hex.length > 7) {\n\t\t\tbytes = math.intToBytes32(i);\n\t\t} else {\n\t\t\tbytes = math.intToBytes24(i);\n\t\t\tbytes[3] = 255;\n\t\t}\n\t\tthis.set(bytes[0] / 255, bytes[1] / 255, bytes[2] / 255, bytes[3] / 255);\n\t\treturn this;\n\t}\n\ttoString(alpha) {\n\t\tlet s = '#' + ((1 << 24) + (Math.round(this.r * 255) << 16) + (Math.round(this.g * 255) << 8) + Math.round(this.b * 255)).toString(16).slice(1);\n\t\tif (alpha === true) {\n\t\t\tconst a = Math.round(this.a * 255).toString(16);\n\t\t\tif (this.a < 16 / 255) {\n\t\t\t\ts += '0' + a;\n\t\t\t} else {\n\t\t\t\ts += a;\n\t\t\t}\n\t\t}\n\t\treturn s;\n\t}\n}\n_class = Color;\nColor.BLACK = Object.freeze(new _class(0, 0, 0, 1));\nColor.BLUE = Object.freeze(new _class(0, 0, 1, 1));\nColor.CYAN = Object.freeze(new _class(0, 1, 1, 1));\nColor.GRAY = Object.freeze(new _class(0.5, 0.5, 0.5, 1));\nColor.GREEN = Object.freeze(new _class(0, 1, 0, 1));\nColor.MAGENTA = Object.freeze(new _class(1, 0, 1, 1));\nColor.RED = Object.freeze(new _class(1, 0, 0, 1));\nColor.WHITE = Object.freeze(new _class(1, 1, 1, 1));\nColor.YELLOW = Object.freeze(new _class(1, 1, 0, 1));\n\nexport { Color };\n","import { CURVE_STEP, CURVE_LINEAR, CURVE_SMOOTHSTEP, CURVE_CATMULL, CURVE_CARDINAL, CURVE_SPLINE } from './constants.js';\nimport { math } from './math.js';\n\nclass CurveEvaluator {\n\tconstructor(curve, time = 0) {\n\t\tthis._curve = void 0;\n\t\tthis._left = -Infinity;\n\t\tthis._right = Infinity;\n\t\tthis._recip = 0;\n\t\tthis._p0 = 0;\n\t\tthis._p1 = 0;\n\t\tthis._m0 = 0;\n\t\tthis._m1 = 0;\n\t\tthis._curve = curve;\n\t\tthis._reset(time);\n\t}\n\tevaluate(time, forceReset = false) {\n\t\tif (forceReset || time < this._left || time >= this._right) {\n\t\t\tthis._reset(time);\n\t\t}\n\t\tlet result;\n\t\tconst type = this._curve.type;\n\t\tif (type === CURVE_STEP) {\n\t\t\tresult = this._p0;\n\t\t} else {\n\t\t\tconst t = this._recip === 0 ? 0 : (time - this._left) * this._recip;\n\t\t\tif (type === CURVE_LINEAR) {\n\t\t\t\tresult = math.lerp(this._p0, this._p1, t);\n\t\t\t} else if (type === CURVE_SMOOTHSTEP) {\n\t\t\t\tresult = math.lerp(this._p0, this._p1, t * t * (3 - 2 * t));\n\t\t\t} else {\n\t\t\t\tresult = this._evaluateHermite(this._p0, this._p1, this._m0, this._m1, t);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\t_reset(time) {\n\t\tconst keys = this._curve.keys;\n\t\tconst len = keys.length;\n\t\tif (!len) {\n\t\t\tthis._left = -Infinity;\n\t\t\tthis._right = Infinity;\n\t\t\tthis._recip = 0;\n\t\t\tthis._p0 = this._p1 = this._m0 = this._m1 = 0;\n\t\t} else {\n\t\t\tif (time < keys[0][0]) {\n\t\t\t\tthis._left = -Infinity;\n\t\t\t\tthis._right = keys[0][0];\n\t\t\t\tthis._recip = 0;\n\t\t\t\tthis._p0 = this._p1 = keys[0][1];\n\t\t\t\tthis._m0 = this._m1 = 0;\n\t\t\t} else if (time >= keys[len - 1][0]) {\n\t\t\t\tthis._left = keys[len - 1][0];\n\t\t\t\tthis._right = Infinity;\n\t\t\t\tthis._recip = 0;\n\t\t\t\tthis._p0 = this._p1 = keys[len - 1][1];\n\t\t\t\tthis._m0 = this._m1 = 0;\n\t\t\t} else {\n\t\t\t\tlet index = 0;\n\t\t\t\twhile (time >= keys[index + 1][0]) {\n\t\t\t\t\tindex++;\n\t\t\t\t}\n\t\t\t\tthis._left = keys[index][0];\n\t\t\t\tthis._right = keys[index + 1][0];\n\t\t\t\tconst diff = 1.0 / (this._right - this._left);\n\t\t\t\tthis._recip = isFinite(diff) ? diff : 0;\n\t\t\t\tthis._p0 = keys[index][1];\n\t\t\t\tthis._p1 = keys[index + 1][1];\n\t\t\t\tif (this._isHermite()) {\n\t\t\t\t\tthis._calcTangents(keys, index);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t_isHermite() {\n\t\treturn this._curve.type === CURVE_CATMULL || this._curve.type === CURVE_CARDINAL || this._curve.type === CURVE_SPLINE;\n\t}\n\t_calcTangents(keys, index) {\n\t\tlet a;\n\t\tconst b = keys[index];\n\t\tconst c = keys[index + 1];\n\t\tlet d;\n\t\tif (index === 0) {\n\t\t\ta = [keys[0][0] + (keys[0][0] - keys[1][0]), keys[0][1] + (keys[0][1] - keys[1][1])];\n\t\t} else {\n\t\t\ta = keys[index - 1];\n\t\t}\n\t\tif (index === keys.length - 2) {\n\t\t\td = [keys[index + 1][0] + (keys[index + 1][0] - keys[index][0]), keys[index + 1][1] + (keys[index + 1][1] - keys[index][1])];\n\t\t} else {\n\t\t\td = keys[index + 2];\n\t\t}\n\t\tif (this._curve.type === CURVE_SPLINE) {\n\t\t\tconst s1_ = 2 * (c[0] - b[0]) / (c[0] - a[0]);\n\t\t\tconst s2_ = 2 * (c[0] - b[0]) / (d[0] - b[0]);\n\t\t\tthis._m0 = this._curve.tension * (isFinite(s1_) ? s1_ : 0) * (c[1] - a[1]);\n\t\t\tthis._m1 = this._curve.tension * (isFinite(s2_) ? s2_ : 0) * (d[1] - b[1]);\n\t\t} else {\n\t\t\tconst s1 = (c[0] - b[0]) / (b[0] - a[0]);\n\t\t\tconst s2 = (c[0] - b[0]) / (d[0] - c[0]);\n\t\t\tconst a_ = b[1] + (a[1] - b[1]) * (isFinite(s1) ? s1 : 0);\n\t\t\tconst d_ = c[1] + (d[1] - c[1]) * (isFinite(s2) ? s2 : 0);\n\t\t\tconst tension = this._curve.type === CURVE_CATMULL ? 0.5 : this._curve.tension;\n\t\t\tthis._m0 = tension * (c[1] - a_);\n\t\t\tthis._m1 = tension * (d_ - b[1]);\n\t\t}\n\t}\n\t_evaluateHermite(p0, p1, m0, m1, t) {\n\t\tconst t2 = t * t;\n\t\tconst twot = t + t;\n\t\tconst omt = 1 - t;\n\t\tconst omt2 = omt * omt;\n\t\treturn p0 * ((1 + twot) * omt2) + m0 * (t * omt2) + p1 * (t2 * (3 - twot)) + m1 * (t2 * (t - 1));\n\t}\n}\n\nexport { CurveEvaluator };\n","import { extend } from '../core.js';\nimport { CURVE_SMOOTHSTEP } from './constants.js';\nimport { CurveEvaluator } from './curve-evaluator.js';\n\nclass Curve {\n\tconstructor(data) {\n\t\tthis.keys = [];\n\t\tthis.type = CURVE_SMOOTHSTEP;\n\t\tthis.tension = 0.5;\n\t\tthis._eval = new CurveEvaluator(this);\n\t\tif (data) {\n\t\t\tfor (let i = 0; i < data.length - 1; i += 2) {\n\t\t\t\tthis.keys.push([data[i], data[i + 1]]);\n\t\t\t}\n\t\t}\n\t\tthis.sort();\n\t}\n\tget length() {\n\t\treturn this.keys.length;\n\t}\n\tadd(time, value) {\n\t\tconst keys = this.keys;\n\t\tconst len = keys.length;\n\t\tlet i = 0;\n\t\tfor (; i < len; i++) {\n\t\t\tif (keys[i][0] > time) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tconst key = [time, value];\n\t\tthis.keys.splice(i, 0, key);\n\t\treturn key;\n\t}\n\tget(index) {\n\t\treturn this.keys[index];\n\t}\n\tsort() {\n\t\tthis.keys.sort(function (a, b) {\n\t\t\treturn a[0] - b[0];\n\t\t});\n\t}\n\tvalue(time) {\n\t\treturn this._eval.evaluate(time, true);\n\t}\n\tclosest(time) {\n\t\tconst keys = this.keys;\n\t\tconst length = keys.length;\n\t\tlet min = 2;\n\t\tlet result = null;\n\t\tfor (let i = 0; i < length; i++) {\n\t\t\tconst diff = Math.abs(time - keys[i][0]);\n\t\t\tif (min >= diff) {\n\t\t\t\tmin = diff;\n\t\t\t\tresult = keys[i];\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\tclone() {\n\t\tconst result = new this.constructor();\n\t\tresult.keys = extend(result.keys, this.keys);\n\t\tresult.type = this.type;\n\t\tresult.tension = this.tension;\n\t\treturn result;\n\t}\n\tquantize(precision) {\n\t\tprecision = Math.max(precision, 2);\n\t\tconst values = new Float32Array(precision);\n\t\tconst step = 1.0 / (precision - 1);\n\t\tvalues[0] = this._eval.evaluate(0, true);\n\t\tfor (let i = 1; i < precision; i++) {\n\t\t\tvalues[i] = this._eval.evaluate(step * i);\n\t\t}\n\t\treturn values;\n\t}\n\tquantizeClamped(precision, min, max) {\n\t\tconst result = this.quantize(precision);\n\t\tfor (let i = 0; i < result.length; ++i) {\n\t\t\tresult[i] = Math.min(max, Math.max(min, result[i]));\n\t\t}\n\t\treturn result;\n\t}\n}\n\nexport { Curve };\n","import { CURVE_SMOOTHSTEP } from './constants.js';\nimport { Curve } from './curve.js';\nimport { CurveEvaluator } from './curve-evaluator.js';\n\nclass CurveSet {\n\tconstructor() {\n\t\tthis.curves = [];\n\t\tthis._type = CURVE_SMOOTHSTEP;\n\t\tif (arguments.length > 1) {\n\t\t\tfor (let i = 0; i < arguments.length; i++) {\n\t\t\t\tthis.curves.push(new Curve(arguments[i]));\n\t\t\t}\n\t\t} else {\n\t\t\tif (arguments.length === 0) {\n\t\t\t\tthis.curves.push(new Curve());\n\t\t\t} else {\n\t\t\t\tconst arg = arguments[0];\n\t\t\t\tif (typeof arg === 'number') {\n\t\t\t\t\tfor (let i = 0; i < arg; i++) {\n\t\t\t\t\t\tthis.curves.push(new Curve());\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfor (let i = 0; i < arg.length; i++) {\n\t\t\t\t\t\tthis.curves.push(new Curve(arg[i]));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tget length() {\n\t\treturn this.curves.length;\n\t}\n\tset type(value) {\n\t\tthis._type = value;\n\t\tfor (let i = 0; i < this.curves.length; i++) {\n\t\t\tthis.curves[i].type = value;\n\t\t}\n\t}\n\tget type() {\n\t\treturn this._type;\n\t}\n\tget(index) {\n\t\treturn this.curves[index];\n\t}\n\tvalue(time, result = []) {\n\t\tconst length = this.curves.length;\n\t\tresult.length = length;\n\t\tfor (let i = 0; i < length; i++) {\n\t\t\tresult[i] = this.curves[i].value(time);\n\t\t}\n\t\treturn result;\n\t}\n\tclone() {\n\t\tconst result = new this.constructor();\n\t\tresult.curves = [];\n\t\tfor (let i = 0; i < this.curves.length; i++) {\n\t\t\tresult.curves.push(this.curves[i].clone());\n\t\t}\n\t\tresult._type = this._type;\n\t\treturn result;\n\t}\n\tquantize(precision) {\n\t\tprecision = Math.max(precision, 2);\n\t\tconst numCurves = this.curves.length;\n\t\tconst values = new Float32Array(precision * numCurves);\n\t\tconst step = 1.0 / (precision - 1);\n\t\tfor (let c = 0; c < numCurves; c++) {\n\t\t\tconst ev = new CurveEvaluator(this.curves[c]);\n\t\t\tfor (let i = 0; i < precision; i++) {\n\t\t\t\tvalues[i * numCurves + c] = ev.evaluate(step * i);\n\t\t\t}\n\t\t}\n\t\treturn values;\n\t}\n\tquantizeClamped(precision, min, max) {\n\t\tconst result = this.quantize(precision);\n\t\tfor (let i = 0; i < result.length; ++i) {\n\t\t\tresult[i] = Math.min(max, Math.max(min, result[i]));\n\t\t}\n\t\treturn result;\n\t}\n}\n\nexport { CurveSet };\n","import { math } from './math.js';\n\nconst oneDiv255 = 1 / 255;\nconst floatView = new Float32Array(1);\nconst int32View = new Int32Array(floatView.buffer);\nclass FloatPacking {\n\tstatic float2Half(value) {\n\t\tfloatView[0] = value;\n\t\tconst x = int32View[0];\n\t\tlet bits = x >> 16 & 0x8000;\n\t\tlet m = x >> 12 & 0x07ff;\n\t\tconst e = x >> 23 & 0xff;\n\t\tif (e < 103) {\n\t\t\treturn bits;\n\t\t}\n\t\tif (e > 142) {\n\t\t\tbits |= 0x7c00;\n\t\t\tbits |= (e === 255 ? 0 : 1) && x & 0x007fffff;\n\t\t\treturn bits;\n\t\t}\n\t\tif (e < 113) {\n\t\t\tm |= 0x0800;\n\t\t\tbits |= (m >> 114 - e) + (m >> 113 - e & 1);\n\t\t\treturn bits;\n\t\t}\n\t\tbits |= e - 112 << 10 | m >> 1;\n\t\tbits += m & 1;\n\t\treturn bits;\n\t}\n\tstatic float2Bytes(value, array, offset, numBytes) {\n\t\tconst enc1 = 255.0 * value % 1;\n\t\tarray[offset + 0] = Math.round((value % 1 - oneDiv255 * enc1) * 255);\n\t\tif (numBytes > 1) {\n\t\t\tconst enc2 = 65025.0 * value % 1;\n\t\t\tarray[offset + 1] = Math.round((enc1 - oneDiv255 * enc2) * 255);\n\t\t\tif (numBytes > 2) {\n\t\t\t\tconst enc3 = 16581375.0 * value % 1;\n\t\t\t\tarray[offset + 2] = Math.round((enc2 - oneDiv255 * enc3) * 255);\n\t\t\t\tif (numBytes > 3) {\n\t\t\t\t\tarray[offset + 3] = Math.round(enc3 * 255);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tstatic float2BytesRange(value, array, offset, min, max, numBytes) {\n\t\tvalue = math.clamp((value - min) / (max - min), 0, 1);\n\t\tFloatPacking.float2Bytes(value, array, offset, numBytes);\n\t}\n\tstatic float2MantissaExponent(value, array, offset, numBytes) {\n\t\tconst exponent = Math.floor(Math.log2(Math.abs(value))) + 1;\n\t\tvalue /= Math.pow(2, exponent);\n\t\tFloatPacking.float2BytesRange(value, array, offset, -1, 1, numBytes - 1);\n\t\tarray[offset + numBytes - 1] = Math.round(exponent + 127);\n\t}\n}\n\nexport { FloatPacking };\n","var _class;\nclass Vec3 {\n\tconstructor(x = 0, y = 0, z = 0) {\n\t\tthis.x = void 0;\n\t\tthis.y = void 0;\n\t\tthis.z = void 0;\n\t\tif (x.length === 3) {\n\t\t\tthis.x = x[0];\n\t\t\tthis.y = x[1];\n\t\t\tthis.z = x[2];\n\t\t} else {\n\t\t\tthis.x = x;\n\t\t\tthis.y = y;\n\t\t\tthis.z = z;\n\t\t}\n\t}\n\tadd(rhs) {\n\t\tthis.x += rhs.x;\n\t\tthis.y += rhs.y;\n\t\tthis.z += rhs.z;\n\t\treturn this;\n\t}\n\tadd2(lhs, rhs) {\n\t\tthis.x = lhs.x + rhs.x;\n\t\tthis.y = lhs.y + rhs.y;\n\t\tthis.z = lhs.z + rhs.z;\n\t\treturn this;\n\t}\n\taddScalar(scalar) {\n\t\tthis.x += scalar;\n\t\tthis.y += scalar;\n\t\tthis.z += scalar;\n\t\treturn this;\n\t}\n\taddScaled(rhs, scalar) {\n\t\tthis.x += rhs.x * scalar;\n\t\tthis.y += rhs.y * scalar;\n\t\tthis.z += rhs.z * scalar;\n\t\treturn this;\n\t}\n\tclone() {\n\t\tconst cstr = this.constructor;\n\t\treturn new cstr(this.x, this.y, this.z);\n\t}\n\tcopy(rhs) {\n\t\tthis.x = rhs.x;\n\t\tthis.y = rhs.y;\n\t\tthis.z = rhs.z;\n\t\treturn this;\n\t}\n\tcross(lhs, rhs) {\n\t\tconst lx = lhs.x;\n\t\tconst ly = lhs.y;\n\t\tconst lz = lhs.z;\n\t\tconst rx = rhs.x;\n\t\tconst ry = rhs.y;\n\t\tconst rz = rhs.z;\n\t\tthis.x = ly * rz - ry * lz;\n\t\tthis.y = lz * rx - rz * lx;\n\t\tthis.z = lx * ry - rx * ly;\n\t\treturn this;\n\t}\n\tdistance(rhs) {\n\t\tconst x = this.x - rhs.x;\n\t\tconst y = this.y - rhs.y;\n\t\tconst z = this.z - rhs.z;\n\t\treturn Math.sqrt(x * x + y * y + z * z);\n\t}\n\tdiv(rhs) {\n\t\tthis.x /= rhs.x;\n\t\tthis.y /= rhs.y;\n\t\tthis.z /= rhs.z;\n\t\treturn this;\n\t}\n\tdiv2(lhs, rhs) {\n\t\tthis.x = lhs.x / rhs.x;\n\t\tthis.y = lhs.y / rhs.y;\n\t\tthis.z = lhs.z / rhs.z;\n\t\treturn this;\n\t}\n\tdivScalar(scalar) {\n\t\tthis.x /= scalar;\n\t\tthis.y /= scalar;\n\t\tthis.z /= scalar;\n\t\treturn this;\n\t}\n\tdot(rhs) {\n\t\treturn this.x * rhs.x + this.y * rhs.y + this.z * rhs.z;\n\t}\n\tequals(rhs) {\n\t\treturn this.x === rhs.x && this.y === rhs.y && this.z === rhs.z;\n\t}\n\tequalsApprox(rhs, epsilon = 1e-6) {\n\t\treturn Math.abs(this.x - rhs.x) < epsilon && Math.abs(this.y - rhs.y) < epsilon && Math.abs(this.z - rhs.z) < epsilon;\n\t}\n\tlength() {\n\t\treturn Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z);\n\t}\n\tlengthSq() {\n\t\treturn this.x * this.x + this.y * this.y + this.z * this.z;\n\t}\n\tlerp(lhs, rhs, alpha) {\n\t\tthis.x = lhs.x + alpha * (rhs.x - lhs.x);\n\t\tthis.y = lhs.y + alpha * (rhs.y - lhs.y);\n\t\tthis.z = lhs.z + alpha * (rhs.z - lhs.z);\n\t\treturn this;\n\t}\n\tmul(rhs) {\n\t\tthis.x *= rhs.x;\n\t\tthis.y *= rhs.y;\n\t\tthis.z *= rhs.z;\n\t\treturn this;\n\t}\n\tmul2(lhs, rhs) {\n\t\tthis.x = lhs.x * rhs.x;\n\t\tthis.y = lhs.y * rhs.y;\n\t\tthis.z = lhs.z * rhs.z;\n\t\treturn this;\n\t}\n\tmulScalar(scalar) {\n\t\tthis.x *= scalar;\n\t\tthis.y *= scalar;\n\t\tthis.z *= scalar;\n\t\treturn this;\n\t}\n\tnormalize(src = this) {\n\t\tconst lengthSq = src.x * src.x + src.y * src.y + src.z * src.z;\n\t\tif (lengthSq > 0) {\n\t\t\tconst invLength = 1 / Math.sqrt(lengthSq);\n\t\t\tthis.x = src.x * invLength;\n\t\t\tthis.y = src.y * invLength;\n\t\t\tthis.z = src.z * invLength;\n\t\t}\n\t\treturn this;\n\t}\n\tfloor(src = this) {\n\t\tthis.x = Math.floor(src.x);\n\t\tthis.y = Math.floor(src.y);\n\t\tthis.z = Math.floor(src.z);\n\t\treturn this;\n\t}\n\tceil(src = this) {\n\t\tthis.x = Math.ceil(src.x);\n\t\tthis.y = Math.ceil(src.y);\n\t\tthis.z = Math.ceil(src.z);\n\t\treturn this;\n\t}\n\tround(src = this) {\n\t\tthis.x = Math.round(src.x);\n\t\tthis.y = Math.round(src.y);\n\t\tthis.z = Math.round(src.z);\n\t\treturn this;\n\t}\n\tmin(rhs) {\n\t\tif (rhs.x < this.x) this.x = rhs.x;\n\t\tif (rhs.y < this.y) this.y = rhs.y;\n\t\tif (rhs.z < this.z) this.z = rhs.z;\n\t\treturn this;\n\t}\n\tmax(rhs) {\n\t\tif (rhs.x > this.x) this.x = rhs.x;\n\t\tif (rhs.y > this.y) this.y = rhs.y;\n\t\tif (rhs.z > this.z) this.z = rhs.z;\n\t\treturn this;\n\t}\n\tproject(rhs) {\n\t\tconst a_dot_b = this.x * rhs.x + this.y * rhs.y + this.z * rhs.z;\n\t\tconst b_dot_b = rhs.x * rhs.x + rhs.y * rhs.y + rhs.z * rhs.z;\n\t\tconst s = a_dot_b / b_dot_b;\n\t\tthis.x = rhs.x * s;\n\t\tthis.y = rhs.y * s;\n\t\tthis.z = rhs.z * s;\n\t\treturn this;\n\t}\n\tset(x, y, z) {\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.z = z;\n\t\treturn this;\n\t}\n\tsub(rhs) {\n\t\tthis.x -= rhs.x;\n\t\tthis.y -= rhs.y;\n\t\tthis.z -= rhs.z;\n\t\treturn this;\n\t}\n\tsub2(lhs, rhs) {\n\t\tthis.x = lhs.x - rhs.x;\n\t\tthis.y = lhs.y - rhs.y;\n\t\tthis.z = lhs.z - rhs.z;\n\t\treturn this;\n\t}\n\tsubScalar(scalar) {\n\t\tthis.x -= scalar;\n\t\tthis.y -= scalar;\n\t\tthis.z -= scalar;\n\t\treturn this;\n\t}\n\ttoString() {\n\t\treturn `[${this.x}, ${this.y}, ${this.z}]`;\n\t}\n}\n_class = Vec3;\nVec3.ZERO = Object.freeze(new _class(0, 0, 0));\nVec3.ONE = Object.freeze(new _class(1, 1, 1));\nVec3.UP = Object.freeze(new _class(0, 1, 0));\nVec3.DOWN = Object.freeze(new _class(0, -1, 0));\nVec3.RIGHT = Object.freeze(new _class(1, 0, 0));\nVec3.LEFT = Object.freeze(new _class(-1, 0, 0));\nVec3.FORWARD = Object.freeze(new _class(0, 0, -1));\nVec3.BACK = Object.freeze(new _class(0, 0, 1));\n\nexport { Vec3 };\n","import { Vec3 } from './vec3.js';\n\nvar _class;\nclass Mat3 {\n\tconstructor() {\n\t\tthis.data = new Float32Array(9);\n\t\tthis.data[0] = this.data[4] = this.data[8] = 1;\n\t}\n\tclone() {\n\t\tconst cstr = this.constructor;\n\t\treturn new cstr().copy(this);\n\t}\n\tcopy(rhs) {\n\t\tconst src = rhs.data;\n\t\tconst dst = this.data;\n\t\tdst[0] = src[0];\n\t\tdst[1] = src[1];\n\t\tdst[2] = src[2];\n\t\tdst[3] = src[3];\n\t\tdst[4] = src[4];\n\t\tdst[5] = src[5];\n\t\tdst[6] = src[6];\n\t\tdst[7] = src[7];\n\t\tdst[8] = src[8];\n\t\treturn this;\n\t}\n\tset(src) {\n\t\tconst dst = this.data;\n\t\tdst[0] = src[0];\n\t\tdst[1] = src[1];\n\t\tdst[2] = src[2];\n\t\tdst[3] = src[3];\n\t\tdst[4] = src[4];\n\t\tdst[5] = src[5];\n\t\tdst[6] = src[6];\n\t\tdst[7] = src[7];\n\t\tdst[8] = src[8];\n\t\treturn this;\n\t}\n\tequals(rhs) {\n\t\tconst l = this.data;\n\t\tconst r = rhs.data;\n\t\treturn l[0] === r[0] && l[1] === r[1] && l[2] === r[2] && l[3] === r[3] && l[4] === r[4] && l[5] === r[5] && l[6] === r[6] && l[7] === r[7] && l[8] === r[8];\n\t}\n\tisIdentity() {\n\t\tconst m = this.data;\n\t\treturn m[0] === 1 && m[1] === 0 && m[2] === 0 && m[3] === 0 && m[4] === 1 && m[5] === 0 && m[6] === 0 && m[7] === 0 && m[8] === 1;\n\t}\n\tsetIdentity() {\n\t\tconst m = this.data;\n\t\tm[0] = 1;\n\t\tm[1] = 0;\n\t\tm[2] = 0;\n\t\tm[3] = 0;\n\t\tm[4] = 1;\n\t\tm[5] = 0;\n\t\tm[6] = 0;\n\t\tm[7] = 0;\n\t\tm[8] = 1;\n\t\treturn this;\n\t}\n\ttoString() {\n\t\treturn '[' + this.data.join(', ') + ']';\n\t}\n\ttranspose(src = this) {\n\t\tconst s = src.data;\n\t\tconst t = this.data;\n\t\tif (s === t) {\n\t\t\tlet tmp;\n\t\t\ttmp = s[1];\n\t\t\tt[1] = s[3];\n\t\t\tt[3] = tmp;\n\t\t\ttmp = s[2];\n\t\t\tt[2] = s[6];\n\t\t\tt[6] = tmp;\n\t\t\ttmp = s[5];\n\t\t\tt[5] = s[7];\n\t\t\tt[7] = tmp;\n\t\t} else {\n\t\t\tt[0] = s[0];\n\t\t\tt[1] = s[3];\n\t\t\tt[2] = s[6];\n\t\t\tt[3] = s[1];\n\t\t\tt[4] = s[4];\n\t\t\tt[5] = s[7];\n\t\t\tt[6] = s[2];\n\t\t\tt[7] = s[5];\n\t\t\tt[8] = s[8];\n\t\t}\n\t\treturn this;\n\t}\n\tsetFromMat4(m) {\n\t\tconst src = m.data;\n\t\tconst dst = this.data;\n\t\tdst[0] = src[0];\n\t\tdst[1] = src[1];\n\t\tdst[2] = src[2];\n\t\tdst[3] = src[4];\n\t\tdst[4] = src[5];\n\t\tdst[5] = src[6];\n\t\tdst[6] = src[8];\n\t\tdst[7] = src[9];\n\t\tdst[8] = src[10];\n\t\treturn this;\n\t}\n\tinvertMat4(src) {\n\t\tconst s = src.data;\n\t\tconst a0 = s[0];\n\t\tconst a1 = s[1];\n\t\tconst a2 = s[2];\n\t\tconst a4 = s[4];\n\t\tconst a5 = s[5];\n\t\tconst a6 = s[6];\n\t\tconst a8 = s[8];\n\t\tconst a9 = s[9];\n\t\tconst a10 = s[10];\n\t\tconst b11 = a10 * a5 - a6 * a9;\n\t\tconst b21 = -a10 * a1 + a2 * a9;\n\t\tconst b31 = a6 * a1 - a2 * a5;\n\t\tconst b12 = -a10 * a4 + a6 * a8;\n\t\tconst b22 = a10 * a0 - a2 * a8;\n\t\tconst b32 = -a6 * a0 + a2 * a4;\n\t\tconst b13 = a9 * a4 - a5 * a8;\n\t\tconst b23 = -a9 * a0 + a1 * a8;\n\t\tconst b33 = a5 * a0 - a1 * a4;\n\t\tconst det = a0 * b11 + a1 * b12 + a2 * b13;\n\t\tif (det === 0) {\n\t\t\tthis.setIdentity();\n\t\t} else {\n\t\t\tconst invDet = 1 / det;\n\t\t\tconst t = this.data;\n\t\t\tt[0] = b11 * invDet;\n\t\t\tt[1] = b21 * invDet;\n\t\t\tt[2] = b31 * invDet;\n\t\t\tt[3] = b12 * invDet;\n\t\t\tt[4] = b22 * invDet;\n\t\t\tt[5] = b32 * invDet;\n\t\t\tt[6] = b13 * invDet;\n\t\t\tt[7] = b23 * invDet;\n\t\t\tt[8] = b33 * invDet;\n\t\t}\n\t\treturn this;\n\t}\n\ttransformVector(vec, res = new Vec3()) {\n\t\tconst m = this.data;\n\t\tconst x = vec.x;\n\t\tconst y = vec.y;\n\t\tconst z = vec.z;\n\t\tres.x = x * m[0] + y * m[3] + z * m[6];\n\t\tres.y = x * m[1] + y * m[4] + z * m[7];\n\t\tres.z = x * m[2] + y * m[5] + z * m[8];\n\t\treturn res;\n\t}\n}\n_class = Mat3;\nMat3.IDENTITY = Object.freeze(new _class());\nMat3.ZERO = Object.freeze(new _class().set([0, 0, 0, 0, 0, 0, 0, 0, 0]));\n\nexport { Mat3 };\n","import { math } from './math.js';\n\nvar _class;\nclass Vec2 {\n\tconstructor(x = 0, y = 0) {\n\t\tthis.x = void 0;\n\t\tthis.y = void 0;\n\t\tif (x.length === 2) {\n\t\t\tthis.x = x[0];\n\t\t\tthis.y = x[1];\n\t\t} else {\n\t\t\tthis.x = x;\n\t\t\tthis.y = y;\n\t\t}\n\t}\n\tadd(rhs) {\n\t\tthis.x += rhs.x;\n\t\tthis.y += rhs.y;\n\t\treturn this;\n\t}\n\tadd2(lhs, rhs) {\n\t\tthis.x = lhs.x + rhs.x;\n\t\tthis.y = lhs.y + rhs.y;\n\t\treturn this;\n\t}\n\taddScalar(scalar) {\n\t\tthis.x += scalar;\n\t\tthis.y += scalar;\n\t\treturn this;\n\t}\n\taddScaled(rhs, scalar) {\n\t\tthis.x += rhs.x * scalar;\n\t\tthis.y += rhs.y * scalar;\n\t\treturn this;\n\t}\n\tclone() {\n\t\tconst cstr = this.constructor;\n\t\treturn new cstr(this.x, this.y);\n\t}\n\tcopy(rhs) {\n\t\tthis.x = rhs.x;\n\t\tthis.y = rhs.y;\n\t\treturn this;\n\t}\n\tcross(rhs) {\n\t\treturn this.x * rhs.y - this.y * rhs.x;\n\t}\n\tdistance(rhs) {\n\t\tconst x = this.x - rhs.x;\n\t\tconst y = this.y - rhs.y;\n\t\treturn Math.sqrt(x * x + y * y);\n\t}\n\tdiv(rhs) {\n\t\tthis.x /= rhs.x;\n\t\tthis.y /= rhs.y;\n\t\treturn this;\n\t}\n\tdiv2(lhs, rhs) {\n\t\tthis.x = lhs.x / rhs.x;\n\t\tthis.y = lhs.y / rhs.y;\n\t\treturn this;\n\t}\n\tdivScalar(scalar) {\n\t\tthis.x /= scalar;\n\t\tthis.y /= scalar;\n\t\treturn this;\n\t}\n\tdot(rhs) {\n\t\treturn this.x * rhs.x + this.y * rhs.y;\n\t}\n\tequals(rhs) {\n\t\treturn this.x === rhs.x && this.y === rhs.y;\n\t}\n\tequalsApprox(rhs, epsilon = 1e-6) {\n\t\treturn Math.abs(this.x - rhs.x) < epsilon && Math.abs(this.y - rhs.y) < epsilon;\n\t}\n\tlength() {\n\t\treturn Math.sqrt(this.x * this.x + this.y * this.y);\n\t}\n\tlengthSq() {\n\t\treturn this.x * this.x + this.y * this.y;\n\t}\n\tlerp(lhs, rhs, alpha) {\n\t\tthis.x = lhs.x + alpha * (rhs.x - lhs.x);\n\t\tthis.y = lhs.y + alpha * (rhs.y - lhs.y);\n\t\treturn this;\n\t}\n\tmul(rhs) {\n\t\tthis.x *= rhs.x;\n\t\tthis.y *= rhs.y;\n\t\treturn this;\n\t}\n\tmul2(lhs, rhs) {\n\t\tthis.x = lhs.x * rhs.x;\n\t\tthis.y = lhs.y * rhs.y;\n\t\treturn this;\n\t}\n\tmulScalar(scalar) {\n\t\tthis.x *= scalar;\n\t\tthis.y *= scalar;\n\t\treturn this;\n\t}\n\tnormalize(src = this) {\n\t\tconst lengthSq = src.x * src.x + src.y * src.y;\n\t\tif (lengthSq > 0) {\n\t\t\tconst invLength = 1 / Math.sqrt(lengthSq);\n\t\t\tthis.x = src.x * invLength;\n\t\t\tthis.y = src.y * invLength;\n\t\t}\n\t\treturn this;\n\t}\n\trotate(degrees) {\n\t\tconst angle = Math.atan2(this.x, this.y) + degrees * math.DEG_TO_RAD;\n\t\tconst len = Math.sqrt(this.x * this.x + this.y * this.y);\n\t\tthis.x = Math.sin(angle) * len;\n\t\tthis.y = Math.cos(angle) * len;\n\t\treturn this;\n\t}\n\tangle() {\n\t\treturn Math.atan2(this.x, this.y) * math.RAD_TO_DEG;\n\t}\n\tangleTo(rhs) {\n\t\treturn Math.atan2(this.x * rhs.y + this.y * rhs.x, this.x * rhs.x + this.y * rhs.y) * math.RAD_TO_DEG;\n\t}\n\tfloor(src = this) {\n\t\tthis.x = Math.floor(src.x);\n\t\tthis.y = Math.floor(src.y);\n\t\treturn this;\n\t}\n\tceil(src = this) {\n\t\tthis.x = Math.ceil(src.x);\n\t\tthis.y = Math.ceil(src.y);\n\t\treturn this;\n\t}\n\tround(src = this) {\n\t\tthis.x = Math.round(src.x);\n\t\tthis.y = Math.round(src.y);\n\t\treturn this;\n\t}\n\tmin(rhs) {\n\t\tif (rhs.x < this.x) this.x = rhs.x;\n\t\tif (rhs.y < this.y) this.y = rhs.y;\n\t\treturn this;\n\t}\n\tmax(rhs) {\n\t\tif (rhs.x > this.x) this.x = rhs.x;\n\t\tif (rhs.y > this.y) this.y = rhs.y;\n\t\treturn this;\n\t}\n\tset(x, y) {\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\treturn this;\n\t}\n\tsub(rhs) {\n\t\tthis.x -= rhs.x;\n\t\tthis.y -= rhs.y;\n\t\treturn this;\n\t}\n\tsub2(lhs, rhs) {\n\t\tthis.x = lhs.x - rhs.x;\n\t\tthis.y = lhs.y - rhs.y;\n\t\treturn this;\n\t}\n\tsubScalar(scalar) {\n\t\tthis.x -= scalar;\n\t\tthis.y -= scalar;\n\t\treturn this;\n\t}\n\ttoString() {\n\t\treturn `[${this.x}, ${this.y}]`;\n\t}\n\tstatic angleRad(lhs, rhs) {\n\t\treturn Math.atan2(lhs.x * rhs.y - lhs.y * rhs.x, lhs.x * rhs.x + lhs.y * rhs.y);\n\t}\n}\n_class = Vec2;\nVec2.ZERO = Object.freeze(new _class(0, 0));\nVec2.ONE = Object.freeze(new _class(1, 1));\nVec2.UP = Object.freeze(new _class(0, 1));\nVec2.DOWN = Object.freeze(new _class(0, -1));\nVec2.RIGHT = Object.freeze(new _class(1, 0));\nVec2.LEFT = Object.freeze(new _class(-1, 0));\n\nexport { Vec2 };\n","var _class;\nclass Vec4 {\n\tconstructor(x = 0, y = 0, z = 0, w = 0) {\n\t\tthis.x = void 0;\n\t\tthis.y = void 0;\n\t\tthis.z = void 0;\n\t\tthis.w = void 0;\n\t\tif (x.length === 4) {\n\t\t\tthis.x = x[0];\n\t\t\tthis.y = x[1];\n\t\t\tthis.z = x[2];\n\t\t\tthis.w = x[3];\n\t\t} else {\n\t\t\tthis.x = x;\n\t\t\tthis.y = y;\n\t\t\tthis.z = z;\n\t\t\tthis.w = w;\n\t\t}\n\t}\n\tadd(rhs) {\n\t\tthis.x += rhs.x;\n\t\tthis.y += rhs.y;\n\t\tthis.z += rhs.z;\n\t\tthis.w += rhs.w;\n\t\treturn this;\n\t}\n\tadd2(lhs, rhs) {\n\t\tthis.x = lhs.x + rhs.x;\n\t\tthis.y = lhs.y + rhs.y;\n\t\tthis.z = lhs.z + rhs.z;\n\t\tthis.w = lhs.w + rhs.w;\n\t\treturn this;\n\t}\n\taddScalar(scalar) {\n\t\tthis.x += scalar;\n\t\tthis.y += scalar;\n\t\tthis.z += scalar;\n\t\tthis.w += scalar;\n\t\treturn this;\n\t}\n\taddScaled(rhs, scalar) {\n\t\tthis.x += rhs.x * scalar;\n\t\tthis.y += rhs.y * scalar;\n\t\tthis.z += rhs.z * scalar;\n\t\tthis.w += rhs.w * scalar;\n\t\treturn this;\n\t}\n\tclone() {\n\t\tconst cstr = this.constructor;\n\t\treturn new cstr(this.x, this.y, this.z, this.w);\n\t}\n\tcopy(rhs) {\n\t\tthis.x = rhs.x;\n\t\tthis.y = rhs.y;\n\t\tthis.z = rhs.z;\n\t\tthis.w = rhs.w;\n\t\treturn this;\n\t}\n\tdiv(rhs) {\n\t\tthis.x /= rhs.x;\n\t\tthis.y /= rhs.y;\n\t\tthis.z /= rhs.z;\n\t\tthis.w /= rhs.w;\n\t\treturn this;\n\t}\n\tdiv2(lhs, rhs) {\n\t\tthis.x = lhs.x / rhs.x;\n\t\tthis.y = lhs.y / rhs.y;\n\t\tthis.z = lhs.z / rhs.z;\n\t\tthis.w = lhs.w / rhs.w;\n\t\treturn this;\n\t}\n\tdivScalar(scalar) {\n\t\tthis.x /= scalar;\n\t\tthis.y /= scalar;\n\t\tthis.z /= scalar;\n\t\tthis.w /= scalar;\n\t\treturn this;\n\t}\n\tdot(rhs) {\n\t\treturn this.x * rhs.x + this.y * rhs.y + this.z * rhs.z + this.w * rhs.w;\n\t}\n\tequals(rhs) {\n\t\treturn this.x === rhs.x && this.y === rhs.y && this.z === rhs.z && this.w === rhs.w;\n\t}\n\tequalsApprox(rhs, epsilon = 1e-6) {\n\t\treturn Math.abs(this.x - rhs.x) < epsilon && Math.abs(this.y - rhs.y) < epsilon && Math.abs(this.z - rhs.z) < epsilon && Math.abs(this.w - rhs.w) < epsilon;\n\t}\n\tlength() {\n\t\treturn Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w);\n\t}\n\tlengthSq() {\n\t\treturn this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w;\n\t}\n\tlerp(lhs, rhs, alpha) {\n\t\tthis.x = lhs.x + alpha * (rhs.x - lhs.x);\n\t\tthis.y = lhs.y + alpha * (rhs.y - lhs.y);\n\t\tthis.z = lhs.z + alpha * (rhs.z - lhs.z);\n\t\tthis.w = lhs.w + alpha * (rhs.w - lhs.w);\n\t\treturn this;\n\t}\n\tmul(rhs) {\n\t\tthis.x *= rhs.x;\n\t\tthis.y *= rhs.y;\n\t\tthis.z *= rhs.z;\n\t\tthis.w *= rhs.w;\n\t\treturn this;\n\t}\n\tmul2(lhs, rhs) {\n\t\tthis.x = lhs.x * rhs.x;\n\t\tthis.y = lhs.y * rhs.y;\n\t\tthis.z = lhs.z * rhs.z;\n\t\tthis.w = lhs.w * rhs.w;\n\t\treturn this;\n\t}\n\tmulScalar(scalar) {\n\t\tthis.x *= scalar;\n\t\tthis.y *= scalar;\n\t\tthis.z *= scalar;\n\t\tthis.w *= scalar;\n\t\treturn this;\n\t}\n\tnormalize(src = this) {\n\t\tconst lengthSq = src.x * src.x + src.y * src.y + src.z * src.z + src.w * src.w;\n\t\tif (lengthSq > 0) {\n\t\t\tconst invLength = 1 / Math.sqrt(lengthSq);\n\t\t\tthis.x = src.x * invLength;\n\t\t\tthis.y = src.y * invLength;\n\t\t\tthis.z = src.z * invLength;\n\t\t\tthis.w = src.w * invLength;\n\t\t}\n\t\treturn this;\n\t}\n\tfloor(src = this) {\n\t\tthis.x = Math.floor(src.x);\n\t\tthis.y = Math.floor(src.y);\n\t\tthis.z = Math.floor(src.z);\n\t\tthis.w = Math.floor(src.w);\n\t\treturn this;\n\t}\n\tceil(src = this) {\n\t\tthis.x = Math.ceil(src.x);\n\t\tthis.y = Math.ceil(src.y);\n\t\tthis.z = Math.ceil(src.z);\n\t\tthis.w = Math.ceil(src.w);\n\t\treturn this;\n\t}\n\tround(src = this) {\n\t\tthis.x = Math.round(src.x);\n\t\tthis.y = Math.round(src.y);\n\t\tthis.z = Math.round(src.z);\n\t\tthis.w = Math.round(src.w);\n\t\treturn this;\n\t}\n\tmin(rhs) {\n\t\tif (rhs.x < this.x) this.x = rhs.x;\n\t\tif (rhs.y < this.y) this.y = rhs.y;\n\t\tif (rhs.z < this.z) this.z = rhs.z;\n\t\tif (rhs.w < this.w) this.w = rhs.w;\n\t\treturn this;\n\t}\n\tmax(rhs) {\n\t\tif (rhs.x > this.x) this.x = rhs.x;\n\t\tif (rhs.y > this.y) this.y = rhs.y;\n\t\tif (rhs.z > this.z) this.z = rhs.z;\n\t\tif (rhs.w > this.w) this.w = rhs.w;\n\t\treturn this;\n\t}\n\tset(x, y, z, w) {\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.z = z;\n\t\tthis.w = w;\n\t\treturn this;\n\t}\n\tsub(rhs) {\n\t\tthis.x -= rhs.x;\n\t\tthis.y -= rhs.y;\n\t\tthis.z -= rhs.z;\n\t\tthis.w -= rhs.w;\n\t\treturn this;\n\t}\n\tsub2(lhs, rhs) {\n\t\tthis.x = lhs.x - rhs.x;\n\t\tthis.y = lhs.y - rhs.y;\n\t\tthis.z = lhs.z - rhs.z;\n\t\tthis.w = lhs.w - rhs.w;\n\t\treturn this;\n\t}\n\tsubScalar(scalar) {\n\t\tthis.x -= scalar;\n\t\tthis.y -= scalar;\n\t\tthis.z -= scalar;\n\t\tthis.w -= scalar;\n\t\treturn this;\n\t}\n\ttoString() {\n\t\treturn `[${this.x}, ${this.y}, ${this.z}, ${this.w}]`;\n\t}\n}\n_class = Vec4;\nVec4.ZERO = Object.freeze(new _class(0, 0, 0, 0));\nVec4.ONE = Object.freeze(new _class(1, 1, 1, 1));\n\nexport { Vec4 };\n","import { math } from './math.js';\nimport { Vec2 } from './vec2.js';\nimport { Vec3 } from './vec3.js';\nimport { Vec4 } from './vec4.js';\n\nvar _class;\nconst _halfSize = new Vec2();\nconst x = new Vec3();\nconst y = new Vec3();\nconst z = new Vec3();\nconst scale = new Vec3();\nclass Mat4 {\n\tconstructor() {\n\t\tthis.data = new Float32Array(16);\n\t\tthis.data[0] = this.data[5] = this.data[10] = this.data[15] = 1;\n\t}\n\tstatic _getPerspectiveHalfSize(halfSize, fov, aspect, znear, fovIsHorizontal) {\n\t\tif (fovIsHorizontal) {\n\t\t\thalfSize.x = znear * Math.tan(fov * Math.PI / 360);\n\t\t\thalfSize.y = halfSize.x / aspect;\n\t\t} else {\n\t\t\thalfSize.y = znear * Math.tan(fov * Math.PI / 360);\n\t\t\thalfSize.x = halfSize.y * aspect;\n\t\t}\n\t}\n\tadd2(lhs, rhs) {\n\t\tconst a = lhs.data,\n\t\t\tb = rhs.data,\n\t\t\tr = this.data;\n\t\tr[0] = a[0] + b[0];\n\t\tr[1] = a[1] + b[1];\n\t\tr[2] = a[2] + b[2];\n\t\tr[3] = a[3] + b[3];\n\t\tr[4] = a[4] + b[4];\n\t\tr[5] = a[5] + b[5];\n\t\tr[6] = a[6] + b[6];\n\t\tr[7] = a[7] + b[7];\n\t\tr[8] = a[8] + b[8];\n\t\tr[9] = a[9] + b[9];\n\t\tr[10] = a[10] + b[10];\n\t\tr[11] = a[11] + b[11];\n\t\tr[12] = a[12] + b[12];\n\t\tr[13] = a[13] + b[13];\n\t\tr[14] = a[14] + b[14];\n\t\tr[15] = a[15] + b[15];\n\t\treturn this;\n\t}\n\tadd(rhs) {\n\t\treturn this.add2(this, rhs);\n\t}\n\tclone() {\n\t\tconst cstr = this.constructor;\n\t\treturn new cstr().copy(this);\n\t}\n\tcopy(rhs) {\n\t\tconst src = rhs.data,\n\t\t\tdst = this.data;\n\t\tdst[0] = src[0];\n\t\tdst[1] = src[1];\n\t\tdst[2] = src[2];\n\t\tdst[3] = src[3];\n\t\tdst[4] = src[4];\n\t\tdst[5] = src[5];\n\t\tdst[6] = src[6];\n\t\tdst[7] = src[7];\n\t\tdst[8] = src[8];\n\t\tdst[9] = src[9];\n\t\tdst[10] = src[10];\n\t\tdst[11] = src[11];\n\t\tdst[12] = src[12];\n\t\tdst[13] = src[13];\n\t\tdst[14] = src[14];\n\t\tdst[15] = src[15];\n\t\treturn this;\n\t}\n\tequals(rhs) {\n\t\tconst l = this.data,\n\t\t\tr = rhs.data;\n\t\treturn l[0] === r[0] && l[1] === r[1] && l[2] === r[2] && l[3] === r[3] && l[4] === r[4] && l[5] === r[5] && l[6] === r[6] && l[7] === r[7] && l[8] === r[8] && l[9] === r[9] && l[10] === r[10] && l[11] === r[11] && l[12] === r[12] && l[13] === r[13] && l[14] === r[14] && l[15] === r[15];\n\t}\n\tisIdentity() {\n\t\tconst m = this.data;\n\t\treturn m[0] === 1 && m[1] === 0 && m[2] === 0 && m[3] === 0 && m[4] === 0 && m[5] === 1 && m[6] === 0 && m[7] === 0 && m[8] === 0 && m[9] === 0 && m[10] === 1 && m[11] === 0 && m[12] === 0 && m[13] === 0 && m[14] === 0 && m[15] === 1;\n\t}\n\tmul2(lhs, rhs) {\n\t\tconst a = lhs.data;\n\t\tconst b = rhs.data;\n\t\tconst r = this.data;\n\t\tconst a00 = a[0];\n\t\tconst a01 = a[1];\n\t\tconst a02 = a[2];\n\t\tconst a03 = a[3];\n\t\tconst a10 = a[4];\n\t\tconst a11 = a[5];\n\t\tconst a12 = a[6];\n\t\tconst a13 = a[7];\n\t\tconst a20 = a[8];\n\t\tconst a21 = a[9];\n\t\tconst a22 = a[10];\n\t\tconst a23 = a[11];\n\t\tconst a30 = a[12];\n\t\tconst a31 = a[13];\n\t\tconst a32 = a[14];\n\t\tconst a33 = a[15];\n\t\tlet b0, b1, b2, b3;\n\t\tb0 = b[0];\n\t\tb1 = b[1];\n\t\tb2 = b[2];\n\t\tb3 = b[3];\n\t\tr[0] = a00 * b0 + a10 * b1 + a20 * b2 + a30 * b3;\n\t\tr[1] = a01 * b0 + a11 * b1 + a21 * b2 + a31 * b3;\n\t\tr[2] = a02 * b0 + a12 * b1 + a22 * b2 + a32 * b3;\n\t\tr[3] = a03 * b0 + a13 * b1 + a23 * b2 + a33 * b3;\n\t\tb0 = b[4];\n\t\tb1 = b[5];\n\t\tb2 = b[6];\n\t\tb3 = b[7];\n\t\tr[4] = a00 * b0 + a10 * b1 + a20 * b2 + a30 * b3;\n\t\tr[5] = a01 * b0 + a11 * b1 + a21 * b2 + a31 * b3;\n\t\tr[6] = a02 * b0 + a12 * b1 + a22 * b2 + a32 * b3;\n\t\tr[7] = a03 * b0 + a13 * b1 + a23 * b2 + a33 * b3;\n\t\tb0 = b[8];\n\t\tb1 = b[9];\n\t\tb2 = b[10];\n\t\tb3 = b[11];\n\t\tr[8] = a00 * b0 + a10 * b1 + a20 * b2 + a30 * b3;\n\t\tr[9] = a01 * b0 + a11 * b1 + a21 * b2 + a31 * b3;\n\t\tr[10] = a02 * b0 + a12 * b1 + a22 * b2 + a32 * b3;\n\t\tr[11] = a03 * b0 + a13 * b1 + a23 * b2 + a33 * b3;\n\t\tb0 = b[12];\n\t\tb1 = b[13];\n\t\tb2 = b[14];\n\t\tb3 = b[15];\n\t\tr[12] = a00 * b0 + a10 * b1 + a20 * b2 + a30 * b3;\n\t\tr[13] = a01 * b0 + a11 * b1 + a21 * b2 + a31 * b3;\n\t\tr[14] = a02 * b0 + a12 * b1 + a22 * b2 + a32 * b3;\n\t\tr[15] = a03 * b0 + a13 * b1 + a23 * b2 + a33 * b3;\n\t\treturn this;\n\t}\n\tmulAffine2(lhs, rhs) {\n\t\tconst a = lhs.data;\n\t\tconst b = rhs.data;\n\t\tconst r = this.data;\n\t\tconst a00 = a[0];\n\t\tconst a01 = a[1];\n\t\tconst a02 = a[2];\n\t\tconst a10 = a[4];\n\t\tconst a11 = a[5];\n\t\tconst a12 = a[6];\n\t\tconst a20 = a[8];\n\t\tconst a21 = a[9];\n\t\tconst a22 = a[10];\n\t\tconst a30 = a[12];\n\t\tconst a31 = a[13];\n\t\tconst a32 = a[14];\n\t\tlet b0, b1, b2;\n\t\tb0 = b[0];\n\t\tb1 = b[1];\n\t\tb2 = b[2];\n\t\tr[0] = a00 * b0 + a10 * b1 + a20 * b2;\n\t\tr[1] = a01 * b0 + a11 * b1 + a21 * b2;\n\t\tr[2] = a02 * b0 + a12 * b1 + a22 * b2;\n\t\tr[3] = 0;\n\t\tb0 = b[4];\n\t\tb1 = b[5];\n\t\tb2 = b[6];\n\t\tr[4] = a00 * b0 + a10 * b1 + a20 * b2;\n\t\tr[5] = a01 * b0 + a11 * b1 + a21 * b2;\n\t\tr[6] = a02 * b0 + a12 * b1 + a22 * b2;\n\t\tr[7] = 0;\n\t\tb0 = b[8];\n\t\tb1 = b[9];\n\t\tb2 = b[10];\n\t\tr[8] = a00 * b0 + a10 * b1 + a20 * b2;\n\t\tr[9] = a01 * b0 + a11 * b1 + a21 * b2;\n\t\tr[10] = a02 * b0 + a12 * b1 + a22 * b2;\n\t\tr[11] = 0;\n\t\tb0 = b[12];\n\t\tb1 = b[13];\n\t\tb2 = b[14];\n\t\tr[12] = a00 * b0 + a10 * b1 + a20 * b2 + a30;\n\t\tr[13] = a01 * b0 + a11 * b1 + a21 * b2 + a31;\n\t\tr[14] = a02 * b0 + a12 * b1 + a22 * b2 + a32;\n\t\tr[15] = 1;\n\t\treturn this;\n\t}\n\tmul(rhs) {\n\t\treturn this.mul2(this, rhs);\n\t}\n\ttransformPoint(vec, res = new Vec3()) {\n\t\tconst m = this.data;\n\t\tconst x = vec.x;\n\t\tconst y = vec.y;\n\t\tconst z = vec.z;\n\t\tres.x = x * m[0] + y * m[4] + z * m[8] + m[12];\n\t\tres.y = x * m[1] + y * m[5] + z * m[9] + m[13];\n\t\tres.z = x * m[2] + y * m[6] + z * m[10] + m[14];\n\t\treturn res;\n\t}\n\ttransformVector(vec, res = new Vec3()) {\n\t\tconst m = this.data;\n\t\tconst x = vec.x;\n\t\tconst y = vec.y;\n\t\tconst z = vec.z;\n\t\tres.x = x * m[0] + y * m[4] + z * m[8];\n\t\tres.y = x * m[1] + y * m[5] + z * m[9];\n\t\tres.z = x * m[2] + y * m[6] + z * m[10];\n\t\treturn res;\n\t}\n\ttransformVec4(vec, res = new Vec4()) {\n\t\tconst m = this.data;\n\t\tconst x = vec.x;\n\t\tconst y = vec.y;\n\t\tconst z = vec.z;\n\t\tconst w = vec.w;\n\t\tres.x = x * m[0] + y * m[4] + z * m[8] + w * m[12];\n\t\tres.y = x * m[1] + y * m[5] + z * m[9] + w * m[13];\n\t\tres.z = x * m[2] + y * m[6] + z * m[10] + w * m[14];\n\t\tres.w = x * m[3] + y * m[7] + z * m[11] + w * m[15];\n\t\treturn res;\n\t}\n\tsetLookAt(position, target, up) {\n\t\tz.sub2(position, target).normalize();\n\t\ty.copy(up).normalize();\n\t\tx.cross(y, z).normalize();\n\t\ty.cross(z, x);\n\t\tconst r = this.data;\n\t\tr[0] = x.x;\n\t\tr[1] = x.y;\n\t\tr[2] = x.z;\n\t\tr[3] = 0;\n\t\tr[4] = y.x;\n\t\tr[5] = y.y;\n\t\tr[6] = y.z;\n\t\tr[7] = 0;\n\t\tr[8] = z.x;\n\t\tr[9] = z.y;\n\t\tr[10] = z.z;\n\t\tr[11] = 0;\n\t\tr[12] = position.x;\n\t\tr[13] = position.y;\n\t\tr[14] = position.z;\n\t\tr[15] = 1;\n\t\treturn this;\n\t}\n\tsetFrustum(left, right, bottom, top, znear, zfar) {\n\t\tconst temp1 = 2 * znear;\n\t\tconst temp2 = right - left;\n\t\tconst temp3 = top - bottom;\n\t\tconst temp4 = zfar - znear;\n\t\tconst r = this.data;\n\t\tr[0] = temp1 / temp2;\n\t\tr[1] = 0;\n\t\tr[2] = 0;\n\t\tr[3] = 0;\n\t\tr[4] = 0;\n\t\tr[5] = temp1 / temp3;\n\t\tr[6] = 0;\n\t\tr[7] = 0;\n\t\tr[8] = (right + left) / temp2;\n\t\tr[9] = (top + bottom) / temp3;\n\t\tr[10] = (-zfar - znear) / temp4;\n\t\tr[11] = -1;\n\t\tr[12] = 0;\n\t\tr[13] = 0;\n\t\tr[14] = -temp1 * zfar / temp4;\n\t\tr[15] = 0;\n\t\treturn this;\n\t}\n\tsetPerspective(fov, aspect, znear, zfar, fovIsHorizontal) {\n\t\tMat4._getPerspectiveHalfSize(_halfSize, fov, aspect, znear, fovIsHorizontal);\n\t\treturn this.setFrustum(-_halfSize.x, _halfSize.x, -_halfSize.y, _halfSize.y, znear, zfar);\n\t}\n\tsetOrtho(left, right, bottom, top, near, far) {\n\t\tconst r = this.data;\n\t\tr[0] = 2 / (right - left);\n\t\tr[1] = 0;\n\t\tr[2] = 0;\n\t\tr[3] = 0;\n\t\tr[4] = 0;\n\t\tr[5] = 2 / (top - bottom);\n\t\tr[6] = 0;\n\t\tr[7] = 0;\n\t\tr[8] = 0;\n\t\tr[9] = 0;\n\t\tr[10] = -2 / (far - near);\n\t\tr[11] = 0;\n\t\tr[12] = -(right + left) / (right - left);\n\t\tr[13] = -(top + bottom) / (top - bottom);\n\t\tr[14] = -(far + near) / (far - near);\n\t\tr[15] = 1;\n\t\treturn this;\n\t}\n\tsetFromAxisAngle(axis, angle) {\n\t\tangle *= math.DEG_TO_RAD;\n\t\tconst x = axis.x;\n\t\tconst y = axis.y;\n\t\tconst z = axis.z;\n\t\tconst c = Math.cos(angle);\n\t\tconst s = Math.sin(angle);\n\t\tconst t = 1 - c;\n\t\tconst tx = t * x;\n\t\tconst ty = t * y;\n\t\tconst m = this.data;\n\t\tm[0] = tx * x + c;\n\t\tm[1] = tx * y + s * z;\n\t\tm[2] = tx * z - s * y;\n\t\tm[3] = 0;\n\t\tm[4] = tx * y - s * z;\n\t\tm[5] = ty * y + c;\n\t\tm[6] = ty * z + s * x;\n\t\tm[7] = 0;\n\t\tm[8] = tx * z + s * y;\n\t\tm[9] = ty * z - x * s;\n\t\tm[10] = t * z * z + c;\n\t\tm[11] = 0;\n\t\tm[12] = 0;\n\t\tm[13] = 0;\n\t\tm[14] = 0;\n\t\tm[15] = 1;\n\t\treturn this;\n\t}\n\tsetTranslate(x, y, z) {\n\t\tconst m = this.data;\n\t\tm[0] = 1;\n\t\tm[1] = 0;\n\t\tm[2] = 0;\n\t\tm[3] = 0;\n\t\tm[4] = 0;\n\t\tm[5] = 1;\n\t\tm[6] = 0;\n\t\tm[7] = 0;\n\t\tm[8] = 0;\n\t\tm[9] = 0;\n\t\tm[10] = 1;\n\t\tm[11] = 0;\n\t\tm[12] = x;\n\t\tm[13] = y;\n\t\tm[14] = z;\n\t\tm[15] = 1;\n\t\treturn this;\n\t}\n\tsetScale(x, y, z) {\n\t\tconst m = this.data;\n\t\tm[0] = x;\n\t\tm[1] = 0;\n\t\tm[2] = 0;\n\t\tm[3] = 0;\n\t\tm[4] = 0;\n\t\tm[5] = y;\n\t\tm[6] = 0;\n\t\tm[7] = 0;\n\t\tm[8] = 0;\n\t\tm[9] = 0;\n\t\tm[10] = z;\n\t\tm[11] = 0;\n\t\tm[12] = 0;\n\t\tm[13] = 0;\n\t\tm[14] = 0;\n\t\tm[15] = 1;\n\t\treturn this;\n\t}\n\tsetViewport(x, y, width, height) {\n\t\tconst m = this.data;\n\t\tm[0] = width * 0.5;\n\t\tm[1] = 0;\n\t\tm[2] = 0;\n\t\tm[3] = 0;\n\t\tm[4] = 0;\n\t\tm[5] = height * 0.5;\n\t\tm[6] = 0;\n\t\tm[7] = 0;\n\t\tm[8] = 0;\n\t\tm[9] = 0;\n\t\tm[10] = 0.5;\n\t\tm[11] = 0;\n\t\tm[12] = x + width * 0.5;\n\t\tm[13] = y + height * 0.5;\n\t\tm[14] = 0.5;\n\t\tm[15] = 1;\n\t\treturn this;\n\t}\n\tsetReflection(normal, distance) {\n\t\tconst a = normal.x;\n\t\tconst b = normal.y;\n\t\tconst c = normal.z;\n\t\tconst data = this.data;\n\t\tdata[0] = 1.0 - 2 * a * a;\n\t\tdata[1] = -2 * a * b;\n\t\tdata[2] = -2 * a * c;\n\t\tdata[3] = 0;\n\t\tdata[4] = -2 * a * b;\n\t\tdata[5] = 1.0 - 2 * b * b;\n\t\tdata[6] = -2 * b * c;\n\t\tdata[7] = 0;\n\t\tdata[8] = -2 * a * c;\n\t\tdata[9] = -2 * b * c;\n\t\tdata[10] = 1.0 - 2 * c * c;\n\t\tdata[11] = 0;\n\t\tdata[12] = -2 * a * distance;\n\t\tdata[13] = -2 * b * distance;\n\t\tdata[14] = -2 * c * distance;\n\t\tdata[15] = 1;\n\t\treturn this;\n\t}\n\tinvert(src = this) {\n\t\tconst s = src.data;\n\t\tconst a00 = s[0];\n\t\tconst a01 = s[1];\n\t\tconst a02 = s[2];\n\t\tconst a03 = s[3];\n\t\tconst a10 = s[4];\n\t\tconst a11 = s[5];\n\t\tconst a12 = s[6];\n\t\tconst a13 = s[7];\n\t\tconst a20 = s[8];\n\t\tconst a21 = s[9];\n\t\tconst a22 = s[10];\n\t\tconst a23 = s[11];\n\t\tconst a30 = s[12];\n\t\tconst a31 = s[13];\n\t\tconst a32 = s[14];\n\t\tconst a33 = s[15];\n\t\tconst b00 = a00 * a11 - a01 * a10;\n\t\tconst b01 = a00 * a12 - a02 * a10;\n\t\tconst b02 = a00 * a13 - a03 * a10;\n\t\tconst b03 = a01 * a12 - a02 * a11;\n\t\tconst b04 = a01 * a13 - a03 * a11;\n\t\tconst b05 = a02 * a13 - a03 * a12;\n\t\tconst b06 = a20 * a31 - a21 * a30;\n\t\tconst b07 = a20 * a32 - a22 * a30;\n\t\tconst b08 = a20 * a33 - a23 * a30;\n\t\tconst b09 = a21 * a32 - a22 * a31;\n\t\tconst b10 = a21 * a33 - a23 * a31;\n\t\tconst b11 = a22 * a33 - a23 * a32;\n\t\tconst det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\t\tif (det === 0) {\n\t\t\tthis.setIdentity();\n\t\t} else {\n\t\t\tconst invDet = 1 / det;\n\t\t\tconst t = this.data;\n\t\t\tt[0] = (a11 * b11 - a12 * b10 + a13 * b09) * invDet;\n\t\t\tt[1] = (-a01 * b11 + a02 * b10 - a03 * b09) * invDet;\n\t\t\tt[2] = (a31 * b05 - a32 * b04 + a33 * b03) * invDet;\n\t\t\tt[3] = (-a21 * b05 + a22 * b04 - a23 * b03) * invDet;\n\t\t\tt[4] = (-a10 * b11 + a12 * b08 - a13 * b07) * invDet;\n\t\t\tt[5] = (a00 * b11 - a02 * b08 + a03 * b07) * invDet;\n\t\t\tt[6] = (-a30 * b05 + a32 * b02 - a33 * b01) * invDet;\n\t\t\tt[7] = (a20 * b05 - a22 * b02 + a23 * b01) * invDet;\n\t\t\tt[8] = (a10 * b10 - a11 * b08 + a13 * b06) * invDet;\n\t\t\tt[9] = (-a00 * b10 + a01 * b08 - a03 * b06) * invDet;\n\t\t\tt[10] = (a30 * b04 - a31 * b02 + a33 * b00) * invDet;\n\t\t\tt[11] = (-a20 * b04 + a21 * b02 - a23 * b00) * invDet;\n\t\t\tt[12] = (-a10 * b09 + a11 * b07 - a12 * b06) * invDet;\n\t\t\tt[13] = (a00 * b09 - a01 * b07 + a02 * b06) * invDet;\n\t\t\tt[14] = (-a30 * b03 + a31 * b01 - a32 * b00) * invDet;\n\t\t\tt[15] = (a20 * b03 - a21 * b01 + a22 * b00) * invDet;\n\t\t}\n\t\treturn this;\n\t}\n\tset(src) {\n\t\tconst dst = this.data;\n\t\tdst[0] = src[0];\n\t\tdst[1] = src[1];\n\t\tdst[2] = src[2];\n\t\tdst[3] = src[3];\n\t\tdst[4] = src[4];\n\t\tdst[5] = src[5];\n\t\tdst[6] = src[6];\n\t\tdst[7] = src[7];\n\t\tdst[8] = src[8];\n\t\tdst[9] = src[9];\n\t\tdst[10] = src[10];\n\t\tdst[11] = src[11];\n\t\tdst[12] = src[12];\n\t\tdst[13] = src[13];\n\t\tdst[14] = src[14];\n\t\tdst[15] = src[15];\n\t\treturn this;\n\t}\n\tsetIdentity() {\n\t\tconst m = this.data;\n\t\tm[0] = 1;\n\t\tm[1] = 0;\n\t\tm[2] = 0;\n\t\tm[3] = 0;\n\t\tm[4] = 0;\n\t\tm[5] = 1;\n\t\tm[6] = 0;\n\t\tm[7] = 0;\n\t\tm[8] = 0;\n\t\tm[9] = 0;\n\t\tm[10] = 1;\n\t\tm[11] = 0;\n\t\tm[12] = 0;\n\t\tm[13] = 0;\n\t\tm[14] = 0;\n\t\tm[15] = 1;\n\t\treturn this;\n\t}\n\tsetTRS(t, r, s) {\n\t\tconst qx = r.x;\n\t\tconst qy = r.y;\n\t\tconst qz = r.z;\n\t\tconst qw = r.w;\n\t\tconst sx = s.x;\n\t\tconst sy = s.y;\n\t\tconst sz = s.z;\n\t\tconst x2 = qx + qx;\n\t\tconst y2 = qy + qy;\n\t\tconst z2 = qz + qz;\n\t\tconst xx = qx * x2;\n\t\tconst xy = qx * y2;\n\t\tconst xz = qx * z2;\n\t\tconst yy = qy * y2;\n\t\tconst yz = qy * z2;\n\t\tconst zz = qz * z2;\n\t\tconst wx = qw * x2;\n\t\tconst wy = qw * y2;\n\t\tconst wz = qw * z2;\n\t\tconst m = this.data;\n\t\tm[0] = (1 - (yy + zz)) * sx;\n\t\tm[1] = (xy + wz) * sx;\n\t\tm[2] = (xz - wy) * sx;\n\t\tm[3] = 0;\n\t\tm[4] = (xy - wz) * sy;\n\t\tm[5] = (1 - (xx + zz)) * sy;\n\t\tm[6] = (yz + wx) * sy;\n\t\tm[7] = 0;\n\t\tm[8] = (xz + wy) * sz;\n\t\tm[9] = (yz - wx) * sz;\n\t\tm[10] = (1 - (xx + yy)) * sz;\n\t\tm[11] = 0;\n\t\tm[12] = t.x;\n\t\tm[13] = t.y;\n\t\tm[14] = t.z;\n\t\tm[15] = 1;\n\t\treturn this;\n\t}\n\ttranspose(src = this) {\n\t\tconst s = src.data;\n\t\tconst t = this.data;\n\t\tif (s === t) {\n\t\t\tlet tmp;\n\t\t\ttmp = s[1];\n\t\t\tt[1] = s[4];\n\t\t\tt[4] = tmp;\n\t\t\ttmp = s[2];\n\t\t\tt[2] = s[8];\n\t\t\tt[8] = tmp;\n\t\t\ttmp = s[3];\n\t\t\tt[3] = s[12];\n\t\t\tt[12] = tmp;\n\t\t\ttmp = s[6];\n\t\t\tt[6] = s[9];\n\t\t\tt[9] = tmp;\n\t\t\ttmp = s[7];\n\t\t\tt[7] = s[13];\n\t\t\tt[13] = tmp;\n\t\t\ttmp = s[11];\n\t\t\tt[11] = s[14];\n\t\t\tt[14] = tmp;\n\t\t} else {\n\t\t\tt[0] = s[0];\n\t\t\tt[1] = s[4];\n\t\t\tt[2] = s[8];\n\t\t\tt[3] = s[12];\n\t\t\tt[4] = s[1];\n\t\t\tt[5] = s[5];\n\t\t\tt[6] = s[9];\n\t\t\tt[7] = s[13];\n\t\t\tt[8] = s[2];\n\t\t\tt[9] = s[6];\n\t\t\tt[10] = s[10];\n\t\t\tt[11] = s[14];\n\t\t\tt[12] = s[3];\n\t\t\tt[13] = s[7];\n\t\t\tt[14] = s[11];\n\t\t\tt[15] = s[15];\n\t\t}\n\t\treturn this;\n\t}\n\tgetTranslation(t = new Vec3()) {\n\t\treturn t.set(this.data[12], this.data[13], this.data[14]);\n\t}\n\tgetX(x = new Vec3()) {\n\t\treturn x.set(this.data[0], this.data[1], this.data[2]);\n\t}\n\tgetY(y = new Vec3()) {\n\t\treturn y.set(this.data[4], this.data[5], this.data[6]);\n\t}\n\tgetZ(z = new Vec3()) {\n\t\treturn z.set(this.data[8], this.data[9], this.data[10]);\n\t}\n\tgetScale(scale = new Vec3()) {\n\t\tthis.getX(x);\n\t\tthis.getY(y);\n\t\tthis.getZ(z);\n\t\tscale.set(x.length(), y.length(), z.length());\n\t\treturn scale;\n\t}\n\tget scaleSign() {\n\t\tthis.getX(x);\n\t\tthis.getY(y);\n\t\tthis.getZ(z);\n\t\tx.cross(x, y);\n\t\treturn x.dot(z) < 0 ? -1 : 1;\n\t}\n\tsetFromEulerAngles(ex, ey, ez) {\n\t\tex *= math.DEG_TO_RAD;\n\t\tey *= math.DEG_TO_RAD;\n\t\tez *= math.DEG_TO_RAD;\n\t\tconst s1 = Math.sin(-ex);\n\t\tconst c1 = Math.cos(-ex);\n\t\tconst s2 = Math.sin(-ey);\n\t\tconst c2 = Math.cos(-ey);\n\t\tconst s3 = Math.sin(-ez);\n\t\tconst c3 = Math.cos(-ez);\n\t\tconst m = this.data;\n\t\tm[0] = c2 * c3;\n\t\tm[1] = -c2 * s3;\n\t\tm[2] = s2;\n\t\tm[3] = 0;\n\t\tm[4] = c1 * s3 + c3 * s1 * s2;\n\t\tm[5] = c1 * c3 - s1 * s2 * s3;\n\t\tm[6] = -c2 * s1;\n\t\tm[7] = 0;\n\t\tm[8] = s1 * s3 - c1 * c3 * s2;\n\t\tm[9] = c3 * s1 + c1 * s2 * s3;\n\t\tm[10] = c1 * c2;\n\t\tm[11] = 0;\n\t\tm[12] = 0;\n\t\tm[13] = 0;\n\t\tm[14] = 0;\n\t\tm[15] = 1;\n\t\treturn this;\n\t}\n\tgetEulerAngles(eulers = new Vec3()) {\n\t\tthis.getScale(scale);\n\t\tconst sx = scale.x;\n\t\tconst sy = scale.y;\n\t\tconst sz = scale.z;\n\t\tif (sx === 0 || sy === 0 || sz === 0) return eulers.set(0, 0, 0);\n\t\tconst m = this.data;\n\t\tconst y = Math.asin(-m[2] / sx);\n\t\tconst halfPi = Math.PI * 0.5;\n\t\tlet x, z;\n\t\tif (y < halfPi) {\n\t\t\tif (y > -halfPi) {\n\t\t\t\tx = Math.atan2(m[6] / sy, m[10] / sz);\n\t\t\t\tz = Math.atan2(m[1] / sx, m[0] / sx);\n\t\t\t} else {\n\t\t\t\tz = 0;\n\t\t\t\tx = -Math.atan2(m[4] / sy, m[5] / sy);\n\t\t\t}\n\t\t} else {\n\t\t\tz = 0;\n\t\t\tx = Math.atan2(m[4] / sy, m[5] / sy);\n\t\t}\n\t\treturn eulers.set(x, y, z).mulScalar(math.RAD_TO_DEG);\n\t}\n\ttoString() {\n\t\treturn '[' + this.data.join(', ') + ']';\n\t}\n}\n_class = Mat4;\nMat4.IDENTITY = Object.freeze(new _class());\nMat4.ZERO = Object.freeze(new _class().set([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]));\n\nexport { Mat4 };\n","import { math } from './math.js';\nimport { Vec3 } from './vec3.js';\n\nvar _class;\nclass Quat {\n\tconstructor(x = 0, y = 0, z = 0, w = 1) {\n\t\tthis.x = void 0;\n\t\tthis.y = void 0;\n\t\tthis.z = void 0;\n\t\tthis.w = void 0;\n\t\tif (x.length === 4) {\n\t\t\tthis.x = x[0];\n\t\t\tthis.y = x[1];\n\t\t\tthis.z = x[2];\n\t\t\tthis.w = x[3];\n\t\t} else {\n\t\t\tthis.x = x;\n\t\t\tthis.y = y;\n\t\t\tthis.z = z;\n\t\t\tthis.w = w;\n\t\t}\n\t}\n\tclone() {\n\t\tconst cstr = this.constructor;\n\t\treturn new cstr(this.x, this.y, this.z, this.w);\n\t}\n\tconjugate(src = this) {\n\t\tthis.x = src.x * -1;\n\t\tthis.y = src.y * -1;\n\t\tthis.z = src.z * -1;\n\t\tthis.w = src.w;\n\t\treturn this;\n\t}\n\tcopy(rhs) {\n\t\tthis.x = rhs.x;\n\t\tthis.y = rhs.y;\n\t\tthis.z = rhs.z;\n\t\tthis.w = rhs.w;\n\t\treturn this;\n\t}\n\tequals(rhs) {\n\t\treturn this.x === rhs.x && this.y === rhs.y && this.z === rhs.z && this.w === rhs.w;\n\t}\n\tequalsApprox(rhs, epsilon = 1e-6) {\n\t\treturn Math.abs(this.x - rhs.x) < epsilon && Math.abs(this.y - rhs.y) < epsilon && Math.abs(this.z - rhs.z) < epsilon && Math.abs(this.w - rhs.w) < epsilon;\n\t}\n\tgetAxisAngle(axis) {\n\t\tlet rad = Math.acos(this.w) * 2;\n\t\tconst s = Math.sin(rad / 2);\n\t\tif (s !== 0) {\n\t\t\taxis.x = this.x / s;\n\t\t\taxis.y = this.y / s;\n\t\t\taxis.z = this.z / s;\n\t\t\tif (axis.x < 0 || axis.y < 0 || axis.z < 0) {\n\t\t\t\taxis.x *= -1;\n\t\t\t\taxis.y *= -1;\n\t\t\t\taxis.z *= -1;\n\t\t\t\trad *= -1;\n\t\t\t}\n\t\t} else {\n\t\t\taxis.x = 1;\n\t\t\taxis.y = 0;\n\t\t\taxis.z = 0;\n\t\t}\n\t\treturn rad * math.RAD_TO_DEG;\n\t}\n\tgetEulerAngles(eulers = new Vec3()) {\n\t\tlet x, y, z;\n\t\tconst qx = this.x;\n\t\tconst qy = this.y;\n\t\tconst qz = this.z;\n\t\tconst qw = this.w;\n\t\tconst a2 = 2 * (qw * qy - qx * qz);\n\t\tif (a2 <= -0.99999) {\n\t\t\tx = 2 * Math.atan2(qx, qw);\n\t\t\ty = -Math.PI / 2;\n\t\t\tz = 0;\n\t\t} else if (a2 >= 0.99999) {\n\t\t\tx = 2 * Math.atan2(qx, qw);\n\t\t\ty = Math.PI / 2;\n\t\t\tz = 0;\n\t\t} else {\n\t\t\tx = Math.atan2(2 * (qw * qx + qy * qz), 1 - 2 * (qx * qx + qy * qy));\n\t\t\ty = Math.asin(a2);\n\t\t\tz = Math.atan2(2 * (qw * qz + qx * qy), 1 - 2 * (qy * qy + qz * qz));\n\t\t}\n\t\treturn eulers.set(x, y, z).mulScalar(math.RAD_TO_DEG);\n\t}\n\tinvert(src = this) {\n\t\treturn this.conjugate(src).normalize();\n\t}\n\tlength() {\n\t\treturn Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w);\n\t}\n\tlengthSq() {\n\t\treturn this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w;\n\t}\n\tmul(rhs) {\n\t\tconst q1x = this.x;\n\t\tconst q1y = this.y;\n\t\tconst q1z = this.z;\n\t\tconst q1w = this.w;\n\t\tconst q2x = rhs.x;\n\t\tconst q2y = rhs.y;\n\t\tconst q2z = rhs.z;\n\t\tconst q2w = rhs.w;\n\t\tthis.x = q1w * q2x + q1x * q2w + q1y * q2z - q1z * q2y;\n\t\tthis.y = q1w * q2y + q1y * q2w + q1z * q2x - q1x * q2z;\n\t\tthis.z = q1w * q2z + q1z * q2w + q1x * q2y - q1y * q2x;\n\t\tthis.w = q1w * q2w - q1x * q2x - q1y * q2y - q1z * q2z;\n\t\treturn this;\n\t}\n\tmul2(lhs, rhs) {\n\t\tconst q1x = lhs.x;\n\t\tconst q1y = lhs.y;\n\t\tconst q1z = lhs.z;\n\t\tconst q1w = lhs.w;\n\t\tconst q2x = rhs.x;\n\t\tconst q2y = rhs.y;\n\t\tconst q2z = rhs.z;\n\t\tconst q2w = rhs.w;\n\t\tthis.x = q1w * q2x + q1x * q2w + q1y * q2z - q1z * q2y;\n\t\tthis.y = q1w * q2y + q1y * q2w + q1z * q2x - q1x * q2z;\n\t\tthis.z = q1w * q2z + q1z * q2w + q1x * q2y - q1y * q2x;\n\t\tthis.w = q1w * q2w - q1x * q2x - q1y * q2y - q1z * q2z;\n\t\treturn this;\n\t}\n\tnormalize(src = this) {\n\t\tlet len = src.length();\n\t\tif (len === 0) {\n\t\t\tthis.x = this.y = this.z = 0;\n\t\t\tthis.w = 1;\n\t\t} else {\n\t\t\tlen = 1 / len;\n\t\t\tthis.x = src.x * len;\n\t\t\tthis.y = src.y * len;\n\t\t\tthis.z = src.z * len;\n\t\t\tthis.w = src.w * len;\n\t\t}\n\t\treturn this;\n\t}\n\tset(x, y, z, w) {\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.z = z;\n\t\tthis.w = w;\n\t\treturn this;\n\t}\n\tsetFromAxisAngle(axis, angle) {\n\t\tangle *= 0.5 * math.DEG_TO_RAD;\n\t\tconst sa = Math.sin(angle);\n\t\tconst ca = Math.cos(angle);\n\t\tthis.x = sa * axis.x;\n\t\tthis.y = sa * axis.y;\n\t\tthis.z = sa * axis.z;\n\t\tthis.w = ca;\n\t\treturn this;\n\t}\n\tsetFromEulerAngles(ex, ey, ez) {\n\t\tif (ex instanceof Vec3) {\n\t\t\tconst vec = ex;\n\t\t\tex = vec.x;\n\t\t\tey = vec.y;\n\t\t\tez = vec.z;\n\t\t}\n\t\tconst halfToRad = 0.5 * math.DEG_TO_RAD;\n\t\tex *= halfToRad;\n\t\tey *= halfToRad;\n\t\tez *= halfToRad;\n\t\tconst sx = Math.sin(ex);\n\t\tconst cx = Math.cos(ex);\n\t\tconst sy = Math.sin(ey);\n\t\tconst cy = Math.cos(ey);\n\t\tconst sz = Math.sin(ez);\n\t\tconst cz = Math.cos(ez);\n\t\tthis.x = sx * cy * cz - cx * sy * sz;\n\t\tthis.y = cx * sy * cz + sx * cy * sz;\n\t\tthis.z = cx * cy * sz - sx * sy * cz;\n\t\tthis.w = cx * cy * cz + sx * sy * sz;\n\t\treturn this;\n\t}\n\tsetFromMat4(m) {\n\t\tlet m00, m01, m02, m10, m11, m12, m20, m21, m22, s, rs, lx, ly, lz;\n\t\tm = m.data;\n\t\tm00 = m[0];\n\t\tm01 = m[1];\n\t\tm02 = m[2];\n\t\tm10 = m[4];\n\t\tm11 = m[5];\n\t\tm12 = m[6];\n\t\tm20 = m[8];\n\t\tm21 = m[9];\n\t\tm22 = m[10];\n\t\tlx = m00 * m00 + m01 * m01 + m02 * m02;\n\t\tif (lx === 0) return this;\n\t\tlx = 1 / Math.sqrt(lx);\n\t\tly = m10 * m10 + m11 * m11 + m12 * m12;\n\t\tif (ly === 0) return this;\n\t\tly = 1 / Math.sqrt(ly);\n\t\tlz = m20 * m20 + m21 * m21 + m22 * m22;\n\t\tif (lz === 0) return this;\n\t\tlz = 1 / Math.sqrt(lz);\n\t\tm00 *= lx;\n\t\tm01 *= lx;\n\t\tm02 *= lx;\n\t\tm10 *= ly;\n\t\tm11 *= ly;\n\t\tm12 *= ly;\n\t\tm20 *= lz;\n\t\tm21 *= lz;\n\t\tm22 *= lz;\n\t\tconst tr = m00 + m11 + m22;\n\t\tif (tr >= 0) {\n\t\t\ts = Math.sqrt(tr + 1);\n\t\t\tthis.w = s * 0.5;\n\t\t\ts = 0.5 / s;\n\t\t\tthis.x = (m12 - m21) * s;\n\t\t\tthis.y = (m20 - m02) * s;\n\t\t\tthis.z = (m01 - m10) * s;\n\t\t} else {\n\t\t\tif (m00 > m11) {\n\t\t\t\tif (m00 > m22) {\n\t\t\t\t\trs = m00 - (m11 + m22) + 1;\n\t\t\t\t\trs = Math.sqrt(rs);\n\t\t\t\t\tthis.x = rs * 0.5;\n\t\t\t\t\trs = 0.5 / rs;\n\t\t\t\t\tthis.w = (m12 - m21) * rs;\n\t\t\t\t\tthis.y = (m01 + m10) * rs;\n\t\t\t\t\tthis.z = (m02 + m20) * rs;\n\t\t\t\t} else {\n\t\t\t\t\trs = m22 - (m00 + m11) + 1;\n\t\t\t\t\trs = Math.sqrt(rs);\n\t\t\t\t\tthis.z = rs * 0.5;\n\t\t\t\t\trs = 0.5 / rs;\n\t\t\t\t\tthis.w = (m01 - m10) * rs;\n\t\t\t\t\tthis.x = (m20 + m02) * rs;\n\t\t\t\t\tthis.y = (m21 + m12) * rs;\n\t\t\t\t}\n\t\t\t} else if (m11 > m22) {\n\t\t\t\trs = m11 - (m22 + m00) + 1;\n\t\t\t\trs = Math.sqrt(rs);\n\t\t\t\tthis.y = rs * 0.5;\n\t\t\t\trs = 0.5 / rs;\n\t\t\t\tthis.w = (m20 - m02) * rs;\n\t\t\t\tthis.z = (m12 + m21) * rs;\n\t\t\t\tthis.x = (m10 + m01) * rs;\n\t\t\t} else {\n\t\t\t\trs = m22 - (m00 + m11) + 1;\n\t\t\t\trs = Math.sqrt(rs);\n\t\t\t\tthis.z = rs * 0.5;\n\t\t\t\trs = 0.5 / rs;\n\t\t\t\tthis.w = (m01 - m10) * rs;\n\t\t\t\tthis.x = (m20 + m02) * rs;\n\t\t\t\tthis.y = (m21 + m12) * rs;\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\tsetFromDirections(from, to) {\n\t\tconst dotProduct = 1 + from.dot(to);\n\t\tif (dotProduct < Number.EPSILON) {\n\t\t\tif (Math.abs(from.x) > Math.abs(from.y)) {\n\t\t\t\tthis.x = -from.z;\n\t\t\t\tthis.y = 0;\n\t\t\t\tthis.z = from.x;\n\t\t\t\tthis.w = 0;\n\t\t\t} else {\n\t\t\t\tthis.x = 0;\n\t\t\t\tthis.y = -from.z;\n\t\t\t\tthis.z = from.y;\n\t\t\t\tthis.w = 0;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.x = from.y * to.z - from.z * to.y;\n\t\t\tthis.y = from.z * to.x - from.x * to.z;\n\t\t\tthis.z = from.x * to.y - from.y * to.x;\n\t\t\tthis.w = dotProduct;\n\t\t}\n\t\treturn this.normalize();\n\t}\n\tslerp(lhs, rhs, alpha) {\n\t\tconst lx = lhs.x;\n\t\tconst ly = lhs.y;\n\t\tconst lz = lhs.z;\n\t\tconst lw = lhs.w;\n\t\tlet rx = rhs.x;\n\t\tlet ry = rhs.y;\n\t\tlet rz = rhs.z;\n\t\tlet rw = rhs.w;\n\t\tlet cosHalfTheta = lw * rw + lx * rx + ly * ry + lz * rz;\n\t\tif (cosHalfTheta < 0) {\n\t\t\trw = -rw;\n\t\t\trx = -rx;\n\t\t\try = -ry;\n\t\t\trz = -rz;\n\t\t\tcosHalfTheta = -cosHalfTheta;\n\t\t}\n\t\tif (Math.abs(cosHalfTheta) >= 1) {\n\t\t\tthis.w = lw;\n\t\t\tthis.x = lx;\n\t\t\tthis.y = ly;\n\t\t\tthis.z = lz;\n\t\t\treturn this;\n\t\t}\n\t\tconst halfTheta = Math.acos(cosHalfTheta);\n\t\tconst sinHalfTheta = Math.sqrt(1 - cosHalfTheta * cosHalfTheta);\n\t\tif (Math.abs(sinHalfTheta) < 0.001) {\n\t\t\tthis.w = lw * 0.5 + rw * 0.5;\n\t\t\tthis.x = lx * 0.5 + rx * 0.5;\n\t\t\tthis.y = ly * 0.5 + ry * 0.5;\n\t\t\tthis.z = lz * 0.5 + rz * 0.5;\n\t\t\treturn this;\n\t\t}\n\t\tconst ratioA = Math.sin((1 - alpha) * halfTheta) / sinHalfTheta;\n\t\tconst ratioB = Math.sin(alpha * halfTheta) / sinHalfTheta;\n\t\tthis.w = lw * ratioA + rw * ratioB;\n\t\tthis.x = lx * ratioA + rx * ratioB;\n\t\tthis.y = ly * ratioA + ry * ratioB;\n\t\tthis.z = lz * ratioA + rz * ratioB;\n\t\treturn this;\n\t}\n\ttransformVector(vec, res = new Vec3()) {\n\t\tconst x = vec.x,\n\t\t\ty = vec.y,\n\t\t\tz = vec.z;\n\t\tconst qx = this.x,\n\t\t\tqy = this.y,\n\t\t\tqz = this.z,\n\t\t\tqw = this.w;\n\t\tconst ix = qw * x + qy * z - qz * y;\n\t\tconst iy = qw * y + qz * x - qx * z;\n\t\tconst iz = qw * z + qx * y - qy * x;\n\t\tconst iw = -qx * x - qy * y - qz * z;\n\t\tres.x = ix * qw + iw * -qx + iy * -qz - iz * -qy;\n\t\tres.y = iy * qw + iw * -qy + iz * -qx - ix * -qz;\n\t\tres.z = iz * qw + iw * -qz + ix * -qy - iy * -qx;\n\t\treturn res;\n\t}\n\ttoString() {\n\t\treturn `[${this.x}, ${this.y}, ${this.z}, ${this.w}]`;\n\t}\n}\n_class = Quat;\nQuat.IDENTITY = Object.freeze(new _class(0, 0, 0, 1));\nQuat.ZERO = Object.freeze(new _class(0, 0, 0, 0));\n\nexport { Quat };\n","import '../tracing.js';\nimport { Vec3 } from '../math/vec3.js';\n\nconst tmpVecA = new Vec3();\nconst tmpVecB = new Vec3();\nconst tmpVecC = new Vec3();\nconst tmpVecD = new Vec3();\nconst tmpVecE = new Vec3();\nclass BoundingBox {\n\tconstructor(center = new Vec3(), halfExtents = new Vec3(0.5, 0.5, 0.5)) {\n\t\tthis.center = void 0;\n\t\tthis.halfExtents = void 0;\n\t\tthis._min = new Vec3();\n\t\tthis._max = new Vec3();\n\t\tthis.center = center;\n\t\tthis.halfExtents = halfExtents;\n\t}\n\tadd(other) {\n\t\tconst tc = this.center;\n\t\tconst tcx = tc.x;\n\t\tconst tcy = tc.y;\n\t\tconst tcz = tc.z;\n\t\tconst th = this.halfExtents;\n\t\tconst thx = th.x;\n\t\tconst thy = th.y;\n\t\tconst thz = th.z;\n\t\tlet tminx = tcx - thx;\n\t\tlet tmaxx = tcx + thx;\n\t\tlet tminy = tcy - thy;\n\t\tlet tmaxy = tcy + thy;\n\t\tlet tminz = tcz - thz;\n\t\tlet tmaxz = tcz + thz;\n\t\tconst oc = other.center;\n\t\tconst ocx = oc.x;\n\t\tconst ocy = oc.y;\n\t\tconst ocz = oc.z;\n\t\tconst oh = other.halfExtents;\n\t\tconst ohx = oh.x;\n\t\tconst ohy = oh.y;\n\t\tconst ohz = oh.z;\n\t\tconst ominx = ocx - ohx;\n\t\tconst omaxx = ocx + ohx;\n\t\tconst ominy = ocy - ohy;\n\t\tconst omaxy = ocy + ohy;\n\t\tconst ominz = ocz - ohz;\n\t\tconst omaxz = ocz + ohz;\n\t\tif (ominx < tminx) tminx = ominx;\n\t\tif (omaxx > tmaxx) tmaxx = omaxx;\n\t\tif (ominy < tminy) tminy = ominy;\n\t\tif (omaxy > tmaxy) tmaxy = omaxy;\n\t\tif (ominz < tminz) tminz = ominz;\n\t\tif (omaxz > tmaxz) tmaxz = omaxz;\n\t\ttc.x = (tminx + tmaxx) * 0.5;\n\t\ttc.y = (tminy + tmaxy) * 0.5;\n\t\ttc.z = (tminz + tmaxz) * 0.5;\n\t\tth.x = (tmaxx - tminx) * 0.5;\n\t\tth.y = (tmaxy - tminy) * 0.5;\n\t\tth.z = (tmaxz - tminz) * 0.5;\n\t}\n\tcopy(src) {\n\t\tthis.center.copy(src.center);\n\t\tthis.halfExtents.copy(src.halfExtents);\n\t}\n\tclone() {\n\t\treturn new BoundingBox(this.center.clone(), this.halfExtents.clone());\n\t}\n\tintersects(other) {\n\t\tconst aMax = this.getMax();\n\t\tconst aMin = this.getMin();\n\t\tconst bMax = other.getMax();\n\t\tconst bMin = other.getMin();\n\t\treturn aMin.x <= bMax.x && aMax.x >= bMin.x && aMin.y <= bMax.y && aMax.y >= bMin.y && aMin.z <= bMax.z && aMax.z >= bMin.z;\n\t}\n\t_intersectsRay(ray, point) {\n\t\tconst tMin = tmpVecA.copy(this.getMin()).sub(ray.origin);\n\t\tconst tMax = tmpVecB.copy(this.getMax()).sub(ray.origin);\n\t\tconst dir = ray.direction;\n\t\tif (dir.x === 0) {\n\t\t\ttMin.x = tMin.x < 0 ? -Number.MAX_VALUE : Number.MAX_VALUE;\n\t\t\ttMax.x = tMax.x < 0 ? -Number.MAX_VALUE : Number.MAX_VALUE;\n\t\t} else {\n\t\t\ttMin.x /= dir.x;\n\t\t\ttMax.x /= dir.x;\n\t\t}\n\t\tif (dir.y === 0) {\n\t\t\ttMin.y = tMin.y < 0 ? -Number.MAX_VALUE : Number.MAX_VALUE;\n\t\t\ttMax.y = tMax.y < 0 ? -Number.MAX_VALUE : Number.MAX_VALUE;\n\t\t} else {\n\t\t\ttMin.y /= dir.y;\n\t\t\ttMax.y /= dir.y;\n\t\t}\n\t\tif (dir.z === 0) {\n\t\t\ttMin.z = tMin.z < 0 ? -Number.MAX_VALUE : Number.MAX_VALUE;\n\t\t\ttMax.z = tMax.z < 0 ? -Number.MAX_VALUE : Number.MAX_VALUE;\n\t\t} else {\n\t\t\ttMin.z /= dir.z;\n\t\t\ttMax.z /= dir.z;\n\t\t}\n\t\tconst realMin = tmpVecC.set(Math.min(tMin.x, tMax.x), Math.min(tMin.y, tMax.y), Math.min(tMin.z, tMax.z));\n\t\tconst realMax = tmpVecD.set(Math.max(tMin.x, tMax.x), Math.max(tMin.y, tMax.y), Math.max(tMin.z, tMax.z));\n\t\tconst minMax = Math.min(Math.min(realMax.x, realMax.y), realMax.z);\n\t\tconst maxMin = Math.max(Math.max(realMin.x, realMin.y), realMin.z);\n\t\tconst intersects = minMax >= maxMin && maxMin >= 0;\n\t\tif (intersects) point.copy(ray.direction).mulScalar(maxMin).add(ray.origin);\n\t\treturn intersects;\n\t}\n\t_fastIntersectsRay(ray) {\n\t\tconst diff = tmpVecA;\n\t\tconst cross = tmpVecB;\n\t\tconst prod = tmpVecC;\n\t\tconst absDiff = tmpVecD;\n\t\tconst absDir = tmpVecE;\n\t\tconst rayDir = ray.direction;\n\t\tdiff.sub2(ray.origin, this.center);\n\t\tabsDiff.set(Math.abs(diff.x), Math.abs(diff.y), Math.abs(diff.z));\n\t\tprod.mul2(diff, rayDir);\n\t\tif (absDiff.x > this.halfExtents.x && prod.x >= 0) return false;\n\t\tif (absDiff.y > this.halfExtents.y && prod.y >= 0) return false;\n\t\tif (absDiff.z > this.halfExtents.z && prod.z >= 0) return false;\n\t\tabsDir.set(Math.abs(rayDir.x), Math.abs(rayDir.y), Math.abs(rayDir.z));\n\t\tcross.cross(rayDir, diff);\n\t\tcross.set(Math.abs(cross.x), Math.abs(cross.y), Math.abs(cross.z));\n\t\tif (cross.x > this.halfExtents.y * absDir.z + this.halfExtents.z * absDir.y) return false;\n\t\tif (cross.y > this.halfExtents.x * absDir.z + this.halfExtents.z * absDir.x) return false;\n\t\tif (cross.z > this.halfExtents.x * absDir.y + this.halfExtents.y * absDir.x) return false;\n\t\treturn true;\n\t}\n\tintersectsRay(ray, point) {\n\t\tif (point) {\n\t\t\treturn this._intersectsRay(ray, point);\n\t\t}\n\t\treturn this._fastIntersectsRay(ray);\n\t}\n\tsetMinMax(min, max) {\n\t\tthis.center.add2(max, min).mulScalar(0.5);\n\t\tthis.halfExtents.sub2(max, min).mulScalar(0.5);\n\t}\n\tgetMin() {\n\t\treturn this._min.copy(this.center).sub(this.halfExtents);\n\t}\n\tgetMax() {\n\t\treturn this._max.copy(this.center).add(this.halfExtents);\n\t}\n\tcontainsPoint(point) {\n\t\tconst min = this.getMin();\n\t\tconst max = this.getMax();\n\t\tif (point.x < min.x || point.x > max.x || point.y < min.y || point.y > max.y || point.z < min.z || point.z > max.z) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\tsetFromTransformedAabb(aabb, m, ignoreScale = false) {\n\t\tconst ac = aabb.center;\n\t\tconst ar = aabb.halfExtents;\n\t\tconst d = m.data;\n\t\tlet mx0 = d[0];\n\t\tlet mx1 = d[4];\n\t\tlet mx2 = d[8];\n\t\tlet my0 = d[1];\n\t\tlet my1 = d[5];\n\t\tlet my2 = d[9];\n\t\tlet mz0 = d[2];\n\t\tlet mz1 = d[6];\n\t\tlet mz2 = d[10];\n\t\tif (ignoreScale) {\n\t\t\tlet lengthSq = mx0 * mx0 + mx1 * mx1 + mx2 * mx2;\n\t\t\tif (lengthSq > 0) {\n\t\t\t\tconst invLength = 1 / Math.sqrt(lengthSq);\n\t\t\t\tmx0 *= invLength;\n\t\t\t\tmx1 *= invLength;\n\t\t\t\tmx2 *= invLength;\n\t\t\t}\n\t\t\tlengthSq = my0 * my0 + my1 * my1 + my2 * my2;\n\t\t\tif (lengthSq > 0) {\n\t\t\t\tconst invLength = 1 / Math.sqrt(lengthSq);\n\t\t\t\tmy0 *= invLength;\n\t\t\t\tmy1 *= invLength;\n\t\t\t\tmy2 *= invLength;\n\t\t\t}\n\t\t\tlengthSq = mz0 * mz0 + mz1 * mz1 + mz2 * mz2;\n\t\t\tif (lengthSq > 0) {\n\t\t\t\tconst invLength = 1 / Math.sqrt(lengthSq);\n\t\t\t\tmz0 *= invLength;\n\t\t\t\tmz1 *= invLength;\n\t\t\t\tmz2 *= invLength;\n\t\t\t}\n\t\t}\n\t\tthis.center.set(d[12] + mx0 * ac.x + mx1 * ac.y + mx2 * ac.z, d[13] + my0 * ac.x + my1 * ac.y + my2 * ac.z, d[14] + mz0 * ac.x + mz1 * ac.y + mz2 * ac.z);\n\t\tthis.halfExtents.set(Math.abs(mx0) * ar.x + Math.abs(mx1) * ar.y + Math.abs(mx2) * ar.z, Math.abs(my0) * ar.x + Math.abs(my1) * ar.y + Math.abs(my2) * ar.z, Math.abs(mz0) * ar.x + Math.abs(mz1) * ar.y + Math.abs(mz2) * ar.z);\n\t}\n\tstatic computeMinMax(vertices, min, max, numVerts = vertices.length / 3) {\n\t\tif (numVerts > 0) {\n\t\t\tlet minx = vertices[0];\n\t\t\tlet miny = vertices[1];\n\t\t\tlet minz = vertices[2];\n\t\t\tlet maxx = minx;\n\t\t\tlet maxy = miny;\n\t\t\tlet maxz = minz;\n\t\t\tconst n = numVerts * 3;\n\t\t\tfor (let i = 3; i < n; i += 3) {\n\t\t\t\tconst x = vertices[i];\n\t\t\t\tconst y = vertices[i + 1];\n\t\t\t\tconst z = vertices[i + 2];\n\t\t\t\tif (x < minx) minx = x;\n\t\t\t\tif (y < miny) miny = y;\n\t\t\t\tif (z < minz) minz = z;\n\t\t\t\tif (x > maxx) maxx = x;\n\t\t\t\tif (y > maxy) maxy = y;\n\t\t\t\tif (z > maxz) maxz = z;\n\t\t\t}\n\t\t\tmin.set(minx, miny, minz);\n\t\t\tmax.set(maxx, maxy, maxz);\n\t\t}\n\t}\n\tcompute(vertices, numVerts) {\n\t\tBoundingBox.computeMinMax(vertices, tmpVecA, tmpVecB, numVerts);\n\t\tthis.setMinMax(tmpVecA, tmpVecB);\n\t}\n\tintersectsBoundingSphere(sphere) {\n\t\tconst sq = this._distanceToBoundingSphereSq(sphere);\n\t\tif (sq <= sphere.radius * sphere.radius) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\t_distanceToBoundingSphereSq(sphere) {\n\t\tconst boxMin = this.getMin();\n\t\tconst boxMax = this.getMax();\n\t\tlet sq = 0;\n\t\tconst axis = ['x', 'y', 'z'];\n\t\tfor (let i = 0; i < 3; ++i) {\n\t\t\tlet out = 0;\n\t\t\tconst pn = sphere.center[axis[i]];\n\t\t\tconst bMin = boxMin[axis[i]];\n\t\t\tconst bMax = boxMax[axis[i]];\n\t\t\tlet val = 0;\n\t\t\tif (pn < bMin) {\n\t\t\t\tval = bMin - pn;\n\t\t\t\tout += val * val;\n\t\t\t}\n\t\t\tif (pn > bMax) {\n\t\t\t\tval = pn - bMax;\n\t\t\t\tout += val * val;\n\t\t\t}\n\t\t\tsq += out;\n\t\t}\n\t\treturn sq;\n\t}\n\t_expand(expandMin, expandMax) {\n\t\ttmpVecA.add2(this.getMin(), expandMin);\n\t\ttmpVecB.add2(this.getMax(), expandMax);\n\t\tthis.setMinMax(tmpVecA, tmpVecB);\n\t}\n}\n\nexport { BoundingBox };\n","import '../tracing.js';\nimport { Vec3 } from '../math/vec3.js';\n\nconst tmpVecA = new Vec3();\nconst tmpVecB = new Vec3();\nclass BoundingSphere {\n\tconstructor(center = new Vec3(), radius = 0.5) {\n\t\tthis.center = void 0;\n\t\tthis.radius = void 0;\n\t\tthis.center = center;\n\t\tthis.radius = radius;\n\t}\n\tcontainsPoint(point) {\n\t\tconst lenSq = tmpVecA.sub2(point, this.center).lengthSq();\n\t\tconst r = this.radius;\n\t\treturn lenSq < r * r;\n\t}\n\tintersectsRay(ray, point) {\n\t\tconst m = tmpVecA.copy(ray.origin).sub(this.center);\n\t\tconst b = m.dot(tmpVecB.copy(ray.direction).normalize());\n\t\tconst c = m.dot(m) - this.radius * this.radius;\n\t\tif (c > 0 && b > 0) return false;\n\t\tconst discr = b * b - c;\n\t\tif (discr < 0) return false;\n\t\tconst t = Math.abs(-b - Math.sqrt(discr));\n\t\tif (point) point.copy(ray.direction).mulScalar(t).add(ray.origin);\n\t\treturn true;\n\t}\n\tintersectsBoundingSphere(sphere) {\n\t\ttmpVecA.sub2(sphere.center, this.center);\n\t\tconst totalRadius = sphere.radius + this.radius;\n\t\tif (tmpVecA.lengthSq() <= totalRadius * totalRadius) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n}\n\nexport { BoundingSphere };\n","class Frustum {\n\tconstructor() {\n\t\tthis.planes = [];\n\t\tfor (let i = 0; i < 6; i++) this.planes[i] = [];\n\t}\n\tsetFromMat4(matrix) {\n\t\tconst vpm = matrix.data;\n\t\tlet plane;\n\t\tconst planes = this.planes;\n\t\tplane = planes[0];\n\t\tplane[0] = vpm[3] - vpm[0];\n\t\tplane[1] = vpm[7] - vpm[4];\n\t\tplane[2] = vpm[11] - vpm[8];\n\t\tplane[3] = vpm[15] - vpm[12];\n\t\tlet t = Math.sqrt(plane[0] * plane[0] + plane[1] * plane[1] + plane[2] * plane[2]);\n\t\tplane[0] /= t;\n\t\tplane[1] /= t;\n\t\tplane[2] /= t;\n\t\tplane[3] /= t;\n\t\tplane = planes[1];\n\t\tplane[0] = vpm[3] + vpm[0];\n\t\tplane[1] = vpm[7] + vpm[4];\n\t\tplane[2] = vpm[11] + vpm[8];\n\t\tplane[3] = vpm[15] + vpm[12];\n\t\tt = Math.sqrt(plane[0] * plane[0] + plane[1] * plane[1] + plane[2] * plane[2]);\n\t\tplane[0] /= t;\n\t\tplane[1] /= t;\n\t\tplane[2] /= t;\n\t\tplane[3] /= t;\n\t\tplane = planes[2];\n\t\tplane[0] = vpm[3] + vpm[1];\n\t\tplane[1] = vpm[7] + vpm[5];\n\t\tplane[2] = vpm[11] + vpm[9];\n\t\tplane[3] = vpm[15] + vpm[13];\n\t\tt = Math.sqrt(plane[0] * plane[0] + plane[1] * plane[1] + plane[2] * plane[2]);\n\t\tplane[0] /= t;\n\t\tplane[1] /= t;\n\t\tplane[2] /= t;\n\t\tplane[3] /= t;\n\t\tplane = planes[3];\n\t\tplane[0] = vpm[3] - vpm[1];\n\t\tplane[1] = vpm[7] - vpm[5];\n\t\tplane[2] = vpm[11] - vpm[9];\n\t\tplane[3] = vpm[15] - vpm[13];\n\t\tt = Math.sqrt(plane[0] * plane[0] + plane[1] * plane[1] + plane[2] * plane[2]);\n\t\tplane[0] /= t;\n\t\tplane[1] /= t;\n\t\tplane[2] /= t;\n\t\tplane[3] /= t;\n\t\tplane = planes[4];\n\t\tplane[0] = vpm[3] - vpm[2];\n\t\tplane[1] = vpm[7] - vpm[6];\n\t\tplane[2] = vpm[11] - vpm[10];\n\t\tplane[3] = vpm[15] - vpm[14];\n\t\tt = Math.sqrt(plane[0] * plane[0] + plane[1] * plane[1] + plane[2] * plane[2]);\n\t\tplane[0] /= t;\n\t\tplane[1] /= t;\n\t\tplane[2] /= t;\n\t\tplane[3] /= t;\n\t\tplane = planes[5];\n\t\tplane[0] = vpm[3] + vpm[2];\n\t\tplane[1] = vpm[7] + vpm[6];\n\t\tplane[2] = vpm[11] + vpm[10];\n\t\tplane[3] = vpm[15] + vpm[14];\n\t\tt = Math.sqrt(plane[0] * plane[0] + plane[1] * plane[1] + plane[2] * plane[2]);\n\t\tplane[0] /= t;\n\t\tplane[1] /= t;\n\t\tplane[2] /= t;\n\t\tplane[3] /= t;\n\t}\n\tcontainsPoint(point) {\n\t\tlet p, plane;\n\t\tfor (p = 0; p < 6; p++) {\n\t\t\tplane = this.planes[p];\n\t\t\tif (plane[0] * point.x + plane[1] * point.y + plane[2] * point.z + plane[3] <= 0) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\tcontainsSphere(sphere) {\n\t\tlet c = 0;\n\t\tlet d;\n\t\tlet p;\n\t\tconst sr = sphere.radius;\n\t\tconst sc = sphere.center;\n\t\tconst scx = sc.x;\n\t\tconst scy = sc.y;\n\t\tconst scz = sc.z;\n\t\tconst planes = this.planes;\n\t\tlet plane;\n\t\tfor (p = 0; p < 6; p++) {\n\t\t\tplane = planes[p];\n\t\t\td = plane[0] * scx + plane[1] * scy + plane[2] * scz + plane[3];\n\t\t\tif (d <= -sr) return 0;\n\t\t\tif (d > sr) c++;\n\t\t}\n\t\treturn c === 6 ? 2 : 1;\n\t}\n}\n\nexport { Frustum };\n","import { Vec3 } from '../math/vec3.js';\n\nclass Ray {\n\tconstructor(origin, direction) {\n\t\tthis.origin = new Vec3();\n\t\tthis.direction = Vec3.FORWARD.clone();\n\t\tif (origin) {\n\t\t\tthis.origin.copy(origin);\n\t\t}\n\t\tif (direction) {\n\t\t\tthis.direction.copy(direction);\n\t\t}\n\t}\n\tset(origin, direction) {\n\t\tthis.origin.copy(origin);\n\t\tthis.direction.copy(direction);\n\t\treturn this;\n\t}\n\tcopy(src) {\n\t\treturn this.set(src.origin, src.direction);\n\t}\n\tclone() {\n\t\treturn new this.constructor(this.origin, this.direction);\n\t}\n}\n\nexport { Ray };\n","import { Vec3 } from '../math/vec3.js';\n\nclass Plane {\n\tconstructor(normal = Vec3.UP, distance = 0) {\n\t\tthis.normal = new Vec3();\n\t\tthis.distance = void 0;\n\t\tthis.normal.copy(normal);\n\t\tthis.distance = distance;\n\t}\n\tsetFromPointNormal(point, normal) {\n\t\tthis.normal.copy(normal);\n\t\tthis.distance = -this.normal.dot(point);\n\t\treturn this;\n\t}\n\tintersectsLine(start, end, point) {\n\t\tconst d = this.distance;\n\t\tconst d0 = this.normal.dot(start) + d;\n\t\tconst d1 = this.normal.dot(end) + d;\n\t\tconst t = d0 / (d0 - d1);\n\t\tconst intersects = t >= 0 && t <= 1;\n\t\tif (intersects && point) point.lerp(start, end, t);\n\t\treturn intersects;\n\t}\n\tintersectsRay(ray, point) {\n\t\tconst denominator = this.normal.dot(ray.direction);\n\t\tif (denominator === 0) return false;\n\t\tconst t = -(this.normal.dot(ray.origin) + this.distance) / denominator;\n\t\tif (t >= 0 && point) {\n\t\t\tpoint.copy(ray.direction).mulScalar(t).add(ray.origin);\n\t\t}\n\t\treturn t >= 0;\n\t}\n\tcopy(src) {\n\t\tthis.normal.copy(src.normal);\n\t\tthis.distance = src.distance;\n\t\treturn this;\n\t}\n\tclone() {\n\t\tconst cstr = this.constructor;\n\t\treturn new cstr().copy(this);\n\t}\n}\n\nexport { Plane };\n","const DISTANCE_LINEAR = 'linear';\nconst DISTANCE_INVERSE = 'inverse';\nconst DISTANCE_EXPONENTIAL = 'exponential';\n\nexport { DISTANCE_EXPONENTIAL, DISTANCE_INVERSE, DISTANCE_LINEAR };\n","const ADDRESS_REPEAT = 0;\nconst ADDRESS_CLAMP_TO_EDGE = 1;\nconst ADDRESS_MIRRORED_REPEAT = 2;\nconst BLENDMODE_ZERO = 0;\nconst BLENDMODE_ONE = 1;\nconst BLENDMODE_SRC_COLOR = 2;\nconst BLENDMODE_ONE_MINUS_SRC_COLOR = 3;\nconst BLENDMODE_DST_COLOR = 4;\nconst BLENDMODE_ONE_MINUS_DST_COLOR = 5;\nconst BLENDMODE_SRC_ALPHA = 6;\nconst BLENDMODE_SRC_ALPHA_SATURATE = 7;\nconst BLENDMODE_ONE_MINUS_SRC_ALPHA = 8;\nconst BLENDMODE_DST_ALPHA = 9;\nconst BLENDMODE_ONE_MINUS_DST_ALPHA = 10;\nconst BLENDMODE_CONSTANT = 11;\nconst BLENDMODE_ONE_MINUS_CONSTANT = 12;\nconst BLENDEQUATION_ADD = 0;\nconst BLENDEQUATION_SUBTRACT = 1;\nconst BLENDEQUATION_REVERSE_SUBTRACT = 2;\nconst BLENDEQUATION_MIN = 3;\nconst BLENDEQUATION_MAX = 4;\nconst BUFFER_STATIC = 0;\nconst BUFFER_DYNAMIC = 1;\nconst BUFFER_STREAM = 2;\nconst BUFFER_GPUDYNAMIC = 3;\nconst CLEARFLAG_COLOR = 1;\nconst CLEARFLAG_DEPTH = 2;\nconst CLEARFLAG_STENCIL = 4;\nconst CUBEFACE_POSX = 0;\nconst CUBEFACE_NEGX = 1;\nconst CUBEFACE_POSY = 2;\nconst CUBEFACE_NEGY = 3;\nconst CUBEFACE_POSZ = 4;\nconst CUBEFACE_NEGZ = 5;\nconst CULLFACE_NONE = 0;\nconst CULLFACE_BACK = 1;\nconst CULLFACE_FRONT = 2;\nconst CULLFACE_FRONTANDBACK = 3;\nconst FILTER_NEAREST = 0;\nconst FILTER_LINEAR = 1;\nconst FILTER_NEAREST_MIPMAP_NEAREST = 2;\nconst FILTER_NEAREST_MIPMAP_LINEAR = 3;\nconst FILTER_LINEAR_MIPMAP_NEAREST = 4;\nconst FILTER_LINEAR_MIPMAP_LINEAR = 5;\nconst FUNC_NEVER = 0;\nconst FUNC_LESS = 1;\nconst FUNC_EQUAL = 2;\nconst FUNC_LESSEQUAL = 3;\nconst FUNC_GREATER = 4;\nconst FUNC_NOTEQUAL = 5;\nconst FUNC_GREATEREQUAL = 6;\nconst FUNC_ALWAYS = 7;\nconst INDEXFORMAT_UINT8 = 0;\nconst INDEXFORMAT_UINT16 = 1;\nconst INDEXFORMAT_UINT32 = 2;\nconst PIXELFORMAT_A8 = 0;\nconst PIXELFORMAT_L8 = 1;\nconst PIXELFORMAT_LA8 = 2;\nconst PIXELFORMAT_RGB565 = 3;\nconst PIXELFORMAT_RGBA5551 = 4;\nconst PIXELFORMAT_RGBA4 = 5;\nconst PIXELFORMAT_RGB8 = 6;\nconst PIXELFORMAT_RGBA8 = 7;\nconst PIXELFORMAT_DXT1 = 8;\nconst PIXELFORMAT_DXT3 = 9;\nconst PIXELFORMAT_DXT5 = 10;\nconst PIXELFORMAT_RGB16F = 11;\nconst PIXELFORMAT_RGBA16F = 12;\nconst PIXELFORMAT_RGB32F = 13;\nconst PIXELFORMAT_RGBA32F = 14;\nconst PIXELFORMAT_R32F = 15;\nconst PIXELFORMAT_DEPTH = 16;\nconst PIXELFORMAT_DEPTHSTENCIL = 17;\nconst PIXELFORMAT_111110F = 18;\nconst PIXELFORMAT_SRGB = 19;\nconst PIXELFORMAT_SRGBA = 20;\nconst PIXELFORMAT_ETC1 = 21;\nconst PIXELFORMAT_ETC2_RGB = 22;\nconst PIXELFORMAT_ETC2_RGBA = 23;\nconst PIXELFORMAT_PVRTC_2BPP_RGB_1 = 24;\nconst PIXELFORMAT_PVRTC_2BPP_RGBA_1 = 25;\nconst PIXELFORMAT_PVRTC_4BPP_RGB_1 = 26;\nconst PIXELFORMAT_PVRTC_4BPP_RGBA_1 = 27;\nconst PIXELFORMAT_ASTC_4x4 = 28;\nconst PIXELFORMAT_ATC_RGB = 29;\nconst PIXELFORMAT_ATC_RGBA = 30;\nconst PIXELFORMAT_BGRA8 = 31;\nconst pixelFormatInfo = new Map([[PIXELFORMAT_A8, {\n\tname: 'A8',\n\tsize: 1\n}], [PIXELFORMAT_L8, {\n\tname: 'L8',\n\tsize: 1\n}], [PIXELFORMAT_LA8, {\n\tname: 'LA8',\n\tsize: 2\n}], [PIXELFORMAT_RGB565, {\n\tname: 'RGB565',\n\tsize: 2\n}], [PIXELFORMAT_RGBA5551, {\n\tname: 'RGBA5551',\n\tsize: 2\n}], [PIXELFORMAT_RGBA4, {\n\tname: 'RGBA4',\n\tsize: 2\n}], [PIXELFORMAT_RGB8, {\n\tname: 'RGB8',\n\tsize: 4\n}], [PIXELFORMAT_RGBA8, {\n\tname: 'RGBA8',\n\tsize: 4\n}], [PIXELFORMAT_RGB16F, {\n\tname: 'RGB16F',\n\tsize: 8\n}], [PIXELFORMAT_RGBA16F, {\n\tname: 'RGBA16F',\n\tsize: 8\n}], [PIXELFORMAT_RGB32F, {\n\tname: 'RGB32F',\n\tsize: 16\n}], [PIXELFORMAT_RGBA32F, {\n\tname: 'RGBA32F',\n\tsize: 16\n}], [PIXELFORMAT_R32F, {\n\tname: 'R32F',\n\tsize: 4\n}], [PIXELFORMAT_DEPTH, {\n\tname: 'DEPTH',\n\tsize: 4\n}], [PIXELFORMAT_DEPTHSTENCIL, {\n\tname: 'DEPTHSTENCIL',\n\tsize: 4\n}], [PIXELFORMAT_111110F, {\n\tname: '111110F',\n\tsize: 4\n}], [PIXELFORMAT_SRGB, {\n\tname: 'SRGB',\n\tsize: 4\n}], [PIXELFORMAT_SRGBA, {\n\tname: 'SRGBA',\n\tsize: 4\n}], [PIXELFORMAT_BGRA8, {\n\tname: 'BGRA8',\n\tsize: 4\n}], [PIXELFORMAT_DXT1, {\n\tname: 'DXT1',\n\tblockSize: 8\n}], [PIXELFORMAT_DXT3, {\n\tname: 'DXT3',\n\tblockSize: 16\n}], [PIXELFORMAT_DXT5, {\n\tname: 'DXT5',\n\tblockSize: 16\n}], [PIXELFORMAT_ETC1, {\n\tname: 'ETC1',\n\tblockSize: 8\n}], [PIXELFORMAT_ETC2_RGB, {\n\tname: 'ETC2_RGB',\n\tblockSize: 8\n}], [PIXELFORMAT_ETC2_RGBA, {\n\tname: 'ETC2_RGBA',\n\tblockSize: 16\n}], [PIXELFORMAT_PVRTC_2BPP_RGB_1, {\n\tname: 'PVRTC_2BPP_RGB_1',\n\tblockSize: 8\n}], [PIXELFORMAT_PVRTC_2BPP_RGBA_1, {\n\tname: 'PVRTC_2BPP_RGBA_1',\n\tblockSize: 8\n}], [PIXELFORMAT_PVRTC_4BPP_RGB_1, {\n\tname: 'PVRTC_4BPP_RGB_1',\n\tblockSize: 8\n}], [PIXELFORMAT_PVRTC_4BPP_RGBA_1, {\n\tname: 'PVRTC_4BPP_RGBA_1',\n\tblockSize: 8\n}], [PIXELFORMAT_ASTC_4x4, {\n\tname: 'ASTC_4x4',\n\tblockSize: 16\n}], [PIXELFORMAT_ATC_RGB, {\n\tname: 'ATC_RGB',\n\tblockSize: 8\n}], [PIXELFORMAT_ATC_RGBA, {\n\tname: 'ATC_RGBA',\n\tblockSize: 16\n}]]);\nconst isCompressedPixelFormat = format => {\n\treturn pixelFormatInfo.get(format).blockSize !== undefined;\n};\nconst getPixelFormatArrayType = format => {\n\tswitch (format) {\n\t\tcase PIXELFORMAT_RGB32F:\n\t\tcase PIXELFORMAT_RGBA32F:\n\t\t\treturn Float32Array;\n\t\tcase PIXELFORMAT_RGB565:\n\t\tcase PIXELFORMAT_RGBA5551:\n\t\tcase PIXELFORMAT_RGBA4:\n\t\tcase PIXELFORMAT_RGB16F:\n\t\tcase PIXELFORMAT_RGBA16F:\n\t\t\treturn Uint16Array;\n\t\tdefault:\n\t\t\treturn Uint8Array;\n\t}\n};\nconst PRIMITIVE_POINTS = 0;\nconst PRIMITIVE_LINES = 1;\nconst PRIMITIVE_LINELOOP = 2;\nconst PRIMITIVE_LINESTRIP = 3;\nconst PRIMITIVE_TRIANGLES = 4;\nconst PRIMITIVE_TRISTRIP = 5;\nconst PRIMITIVE_TRIFAN = 6;\nconst SEMANTIC_POSITION = \"POSITION\";\nconst SEMANTIC_NORMAL = \"NORMAL\";\nconst SEMANTIC_TANGENT = \"TANGENT\";\nconst SEMANTIC_BLENDWEIGHT = \"BLENDWEIGHT\";\nconst SEMANTIC_BLENDINDICES = \"BLENDINDICES\";\nconst SEMANTIC_COLOR = \"COLOR\";\nconst SEMANTIC_TEXCOORD = \"TEXCOORD\";\nconst SEMANTIC_TEXCOORD0 = \"TEXCOORD0\";\nconst SEMANTIC_TEXCOORD1 = \"TEXCOORD1\";\nconst SEMANTIC_TEXCOORD2 = \"TEXCOORD2\";\nconst SEMANTIC_TEXCOORD3 = \"TEXCOORD3\";\nconst SEMANTIC_TEXCOORD4 = \"TEXCOORD4\";\nconst SEMANTIC_TEXCOORD5 = \"TEXCOORD5\";\nconst SEMANTIC_TEXCOORD6 = \"TEXCOORD6\";\nconst SEMANTIC_TEXCOORD7 = \"TEXCOORD7\";\nconst SEMANTIC_ATTR = \"ATTR\";\nconst SEMANTIC_ATTR0 = \"ATTR0\";\nconst SEMANTIC_ATTR1 = \"ATTR1\";\nconst SEMANTIC_ATTR2 = \"ATTR2\";\nconst SEMANTIC_ATTR3 = \"ATTR3\";\nconst SEMANTIC_ATTR4 = \"ATTR4\";\nconst SEMANTIC_ATTR5 = \"ATTR5\";\nconst SEMANTIC_ATTR6 = \"ATTR6\";\nconst SEMANTIC_ATTR7 = \"ATTR7\";\nconst SEMANTIC_ATTR8 = \"ATTR8\";\nconst SEMANTIC_ATTR9 = \"ATTR9\";\nconst SEMANTIC_ATTR10 = \"ATTR10\";\nconst SEMANTIC_ATTR11 = \"ATTR11\";\nconst SEMANTIC_ATTR12 = \"ATTR12\";\nconst SEMANTIC_ATTR13 = \"ATTR13\";\nconst SEMANTIC_ATTR14 = \"ATTR14\";\nconst SEMANTIC_ATTR15 = \"ATTR15\";\nconst SHADERTAG_MATERIAL = 1;\nconst STENCILOP_KEEP = 0;\nconst STENCILOP_ZERO = 1;\nconst STENCILOP_REPLACE = 2;\nconst STENCILOP_INCREMENT = 3;\nconst STENCILOP_INCREMENTWRAP = 4;\nconst STENCILOP_DECREMENT = 5;\nconst STENCILOP_DECREMENTWRAP = 6;\nconst STENCILOP_INVERT = 7;\nconst TEXTURELOCK_READ = 1;\nconst TEXTURELOCK_WRITE = 2;\nconst TEXTURETYPE_DEFAULT = 'default';\nconst TEXTURETYPE_RGBM = 'rgbm';\nconst TEXTURETYPE_RGBE = 'rgbe';\nconst TEXTURETYPE_RGBP = 'rgbp';\nconst TEXTURETYPE_SWIZZLEGGGR = 'swizzleGGGR';\nconst TEXHINT_NONE = 0;\nconst TEXHINT_SHADOWMAP = 1;\nconst TEXHINT_ASSET = 2;\nconst TEXHINT_LIGHTMAP = 3;\nconst TEXTUREDIMENSION_1D = '1d';\nconst TEXTUREDIMENSION_2D = '2d';\nconst TEXTUREDIMENSION_2D_ARRAY = '2d-array';\nconst TEXTUREDIMENSION_CUBE = 'cube';\nconst TEXTUREDIMENSION_CUBE_ARRAY = 'cube-array';\nconst TEXTUREDIMENSION_3D = '3d';\nconst SAMPLETYPE_FLOAT = 0;\nconst SAMPLETYPE_UNFILTERABLE_FLOAT = 1;\nconst SAMPLETYPE_DEPTH = 2;\nconst TEXTUREPROJECTION_NONE = \"none\";\nconst TEXTUREPROJECTION_CUBE = \"cube\";\nconst TEXTUREPROJECTION_EQUIRECT = \"equirect\";\nconst TEXTUREPROJECTION_OCTAHEDRAL = \"octahedral\";\nconst SHADERLANGUAGE_GLSL = 'glsl';\nconst SHADERLANGUAGE_WGSL = 'wgsl';\nconst TYPE_INT8 = 0;\nconst TYPE_UINT8 = 1;\nconst TYPE_INT16 = 2;\nconst TYPE_UINT16 = 3;\nconst TYPE_INT32 = 4;\nconst TYPE_UINT32 = 5;\nconst TYPE_FLOAT32 = 6;\nconst TYPE_FLOAT16 = 7;\nconst UNIFORMTYPE_BOOL = 0;\nconst UNIFORMTYPE_INT = 1;\nconst UNIFORMTYPE_FLOAT = 2;\nconst UNIFORMTYPE_VEC2 = 3;\nconst UNIFORMTYPE_VEC3 = 4;\nconst UNIFORMTYPE_VEC4 = 5;\nconst UNIFORMTYPE_IVEC2 = 6;\nconst UNIFORMTYPE_IVEC3 = 7;\nconst UNIFORMTYPE_IVEC4 = 8;\nconst UNIFORMTYPE_BVEC2 = 9;\nconst UNIFORMTYPE_BVEC3 = 10;\nconst UNIFORMTYPE_BVEC4 = 11;\nconst UNIFORMTYPE_MAT2 = 12;\nconst UNIFORMTYPE_MAT3 = 13;\nconst UNIFORMTYPE_MAT4 = 14;\nconst UNIFORMTYPE_TEXTURE2D = 15;\nconst UNIFORMTYPE_TEXTURECUBE = 16;\nconst UNIFORMTYPE_FLOATARRAY = 17;\nconst UNIFORMTYPE_TEXTURE2D_SHADOW = 18;\nconst UNIFORMTYPE_TEXTURECUBE_SHADOW = 19;\nconst UNIFORMTYPE_TEXTURE3D = 20;\nconst UNIFORMTYPE_VEC2ARRAY = 21;\nconst UNIFORMTYPE_VEC3ARRAY = 22;\nconst UNIFORMTYPE_VEC4ARRAY = 23;\nconst UNIFORMTYPE_MAT4ARRAY = 24;\nconst UNIFORMTYPE_TEXTURE2D_ARRAY = 25;\nconst uniformTypeToName = ['bool', 'int', 'float', 'vec2', 'vec3', 'vec4', 'ivec2', 'ivec3', 'ivec4', 'bec2', 'bec3', 'bec4', 'mat2', 'mat3', 'mat4', 'sampler2D', 'samplerCube', '', 'sampler2DShadow', 'samplerCubeShadow', 'sampler3D', '', '', ''];\nconst DEVICETYPE_WEBGL1 = 'webgl1';\nconst DEVICETYPE_WEBGL2 = 'webgl2';\nconst DEVICETYPE_WEBGPU = 'webgpu';\nconst DEVICETYPE_NULL = 'null';\nconst SHADERSTAGE_VERTEX = 1;\nconst SHADERSTAGE_FRAGMENT = 2;\nconst SHADERSTAGE_COMPUTE = 4;\nconst BINDGROUP_MESH = 0;\nconst BINDGROUP_VIEW = 1;\nconst bindGroupNames = ['mesh', 'view'];\nconst UNIFORM_BUFFER_DEFAULT_SLOT_NAME = 'default';\nconst typedArrayTypes = [Int8Array, Uint8Array, Int16Array, Uint16Array, Int32Array, Uint32Array, Float32Array, Uint16Array];\nconst typedArrayTypesByteSize = [1, 1, 2, 2, 4, 4, 4, 2];\nconst vertexTypesNames = ['INT8', 'UINT8', 'INT16', 'UINT16', 'INT32', 'UINT32', 'FLOAT32', 'FLOAT16'];\nconst typedArrayToType = {\n\t\"Int8Array\": TYPE_INT8,\n\t\"Uint8Array\": TYPE_UINT8,\n\t\"Int16Array\": TYPE_INT16,\n\t\"Uint16Array\": TYPE_UINT16,\n\t\"Int32Array\": TYPE_INT32,\n\t\"Uint32Array\": TYPE_UINT32,\n\t\"Float32Array\": TYPE_FLOAT32\n};\nconst typedArrayIndexFormats = [Uint8Array, Uint16Array, Uint32Array];\nconst typedArrayIndexFormatsByteSize = [1, 2, 4];\nconst semanticToLocation = {};\nsemanticToLocation[SEMANTIC_POSITION] = 0;\nsemanticToLocation[SEMANTIC_NORMAL] = 1;\nsemanticToLocation[SEMANTIC_BLENDWEIGHT] = 2;\nsemanticToLocation[SEMANTIC_BLENDINDICES] = 3;\nsemanticToLocation[SEMANTIC_COLOR] = 4;\nsemanticToLocation[SEMANTIC_TEXCOORD0] = 5;\nsemanticToLocation[SEMANTIC_TEXCOORD1] = 6;\nsemanticToLocation[SEMANTIC_TEXCOORD2] = 7;\nsemanticToLocation[SEMANTIC_TEXCOORD3] = 8;\nsemanticToLocation[SEMANTIC_TEXCOORD4] = 9;\nsemanticToLocation[SEMANTIC_TEXCOORD5] = 10;\nsemanticToLocation[SEMANTIC_TEXCOORD6] = 11;\nsemanticToLocation[SEMANTIC_TEXCOORD7] = 12;\nsemanticToLocation[SEMANTIC_TANGENT] = 13;\nsemanticToLocation[SEMANTIC_ATTR0] = 0;\nsemanticToLocation[SEMANTIC_ATTR1] = 1;\nsemanticToLocation[SEMANTIC_ATTR2] = 2;\nsemanticToLocation[SEMANTIC_ATTR3] = 3;\nsemanticToLocation[SEMANTIC_ATTR4] = 4;\nsemanticToLocation[SEMANTIC_ATTR5] = 5;\nsemanticToLocation[SEMANTIC_ATTR6] = 6;\nsemanticToLocation[SEMANTIC_ATTR7] = 7;\nsemanticToLocation[SEMANTIC_ATTR8] = 8;\nsemanticToLocation[SEMANTIC_ATTR9] = 9;\nsemanticToLocation[SEMANTIC_ATTR10] = 10;\nsemanticToLocation[SEMANTIC_ATTR11] = 11;\nsemanticToLocation[SEMANTIC_ATTR12] = 12;\nsemanticToLocation[SEMANTIC_ATTR13] = 13;\nsemanticToLocation[SEMANTIC_ATTR14] = 14;\nsemanticToLocation[SEMANTIC_ATTR15] = 15;\nconst CHUNKAPI_1_51 = '1.51';\nconst CHUNKAPI_1_55 = '1.55';\nconst CHUNKAPI_1_56 = '1.56';\nconst CHUNKAPI_1_57 = '1.57';\nconst CHUNKAPI_1_58 = '1.58';\nconst CHUNKAPI_1_60 = '1.60';\nconst CHUNKAPI_1_62 = '1.62';\nconst CHUNKAPI_1_65 = '1.65';\n\nexport { ADDRESS_CLAMP_TO_EDGE, ADDRESS_MIRRORED_REPEAT, ADDRESS_REPEAT, BINDGROUP_MESH, BINDGROUP_VIEW, BLENDEQUATION_ADD, BLENDEQUATION_MAX, BLENDEQUATION_MIN, BLENDEQUATION_REVERSE_SUBTRACT, BLENDEQUATION_SUBTRACT, BLENDMODE_CONSTANT, BLENDMODE_DST_ALPHA, BLENDMODE_DST_COLOR, BLENDMODE_ONE, BLENDMODE_ONE_MINUS_CONSTANT, BLENDMODE_ONE_MINUS_DST_ALPHA, BLENDMODE_ONE_MINUS_DST_COLOR, BLENDMODE_ONE_MINUS_SRC_ALPHA, BLENDMODE_ONE_MINUS_SRC_COLOR, BLENDMODE_SRC_ALPHA, BLENDMODE_SRC_ALPHA_SATURATE, BLENDMODE_SRC_COLOR, BLENDMODE_ZERO, BUFFER_DYNAMIC, BUFFER_GPUDYNAMIC, BUFFER_STATIC, BUFFER_STREAM, CHUNKAPI_1_51, CHUNKAPI_1_55, CHUNKAPI_1_56, CHUNKAPI_1_57, CHUNKAPI_1_58, CHUNKAPI_1_60, CHUNKAPI_1_62, CHUNKAPI_1_65, CLEARFLAG_COLOR, CLEARFLAG_DEPTH, CLEARFLAG_STENCIL, CUBEFACE_NEGX, CUBEFACE_NEGY, CUBEFACE_NEGZ, CUBEFACE_POSX, CUBEFACE_POSY, CUBEFACE_POSZ, CULLFACE_BACK, CULLFACE_FRONT, CULLFACE_FRONTANDBACK, CULLFACE_NONE, DEVICETYPE_NULL, DEVICETYPE_WEBGL1, DEVICETYPE_WEBGL2, DEVICETYPE_WEBGPU, FILTER_LINEAR, FILTER_LINEAR_MIPMAP_LINEAR, FILTER_LINEAR_MIPMAP_NEAREST, FILTER_NEAREST, FILTER_NEAREST_MIPMAP_LINEAR, FILTER_NEAREST_MIPMAP_NEAREST, FUNC_ALWAYS, FUNC_EQUAL, FUNC_GREATER, FUNC_GREATEREQUAL, FUNC_LESS, FUNC_LESSEQUAL, FUNC_NEVER, FUNC_NOTEQUAL, INDEXFORMAT_UINT16, INDEXFORMAT_UINT32, INDEXFORMAT_UINT8, PIXELFORMAT_111110F, PIXELFORMAT_A8, PIXELFORMAT_ASTC_4x4, PIXELFORMAT_ATC_RGB, PIXELFORMAT_ATC_RGBA, PIXELFORMAT_BGRA8, PIXELFORMAT_DEPTH, PIXELFORMAT_DEPTHSTENCIL, PIXELFORMAT_DXT1, PIXELFORMAT_DXT3, PIXELFORMAT_DXT5, PIXELFORMAT_ETC1, PIXELFORMAT_ETC2_RGB, PIXELFORMAT_ETC2_RGBA, PIXELFORMAT_L8, PIXELFORMAT_LA8, PIXELFORMAT_PVRTC_2BPP_RGBA_1, PIXELFORMAT_PVRTC_2BPP_RGB_1, PIXELFORMAT_PVRTC_4BPP_RGBA_1, PIXELFORMAT_PVRTC_4BPP_RGB_1, PIXELFORMAT_R32F, PIXELFORMAT_RGB16F, PIXELFORMAT_RGB32F, PIXELFORMAT_RGB565, PIXELFORMAT_RGB8, PIXELFORMAT_RGBA16F, PIXELFORMAT_RGBA32F, PIXELFORMAT_RGBA4, PIXELFORMAT_RGBA5551, PIXELFORMAT_RGBA8, PIXELFORMAT_SRGB, PIXELFORMAT_SRGBA, PRIMITIVE_LINELOOP, PRIMITIVE_LINES, PRIMITIVE_LINESTRIP, PRIMITIVE_POINTS, PRIMITIVE_TRIANGLES, PRIMITIVE_TRIFAN, PRIMITIVE_TRISTRIP, SAMPLETYPE_DEPTH, SAMPLETYPE_FLOAT, SAMPLETYPE_UNFILTERABLE_FLOAT, SEMANTIC_ATTR, SEMANTIC_ATTR0, SEMANTIC_ATTR1, SEMANTIC_ATTR10, SEMANTIC_ATTR11, SEMANTIC_ATTR12, SEMANTIC_ATTR13, SEMANTIC_ATTR14, SEMANTIC_ATTR15, SEMANTIC_ATTR2, SEMANTIC_ATTR3, SEMANTIC_ATTR4, SEMANTIC_ATTR5, SEMANTIC_ATTR6, SEMANTIC_ATTR7, SEMANTIC_ATTR8, SEMANTIC_ATTR9, SEMANTIC_BLENDINDICES, SEMANTIC_BLENDWEIGHT, SEMANTIC_COLOR, SEMANTIC_NORMAL, SEMANTIC_POSITION, SEMANTIC_TANGENT, SEMANTIC_TEXCOORD, SEMANTIC_TEXCOORD0, SEMANTIC_TEXCOORD1, SEMANTIC_TEXCOORD2, SEMANTIC_TEXCOORD3, SEMANTIC_TEXCOORD4, SEMANTIC_TEXCOORD5, SEMANTIC_TEXCOORD6, SEMANTIC_TEXCOORD7, SHADERLANGUAGE_GLSL, SHADERLANGUAGE_WGSL, SHADERSTAGE_COMPUTE, SHADERSTAGE_FRAGMENT, SHADERSTAGE_VERTEX, SHADERTAG_MATERIAL, STENCILOP_DECREMENT, STENCILOP_DECREMENTWRAP, STENCILOP_INCREMENT, STENCILOP_INCREMENTWRAP, STENCILOP_INVERT, STENCILOP_KEEP, STENCILOP_REPLACE, STENCILOP_ZERO, TEXHINT_ASSET, TEXHINT_LIGHTMAP, TEXHINT_NONE, TEXHINT_SHADOWMAP, TEXTUREDIMENSION_1D, TEXTUREDIMENSION_2D, TEXTUREDIMENSION_2D_ARRAY, TEXTUREDIMENSION_3D, TEXTUREDIMENSION_CUBE, TEXTUREDIMENSION_CUBE_ARRAY, TEXTURELOCK_READ, TEXTURELOCK_WRITE, TEXTUREPROJECTION_CUBE, TEXTUREPROJECTION_EQUIRECT, TEXTUREPROJECTION_NONE, TEXTUREPROJECTION_OCTAHEDRAL, TEXTURETYPE_DEFAULT, TEXTURETYPE_RGBE, TEXTURETYPE_RGBM, TEXTURETYPE_RGBP, TEXTURETYPE_SWIZZLEGGGR, TYPE_FLOAT16, TYPE_FLOAT32, TYPE_INT16, TYPE_INT32, TYPE_INT8, TYPE_UINT16, TYPE_UINT32, TYPE_UINT8, UNIFORMTYPE_BOOL, UNIFORMTYPE_BVEC2, UNIFORMTYPE_BVEC3, UNIFORMTYPE_BVEC4, UNIFORMTYPE_FLOAT, UNIFORMTYPE_FLOATARRAY, UNIFORMTYPE_INT, UNIFORMTYPE_IVEC2, UNIFORMTYPE_IVEC3, UNIFORMTYPE_IVEC4, UNIFORMTYPE_MAT2, UNIFORMTYPE_MAT3, UNIFORMTYPE_MAT4, UNIFORMTYPE_MAT4ARRAY, UNIFORMTYPE_TEXTURE2D, UNIFORMTYPE_TEXTURE2D_ARRAY, UNIFORMTYPE_TEXTURE2D_SHADOW, UNIFORMTYPE_TEXTURE3D, UNIFORMTYPE_TEXTURECUBE, UNIFORMTYPE_TEXTURECUBE_SHADOW, UNIFORMTYPE_VEC2, UNIFORMTYPE_VEC2ARRAY, UNIFORMTYPE_VEC3, UNIFORMTYPE_VEC3ARRAY, UNIFORMTYPE_VEC4, UNIFORMTYPE_VEC4ARRAY, UNIFORM_BUFFER_DEFAULT_SLOT_NAME, bindGroupNames, getPixelFormatArrayType, isCompressedPixelFormat, pixelFormatInfo, semanticToLocation, typedArrayIndexFormats, typedArrayIndexFormatsByteSize, typedArrayToType, typedArrayTypes, typedArrayTypesByteSize, uniformTypeToName, vertexTypesNames };\n","function _extends() {\n  _extends = Object.assign ? Object.assign.bind() : function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}\n\nexport { _extends as extends };\n","const BitPacking = {\n\tset: function (storage, value, shift, mask = 1) {\n\t\tconst data = storage & ~(mask << shift);\n\t\treturn data | value << shift;\n\t},\n\tget: function (storage, shift, mask = 1) {\n\t\treturn storage >> shift & mask;\n\t},\n\tall: function (storage, shift, mask = 1) {\n\t\tconst shifted = mask << shift;\n\t\treturn (storage & shifted) === shifted;\n\t},\n\tany: function (storage, shift, mask = 1) {\n\t\treturn (storage & mask << shift) !== 0;\n\t}\n};\n\nexport { BitPacking };\n","import { BitPacking } from '../../core/math/bit-packing.js';\nimport { BLENDEQUATION_ADD, BLENDMODE_SRC_ALPHA, BLENDMODE_ONE_MINUS_SRC_ALPHA, BLENDMODE_ONE, BLENDMODE_ZERO } from './constants.js';\n\nvar _class;\nconst opMask = 0b111;\nconst factorMask = 0b1111;\nconst colorOpShift = 0;\nconst colorSrcFactorShift = 3;\nconst colorDstFactorShift = 7;\nconst alphaOpShift = 11;\nconst alphaSrcFactorShift = 14;\nconst alphaDstFactorShift = 18;\nconst redWriteShift = 22;\nconst greenWriteShift = 23;\nconst blueWriteShift = 24;\nconst alphaWriteShift = 25;\nconst blendShift = 26;\nconst allWriteMasks = 0b1111;\nconst allWriteShift = redWriteShift;\nclass BlendState {\n\tconstructor(blend = false, colorOp = BLENDEQUATION_ADD, colorSrcFactor = BLENDMODE_ONE, colorDstFactor = BLENDMODE_ZERO, alphaOp, alphaSrcFactor, alphaDstFactor, redWrite = true, greenWrite = true, blueWrite = true, alphaWrite = true) {\n\t\tthis.target0 = 0;\n\t\tthis.setColorBlend(colorOp, colorSrcFactor, colorDstFactor);\n\t\tthis.setAlphaBlend(alphaOp != null ? alphaOp : colorOp, alphaSrcFactor != null ? alphaSrcFactor : colorSrcFactor, alphaDstFactor != null ? alphaDstFactor : colorDstFactor);\n\t\tthis.setColorWrite(redWrite, greenWrite, blueWrite, alphaWrite);\n\t\tthis.blend = blend;\n\t}\n\tset blend(value) {\n\t\tthis.target0 = BitPacking.set(this.target0, value ? 1 : 0, blendShift);\n\t}\n\tget blend() {\n\t\treturn BitPacking.all(this.target0, blendShift);\n\t}\n\tsetColorBlend(op, srcFactor, dstFactor) {\n\t\tthis.target0 = BitPacking.set(this.target0, op, colorOpShift, opMask);\n\t\tthis.target0 = BitPacking.set(this.target0, srcFactor, colorSrcFactorShift, factorMask);\n\t\tthis.target0 = BitPacking.set(this.target0, dstFactor, colorDstFactorShift, factorMask);\n\t}\n\tsetAlphaBlend(op, srcFactor, dstFactor) {\n\t\tthis.target0 = BitPacking.set(this.target0, op, alphaOpShift, opMask);\n\t\tthis.target0 = BitPacking.set(this.target0, srcFactor, alphaSrcFactorShift, factorMask);\n\t\tthis.target0 = BitPacking.set(this.target0, dstFactor, alphaDstFactorShift, factorMask);\n\t}\n\tsetColorWrite(redWrite, greenWrite, blueWrite, alphaWrite) {\n\t\tthis.redWrite = redWrite;\n\t\tthis.greenWrite = greenWrite;\n\t\tthis.blueWrite = blueWrite;\n\t\tthis.alphaWrite = alphaWrite;\n\t}\n\tget colorOp() {\n\t\treturn BitPacking.get(this.target0, colorOpShift, opMask);\n\t}\n\tget colorSrcFactor() {\n\t\treturn BitPacking.get(this.target0, colorSrcFactorShift, factorMask);\n\t}\n\tget colorDstFactor() {\n\t\treturn BitPacking.get(this.target0, colorDstFactorShift, factorMask);\n\t}\n\tget alphaOp() {\n\t\treturn BitPacking.get(this.target0, alphaOpShift, opMask);\n\t}\n\tget alphaSrcFactor() {\n\t\treturn BitPacking.get(this.target0, alphaSrcFactorShift, factorMask);\n\t}\n\tget alphaDstFactor() {\n\t\treturn BitPacking.get(this.target0, alphaDstFactorShift, factorMask);\n\t}\n\tset redWrite(value) {\n\t\tthis.target0 = BitPacking.set(this.target0, value ? 1 : 0, redWriteShift);\n\t}\n\tget redWrite() {\n\t\treturn BitPacking.all(this.target0, redWriteShift);\n\t}\n\tset greenWrite(value) {\n\t\tthis.target0 = BitPacking.set(this.target0, value ? 1 : 0, greenWriteShift);\n\t}\n\tget greenWrite() {\n\t\treturn BitPacking.all(this.target0, greenWriteShift);\n\t}\n\tset blueWrite(value) {\n\t\tthis.target0 = BitPacking.set(this.target0, value ? 1 : 0, blueWriteShift);\n\t}\n\tget blueWrite() {\n\t\treturn BitPacking.all(this.target0, blueWriteShift);\n\t}\n\tset alphaWrite(value) {\n\t\tthis.target0 = BitPacking.set(this.target0, value ? 1 : 0, alphaWriteShift);\n\t}\n\tget alphaWrite() {\n\t\treturn BitPacking.all(this.target0, alphaWriteShift);\n\t}\n\tget allWrite() {\n\t\treturn BitPacking.get(this.target0, allWriteShift, allWriteMasks);\n\t}\n\tcopy(rhs) {\n\t\tthis.target0 = rhs.target0;\n\t\treturn this;\n\t}\n\tclone() {\n\t\tconst clone = new this.constructor();\n\t\treturn clone.copy(this);\n\t}\n\tget key() {\n\t\treturn this.target0;\n\t}\n\tequals(rhs) {\n\t\treturn this.target0 === rhs.target0;\n\t}\n}\n_class = BlendState;\nBlendState.NOBLEND = Object.freeze(new _class());\nBlendState.NOWRITE = Object.freeze(new _class(undefined, undefined, undefined, undefined, undefined, undefined, undefined, false, false, false, false));\nBlendState.ALPHABLEND = Object.freeze(new _class(true, BLENDEQUATION_ADD, BLENDMODE_SRC_ALPHA, BLENDMODE_ONE_MINUS_SRC_ALPHA));\nBlendState.ADDBLEND = Object.freeze(new _class(true, BLENDEQUATION_ADD, BLENDMODE_ONE, BLENDMODE_ONE));\n\nexport { BlendState };\n","import { BitPacking } from '../../core/math/bit-packing.js';\nimport { FUNC_ALWAYS, FUNC_LESSEQUAL } from './constants.js';\n\nvar _class;\nconst funcMask = 0b111;\nconst funcShift = 0;\nconst writeShift = 3;\nclass DepthState {\n\tconstructor(func = FUNC_LESSEQUAL, write = true) {\n\t\tthis.data = 0;\n\t\tthis.func = func;\n\t\tthis.write = write;\n\t}\n\tset test(value) {\n\t\tthis.func = value ? FUNC_LESSEQUAL : FUNC_ALWAYS;\n\t}\n\tget test() {\n\t\treturn this.func !== FUNC_ALWAYS;\n\t}\n\tset write(value) {\n\t\tthis.data = BitPacking.set(this.data, value ? 1 : 0, writeShift);\n\t}\n\tget write() {\n\t\treturn BitPacking.all(this.data, writeShift);\n\t}\n\tset func(value) {\n\t\tthis.data = BitPacking.set(this.data, value, funcShift, funcMask);\n\t}\n\tget func() {\n\t\treturn BitPacking.get(this.data, funcShift, funcMask);\n\t}\n\tcopy(rhs) {\n\t\tthis.data = rhs.data;\n\t\treturn this;\n\t}\n\tclone() {\n\t\tconst clone = new this.constructor();\n\t\treturn clone.copy(this);\n\t}\n\tget key() {\n\t\treturn this.data;\n\t}\n\tequals(rhs) {\n\t\treturn this.data === rhs.data;\n\t}\n}\n_class = DepthState;\nDepthState.DEFAULT = Object.freeze(new _class());\nDepthState.NODEPTH = Object.freeze(new _class(FUNC_ALWAYS, false));\nDepthState.WRITEDEPTH = Object.freeze(new _class(FUNC_ALWAYS, true));\n\nexport { DepthState };\n","class Version {\n\tconstructor() {\n\t\tthis.globalId = 0;\n\t\tthis.revision = 0;\n\t}\n\tequals(other) {\n\t\treturn this.globalId === other.globalId && this.revision === other.revision;\n\t}\n\tcopy(other) {\n\t\tthis.globalId = other.globalId;\n\t\tthis.revision = other.revision;\n\t}\n\treset() {\n\t\tthis.globalId = 0;\n\t\tthis.revision = 0;\n\t}\n}\n\nexport { Version };\n","import { Version } from './version.js';\n\nlet idCounter = 0;\nclass VersionedObject {\n\tconstructor() {\n\t\tidCounter++;\n\t\tthis.version = new Version();\n\t\tthis.version.globalId = idCounter;\n\t}\n\tincrement() {\n\t\tthis.version.revision++;\n\t}\n}\n\nexport { VersionedObject };\n","import { VersionedObject } from './versioned-object.js';\n\nclass ScopeId {\n\tconstructor(name) {\n\t\tthis.name = name;\n\t\tthis.value = null;\n\t\tthis.versionObject = new VersionedObject();\n\t}\n\ttoJSON(key) {\n\t\treturn undefined;\n\t}\n\tsetValue(value) {\n\t\tthis.value = value;\n\t\tthis.versionObject.increment();\n\t}\n\tgetValue() {\n\t\treturn this.value;\n\t}\n}\n\nexport { ScopeId };\n","import { ScopeId } from './scope-id.js';\n\nclass ScopeSpace {\n\tconstructor(name) {\n\t\tthis.name = name;\n\t\tthis.variables = new Map();\n\t}\n\tresolve(name) {\n\t\tif (!this.variables.has(name)) {\n\t\t\tthis.variables.set(name, new ScopeId(name));\n\t\t}\n\t\treturn this.variables.get(name);\n\t}\n\tremoveValue(value) {\n\t\tfor (const uniformName in this.variables) {\n\t\t\tconst uniform = this.variables[uniformName];\n\t\t\tif (uniform.value === value) {\n\t\t\t\tuniform.value = null;\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport { ScopeSpace };\n","import '../../core/tracing.js';\nimport { BUFFER_STATIC } from './constants.js';\n\nlet id = 0;\nclass VertexBuffer {\n\tconstructor(graphicsDevice, format, numVertices, usage = BUFFER_STATIC, initialData) {\n\t\tthis.device = graphicsDevice;\n\t\tthis.format = format;\n\t\tthis.numVertices = numVertices;\n\t\tthis.usage = usage;\n\t\tthis.id = id++;\n\t\tthis.impl = graphicsDevice.createVertexBufferImpl(this, format);\n\t\tthis.numBytes = format.verticesByteSize ? format.verticesByteSize : format.size * numVertices;\n\t\tthis.adjustVramSizeTracking(graphicsDevice._vram, this.numBytes);\n\t\tif (initialData) {\n\t\t\tthis.setData(initialData);\n\t\t} else {\n\t\t\tthis.storage = new ArrayBuffer(this.numBytes);\n\t\t}\n\t\tthis.device.buffers.push(this);\n\t}\n\tdestroy() {\n\t\tconst device = this.device;\n\t\tconst idx = device.buffers.indexOf(this);\n\t\tif (idx !== -1) {\n\t\t\tdevice.buffers.splice(idx, 1);\n\t\t}\n\t\tif (this.impl.initialized) {\n\t\t\tthis.impl.destroy(device);\n\t\t\tthis.adjustVramSizeTracking(device._vram, -this.storage.byteLength);\n\t\t}\n\t}\n\tadjustVramSizeTracking(vram, size) {\n\t\tvram.vb += size;\n\t}\n\tloseContext() {\n\t\tthis.impl.loseContext();\n\t}\n\tgetFormat() {\n\t\treturn this.format;\n\t}\n\tgetUsage() {\n\t\treturn this.usage;\n\t}\n\tgetNumVertices() {\n\t\treturn this.numVertices;\n\t}\n\tlock() {\n\t\treturn this.storage;\n\t}\n\tunlock() {\n\t\tthis.impl.unlock(this);\n\t}\n\tsetData(data) {\n\t\tif (data.byteLength !== this.numBytes) {\n\t\t\treturn false;\n\t\t}\n\t\tthis.storage = data;\n\t\tthis.unlock();\n\t\treturn true;\n\t}\n}\n\nexport { VertexBuffer };\n","function hashCode(str) {\n\tlet hash = 0;\n\tfor (let i = 0, len = str.length; i < len; i++) {\n\t\thash = (hash << 5) - hash + str.charCodeAt(i);\n\t\thash |= 0;\n\t}\n\treturn hash;\n}\nfunction hash32Fnv1a(array) {\n\tconst prime = 16777619;\n\tlet hash = 2166136261;\n\tfor (let i = 0; i < array.length; i++) {\n\t\thash ^= array[i];\n\t\thash *= prime;\n\t}\n\treturn hash >>> 0;\n}\n\nexport { hash32Fnv1a, hashCode };\n","class StringIds {\n\tconstructor() {\n\t\tthis.map = new Map();\n\t\tthis.id = 0;\n\t}\n\tget(name) {\n\t\tlet value = this.map.get(name);\n\t\tif (value === undefined) {\n\t\t\tvalue = this.id++;\n\t\t\tthis.map.set(name, value);\n\t\t}\n\t\treturn value;\n\t}\n}\n\nexport { StringIds };\n","import '../../core/tracing.js';\nimport { hashCode } from '../../core/hash.js';\nimport { math } from '../../core/math/math.js';\nimport { StringIds } from '../../core/string-ids.js';\nimport { typedArrayTypesByteSize, SEMANTIC_TEXCOORD0, SEMANTIC_TEXCOORD1, SEMANTIC_COLOR, SEMANTIC_TANGENT, SEMANTIC_ATTR12, TYPE_FLOAT32, SEMANTIC_ATTR13, SEMANTIC_ATTR14, SEMANTIC_ATTR15 } from './constants.js';\n\nconst stringIds = new StringIds();\nconst webgpuValidElementSizes = [2, 4, 8, 12, 16];\nclass VertexFormat {\n\tconstructor(graphicsDevice, description, vertexCount) {\n\t\tthis.device = graphicsDevice;\n\t\tthis._elements = [];\n\t\tthis.hasUv0 = false;\n\t\tthis.hasUv1 = false;\n\t\tthis.hasColor = false;\n\t\tthis.hasTangents = false;\n\t\tthis.verticesByteSize = 0;\n\t\tthis.vertexCount = vertexCount;\n\t\tthis.interleaved = vertexCount === undefined;\n\t\tthis.instancing = false;\n\t\tthis.size = description.reduce((total, desc) => {\n\t\t\treturn total + Math.ceil(desc.components * typedArrayTypesByteSize[desc.type] / 4) * 4;\n\t\t}, 0);\n\t\tlet offset = 0,\n\t\t\telementSize;\n\t\tfor (let i = 0, len = description.length; i < len; i++) {\n\t\t\tvar _elementDesc$asInt, _elementDesc$normaliz;\n\t\t\tconst elementDesc = description[i];\n\t\t\telementSize = elementDesc.components * typedArrayTypesByteSize[elementDesc.type];\n\t\t\tif (vertexCount) {\n\t\t\t\toffset = math.roundUp(offset, elementSize);\n\t\t\t}\n\t\t\tconst asInt = (_elementDesc$asInt = elementDesc.asInt) != null ? _elementDesc$asInt : false;\n\t\t\tconst normalize = asInt ? false : (_elementDesc$normaliz = elementDesc.normalize) != null ? _elementDesc$normaliz : false;\n\t\t\tconst element = {\n\t\t\t\tname: elementDesc.semantic,\n\t\t\t\toffset: vertexCount ? offset : elementDesc.hasOwnProperty('offset') ? elementDesc.offset : offset,\n\t\t\t\tstride: vertexCount ? elementSize : elementDesc.hasOwnProperty('stride') ? elementDesc.stride : this.size,\n\t\t\t\tdataType: elementDesc.type,\n\t\t\t\tnumComponents: elementDesc.components,\n\t\t\t\tnormalize: normalize,\n\t\t\t\tsize: elementSize,\n\t\t\t\tasInt: asInt\n\t\t\t};\n\t\t\tthis._elements.push(element);\n\t\t\tif (vertexCount) {\n\t\t\t\toffset += elementSize * vertexCount;\n\t\t\t} else {\n\t\t\t\toffset += Math.ceil(elementSize / 4) * 4;\n\t\t\t}\n\t\t\tif (elementDesc.semantic === SEMANTIC_TEXCOORD0) {\n\t\t\t\tthis.hasUv0 = true;\n\t\t\t} else if (elementDesc.semantic === SEMANTIC_TEXCOORD1) {\n\t\t\t\tthis.hasUv1 = true;\n\t\t\t} else if (elementDesc.semantic === SEMANTIC_COLOR) {\n\t\t\t\tthis.hasColor = true;\n\t\t\t} else if (elementDesc.semantic === SEMANTIC_TANGENT) {\n\t\t\t\tthis.hasTangents = true;\n\t\t\t}\n\t\t}\n\t\tif (vertexCount) {\n\t\t\tthis.verticesByteSize = offset;\n\t\t}\n\t\tthis._evaluateHash();\n\t}\n\tget elements() {\n\t\treturn this._elements;\n\t}\n\tstatic getDefaultInstancingFormat(graphicsDevice) {\n\t\tif (!VertexFormat._defaultInstancingFormat) {\n\t\t\tVertexFormat._defaultInstancingFormat = new VertexFormat(graphicsDevice, [{\n\t\t\t\tsemantic: SEMANTIC_ATTR12,\n\t\t\t\tcomponents: 4,\n\t\t\t\ttype: TYPE_FLOAT32\n\t\t\t}, {\n\t\t\t\tsemantic: SEMANTIC_ATTR13,\n\t\t\t\tcomponents: 4,\n\t\t\t\ttype: TYPE_FLOAT32\n\t\t\t}, {\n\t\t\t\tsemantic: SEMANTIC_ATTR14,\n\t\t\t\tcomponents: 4,\n\t\t\t\ttype: TYPE_FLOAT32\n\t\t\t}, {\n\t\t\t\tsemantic: SEMANTIC_ATTR15,\n\t\t\t\tcomponents: 4,\n\t\t\t\ttype: TYPE_FLOAT32\n\t\t\t}]);\n\t\t}\n\t\treturn VertexFormat._defaultInstancingFormat;\n\t}\n\tstatic isElementValid(graphicsDevice, elementDesc) {\n\t\tconst elementSize = elementDesc.components * typedArrayTypesByteSize[elementDesc.type];\n\t\tif (graphicsDevice.isWebGPU && !webgpuValidElementSizes.includes(elementSize)) return false;\n\t\treturn true;\n\t}\n\tupdate() {\n\t\tthis._evaluateHash();\n\t}\n\t_evaluateHash() {\n\t\tlet stringElementBatch;\n\t\tconst stringElementsBatch = [];\n\t\tlet stringElementRender;\n\t\tconst stringElementsRender = [];\n\t\tconst len = this._elements.length;\n\t\tfor (let i = 0; i < len; i++) {\n\t\t\tconst element = this._elements[i];\n\t\t\tstringElementBatch = element.name;\n\t\t\tstringElementBatch += element.dataType;\n\t\t\tstringElementBatch += element.numComponents;\n\t\t\tstringElementBatch += element.normalize;\n\t\t\tstringElementsBatch.push(stringElementBatch);\n\t\t\tstringElementRender = stringElementBatch;\n\t\t\tstringElementRender += element.offset;\n\t\t\tstringElementRender += element.stride;\n\t\t\tstringElementRender += element.size;\n\t\t\tstringElementsRender.push(stringElementRender);\n\t\t}\n\t\tstringElementsBatch.sort();\n\t\tthis.batchingHash = hashCode(stringElementsBatch.join());\n\t\tthis.renderingHashString = stringElementsRender.join('_');\n\t\tthis.renderingHash = stringIds.get(this.renderingHashString);\n\t}\n}\nVertexFormat._defaultInstancingFormat = null;\n\nexport { VertexFormat };\n","import { FUNC_ALWAYS, STENCILOP_KEEP } from './constants.js';\nimport { StringIds } from '../../core/string-ids.js';\n\nvar _class;\nconst stringIds = new StringIds();\nclass StencilParameters {\n\tset func(value) {\n\t\tthis._func = value;\n\t\tthis._dirty = true;\n\t}\n\tget func() {\n\t\treturn this._func;\n\t}\n\tset ref(value) {\n\t\tthis._ref = value;\n\t\tthis._dirty = true;\n\t}\n\tget ref() {\n\t\treturn this._ref;\n\t}\n\tset fail(value) {\n\t\tthis._fail = value;\n\t\tthis._dirty = true;\n\t}\n\tget fail() {\n\t\treturn this._fail;\n\t}\n\tset zfail(value) {\n\t\tthis._zfail = value;\n\t\tthis._dirty = true;\n\t}\n\tget zfail() {\n\t\treturn this._zfail;\n\t}\n\tset zpass(value) {\n\t\tthis._zpass = value;\n\t\tthis._dirty = true;\n\t}\n\tget zpass() {\n\t\treturn this._zpass;\n\t}\n\tset readMask(value) {\n\t\tthis._readMask = value;\n\t\tthis._dirty = true;\n\t}\n\tget readMask() {\n\t\treturn this._readMask;\n\t}\n\tset writeMask(value) {\n\t\tthis._writeMask = value;\n\t\tthis._dirty = true;\n\t}\n\tget writeMask() {\n\t\treturn this._writeMask;\n\t}\n\tconstructor(options = {}) {\n\t\tvar _options$func, _options$ref, _options$readMask, _options$writeMask, _options$fail, _options$zfail, _options$zpass;\n\t\tthis._func = void 0;\n\t\tthis._ref = void 0;\n\t\tthis._fail = void 0;\n\t\tthis._zfail = void 0;\n\t\tthis._zpass = void 0;\n\t\tthis._readMask = void 0;\n\t\tthis._writeMask = void 0;\n\t\tthis._dirty = true;\n\t\tthis._key = void 0;\n\t\tthis._func = (_options$func = options.func) != null ? _options$func : FUNC_ALWAYS;\n\t\tthis._ref = (_options$ref = options.ref) != null ? _options$ref : 0;\n\t\tthis._readMask = (_options$readMask = options.readMask) != null ? _options$readMask : 0xFF;\n\t\tthis._writeMask = (_options$writeMask = options.writeMask) != null ? _options$writeMask : 0xFF;\n\t\tthis._fail = (_options$fail = options.fail) != null ? _options$fail : STENCILOP_KEEP;\n\t\tthis._zfail = (_options$zfail = options.zfail) != null ? _options$zfail : STENCILOP_KEEP;\n\t\tthis._zpass = (_options$zpass = options.zpass) != null ? _options$zpass : STENCILOP_KEEP;\n\t\tthis._evalKey();\n\t}\n\t_evalKey() {\n\t\tconst {\n\t\t\t_func,\n\t\t\t_ref,\n\t\t\t_fail,\n\t\t\t_zfail,\n\t\t\t_zpass,\n\t\t\t_readMask,\n\t\t\t_writeMask\n\t\t} = this;\n\t\tconst key = `${_func},${_ref},${_fail},${_zfail},${_zpass},${_readMask},${_writeMask}`;\n\t\tthis._key = stringIds.get(key);\n\t\tthis._dirty = false;\n\t}\n\tget key() {\n\t\tif (this._dirty) {\n\t\t\tthis._evalKey();\n\t\t}\n\t\treturn this._key;\n\t}\n\tcopy(rhs) {\n\t\tthis._func = rhs._func;\n\t\tthis._ref = rhs._ref;\n\t\tthis._readMask = rhs._readMask;\n\t\tthis._writeMask = rhs._writeMask;\n\t\tthis._fail = rhs._fail;\n\t\tthis._zfail = rhs._zfail;\n\t\tthis._zpass = rhs._zpass;\n\t\tthis._dirty = rhs._dirty;\n\t\tthis._key = rhs._key;\n\t\treturn this;\n\t}\n\tclone() {\n\t\tconst clone = new this.constructor();\n\t\treturn clone.copy(this);\n\t}\n}\n_class = StencilParameters;\nStencilParameters.DEFAULT = Object.freeze(new _class());\n\nexport { StencilParameters };\n","import { extends as _extends } from '../../_virtual/_rollupPluginBabelHelpers.js';\nimport '../../core/tracing.js';\nimport { EventHandler } from '../../core/event-handler.js';\nimport { platform } from '../../core/platform.js';\nimport '../../core/time.js';\nimport { Vec2 } from '../../core/math/vec2.js';\nimport { CLEARFLAG_COLOR, CLEARFLAG_DEPTH, PRIMITIVE_TRIFAN, SEMANTIC_POSITION, TYPE_FLOAT32, BUFFER_STATIC, CULLFACE_BACK, PIXELFORMAT_RGBA32F, PIXELFORMAT_RGBA16F, PIXELFORMAT_111110F, PRIMITIVE_POINTS } from './constants.js';\nimport { BlendState } from './blend-state.js';\nimport { DepthState } from './depth-state.js';\nimport { ScopeSpace } from './scope-space.js';\nimport { VertexBuffer } from './vertex-buffer.js';\nimport { VertexFormat } from './vertex-format.js';\nimport { StencilParameters } from './stencil-parameters.js';\n\nclass GraphicsDevice extends EventHandler {\n\tconstructor(canvas, options) {\n\t\tvar _this$initOptions, _this$initOptions$dep, _this$initOptions2, _this$initOptions2$st, _this$initOptions3, _this$initOptions3$an, _this$initOptions4, _this$initOptions4$po;\n\t\tsuper();\n\t\tthis.canvas = void 0;\n\t\tthis.backBuffer = null;\n\t\tthis.backBufferSize = new Vec2();\n\t\tthis.backBufferFormat = void 0;\n\t\tthis.backBufferAntialias = false;\n\t\tthis.isWebGPU = false;\n\t\tthis.isWebGL1 = false;\n\t\tthis.isWebGL2 = false;\n\t\tthis.scope = void 0;\n\t\tthis.boneLimit = void 0;\n\t\tthis.maxAnisotropy = void 0;\n\t\tthis.maxCubeMapSize = void 0;\n\t\tthis.maxTextureSize = void 0;\n\t\tthis.maxVolumeSize = void 0;\n\t\tthis.maxColorAttachments = 1;\n\t\tthis.precision = void 0;\n\t\tthis.samples = void 0;\n\t\tthis.supportsStencil = void 0;\n\t\tthis.supportsMrt = false;\n\t\tthis.supportsVolumeTextures = false;\n\t\tthis.supportsCompute = false;\n\t\tthis.renderTarget = null;\n\t\tthis.shaders = [];\n\t\tthis.textures = [];\n\t\tthis.targets = new Set();\n\t\tthis.renderVersion = 0;\n\t\tthis.renderPassIndex = void 0;\n\t\tthis.insideRenderPass = false;\n\t\tthis.supportsInstancing = void 0;\n\t\tthis.supportsUniformBuffers = false;\n\t\tthis.textureFloatRenderable = void 0;\n\t\tthis.textureHalfFloatRenderable = void 0;\n\t\tthis.textureFloatFilterable = false;\n\t\tthis.textureHalfFloatFilterable = false;\n\t\tthis.quadVertexBuffer = void 0;\n\t\tthis.blendState = new BlendState();\n\t\tthis.depthState = new DepthState();\n\t\tthis.stencilEnabled = false;\n\t\tthis.stencilFront = new StencilParameters();\n\t\tthis.stencilBack = new StencilParameters();\n\t\tthis.dynamicBuffers = void 0;\n\t\tthis.gpuProfiler = void 0;\n\t\tthis.defaultClearOptions = {\n\t\t\tcolor: [0, 0, 0, 1],\n\t\t\tdepth: 1,\n\t\t\tstencil: 0,\n\t\t\tflags: CLEARFLAG_COLOR | CLEARFLAG_DEPTH\n\t\t};\n\t\tthis.canvas = canvas;\n\t\tthis.initOptions = _extends({}, options);\n\t\t(_this$initOptions$dep = (_this$initOptions = this.initOptions).depth) != null ? _this$initOptions$dep : _this$initOptions.depth = true;\n\t\t(_this$initOptions2$st = (_this$initOptions2 = this.initOptions).stencil) != null ? _this$initOptions2$st : _this$initOptions2.stencil = true;\n\t\t(_this$initOptions3$an = (_this$initOptions3 = this.initOptions).antialias) != null ? _this$initOptions3$an : _this$initOptions3.antialias = true;\n\t\t(_this$initOptions4$po = (_this$initOptions4 = this.initOptions).powerPreference) != null ? _this$initOptions4$po : _this$initOptions4.powerPreference = 'high-performance';\n\t\tthis._maxPixelRatio = platform.browser ? Math.min(1, window.devicePixelRatio) : 1;\n\t\tthis.buffers = [];\n\t\tthis._vram = {\n\t\t\ttex: 0,\n\t\t\tvb: 0,\n\t\t\tib: 0,\n\t\t\tub: 0\n\t\t};\n\t\tthis._shaderStats = {\n\t\t\tvsCompiled: 0,\n\t\t\tfsCompiled: 0,\n\t\t\tlinked: 0,\n\t\t\tmaterialShaders: 0,\n\t\t\tcompileTime: 0\n\t\t};\n\t\tthis.initializeContextCaches();\n\t\tthis._drawCallsPerFrame = 0;\n\t\tthis._shaderSwitchesPerFrame = 0;\n\t\tthis._primsPerFrame = [];\n\t\tfor (let i = PRIMITIVE_POINTS; i <= PRIMITIVE_TRIFAN; i++) {\n\t\t\tthis._primsPerFrame[i] = 0;\n\t\t}\n\t\tthis._renderTargetCreationTime = 0;\n\t\tthis.scope = new ScopeSpace(\"Device\");\n\t\tthis.textureBias = this.scope.resolve(\"textureBias\");\n\t\tthis.textureBias.setValue(0.0);\n\t}\n\tpostInit() {\n\t\tconst vertexFormat = new VertexFormat(this, [{\n\t\t\tsemantic: SEMANTIC_POSITION,\n\t\t\tcomponents: 2,\n\t\t\ttype: TYPE_FLOAT32\n\t\t}]);\n\t\tconst positions = new Float32Array([-1, -1, 1, -1, -1, 1, 1, 1]);\n\t\tthis.quadVertexBuffer = new VertexBuffer(this, vertexFormat, 4, BUFFER_STATIC, positions);\n\t}\n\tdestroy() {\n\t\tvar _this$quadVertexBuffe, _this$dynamicBuffers, _this$gpuProfiler;\n\t\tthis.fire('destroy');\n\t\t(_this$quadVertexBuffe = this.quadVertexBuffer) == null || _this$quadVertexBuffe.destroy();\n\t\tthis.quadVertexBuffer = null;\n\t\t(_this$dynamicBuffers = this.dynamicBuffers) == null || _this$dynamicBuffers.destroy();\n\t\tthis.dynamicBuffers = null;\n\t\t(_this$gpuProfiler = this.gpuProfiler) == null || _this$gpuProfiler.destroy();\n\t\tthis.gpuProfiler = null;\n\t}\n\tonDestroyShader(shader) {\n\t\tthis.fire('destroy:shader', shader);\n\t\tconst idx = this.shaders.indexOf(shader);\n\t\tif (idx !== -1) {\n\t\t\tthis.shaders.splice(idx, 1);\n\t\t}\n\t}\n\tpostDestroy() {\n\t\tthis.scope = null;\n\t\tthis.canvas = null;\n\t}\n\ttoJSON(key) {\n\t\treturn undefined;\n\t}\n\tinitializeContextCaches() {\n\t\tthis.indexBuffer = null;\n\t\tthis.vertexBuffers = [];\n\t\tthis.shader = null;\n\t\tthis.renderTarget = null;\n\t}\n\tinitializeRenderState() {\n\t\tthis.blendState = new BlendState();\n\t\tthis.depthState = new DepthState();\n\t\tthis.cullMode = CULLFACE_BACK;\n\t\tthis.vx = this.vy = this.vw = this.vh = 0;\n\t\tthis.sx = this.sy = this.sw = this.sh = 0;\n\t}\n\tsetStencilState(stencilFront, stencilBack) {}\n\tsetBlendState(blendState) {}\n\tsetDepthState(depthState) {}\n\tsetCullMode(cullMode) {}\n\tsetRenderTarget(renderTarget) {\n\t\tthis.renderTarget = renderTarget;\n\t}\n\tsetIndexBuffer(indexBuffer) {\n\t\tthis.indexBuffer = indexBuffer;\n\t}\n\tsetVertexBuffer(vertexBuffer) {\n\t\tif (vertexBuffer) {\n\t\t\tthis.vertexBuffers.push(vertexBuffer);\n\t\t}\n\t}\n\tgetRenderTarget() {\n\t\treturn this.renderTarget;\n\t}\n\tinitRenderTarget(target) {\n\t\tif (target.initialized) return;\n\t\ttarget.init();\n\t\tthis.targets.add(target);\n\t}\n\t_isBrowserInterface(texture) {\n\t\treturn this._isImageBrowserInterface(texture) || this._isImageCanvasInterface(texture) || this._isImageVideoInterface(texture);\n\t}\n\t_isImageBrowserInterface(texture) {\n\t\treturn typeof ImageBitmap !== 'undefined' && texture instanceof ImageBitmap || typeof HTMLImageElement !== 'undefined' && texture instanceof HTMLImageElement;\n\t}\n\t_isImageCanvasInterface(texture) {\n\t\treturn typeof HTMLCanvasElement !== 'undefined' && texture instanceof HTMLCanvasElement;\n\t}\n\t_isImageVideoInterface(texture) {\n\t\treturn typeof HTMLVideoElement !== 'undefined' && texture instanceof HTMLVideoElement;\n\t}\n\tresizeCanvas(width, height) {\n\t\tconst pixelRatio = Math.min(this._maxPixelRatio, platform.browser ? window.devicePixelRatio : 1);\n\t\tconst w = Math.floor(width * pixelRatio);\n\t\tconst h = Math.floor(height * pixelRatio);\n\t\tif (w !== this.canvas.width || h !== this.canvas.height) {\n\t\t\tthis.setResolution(w, h);\n\t\t}\n\t}\n\tsetResolution(width, height) {\n\t\tthis.canvas.width = width;\n\t\tthis.canvas.height = height;\n\t\tthis.fire(GraphicsDevice.EVENT_RESIZE, width, height);\n\t}\n\tupdateClientRect() {\n\t\tthis.clientRect = this.canvas.getBoundingClientRect();\n\t}\n\tget width() {\n\t\treturn this.canvas.width;\n\t}\n\tget height() {\n\t\treturn this.canvas.height;\n\t}\n\tset fullscreen(fullscreen) {}\n\tget fullscreen() {\n\t\treturn false;\n\t}\n\tset maxPixelRatio(ratio) {\n\t\tthis._maxPixelRatio = ratio;\n\t}\n\tget maxPixelRatio() {\n\t\treturn this._maxPixelRatio;\n\t}\n\tget deviceType() {\n\t\treturn this._deviceType;\n\t}\n\tgetBoneLimit() {\n\t\treturn this.boneLimit;\n\t}\n\tsetBoneLimit(maxBones) {\n\t\tthis.boneLimit = maxBones;\n\t}\n\tstartRenderPass(renderPass) {}\n\tendRenderPass(renderPass) {}\n\tstartComputePass() {}\n\tendComputePass() {}\n\tframeStart() {\n\t\tthis.renderPassIndex = 0;\n\t\tthis.renderVersion++;\n\t}\n\tframeEnd() {}\n\tgetRenderableHdrFormat(formats = [PIXELFORMAT_111110F, PIXELFORMAT_RGBA16F, PIXELFORMAT_RGBA32F], filterable = true) {\n\t\tfor (let i = 0; i < formats.length; i++) {\n\t\t\tconst format = formats[i];\n\t\t\tswitch (format) {\n\t\t\t\tcase PIXELFORMAT_111110F:\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.textureRG11B10Renderable) return format;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tcase PIXELFORMAT_RGBA16F:\n\t\t\t\t\tif (this.textureHalfFloatRenderable && (!filterable || this.textureHalfFloatFilterable)) {\n\t\t\t\t\t\treturn format;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase PIXELFORMAT_RGBA32F:\n\t\t\t\t\tif (this.textureFloatRenderable && (!filterable || this.textureFloatFilterable)) {\n\t\t\t\t\t\treturn format;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n}\nGraphicsDevice.EVENT_RESIZE = 'resizecanvas';\n\nexport { GraphicsDevice };\n","import '../../core/tracing.js';\nimport { PIXELFORMAT_DEPTH, PIXELFORMAT_DEPTHSTENCIL } from './constants.js';\nimport { GraphicsDevice } from './graphics-device.js';\n\nlet id = 0;\nclass RenderTarget {\n\tconstructor(options = {}) {\n\t\tvar _options$face, _this$_colorBuffer, _this$_depthBuffer, _this$_colorBuffers, _options$samples, _options$autoResolve, _options$flipY;\n\t\tthis.name = void 0;\n\t\tthis._device = void 0;\n\t\tthis._colorBuffer = void 0;\n\t\tthis._colorBuffers = void 0;\n\t\tthis._depthBuffer = void 0;\n\t\tthis._depth = void 0;\n\t\tthis._stencil = void 0;\n\t\tthis._samples = void 0;\n\t\tthis.autoResolve = void 0;\n\t\tthis._face = void 0;\n\t\tthis.flipY = void 0;\n\t\tthis.id = id++;\n\t\tconst _arg2 = arguments[1];\n\t\tconst _arg3 = arguments[2];\n\t\tif (options instanceof GraphicsDevice) {\n\t\t\tthis._colorBuffer = _arg2;\n\t\t\toptions = _arg3;\n\t\t} else {\n\t\t\tthis._colorBuffer = options.colorBuffer;\n\t\t}\n\t\tif (this._colorBuffer) {\n\t\t\tthis._colorBuffers = [this._colorBuffer];\n\t\t}\n\t\tthis._depthBuffer = options.depthBuffer;\n\t\tthis._face = (_options$face = options.face) != null ? _options$face : 0;\n\t\tif (this._depthBuffer) {\n\t\t\tconst format = this._depthBuffer._format;\n\t\t\tif (format === PIXELFORMAT_DEPTH) {\n\t\t\t\tthis._depth = true;\n\t\t\t\tthis._stencil = false;\n\t\t\t} else if (format === PIXELFORMAT_DEPTHSTENCIL) {\n\t\t\t\tthis._depth = true;\n\t\t\t\tthis._stencil = true;\n\t\t\t} else {\n\t\t\t\tthis._depth = false;\n\t\t\t\tthis._stencil = false;\n\t\t\t}\n\t\t} else {\n\t\t\tvar _options$depth, _options$stencil;\n\t\t\tthis._depth = (_options$depth = options.depth) != null ? _options$depth : true;\n\t\t\tthis._stencil = (_options$stencil = options.stencil) != null ? _options$stencil : false;\n\t\t}\n\t\tif (options.colorBuffers) {\n\t\t\tif (!this._colorBuffers) {\n\t\t\t\tthis._colorBuffers = [...options.colorBuffers];\n\t\t\t\tthis._colorBuffer = options.colorBuffers[0];\n\t\t\t}\n\t\t}\n\t\tconst device = ((_this$_colorBuffer = this._colorBuffer) == null ? void 0 : _this$_colorBuffer.device) || ((_this$_depthBuffer = this._depthBuffer) == null ? void 0 : _this$_depthBuffer.device) || options.graphicsDevice;\n\t\tthis._device = device;\n\t\t(_this$_colorBuffers = this._colorBuffers) == null || _this$_colorBuffers.forEach(colorBuffer => {\n\t\t\tcolorBuffer._isRenderTarget = true;\n\t\t});\n\t\tconst {\n\t\t\tmaxSamples\n\t\t} = this._device;\n\t\tthis._samples = Math.min((_options$samples = options.samples) != null ? _options$samples : 1, maxSamples);\n\t\tif (device.isWebGPU) {\n\t\t\tthis._samples = this._samples > 1 ? maxSamples : 1;\n\t\t}\n\t\tthis.autoResolve = (_options$autoResolve = options.autoResolve) != null ? _options$autoResolve : true;\n\t\tthis.name = options.name;\n\t\tif (!this.name) {\n\t\t\tvar _this$_colorBuffer2;\n\t\t\tthis.name = (_this$_colorBuffer2 = this._colorBuffer) == null ? void 0 : _this$_colorBuffer2.name;\n\t\t}\n\t\tif (!this.name) {\n\t\t\tvar _this$_depthBuffer2;\n\t\t\tthis.name = (_this$_depthBuffer2 = this._depthBuffer) == null ? void 0 : _this$_depthBuffer2.name;\n\t\t}\n\t\tif (!this.name) {\n\t\t\tthis.name = \"Untitled\";\n\t\t}\n\t\tthis.flipY = (_options$flipY = options.flipY) != null ? _options$flipY : false;\n\t\tthis.validateMrt();\n\t\tthis.impl = device.createRenderTargetImpl(this);\n\t}\n\tdestroy() {\n\t\tconst device = this._device;\n\t\tif (device) {\n\t\t\tdevice.targets.delete(this);\n\t\t\tif (device.renderTarget === this) {\n\t\t\t\tdevice.setRenderTarget(null);\n\t\t\t}\n\t\t\tthis.destroyFrameBuffers();\n\t\t}\n\t}\n\tdestroyFrameBuffers() {\n\t\tconst device = this._device;\n\t\tif (device) {\n\t\t\tthis.impl.destroy(device);\n\t\t}\n\t}\n\tdestroyTextureBuffers() {\n\t\tvar _this$_depthBuffer3, _this$_colorBuffers2;\n\t\t(_this$_depthBuffer3 = this._depthBuffer) == null || _this$_depthBuffer3.destroy();\n\t\tthis._depthBuffer = null;\n\t\t(_this$_colorBuffers2 = this._colorBuffers) == null || _this$_colorBuffers2.forEach(colorBuffer => {\n\t\t\tcolorBuffer.destroy();\n\t\t});\n\t\tthis._colorBuffers = null;\n\t\tthis._colorBuffer = null;\n\t}\n\tresize(width, height) {\n\t\tif (this.width !== width || this.height !== height) {\n\t\t\tvar _this$_depthBuffer4, _this$_colorBuffers3;\n\t\t\tconst device = this._device;\n\t\t\tthis.destroyFrameBuffers();\n\t\t\tif (device.renderTarget === this) {\n\t\t\t\tdevice.setRenderTarget(null);\n\t\t\t}\n\t\t\t(_this$_depthBuffer4 = this._depthBuffer) == null || _this$_depthBuffer4.resize(width, height);\n\t\t\t(_this$_colorBuffers3 = this._colorBuffers) == null || _this$_colorBuffers3.forEach(colorBuffer => {\n\t\t\t\tcolorBuffer.resize(width, height);\n\t\t\t});\n\t\t\tthis.validateMrt();\n\t\t\tthis.impl = device.createRenderTargetImpl(this);\n\t\t}\n\t}\n\tvalidateMrt() {}\n\tinit() {\n\t\tthis.impl.init(this._device, this);\n\t}\n\tget initialized() {\n\t\treturn this.impl.initialized;\n\t}\n\tget device() {\n\t\treturn this._device;\n\t}\n\tloseContext() {\n\t\tthis.impl.loseContext();\n\t}\n\tresolve(color = true, depth = !!this._depthBuffer) {\n\t\tif (this._device && this._samples > 1) {\n\t\t\tthis.impl.resolve(this._device, this, color, depth);\n\t\t}\n\t}\n\tcopy(source, color, depth) {\n\t\tif (!this._device) {\n\t\t\tif (source._device) {\n\t\t\t\tthis._device = source._device;\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\tconst success = this._device.copyRenderTarget(source, this, color, depth);\n\t\treturn success;\n\t}\n\tget samples() {\n\t\treturn this._samples;\n\t}\n\tget depth() {\n\t\treturn this._depth;\n\t}\n\tget stencil() {\n\t\treturn this._stencil;\n\t}\n\tget colorBuffer() {\n\t\treturn this._colorBuffer;\n\t}\n\tgetColorBuffer(index) {\n\t\tvar _this$_colorBuffers4;\n\t\treturn (_this$_colorBuffers4 = this._colorBuffers) == null ? void 0 : _this$_colorBuffers4[index];\n\t}\n\tget depthBuffer() {\n\t\treturn this._depthBuffer;\n\t}\n\tget face() {\n\t\treturn this._face;\n\t}\n\tget width() {\n\t\tvar _this$_colorBuffer3, _this$_depthBuffer5;\n\t\treturn ((_this$_colorBuffer3 = this._colorBuffer) == null ? void 0 : _this$_colorBuffer3.width) || ((_this$_depthBuffer5 = this._depthBuffer) == null ? void 0 : _this$_depthBuffer5.width) || this._device.width;\n\t}\n\tget height() {\n\t\tvar _this$_colorBuffer4, _this$_depthBuffer6;\n\t\treturn ((_this$_colorBuffer4 = this._colorBuffer) == null ? void 0 : _this$_colorBuffer4.height) || ((_this$_depthBuffer6 = this._depthBuffer) == null ? void 0 : _this$_depthBuffer6.height) || this._device.height;\n\t}\n}\n\nexport { RenderTarget };\n","import '../../core/tracing.js';\nimport { math } from '../../core/math/math.js';\nimport { UNIFORMTYPE_MAT4, UNIFORMTYPE_MAT4ARRAY, UNIFORMTYPE_VEC4, UNIFORMTYPE_VEC4ARRAY, UNIFORMTYPE_VEC3, UNIFORMTYPE_VEC3ARRAY, UNIFORMTYPE_VEC2, UNIFORMTYPE_VEC2ARRAY, UNIFORMTYPE_FLOAT, UNIFORMTYPE_FLOATARRAY, bindGroupNames, uniformTypeToName, UNIFORMTYPE_INT, UNIFORMTYPE_IVEC2, UNIFORMTYPE_IVEC3, UNIFORMTYPE_IVEC4, UNIFORMTYPE_BOOL, UNIFORMTYPE_BVEC2, UNIFORMTYPE_BVEC3, UNIFORMTYPE_BVEC4, UNIFORMTYPE_MAT2, UNIFORMTYPE_MAT3 } from './constants.js';\n\nconst uniformTypeToNumElements = [];\nuniformTypeToNumElements[UNIFORMTYPE_FLOAT] = 1;\nuniformTypeToNumElements[UNIFORMTYPE_VEC2] = 2;\nuniformTypeToNumElements[UNIFORMTYPE_VEC3] = 3;\nuniformTypeToNumElements[UNIFORMTYPE_VEC4] = 4;\nuniformTypeToNumElements[UNIFORMTYPE_INT] = 1;\nuniformTypeToNumElements[UNIFORMTYPE_IVEC2] = 2;\nuniformTypeToNumElements[UNIFORMTYPE_IVEC3] = 3;\nuniformTypeToNumElements[UNIFORMTYPE_IVEC4] = 4;\nuniformTypeToNumElements[UNIFORMTYPE_BOOL] = 1;\nuniformTypeToNumElements[UNIFORMTYPE_BVEC2] = 2;\nuniformTypeToNumElements[UNIFORMTYPE_BVEC3] = 3;\nuniformTypeToNumElements[UNIFORMTYPE_BVEC4] = 4;\nuniformTypeToNumElements[UNIFORMTYPE_MAT2] = 8;\nuniformTypeToNumElements[UNIFORMTYPE_MAT3] = 12;\nuniformTypeToNumElements[UNIFORMTYPE_MAT4] = 16;\nclass UniformFormat {\n\tconstructor(name, type, count = 0) {\n\t\tthis.name = void 0;\n\t\tthis.type = void 0;\n\t\tthis.byteSize = void 0;\n\t\tthis.offset = void 0;\n\t\tthis.scopeId = void 0;\n\t\tthis.count = void 0;\n\t\tthis.shortName = name;\n\t\tthis.name = count ? `${name}[0]` : name;\n\t\tthis.type = type;\n\t\tthis.updateType = type;\n\t\tif (count) {\n\t\t\tswitch (type) {\n\t\t\t\tcase UNIFORMTYPE_FLOAT:\n\t\t\t\t\tthis.updateType = UNIFORMTYPE_FLOATARRAY;\n\t\t\t\t\tbreak;\n\t\t\t\tcase UNIFORMTYPE_VEC2:\n\t\t\t\t\tthis.updateType = UNIFORMTYPE_VEC2ARRAY;\n\t\t\t\t\tbreak;\n\t\t\t\tcase UNIFORMTYPE_VEC3:\n\t\t\t\t\tthis.updateType = UNIFORMTYPE_VEC3ARRAY;\n\t\t\t\t\tbreak;\n\t\t\t\tcase UNIFORMTYPE_VEC4:\n\t\t\t\t\tthis.updateType = UNIFORMTYPE_VEC4ARRAY;\n\t\t\t\t\tbreak;\n\t\t\t\tcase UNIFORMTYPE_MAT4:\n\t\t\t\t\tthis.updateType = UNIFORMTYPE_MAT4ARRAY;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tthis.count = count;\n\t\tlet elementSize = uniformTypeToNumElements[type];\n\t\tif (count) elementSize = math.roundUp(elementSize, 4);\n\t\tthis.byteSize = elementSize * 4;\n\t\tif (count) this.byteSize *= count;\n\t}\n\tcalculateOffset(offset) {\n\t\tlet alignment = this.byteSize <= 8 ? this.byteSize : 16;\n\t\tif (this.count) alignment = 16;\n\t\toffset = math.roundUp(offset, alignment);\n\t\tthis.offset = offset / 4;\n\t}\n}\nclass UniformBufferFormat {\n\tconstructor(graphicsDevice, uniforms) {\n\t\tthis.byteSize = 0;\n\t\tthis.map = new Map();\n\t\tthis.scope = graphicsDevice.scope;\n\t\tthis.uniforms = uniforms;\n\t\tlet offset = 0;\n\t\tfor (let i = 0; i < uniforms.length; i++) {\n\t\t\tconst uniform = uniforms[i];\n\t\t\tuniform.calculateOffset(offset);\n\t\t\toffset = uniform.offset * 4 + uniform.byteSize;\n\t\t\tuniform.scopeId = this.scope.resolve(uniform.name);\n\t\t\tthis.map.set(uniform.name, uniform);\n\t\t}\n\t\tthis.byteSize = math.roundUp(offset, 16);\n\t}\n\tget(name) {\n\t\treturn this.map.get(name);\n\t}\n\tgetShaderDeclaration(bindGroup, bindIndex) {\n\t\tconst name = bindGroupNames[bindGroup];\n\t\tlet code = `layout(set = ${bindGroup}, binding = ${bindIndex}, std140) uniform ub_${name} {\\n`;\n\t\tthis.uniforms.forEach(uniform => {\n\t\t\tconst typeString = uniformTypeToName[uniform.type];\n\t\t\tcode += `    ${typeString} ${uniform.shortName}${uniform.count ? `[${uniform.count}]` : ''};\\n`;\n\t\t});\n\t\treturn code + '};\\n';\n\t}\n}\n\nexport { UniformBufferFormat, UniformFormat };\n","import '../../core/tracing.js';\nimport { TEXTUREDIMENSION_2D, SAMPLETYPE_FLOAT, PIXELFORMAT_RGBA8, TEXTUREDIMENSION_CUBE, TEXTUREDIMENSION_3D } from './constants.js';\n\nlet id = 0;\nconst textureDimensionInfo = {\n\t[TEXTUREDIMENSION_2D]: 'texture2D',\n\t[TEXTUREDIMENSION_CUBE]: 'textureCube',\n\t[TEXTUREDIMENSION_3D]: 'texture3D'\n};\nclass BindBufferFormat {\n\tconstructor(name, visibility) {\n\t\tthis.name = name;\n\t\tthis.visibility = visibility;\n\t}\n}\nclass BindTextureFormat {\n\tconstructor(name, visibility, textureDimension = TEXTUREDIMENSION_2D, sampleType = SAMPLETYPE_FLOAT) {\n\t\tthis.scopeId = void 0;\n\t\tthis.name = name;\n\t\tthis.visibility = visibility;\n\t\tthis.textureDimension = textureDimension;\n\t\tthis.sampleType = sampleType;\n\t}\n}\nclass BindStorageTextureFormat {\n\tconstructor(name, format = PIXELFORMAT_RGBA8, textureDimension = TEXTUREDIMENSION_2D) {\n\t\tthis.scopeId = void 0;\n\t\tthis.name = name;\n\t\tthis.format = format;\n\t\tthis.textureDimension = textureDimension;\n\t}\n}\nclass BindGroupFormat {\n\tconstructor(graphicsDevice, bufferFormats = [], textureFormats = [], storageTextureFormats = [], options = {}) {\n\t\tvar _options$compute;\n\t\tthis.compute = false;\n\t\tthis.id = id++;\n\t\tthis.compute = (_options$compute = options.compute) != null ? _options$compute : false;\n\t\tthis.device = graphicsDevice;\n\t\tconst scope = graphicsDevice.scope;\n\t\tthis.bufferFormats = bufferFormats;\n\t\tthis.bufferFormatsMap = new Map();\n\t\tbufferFormats.forEach((bf, i) => this.bufferFormatsMap.set(bf.name, i));\n\t\tthis.textureFormats = textureFormats;\n\t\tthis.textureFormatsMap = new Map();\n\t\ttextureFormats.forEach((tf, i) => {\n\t\t\tthis.textureFormatsMap.set(tf.name, i);\n\t\t\ttf.scopeId = scope.resolve(tf.name);\n\t\t});\n\t\tthis.storageTextureFormats = storageTextureFormats;\n\t\tthis.storageTextureFormatsMap = new Map();\n\t\tstorageTextureFormats.forEach((tf, i) => {\n\t\t\tthis.storageTextureFormatsMap.set(tf.name, i);\n\t\t\ttf.scopeId = scope.resolve(tf.name);\n\t\t});\n\t\tthis.impl = graphicsDevice.createBindGroupFormatImpl(this);\n\t}\n\tdestroy() {\n\t\tthis.impl.destroy();\n\t}\n\tgetTexture(name) {\n\t\tconst index = this.textureFormatsMap.get(name);\n\t\tif (index !== undefined) {\n\t\t\treturn this.textureFormats[index];\n\t\t}\n\t\treturn null;\n\t}\n\tgetStorageTexture(name) {\n\t\tconst index = this.storageTextureFormatsMap.get(name);\n\t\tif (index !== undefined) {\n\t\t\treturn this.storageTextureFormats[index];\n\t\t}\n\t\treturn null;\n\t}\n\tgetShaderDeclarationTextures(bindGroup) {\n\t\tlet code = '';\n\t\tlet bindIndex = this.bufferFormats.length;\n\t\tthis.textureFormats.forEach(format => {\n\t\t\tconst textureType = textureDimensionInfo[format.textureDimension];\n\t\t\tcode += `layout(set = ${bindGroup}, binding = ${bindIndex++}) uniform ${textureType} ${format.name};\\n` + `layout(set = ${bindGroup}, binding = ${bindIndex++}) uniform sampler ${format.name}_sampler;\\n`;\n\t\t});\n\t\treturn code;\n\t}\n\tloseContext() {}\n}\n\nexport { BindBufferFormat, BindGroupFormat, BindStorageTextureFormat, BindTextureFormat };\n","import '../../core/tracing.js';\nimport { pixelFormatInfo, PIXELFORMAT_PVRTC_2BPP_RGB_1, PIXELFORMAT_PVRTC_2BPP_RGBA_1 } from './constants.js';\n\nclass TextureUtils {\n\tstatic calcLevelDimension(dimension, mipLevel) {\n\t\treturn Math.max(dimension >> mipLevel, 1);\n\t}\n\tstatic calcMipLevelsCount(width, height, depth = 1) {\n\t\treturn 1 + Math.floor(Math.log2(Math.max(width, height, depth)));\n\t}\n\tstatic calcLevelGpuSize(width, height, depth, format) {\n\t\tvar _pixelFormatInfo$get$, _pixelFormatInfo$get, _formatInfo$blockSize;\n\t\tconst formatInfo = pixelFormatInfo.get(format);\n\t\tconst pixelSize = (_pixelFormatInfo$get$ = (_pixelFormatInfo$get = pixelFormatInfo.get(format)) == null ? void 0 : _pixelFormatInfo$get.size) != null ? _pixelFormatInfo$get$ : 0;\n\t\tif (pixelSize > 0) {\n\t\t\treturn width * height * depth * pixelSize;\n\t\t}\n\t\tconst blockSize = (_formatInfo$blockSize = formatInfo.blockSize) != null ? _formatInfo$blockSize : 0;\n\t\tlet blockWidth = Math.floor((width + 3) / 4);\n\t\tconst blockHeight = Math.floor((height + 3) / 4);\n\t\tconst blockDepth = Math.floor((depth + 3) / 4);\n\t\tif (format === PIXELFORMAT_PVRTC_2BPP_RGB_1 || format === PIXELFORMAT_PVRTC_2BPP_RGBA_1) {\n\t\t\tblockWidth = Math.max(Math.floor(blockWidth / 2), 1);\n\t\t}\n\t\treturn blockWidth * blockHeight * blockDepth * blockSize;\n\t}\n\tstatic calcGpuSize(width, height, depth, format, mipmaps, cubemap) {\n\t\tlet result = 0;\n\t\twhile (1) {\n\t\t\tresult += TextureUtils.calcLevelGpuSize(width, height, depth, format);\n\t\t\tif (!mipmaps || width === 1 && height === 1 && depth === 1) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\twidth = Math.max(width >> 1, 1);\n\t\t\theight = Math.max(height >> 1, 1);\n\t\t\tdepth = Math.max(depth >> 1, 1);\n\t\t}\n\t\treturn result * (cubemap ? 6 : 1);\n\t}\n}\n\nexport { TextureUtils };\n","import './tracing.js';\n\nconst KEYWORD = /[ \\t]*#(ifn?def|if|endif|else|elif|define|undef|extension)/g;\nconst DEFINE = /define[ \\t]+([^\\n]+)\\r?(?:\\n|$)/g;\nconst EXTENSION = /extension[ \\t]+([\\w-]+)[ \\t]*:[ \\t]*(enable|require)/g;\nconst UNDEF = /undef[ \\t]+([^\\n]+)\\r?(?:\\n|$)/g;\nconst IF = /(ifdef|ifndef|if)[ \\t]*([^\\r\\n]+)\\r?\\n/g;\nconst ENDIF = /(endif|else|elif)([ \\t]+[^\\r\\n]+)?\\r?(?:\\n|$)/g;\nconst IDENTIFIER = /([\\w-]+)/;\nconst DEFINED = /(!|\\s)?defined\\(([\\w-]+)\\)/;\nconst INVALID = /[><=|&+-]/g;\nclass Preprocessor {\n\tstatic run(source, stripUnusedColorAttachments = false) {\n\t\tsource = source.replace(/\\/\\*[\\s\\S]*?\\*\\/|([^\\\\:]|^)\\/\\/.*$/gm, '$1');\n\t\tsource = source.split(/\\r?\\n/).map(line => line.trimEnd()).join('\\n');\n\t\tconst defines = new Map();\n\t\tif (stripUnusedColorAttachments) {\n\t\t\tconst counts = new Map();\n\t\t\tconst regex = /(pcFragColor[1-8])\\b/g;\n\t\t\tconst matches = source.match(regex);\n\t\t\tmatches == null || matches.forEach(match => {\n\t\t\t\tvar _counts$get;\n\t\t\t\tconst index = parseInt(match.charAt(match.length - 1), 10);\n\t\t\t\tcounts.set(index, ((_counts$get = counts.get(index)) != null ? _counts$get : 0) + 1);\n\t\t\t});\n\t\t\tcounts.forEach((count, index) => {\n\t\t\t\tif (count === 1) {\n\t\t\t\t\tdefines.set(`REMOVE_COLOR_ATTACHMENT_${index}`, '');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tsource = this._preprocess(source, defines);\n\t\tconst intDefines = new Map();\n\t\tdefines.forEach((value, key) => {\n\t\t\tif (Number.isInteger(parseFloat(value)) && !value.includes('.')) {\n\t\t\t\tintDefines.set(key, value);\n\t\t\t}\n\t\t});\n\t\tif (source !== null) {\n\t\t\tsource = source.split(/\\r?\\n/).map(line => line.trim() === '' ? '' : line).map(line => {\n\t\t\t\tintDefines.forEach((value, key) => {\n\t\t\t\t\tline = line.replace(new RegExp(`\\\\[${key}\\\\]`, 'g'), `[${value}]`);\n\t\t\t\t});\n\t\t\t\treturn line;\n\t\t\t}).join('\\n');\n\t\t\tsource = source.replace(/(\\n\\n){3,}/gm, '\\n\\n');\n\t\t}\n\t\treturn source;\n\t}\n\tstatic _preprocess(source, defines = new Map()) {\n\t\tconst originalSource = source;\n\t\tconst stack = [];\n\t\tlet error = false;\n\t\tlet match;\n\t\twhile ((match = KEYWORD.exec(source)) !== null) {\n\t\t\tconst keyword = match[1];\n\t\t\tswitch (keyword) {\n\t\t\t\tcase 'define':\n\t\t\t\t\t{\n\t\t\t\t\t\tDEFINE.lastIndex = match.index;\n\t\t\t\t\t\tconst define = DEFINE.exec(source);\n\t\t\t\t\t\terror || (error = define === null);\n\t\t\t\t\t\tconst expression = define[1];\n\t\t\t\t\t\tIDENTIFIER.lastIndex = define.index;\n\t\t\t\t\t\tconst identifierValue = IDENTIFIER.exec(expression);\n\t\t\t\t\t\tconst identifier = identifierValue[1];\n\t\t\t\t\t\tlet value = expression.substring(identifier.length).trim();\n\t\t\t\t\t\tif (value === \"\") value = \"true\";\n\t\t\t\t\t\tconst keep = Preprocessor._keep(stack);\n\t\t\t\t\t\tif (keep) {\n\t\t\t\t\t\t\tdefines.set(identifier, value);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tKEYWORD.lastIndex = define.index + define[0].length;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tcase 'undef':\n\t\t\t\t\t{\n\t\t\t\t\t\tUNDEF.lastIndex = match.index;\n\t\t\t\t\t\tconst undef = UNDEF.exec(source);\n\t\t\t\t\t\tconst identifier = undef[1].trim();\n\t\t\t\t\t\tconst keep = Preprocessor._keep(stack);\n\t\t\t\t\t\tif (keep) {\n\t\t\t\t\t\t\tdefines.delete(identifier);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tKEYWORD.lastIndex = undef.index + undef[0].length;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tcase 'extension':\n\t\t\t\t\t{\n\t\t\t\t\t\tEXTENSION.lastIndex = match.index;\n\t\t\t\t\t\tconst extension = EXTENSION.exec(source);\n\t\t\t\t\t\terror || (error = extension === null);\n\t\t\t\t\t\tif (extension) {\n\t\t\t\t\t\t\tconst identifier = extension[1];\n\t\t\t\t\t\t\tconst keep = Preprocessor._keep(stack);\n\t\t\t\t\t\t\tif (keep) {\n\t\t\t\t\t\t\t\tdefines.set(identifier, \"true\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tKEYWORD.lastIndex = extension.index + extension[0].length;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tcase 'ifdef':\n\t\t\t\tcase 'ifndef':\n\t\t\t\tcase 'if':\n\t\t\t\t\t{\n\t\t\t\t\t\tIF.lastIndex = match.index;\n\t\t\t\t\t\tconst iff = IF.exec(source);\n\t\t\t\t\t\tconst expression = iff[2];\n\t\t\t\t\t\tconst evaluated = Preprocessor.evaluate(expression, defines);\n\t\t\t\t\t\terror || (error = evaluated.error);\n\t\t\t\t\t\tlet result = evaluated.result;\n\t\t\t\t\t\tif (keyword === 'ifndef') {\n\t\t\t\t\t\t\tresult = !result;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tstack.push({\n\t\t\t\t\t\t\tanyKeep: result,\n\t\t\t\t\t\t\tkeep: result,\n\t\t\t\t\t\t\tstart: match.index,\n\t\t\t\t\t\t\tend: IF.lastIndex\n\t\t\t\t\t\t});\n\t\t\t\t\t\tKEYWORD.lastIndex = iff.index + iff[0].length;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tcase 'endif':\n\t\t\t\tcase 'else':\n\t\t\t\tcase 'elif':\n\t\t\t\t\t{\n\t\t\t\t\t\tENDIF.lastIndex = match.index;\n\t\t\t\t\t\tconst endif = ENDIF.exec(source);\n\t\t\t\t\t\tconst blockInfo = stack.pop();\n\t\t\t\t\t\tconst blockCode = blockInfo.keep ? source.substring(blockInfo.end, match.index) : \"\";\n\t\t\t\t\t\tsource = source.substring(0, blockInfo.start) + blockCode + source.substring(ENDIF.lastIndex);\n\t\t\t\t\t\tKEYWORD.lastIndex = blockInfo.start + blockCode.length;\n\t\t\t\t\t\tconst endifCommand = endif[1];\n\t\t\t\t\t\tif (endifCommand === 'else' || endifCommand === 'elif') {\n\t\t\t\t\t\t\tlet result = false;\n\t\t\t\t\t\t\tif (!blockInfo.anyKeep) {\n\t\t\t\t\t\t\t\tif (endifCommand === 'else') {\n\t\t\t\t\t\t\t\t\tresult = !blockInfo.keep;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tconst evaluated = Preprocessor.evaluate(endif[2], defines);\n\t\t\t\t\t\t\t\t\tresult = evaluated.result;\n\t\t\t\t\t\t\t\t\terror || (error = evaluated.error);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tstack.push({\n\t\t\t\t\t\t\t\tanyKeep: blockInfo.anyKeep || result,\n\t\t\t\t\t\t\t\tkeep: result,\n\t\t\t\t\t\t\t\tstart: KEYWORD.lastIndex,\n\t\t\t\t\t\t\t\tend: KEYWORD.lastIndex\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (error) {\n\t\t\tconsole.warn(\"Failed to preprocess shader: \", {\n\t\t\t\tsource: originalSource\n\t\t\t});\n\t\t\treturn originalSource;\n\t\t}\n\t\treturn source;\n\t}\n\tstatic _keep(stack) {\n\t\tfor (let i = 0; i < stack.length; i++) {\n\t\t\tif (!stack[i].keep) return false;\n\t\t}\n\t\treturn true;\n\t}\n\tstatic evaluate(expression, defines) {\n\t\tconst correct = INVALID.exec(expression) === null;\n\t\tlet invert = false;\n\t\tconst defined = DEFINED.exec(expression);\n\t\tif (defined) {\n\t\t\tinvert = defined[1] === '!';\n\t\t\texpression = defined[2];\n\t\t}\n\t\texpression = expression.trim();\n\t\tlet exists = defines.has(expression);\n\t\tif (invert) {\n\t\t\texists = !exists;\n\t\t}\n\t\treturn {\n\t\t\tresult: exists,\n\t\t\terror: !correct\n\t\t};\n\t}\n}\n\nexport { Preprocessor };\n","import '../../core/tracing.js';\nimport { Preprocessor } from '../../core/preprocessor.js';\n\nlet id = 0;\nclass Shader {\n\tconstructor(graphicsDevice, definition) {\n\t\tthis.meshUniformBufferFormat = void 0;\n\t\tthis.meshBindGroupFormat = void 0;\n\t\tthis.id = id++;\n\t\tthis.device = graphicsDevice;\n\t\tthis.definition = definition;\n\t\tthis.name = definition.name || 'Untitled';\n\t\tthis.init();\n\t\tif (definition.cshader) ; else {\n\t\t\tdefinition.vshader = Preprocessor.run(definition.vshader);\n\t\t\tdefinition.fshader = Preprocessor.run(definition.fshader, graphicsDevice.isWebGL2);\n\t\t}\n\t\tthis.impl = graphicsDevice.createShaderImpl(this);\n\t}\n\tinit() {\n\t\tthis.ready = false;\n\t\tthis.failed = false;\n\t}\n\tget label() {\n\t\treturn `Shader Id ${this.id} ${this.name}`;\n\t}\n\tdestroy() {\n\t\tthis.device.onDestroyShader(this);\n\t\tthis.impl.destroy(this);\n\t}\n\tloseContext() {\n\t\tthis.init();\n\t\tthis.impl.loseContext();\n\t}\n\trestoreContext() {\n\t\tthis.impl.restoreContext(this.device, this);\n\t}\n}\n\nexport { Shader };\n","import '../../core/tracing.js';\nimport { UNIFORM_BUFFER_DEFAULT_SLOT_NAME } from './constants.js';\n\nlet id = 0;\nclass BindGroup {\n\tconstructor(graphicsDevice, format, defaultUniformBuffer) {\n\t\tthis.renderVersionUpdated = -1;\n\t\tthis.uniformBuffers = void 0;\n\t\tthis.uniformBufferOffsets = [];\n\t\tthis.id = id++;\n\t\tthis.device = graphicsDevice;\n\t\tthis.format = format;\n\t\tthis.dirty = true;\n\t\tthis.impl = graphicsDevice.createBindGroupImpl(this);\n\t\tthis.textures = [];\n\t\tthis.storageTextures = [];\n\t\tthis.uniformBuffers = [];\n\t\tthis.defaultUniformBuffer = defaultUniformBuffer;\n\t\tif (defaultUniformBuffer) {\n\t\t\tthis.setUniformBuffer(UNIFORM_BUFFER_DEFAULT_SLOT_NAME, defaultUniformBuffer);\n\t\t}\n\t}\n\tdestroy() {\n\t\tthis.impl.destroy();\n\t\tthis.impl = null;\n\t\tthis.format = null;\n\t\tthis.defaultUniformBuffer = null;\n\t}\n\tsetUniformBuffer(name, uniformBuffer) {\n\t\tconst index = this.format.bufferFormatsMap.get(name);\n\t\tif (this.uniformBuffers[index] !== uniformBuffer) {\n\t\t\tthis.uniformBuffers[index] = uniformBuffer;\n\t\t\tthis.dirty = true;\n\t\t}\n\t}\n\tsetTexture(name, texture) {\n\t\tconst index = this.format.textureFormatsMap.get(name);\n\t\tif (this.textures[index] !== texture) {\n\t\t\tthis.textures[index] = texture;\n\t\t\tthis.dirty = true;\n\t\t} else if (this.renderVersionUpdated < texture.renderVersionDirty) {\n\t\t\tthis.dirty = true;\n\t\t}\n\t}\n\tsetStorageTexture(name, texture) {\n\t\tconst index = this.format.storageTextureFormatsMap.get(name);\n\t\tif (this.storageTextures[index] !== texture) {\n\t\t\tthis.storageTextures[index] = texture;\n\t\t\tthis.dirty = true;\n\t\t} else if (this.renderVersionUpdated < texture.renderVersionDirty) {\n\t\t\tthis.dirty = true;\n\t\t}\n\t}\n\tupdate() {\n\t\tconst {\n\t\t\ttextureFormats,\n\t\t\tstorageTextureFormats\n\t\t} = this.format;\n\t\tfor (let i = 0; i < textureFormats.length; i++) {\n\t\t\tconst textureFormat = textureFormats[i];\n\t\t\tconst value = textureFormat.scopeId.value;\n\t\t\tthis.setTexture(textureFormat.name, value);\n\t\t}\n\t\tfor (let i = 0; i < storageTextureFormats.length; i++) {\n\t\t\tconst storageTextureFormat = storageTextureFormats[i];\n\t\t\tconst value = storageTextureFormat.scopeId.value;\n\t\t\tthis.setStorageTexture(storageTextureFormat.name, value);\n\t\t}\n\t\tthis.uniformBufferOffsets.length = this.uniformBuffers.length;\n\t\tfor (let i = 0; i < this.uniformBuffers.length; i++) {\n\t\t\tconst uniformBuffer = this.uniformBuffers[i];\n\t\t\tthis.uniformBufferOffsets[i] = uniformBuffer.offset;\n\t\t\tif (this.renderVersionUpdated < uniformBuffer.renderVersionDirty) {\n\t\t\t\tthis.dirty = true;\n\t\t\t}\n\t\t}\n\t\tif (this.dirty) {\n\t\t\tthis.dirty = false;\n\t\t\tthis.renderVersionUpdated = this.device.renderVersion;\n\t\t\tthis.impl.update(this);\n\t\t}\n\t}\n}\n\nexport { BindGroup };\n","import '../../core/tracing.js';\nimport { math } from '../../core/math/math.js';\n\nclass DynamicBuffer {\n\tconstructor(device) {\n\t\tthis.device = void 0;\n\t\tthis.device = device;\n\t}\n}\nclass UsedBuffer {\n\tconstructor() {\n\t\tthis.gpuBuffer = void 0;\n\t\tthis.stagingBuffer = void 0;\n\t\tthis.offset = void 0;\n\t\tthis.size = void 0;\n\t}\n}\nclass DynamicBufferAllocation {\n\tconstructor() {\n\t\tthis.storage = void 0;\n\t\tthis.gpuBuffer = void 0;\n\t\tthis.offset = void 0;\n\t}\n}\nclass DynamicBuffers {\n\tconstructor(device, bufferSize, bufferAlignment) {\n\t\tthis.bufferSize = void 0;\n\t\tthis.gpuBuffers = [];\n\t\tthis.stagingBuffers = [];\n\t\tthis.usedBuffers = [];\n\t\tthis.activeBuffer = null;\n\t\tthis.device = device;\n\t\tthis.bufferSize = bufferSize;\n\t\tthis.bufferAlignment = bufferAlignment;\n\t}\n\tdestroy() {\n\t\tthis.gpuBuffers.forEach(gpuBuffer => {\n\t\t\tgpuBuffer.destroy(this.device);\n\t\t});\n\t\tthis.gpuBuffers = null;\n\t\tthis.stagingBuffers.forEach(stagingBuffer => {\n\t\t\tstagingBuffer.destroy(this.device);\n\t\t});\n\t\tthis.stagingBuffers = null;\n\t\tthis.usedBuffers = null;\n\t\tthis.activeBuffer = null;\n\t}\n\talloc(allocation, size) {\n\t\tif (this.activeBuffer) {\n\t\t\tconst _alignedStart = math.roundUp(this.activeBuffer.size, this.bufferAlignment);\n\t\t\tconst space = this.bufferSize - _alignedStart;\n\t\t\tif (space < size) {\n\t\t\t\tthis.scheduleSubmit();\n\t\t\t}\n\t\t}\n\t\tif (!this.activeBuffer) {\n\t\t\tlet gpuBuffer = this.gpuBuffers.pop();\n\t\t\tif (!gpuBuffer) {\n\t\t\t\tgpuBuffer = this.createBuffer(this.device, this.bufferSize, false);\n\t\t\t}\n\t\t\tlet stagingBuffer = this.stagingBuffers.pop();\n\t\t\tif (!stagingBuffer) {\n\t\t\t\tstagingBuffer = this.createBuffer(this.device, this.bufferSize, true);\n\t\t\t}\n\t\t\tthis.activeBuffer = new UsedBuffer();\n\t\t\tthis.activeBuffer.stagingBuffer = stagingBuffer;\n\t\t\tthis.activeBuffer.gpuBuffer = gpuBuffer;\n\t\t\tthis.activeBuffer.offset = 0;\n\t\t\tthis.activeBuffer.size = 0;\n\t\t}\n\t\tconst activeBuffer = this.activeBuffer;\n\t\tconst alignedStart = math.roundUp(activeBuffer.size, this.bufferAlignment);\n\t\tallocation.gpuBuffer = activeBuffer.gpuBuffer;\n\t\tallocation.offset = alignedStart;\n\t\tallocation.storage = activeBuffer.stagingBuffer.alloc(alignedStart, size);\n\t\tactiveBuffer.size = alignedStart + size;\n\t}\n\tscheduleSubmit() {\n\t\tif (this.activeBuffer) {\n\t\t\tthis.usedBuffers.push(this.activeBuffer);\n\t\t\tthis.activeBuffer = null;\n\t\t}\n\t}\n\tsubmit() {\n\t\tthis.scheduleSubmit();\n\t}\n}\n\nexport { DynamicBuffer, DynamicBufferAllocation, DynamicBuffers };\n","import '../../core/tracing.js';\nimport { UNIFORMTYPE_FLOAT, UNIFORMTYPE_VEC2, UNIFORMTYPE_VEC3, UNIFORMTYPE_VEC4, UNIFORMTYPE_INT, UNIFORMTYPE_IVEC2, UNIFORMTYPE_IVEC3, UNIFORMTYPE_IVEC4, UNIFORMTYPE_MAT2, UNIFORMTYPE_MAT3, UNIFORMTYPE_FLOATARRAY, UNIFORMTYPE_VEC2ARRAY, UNIFORMTYPE_VEC3ARRAY } from './constants.js';\nimport { DynamicBufferAllocation } from './dynamic-buffers.js';\n\nconst _updateFunctions = [];\n_updateFunctions[UNIFORMTYPE_FLOAT] = function (uniformBuffer, value, offset) {\n\tconst dst = uniformBuffer.storageFloat32;\n\tdst[offset] = value;\n};\n_updateFunctions[UNIFORMTYPE_VEC2] = (uniformBuffer, value, offset) => {\n\tconst dst = uniformBuffer.storageFloat32;\n\tdst[offset] = value[0];\n\tdst[offset + 1] = value[1];\n};\n_updateFunctions[UNIFORMTYPE_VEC3] = (uniformBuffer, value, offset) => {\n\tconst dst = uniformBuffer.storageFloat32;\n\tdst[offset] = value[0];\n\tdst[offset + 1] = value[1];\n\tdst[offset + 2] = value[2];\n};\n_updateFunctions[UNIFORMTYPE_VEC4] = (uniformBuffer, value, offset) => {\n\tconst dst = uniformBuffer.storageFloat32;\n\tdst[offset] = value[0];\n\tdst[offset + 1] = value[1];\n\tdst[offset + 2] = value[2];\n\tdst[offset + 3] = value[3];\n};\n_updateFunctions[UNIFORMTYPE_INT] = function (uniformBuffer, value, offset) {\n\tconst dst = uniformBuffer.storageInt32;\n\tdst[offset] = value;\n};\n_updateFunctions[UNIFORMTYPE_IVEC2] = function (uniformBuffer, value, offset) {\n\tconst dst = uniformBuffer.storageInt32;\n\tdst[offset] = value[0];\n\tdst[offset + 1] = value[1];\n};\n_updateFunctions[UNIFORMTYPE_IVEC3] = function (uniformBuffer, value, offset) {\n\tconst dst = uniformBuffer.storageInt32;\n\tdst[offset] = value[0];\n\tdst[offset + 1] = value[1];\n\tdst[offset + 2] = value[2];\n};\n_updateFunctions[UNIFORMTYPE_IVEC4] = function (uniformBuffer, value, offset) {\n\tconst dst = uniformBuffer.storageInt32;\n\tdst[offset] = value[0];\n\tdst[offset + 1] = value[1];\n\tdst[offset + 2] = value[2];\n\tdst[offset + 3] = value[3];\n};\n_updateFunctions[UNIFORMTYPE_MAT2] = (uniformBuffer, value, offset) => {\n\tconst dst = uniformBuffer.storageFloat32;\n\tdst[offset] = value[0];\n\tdst[offset + 1] = value[1];\n\tdst[offset + 4] = value[2];\n\tdst[offset + 5] = value[3];\n\tdst[offset + 8] = value[4];\n\tdst[offset + 9] = value[5];\n};\n_updateFunctions[UNIFORMTYPE_MAT3] = (uniformBuffer, value, offset) => {\n\tconst dst = uniformBuffer.storageFloat32;\n\tdst[offset] = value[0];\n\tdst[offset + 1] = value[1];\n\tdst[offset + 2] = value[2];\n\tdst[offset + 4] = value[3];\n\tdst[offset + 5] = value[4];\n\tdst[offset + 6] = value[5];\n\tdst[offset + 8] = value[6];\n\tdst[offset + 9] = value[7];\n\tdst[offset + 10] = value[8];\n};\n_updateFunctions[UNIFORMTYPE_FLOATARRAY] = function (uniformBuffer, value, offset, count) {\n\tconst dst = uniformBuffer.storageFloat32;\n\tfor (let i = 0; i < count; i++) {\n\t\tdst[offset + i * 4] = value[i];\n\t}\n};\n_updateFunctions[UNIFORMTYPE_VEC2ARRAY] = (uniformBuffer, value, offset, count) => {\n\tconst dst = uniformBuffer.storageFloat32;\n\tfor (let i = 0; i < count; i++) {\n\t\tdst[offset + i * 4] = value[i * 2];\n\t\tdst[offset + i * 4 + 1] = value[i * 2 + 1];\n\t}\n};\n_updateFunctions[UNIFORMTYPE_VEC3ARRAY] = (uniformBuffer, value, offset, count) => {\n\tconst dst = uniformBuffer.storageFloat32;\n\tfor (let i = 0; i < count; i++) {\n\t\tdst[offset + i * 4] = value[i * 3];\n\t\tdst[offset + i * 4 + 1] = value[i * 3 + 1];\n\t\tdst[offset + i * 4 + 2] = value[i * 3 + 2];\n\t}\n};\nclass UniformBuffer {\n\tconstructor(graphicsDevice, format, persistent = true) {\n\t\tthis.device = void 0;\n\t\tthis.persistent = void 0;\n\t\tthis.allocation = void 0;\n\t\tthis.storageFloat32 = void 0;\n\t\tthis.storageInt32 = void 0;\n\t\tthis.renderVersionDirty = 0;\n\t\tthis.device = graphicsDevice;\n\t\tthis.format = format;\n\t\tthis.persistent = persistent;\n\t\tif (persistent) {\n\t\t\tthis.impl = graphicsDevice.createUniformBufferImpl(this);\n\t\t\tconst storage = new ArrayBuffer(format.byteSize);\n\t\t\tthis.assignStorage(new Int32Array(storage));\n\t\t\tgraphicsDevice._vram.ub += this.format.byteSize;\n\t\t} else {\n\t\t\tthis.allocation = new DynamicBufferAllocation();\n\t\t}\n\t}\n\tdestroy() {\n\t\tif (this.persistent) {\n\t\t\tconst device = this.device;\n\t\t\tthis.impl.destroy(device);\n\t\t\tdevice._vram.ub -= this.format.byteSize;\n\t\t}\n\t}\n\tget offset() {\n\t\treturn this.persistent ? 0 : this.allocation.offset;\n\t}\n\tassignStorage(storage) {\n\t\tthis.storageInt32 = storage;\n\t\tthis.storageFloat32 = new Float32Array(storage.buffer, storage.byteOffset, storage.byteLength / 4);\n\t}\n\tloseContext() {\n\t\tvar _this$impl;\n\t\t(_this$impl = this.impl) == null || _this$impl.loseContext();\n\t}\n\tsetUniform(uniformFormat) {\n\t\tconst offset = uniformFormat.offset;\n\t\tconst value = uniformFormat.scopeId.value;\n\t\tif (value !== null && value !== undefined) {\n\t\t\tconst updateFunction = _updateFunctions[uniformFormat.updateType];\n\t\t\tif (updateFunction) {\n\t\t\t\tupdateFunction(this, value, offset, uniformFormat.count);\n\t\t\t} else {\n\t\t\t\tthis.storageFloat32.set(value, offset);\n\t\t\t}\n\t\t}\n\t}\n\tset(name) {\n\t\tconst uniformFormat = this.format.map.get(name);\n\t\tif (uniformFormat) {\n\t\t\tthis.setUniform(uniformFormat);\n\t\t}\n\t}\n\tupdate() {\n\t\tconst persistent = this.persistent;\n\t\tif (!persistent) {\n\t\t\tconst allocation = this.allocation;\n\t\t\tconst oldGpuBuffer = allocation.gpuBuffer;\n\t\t\tthis.device.dynamicBuffers.alloc(allocation, this.format.byteSize);\n\t\t\tthis.assignStorage(allocation.storage);\n\t\t\tif (oldGpuBuffer !== allocation.gpuBuffer) {\n\t\t\t\tthis.renderVersionDirty = this.device.renderVersion;\n\t\t\t}\n\t\t}\n\t\tconst uniforms = this.format.uniforms;\n\t\tfor (let i = 0; i < uniforms.length; i++) {\n\t\t\tthis.setUniform(uniforms[i]);\n\t\t}\n\t\tif (persistent) {\n\t\t\tthis.impl.unlock(this);\n\t\t} else {\n\t\t\tthis.storageFloat32 = null;\n\t\t\tthis.storageInt32 = null;\n\t\t}\n\t}\n}\n\nexport { UniformBuffer };\n","import { TRACEID_GPU_TIMINGS } from '../../core/constants.js';\nimport { Tracing } from '../../core/tracing.js';\n\nclass GpuProfiler {\n\tconstructor() {\n\t\tthis.frameAllocations = [];\n\t\tthis.pastFrameAllocations = new Map();\n\t\tthis._enabled = false;\n\t\tthis._enableRequest = false;\n\t\tthis._frameTime = 0;\n\t}\n\tloseContext() {\n\t\tthis.pastFrameAllocations.clear();\n\t}\n\tset enabled(value) {\n\t\tthis._enableRequest = value;\n\t}\n\tget enabled() {\n\t\treturn this._enableRequest;\n\t}\n\tprocessEnableRequest() {\n\t\tif (this._enableRequest !== this._enabled) {\n\t\t\tthis._enabled = this._enableRequest;\n\t\t\tif (!this._enabled) {\n\t\t\t\tthis._frameTime = 0;\n\t\t\t}\n\t\t}\n\t}\n\trequest(renderVersion) {\n\t\tthis.pastFrameAllocations.set(renderVersion, this.frameAllocations);\n\t\tthis.frameAllocations = [];\n\t}\n\treport(renderVersion, timings) {\n\t\tif (timings) {\n\t\t\tconst allocations = this.pastFrameAllocations.get(renderVersion);\n\t\t\tif (timings.length > 0) {\n\t\t\t\tthis._frameTime = timings[0];\n\t\t\t}\n\t\t\tif (Tracing.get(TRACEID_GPU_TIMINGS)) {\n\t\t\t\tfor (let i = 0; i < allocations.length; ++i) {\n\t\t\t\t\tallocations[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.pastFrameAllocations.delete(renderVersion);\n\t}\n\tgetSlot(name) {\n\t\tconst slot = this.frameAllocations.length;\n\t\tthis.frameAllocations.push(name);\n\t\treturn slot;\n\t}\n\tget slotCount() {\n\t\treturn this.frameAllocations.length;\n\t}\n}\n\nexport { GpuProfiler };\n","import '../../core/tracing.js';\nimport { math } from '../../core/math/math.js';\nimport { RenderTarget } from './render-target.js';\nimport { TextureUtils } from './texture-utils.js';\nimport { PIXELFORMAT_RGBA8, isCompressedPixelFormat, FILTER_LINEAR_MIPMAP_LINEAR, FILTER_LINEAR, ADDRESS_REPEAT, FUNC_LESS, TEXTURETYPE_DEFAULT, TEXTURETYPE_RGBM, TEXTURETYPE_SWIZZLEGGGR, TEXTUREPROJECTION_NONE, TEXTUREPROJECTION_CUBE, PIXELFORMAT_RGB16F, PIXELFORMAT_RGB32F, PIXELFORMAT_RGBA16F, PIXELFORMAT_RGBA32F, TEXTURETYPE_RGBP, TEXTURETYPE_RGBE, TEXTURELOCK_WRITE, getPixelFormatArrayType } from './constants.js';\n\nlet id = 0;\nclass Texture {\n\tconstructor(graphicsDevice, options = {}) {\n\t\tvar _options$name, _options$width, _options$height, _options$format, _options$storage, _options$cubemap, _options$fixCubemapSe, _options$flipY, _options$premultiplyA, _ref, _options$mipmaps, _options$minFilter, _options$magFilter, _options$anisotropy, _options$addressU, _options$addressV, _options$addressW, _options$compareOnRea, _options$compareFunc;\n\t\tthis.name = void 0;\n\t\tthis._isRenderTarget = false;\n\t\tthis._gpuSize = 0;\n\t\tthis.id = id++;\n\t\tthis._invalid = false;\n\t\tthis._lockedLevel = -1;\n\t\tthis.renderVersionDirty = 0;\n\t\tthis._storage = false;\n\t\tthis.device = graphicsDevice;\n\t\tthis.name = (_options$name = options.name) != null ? _options$name : '';\n\t\tthis._width = Math.floor((_options$width = options.width) != null ? _options$width : 4);\n\t\tthis._height = Math.floor((_options$height = options.height) != null ? _options$height : 4);\n\t\tthis._format = (_options$format = options.format) != null ? _options$format : PIXELFORMAT_RGBA8;\n\t\tthis._compressed = isCompressedPixelFormat(this._format);\n\t\tif (graphicsDevice.supportsVolumeTextures) {\n\t\t\tvar _options$volume, _options$depth, _options$arrayLength;\n\t\t\tthis._volume = (_options$volume = options.volume) != null ? _options$volume : false;\n\t\t\tthis._depth = Math.floor((_options$depth = options.depth) != null ? _options$depth : 1);\n\t\t\tthis._arrayLength = Math.floor((_options$arrayLength = options.arrayLength) != null ? _options$arrayLength : 0);\n\t\t} else {\n\t\t\tthis._volume = false;\n\t\t\tthis._depth = 1;\n\t\t\tthis._arrayLength = 0;\n\t\t}\n\t\tthis._storage = (_options$storage = options.storage) != null ? _options$storage : false;\n\t\tthis._cubemap = (_options$cubemap = options.cubemap) != null ? _options$cubemap : false;\n\t\tthis.fixCubemapSeams = (_options$fixCubemapSe = options.fixCubemapSeams) != null ? _options$fixCubemapSe : false;\n\t\tthis._flipY = (_options$flipY = options.flipY) != null ? _options$flipY : false;\n\t\tthis._premultiplyAlpha = (_options$premultiplyA = options.premultiplyAlpha) != null ? _options$premultiplyA : false;\n\t\tthis._mipmaps = (_ref = (_options$mipmaps = options.mipmaps) != null ? _options$mipmaps : options.autoMipmap) != null ? _ref : true;\n\t\tthis._minFilter = (_options$minFilter = options.minFilter) != null ? _options$minFilter : FILTER_LINEAR_MIPMAP_LINEAR;\n\t\tthis._magFilter = (_options$magFilter = options.magFilter) != null ? _options$magFilter : FILTER_LINEAR;\n\t\tthis._anisotropy = (_options$anisotropy = options.anisotropy) != null ? _options$anisotropy : 1;\n\t\tthis._addressU = (_options$addressU = options.addressU) != null ? _options$addressU : ADDRESS_REPEAT;\n\t\tthis._addressV = (_options$addressV = options.addressV) != null ? _options$addressV : ADDRESS_REPEAT;\n\t\tthis._addressW = (_options$addressW = options.addressW) != null ? _options$addressW : ADDRESS_REPEAT;\n\t\tthis._compareOnRead = (_options$compareOnRea = options.compareOnRead) != null ? _options$compareOnRea : false;\n\t\tthis._compareFunc = (_options$compareFunc = options.compareFunc) != null ? _options$compareFunc : FUNC_LESS;\n\t\tthis.type = TEXTURETYPE_DEFAULT;\n\t\tif (options.hasOwnProperty('type')) {\n\t\t\tthis.type = options.type;\n\t\t} else if (options.hasOwnProperty('rgbm')) {\n\t\t\tthis.type = options.rgbm ? TEXTURETYPE_RGBM : TEXTURETYPE_DEFAULT;\n\t\t} else if (options.hasOwnProperty('swizzleGGGR')) {\n\t\t\tthis.type = options.swizzleGGGR ? TEXTURETYPE_SWIZZLEGGGR : TEXTURETYPE_DEFAULT;\n\t\t}\n\t\tthis.projection = TEXTUREPROJECTION_NONE;\n\t\tif (this._cubemap) {\n\t\t\tthis.projection = TEXTUREPROJECTION_CUBE;\n\t\t} else if (options.projection && options.projection !== TEXTUREPROJECTION_CUBE) {\n\t\t\tthis.projection = options.projection;\n\t\t}\n\t\tthis.impl = graphicsDevice.createTextureImpl(this);\n\t\tthis.dirtyAll();\n\t\tthis._levels = options.levels;\n\t\tif (this._levels) {\n\t\t\tthis.upload();\n\t\t} else {\n\t\t\tthis._levels = this._cubemap ? [[null, null, null, null, null, null]] : [null];\n\t\t}\n\t\tgraphicsDevice.textures.push(this);\n\t}\n\tdestroy() {\n\t\tconst device = this.device;\n\t\tif (device) {\n\t\t\tconst idx = device.textures.indexOf(this);\n\t\t\tif (idx !== -1) {\n\t\t\t\tdevice.textures.splice(idx, 1);\n\t\t\t}\n\t\t\tdevice.scope.removeValue(this);\n\t\t\tthis.impl.destroy(device);\n\t\t\tthis.adjustVramSizeTracking(device._vram, -this._gpuSize);\n\t\t\tthis._levels = null;\n\t\t\tthis.device = null;\n\t\t}\n\t}\n\tresize(width, height, depth = 1) {\n\t\tconst device = this.device;\n\t\tthis.adjustVramSizeTracking(device._vram, -this._gpuSize);\n\t\tthis.impl.destroy(device);\n\t\tthis._width = Math.floor(width);\n\t\tthis._height = Math.floor(height);\n\t\tthis._depth = Math.floor(depth);\n\t\tthis.impl = device.createTextureImpl(this);\n\t\tthis.dirtyAll();\n\t}\n\tloseContext() {\n\t\tthis.impl.loseContext();\n\t\tthis.dirtyAll();\n\t}\n\tadjustVramSizeTracking(vram, size) {\n\t\tvram.tex += size;\n\t}\n\tpropertyChanged(flag) {\n\t\tthis.impl.propertyChanged(flag);\n\t\tthis.renderVersionDirty = this.device.renderVersion;\n\t}\n\tget requiredMipLevels() {\n\t\treturn this.mipmaps ? TextureUtils.calcMipLevelsCount(this.width, this.height) : 1;\n\t}\n\tset minFilter(v) {\n\t\tif (this._minFilter !== v) {\n\t\t\tthis._minFilter = v;\n\t\t\tthis.propertyChanged(1);\n\t\t}\n\t}\n\tget minFilter() {\n\t\treturn this._minFilter;\n\t}\n\tset magFilter(v) {\n\t\tif (this._magFilter !== v) {\n\t\t\tthis._magFilter = v;\n\t\t\tthis.propertyChanged(2);\n\t\t}\n\t}\n\tget magFilter() {\n\t\treturn this._magFilter;\n\t}\n\tset addressU(v) {\n\t\tif (this._addressU !== v) {\n\t\t\tthis._addressU = v;\n\t\t\tthis.propertyChanged(4);\n\t\t}\n\t}\n\tget addressU() {\n\t\treturn this._addressU;\n\t}\n\tset addressV(v) {\n\t\tif (this._addressV !== v) {\n\t\t\tthis._addressV = v;\n\t\t\tthis.propertyChanged(8);\n\t\t}\n\t}\n\tget addressV() {\n\t\treturn this._addressV;\n\t}\n\tset addressW(addressW) {\n\t\tif (!this.device.supportsVolumeTextures) return;\n\t\tif (!this._volume) {\n\t\t\treturn;\n\t\t}\n\t\tif (addressW !== this._addressW) {\n\t\t\tthis._addressW = addressW;\n\t\t\tthis.propertyChanged(16);\n\t\t}\n\t}\n\tget addressW() {\n\t\treturn this._addressW;\n\t}\n\tset compareOnRead(v) {\n\t\tif (this._compareOnRead !== v) {\n\t\t\tthis._compareOnRead = v;\n\t\t\tthis.propertyChanged(32);\n\t\t}\n\t}\n\tget compareOnRead() {\n\t\treturn this._compareOnRead;\n\t}\n\tset compareFunc(v) {\n\t\tif (this._compareFunc !== v) {\n\t\t\tthis._compareFunc = v;\n\t\t\tthis.propertyChanged(64);\n\t\t}\n\t}\n\tget compareFunc() {\n\t\treturn this._compareFunc;\n\t}\n\tset anisotropy(v) {\n\t\tif (this._anisotropy !== v) {\n\t\t\tthis._anisotropy = v;\n\t\t\tthis.propertyChanged(128);\n\t\t}\n\t}\n\tget anisotropy() {\n\t\treturn this._anisotropy;\n\t}\n\tset mipmaps(v) {\n\t\tif (this._mipmaps !== v) {\n\t\t\tthis._mipmaps = v;\n\t\t\tif (this.device.isWebGPU) ;\n\t\t\tif (v) this._needsMipmapsUpload = true;\n\t\t}\n\t}\n\tget mipmaps() {\n\t\treturn this._mipmaps;\n\t}\n\tget storage() {\n\t\treturn this._storage;\n\t}\n\tget width() {\n\t\treturn this._width;\n\t}\n\tget height() {\n\t\treturn this._height;\n\t}\n\tget depth() {\n\t\treturn this._depth;\n\t}\n\tget format() {\n\t\treturn this._format;\n\t}\n\tget cubemap() {\n\t\treturn this._cubemap;\n\t}\n\tget gpuSize() {\n\t\tconst mips = this.pot && this._mipmaps && !(this._compressed && this._levels.length === 1);\n\t\treturn TextureUtils.calcGpuSize(this._width, this._height, this._depth, this._format, mips, this._cubemap);\n\t}\n\tget array() {\n\t\treturn this._arrayLength > 0;\n\t}\n\tget arrayLength() {\n\t\treturn this._arrayLength;\n\t}\n\tget volume() {\n\t\treturn this._volume;\n\t}\n\tset flipY(flipY) {\n\t\tif (this._flipY !== flipY) {\n\t\t\tthis._flipY = flipY;\n\t\t\tthis._needsUpload = true;\n\t\t}\n\t}\n\tget flipY() {\n\t\treturn this._flipY;\n\t}\n\tset premultiplyAlpha(premultiplyAlpha) {\n\t\tif (this._premultiplyAlpha !== premultiplyAlpha) {\n\t\t\tthis._premultiplyAlpha = premultiplyAlpha;\n\t\t\tthis._needsUpload = true;\n\t\t}\n\t}\n\tget premultiplyAlpha() {\n\t\treturn this._premultiplyAlpha;\n\t}\n\tget pot() {\n\t\treturn math.powerOfTwo(this._width) && math.powerOfTwo(this._height);\n\t}\n\tget encoding() {\n\t\tswitch (this.type) {\n\t\t\tcase TEXTURETYPE_RGBM:\n\t\t\t\treturn 'rgbm';\n\t\t\tcase TEXTURETYPE_RGBE:\n\t\t\t\treturn 'rgbe';\n\t\t\tcase TEXTURETYPE_RGBP:\n\t\t\t\treturn 'rgbp';\n\t\t\tdefault:\n\t\t\t\treturn this.format === PIXELFORMAT_RGB16F || this.format === PIXELFORMAT_RGB32F || this.format === PIXELFORMAT_RGBA16F || this.format === PIXELFORMAT_RGBA32F ? 'linear' : 'srgb';\n\t\t}\n\t}\n\tdirtyAll() {\n\t\tthis._levelsUpdated = this._cubemap ? [[true, true, true, true, true, true]] : [true];\n\t\tthis._needsUpload = true;\n\t\tthis._needsMipmapsUpload = this._mipmaps;\n\t\tthis._mipmapsUploaded = false;\n\t\tthis.propertyChanged(255);\n\t}\n\tlock(options = {}) {\n\t\tif (options.level === undefined) {\n\t\t\toptions.level = 0;\n\t\t}\n\t\tif (options.face === undefined) {\n\t\t\toptions.face = 0;\n\t\t}\n\t\tif (options.mode === undefined) {\n\t\t\toptions.mode = TEXTURELOCK_WRITE;\n\t\t}\n\t\tthis._lockedLevel = options.level;\n\t\tconst levels = this.cubemap ? this._levels[options.face] : this._levels;\n\t\tif (levels[options.level] === null) {\n\t\t\tconst width = Math.max(1, this._width >> options.level);\n\t\t\tconst height = Math.max(1, this._height >> options.level);\n\t\t\tconst depth = Math.max(1, this._depth >> options.level);\n\t\t\tconst data = new ArrayBuffer(TextureUtils.calcLevelGpuSize(width, height, depth, this._format));\n\t\t\tlevels[options.level] = new (getPixelFormatArrayType(this._format))(data);\n\t\t}\n\t\treturn levels[options.level];\n\t}\n\tsetSource(source, mipLevel = 0) {\n\t\tlet invalid = false;\n\t\tlet width, height;\n\t\tif (this._cubemap) {\n\t\t\tif (source[0]) {\n\t\t\t\twidth = source[0].width || 0;\n\t\t\t\theight = source[0].height || 0;\n\t\t\t\tfor (let i = 0; i < 6; i++) {\n\t\t\t\t\tconst face = source[i];\n\t\t\t\t\tif (!face || face.width !== width || face.height !== height || !this.device._isBrowserInterface(face)) {\n\t\t\t\t\t\tinvalid = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tinvalid = true;\n\t\t\t}\n\t\t\tif (!invalid) {\n\t\t\t\tfor (let i = 0; i < 6; i++) {\n\t\t\t\t\tif (this._levels[mipLevel][i] !== source[i]) this._levelsUpdated[mipLevel][i] = true;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (!this.device._isBrowserInterface(source)) invalid = true;\n\t\t\tif (!invalid) {\n\t\t\t\tif (source !== this._levels[mipLevel]) this._levelsUpdated[mipLevel] = true;\n\t\t\t\twidth = source.width;\n\t\t\t\theight = source.height;\n\t\t\t}\n\t\t}\n\t\tif (invalid) {\n\t\t\tthis._width = 4;\n\t\t\tthis._height = 4;\n\t\t\tif (this._cubemap) {\n\t\t\t\tfor (let i = 0; i < 6; i++) {\n\t\t\t\t\tthis._levels[mipLevel][i] = null;\n\t\t\t\t\tthis._levelsUpdated[mipLevel][i] = true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._levels[mipLevel] = null;\n\t\t\t\tthis._levelsUpdated[mipLevel] = true;\n\t\t\t}\n\t\t} else {\n\t\t\tif (mipLevel === 0) {\n\t\t\t\tthis._width = width;\n\t\t\t\tthis._height = height;\n\t\t\t}\n\t\t\tthis._levels[mipLevel] = source;\n\t\t}\n\t\tif (this._invalid !== invalid || !invalid) {\n\t\t\tthis._invalid = invalid;\n\t\t\tthis.upload();\n\t\t}\n\t}\n\tgetSource(mipLevel = 0) {\n\t\treturn this._levels[mipLevel];\n\t}\n\tunlock() {\n\t\tif (this._lockedLevel === -1) ;\n\t\tthis.upload();\n\t\tthis._lockedLevel = -1;\n\t}\n\tupload() {\n\t\tvar _this$impl$uploadImme, _this$impl;\n\t\tthis._needsUpload = true;\n\t\tthis._needsMipmapsUpload = this._mipmaps;\n\t\t(_this$impl$uploadImme = (_this$impl = this.impl).uploadImmediate) == null || _this$impl$uploadImme.call(_this$impl, this.device, this);\n\t}\n\tasync downloadAsync() {\n\t\tconst promises = [];\n\t\tfor (let i = 0; i < (this.cubemap ? 6 : 1); i++) {\n\t\t\tvar _this$device$readPixe, _this$device;\n\t\t\tconst renderTarget = new RenderTarget({\n\t\t\t\tcolorBuffer: this,\n\t\t\t\tdepth: false,\n\t\t\t\tface: i\n\t\t\t});\n\t\t\tthis.device.setRenderTarget(renderTarget);\n\t\t\tthis.device.initRenderTarget(renderTarget);\n\t\t\tconst levels = this.cubemap ? this._levels[i] : this._levels;\n\t\t\tlet level = levels[0];\n\t\t\tif (levels[0] && this.device._isBrowserInterface(levels[0])) {\n\t\t\t\tlevels[0] = null;\n\t\t\t}\n\t\t\tlevel = this.lock({\n\t\t\t\tface: i\n\t\t\t});\n\t\t\tconst promise = (_this$device$readPixe = (_this$device = this.device).readPixelsAsync) == null ? void 0 : _this$device$readPixe.call(_this$device, 0, 0, this.width, this.height, level).then(() => renderTarget.destroy());\n\t\t\tpromises.push(promise);\n\t\t}\n\t\tawait Promise.all(promises);\n\t}\n}\n\nexport { Texture };\n","import { BUFFER_GPUDYNAMIC, BUFFER_STREAM, BUFFER_DYNAMIC, BUFFER_STATIC } from '../constants.js';\n\nclass WebglBuffer {\n\tconstructor() {\n\t\tthis.bufferId = null;\n\t}\n\tdestroy(device) {\n\t\tif (this.bufferId) {\n\t\t\tdevice.gl.deleteBuffer(this.bufferId);\n\t\t\tthis.bufferId = null;\n\t\t}\n\t}\n\tget initialized() {\n\t\treturn !!this.bufferId;\n\t}\n\tloseContext() {\n\t\tthis.bufferId = null;\n\t}\n\tunlock(device, usage, target, storage) {\n\t\tconst gl = device.gl;\n\t\tif (!this.bufferId) {\n\t\t\tlet glUsage;\n\t\t\tswitch (usage) {\n\t\t\t\tcase BUFFER_STATIC:\n\t\t\t\t\tglUsage = gl.STATIC_DRAW;\n\t\t\t\t\tbreak;\n\t\t\t\tcase BUFFER_DYNAMIC:\n\t\t\t\t\tglUsage = gl.DYNAMIC_DRAW;\n\t\t\t\t\tbreak;\n\t\t\t\tcase BUFFER_STREAM:\n\t\t\t\t\tglUsage = gl.STREAM_DRAW;\n\t\t\t\t\tbreak;\n\t\t\t\tcase BUFFER_GPUDYNAMIC:\n\t\t\t\t\tglUsage = device.isWebGL2 ? gl.DYNAMIC_COPY : gl.STATIC_DRAW;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tthis.bufferId = gl.createBuffer();\n\t\t\tgl.bindBuffer(target, this.bufferId);\n\t\t\tgl.bufferData(target, storage, glUsage);\n\t\t} else {\n\t\t\tgl.bindBuffer(target, this.bufferId);\n\t\t\tgl.bufferSubData(target, 0, storage);\n\t\t}\n\t}\n}\n\nexport { WebglBuffer };\n","import { WebglBuffer } from './webgl-buffer.js';\n\nclass WebglVertexBuffer extends WebglBuffer {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\t\tthis.vao = null;\n\t}\n\tdestroy(device) {\n\t\tsuper.destroy(device);\n\t\tdevice.boundVao = null;\n\t\tdevice.gl.bindVertexArray(null);\n\t}\n\tloseContext() {\n\t\tsuper.loseContext();\n\t\tthis.vao = null;\n\t}\n\tunlock(vertexBuffer) {\n\t\tconst device = vertexBuffer.device;\n\t\tsuper.unlock(device, vertexBuffer.usage, device.gl.ARRAY_BUFFER, vertexBuffer.storage);\n\t}\n}\n\nexport { WebglVertexBuffer };\n","import { INDEXFORMAT_UINT8, INDEXFORMAT_UINT16, INDEXFORMAT_UINT32 } from '../constants.js';\nimport { WebglBuffer } from './webgl-buffer.js';\n\nclass WebglIndexBuffer extends WebglBuffer {\n\tconstructor(indexBuffer) {\n\t\tsuper();\n\t\tconst gl = indexBuffer.device.gl;\n\t\tconst format = indexBuffer.format;\n\t\tif (format === INDEXFORMAT_UINT8) {\n\t\t\tthis.glFormat = gl.UNSIGNED_BYTE;\n\t\t} else if (format === INDEXFORMAT_UINT16) {\n\t\t\tthis.glFormat = gl.UNSIGNED_SHORT;\n\t\t} else if (format === INDEXFORMAT_UINT32) {\n\t\t\tthis.glFormat = gl.UNSIGNED_INT;\n\t\t}\n\t}\n\tunlock(indexBuffer) {\n\t\tconst device = indexBuffer.device;\n\t\tsuper.unlock(device, indexBuffer.usage, device.gl.ELEMENT_ARRAY_BUFFER, indexBuffer.storage);\n\t}\n}\n\nexport { WebglIndexBuffer };\n","import { UNIFORMTYPE_VEC4, UNIFORMTYPE_VEC4ARRAY, UNIFORMTYPE_VEC3, UNIFORMTYPE_VEC3ARRAY, UNIFORMTYPE_VEC2, UNIFORMTYPE_VEC2ARRAY, UNIFORMTYPE_FLOAT, UNIFORMTYPE_FLOATARRAY } from '../constants.js';\nimport { Version } from '../version.js';\n\nclass WebglShaderInput {\n\tconstructor(graphicsDevice, name, type, locationId) {\n\t\tthis.locationId = locationId;\n\t\tthis.scopeId = graphicsDevice.scope.resolve(name);\n\t\tthis.version = new Version();\n\t\tif (name.substring(name.length - 3) === \"[0]\") {\n\t\t\tswitch (type) {\n\t\t\t\tcase UNIFORMTYPE_FLOAT:\n\t\t\t\t\ttype = UNIFORMTYPE_FLOATARRAY;\n\t\t\t\t\tbreak;\n\t\t\t\tcase UNIFORMTYPE_VEC2:\n\t\t\t\t\ttype = UNIFORMTYPE_VEC2ARRAY;\n\t\t\t\t\tbreak;\n\t\t\t\tcase UNIFORMTYPE_VEC3:\n\t\t\t\t\ttype = UNIFORMTYPE_VEC3ARRAY;\n\t\t\t\t\tbreak;\n\t\t\t\tcase UNIFORMTYPE_VEC4:\n\t\t\t\t\ttype = UNIFORMTYPE_VEC4ARRAY;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tthis.dataType = type;\n\t\tthis.value = [null, null, null, null];\n\t\tthis.array = [];\n\t}\n}\n\nexport { WebglShaderInput };\n","class DeviceCache {\n\tconstructor() {\n\t\tthis._cache = new Map();\n\t}\n\tget(device, onCreate) {\n\t\tif (!this._cache.has(device)) {\n\t\t\tthis._cache.set(device, onCreate());\n\t\t\tdevice.on('destroy', () => {\n\t\t\t\tthis.remove(device);\n\t\t\t});\n\t\t\tdevice.on('devicelost', () => {\n\t\t\t\tvar _this$_cache$get;\n\t\t\t\t(_this$_cache$get = this._cache.get(device)) == null || _this$_cache$get.loseContext == null || _this$_cache$get.loseContext(device);\n\t\t\t});\n\t\t}\n\t\treturn this._cache.get(device);\n\t}\n\tremove(device) {\n\t\tvar _this$_cache$get2;\n\t\t(_this$_cache$get2 = this._cache.get(device)) == null || _this$_cache$get2.destroy == null || _this$_cache$get2.destroy(device);\n\t\tthis._cache.delete(device);\n\t}\n}\n\nexport { DeviceCache };\n","import '../../../core/tracing.js';\nimport '../../../core/time.js';\nimport { WebglShaderInput } from './webgl-shader-input.js';\nimport { semanticToLocation } from '../constants.js';\nimport { DeviceCache } from '../device-cache.js';\n\nconst _vertexShaderBuiltins = ['gl_VertexID', 'gl_InstanceID', 'gl_DrawID', 'gl_BaseVertex', 'gl_BaseInstance'];\nclass CompiledShaderCache {\n\tconstructor() {\n\t\tthis.map = new Map();\n\t}\n\tdestroy(device) {\n\t\tthis.map.forEach(shader => {\n\t\t\tdevice.gl.deleteShader(shader);\n\t\t});\n\t}\n\tloseContext(device) {\n\t\tthis.map.clear();\n\t}\n}\nclass ShaderBatchCache {\n\tconstructor() {\n\t\tthis.shaders = [];\n\t}\n\tloseContext(device) {\n\t\tthis.shaders = [];\n\t}\n}\nconst _vertexShaderCache = new DeviceCache();\nconst _fragmentShaderCache = new DeviceCache();\nconst _shaderBatchCache = new DeviceCache();\nclass WebglShader {\n\tconstructor(shader) {\n\t\tthis.compileDuration = 0;\n\t\tthis.init();\n\t\tthis.compile(shader.device, shader);\n\t\tWebglShader.getBatchShaders(shader.device).push(shader);\n\t\tshader.device.shaders.push(shader);\n\t}\n\tdestroy(shader) {\n\t\tif (this.glProgram) {\n\t\t\tshader.device.gl.deleteProgram(this.glProgram);\n\t\t\tthis.glProgram = null;\n\t\t}\n\t}\n\tinit() {\n\t\tthis.uniforms = [];\n\t\tthis.samplers = [];\n\t\tthis.attributes = [];\n\t\tthis.glProgram = null;\n\t\tthis.glVertexShader = null;\n\t\tthis.glFragmentShader = null;\n\t}\n\tstatic getBatchShaders(device) {\n\t\tconst batchCache = _shaderBatchCache.get(device, () => {\n\t\t\treturn new ShaderBatchCache();\n\t\t});\n\t\treturn batchCache.shaders;\n\t}\n\tstatic endShaderBatch(device) {\n\t\tconst shaders = WebglShader.getBatchShaders(device);\n\t\tshaders.forEach(shader => shader.impl.link(device, shader));\n\t\tshaders.length = 0;\n\t}\n\tloseContext() {\n\t\tthis.init();\n\t}\n\trestoreContext(device, shader) {\n\t\tthis.compile(device, shader);\n\t}\n\tcompile(device, shader) {\n\t\tconst definition = shader.definition;\n\t\tthis.glVertexShader = this._compileShaderSource(device, definition.vshader, true);\n\t\tthis.glFragmentShader = this._compileShaderSource(device, definition.fshader, false);\n\t}\n\tlink(device, shader) {\n\t\tif (this.glProgram) return;\n\t\tconst gl = device.gl;\n\t\tif (gl.isContextLost()) {\n\t\t\treturn;\n\t\t}\n\t\tconst glProgram = gl.createProgram();\n\t\tthis.glProgram = glProgram;\n\t\tgl.attachShader(glProgram, this.glVertexShader);\n\t\tgl.attachShader(glProgram, this.glFragmentShader);\n\t\tconst definition = shader.definition;\n\t\tconst attrs = definition.attributes;\n\t\tif (device.isWebGL2 && definition.useTransformFeedback) {\n\t\t\tconst outNames = [];\n\t\t\tfor (const attr in attrs) {\n\t\t\t\tif (attrs.hasOwnProperty(attr)) {\n\t\t\t\t\toutNames.push(\"out_\" + attr);\n\t\t\t\t}\n\t\t\t}\n\t\t\tgl.transformFeedbackVaryings(glProgram, outNames, gl.INTERLEAVED_ATTRIBS);\n\t\t}\n\t\tfor (const attr in attrs) {\n\t\t\tif (attrs.hasOwnProperty(attr)) {\n\t\t\t\tconst semantic = attrs[attr];\n\t\t\t\tconst loc = semanticToLocation[semantic];\n\t\t\t\tgl.bindAttribLocation(glProgram, loc, attr);\n\t\t\t}\n\t\t}\n\t\tgl.linkProgram(glProgram);\n\t}\n\t_compileShaderSource(device, src, isVertexShader) {\n\t\tconst gl = device.gl;\n\t\tconst shaderDeviceCache = isVertexShader ? _vertexShaderCache : _fragmentShaderCache;\n\t\tconst shaderCache = shaderDeviceCache.get(device, () => {\n\t\t\treturn new CompiledShaderCache();\n\t\t});\n\t\tlet glShader = shaderCache.map.get(src);\n\t\tif (!glShader) {\n\t\t\tglShader = gl.createShader(isVertexShader ? gl.VERTEX_SHADER : gl.FRAGMENT_SHADER);\n\t\t\tif (!glShader && gl.isContextLost()) {\n\t\t\t\treturn glShader;\n\t\t\t}\n\t\t\tgl.shaderSource(glShader, src);\n\t\t\tgl.compileShader(glShader);\n\t\t\tshaderCache.map.set(src, glShader);\n\t\t}\n\t\treturn glShader;\n\t}\n\tfinalize(device, shader) {\n\t\tconst gl = device.gl;\n\t\tif (gl.isContextLost()) {\n\t\t\treturn true;\n\t\t}\n\t\tif (!this.glProgram) this.link(device, shader);\n\t\tconst glProgram = this.glProgram;\n\t\tconst definition = shader.definition;\n\t\tconst linkStatus = gl.getProgramParameter(glProgram, gl.LINK_STATUS);\n\t\tif (!linkStatus) {\n\t\t\tif (!this._isCompiled(device, shader, this.glVertexShader, definition.vshader, \"vertex\")) return false;\n\t\t\tif (!this._isCompiled(device, shader, this.glFragmentShader, definition.fshader, \"fragment\")) return false;\n\t\t\tconst message = \"Failed to link shader program. Error: \" + gl.getProgramInfoLog(glProgram);\n\t\t\tconsole.error(message);\n\t\t\treturn false;\n\t\t}\n\t\tlet i = 0;\n\t\tconst numAttributes = gl.getProgramParameter(glProgram, gl.ACTIVE_ATTRIBUTES);\n\t\twhile (i < numAttributes) {\n\t\t\tconst info = gl.getActiveAttrib(glProgram, i++);\n\t\t\tconst location = gl.getAttribLocation(glProgram, info.name);\n\t\t\tif (_vertexShaderBuiltins.indexOf(info.name) !== -1) continue;\n\t\t\tif (definition.attributes[info.name] === undefined) {\n\t\t\t\tconsole.error(`Vertex shader attribute \"${info.name}\" is not mapped to a semantic in shader definition, shader [${shader.label}]`, shader);\n\t\t\t\tshader.failed = true;\n\t\t\t} else {\n\t\t\t\tconst shaderInput = new WebglShaderInput(device, definition.attributes[info.name], device.pcUniformType[info.type], location);\n\t\t\t\tthis.attributes.push(shaderInput);\n\t\t\t}\n\t\t}\n\t\ti = 0;\n\t\tconst numUniforms = gl.getProgramParameter(glProgram, gl.ACTIVE_UNIFORMS);\n\t\twhile (i < numUniforms) {\n\t\t\tconst info = gl.getActiveUniform(glProgram, i++);\n\t\t\tconst location = gl.getUniformLocation(glProgram, info.name);\n\t\t\tconst shaderInput = new WebglShaderInput(device, info.name, device.pcUniformType[info.type], location);\n\t\t\tif (info.type === gl.SAMPLER_2D || info.type === gl.SAMPLER_CUBE || device.isWebGL2 && (info.type === gl.SAMPLER_2D_SHADOW || info.type === gl.SAMPLER_CUBE_SHADOW || info.type === gl.SAMPLER_3D || info.type === gl.SAMPLER_2D_ARRAY)) {\n\t\t\t\tthis.samplers.push(shaderInput);\n\t\t\t} else {\n\t\t\t\tthis.uniforms.push(shaderInput);\n\t\t\t}\n\t\t}\n\t\tshader.ready = true;\n\t\treturn true;\n\t}\n\t_isCompiled(device, shader, glShader, source, shaderType) {\n\t\tconst gl = device.gl;\n\t\tif (!gl.getShaderParameter(glShader, gl.COMPILE_STATUS)) {\n\t\t\tconst infoLog = gl.getShaderInfoLog(glShader);\n\t\t\tconst [code, error] = this._processError(source, infoLog);\n\t\t\tconst message = `Failed to compile ${shaderType} shader:\\n\\n${infoLog}\\n${code}`;\n\t\t\tconsole.error(message);\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\t_processError(src, infoLog) {\n\t\tconst error = {};\n\t\tlet code = '';\n\t\tif (src) {\n\t\t\tconst lines = src.split('\\n');\n\t\t\tlet from = 0;\n\t\t\tlet to = lines.length;\n\t\t\tif (infoLog && infoLog.startsWith('ERROR:')) {\n\t\t\t\tconst match = infoLog.match(/^ERROR:\\s([0-9]+):([0-9]+):\\s*(.+)/);\n\t\t\t\tif (match) {\n\t\t\t\t\terror.message = match[3];\n\t\t\t\t\terror.line = parseInt(match[2], 10);\n\t\t\t\t\tfrom = Math.max(0, error.line - 6);\n\t\t\t\t\tto = Math.min(lines.length, error.line + 5);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (let i = from; i < to; i++) {\n\t\t\t\tcode += i + 1 + \":\\t\" + lines[i] + '\\n';\n\t\t\t}\n\t\t\terror.source = src;\n\t\t}\n\t\treturn [code, error];\n\t}\n}\n\nexport { WebglShader };\n","import '../../../core/tracing.js';\nimport { PIXELFORMAT_SRGBA, PIXELFORMAT_SRGB, PIXELFORMAT_111110F, PIXELFORMAT_DEPTHSTENCIL, PIXELFORMAT_DEPTH, PIXELFORMAT_R32F, PIXELFORMAT_RGBA32F, PIXELFORMAT_RGB32F, PIXELFORMAT_RGBA16F, PIXELFORMAT_RGB16F, PIXELFORMAT_ATC_RGBA, PIXELFORMAT_ATC_RGB, PIXELFORMAT_ASTC_4x4, PIXELFORMAT_ETC2_RGBA, PIXELFORMAT_ETC2_RGB, PIXELFORMAT_PVRTC_4BPP_RGBA_1, PIXELFORMAT_PVRTC_4BPP_RGB_1, PIXELFORMAT_PVRTC_2BPP_RGBA_1, PIXELFORMAT_PVRTC_2BPP_RGB_1, PIXELFORMAT_ETC1, PIXELFORMAT_DXT5, PIXELFORMAT_DXT3, PIXELFORMAT_DXT1, PIXELFORMAT_RGBA8, PIXELFORMAT_RGB8, PIXELFORMAT_RGBA4, PIXELFORMAT_RGBA5551, PIXELFORMAT_RGB565, PIXELFORMAT_LA8, PIXELFORMAT_L8, PIXELFORMAT_A8 } from '../constants.js';\n\nfunction downsampleImage(image, size) {\n\tconst srcW = image.width;\n\tconst srcH = image.height;\n\tif (srcW > size || srcH > size) {\n\t\tconst scale = size / Math.max(srcW, srcH);\n\t\tconst dstW = Math.floor(srcW * scale);\n\t\tconst dstH = Math.floor(srcH * scale);\n\t\tconst canvas = document.createElement('canvas');\n\t\tcanvas.width = dstW;\n\t\tcanvas.height = dstH;\n\t\tconst context = canvas.getContext('2d');\n\t\tcontext.drawImage(image, 0, 0, srcW, srcH, 0, 0, dstW, dstH);\n\t\treturn canvas;\n\t}\n\treturn image;\n}\nclass WebglTexture {\n\tconstructor() {\n\t\tthis._glTexture = null;\n\t\tthis._glTarget = void 0;\n\t\tthis._glFormat = void 0;\n\t\tthis._glInternalFormat = void 0;\n\t\tthis._glPixelType = void 0;\n\t\tthis._glCreated = void 0;\n\t\tthis.dirtyParameterFlags = 0;\n\t}\n\tdestroy(device) {\n\t\tif (this._glTexture) {\n\t\t\tfor (let i = 0; i < device.textureUnits.length; i++) {\n\t\t\t\tconst textureUnit = device.textureUnits[i];\n\t\t\t\tfor (let j = 0; j < textureUnit.length; j++) {\n\t\t\t\t\tif (textureUnit[j] === this._glTexture) {\n\t\t\t\t\t\ttextureUnit[j] = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tdevice.gl.deleteTexture(this._glTexture);\n\t\t\tthis._glTexture = null;\n\t\t}\n\t}\n\tloseContext() {\n\t\tthis._glTexture = null;\n\t}\n\tpropertyChanged(flag) {\n\t\tthis.dirtyParameterFlags |= flag;\n\t}\n\tinitialize(device, texture) {\n\t\tconst gl = device.gl;\n\t\tthis._glTexture = gl.createTexture();\n\t\tthis._glTarget = texture._cubemap ? gl.TEXTURE_CUBE_MAP : texture._volume ? gl.TEXTURE_3D : texture.array ? gl.TEXTURE_2D_ARRAY : gl.TEXTURE_2D;\n\t\tswitch (texture._format) {\n\t\t\tcase PIXELFORMAT_A8:\n\t\t\t\tthis._glFormat = gl.ALPHA;\n\t\t\t\tthis._glInternalFormat = gl.ALPHA;\n\t\t\t\tthis._glPixelType = gl.UNSIGNED_BYTE;\n\t\t\t\tbreak;\n\t\t\tcase PIXELFORMAT_L8:\n\t\t\t\tthis._glFormat = gl.LUMINANCE;\n\t\t\t\tthis._glInternalFormat = gl.LUMINANCE;\n\t\t\t\tthis._glPixelType = gl.UNSIGNED_BYTE;\n\t\t\t\tbreak;\n\t\t\tcase PIXELFORMAT_LA8:\n\t\t\t\tthis._glFormat = gl.LUMINANCE_ALPHA;\n\t\t\t\tthis._glInternalFormat = gl.LUMINANCE_ALPHA;\n\t\t\t\tthis._glPixelType = gl.UNSIGNED_BYTE;\n\t\t\t\tbreak;\n\t\t\tcase PIXELFORMAT_RGB565:\n\t\t\t\tthis._glFormat = gl.RGB;\n\t\t\t\tthis._glInternalFormat = gl.RGB;\n\t\t\t\tthis._glPixelType = gl.UNSIGNED_SHORT_5_6_5;\n\t\t\t\tbreak;\n\t\t\tcase PIXELFORMAT_RGBA5551:\n\t\t\t\tthis._glFormat = gl.RGBA;\n\t\t\t\tthis._glInternalFormat = gl.RGBA;\n\t\t\t\tthis._glPixelType = gl.UNSIGNED_SHORT_5_5_5_1;\n\t\t\t\tbreak;\n\t\t\tcase PIXELFORMAT_RGBA4:\n\t\t\t\tthis._glFormat = gl.RGBA;\n\t\t\t\tthis._glInternalFormat = gl.RGBA;\n\t\t\t\tthis._glPixelType = gl.UNSIGNED_SHORT_4_4_4_4;\n\t\t\t\tbreak;\n\t\t\tcase PIXELFORMAT_RGB8:\n\t\t\t\tthis._glFormat = gl.RGB;\n\t\t\t\tthis._glInternalFormat = device.isWebGL2 ? gl.RGB8 : gl.RGB;\n\t\t\t\tthis._glPixelType = gl.UNSIGNED_BYTE;\n\t\t\t\tbreak;\n\t\t\tcase PIXELFORMAT_RGBA8:\n\t\t\t\tthis._glFormat = gl.RGBA;\n\t\t\t\tthis._glInternalFormat = device.isWebGL2 ? gl.RGBA8 : gl.RGBA;\n\t\t\t\tthis._glPixelType = gl.UNSIGNED_BYTE;\n\t\t\t\tbreak;\n\t\t\tcase PIXELFORMAT_DXT1:\n\t\t\t\tthis._glFormat = gl.RGB;\n\t\t\t\tthis._glInternalFormat = device.extCompressedTextureS3TC.COMPRESSED_RGB_S3TC_DXT1_EXT;\n\t\t\t\tbreak;\n\t\t\tcase PIXELFORMAT_DXT3:\n\t\t\t\tthis._glFormat = gl.RGBA;\n\t\t\t\tthis._glInternalFormat = device.extCompressedTextureS3TC.COMPRESSED_RGBA_S3TC_DXT3_EXT;\n\t\t\t\tbreak;\n\t\t\tcase PIXELFORMAT_DXT5:\n\t\t\t\tthis._glFormat = gl.RGBA;\n\t\t\t\tthis._glInternalFormat = device.extCompressedTextureS3TC.COMPRESSED_RGBA_S3TC_DXT5_EXT;\n\t\t\t\tbreak;\n\t\t\tcase PIXELFORMAT_ETC1:\n\t\t\t\tthis._glFormat = gl.RGB;\n\t\t\t\tthis._glInternalFormat = device.extCompressedTextureETC1.COMPRESSED_RGB_ETC1_WEBGL;\n\t\t\t\tbreak;\n\t\t\tcase PIXELFORMAT_PVRTC_2BPP_RGB_1:\n\t\t\t\tthis._glFormat = gl.RGB;\n\t\t\t\tthis._glInternalFormat = device.extCompressedTexturePVRTC.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;\n\t\t\t\tbreak;\n\t\t\tcase PIXELFORMAT_PVRTC_2BPP_RGBA_1:\n\t\t\t\tthis._glFormat = gl.RGBA;\n\t\t\t\tthis._glInternalFormat = device.extCompressedTexturePVRTC.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;\n\t\t\t\tbreak;\n\t\t\tcase PIXELFORMAT_PVRTC_4BPP_RGB_1:\n\t\t\t\tthis._glFormat = gl.RGB;\n\t\t\t\tthis._glInternalFormat = device.extCompressedTexturePVRTC.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;\n\t\t\t\tbreak;\n\t\t\tcase PIXELFORMAT_PVRTC_4BPP_RGBA_1:\n\t\t\t\tthis._glFormat = gl.RGBA;\n\t\t\t\tthis._glInternalFormat = device.extCompressedTexturePVRTC.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;\n\t\t\t\tbreak;\n\t\t\tcase PIXELFORMAT_ETC2_RGB:\n\t\t\t\tthis._glFormat = gl.RGB;\n\t\t\t\tthis._glInternalFormat = device.extCompressedTextureETC.COMPRESSED_RGB8_ETC2;\n\t\t\t\tbreak;\n\t\t\tcase PIXELFORMAT_ETC2_RGBA:\n\t\t\t\tthis._glFormat = gl.RGBA;\n\t\t\t\tthis._glInternalFormat = device.extCompressedTextureETC.COMPRESSED_RGBA8_ETC2_EAC;\n\t\t\t\tbreak;\n\t\t\tcase PIXELFORMAT_ASTC_4x4:\n\t\t\t\tthis._glFormat = gl.RGBA;\n\t\t\t\tthis._glInternalFormat = device.extCompressedTextureASTC.COMPRESSED_RGBA_ASTC_4x4_KHR;\n\t\t\t\tbreak;\n\t\t\tcase PIXELFORMAT_ATC_RGB:\n\t\t\t\tthis._glFormat = gl.RGB;\n\t\t\t\tthis._glInternalFormat = device.extCompressedTextureATC.COMPRESSED_RGB_ATC_WEBGL;\n\t\t\t\tbreak;\n\t\t\tcase PIXELFORMAT_ATC_RGBA:\n\t\t\t\tthis._glFormat = gl.RGBA;\n\t\t\t\tthis._glInternalFormat = device.extCompressedTextureATC.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL;\n\t\t\t\tbreak;\n\t\t\tcase PIXELFORMAT_RGB16F:\n\t\t\t\tthis._glFormat = gl.RGB;\n\t\t\t\tif (device.isWebGL2) {\n\t\t\t\t\tthis._glInternalFormat = gl.RGB16F;\n\t\t\t\t\tthis._glPixelType = gl.HALF_FLOAT;\n\t\t\t\t} else {\n\t\t\t\t\tthis._glInternalFormat = gl.RGB;\n\t\t\t\t\tthis._glPixelType = device.extTextureHalfFloat.HALF_FLOAT_OES;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase PIXELFORMAT_RGBA16F:\n\t\t\t\tthis._glFormat = gl.RGBA;\n\t\t\t\tif (device.isWebGL2) {\n\t\t\t\t\tthis._glInternalFormat = gl.RGBA16F;\n\t\t\t\t\tthis._glPixelType = gl.HALF_FLOAT;\n\t\t\t\t} else {\n\t\t\t\t\tthis._glInternalFormat = gl.RGBA;\n\t\t\t\t\tthis._glPixelType = device.extTextureHalfFloat.HALF_FLOAT_OES;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase PIXELFORMAT_RGB32F:\n\t\t\t\tthis._glFormat = gl.RGB;\n\t\t\t\tif (device.isWebGL2) {\n\t\t\t\t\tthis._glInternalFormat = gl.RGB32F;\n\t\t\t\t} else {\n\t\t\t\t\tthis._glInternalFormat = gl.RGB;\n\t\t\t\t}\n\t\t\t\tthis._glPixelType = gl.FLOAT;\n\t\t\t\tbreak;\n\t\t\tcase PIXELFORMAT_RGBA32F:\n\t\t\t\tthis._glFormat = gl.RGBA;\n\t\t\t\tif (device.isWebGL2) {\n\t\t\t\t\tthis._glInternalFormat = gl.RGBA32F;\n\t\t\t\t} else {\n\t\t\t\t\tthis._glInternalFormat = gl.RGBA;\n\t\t\t\t}\n\t\t\t\tthis._glPixelType = gl.FLOAT;\n\t\t\t\tbreak;\n\t\t\tcase PIXELFORMAT_R32F:\n\t\t\t\tthis._glFormat = gl.RED;\n\t\t\t\tthis._glInternalFormat = gl.R32F;\n\t\t\t\tthis._glPixelType = gl.FLOAT;\n\t\t\t\tbreak;\n\t\t\tcase PIXELFORMAT_DEPTH:\n\t\t\t\tif (device.isWebGL2) {\n\t\t\t\t\tthis._glFormat = gl.DEPTH_COMPONENT;\n\t\t\t\t\tthis._glInternalFormat = gl.DEPTH_COMPONENT32F;\n\t\t\t\t\tthis._glPixelType = gl.FLOAT;\n\t\t\t\t} else {\n\t\t\t\t\tthis._glFormat = gl.DEPTH_COMPONENT;\n\t\t\t\t\tthis._glInternalFormat = gl.DEPTH_COMPONENT;\n\t\t\t\t\tthis._glPixelType = gl.UNSIGNED_SHORT;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase PIXELFORMAT_DEPTHSTENCIL:\n\t\t\t\tthis._glFormat = gl.DEPTH_STENCIL;\n\t\t\t\tif (device.isWebGL2) {\n\t\t\t\t\tthis._glInternalFormat = gl.DEPTH24_STENCIL8;\n\t\t\t\t\tthis._glPixelType = gl.UNSIGNED_INT_24_8;\n\t\t\t\t} else {\n\t\t\t\t\tthis._glInternalFormat = gl.DEPTH_STENCIL;\n\t\t\t\t\tthis._glPixelType = device.extDepthTexture.UNSIGNED_INT_24_8_WEBGL;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase PIXELFORMAT_111110F:\n\t\t\t\tthis._glFormat = gl.RGB;\n\t\t\t\tthis._glInternalFormat = gl.R11F_G11F_B10F;\n\t\t\t\tthis._glPixelType = gl.UNSIGNED_INT_10F_11F_11F_REV;\n\t\t\t\tbreak;\n\t\t\tcase PIXELFORMAT_SRGB:\n\t\t\t\tthis._glFormat = gl.RGB;\n\t\t\t\tthis._glInternalFormat = gl.SRGB8;\n\t\t\t\tthis._glPixelType = gl.UNSIGNED_BYTE;\n\t\t\t\tbreak;\n\t\t\tcase PIXELFORMAT_SRGBA:\n\t\t\t\tthis._glFormat = gl.RGBA;\n\t\t\t\tthis._glInternalFormat = gl.SRGB8_ALPHA8;\n\t\t\t\tthis._glPixelType = gl.UNSIGNED_BYTE;\n\t\t\t\tbreak;\n\t\t}\n\t\tthis._glCreated = false;\n\t}\n\tupload(device, texture) {\n\t\tconst gl = device.gl;\n\t\tif (!texture._needsUpload && (texture._needsMipmapsUpload && texture._mipmapsUploaded || !texture.pot)) return;\n\t\tlet mipLevel = 0;\n\t\tlet mipObject;\n\t\tlet resMult;\n\t\tconst requiredMipLevels = texture.requiredMipLevels;\n\t\tif (texture.array) {\n\t\t\tgl.texStorage3D(gl.TEXTURE_2D_ARRAY, requiredMipLevels, this._glInternalFormat, texture._width, texture._height, texture._arrayLength);\n\t\t}\n\t\twhile (texture._levels[mipLevel] || mipLevel === 0) {\n\t\t\tif (!texture._needsUpload && mipLevel === 0) {\n\t\t\t\tmipLevel++;\n\t\t\t\tcontinue;\n\t\t\t} else if (mipLevel && (!texture._needsMipmapsUpload || !texture._mipmaps)) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tmipObject = texture._levels[mipLevel];\n\t\t\tresMult = 1 / Math.pow(2, mipLevel);\n\t\t\tif (mipLevel === 1 && !texture._compressed && texture._levels.length < requiredMipLevels) {\n\t\t\t\tgl.generateMipmap(this._glTarget);\n\t\t\t\ttexture._mipmapsUploaded = true;\n\t\t\t}\n\t\t\tif (texture._cubemap) {\n\t\t\t\tlet face;\n\t\t\t\tif (device._isBrowserInterface(mipObject[0])) {\n\t\t\t\t\tfor (face = 0; face < 6; face++) {\n\t\t\t\t\t\tif (!texture._levelsUpdated[0][face]) continue;\n\t\t\t\t\t\tlet src = mipObject[face];\n\t\t\t\t\t\tif (device._isImageBrowserInterface(src)) {\n\t\t\t\t\t\t\tif (src.width > device.maxCubeMapSize || src.height > device.maxCubeMapSize) {\n\t\t\t\t\t\t\t\tsrc = downsampleImage(src, device.maxCubeMapSize);\n\t\t\t\t\t\t\t\tif (mipLevel === 0) {\n\t\t\t\t\t\t\t\t\ttexture._width = src.width;\n\t\t\t\t\t\t\t\t\ttexture._height = src.height;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdevice.setUnpackFlipY(false);\n\t\t\t\t\t\tdevice.setUnpackPremultiplyAlpha(texture._premultiplyAlpha);\n\t\t\t\t\t\tif (this._glCreated) {\n\t\t\t\t\t\t\tgl.texSubImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + face, mipLevel, 0, 0, this._glFormat, this._glPixelType, src);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tgl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + face, mipLevel, this._glInternalFormat, this._glFormat, this._glPixelType, src);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tresMult = 1 / Math.pow(2, mipLevel);\n\t\t\t\t\tfor (face = 0; face < 6; face++) {\n\t\t\t\t\t\tif (!texture._levelsUpdated[0][face]) continue;\n\t\t\t\t\t\tconst texData = mipObject[face];\n\t\t\t\t\t\tif (texture._compressed) {\n\t\t\t\t\t\t\tif (this._glCreated && texData) {\n\t\t\t\t\t\t\t\tgl.compressedTexSubImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + face, mipLevel, 0, 0, Math.max(texture._width * resMult, 1), Math.max(texture._height * resMult, 1), this._glInternalFormat, texData);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tgl.compressedTexImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + face, mipLevel, this._glInternalFormat, Math.max(texture._width * resMult, 1), Math.max(texture._height * resMult, 1), 0, texData);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdevice.setUnpackFlipY(false);\n\t\t\t\t\t\t\tdevice.setUnpackPremultiplyAlpha(texture._premultiplyAlpha);\n\t\t\t\t\t\t\tif (this._glCreated && texData) {\n\t\t\t\t\t\t\t\tgl.texSubImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + face, mipLevel, 0, 0, Math.max(texture._width * resMult, 1), Math.max(texture._height * resMult, 1), this._glFormat, this._glPixelType, texData);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tgl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + face, mipLevel, this._glInternalFormat, Math.max(texture._width * resMult, 1), Math.max(texture._height * resMult, 1), 0, this._glFormat, this._glPixelType, texData);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (texture._volume) {\n\t\t\t\tif (texture._compressed) {\n\t\t\t\t\tgl.compressedTexImage3D(gl.TEXTURE_3D, mipLevel, this._glInternalFormat, Math.max(texture._width * resMult, 1), Math.max(texture._height * resMult, 1), Math.max(texture._depth * resMult, 1), 0, mipObject);\n\t\t\t\t} else {\n\t\t\t\t\tdevice.setUnpackFlipY(false);\n\t\t\t\t\tdevice.setUnpackPremultiplyAlpha(texture._premultiplyAlpha);\n\t\t\t\t\tgl.texImage3D(gl.TEXTURE_3D, mipLevel, this._glInternalFormat, Math.max(texture._width * resMult, 1), Math.max(texture._height * resMult, 1), Math.max(texture._depth * resMult, 1), 0, this._glFormat, this._glPixelType, mipObject);\n\t\t\t\t}\n\t\t\t} else if (texture.array && typeof mipObject === \"object\") {\n\t\t\t\tif (texture._arrayLength === mipObject.length) {\n\t\t\t\t\tif (texture._compressed) {\n\t\t\t\t\t\tfor (let index = 0; index < texture._arrayLength; index++) {\n\t\t\t\t\t\t\tgl.compressedTexSubImage3D(gl.TEXTURE_2D_ARRAY, mipLevel, 0, 0, index, Math.max(Math.floor(texture._width * resMult), 1), Math.max(Math.floor(texture._height * resMult), 1), 1, this._glFormat, mipObject[index]);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfor (let index = 0; index < texture._arrayLength; index++) {\n\t\t\t\t\t\t\tgl.texSubImage3D(gl.TEXTURE_2D_ARRAY, mipLevel, 0, 0, index, Math.max(Math.floor(texture._width * resMult), 1), Math.max(Math.floor(texture._height * resMult), 1), 1, this._glFormat, this._glPixelType, mipObject[index]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (device._isBrowserInterface(mipObject)) {\n\t\t\t\t\tif (device._isImageBrowserInterface(mipObject)) {\n\t\t\t\t\t\tif (mipObject.width > device.maxTextureSize || mipObject.height > device.maxTextureSize) {\n\t\t\t\t\t\t\tmipObject = downsampleImage(mipObject, device.maxTextureSize);\n\t\t\t\t\t\t\tif (mipLevel === 0) {\n\t\t\t\t\t\t\t\ttexture._width = mipObject.width;\n\t\t\t\t\t\t\t\ttexture._height = mipObject.height;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tconst w = mipObject.width || mipObject.videoWidth;\n\t\t\t\t\tconst h = mipObject.height || mipObject.videoHeight;\n\t\t\t\t\tdevice.setUnpackFlipY(texture._flipY);\n\t\t\t\t\tdevice.setUnpackPremultiplyAlpha(texture._premultiplyAlpha);\n\t\t\t\t\tif (this._glCreated && texture._width === w && texture._height === h) {\n\t\t\t\t\t\tgl.texSubImage2D(gl.TEXTURE_2D, mipLevel, 0, 0, this._glFormat, this._glPixelType, mipObject);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tgl.texImage2D(gl.TEXTURE_2D, mipLevel, this._glInternalFormat, this._glFormat, this._glPixelType, mipObject);\n\t\t\t\t\t\tif (mipLevel === 0) {\n\t\t\t\t\t\t\ttexture._width = w;\n\t\t\t\t\t\t\ttexture._height = h;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tresMult = 1 / Math.pow(2, mipLevel);\n\t\t\t\t\tif (texture._compressed) {\n\t\t\t\t\t\tif (this._glCreated && mipObject) {\n\t\t\t\t\t\t\tgl.compressedTexSubImage2D(gl.TEXTURE_2D, mipLevel, 0, 0, Math.max(Math.floor(texture._width * resMult), 1), Math.max(Math.floor(texture._height * resMult), 1), this._glInternalFormat, mipObject);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tgl.compressedTexImage2D(gl.TEXTURE_2D, mipLevel, this._glInternalFormat, Math.max(Math.floor(texture._width * resMult), 1), Math.max(Math.floor(texture._height * resMult), 1), 0, mipObject);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdevice.setUnpackFlipY(false);\n\t\t\t\t\t\tdevice.setUnpackPremultiplyAlpha(texture._premultiplyAlpha);\n\t\t\t\t\t\tif (this._glCreated && mipObject) {\n\t\t\t\t\t\t\tgl.texSubImage2D(gl.TEXTURE_2D, mipLevel, 0, 0, Math.max(texture._width * resMult, 1), Math.max(texture._height * resMult, 1), this._glFormat, this._glPixelType, mipObject);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tgl.texImage2D(gl.TEXTURE_2D, mipLevel, this._glInternalFormat, Math.max(texture._width * resMult, 1), Math.max(texture._height * resMult, 1), 0, this._glFormat, this._glPixelType, mipObject);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (mipLevel === 0) {\n\t\t\t\t\ttexture._mipmapsUploaded = false;\n\t\t\t\t} else {\n\t\t\t\t\ttexture._mipmapsUploaded = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tmipLevel++;\n\t\t}\n\t\tif (texture._needsUpload) {\n\t\t\tif (texture._cubemap) {\n\t\t\t\tfor (let i = 0; i < 6; i++) texture._levelsUpdated[0][i] = false;\n\t\t\t} else {\n\t\t\t\ttexture._levelsUpdated[0] = false;\n\t\t\t}\n\t\t}\n\t\tif (!texture._compressed && texture._mipmaps && texture._needsMipmapsUpload && (texture.pot || device.isWebGL2) && texture._levels.length === 1) {\n\t\t\tgl.generateMipmap(this._glTarget);\n\t\t\ttexture._mipmapsUploaded = true;\n\t\t}\n\t\tif (texture._gpuSize) {\n\t\t\ttexture.adjustVramSizeTracking(device._vram, -texture._gpuSize);\n\t\t}\n\t\ttexture._gpuSize = texture.gpuSize;\n\t\ttexture.adjustVramSizeTracking(device._vram, texture._gpuSize);\n\t\tthis._glCreated = true;\n\t}\n}\n\nexport { WebglTexture };\n","import '../../../core/tracing.js';\nimport { PIXELFORMAT_RGBA8 } from '../constants.js';\n\nclass FramebufferPair {\n\tconstructor(msaaFB, resolveFB) {\n\t\tthis.msaaFB = void 0;\n\t\tthis.resolveFB = void 0;\n\t\tthis.msaaFB = msaaFB;\n\t\tthis.resolveFB = resolveFB;\n\t}\n\tdestroy(gl) {\n\t\tif (this.msaaFB) {\n\t\t\tgl.deleteRenderbuffer(this.msaaFB);\n\t\t\tthis.msaaFB = null;\n\t\t}\n\t\tif (this.resolveFB) {\n\t\t\tgl.deleteRenderbuffer(this.resolveFB);\n\t\t\tthis.resolveFB = null;\n\t\t}\n\t}\n}\nclass WebglRenderTarget {\n\tconstructor() {\n\t\tthis._glFrameBuffer = null;\n\t\tthis._glDepthBuffer = null;\n\t\tthis._glResolveFrameBuffer = null;\n\t\tthis.colorMrtFramebuffers = null;\n\t\tthis._glMsaaColorBuffers = [];\n\t\tthis._glMsaaDepthBuffer = null;\n\t\tthis.suppliedColorFramebuffer = void 0;\n\t\tthis._isInitialized = false;\n\t}\n\tdestroy(device) {\n\t\tvar _this$colorMrtFramebu;\n\t\tconst gl = device.gl;\n\t\tthis._isInitialized = false;\n\t\tif (this._glFrameBuffer) {\n\t\t\tif (this._glFrameBuffer !== this.suppliedColorFramebuffer) gl.deleteFramebuffer(this._glFrameBuffer);\n\t\t\tthis._glFrameBuffer = null;\n\t\t}\n\t\tif (this._glDepthBuffer) {\n\t\t\tgl.deleteRenderbuffer(this._glDepthBuffer);\n\t\t\tthis._glDepthBuffer = null;\n\t\t}\n\t\tif (this._glResolveFrameBuffer) {\n\t\t\tif (this._glResolveFrameBuffer !== this.suppliedColorFramebuffer) gl.deleteFramebuffer(this._glResolveFrameBuffer);\n\t\t\tthis._glResolveFrameBuffer = null;\n\t\t}\n\t\tthis._glMsaaColorBuffers.forEach(buffer => {\n\t\t\tgl.deleteRenderbuffer(buffer);\n\t\t});\n\t\tthis._glMsaaColorBuffers.length = 0;\n\t\t(_this$colorMrtFramebu = this.colorMrtFramebuffers) == null || _this$colorMrtFramebu.forEach(framebuffer => {\n\t\t\tframebuffer.destroy(gl);\n\t\t});\n\t\tthis.colorMrtFramebuffers = null;\n\t\tif (this._glMsaaDepthBuffer) {\n\t\t\tgl.deleteRenderbuffer(this._glMsaaDepthBuffer);\n\t\t\tthis._glMsaaDepthBuffer = null;\n\t\t}\n\t\tthis.suppliedColorFramebuffer = undefined;\n\t}\n\tget initialized() {\n\t\treturn this._isInitialized;\n\t}\n\tinit(device, target) {\n\t\tconst gl = device.gl;\n\t\tthis._isInitialized = true;\n\t\tconst buffers = [];\n\t\tif (this.suppliedColorFramebuffer !== undefined) {\n\t\t\tthis._glFrameBuffer = this.suppliedColorFramebuffer;\n\t\t} else {\n\t\t\tvar _target$_colorBuffers, _target$_colorBuffers2, _device$extDrawBuffer, _device$extDrawBuffer2;\n\t\t\tthis._glFrameBuffer = gl.createFramebuffer();\n\t\t\tdevice.setFramebuffer(this._glFrameBuffer);\n\t\t\tconst colorBufferCount = (_target$_colorBuffers = (_target$_colorBuffers2 = target._colorBuffers) == null ? void 0 : _target$_colorBuffers2.length) != null ? _target$_colorBuffers : 0;\n\t\t\tconst attachmentBaseConstant = device.isWebGL2 ? gl.COLOR_ATTACHMENT0 : (_device$extDrawBuffer = (_device$extDrawBuffer2 = device.extDrawBuffers) == null ? void 0 : _device$extDrawBuffer2.COLOR_ATTACHMENT0_WEBGL) != null ? _device$extDrawBuffer : gl.COLOR_ATTACHMENT0;\n\t\t\tfor (let i = 0; i < colorBufferCount; ++i) {\n\t\t\t\tconst colorBuffer = target.getColorBuffer(i);\n\t\t\t\tif (colorBuffer) {\n\t\t\t\t\tif (!colorBuffer.impl._glTexture) {\n\t\t\t\t\t\tcolorBuffer._width = Math.min(colorBuffer.width, device.maxRenderBufferSize);\n\t\t\t\t\t\tcolorBuffer._height = Math.min(colorBuffer.height, device.maxRenderBufferSize);\n\t\t\t\t\t\tdevice.setTexture(colorBuffer, 0);\n\t\t\t\t\t}\n\t\t\t\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, attachmentBaseConstant + i, colorBuffer._cubemap ? gl.TEXTURE_CUBE_MAP_POSITIVE_X + target._face : gl.TEXTURE_2D, colorBuffer.impl._glTexture, 0);\n\t\t\t\t\tbuffers.push(attachmentBaseConstant + i);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (device.drawBuffers) {\n\t\t\t\tdevice.drawBuffers(buffers);\n\t\t\t}\n\t\t\tconst depthBuffer = target._depthBuffer;\n\t\t\tif (depthBuffer) {\n\t\t\t\tif (!depthBuffer.impl._glTexture) {\n\t\t\t\t\tdepthBuffer._width = Math.min(depthBuffer.width, device.maxRenderBufferSize);\n\t\t\t\t\tdepthBuffer._height = Math.min(depthBuffer.height, device.maxRenderBufferSize);\n\t\t\t\t\tdevice.setTexture(depthBuffer, 0);\n\t\t\t\t}\n\t\t\t\tif (target._stencil) {\n\t\t\t\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, gl.DEPTH_STENCIL_ATTACHMENT, depthBuffer._cubemap ? gl.TEXTURE_CUBE_MAP_POSITIVE_X + target._face : gl.TEXTURE_2D, target._depthBuffer.impl._glTexture, 0);\n\t\t\t\t} else {\n\t\t\t\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, depthBuffer._cubemap ? gl.TEXTURE_CUBE_MAP_POSITIVE_X + target._face : gl.TEXTURE_2D, target._depthBuffer.impl._glTexture, 0);\n\t\t\t\t}\n\t\t\t} else if (target._depth) {\n\t\t\t\tconst willRenderMsaa = target._samples > 1 && device.isWebGL2;\n\t\t\t\tif (!willRenderMsaa) {\n\t\t\t\t\tif (!this._glDepthBuffer) {\n\t\t\t\t\t\tthis._glDepthBuffer = gl.createRenderbuffer();\n\t\t\t\t\t}\n\t\t\t\t\tgl.bindRenderbuffer(gl.RENDERBUFFER, this._glDepthBuffer);\n\t\t\t\t\tif (target._stencil) {\n\t\t\t\t\t\tgl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_STENCIL, target.width, target.height);\n\t\t\t\t\t\tgl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_STENCIL_ATTACHMENT, gl.RENDERBUFFER, this._glDepthBuffer);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst depthFormat = device.isWebGL2 ? gl.DEPTH_COMPONENT32F : gl.DEPTH_COMPONENT16;\n\t\t\t\t\t\tgl.renderbufferStorage(gl.RENDERBUFFER, depthFormat, target.width, target.height);\n\t\t\t\t\t\tgl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, this._glDepthBuffer);\n\t\t\t\t\t}\n\t\t\t\t\tgl.bindRenderbuffer(gl.RENDERBUFFER, null);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (device.isWebGL2 && target._samples > 1) {\n\t\t\tvar _target$_colorBuffers3, _target$_colorBuffers4;\n\t\t\tthis._glResolveFrameBuffer = this._glFrameBuffer;\n\t\t\tthis._glFrameBuffer = gl.createFramebuffer();\n\t\t\tdevice.setFramebuffer(this._glFrameBuffer);\n\t\t\tconst colorBufferCount = (_target$_colorBuffers3 = (_target$_colorBuffers4 = target._colorBuffers) == null ? void 0 : _target$_colorBuffers4.length) != null ? _target$_colorBuffers3 : 0;\n\t\t\tif (this.suppliedColorFramebuffer !== undefined) {\n\t\t\t\tconst buffer = gl.createRenderbuffer();\n\t\t\t\tthis._glMsaaColorBuffers.push(buffer);\n\t\t\t\tconst internalFormat = device.backBufferFormat === PIXELFORMAT_RGBA8 ? gl.RGBA8 : gl.RGB8;\n\t\t\t\tgl.bindRenderbuffer(gl.RENDERBUFFER, buffer);\n\t\t\t\tgl.renderbufferStorageMultisample(gl.RENDERBUFFER, target._samples, internalFormat, target.width, target.height);\n\t\t\t\tgl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.RENDERBUFFER, buffer);\n\t\t\t} else {\n\t\t\t\tfor (let i = 0; i < colorBufferCount; ++i) {\n\t\t\t\t\tconst colorBuffer = target.getColorBuffer(i);\n\t\t\t\t\tif (colorBuffer) {\n\t\t\t\t\t\tconst buffer = gl.createRenderbuffer();\n\t\t\t\t\t\tthis._glMsaaColorBuffers.push(buffer);\n\t\t\t\t\t\tgl.bindRenderbuffer(gl.RENDERBUFFER, buffer);\n\t\t\t\t\t\tgl.renderbufferStorageMultisample(gl.RENDERBUFFER, target._samples, colorBuffer.impl._glInternalFormat, target.width, target.height);\n\t\t\t\t\t\tgl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0 + i, gl.RENDERBUFFER, buffer);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (target._depth) {\n\t\t\t\tif (!this._glMsaaDepthBuffer) {\n\t\t\t\t\tthis._glMsaaDepthBuffer = gl.createRenderbuffer();\n\t\t\t\t}\n\t\t\t\tgl.bindRenderbuffer(gl.RENDERBUFFER, this._glMsaaDepthBuffer);\n\t\t\t\tif (target._stencil) {\n\t\t\t\t\tgl.renderbufferStorageMultisample(gl.RENDERBUFFER, target._samples, gl.DEPTH24_STENCIL8, target.width, target.height);\n\t\t\t\t\tgl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_STENCIL_ATTACHMENT, gl.RENDERBUFFER, this._glMsaaDepthBuffer);\n\t\t\t\t} else {\n\t\t\t\t\tgl.renderbufferStorageMultisample(gl.RENDERBUFFER, target._samples, gl.DEPTH_COMPONENT32F, target.width, target.height);\n\t\t\t\t\tgl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, this._glMsaaDepthBuffer);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (colorBufferCount > 1) {\n\t\t\t\tthis._createMsaaMrtFramebuffers(device, target, colorBufferCount);\n\t\t\t\tdevice.setFramebuffer(this._glFrameBuffer);\n\t\t\t\tdevice.drawBuffers(buffers);\n\t\t\t}\n\t\t}\n\t}\n\t_createMsaaMrtFramebuffers(device, target, colorBufferCount) {\n\t\tconst gl = device.gl;\n\t\tthis.colorMrtFramebuffers = [];\n\t\tfor (let i = 0; i < colorBufferCount; ++i) {\n\t\t\tconst colorBuffer = target.getColorBuffer(i);\n\t\t\tconst srcFramebuffer = gl.createFramebuffer();\n\t\t\tdevice.setFramebuffer(srcFramebuffer);\n\t\t\tconst buffer = this._glMsaaColorBuffers[i];\n\t\t\tgl.bindRenderbuffer(gl.RENDERBUFFER, buffer);\n\t\t\tgl.renderbufferStorageMultisample(gl.RENDERBUFFER, target._samples, colorBuffer.impl._glInternalFormat, target.width, target.height);\n\t\t\tgl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.RENDERBUFFER, buffer);\n\t\t\tdevice.drawBuffers([gl.COLOR_ATTACHMENT0]);\n\t\t\tconst dstFramebuffer = gl.createFramebuffer();\n\t\t\tdevice.setFramebuffer(dstFramebuffer);\n\t\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, colorBuffer._cubemap ? gl.TEXTURE_CUBE_MAP_POSITIVE_X + target._face : gl.TEXTURE_2D, colorBuffer.impl._glTexture, 0);\n\t\t\tthis.colorMrtFramebuffers[i] = new FramebufferPair(srcFramebuffer, dstFramebuffer);\n\t\t}\n\t}\n\t_checkFbo(device, target, type = '') {\n\t\tconst gl = device.gl;\n\t\tconst status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n\t\tswitch (status) {\n\t\t\tcase gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:\n\t\t\t\tbreak;\n\t\t\tcase gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:\n\t\t\t\tbreak;\n\t\t\tcase gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:\n\t\t\t\tbreak;\n\t\t\tcase gl.FRAMEBUFFER_UNSUPPORTED:\n\t\t\t\tbreak;\n\t\t}\n\t}\n\tloseContext() {\n\t\tthis._glFrameBuffer = null;\n\t\tthis._glDepthBuffer = null;\n\t\tthis._glResolveFrameBuffer = null;\n\t\tthis._glMsaaColorBuffers.length = 0;\n\t\tthis._glMsaaDepthBuffer = null;\n\t\tthis.colorMrtFramebuffers = null;\n\t\tthis.suppliedColorFramebuffer = undefined;\n\t\tthis._isInitialized = false;\n\t}\n\tinternalResolve(device, src, dst, target, mask) {\n\t\tdevice.setScissor(0, 0, target.width, target.height);\n\t\tconst gl = device.gl;\n\t\tgl.bindFramebuffer(gl.READ_FRAMEBUFFER, src);\n\t\tgl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, dst);\n\t\tgl.blitFramebuffer(0, 0, target.width, target.height, 0, 0, target.width, target.height, mask, gl.NEAREST);\n\t}\n\tresolve(device, target, color, depth) {\n\t\tif (device.isWebGL2) {\n\t\t\tconst gl = device.gl;\n\t\t\tif (this.colorMrtFramebuffers) {\n\t\t\t\tif (color) {\n\t\t\t\t\tfor (let i = 0; i < this.colorMrtFramebuffers.length; i++) {\n\t\t\t\t\t\tconst fbPair = this.colorMrtFramebuffers[i];\n\t\t\t\t\t\tthis.internalResolve(device, fbPair.msaaFB, fbPair.resolveFB, target, gl.COLOR_BUFFER_BIT);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (depth) {\n\t\t\t\t\tthis.internalResolve(device, this._glFrameBuffer, this._glResolveFrameBuffer, target, gl.DEPTH_BUFFER_BIT);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.internalResolve(device, this._glFrameBuffer, this._glResolveFrameBuffer, target, (color ? gl.COLOR_BUFFER_BIT : 0) | (depth ? gl.DEPTH_BUFFER_BIT : 0));\n\t\t\t}\n\t\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, this._glFrameBuffer);\n\t\t}\n\t}\n}\n\nexport { WebglRenderTarget };\n","var gles2PS = `\n#define pcFragColor0 gl_FragData[0]\n#if COLOR_ATTACHMENT_1\n#define pcFragColor1 gl_FragData[1]\n#endif\n#if COLOR_ATTACHMENT_2\n#define pcFragColor2 gl_FragData[2]\n#endif\n#if COLOR_ATTACHMENT_3\n#define pcFragColor3 gl_FragData[3]\n#endif\n#if COLOR_ATTACHMENT_4\n#define pcFragColor4 gl_FragData[4]\n#endif\n#if COLOR_ATTACHMENT_5\n#define pcFragColor5 gl_FragData[5]\n#endif\n#if COLOR_ATTACHMENT_6\n#define pcFragColor6 gl_FragData[6]\n#endif\n#if COLOR_ATTACHMENT_7\n#define pcFragColor7 gl_FragData[7]\n#endif\n#define texture2DBias texture2D\n#define SHADOWMAP_PASS(name) name\n#define SHADOWMAP_ACCEPT(name) sampler2D name\n#define TEXTURE_PASS(name) name\n#define TEXTURE_ACCEPT(name) sampler2D name\n#ifndef SUPPORTS_TEXLOD\n\t#define texture2DLodEXT texture2D\n\t#define texture2DProjLodEXT textureProj\n\t#define textureCubeLodEXT textureCube\n\t#define textureShadow texture2D\n#else\n\t#define textureShadow(res, uv) texture2DGradEXT(res, uv, vec2(1, 1), vec2(1, 1))\n#endif\n#ifdef SUPPORTS_MRT\n\t#define gl_FragColor pcFragColor0\n#endif\n`;\n\nexport { gles2PS as default };\n","var gles3PS = `\nlayout(location = 0) out highp vec4 pc_fragColor;\n#ifndef REMOVE_COLOR_ATTACHMENT_1\n#if COLOR_ATTACHMENT_1\nlayout(location = 1) out highp vec4 pc_fragColor1;\n#endif\n#endif\n#ifndef REMOVE_COLOR_ATTACHMENT_2\n#if COLOR_ATTACHMENT_2\nlayout(location = 2) out highp vec4 pc_fragColor2;\n#endif\n#endif\n#ifndef REMOVE_COLOR_ATTACHMENT_3\n#if COLOR_ATTACHMENT_3\nlayout(location = 3) out highp vec4 pc_fragColor3;\n#endif\n#endif\n#ifndef REMOVE_COLOR_ATTACHMENT_4\n#if COLOR_ATTACHMENT_4\nlayout(location = 4) out highp vec4 pc_fragColor4;\n#endif\n#endif\n#ifndef REMOVE_COLOR_ATTACHMENT_5\n#if COLOR_ATTACHMENT_5\nlayout(location = 5) out highp vec4 pc_fragColor5;\n#endif\n#endif\n#ifndef REMOVE_COLOR_ATTACHMENT_6\n#if COLOR_ATTACHMENT_6\nlayout(location = 6) out highp vec4 pc_fragColor6;\n#endif\n#endif\n#ifndef REMOVE_COLOR_ATTACHMENT_7\n#if COLOR_ATTACHMENT_7\nlayout(location = 7) out highp vec4 pc_fragColor7;\n#endif\n#endif\n#define gl_FragColor pc_fragColor\n#define pcFragColor0 pc_fragColor\n#define pcFragColor1 pc_fragColor1\n#define pcFragColor2 pc_fragColor2\n#define pcFragColor3 pc_fragColor3\n#define pcFragColor4 pc_fragColor4\n#define pcFragColor5 pc_fragColor5\n#define pcFragColor6 pc_fragColor6\n#define pcFragColor7 pc_fragColor7\n#define varying in\n#define texture2D texture\n#define texture2DBias texture\n#define textureCube texture\n#define texture2DProj textureProj\n#define texture2DLodEXT textureLod\n#define texture2DProjLodEXT textureProjLod\n#define textureCubeLodEXT textureLod\n#define texture2DGradEXT textureGrad\n#define texture2DProjGradEXT textureProjGrad\n#define textureCubeGradEXT textureGrad\n#define textureShadow(res, uv) textureGrad(res, uv, vec2(1, 1), vec2(1, 1))\n#define SHADOWMAP_PASS(name) name\n#define SHADOWMAP_ACCEPT(name) sampler2DShadow name\n#define TEXTURE_PASS(name) name\n#define TEXTURE_ACCEPT(name) sampler2D name\n#define GL2\n#define SUPPORTS_TEXLOD\n#define SUPPORTS_MRT\n`;\n\nexport { gles3PS as default };\n","var gles3VS = `\n#define attribute in\n#define varying out\n#define texture2D texture\n#define GL2\n#define VERTEXSHADER\n`;\n\nexport { gles3VS as default };\n","var webgpuPS = `\n#extension GL_EXT_samplerless_texture_functions : require\nlayout(location = 0) out highp vec4 pc_fragColor;\nlayout(location = 1) out highp vec4 pc_fragColor1;\nlayout(location = 2) out highp vec4 pc_fragColor2;\nlayout(location = 3) out highp vec4 pc_fragColor3;\nlayout(location = 4) out highp vec4 pc_fragColor4;\nlayout(location = 5) out highp vec4 pc_fragColor5;\nlayout(location = 6) out highp vec4 pc_fragColor6;\nlayout(location = 7) out highp vec4 pc_fragColor7;\n#define gl_FragColor pc_fragColor\n#define pcFragColor0 pc_fragColor\n#define pcFragColor1 pc_fragColor1\n#define pcFragColor2 pc_fragColor2\n#define pcFragColor3 pc_fragColor3\n#define pcFragColor4 pc_fragColor4\n#define pcFragColor5 pc_fragColor5\n#define pcFragColor6 pc_fragColor6\n#define pcFragColor7 pc_fragColor7\n#define texture2D(res, uv) texture(sampler2D(res, res ## _sampler), uv)\n#define texture2DBias(res, uv, bias) texture(sampler2D(res, res ## _sampler), uv, bias)\n#define texture2DLodEXT(res, uv, lod) textureLod(sampler2D(res, res ## _sampler), uv, lod)\n#define textureCube(res, uv) texture(samplerCube(res, res ## _sampler), uv)\n#define textureCubeLodEXT(res, uv, lod) textureLod(samplerCube(res, res ## _sampler), uv, lod)\n#define textureShadow(res, uv) textureLod(sampler2DShadow(res, res ## _sampler), uv, 0.0)\n#define SHADOWMAP_PASS(name) name, name ## _sampler\n#define SHADOWMAP_ACCEPT(name) texture2D name, sampler name ## _sampler\n#define TEXTURE_PASS(name) name, name ## _sampler\n#define TEXTURE_ACCEPT(name) texture2D name, sampler name ## _sampler\n#define GL2\n#define WEBGPU\n#define SUPPORTS_TEXLOD\n#define SUPPORTS_MRT\n`;\n\nexport { webgpuPS as default };\n","var webgpuVS = `\n#extension GL_EXT_samplerless_texture_functions : require\n#define texture2D(res, uv) texture(sampler2D(res, res ## _sampler), uv)\n#define GL2\n#define WEBGPU\n#define VERTEXSHADER\n`;\n\nexport { webgpuVS as default };\n","var sharedFS = `\nvec2 getGrabScreenPos(vec4 clipPos) {\n\tvec2 uv = (clipPos.xy / clipPos.w) * 0.5 + 0.5;\n\t#ifdef WEBGPU\n\t\tuv.y = 1.0 - uv.y;\n\t#endif\n\treturn uv;\n}\nvec2 getImageEffectUV(vec2 uv) {\n\t#ifdef WEBGPU\n\t\tuv.y = 1.0 - uv.y;\n\t#endif\n\treturn uv;\n}\n`;\n\nexport { sharedFS as default };\n","import '../../core/tracing.js';\nimport { SEMANTIC_POSITION, SEMANTIC_NORMAL, SEMANTIC_TANGENT, SEMANTIC_TEXCOORD0, SEMANTIC_TEXCOORD1, SEMANTIC_TEXCOORD2, SEMANTIC_TEXCOORD3, SEMANTIC_TEXCOORD4, SEMANTIC_TEXCOORD5, SEMANTIC_TEXCOORD6, SEMANTIC_TEXCOORD7, SEMANTIC_COLOR, SEMANTIC_BLENDINDICES, SEMANTIC_BLENDWEIGHT } from './constants.js';\nimport gles2PS from './shader-chunks/frag/gles2.js';\nimport gles3PS from './shader-chunks/frag/gles3.js';\nimport gles3VS from './shader-chunks/vert/gles3.js';\nimport webgpuPS from './shader-chunks/frag/webgpu.js';\nimport webgpuVS from './shader-chunks/vert/webgpu.js';\nimport sharedFS from './shader-chunks/frag/shared.js';\n\nconst _attrib2Semantic = {\n\tvertex_position: SEMANTIC_POSITION,\n\tvertex_normal: SEMANTIC_NORMAL,\n\tvertex_tangent: SEMANTIC_TANGENT,\n\tvertex_texCoord0: SEMANTIC_TEXCOORD0,\n\tvertex_texCoord1: SEMANTIC_TEXCOORD1,\n\tvertex_texCoord2: SEMANTIC_TEXCOORD2,\n\tvertex_texCoord3: SEMANTIC_TEXCOORD3,\n\tvertex_texCoord4: SEMANTIC_TEXCOORD4,\n\tvertex_texCoord5: SEMANTIC_TEXCOORD5,\n\tvertex_texCoord6: SEMANTIC_TEXCOORD6,\n\tvertex_texCoord7: SEMANTIC_TEXCOORD7,\n\tvertex_color: SEMANTIC_COLOR,\n\tvertex_boneIndices: SEMANTIC_BLENDINDICES,\n\tvertex_boneWeights: SEMANTIC_BLENDWEIGHT\n};\nclass ShaderUtils {\n\tstatic createDefinition(device, options) {\n\t\tvar _options$name, _options$attributes;\n\t\tconst getDefines = (gpu, gl2, gl1, isVertex) => {\n\t\t\tconst deviceIntro = device.isWebGPU ? gpu : device.isWebGL2 ? gl2 : ShaderUtils.gl1Extensions(device, options) + gl1;\n\t\t\tlet attachmentsDefine = '';\n\t\t\tfor (let i = 0; i < device.maxColorAttachments; i++) {\n\t\t\t\tattachmentsDefine += `#define COLOR_ATTACHMENT_${i}\\n`;\n\t\t\t}\n\t\t\treturn attachmentsDefine + deviceIntro;\n\t\t};\n\t\tconst name = (_options$name = options.name) != null ? _options$name : 'Untitled';\n\t\tconst vertDefines = options.vertexDefines || getDefines(webgpuVS, gles3VS, '');\n\t\tconst vertCode = ShaderUtils.versionCode(device) + vertDefines + sharedFS + ShaderUtils.getShaderNameCode(name) + options.vertexCode;\n\t\tconst fragDefines = options.fragmentDefines || getDefines(webgpuPS, gles3PS, gles2PS);\n\t\tconst fragCode = (options.fragmentPreamble || '') + ShaderUtils.versionCode(device) + fragDefines + ShaderUtils.precisionCode(device) + '\\n' + sharedFS + ShaderUtils.getShaderNameCode(name) + (options.fragmentCode || ShaderUtils.dummyFragmentCode());\n\t\tconst attribs = (_options$attributes = options.attributes) != null ? _options$attributes : ShaderUtils.collectAttributes(options.vertexCode);\n\t\treturn {\n\t\t\tname: name,\n\t\t\tattributes: attribs,\n\t\t\tvshader: vertCode,\n\t\t\tfshader: fragCode,\n\t\t\tuseTransformFeedback: options.useTransformFeedback\n\t\t};\n\t}\n\tstatic getShaderNameCode(name) {\n\t\treturn `#define SHADER_NAME ${name}\\n`;\n\t}\n\tstatic gl1Extensions(device, options, isVertex) {\n\t\tlet code;\n\t\tif (isVertex) {\n\t\t\tcode = options.vertexExtensions ? `${options.vertexExtensions}\\n` : '';\n\t\t} else {\n\t\t\tcode = options.fragmentExtensions ? `${options.fragmentExtensions}\\n` : '';\n\t\t\tif (device.extStandardDerivatives) {\n\t\t\t\tcode += \"#extension GL_OES_standard_derivatives : enable\\n\";\n\t\t\t}\n\t\t\tif (device.extTextureLod) {\n\t\t\t\tcode += \"#extension GL_EXT_shader_texture_lod : enable\\n\";\n\t\t\t\tcode += \"#define SUPPORTS_TEXLOD\\n\";\n\t\t\t}\n\t\t\tif (device.extDrawBuffers) {\n\t\t\t\tcode += \"#extension GL_EXT_draw_buffers : require\\n\";\n\t\t\t\tcode += \"#define SUPPORTS_MRT\\n\";\n\t\t\t}\n\t\t}\n\t\treturn code;\n\t}\n\tstatic dummyFragmentCode() {\n\t\treturn \"void main(void) {gl_FragColor = vec4(0.0);}\";\n\t}\n\tstatic versionCode(device) {\n\t\tif (device.isWebGPU) {\n\t\t\treturn '#version 450\\n';\n\t\t}\n\t\treturn device.isWebGL2 ? \"#version 300 es\\n\" : \"\";\n\t}\n\tstatic precisionCode(device, forcePrecision) {\n\t\tlet code = '';\n\t\tif (forcePrecision && forcePrecision !== 'highp' && forcePrecision !== 'mediump' && forcePrecision !== 'lowp') {\n\t\t\tforcePrecision = null;\n\t\t}\n\t\tif (forcePrecision) {\n\t\t\tif (forcePrecision === 'highp' && device.maxPrecision !== 'highp') {\n\t\t\t\tforcePrecision = 'mediump';\n\t\t\t}\n\t\t\tif (forcePrecision === 'mediump' && device.maxPrecision === 'lowp') {\n\t\t\t\tforcePrecision = 'lowp';\n\t\t\t}\n\t\t}\n\t\tconst precision = forcePrecision ? forcePrecision : device.precision;\n\t\tif (!device.isWebGPU) {\n\t\t\tcode = `precision ${precision} float;\\n`;\n\t\t\tif (device.isWebGL2) {\n\t\t\t\tcode += `precision ${precision} sampler2DShadow;\\n`;\n\t\t\t}\n\t\t} else {\n\t\t\tcode = `precision ${precision} float;\\nprecision ${precision} int;\\n`;\n\t\t}\n\t\treturn code;\n\t}\n\tstatic collectAttributes(vsCode) {\n\t\tconst attribs = {};\n\t\tlet attrs = 0;\n\t\tlet found = vsCode.indexOf(\"attribute\");\n\t\twhile (found >= 0) {\n\t\t\tif (found > 0 && vsCode[found - 1] === \"/\") break;\n\t\t\tconst endOfLine = vsCode.indexOf(';', found);\n\t\t\tconst startOfAttribName = vsCode.lastIndexOf(' ', endOfLine);\n\t\t\tconst attribName = vsCode.substring(startOfAttribName + 1, endOfLine);\n\t\t\tconst semantic = _attrib2Semantic[attribName];\n\t\t\tif (semantic !== undefined) {\n\t\t\t\tattribs[attribName] = semantic;\n\t\t\t} else {\n\t\t\t\tattribs[attribName] = \"ATTR\" + attrs;\n\t\t\t\tattrs++;\n\t\t\t}\n\t\t\tfound = vsCode.indexOf(\"attribute\", found + 1);\n\t\t}\n\t\treturn attribs;\n\t}\n}\n\nexport { ShaderUtils };\n","import { GpuProfiler } from '../gpu-profiler.js';\n\nclass FrameQueriesInfo {\n\tconstructor() {\n\t\tthis.renderVersion = void 0;\n\t\tthis.queries = [];\n\t}\n\tdestroy(gl) {\n\t\tthis.queries.forEach(query => gl.deleteQuery(query));\n\t\tthis.queries = null;\n\t}\n}\nclass WebglGpuProfiler extends GpuProfiler {\n\tconstructor(device) {\n\t\tsuper();\n\t\tthis.device = void 0;\n\t\tthis.freeQueries = [];\n\t\tthis.frameQueries = [];\n\t\tthis.previousFrameQueries = [];\n\t\tthis.timings = [];\n\t\tthis.device = device;\n\t\tthis.ext = device.extDisjointTimerQuery;\n\t}\n\tdestroy() {\n\t\tthis.freeQueries.forEach(query => this.device.gl.deleteQuery(query));\n\t\tthis.frameQueries.forEach(query => this.device.gl.deleteQuery(query));\n\t\tthis.previousFrameQueries.forEach(frameQueriesInfo => frameQueriesInfo.destroy(this.device.gl));\n\t\tthis.freeQueries = null;\n\t\tthis.frameQueries = null;\n\t\tthis.previousFrameQueries = null;\n\t}\n\tloseContext() {\n\t\tsuper.loseContext();\n\t\tthis.freeQueries = [];\n\t\tthis.frameQueries = [];\n\t\tthis.previousFrameQueries = [];\n\t}\n\trestoreContext() {\n\t\tthis.ext = this.device.extDisjointTimerQuery;\n\t}\n\tgetQuery() {\n\t\tvar _this$freeQueries$pop;\n\t\treturn (_this$freeQueries$pop = this.freeQueries.pop()) != null ? _this$freeQueries$pop : this.device.gl.createQuery();\n\t}\n\tstart(name) {\n\t\tif (this.ext) {\n\t\t\tconst slot = this.getSlot(name);\n\t\t\tconst query = this.getQuery();\n\t\t\tthis.frameQueries[slot] = query;\n\t\t\tthis.device.gl.beginQuery(this.ext.TIME_ELAPSED_EXT, query);\n\t\t\treturn slot;\n\t\t}\n\t\treturn undefined;\n\t}\n\tend(slot) {\n\t\tif (slot !== undefined) {\n\t\t\tthis.device.gl.endQuery(this.ext.TIME_ELAPSED_EXT);\n\t\t}\n\t}\n\tframeStart() {\n\t\tthis.processEnableRequest();\n\t\tif (this._enabled) {\n\t\t\tthis.frameGPUMarkerSlot = this.start('GpuFrame');\n\t\t}\n\t}\n\tframeEnd() {\n\t\tif (this._enabled) {\n\t\t\tthis.end(this.frameGPUMarkerSlot);\n\t\t}\n\t}\n\trequest() {\n\t\tif (this._enabled) {\n\t\t\tconst ext = this.ext;\n\t\t\tconst gl = this.device.gl;\n\t\t\tconst renderVersion = this.device.renderVersion;\n\t\t\tconst frameQueries = this.frameQueries;\n\t\t\tif (frameQueries.length > 0) {\n\t\t\t\tthis.frameQueries = [];\n\t\t\t\tconst frameQueriesInfo = new FrameQueriesInfo();\n\t\t\t\tframeQueriesInfo.queries = frameQueries;\n\t\t\t\tframeQueriesInfo.renderVersion = renderVersion;\n\t\t\t\tthis.previousFrameQueries.push(frameQueriesInfo);\n\t\t\t}\n\t\t\tif (this.previousFrameQueries.length > 0) {\n\t\t\t\tconst previousQueriesInfo = this.previousFrameQueries[0];\n\t\t\t\tconst previousQueries = previousQueriesInfo.queries;\n\t\t\t\tconst lastQuery = previousQueries[previousQueries.length - 1];\n\t\t\t\tconst available = gl.getQueryParameter(lastQuery, gl.QUERY_RESULT_AVAILABLE);\n\t\t\t\tconst disjoint = gl.getParameter(ext.GPU_DISJOINT_EXT);\n\t\t\t\tif (available && !disjoint) {\n\t\t\t\t\tthis.previousFrameQueries.shift();\n\t\t\t\t\tconst timings = this.timings;\n\t\t\t\t\ttimings.length = 0;\n\t\t\t\t\tfor (let i = 0; i < previousQueries.length; i++) {\n\t\t\t\t\t\tconst query = previousQueries[i];\n\t\t\t\t\t\tconst duration = gl.getQueryParameter(query, gl.QUERY_RESULT);\n\t\t\t\t\t\ttimings[i] = duration * 0.000001;\n\t\t\t\t\t\tthis.freeQueries.push(query);\n\t\t\t\t\t}\n\t\t\t\t\tthis.report(previousQueriesInfo.renderVersion, timings);\n\t\t\t\t}\n\t\t\t\tif (disjoint) {\n\t\t\t\t\tthis.previousFrameQueries.forEach(frameQueriesInfo => {\n\t\t\t\t\t\tthis.report(frameQueriesInfo.renderVersion, null);\n\t\t\t\t\t\tframeQueriesInfo.destroy(gl);\n\t\t\t\t\t});\n\t\t\t\t\tthis.previousFrameQueries.length = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t\tsuper.request(renderVersion);\n\t\t}\n\t}\n}\n\nexport { WebglGpuProfiler };\n","import { setupVertexArrayObject } from '../../../polyfill/OESVertexArrayObject.js';\nimport { math } from '../../../core/math/math.js';\nimport '../../../core/tracing.js';\nimport { platform } from '../../../core/platform.js';\nimport { Color } from '../../../core/math/color.js';\nimport { DEVICETYPE_WEBGL2, DEVICETYPE_WEBGL1, UNIFORMTYPE_BOOL, UNIFORMTYPE_INT, UNIFORMTYPE_FLOAT, UNIFORMTYPE_VEC2, UNIFORMTYPE_VEC3, UNIFORMTYPE_VEC4, UNIFORMTYPE_IVEC2, UNIFORMTYPE_IVEC3, UNIFORMTYPE_IVEC4, UNIFORMTYPE_BVEC2, UNIFORMTYPE_BVEC3, UNIFORMTYPE_BVEC4, UNIFORMTYPE_MAT2, UNIFORMTYPE_MAT3, UNIFORMTYPE_MAT4, UNIFORMTYPE_TEXTURE2D, UNIFORMTYPE_TEXTURECUBE, UNIFORMTYPE_TEXTURE2D_SHADOW, UNIFORMTYPE_TEXTURECUBE_SHADOW, UNIFORMTYPE_TEXTURE2D_ARRAY, UNIFORMTYPE_TEXTURE3D, UNIFORMTYPE_FLOATARRAY, UNIFORMTYPE_VEC2ARRAY, UNIFORMTYPE_VEC3ARRAY, UNIFORMTYPE_VEC4ARRAY, PIXELFORMAT_RGBA8, PIXELFORMAT_RGBA16F, PIXELFORMAT_RGBA32F, PIXELFORMAT_RGB8, FUNC_ALWAYS, STENCILOP_KEEP, ADDRESS_CLAMP_TO_EDGE, semanticToLocation, CLEARFLAG_COLOR, CLEARFLAG_DEPTH, CLEARFLAG_STENCIL, CULLFACE_NONE, PRIMITIVE_TRISTRIP, FILTER_NEAREST_MIPMAP_NEAREST, FILTER_NEAREST_MIPMAP_LINEAR, FILTER_NEAREST, FILTER_LINEAR_MIPMAP_NEAREST, FILTER_LINEAR_MIPMAP_LINEAR, FILTER_LINEAR } from '../constants.js';\nimport { GraphicsDevice } from '../graphics-device.js';\nimport { RenderTarget } from '../render-target.js';\nimport { Texture } from '../texture.js';\nimport { WebglVertexBuffer } from './webgl-vertex-buffer.js';\nimport { WebglIndexBuffer } from './webgl-index-buffer.js';\nimport { WebglShader } from './webgl-shader.js';\nimport { WebglTexture } from './webgl-texture.js';\nimport { WebglRenderTarget } from './webgl-render-target.js';\nimport { ShaderUtils } from '../shader-utils.js';\nimport { Shader } from '../shader.js';\nimport { BlendState } from '../blend-state.js';\nimport { DepthState } from '../depth-state.js';\nimport { StencilParameters } from '../stencil-parameters.js';\nimport { WebglGpuProfiler } from './webgl-gpu-profiler.js';\n\nconst invalidateAttachments = [];\nconst _fullScreenQuadVS = `\nattribute vec2 vertex_position;\nvarying vec2 vUv0;\nvoid main(void)\n{\n\tgl_Position = vec4(vertex_position, 0.5, 1.0);\n\tvUv0 = vertex_position.xy*0.5+0.5;\n}\n`;\nconst _precisionTest1PS = `\nvoid main(void) { \n\tgl_FragColor = vec4(2147483648.0);\n}\n`;\nconst _precisionTest2PS = `\nuniform sampler2D source;\nvec4 packFloat(float depth) {\n\tconst vec4 bit_shift = vec4(256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0);\n\tconst vec4 bit_mask  = vec4(0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);\n\tvec4 res = mod(depth * bit_shift * vec4(255), vec4(256) ) / vec4(255);\n\tres -= res.xxyz * bit_mask;\n\treturn res;\n}\nvoid main(void) {\n\tfloat c = texture2D(source, vec2(0.0)).r;\n\tfloat diff = abs(c - 2147483648.0) / 2147483648.0;\n\tgl_FragColor = packFloat(diff);\n}\n`;\nconst _outputTexture2D = `\nvarying vec2 vUv0;\nuniform sampler2D source;\nvoid main(void) {\n\tgl_FragColor = texture2D(source, vUv0);\n}\n`;\nfunction quadWithShader(device, target, shader) {\n\tconst oldRt = device.renderTarget;\n\tdevice.setRenderTarget(target);\n\tdevice.updateBegin();\n\tdevice.setCullMode(CULLFACE_NONE);\n\tdevice.setBlendState(BlendState.NOBLEND);\n\tdevice.setDepthState(DepthState.NODEPTH);\n\tdevice.setStencilState(null, null);\n\tdevice.setVertexBuffer(device.quadVertexBuffer, 0);\n\tdevice.setShader(shader);\n\tdevice.draw({\n\t\ttype: PRIMITIVE_TRISTRIP,\n\t\tbase: 0,\n\t\tcount: 4,\n\t\tindexed: false\n\t});\n\tdevice.updateEnd();\n\tdevice.setRenderTarget(oldRt);\n\tdevice.updateBegin();\n}\nfunction testRenderable(gl, pixelFormat) {\n\tlet result = true;\n\tconst texture = gl.createTexture();\n\tgl.bindTexture(gl.TEXTURE_2D, texture);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\tgl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 2, 2, 0, gl.RGBA, pixelFormat, null);\n\tconst framebuffer = gl.createFramebuffer();\n\tgl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n\tgl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n\tif (gl.checkFramebufferStatus(gl.FRAMEBUFFER) !== gl.FRAMEBUFFER_COMPLETE) {\n\t\tresult = false;\n\t}\n\tgl.bindTexture(gl.TEXTURE_2D, null);\n\tgl.deleteTexture(texture);\n\tgl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\tgl.deleteFramebuffer(framebuffer);\n\treturn result;\n}\nfunction testTextureHalfFloatUpdatable(gl, pixelFormat) {\n\tlet result = true;\n\tconst texture = gl.createTexture();\n\tgl.bindTexture(gl.TEXTURE_2D, texture);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\tconst data = new Uint16Array(4 * 2 * 2);\n\tgl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 2, 2, 0, gl.RGBA, pixelFormat, data);\n\tif (gl.getError() !== gl.NO_ERROR) {\n\t\tresult = false;\n\t\tconsole.log(\"Above error related to HALF_FLOAT_OES can be ignored, it was triggered by testing half float texture support\");\n\t}\n\tgl.bindTexture(gl.TEXTURE_2D, null);\n\tgl.deleteTexture(texture);\n\treturn result;\n}\nfunction testTextureFloatHighPrecision(device) {\n\tif (!device.textureFloatRenderable) return false;\n\tconst shader1 = new Shader(device, ShaderUtils.createDefinition(device, {\n\t\tname: 'ptest1',\n\t\tvertexCode: _fullScreenQuadVS,\n\t\tfragmentCode: _precisionTest1PS\n\t}));\n\tconst shader2 = new Shader(device, ShaderUtils.createDefinition(device, {\n\t\tname: 'ptest2',\n\t\tvertexCode: _fullScreenQuadVS,\n\t\tfragmentCode: _precisionTest2PS\n\t}));\n\tconst textureOptions = {\n\t\tformat: PIXELFORMAT_RGBA32F,\n\t\twidth: 1,\n\t\theight: 1,\n\t\tmipmaps: false,\n\t\tminFilter: FILTER_NEAREST,\n\t\tmagFilter: FILTER_NEAREST,\n\t\tname: 'testFHP'\n\t};\n\tconst tex1 = new Texture(device, textureOptions);\n\tconst targ1 = new RenderTarget({\n\t\tcolorBuffer: tex1,\n\t\tdepth: false\n\t});\n\tquadWithShader(device, targ1, shader1);\n\ttextureOptions.format = PIXELFORMAT_RGBA8;\n\tconst tex2 = new Texture(device, textureOptions);\n\tconst targ2 = new RenderTarget({\n\t\tcolorBuffer: tex2,\n\t\tdepth: false\n\t});\n\tdevice.constantTexSource.setValue(tex1);\n\tquadWithShader(device, targ2, shader2);\n\tconst prevFramebuffer = device.activeFramebuffer;\n\tdevice.setFramebuffer(targ2.impl._glFrameBuffer);\n\tconst pixels = new Uint8Array(4);\n\tdevice.readPixels(0, 0, 1, 1, pixels);\n\tdevice.setFramebuffer(prevFramebuffer);\n\tconst x = pixels[0] / 255;\n\tconst y = pixels[1] / 255;\n\tconst z = pixels[2] / 255;\n\tconst w = pixels[3] / 255;\n\tconst f = x / (256 * 256 * 256) + y / (256 * 256) + z / 256 + w;\n\ttex1.destroy();\n\ttarg1.destroy();\n\ttex2.destroy();\n\ttarg2.destroy();\n\tshader1.destroy();\n\tshader2.destroy();\n\treturn f === 0;\n}\nclass WebglGraphicsDevice extends GraphicsDevice {\n\tconstructor(canvas, options = {}) {\n\t\tvar _options$antialias;\n\t\tsuper(canvas, options);\n\t\tthis.gl = void 0;\n\t\tthis._defaultFramebuffer = null;\n\t\tthis._defaultFramebufferChanged = false;\n\t\toptions = this.initOptions;\n\t\tthis.updateClientRect();\n\t\tthis.initTextureUnits();\n\t\tthis.contextLost = false;\n\t\tthis._contextLostHandler = event => {\n\t\t\tevent.preventDefault();\n\t\t\tthis.contextLost = true;\n\t\t\tthis.loseContext();\n\t\t\tthis.fire('devicelost');\n\t\t};\n\t\tthis._contextRestoredHandler = () => {\n\t\t\tthis.contextLost = false;\n\t\t\tthis.restoreContext();\n\t\t\tthis.fire('devicerestored');\n\t\t};\n\t\tconst ua = typeof navigator !== 'undefined' && navigator.userAgent;\n\t\tthis.forceDisableMultisampling = ua && ua.includes('AppleWebKit') && (ua.includes('15.4') || ua.includes('15_4'));\n\t\tif (this.forceDisableMultisampling) {\n\t\t\toptions.antialias = false;\n\t\t}\n\t\tif (platform.browserName === 'firefox' && platform.name === 'windows') {\n\t\t\tconst _ua = typeof navigator !== 'undefined' ? navigator.userAgent : '';\n\t\t\tconst match = _ua.match(/Firefox\\/(\\d+(\\.\\d+)*)/);\n\t\t\tconst firefoxVersion = match ? match[1] : null;\n\t\t\tif (firefoxVersion) {\n\t\t\t\tconst version = parseFloat(firefoxVersion);\n\t\t\t\tif (version >= 120 || version === 115) {\n\t\t\t\t\toptions.antialias = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tlet gl = null;\n\t\tthis.backBufferAntialias = (_options$antialias = options.antialias) != null ? _options$antialias : false;\n\t\toptions.antialias = false;\n\t\tif (options.gl) {\n\t\t\tgl = options.gl;\n\t\t} else {\n\t\t\tconst preferWebGl2 = options.preferWebGl2 !== undefined ? options.preferWebGl2 : true;\n\t\t\tconst names = preferWebGl2 ? [\"webgl2\", \"webgl\", \"experimental-webgl\"] : [\"webgl\", \"experimental-webgl\"];\n\t\t\tfor (let i = 0; i < names.length; i++) {\n\t\t\t\tgl = canvas.getContext(names[i], options);\n\t\t\t\tif (gl) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (!gl) {\n\t\t\tthrow new Error(\"WebGL not supported\");\n\t\t}\n\t\tthis.gl = gl;\n\t\tthis.isWebGL2 = typeof WebGL2RenderingContext !== 'undefined' && gl instanceof WebGL2RenderingContext;\n\t\tthis.isWebGL1 = !this.isWebGL2;\n\t\tthis._deviceType = this.isWebGL2 ? DEVICETYPE_WEBGL2 : DEVICETYPE_WEBGL1;\n\t\tthis.updateBackbufferFormat(null);\n\t\tconst isChrome = platform.browserName === 'chrome';\n\t\tconst isSafari = platform.browserName === 'safari';\n\t\tconst isMac = platform.browser && navigator.appVersion.indexOf(\"Mac\") !== -1;\n\t\tthis._tempEnableSafariTextureUnitWorkaround = isSafari;\n\t\tthis._tempMacChromeBlitFramebufferWorkaround = isMac && isChrome && !options.alpha;\n\t\tif (!this.isWebGL2) {\n\t\t\tsetupVertexArrayObject(gl);\n\t\t}\n\t\tcanvas.addEventListener(\"webglcontextlost\", this._contextLostHandler, false);\n\t\tcanvas.addEventListener(\"webglcontextrestored\", this._contextRestoredHandler, false);\n\t\tthis.initializeExtensions();\n\t\tthis.initializeCapabilities();\n\t\tthis.initializeRenderState();\n\t\tthis.initializeContextCaches();\n\t\tthis.createBackbuffer(null);\n\t\tthis.supportsImageBitmap = !isSafari && typeof ImageBitmap !== 'undefined';\n\t\tthis.glAddress = [gl.REPEAT, gl.CLAMP_TO_EDGE, gl.MIRRORED_REPEAT];\n\t\tthis.glBlendEquation = [gl.FUNC_ADD, gl.FUNC_SUBTRACT, gl.FUNC_REVERSE_SUBTRACT, this.isWebGL2 ? gl.MIN : this.extBlendMinmax ? this.extBlendMinmax.MIN_EXT : gl.FUNC_ADD, this.isWebGL2 ? gl.MAX : this.extBlendMinmax ? this.extBlendMinmax.MAX_EXT : gl.FUNC_ADD];\n\t\tthis.glBlendFunctionColor = [gl.ZERO, gl.ONE, gl.SRC_COLOR, gl.ONE_MINUS_SRC_COLOR, gl.DST_COLOR, gl.ONE_MINUS_DST_COLOR, gl.SRC_ALPHA, gl.SRC_ALPHA_SATURATE, gl.ONE_MINUS_SRC_ALPHA, gl.DST_ALPHA, gl.ONE_MINUS_DST_ALPHA, gl.CONSTANT_COLOR, gl.ONE_MINUS_CONSTANT_COLOR];\n\t\tthis.glBlendFunctionAlpha = [gl.ZERO, gl.ONE, gl.SRC_COLOR, gl.ONE_MINUS_SRC_COLOR, gl.DST_COLOR, gl.ONE_MINUS_DST_COLOR, gl.SRC_ALPHA, gl.SRC_ALPHA_SATURATE, gl.ONE_MINUS_SRC_ALPHA, gl.DST_ALPHA, gl.ONE_MINUS_DST_ALPHA, gl.CONSTANT_ALPHA, gl.ONE_MINUS_CONSTANT_ALPHA];\n\t\tthis.glComparison = [gl.NEVER, gl.LESS, gl.EQUAL, gl.LEQUAL, gl.GREATER, gl.NOTEQUAL, gl.GEQUAL, gl.ALWAYS];\n\t\tthis.glStencilOp = [gl.KEEP, gl.ZERO, gl.REPLACE, gl.INCR, gl.INCR_WRAP, gl.DECR, gl.DECR_WRAP, gl.INVERT];\n\t\tthis.glClearFlag = [0, gl.COLOR_BUFFER_BIT, gl.DEPTH_BUFFER_BIT, gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT, gl.STENCIL_BUFFER_BIT, gl.STENCIL_BUFFER_BIT | gl.COLOR_BUFFER_BIT, gl.STENCIL_BUFFER_BIT | gl.DEPTH_BUFFER_BIT, gl.STENCIL_BUFFER_BIT | gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT];\n\t\tthis.glCull = [0, gl.BACK, gl.FRONT, gl.FRONT_AND_BACK];\n\t\tthis.glFilter = [gl.NEAREST, gl.LINEAR, gl.NEAREST_MIPMAP_NEAREST, gl.NEAREST_MIPMAP_LINEAR, gl.LINEAR_MIPMAP_NEAREST, gl.LINEAR_MIPMAP_LINEAR];\n\t\tthis.glPrimitive = [gl.POINTS, gl.LINES, gl.LINE_LOOP, gl.LINE_STRIP, gl.TRIANGLES, gl.TRIANGLE_STRIP, gl.TRIANGLE_FAN];\n\t\tthis.glType = [gl.BYTE, gl.UNSIGNED_BYTE, gl.SHORT, gl.UNSIGNED_SHORT, gl.INT, gl.UNSIGNED_INT, gl.FLOAT, gl.HALF_FLOAT];\n\t\tthis.pcUniformType = {};\n\t\tthis.pcUniformType[gl.BOOL] = UNIFORMTYPE_BOOL;\n\t\tthis.pcUniformType[gl.INT] = UNIFORMTYPE_INT;\n\t\tthis.pcUniformType[gl.FLOAT] = UNIFORMTYPE_FLOAT;\n\t\tthis.pcUniformType[gl.FLOAT_VEC2] = UNIFORMTYPE_VEC2;\n\t\tthis.pcUniformType[gl.FLOAT_VEC3] = UNIFORMTYPE_VEC3;\n\t\tthis.pcUniformType[gl.FLOAT_VEC4] = UNIFORMTYPE_VEC4;\n\t\tthis.pcUniformType[gl.INT_VEC2] = UNIFORMTYPE_IVEC2;\n\t\tthis.pcUniformType[gl.INT_VEC3] = UNIFORMTYPE_IVEC3;\n\t\tthis.pcUniformType[gl.INT_VEC4] = UNIFORMTYPE_IVEC4;\n\t\tthis.pcUniformType[gl.BOOL_VEC2] = UNIFORMTYPE_BVEC2;\n\t\tthis.pcUniformType[gl.BOOL_VEC3] = UNIFORMTYPE_BVEC3;\n\t\tthis.pcUniformType[gl.BOOL_VEC4] = UNIFORMTYPE_BVEC4;\n\t\tthis.pcUniformType[gl.FLOAT_MAT2] = UNIFORMTYPE_MAT2;\n\t\tthis.pcUniformType[gl.FLOAT_MAT3] = UNIFORMTYPE_MAT3;\n\t\tthis.pcUniformType[gl.FLOAT_MAT4] = UNIFORMTYPE_MAT4;\n\t\tthis.pcUniformType[gl.SAMPLER_2D] = UNIFORMTYPE_TEXTURE2D;\n\t\tthis.pcUniformType[gl.SAMPLER_CUBE] = UNIFORMTYPE_TEXTURECUBE;\n\t\tif (this.isWebGL2) {\n\t\t\tthis.pcUniformType[gl.SAMPLER_2D_SHADOW] = UNIFORMTYPE_TEXTURE2D_SHADOW;\n\t\t\tthis.pcUniformType[gl.SAMPLER_CUBE_SHADOW] = UNIFORMTYPE_TEXTURECUBE_SHADOW;\n\t\t\tthis.pcUniformType[gl.SAMPLER_2D_ARRAY] = UNIFORMTYPE_TEXTURE2D_ARRAY;\n\t\t\tthis.pcUniformType[gl.SAMPLER_3D] = UNIFORMTYPE_TEXTURE3D;\n\t\t}\n\t\tthis.targetToSlot = {};\n\t\tthis.targetToSlot[gl.TEXTURE_2D] = 0;\n\t\tthis.targetToSlot[gl.TEXTURE_CUBE_MAP] = 1;\n\t\tthis.targetToSlot[gl.TEXTURE_3D] = 2;\n\t\tlet scopeX, scopeY, scopeZ, scopeW;\n\t\tlet uniformValue;\n\t\tthis.commitFunction = [];\n\t\tthis.commitFunction[UNIFORMTYPE_BOOL] = function (uniform, value) {\n\t\t\tif (uniform.value !== value) {\n\t\t\t\tgl.uniform1i(uniform.locationId, value);\n\t\t\t\tuniform.value = value;\n\t\t\t}\n\t\t};\n\t\tthis.commitFunction[UNIFORMTYPE_INT] = this.commitFunction[UNIFORMTYPE_BOOL];\n\t\tthis.commitFunction[UNIFORMTYPE_FLOAT] = function (uniform, value) {\n\t\t\tif (uniform.value !== value) {\n\t\t\t\tgl.uniform1f(uniform.locationId, value);\n\t\t\t\tuniform.value = value;\n\t\t\t}\n\t\t};\n\t\tthis.commitFunction[UNIFORMTYPE_VEC2] = function (uniform, value) {\n\t\t\tuniformValue = uniform.value;\n\t\t\tscopeX = value[0];\n\t\t\tscopeY = value[1];\n\t\t\tif (uniformValue[0] !== scopeX || uniformValue[1] !== scopeY) {\n\t\t\t\tgl.uniform2fv(uniform.locationId, value);\n\t\t\t\tuniformValue[0] = scopeX;\n\t\t\t\tuniformValue[1] = scopeY;\n\t\t\t}\n\t\t};\n\t\tthis.commitFunction[UNIFORMTYPE_VEC3] = function (uniform, value) {\n\t\t\tuniformValue = uniform.value;\n\t\t\tscopeX = value[0];\n\t\t\tscopeY = value[1];\n\t\t\tscopeZ = value[2];\n\t\t\tif (uniformValue[0] !== scopeX || uniformValue[1] !== scopeY || uniformValue[2] !== scopeZ) {\n\t\t\t\tgl.uniform3fv(uniform.locationId, value);\n\t\t\t\tuniformValue[0] = scopeX;\n\t\t\t\tuniformValue[1] = scopeY;\n\t\t\t\tuniformValue[2] = scopeZ;\n\t\t\t}\n\t\t};\n\t\tthis.commitFunction[UNIFORMTYPE_VEC4] = function (uniform, value) {\n\t\t\tuniformValue = uniform.value;\n\t\t\tscopeX = value[0];\n\t\t\tscopeY = value[1];\n\t\t\tscopeZ = value[2];\n\t\t\tscopeW = value[3];\n\t\t\tif (uniformValue[0] !== scopeX || uniformValue[1] !== scopeY || uniformValue[2] !== scopeZ || uniformValue[3] !== scopeW) {\n\t\t\t\tgl.uniform4fv(uniform.locationId, value);\n\t\t\t\tuniformValue[0] = scopeX;\n\t\t\t\tuniformValue[1] = scopeY;\n\t\t\t\tuniformValue[2] = scopeZ;\n\t\t\t\tuniformValue[3] = scopeW;\n\t\t\t}\n\t\t};\n\t\tthis.commitFunction[UNIFORMTYPE_IVEC2] = function (uniform, value) {\n\t\t\tuniformValue = uniform.value;\n\t\t\tscopeX = value[0];\n\t\t\tscopeY = value[1];\n\t\t\tif (uniformValue[0] !== scopeX || uniformValue[1] !== scopeY) {\n\t\t\t\tgl.uniform2iv(uniform.locationId, value);\n\t\t\t\tuniformValue[0] = scopeX;\n\t\t\t\tuniformValue[1] = scopeY;\n\t\t\t}\n\t\t};\n\t\tthis.commitFunction[UNIFORMTYPE_BVEC2] = this.commitFunction[UNIFORMTYPE_IVEC2];\n\t\tthis.commitFunction[UNIFORMTYPE_IVEC3] = function (uniform, value) {\n\t\t\tuniformValue = uniform.value;\n\t\t\tscopeX = value[0];\n\t\t\tscopeY = value[1];\n\t\t\tscopeZ = value[2];\n\t\t\tif (uniformValue[0] !== scopeX || uniformValue[1] !== scopeY || uniformValue[2] !== scopeZ) {\n\t\t\t\tgl.uniform3iv(uniform.locationId, value);\n\t\t\t\tuniformValue[0] = scopeX;\n\t\t\t\tuniformValue[1] = scopeY;\n\t\t\t\tuniformValue[2] = scopeZ;\n\t\t\t}\n\t\t};\n\t\tthis.commitFunction[UNIFORMTYPE_BVEC3] = this.commitFunction[UNIFORMTYPE_IVEC3];\n\t\tthis.commitFunction[UNIFORMTYPE_IVEC4] = function (uniform, value) {\n\t\t\tuniformValue = uniform.value;\n\t\t\tscopeX = value[0];\n\t\t\tscopeY = value[1];\n\t\t\tscopeZ = value[2];\n\t\t\tscopeW = value[3];\n\t\t\tif (uniformValue[0] !== scopeX || uniformValue[1] !== scopeY || uniformValue[2] !== scopeZ || uniformValue[3] !== scopeW) {\n\t\t\t\tgl.uniform4iv(uniform.locationId, value);\n\t\t\t\tuniformValue[0] = scopeX;\n\t\t\t\tuniformValue[1] = scopeY;\n\t\t\t\tuniformValue[2] = scopeZ;\n\t\t\t\tuniformValue[3] = scopeW;\n\t\t\t}\n\t\t};\n\t\tthis.commitFunction[UNIFORMTYPE_BVEC4] = this.commitFunction[UNIFORMTYPE_IVEC4];\n\t\tthis.commitFunction[UNIFORMTYPE_MAT2] = function (uniform, value) {\n\t\t\tgl.uniformMatrix2fv(uniform.locationId, false, value);\n\t\t};\n\t\tthis.commitFunction[UNIFORMTYPE_MAT3] = function (uniform, value) {\n\t\t\tgl.uniformMatrix3fv(uniform.locationId, false, value);\n\t\t};\n\t\tthis.commitFunction[UNIFORMTYPE_MAT4] = function (uniform, value) {\n\t\t\tgl.uniformMatrix4fv(uniform.locationId, false, value);\n\t\t};\n\t\tthis.commitFunction[UNIFORMTYPE_FLOATARRAY] = function (uniform, value) {\n\t\t\tgl.uniform1fv(uniform.locationId, value);\n\t\t};\n\t\tthis.commitFunction[UNIFORMTYPE_VEC2ARRAY] = function (uniform, value) {\n\t\t\tgl.uniform2fv(uniform.locationId, value);\n\t\t};\n\t\tthis.commitFunction[UNIFORMTYPE_VEC3ARRAY] = function (uniform, value) {\n\t\t\tgl.uniform3fv(uniform.locationId, value);\n\t\t};\n\t\tthis.commitFunction[UNIFORMTYPE_VEC4ARRAY] = function (uniform, value) {\n\t\t\tgl.uniform4fv(uniform.locationId, value);\n\t\t};\n\t\tthis.supportsBoneTextures = this.extTextureFloat && this.maxVertexTextures > 0;\n\t\tlet numUniforms = this.vertexUniformsCount;\n\t\tnumUniforms -= 4 * 4;\n\t\tnumUniforms -= 8;\n\t\tnumUniforms -= 1;\n\t\tnumUniforms -= 4 * 4;\n\t\tthis.boneLimit = Math.floor(numUniforms / 3);\n\t\tthis.boneLimit = Math.min(this.boneLimit, 128);\n\t\tif (this.unmaskedRenderer === 'Mali-450 MP') {\n\t\t\tthis.boneLimit = 34;\n\t\t}\n\t\tthis.constantTexSource = this.scope.resolve(\"source\");\n\t\tif (this.extTextureFloat) {\n\t\t\tif (this.isWebGL2) {\n\t\t\t\tthis.textureFloatRenderable = !!this.extColorBufferFloat;\n\t\t\t} else {\n\t\t\t\tthis.textureFloatRenderable = testRenderable(gl, gl.FLOAT);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.textureFloatRenderable = false;\n\t\t}\n\t\tif (this.extColorBufferHalfFloat) {\n\t\t\tthis.textureHalfFloatRenderable = !!this.extColorBufferHalfFloat;\n\t\t} else if (this.extTextureHalfFloat) {\n\t\t\tif (this.isWebGL2) {\n\t\t\t\tthis.textureHalfFloatRenderable = !!this.extColorBufferFloat;\n\t\t\t} else {\n\t\t\t\tthis.textureHalfFloatRenderable = testRenderable(gl, this.extTextureHalfFloat.HALF_FLOAT_OES);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.textureHalfFloatRenderable = false;\n\t\t}\n\t\tthis.supportsMorphTargetTexturesCore = this.maxPrecision === \"highp\" && this.maxVertexTextures >= 2;\n\t\tthis.supportsDepthShadow = this.isWebGL2;\n\t\tthis._textureFloatHighPrecision = undefined;\n\t\tthis._textureHalfFloatUpdatable = undefined;\n\t\tthis.areaLightLutFormat = PIXELFORMAT_RGBA8;\n\t\tif (this.extTextureHalfFloat && this.textureHalfFloatUpdatable && this.extTextureHalfFloatLinear) {\n\t\t\tthis.areaLightLutFormat = PIXELFORMAT_RGBA16F;\n\t\t} else if (this.extTextureFloat && this.extTextureFloatLinear) {\n\t\t\tthis.areaLightLutFormat = PIXELFORMAT_RGBA32F;\n\t\t}\n\t\tthis.postInit();\n\t}\n\tpostInit() {\n\t\tsuper.postInit();\n\t\tthis.gpuProfiler = new WebglGpuProfiler(this);\n\t}\n\tdestroy() {\n\t\tsuper.destroy();\n\t\tconst gl = this.gl;\n\t\tif (this.isWebGL2 && this.feedback) {\n\t\t\tgl.deleteTransformFeedback(this.feedback);\n\t\t}\n\t\tthis.clearVertexArrayObjectCache();\n\t\tthis.canvas.removeEventListener('webglcontextlost', this._contextLostHandler, false);\n\t\tthis.canvas.removeEventListener('webglcontextrestored', this._contextRestoredHandler, false);\n\t\tthis._contextLostHandler = null;\n\t\tthis._contextRestoredHandler = null;\n\t\tthis.gl = null;\n\t\tsuper.postDestroy();\n\t}\n\tcreateBackbuffer(frameBuffer) {\n\t\tthis.supportsStencil = this.initOptions.stencil;\n\t\tthis.backBuffer = new RenderTarget({\n\t\t\tname: 'WebglFramebuffer',\n\t\t\tgraphicsDevice: this,\n\t\t\tdepth: this.initOptions.depth,\n\t\t\tstencil: this.supportsStencil,\n\t\t\tsamples: this.samples\n\t\t});\n\t\tthis.backBuffer.impl.suppliedColorFramebuffer = frameBuffer;\n\t}\n\tupdateBackbufferFormat(framebuffer) {\n\t\tconst gl = this.gl;\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n\t\tconst alphaBits = this.gl.getParameter(this.gl.ALPHA_BITS);\n\t\tthis.backBufferFormat = alphaBits ? PIXELFORMAT_RGBA8 : PIXELFORMAT_RGB8;\n\t}\n\tupdateBackbuffer() {\n\t\tconst resolutionChanged = this.canvas.width !== this.backBufferSize.x || this.canvas.height !== this.backBufferSize.y;\n\t\tif (this._defaultFramebufferChanged || resolutionChanged) {\n\t\t\tif (this._defaultFramebufferChanged) {\n\t\t\t\tthis.updateBackbufferFormat(this._defaultFramebuffer);\n\t\t\t}\n\t\t\tthis._defaultFramebufferChanged = false;\n\t\t\tthis.backBufferSize.set(this.canvas.width, this.canvas.height);\n\t\t\tthis.backBuffer.destroy();\n\t\t\tthis.createBackbuffer(this._defaultFramebuffer);\n\t\t}\n\t}\n\tcreateVertexBufferImpl(vertexBuffer, format) {\n\t\treturn new WebglVertexBuffer();\n\t}\n\tcreateIndexBufferImpl(indexBuffer) {\n\t\treturn new WebglIndexBuffer(indexBuffer);\n\t}\n\tcreateShaderImpl(shader) {\n\t\treturn new WebglShader(shader);\n\t}\n\tcreateTextureImpl(texture) {\n\t\treturn new WebglTexture();\n\t}\n\tcreateRenderTargetImpl(renderTarget) {\n\t\treturn new WebglRenderTarget();\n\t}\n\tgetPrecision() {\n\t\tconst gl = this.gl;\n\t\tlet precision = \"highp\";\n\t\tif (gl.getShaderPrecisionFormat) {\n\t\t\tconst vertexShaderPrecisionHighpFloat = gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.HIGH_FLOAT);\n\t\t\tconst vertexShaderPrecisionMediumpFloat = gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.MEDIUM_FLOAT);\n\t\t\tconst fragmentShaderPrecisionHighpFloat = gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_FLOAT);\n\t\t\tconst fragmentShaderPrecisionMediumpFloat = gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.MEDIUM_FLOAT);\n\t\t\tif (vertexShaderPrecisionHighpFloat && vertexShaderPrecisionMediumpFloat && fragmentShaderPrecisionHighpFloat && fragmentShaderPrecisionMediumpFloat) {\n\t\t\t\tconst highpAvailable = vertexShaderPrecisionHighpFloat.precision > 0 && fragmentShaderPrecisionHighpFloat.precision > 0;\n\t\t\t\tconst mediumpAvailable = vertexShaderPrecisionMediumpFloat.precision > 0 && fragmentShaderPrecisionMediumpFloat.precision > 0;\n\t\t\t\tif (!highpAvailable) {\n\t\t\t\t\tif (mediumpAvailable) {\n\t\t\t\t\t\tprecision = \"mediump\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\tprecision = \"lowp\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn precision;\n\t}\n\tgetExtension() {\n\t\tfor (let i = 0; i < arguments.length; i++) {\n\t\t\tif (this.supportedExtensions.indexOf(arguments[i]) !== -1) {\n\t\t\t\treturn this.gl.getExtension(arguments[i]);\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\tget extDisjointTimerQuery() {\n\t\tif (!this._extDisjointTimerQuery) {\n\t\t\tif (this.isWebGL2) {\n\t\t\t\tthis._extDisjointTimerQuery = this.getExtension('EXT_disjoint_timer_query_webgl2', 'EXT_disjoint_timer_query');\n\t\t\t}\n\t\t}\n\t\treturn this._extDisjointTimerQuery;\n\t}\n\tinitializeExtensions() {\n\t\tvar _gl$getSupportedExten;\n\t\tconst gl = this.gl;\n\t\tthis.supportedExtensions = (_gl$getSupportedExten = gl.getSupportedExtensions()) != null ? _gl$getSupportedExten : [];\n\t\tthis._extDisjointTimerQuery = null;\n\t\tif (this.isWebGL2) {\n\t\t\tthis.extBlendMinmax = true;\n\t\t\tthis.extDrawBuffers = true;\n\t\t\tthis.drawBuffers = gl.drawBuffers.bind(gl);\n\t\t\tthis.extInstancing = true;\n\t\t\tthis.extStandardDerivatives = true;\n\t\t\tthis.extTextureFloat = true;\n\t\t\tthis.extTextureHalfFloat = true;\n\t\t\tthis.textureHalfFloatFilterable = true;\n\t\t\tthis.extTextureLod = true;\n\t\t\tthis.extUintElement = true;\n\t\t\tthis.extVertexArrayObject = true;\n\t\t\tthis.extColorBufferFloat = this.getExtension('EXT_color_buffer_float');\n\t\t\tthis.extDepthTexture = true;\n\t\t\tthis.textureRG11B10Renderable = true;\n\t\t} else {\n\t\t\tvar _this$extDrawBuffers;\n\t\t\tthis.extBlendMinmax = this.getExtension(\"EXT_blend_minmax\");\n\t\t\tthis.extDrawBuffers = this.getExtension('WEBGL_draw_buffers');\n\t\t\tthis.extInstancing = this.getExtension(\"ANGLE_instanced_arrays\");\n\t\t\tthis.drawBuffers = (_this$extDrawBuffers = this.extDrawBuffers) == null ? void 0 : _this$extDrawBuffers.drawBuffersWEBGL.bind(this.extDrawBuffers);\n\t\t\tif (this.extInstancing) {\n\t\t\t\tconst ext = this.extInstancing;\n\t\t\t\tgl.drawArraysInstanced = ext.drawArraysInstancedANGLE.bind(ext);\n\t\t\t\tgl.drawElementsInstanced = ext.drawElementsInstancedANGLE.bind(ext);\n\t\t\t\tgl.vertexAttribDivisor = ext.vertexAttribDivisorANGLE.bind(ext);\n\t\t\t}\n\t\t\tthis.extStandardDerivatives = this.getExtension(\"OES_standard_derivatives\");\n\t\t\tthis.extTextureFloat = this.getExtension(\"OES_texture_float\");\n\t\t\tthis.extTextureLod = this.getExtension('EXT_shader_texture_lod');\n\t\t\tthis.extUintElement = this.getExtension(\"OES_element_index_uint\");\n\t\t\tthis.extVertexArrayObject = this.getExtension(\"OES_vertex_array_object\");\n\t\t\tif (this.extVertexArrayObject) {\n\t\t\t\tconst ext = this.extVertexArrayObject;\n\t\t\t\tgl.createVertexArray = ext.createVertexArrayOES.bind(ext);\n\t\t\t\tgl.deleteVertexArray = ext.deleteVertexArrayOES.bind(ext);\n\t\t\t\tgl.isVertexArray = ext.isVertexArrayOES.bind(ext);\n\t\t\t\tgl.bindVertexArray = ext.bindVertexArrayOES.bind(ext);\n\t\t\t}\n\t\t\tthis.extColorBufferFloat = null;\n\t\t\tthis.extDepthTexture = gl.getExtension('WEBGL_depth_texture');\n\t\t\tthis.extTextureHalfFloat = this.getExtension(\"OES_texture_half_float\");\n\t\t\tthis.extTextureHalfFloatLinear = this.getExtension(\"OES_texture_half_float_linear\");\n\t\t\tthis.textureHalfFloatFilterable = !!this.extTextureHalfFloatLinear;\n\t\t}\n\t\tthis.extDebugRendererInfo = this.getExtension('WEBGL_debug_renderer_info');\n\t\tthis.extTextureFloatLinear = this.getExtension(\"OES_texture_float_linear\");\n\t\tthis.textureFloatFilterable = !!this.extTextureFloatLinear;\n\t\tthis.extFloatBlend = this.getExtension(\"EXT_float_blend\");\n\t\tthis.extTextureFilterAnisotropic = this.getExtension('EXT_texture_filter_anisotropic', 'WEBKIT_EXT_texture_filter_anisotropic');\n\t\tthis.extCompressedTextureETC1 = this.getExtension('WEBGL_compressed_texture_etc1');\n\t\tthis.extCompressedTextureETC = this.getExtension('WEBGL_compressed_texture_etc');\n\t\tthis.extCompressedTexturePVRTC = this.getExtension('WEBGL_compressed_texture_pvrtc', 'WEBKIT_WEBGL_compressed_texture_pvrtc');\n\t\tthis.extCompressedTextureS3TC = this.getExtension('WEBGL_compressed_texture_s3tc', 'WEBKIT_WEBGL_compressed_texture_s3tc');\n\t\tthis.extCompressedTextureATC = this.getExtension('WEBGL_compressed_texture_atc');\n\t\tthis.extCompressedTextureASTC = this.getExtension('WEBGL_compressed_texture_astc');\n\t\tthis.extParallelShaderCompile = this.getExtension('KHR_parallel_shader_compile');\n\t\tthis.extColorBufferHalfFloat = this.getExtension(\"EXT_color_buffer_half_float\");\n\t}\n\tinitializeCapabilities() {\n\t\tvar _contextAttribs$antia, _contextAttribs$stenc;\n\t\tconst gl = this.gl;\n\t\tlet ext;\n\t\tconst userAgent = typeof navigator !== 'undefined' ? navigator.userAgent : \"\";\n\t\tthis.maxPrecision = this.precision = this.getPrecision();\n\t\tconst contextAttribs = gl.getContextAttributes();\n\t\tthis.supportsMsaa = (_contextAttribs$antia = contextAttribs == null ? void 0 : contextAttribs.antialias) != null ? _contextAttribs$antia : false;\n\t\tthis.supportsStencil = (_contextAttribs$stenc = contextAttribs == null ? void 0 : contextAttribs.stencil) != null ? _contextAttribs$stenc : false;\n\t\tthis.supportsInstancing = !!this.extInstancing;\n\t\tthis.maxTextureSize = gl.getParameter(gl.MAX_TEXTURE_SIZE);\n\t\tthis.maxCubeMapSize = gl.getParameter(gl.MAX_CUBE_MAP_TEXTURE_SIZE);\n\t\tthis.maxRenderBufferSize = gl.getParameter(gl.MAX_RENDERBUFFER_SIZE);\n\t\tthis.maxTextures = gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);\n\t\tthis.maxCombinedTextures = gl.getParameter(gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS);\n\t\tthis.maxVertexTextures = gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS);\n\t\tthis.vertexUniformsCount = gl.getParameter(gl.MAX_VERTEX_UNIFORM_VECTORS);\n\t\tthis.fragmentUniformsCount = gl.getParameter(gl.MAX_FRAGMENT_UNIFORM_VECTORS);\n\t\tif (this.isWebGL2) {\n\t\t\tthis.maxDrawBuffers = gl.getParameter(gl.MAX_DRAW_BUFFERS);\n\t\t\tthis.maxColorAttachments = gl.getParameter(gl.MAX_COLOR_ATTACHMENTS);\n\t\t\tthis.maxVolumeSize = gl.getParameter(gl.MAX_3D_TEXTURE_SIZE);\n\t\t\tthis.supportsMrt = true;\n\t\t\tthis.supportsVolumeTextures = true;\n\t\t} else {\n\t\t\text = this.extDrawBuffers;\n\t\t\tthis.supportsMrt = !!ext;\n\t\t\tthis.maxDrawBuffers = ext ? gl.getParameter(ext.MAX_DRAW_BUFFERS_WEBGL) : 1;\n\t\t\tthis.maxColorAttachments = ext ? gl.getParameter(ext.MAX_COLOR_ATTACHMENTS_WEBGL) : 1;\n\t\t\tthis.maxVolumeSize = 1;\n\t\t}\n\t\text = this.extDebugRendererInfo;\n\t\tthis.unmaskedRenderer = ext ? gl.getParameter(ext.UNMASKED_RENDERER_WEBGL) : '';\n\t\tthis.unmaskedVendor = ext ? gl.getParameter(ext.UNMASKED_VENDOR_WEBGL) : '';\n\t\tconst maliRendererRegex = /\\bMali-G52+/;\n\t\tconst samsungModelRegex = /SM-[a-zA-Z0-9]+/;\n\t\tthis.supportsGpuParticles = !(this.unmaskedVendor === 'ARM' && userAgent.match(samsungModelRegex)) && !this.unmaskedRenderer.match(maliRendererRegex);\n\t\text = this.extTextureFilterAnisotropic;\n\t\tthis.maxAnisotropy = ext ? gl.getParameter(ext.MAX_TEXTURE_MAX_ANISOTROPY_EXT) : 1;\n\t\tconst antialiasSupported = this.isWebGL2 && !this.forceDisableMultisampling;\n\t\tthis.maxSamples = antialiasSupported ? gl.getParameter(gl.MAX_SAMPLES) : 1;\n\t\tthis.maxSamples = Math.min(this.maxSamples, 4);\n\t\tthis.samples = antialiasSupported && this.backBufferAntialias ? this.maxSamples : 1;\n\t\tthis.supportsAreaLights = this.isWebGL2 || !platform.android;\n\t\tthis.supportsTextureFetch = this.isWebGL2;\n\t\tif (this.maxTextures <= 8) {\n\t\t\tthis.supportsAreaLights = false;\n\t\t}\n\t}\n\tinitializeRenderState() {\n\t\tsuper.initializeRenderState();\n\t\tconst gl = this.gl;\n\t\tgl.disable(gl.BLEND);\n\t\tgl.blendFunc(gl.ONE, gl.ZERO);\n\t\tgl.blendEquation(gl.FUNC_ADD);\n\t\tgl.colorMask(true, true, true, true);\n\t\tthis.blendColor = new Color(0, 0, 0, 0);\n\t\tgl.blendColor(0, 0, 0, 0);\n\t\tgl.enable(gl.CULL_FACE);\n\t\tgl.cullFace(gl.BACK);\n\t\tgl.enable(gl.DEPTH_TEST);\n\t\tgl.depthFunc(gl.LEQUAL);\n\t\tgl.depthMask(true);\n\t\tthis.stencil = false;\n\t\tgl.disable(gl.STENCIL_TEST);\n\t\tthis.stencilFuncFront = this.stencilFuncBack = FUNC_ALWAYS;\n\t\tthis.stencilRefFront = this.stencilRefBack = 0;\n\t\tthis.stencilMaskFront = this.stencilMaskBack = 0xFF;\n\t\tgl.stencilFunc(gl.ALWAYS, 0, 0xFF);\n\t\tthis.stencilFailFront = this.stencilFailBack = STENCILOP_KEEP;\n\t\tthis.stencilZfailFront = this.stencilZfailBack = STENCILOP_KEEP;\n\t\tthis.stencilZpassFront = this.stencilZpassBack = STENCILOP_KEEP;\n\t\tthis.stencilWriteMaskFront = 0xFF;\n\t\tthis.stencilWriteMaskBack = 0xFF;\n\t\tgl.stencilOp(gl.KEEP, gl.KEEP, gl.KEEP);\n\t\tgl.stencilMask(0xFF);\n\t\tthis.alphaToCoverage = false;\n\t\tthis.raster = true;\n\t\tif (this.isWebGL2) {\n\t\t\tgl.disable(gl.SAMPLE_ALPHA_TO_COVERAGE);\n\t\t\tgl.disable(gl.RASTERIZER_DISCARD);\n\t\t}\n\t\tthis.depthBiasEnabled = false;\n\t\tgl.disable(gl.POLYGON_OFFSET_FILL);\n\t\tthis.clearDepth = 1;\n\t\tgl.clearDepth(1);\n\t\tthis.clearColor = new Color(0, 0, 0, 0);\n\t\tgl.clearColor(0, 0, 0, 0);\n\t\tthis.clearStencil = 0;\n\t\tgl.clearStencil(0);\n\t\tif (this.isWebGL2) {\n\t\t\tgl.hint(gl.FRAGMENT_SHADER_DERIVATIVE_HINT, gl.NICEST);\n\t\t} else {\n\t\t\tif (this.extStandardDerivatives) {\n\t\t\t\tgl.hint(this.extStandardDerivatives.FRAGMENT_SHADER_DERIVATIVE_HINT_OES, gl.NICEST);\n\t\t\t}\n\t\t}\n\t\tgl.enable(gl.SCISSOR_TEST);\n\t\tgl.pixelStorei(gl.UNPACK_COLORSPACE_CONVERSION_WEBGL, gl.NONE);\n\t\tthis.unpackFlipY = false;\n\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\n\t\tthis.unpackPremultiplyAlpha = false;\n\t\tgl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false);\n\t\tgl.pixelStorei(gl.UNPACK_ALIGNMENT, 1);\n\t}\n\tinitTextureUnits(count = 16) {\n\t\tthis.textureUnits = [];\n\t\tfor (let i = 0; i < count; i++) {\n\t\t\tthis.textureUnits.push([null, null, null]);\n\t\t}\n\t}\n\tinitializeContextCaches() {\n\t\tsuper.initializeContextCaches();\n\t\tthis._vaoMap = new Map();\n\t\tthis.boundVao = null;\n\t\tthis.activeFramebuffer = null;\n\t\tthis.feedback = null;\n\t\tthis.transformFeedbackBuffer = null;\n\t\tthis.textureUnit = 0;\n\t\tthis.initTextureUnits(this.maxCombinedTextures);\n\t}\n\tloseContext() {\n\t\tvar _this$gpuProfiler;\n\t\tthis.backBufferSize.set(-1, -1);\n\t\tfor (const shader of this.shaders) {\n\t\t\tshader.loseContext();\n\t\t}\n\t\tfor (const texture of this.textures) {\n\t\t\ttexture.loseContext();\n\t\t}\n\t\tfor (const buffer of this.buffers) {\n\t\t\tbuffer.loseContext();\n\t\t}\n\t\tfor (const target of this.targets) {\n\t\t\ttarget.loseContext();\n\t\t}\n\t\t(_this$gpuProfiler = this.gpuProfiler) == null || _this$gpuProfiler.loseContext();\n\t}\n\trestoreContext() {\n\t\tvar _this$gpuProfiler2;\n\t\tthis.initializeExtensions();\n\t\tthis.initializeCapabilities();\n\t\tthis.initializeRenderState();\n\t\tthis.initializeContextCaches();\n\t\tfor (const shader of this.shaders) {\n\t\t\tshader.restoreContext();\n\t\t}\n\t\tfor (const buffer of this.buffers) {\n\t\t\tbuffer.unlock();\n\t\t}\n\t\t(_this$gpuProfiler2 = this.gpuProfiler) == null || _this$gpuProfiler2.restoreContext();\n\t}\n\tendShaderBatch() {\n\t\tWebglShader.endShaderBatch(this);\n\t}\n\tsetViewport(x, y, w, h) {\n\t\tif (this.vx !== x || this.vy !== y || this.vw !== w || this.vh !== h) {\n\t\t\tthis.gl.viewport(x, y, w, h);\n\t\t\tthis.vx = x;\n\t\t\tthis.vy = y;\n\t\t\tthis.vw = w;\n\t\t\tthis.vh = h;\n\t\t}\n\t}\n\tsetScissor(x, y, w, h) {\n\t\tif (this.sx !== x || this.sy !== y || this.sw !== w || this.sh !== h) {\n\t\t\tthis.gl.scissor(x, y, w, h);\n\t\t\tthis.sx = x;\n\t\t\tthis.sy = y;\n\t\t\tthis.sw = w;\n\t\t\tthis.sh = h;\n\t\t}\n\t}\n\tsetFramebuffer(fb) {\n\t\tif (this.activeFramebuffer !== fb) {\n\t\t\tconst gl = this.gl;\n\t\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, fb);\n\t\t\tthis.activeFramebuffer = fb;\n\t\t}\n\t}\n\tcopyRenderTarget(source, dest, color, depth) {\n\t\tconst gl = this.gl;\n\t\tif (source === this.backBuffer) {\n\t\t\tsource = null;\n\t\t}\n\t\tif (!this.isWebGL2 && depth) {\n\t\t\treturn false;\n\t\t}\n\t\tif (color) {\n\t\t\tif (!dest) {\n\t\t\t\tif (!source._colorBuffer) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t} else if (source) {\n\t\t\t\tif (!source._colorBuffer || !dest._colorBuffer) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (source._colorBuffer._format !== dest._colorBuffer._format) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (depth && source) {\n\t\t\tif (!source._depth) {\n\t\t\t\tif (!source._depthBuffer || !dest._depthBuffer) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (source._depthBuffer._format !== dest._depthBuffer._format) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (this.isWebGL2 && dest) {\n\t\t\tvar _this$backBuffer;\n\t\t\tconst prevRt = this.renderTarget;\n\t\t\tthis.renderTarget = dest;\n\t\t\tthis.updateBegin();\n\t\t\tconst src = source ? source.impl._glFrameBuffer : (_this$backBuffer = this.backBuffer) == null ? void 0 : _this$backBuffer.impl._glFrameBuffer;\n\t\t\tconst dst = dest.impl._glFrameBuffer;\n\t\t\tgl.bindFramebuffer(gl.READ_FRAMEBUFFER, src);\n\t\t\tgl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, dst);\n\t\t\tconst w = source ? source.width : dest.width;\n\t\t\tconst h = source ? source.height : dest.height;\n\t\t\tgl.blitFramebuffer(0, 0, w, h, 0, 0, w, h, (color ? gl.COLOR_BUFFER_BIT : 0) | (depth ? gl.DEPTH_BUFFER_BIT : 0), gl.NEAREST);\n\t\t\tthis.renderTarget = prevRt;\n\t\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, prevRt ? prevRt.impl._glFrameBuffer : null);\n\t\t} else {\n\t\t\tconst shader = this.getCopyShader();\n\t\t\tthis.constantTexSource.setValue(source._colorBuffer);\n\t\t\tquadWithShader(this, dest, shader);\n\t\t}\n\t\treturn true;\n\t}\n\tgetCopyShader() {\n\t\tif (!this._copyShader) {\n\t\t\tthis._copyShader = new Shader(this, ShaderUtils.createDefinition(this, {\n\t\t\t\tname: 'outputTex2D',\n\t\t\t\tvertexCode: _fullScreenQuadVS,\n\t\t\t\tfragmentCode: _outputTexture2D\n\t\t\t}));\n\t\t}\n\t\treturn this._copyShader;\n\t}\n\tframeStart() {\n\t\tsuper.frameStart();\n\t\tthis.updateBackbuffer();\n\t\tthis.gpuProfiler.frameStart();\n\t}\n\tframeEnd() {\n\t\tsuper.frameEnd();\n\t\tthis.gpuProfiler.frameEnd();\n\t\tthis.gpuProfiler.request();\n\t}\n\tstartRenderPass(renderPass) {\n\t\tvar _renderPass$renderTar;\n\t\tconst rt = (_renderPass$renderTar = renderPass.renderTarget) != null ? _renderPass$renderTar : this.backBuffer;\n\t\tthis.renderTarget = rt;\n\t\tthis.updateBegin();\n\t\tconst {\n\t\t\twidth,\n\t\t\theight\n\t\t} = rt;\n\t\tthis.setViewport(0, 0, width, height);\n\t\tthis.setScissor(0, 0, width, height);\n\t\tconst colorOps = renderPass.colorOps;\n\t\tconst depthStencilOps = renderPass.depthStencilOps;\n\t\tif (colorOps != null && colorOps.clear || depthStencilOps.clearDepth || depthStencilOps.clearStencil) {\n\t\t\tlet clearFlags = 0;\n\t\t\tconst clearOptions = {};\n\t\t\tif (colorOps != null && colorOps.clear) {\n\t\t\t\tclearFlags |= CLEARFLAG_COLOR;\n\t\t\t\tclearOptions.color = [colorOps.clearValue.r, colorOps.clearValue.g, colorOps.clearValue.b, colorOps.clearValue.a];\n\t\t\t}\n\t\t\tif (depthStencilOps.clearDepth) {\n\t\t\t\tclearFlags |= CLEARFLAG_DEPTH;\n\t\t\t\tclearOptions.depth = depthStencilOps.clearDepthValue;\n\t\t\t}\n\t\t\tif (depthStencilOps.clearStencil) {\n\t\t\t\tclearFlags |= CLEARFLAG_STENCIL;\n\t\t\t\tclearOptions.stencil = depthStencilOps.clearStencilValue;\n\t\t\t}\n\t\t\tclearOptions.flags = clearFlags;\n\t\t\tthis.clear(clearOptions);\n\t\t}\n\t\tthis.insideRenderPass = true;\n\t}\n\tendRenderPass(renderPass) {\n\t\tthis.unbindVertexArray();\n\t\tconst target = this.renderTarget;\n\t\tconst colorBufferCount = renderPass.colorArrayOps.length;\n\t\tif (target) {\n\t\t\tvar _renderPass$colorOps;\n\t\t\tif (this.isWebGL2) {\n\t\t\t\tinvalidateAttachments.length = 0;\n\t\t\t\tconst gl = this.gl;\n\t\t\t\tfor (let i = 0; i < colorBufferCount; i++) {\n\t\t\t\t\tconst colorOps = renderPass.colorArrayOps[i];\n\t\t\t\t\tif (!(colorOps.store || colorOps.resolve)) {\n\t\t\t\t\t\tinvalidateAttachments.push(gl.COLOR_ATTACHMENT0 + i);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (target !== this.backBuffer) {\n\t\t\t\t\tif (!renderPass.depthStencilOps.storeDepth) {\n\t\t\t\t\t\tinvalidateAttachments.push(gl.DEPTH_ATTACHMENT);\n\t\t\t\t\t}\n\t\t\t\t\tif (!renderPass.depthStencilOps.storeStencil) {\n\t\t\t\t\t\tinvalidateAttachments.push(gl.STENCIL_ATTACHMENT);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (invalidateAttachments.length > 0) {\n\t\t\t\t\tif (renderPass.fullSizeClearRect) {\n\t\t\t\t\t\tgl.invalidateFramebuffer(gl.DRAW_FRAMEBUFFER, invalidateAttachments);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ((_renderPass$colorOps = renderPass.colorOps) != null && _renderPass$colorOps.resolve) {\n\t\t\t\tif (this.isWebGL2 && renderPass.samples > 1 && target.autoResolve) {\n\t\t\t\t\ttarget.resolve(true, false);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (let i = 0; i < colorBufferCount; i++) {\n\t\t\t\tconst colorOps = renderPass.colorArrayOps[i];\n\t\t\t\tif (colorOps.mipmaps) {\n\t\t\t\t\tconst colorBuffer = target._colorBuffers[i];\n\t\t\t\t\tif (colorBuffer && colorBuffer.impl._glTexture && colorBuffer.mipmaps && (colorBuffer.pot || this.isWebGL2)) {\n\t\t\t\t\t\tthis.activeTexture(this.maxCombinedTextures - 1);\n\t\t\t\t\t\tthis.bindTexture(colorBuffer);\n\t\t\t\t\t\tthis.gl.generateMipmap(colorBuffer.impl._glTarget);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.insideRenderPass = false;\n\t}\n\tset defaultFramebuffer(value) {\n\t\tif (this._defaultFramebuffer !== value) {\n\t\t\tthis._defaultFramebuffer = value;\n\t\t\tthis._defaultFramebufferChanged = true;\n\t\t}\n\t}\n\tget defaultFramebuffer() {\n\t\treturn this._defaultFramebuffer;\n\t}\n\tupdateBegin() {\n\t\tvar _this$renderTarget;\n\t\tthis.boundVao = null;\n\t\tif (this._tempEnableSafariTextureUnitWorkaround) {\n\t\t\tfor (let unit = 0; unit < this.textureUnits.length; ++unit) {\n\t\t\t\tfor (let slot = 0; slot < 3; ++slot) {\n\t\t\t\t\tthis.textureUnits[unit][slot] = null;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst target = (_this$renderTarget = this.renderTarget) != null ? _this$renderTarget : this.backBuffer;\n\t\tconst targetImpl = target.impl;\n\t\tif (!targetImpl.initialized) {\n\t\t\tthis.initRenderTarget(target);\n\t\t}\n\t\tthis.setFramebuffer(targetImpl._glFrameBuffer);\n\t}\n\tupdateEnd() {\n\t\tthis.unbindVertexArray();\n\t\tconst target = this.renderTarget;\n\t\tif (target && target !== this.backBuffer) {\n\t\t\tif (this.isWebGL2 && target._samples > 1 && target.autoResolve) {\n\t\t\t\ttarget.resolve();\n\t\t\t}\n\t\t\tconst colorBuffer = target._colorBuffer;\n\t\t\tif (colorBuffer && colorBuffer.impl._glTexture && colorBuffer.mipmaps && (colorBuffer.pot || this.isWebGL2)) {\n\t\t\t\tthis.activeTexture(this.maxCombinedTextures - 1);\n\t\t\t\tthis.bindTexture(colorBuffer);\n\t\t\t\tthis.gl.generateMipmap(colorBuffer.impl._glTarget);\n\t\t\t}\n\t\t}\n\t}\n\tsetUnpackFlipY(flipY) {\n\t\tif (this.unpackFlipY !== flipY) {\n\t\t\tthis.unpackFlipY = flipY;\n\t\t\tconst gl = this.gl;\n\t\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, flipY);\n\t\t}\n\t}\n\tsetUnpackPremultiplyAlpha(premultiplyAlpha) {\n\t\tif (this.unpackPremultiplyAlpha !== premultiplyAlpha) {\n\t\t\tthis.unpackPremultiplyAlpha = premultiplyAlpha;\n\t\t\tconst gl = this.gl;\n\t\t\tgl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, premultiplyAlpha);\n\t\t}\n\t}\n\tactiveTexture(textureUnit) {\n\t\tif (this.textureUnit !== textureUnit) {\n\t\t\tthis.gl.activeTexture(this.gl.TEXTURE0 + textureUnit);\n\t\t\tthis.textureUnit = textureUnit;\n\t\t}\n\t}\n\tbindTexture(texture) {\n\t\tconst impl = texture.impl;\n\t\tconst textureTarget = impl._glTarget;\n\t\tconst textureObject = impl._glTexture;\n\t\tconst textureUnit = this.textureUnit;\n\t\tconst slot = this.targetToSlot[textureTarget];\n\t\tif (this.textureUnits[textureUnit][slot] !== textureObject) {\n\t\t\tthis.gl.bindTexture(textureTarget, textureObject);\n\t\t\tthis.textureUnits[textureUnit][slot] = textureObject;\n\t\t}\n\t}\n\tbindTextureOnUnit(texture, textureUnit) {\n\t\tconst impl = texture.impl;\n\t\tconst textureTarget = impl._glTarget;\n\t\tconst textureObject = impl._glTexture;\n\t\tconst slot = this.targetToSlot[textureTarget];\n\t\tif (this.textureUnits[textureUnit][slot] !== textureObject) {\n\t\t\tthis.activeTexture(textureUnit);\n\t\t\tthis.gl.bindTexture(textureTarget, textureObject);\n\t\t\tthis.textureUnits[textureUnit][slot] = textureObject;\n\t\t}\n\t}\n\tsetTextureParameters(texture) {\n\t\tconst gl = this.gl;\n\t\tconst flags = texture.impl.dirtyParameterFlags;\n\t\tconst target = texture.impl._glTarget;\n\t\tif (flags & 1) {\n\t\t\tlet filter = texture._minFilter;\n\t\t\tif (!texture.pot && !this.isWebGL2 || !texture._mipmaps || texture._compressed && texture._levels.length === 1) {\n\t\t\t\tif (filter === FILTER_NEAREST_MIPMAP_NEAREST || filter === FILTER_NEAREST_MIPMAP_LINEAR) {\n\t\t\t\t\tfilter = FILTER_NEAREST;\n\t\t\t\t} else if (filter === FILTER_LINEAR_MIPMAP_NEAREST || filter === FILTER_LINEAR_MIPMAP_LINEAR) {\n\t\t\t\t\tfilter = FILTER_LINEAR;\n\t\t\t\t}\n\t\t\t}\n\t\t\tgl.texParameteri(target, gl.TEXTURE_MIN_FILTER, this.glFilter[filter]);\n\t\t}\n\t\tif (flags & 2) {\n\t\t\tgl.texParameteri(target, gl.TEXTURE_MAG_FILTER, this.glFilter[texture._magFilter]);\n\t\t}\n\t\tif (flags & 4) {\n\t\t\tif (this.isWebGL2) {\n\t\t\t\tgl.texParameteri(target, gl.TEXTURE_WRAP_S, this.glAddress[texture._addressU]);\n\t\t\t} else {\n\t\t\t\tgl.texParameteri(target, gl.TEXTURE_WRAP_S, this.glAddress[texture.pot ? texture._addressU : ADDRESS_CLAMP_TO_EDGE]);\n\t\t\t}\n\t\t}\n\t\tif (flags & 8) {\n\t\t\tif (this.isWebGL2) {\n\t\t\t\tgl.texParameteri(target, gl.TEXTURE_WRAP_T, this.glAddress[texture._addressV]);\n\t\t\t} else {\n\t\t\t\tgl.texParameteri(target, gl.TEXTURE_WRAP_T, this.glAddress[texture.pot ? texture._addressV : ADDRESS_CLAMP_TO_EDGE]);\n\t\t\t}\n\t\t}\n\t\tif (flags & 16) {\n\t\t\tif (this.isWebGL2) {\n\t\t\t\tgl.texParameteri(target, gl.TEXTURE_WRAP_R, this.glAddress[texture._addressW]);\n\t\t\t}\n\t\t}\n\t\tif (flags & 32) {\n\t\t\tif (this.isWebGL2) {\n\t\t\t\tgl.texParameteri(target, gl.TEXTURE_COMPARE_MODE, texture._compareOnRead ? gl.COMPARE_REF_TO_TEXTURE : gl.NONE);\n\t\t\t}\n\t\t}\n\t\tif (flags & 64) {\n\t\t\tif (this.isWebGL2) {\n\t\t\t\tgl.texParameteri(target, gl.TEXTURE_COMPARE_FUNC, this.glComparison[texture._compareFunc]);\n\t\t\t}\n\t\t}\n\t\tif (flags & 128) {\n\t\t\tconst ext = this.extTextureFilterAnisotropic;\n\t\t\tif (ext) {\n\t\t\t\tgl.texParameterf(target, ext.TEXTURE_MAX_ANISOTROPY_EXT, math.clamp(Math.round(texture._anisotropy), 1, this.maxAnisotropy));\n\t\t\t}\n\t\t}\n\t}\n\tsetTexture(texture, textureUnit) {\n\t\tconst impl = texture.impl;\n\t\tif (!impl._glTexture) impl.initialize(this, texture);\n\t\tif (impl.dirtyParameterFlags > 0 || texture._needsUpload || texture._needsMipmapsUpload) {\n\t\t\tthis.activeTexture(textureUnit);\n\t\t\tthis.bindTexture(texture);\n\t\t\tif (impl.dirtyParameterFlags) {\n\t\t\t\tthis.setTextureParameters(texture);\n\t\t\t\timpl.dirtyParameterFlags = 0;\n\t\t\t}\n\t\t\tif (texture._needsUpload || texture._needsMipmapsUpload) {\n\t\t\t\timpl.upload(this, texture);\n\t\t\t\ttexture._needsUpload = false;\n\t\t\t\ttexture._needsMipmapsUpload = false;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.bindTextureOnUnit(texture, textureUnit);\n\t\t}\n\t}\n\tcreateVertexArray(vertexBuffers) {\n\t\tlet key, vao;\n\t\tconst useCache = vertexBuffers.length > 1;\n\t\tif (useCache) {\n\t\t\tkey = \"\";\n\t\t\tfor (let i = 0; i < vertexBuffers.length; i++) {\n\t\t\t\tconst vertexBuffer = vertexBuffers[i];\n\t\t\t\tkey += vertexBuffer.id + vertexBuffer.format.renderingHash;\n\t\t\t}\n\t\t\tvao = this._vaoMap.get(key);\n\t\t}\n\t\tif (!vao) {\n\t\t\tconst gl = this.gl;\n\t\t\tvao = gl.createVertexArray();\n\t\t\tgl.bindVertexArray(vao);\n\t\t\tgl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n\t\t\tfor (let i = 0; i < vertexBuffers.length; i++) {\n\t\t\t\tconst vertexBuffer = vertexBuffers[i];\n\t\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer.impl.bufferId);\n\t\t\t\tconst elements = vertexBuffer.format.elements;\n\t\t\t\tfor (let j = 0; j < elements.length; j++) {\n\t\t\t\t\tconst e = elements[j];\n\t\t\t\t\tconst loc = semanticToLocation[e.name];\n\t\t\t\t\tif (e.asInt) {\n\t\t\t\t\t\tgl.vertexAttribIPointer(loc, e.numComponents, this.glType[e.dataType], e.stride, e.offset);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tgl.vertexAttribPointer(loc, e.numComponents, this.glType[e.dataType], e.normalize, e.stride, e.offset);\n\t\t\t\t\t}\n\t\t\t\t\tgl.enableVertexAttribArray(loc);\n\t\t\t\t\tif (vertexBuffer.format.instancing) {\n\t\t\t\t\t\tgl.vertexAttribDivisor(loc, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tgl.bindVertexArray(null);\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, null);\n\t\t\tif (useCache) {\n\t\t\t\tthis._vaoMap.set(key, vao);\n\t\t\t}\n\t\t}\n\t\treturn vao;\n\t}\n\tunbindVertexArray() {\n\t\tif (this.boundVao) {\n\t\t\tthis.boundVao = null;\n\t\t\tthis.gl.bindVertexArray(null);\n\t\t}\n\t}\n\tsetBuffers() {\n\t\tconst gl = this.gl;\n\t\tlet vao;\n\t\tif (this.vertexBuffers.length === 1) {\n\t\t\tconst vertexBuffer = this.vertexBuffers[0];\n\t\t\tif (!vertexBuffer.impl.vao) {\n\t\t\t\tvertexBuffer.impl.vao = this.createVertexArray(this.vertexBuffers);\n\t\t\t}\n\t\t\tvao = vertexBuffer.impl.vao;\n\t\t} else {\n\t\t\tvao = this.createVertexArray(this.vertexBuffers);\n\t\t}\n\t\tif (this.boundVao !== vao) {\n\t\t\tthis.boundVao = vao;\n\t\t\tgl.bindVertexArray(vao);\n\t\t}\n\t\tthis.vertexBuffers.length = 0;\n\t\tconst bufferId = this.indexBuffer ? this.indexBuffer.impl.bufferId : null;\n\t\tgl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, bufferId);\n\t}\n\tdraw(primitive, numInstances, keepBuffers) {\n\t\tconst gl = this.gl;\n\t\tlet sampler, samplerValue, texture, numTextures;\n\t\tlet uniform, scopeId, uniformVersion, programVersion;\n\t\tconst shader = this.shader;\n\t\tif (!shader) return;\n\t\tconst samplers = shader.impl.samplers;\n\t\tconst uniforms = shader.impl.uniforms;\n\t\tif (!keepBuffers) {\n\t\t\tthis.setBuffers();\n\t\t}\n\t\tlet textureUnit = 0;\n\t\tfor (let i = 0, len = samplers.length; i < len; i++) {\n\t\t\tsampler = samplers[i];\n\t\t\tsamplerValue = sampler.scopeId.value;\n\t\t\tif (!samplerValue) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (samplerValue instanceof Texture) {\n\t\t\t\ttexture = samplerValue;\n\t\t\t\tthis.setTexture(texture, textureUnit);\n\t\t\t\tif (sampler.slot !== textureUnit) {\n\t\t\t\t\tgl.uniform1i(sampler.locationId, textureUnit);\n\t\t\t\t\tsampler.slot = textureUnit;\n\t\t\t\t}\n\t\t\t\ttextureUnit++;\n\t\t\t} else {\n\t\t\t\tsampler.array.length = 0;\n\t\t\t\tnumTextures = samplerValue.length;\n\t\t\t\tfor (let j = 0; j < numTextures; j++) {\n\t\t\t\t\ttexture = samplerValue[j];\n\t\t\t\t\tthis.setTexture(texture, textureUnit);\n\t\t\t\t\tsampler.array[j] = textureUnit;\n\t\t\t\t\ttextureUnit++;\n\t\t\t\t}\n\t\t\t\tgl.uniform1iv(sampler.locationId, sampler.array);\n\t\t\t}\n\t\t}\n\t\tfor (let i = 0, len = uniforms.length; i < len; i++) {\n\t\t\tuniform = uniforms[i];\n\t\t\tscopeId = uniform.scopeId;\n\t\t\tuniformVersion = uniform.version;\n\t\t\tprogramVersion = scopeId.versionObject.version;\n\t\t\tif (uniformVersion.globalId !== programVersion.globalId || uniformVersion.revision !== programVersion.revision) {\n\t\t\t\tuniformVersion.globalId = programVersion.globalId;\n\t\t\t\tuniformVersion.revision = programVersion.revision;\n\t\t\t\tif (scopeId.value !== null) {\n\t\t\t\t\tthis.commitFunction[uniform.dataType](uniform, scopeId.value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (this.isWebGL2 && this.transformFeedbackBuffer) {\n\t\t\tgl.bindBufferBase(gl.TRANSFORM_FEEDBACK_BUFFER, 0, this.transformFeedbackBuffer.impl.bufferId);\n\t\t\tgl.beginTransformFeedback(gl.POINTS);\n\t\t}\n\t\tconst mode = this.glPrimitive[primitive.type];\n\t\tconst count = primitive.count;\n\t\tif (primitive.indexed) {\n\t\t\tconst indexBuffer = this.indexBuffer;\n\t\t\tconst format = indexBuffer.impl.glFormat;\n\t\t\tconst offset = primitive.base * indexBuffer.bytesPerIndex;\n\t\t\tif (numInstances > 0) {\n\t\t\t\tgl.drawElementsInstanced(mode, count, format, offset, numInstances);\n\t\t\t} else {\n\t\t\t\tgl.drawElements(mode, count, format, offset);\n\t\t\t}\n\t\t} else {\n\t\t\tconst first = primitive.base;\n\t\t\tif (numInstances > 0) {\n\t\t\t\tgl.drawArraysInstanced(mode, first, count, numInstances);\n\t\t\t} else {\n\t\t\t\tgl.drawArrays(mode, first, count);\n\t\t\t}\n\t\t}\n\t\tif (this.isWebGL2 && this.transformFeedbackBuffer) {\n\t\t\tgl.endTransformFeedback();\n\t\t\tgl.bindBufferBase(gl.TRANSFORM_FEEDBACK_BUFFER, 0, null);\n\t\t}\n\t\tthis._drawCallsPerFrame++;\n\t}\n\tclear(options) {\n\t\tvar _options$flags;\n\t\tconst defaultOptions = this.defaultClearOptions;\n\t\toptions = options || defaultOptions;\n\t\tconst flags = (_options$flags = options.flags) != null ? _options$flags : defaultOptions.flags;\n\t\tif (flags !== 0) {\n\t\t\tconst gl = this.gl;\n\t\t\tif (flags & CLEARFLAG_COLOR) {\n\t\t\t\tvar _options$color;\n\t\t\t\tconst color = (_options$color = options.color) != null ? _options$color : defaultOptions.color;\n\t\t\t\tconst r = color[0];\n\t\t\t\tconst g = color[1];\n\t\t\t\tconst b = color[2];\n\t\t\t\tconst a = color[3];\n\t\t\t\tconst c = this.clearColor;\n\t\t\t\tif (r !== c.r || g !== c.g || b !== c.b || a !== c.a) {\n\t\t\t\t\tthis.gl.clearColor(r, g, b, a);\n\t\t\t\t\tthis.clearColor.set(r, g, b, a);\n\t\t\t\t}\n\t\t\t\tthis.setBlendState(BlendState.NOBLEND);\n\t\t\t}\n\t\t\tif (flags & CLEARFLAG_DEPTH) {\n\t\t\t\tvar _options$depth;\n\t\t\t\tconst depth = (_options$depth = options.depth) != null ? _options$depth : defaultOptions.depth;\n\t\t\t\tif (depth !== this.clearDepth) {\n\t\t\t\t\tthis.gl.clearDepth(depth);\n\t\t\t\t\tthis.clearDepth = depth;\n\t\t\t\t}\n\t\t\t\tthis.setDepthState(DepthState.WRITEDEPTH);\n\t\t\t}\n\t\t\tif (flags & CLEARFLAG_STENCIL) {\n\t\t\t\tvar _options$stencil;\n\t\t\t\tconst stencil = (_options$stencil = options.stencil) != null ? _options$stencil : defaultOptions.stencil;\n\t\t\t\tif (stencil !== this.clearStencil) {\n\t\t\t\t\tthis.gl.clearStencil(stencil);\n\t\t\t\t\tthis.clearStencil = stencil;\n\t\t\t\t}\n\t\t\t}\n\t\t\tgl.clear(this.glClearFlag[flags]);\n\t\t}\n\t}\n\tsubmit() {\n\t\tthis.gl.flush();\n\t}\n\treadPixels(x, y, w, h, pixels) {\n\t\tconst gl = this.gl;\n\t\tgl.readPixels(x, y, w, h, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\n\t}\n\tasync readPixelsAsync(x, y, w, h, pixels) {\n\t\tvar _this$renderTarget$co, _impl$_glFormat, _impl$_glPixelType;\n\t\tconst gl = this.gl;\n\t\tif (!this.isWebGL2) {\n\t\t\tthis.readPixels(x, y, w, h, pixels);\n\t\t\treturn;\n\t\t}\n\t\tconst clientWaitAsync = (flags, interval_ms) => {\n\t\t\tconst sync = gl.fenceSync(gl.SYNC_GPU_COMMANDS_COMPLETE, 0);\n\t\t\tthis.submit();\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tfunction test() {\n\t\t\t\t\tconst res = gl.clientWaitSync(sync, flags, 0);\n\t\t\t\t\tif (res === gl.WAIT_FAILED) {\n\t\t\t\t\t\tgl.deleteSync(sync);\n\t\t\t\t\t\treject(new Error('webgl clientWaitSync sync failed'));\n\t\t\t\t\t} else if (res === gl.TIMEOUT_EXPIRED) {\n\t\t\t\t\t\tsetTimeout(test, interval_ms);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tgl.deleteSync(sync);\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\ttest();\n\t\t\t});\n\t\t};\n\t\tconst impl = (_this$renderTarget$co = this.renderTarget.colorBuffer) == null ? void 0 : _this$renderTarget$co.impl;\n\t\tconst format = (_impl$_glFormat = impl == null ? void 0 : impl._glFormat) != null ? _impl$_glFormat : gl.RGBA;\n\t\tconst pixelType = (_impl$_glPixelType = impl == null ? void 0 : impl._glPixelType) != null ? _impl$_glPixelType : gl.UNSIGNED_BYTE;\n\t\tconst buf = gl.createBuffer();\n\t\tgl.bindBuffer(gl.PIXEL_PACK_BUFFER, buf);\n\t\tgl.bufferData(gl.PIXEL_PACK_BUFFER, pixels.byteLength, gl.STREAM_READ);\n\t\tgl.readPixels(x, y, w, h, format, pixelType, 0);\n\t\tgl.bindBuffer(gl.PIXEL_PACK_BUFFER, null);\n\t\tawait clientWaitAsync(0, 20);\n\t\tgl.bindBuffer(gl.PIXEL_PACK_BUFFER, buf);\n\t\tgl.getBufferSubData(gl.PIXEL_PACK_BUFFER, 0, pixels);\n\t\tgl.bindBuffer(gl.PIXEL_PACK_BUFFER, null);\n\t\tgl.deleteBuffer(buf);\n\t}\n\tsetAlphaToCoverage(state) {\n\t\tif (this.isWebGL1) return;\n\t\tif (this.alphaToCoverage === state) return;\n\t\tthis.alphaToCoverage = state;\n\t\tif (state) {\n\t\t\tthis.gl.enable(this.gl.SAMPLE_ALPHA_TO_COVERAGE);\n\t\t} else {\n\t\t\tthis.gl.disable(this.gl.SAMPLE_ALPHA_TO_COVERAGE);\n\t\t}\n\t}\n\tsetTransformFeedbackBuffer(tf) {\n\t\tif (this.transformFeedbackBuffer === tf) return;\n\t\tthis.transformFeedbackBuffer = tf;\n\t\tif (this.isWebGL2) {\n\t\t\tconst gl = this.gl;\n\t\t\tif (tf) {\n\t\t\t\tif (!this.feedback) {\n\t\t\t\t\tthis.feedback = gl.createTransformFeedback();\n\t\t\t\t}\n\t\t\t\tgl.bindTransformFeedback(gl.TRANSFORM_FEEDBACK, this.feedback);\n\t\t\t} else {\n\t\t\t\tgl.bindTransformFeedback(gl.TRANSFORM_FEEDBACK, null);\n\t\t\t}\n\t\t}\n\t}\n\tsetRaster(on) {\n\t\tif (this.raster === on) return;\n\t\tthis.raster = on;\n\t\tif (this.isWebGL2) {\n\t\t\tif (on) {\n\t\t\t\tthis.gl.disable(this.gl.RASTERIZER_DISCARD);\n\t\t\t} else {\n\t\t\t\tthis.gl.enable(this.gl.RASTERIZER_DISCARD);\n\t\t\t}\n\t\t}\n\t}\n\tsetDepthBias(on) {\n\t\tif (this.depthBiasEnabled === on) return;\n\t\tthis.depthBiasEnabled = on;\n\t\tif (on) {\n\t\t\tthis.gl.enable(this.gl.POLYGON_OFFSET_FILL);\n\t\t} else {\n\t\t\tthis.gl.disable(this.gl.POLYGON_OFFSET_FILL);\n\t\t}\n\t}\n\tsetDepthBiasValues(constBias, slopeBias) {\n\t\tthis.gl.polygonOffset(slopeBias, constBias);\n\t}\n\tsetStencilTest(enable) {\n\t\tif (this.stencil !== enable) {\n\t\t\tconst gl = this.gl;\n\t\t\tif (enable) {\n\t\t\t\tgl.enable(gl.STENCIL_TEST);\n\t\t\t} else {\n\t\t\t\tgl.disable(gl.STENCIL_TEST);\n\t\t\t}\n\t\t\tthis.stencil = enable;\n\t\t}\n\t}\n\tsetStencilFunc(func, ref, mask) {\n\t\tif (this.stencilFuncFront !== func || this.stencilRefFront !== ref || this.stencilMaskFront !== mask || this.stencilFuncBack !== func || this.stencilRefBack !== ref || this.stencilMaskBack !== mask) {\n\t\t\tthis.gl.stencilFunc(this.glComparison[func], ref, mask);\n\t\t\tthis.stencilFuncFront = this.stencilFuncBack = func;\n\t\t\tthis.stencilRefFront = this.stencilRefBack = ref;\n\t\t\tthis.stencilMaskFront = this.stencilMaskBack = mask;\n\t\t}\n\t}\n\tsetStencilFuncFront(func, ref, mask) {\n\t\tif (this.stencilFuncFront !== func || this.stencilRefFront !== ref || this.stencilMaskFront !== mask) {\n\t\t\tconst gl = this.gl;\n\t\t\tgl.stencilFuncSeparate(gl.FRONT, this.glComparison[func], ref, mask);\n\t\t\tthis.stencilFuncFront = func;\n\t\t\tthis.stencilRefFront = ref;\n\t\t\tthis.stencilMaskFront = mask;\n\t\t}\n\t}\n\tsetStencilFuncBack(func, ref, mask) {\n\t\tif (this.stencilFuncBack !== func || this.stencilRefBack !== ref || this.stencilMaskBack !== mask) {\n\t\t\tconst gl = this.gl;\n\t\t\tgl.stencilFuncSeparate(gl.BACK, this.glComparison[func], ref, mask);\n\t\t\tthis.stencilFuncBack = func;\n\t\t\tthis.stencilRefBack = ref;\n\t\t\tthis.stencilMaskBack = mask;\n\t\t}\n\t}\n\tsetStencilOperation(fail, zfail, zpass, writeMask) {\n\t\tif (this.stencilFailFront !== fail || this.stencilZfailFront !== zfail || this.stencilZpassFront !== zpass || this.stencilFailBack !== fail || this.stencilZfailBack !== zfail || this.stencilZpassBack !== zpass) {\n\t\t\tthis.gl.stencilOp(this.glStencilOp[fail], this.glStencilOp[zfail], this.glStencilOp[zpass]);\n\t\t\tthis.stencilFailFront = this.stencilFailBack = fail;\n\t\t\tthis.stencilZfailFront = this.stencilZfailBack = zfail;\n\t\t\tthis.stencilZpassFront = this.stencilZpassBack = zpass;\n\t\t}\n\t\tif (this.stencilWriteMaskFront !== writeMask || this.stencilWriteMaskBack !== writeMask) {\n\t\t\tthis.gl.stencilMask(writeMask);\n\t\t\tthis.stencilWriteMaskFront = writeMask;\n\t\t\tthis.stencilWriteMaskBack = writeMask;\n\t\t}\n\t}\n\tsetStencilOperationFront(fail, zfail, zpass, writeMask) {\n\t\tif (this.stencilFailFront !== fail || this.stencilZfailFront !== zfail || this.stencilZpassFront !== zpass) {\n\t\t\tthis.gl.stencilOpSeparate(this.gl.FRONT, this.glStencilOp[fail], this.glStencilOp[zfail], this.glStencilOp[zpass]);\n\t\t\tthis.stencilFailFront = fail;\n\t\t\tthis.stencilZfailFront = zfail;\n\t\t\tthis.stencilZpassFront = zpass;\n\t\t}\n\t\tif (this.stencilWriteMaskFront !== writeMask) {\n\t\t\tthis.gl.stencilMaskSeparate(this.gl.FRONT, writeMask);\n\t\t\tthis.stencilWriteMaskFront = writeMask;\n\t\t}\n\t}\n\tsetStencilOperationBack(fail, zfail, zpass, writeMask) {\n\t\tif (this.stencilFailBack !== fail || this.stencilZfailBack !== zfail || this.stencilZpassBack !== zpass) {\n\t\t\tthis.gl.stencilOpSeparate(this.gl.BACK, this.glStencilOp[fail], this.glStencilOp[zfail], this.glStencilOp[zpass]);\n\t\t\tthis.stencilFailBack = fail;\n\t\t\tthis.stencilZfailBack = zfail;\n\t\t\tthis.stencilZpassBack = zpass;\n\t\t}\n\t\tif (this.stencilWriteMaskBack !== writeMask) {\n\t\t\tthis.gl.stencilMaskSeparate(this.gl.BACK, writeMask);\n\t\t\tthis.stencilWriteMaskBack = writeMask;\n\t\t}\n\t}\n\tsetBlendState(blendState) {\n\t\tconst currentBlendState = this.blendState;\n\t\tif (!currentBlendState.equals(blendState)) {\n\t\t\tconst gl = this.gl;\n\t\t\tconst {\n\t\t\t\tblend,\n\t\t\t\tcolorOp,\n\t\t\t\talphaOp,\n\t\t\t\tcolorSrcFactor,\n\t\t\t\tcolorDstFactor,\n\t\t\t\talphaSrcFactor,\n\t\t\t\talphaDstFactor\n\t\t\t} = blendState;\n\t\t\tif (currentBlendState.blend !== blend) {\n\t\t\t\tif (blend) {\n\t\t\t\t\tgl.enable(gl.BLEND);\n\t\t\t\t} else {\n\t\t\t\t\tgl.disable(gl.BLEND);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (currentBlendState.colorOp !== colorOp || currentBlendState.alphaOp !== alphaOp) {\n\t\t\t\tconst glBlendEquation = this.glBlendEquation;\n\t\t\t\tgl.blendEquationSeparate(glBlendEquation[colorOp], glBlendEquation[alphaOp]);\n\t\t\t}\n\t\t\tif (currentBlendState.colorSrcFactor !== colorSrcFactor || currentBlendState.colorDstFactor !== colorDstFactor || currentBlendState.alphaSrcFactor !== alphaSrcFactor || currentBlendState.alphaDstFactor !== alphaDstFactor) {\n\t\t\t\tgl.blendFuncSeparate(this.glBlendFunctionColor[colorSrcFactor], this.glBlendFunctionColor[colorDstFactor], this.glBlendFunctionAlpha[alphaSrcFactor], this.glBlendFunctionAlpha[alphaDstFactor]);\n\t\t\t}\n\t\t\tif (currentBlendState.allWrite !== blendState.allWrite) {\n\t\t\t\tthis.gl.colorMask(blendState.redWrite, blendState.greenWrite, blendState.blueWrite, blendState.alphaWrite);\n\t\t\t}\n\t\t\tcurrentBlendState.copy(blendState);\n\t\t}\n\t}\n\tsetBlendColor(r, g, b, a) {\n\t\tconst c = this.blendColor;\n\t\tif (r !== c.r || g !== c.g || b !== c.b || a !== c.a) {\n\t\t\tthis.gl.blendColor(r, g, b, a);\n\t\t\tc.set(r, g, b, a);\n\t\t}\n\t}\n\tsetStencilState(stencilFront, stencilBack) {\n\t\tif (stencilFront || stencilBack) {\n\t\t\tthis.setStencilTest(true);\n\t\t\tif (stencilFront === stencilBack) {\n\t\t\t\tthis.setStencilFunc(stencilFront.func, stencilFront.ref, stencilFront.readMask);\n\t\t\t\tthis.setStencilOperation(stencilFront.fail, stencilFront.zfail, stencilFront.zpass, stencilFront.writeMask);\n\t\t\t} else {\n\t\t\t\tvar _stencilFront, _stencilBack;\n\t\t\t\t(_stencilFront = stencilFront) != null ? _stencilFront : stencilFront = StencilParameters.DEFAULT;\n\t\t\t\tthis.setStencilFuncFront(stencilFront.func, stencilFront.ref, stencilFront.readMask);\n\t\t\t\tthis.setStencilOperationFront(stencilFront.fail, stencilFront.zfail, stencilFront.zpass, stencilFront.writeMask);\n\t\t\t\t(_stencilBack = stencilBack) != null ? _stencilBack : stencilBack = StencilParameters.DEFAULT;\n\t\t\t\tthis.setStencilFuncBack(stencilBack.func, stencilBack.ref, stencilBack.readMask);\n\t\t\t\tthis.setStencilOperationBack(stencilBack.fail, stencilBack.zfail, stencilBack.zpass, stencilBack.writeMask);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.setStencilTest(false);\n\t\t}\n\t}\n\tsetDepthState(depthState) {\n\t\tconst currentDepthState = this.depthState;\n\t\tif (!currentDepthState.equals(depthState)) {\n\t\t\tconst gl = this.gl;\n\t\t\tconst write = depthState.write;\n\t\t\tif (currentDepthState.write !== write) {\n\t\t\t\tgl.depthMask(write);\n\t\t\t}\n\t\t\tlet {\n\t\t\t\tfunc,\n\t\t\t\ttest\n\t\t\t} = depthState;\n\t\t\tif (!test && write) {\n\t\t\t\ttest = true;\n\t\t\t\tfunc = FUNC_ALWAYS;\n\t\t\t}\n\t\t\tif (currentDepthState.func !== func) {\n\t\t\t\tgl.depthFunc(this.glComparison[func]);\n\t\t\t}\n\t\t\tif (currentDepthState.test !== test) {\n\t\t\t\tif (test) {\n\t\t\t\t\tgl.enable(gl.DEPTH_TEST);\n\t\t\t\t} else {\n\t\t\t\t\tgl.disable(gl.DEPTH_TEST);\n\t\t\t\t}\n\t\t\t}\n\t\t\tcurrentDepthState.copy(depthState);\n\t\t}\n\t}\n\tsetCullMode(cullMode) {\n\t\tif (this.cullMode !== cullMode) {\n\t\t\tif (cullMode === CULLFACE_NONE) {\n\t\t\t\tthis.gl.disable(this.gl.CULL_FACE);\n\t\t\t} else {\n\t\t\t\tif (this.cullMode === CULLFACE_NONE) {\n\t\t\t\t\tthis.gl.enable(this.gl.CULL_FACE);\n\t\t\t\t}\n\t\t\t\tconst mode = this.glCull[cullMode];\n\t\t\t\tif (this.cullFace !== mode) {\n\t\t\t\t\tthis.gl.cullFace(mode);\n\t\t\t\t\tthis.cullFace = mode;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.cullMode = cullMode;\n\t\t}\n\t}\n\tsetShader(shader) {\n\t\tif (shader !== this.shader) {\n\t\t\tif (shader.failed) {\n\t\t\t\treturn false;\n\t\t\t} else if (!shader.ready && !shader.impl.finalize(this, shader)) {\n\t\t\t\tshader.failed = true;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.shader = shader;\n\t\t\tthis.gl.useProgram(shader.impl.glProgram);\n\t\t\tthis.attributesInvalidated = true;\n\t\t}\n\t\treturn true;\n\t}\n\tclearVertexArrayObjectCache() {\n\t\tconst gl = this.gl;\n\t\tthis._vaoMap.forEach((item, key, mapObj) => {\n\t\t\tgl.deleteVertexArray(item);\n\t\t});\n\t\tthis._vaoMap.clear();\n\t}\n\tset fullscreen(fullscreen) {\n\t\tif (fullscreen) {\n\t\t\tconst canvas = this.gl.canvas;\n\t\t\tcanvas.requestFullscreen();\n\t\t} else {\n\t\t\tdocument.exitFullscreen();\n\t\t}\n\t}\n\tget fullscreen() {\n\t\treturn !!document.fullscreenElement;\n\t}\n\tget textureFloatHighPrecision() {\n\t\tif (this._textureFloatHighPrecision === undefined) {\n\t\t\tthis._textureFloatHighPrecision = testTextureFloatHighPrecision(this);\n\t\t}\n\t\treturn this._textureFloatHighPrecision;\n\t}\n\tget textureHalfFloatUpdatable() {\n\t\tif (this._textureHalfFloatUpdatable === undefined) {\n\t\t\tif (this.isWebGL2) {\n\t\t\t\tthis._textureHalfFloatUpdatable = true;\n\t\t\t} else {\n\t\t\t\tthis._textureHalfFloatUpdatable = testTextureHalfFloatUpdatable(this.gl, this.extTextureHalfFloat.HALF_FLOAT_OES);\n\t\t\t}\n\t\t}\n\t\treturn this._textureHalfFloatUpdatable;\n\t}\n}\n\nexport { WebglGraphicsDevice };\n","import '../../core/tracing.js';\nimport { typedArrayIndexFormatsByteSize, BUFFER_STATIC, INDEXFORMAT_UINT32, INDEXFORMAT_UINT16 } from './constants.js';\n\nlet id = 0;\nclass IndexBuffer {\n\tconstructor(graphicsDevice, format, numIndices, usage = BUFFER_STATIC, initialData) {\n\t\tthis.device = graphicsDevice;\n\t\tthis.format = format;\n\t\tthis.numIndices = numIndices;\n\t\tthis.usage = usage;\n\t\tthis.id = id++;\n\t\tthis.impl = graphicsDevice.createIndexBufferImpl(this);\n\t\tconst bytesPerIndex = typedArrayIndexFormatsByteSize[format];\n\t\tthis.bytesPerIndex = bytesPerIndex;\n\t\tthis.numBytes = this.numIndices * bytesPerIndex;\n\t\tif (initialData) {\n\t\t\tthis.setData(initialData);\n\t\t} else {\n\t\t\tthis.storage = new ArrayBuffer(this.numBytes);\n\t\t}\n\t\tthis.adjustVramSizeTracking(graphicsDevice._vram, this.numBytes);\n\t\tthis.device.buffers.push(this);\n\t}\n\tdestroy() {\n\t\tconst device = this.device;\n\t\tconst idx = device.buffers.indexOf(this);\n\t\tif (idx !== -1) {\n\t\t\tdevice.buffers.splice(idx, 1);\n\t\t}\n\t\tif (this.device.indexBuffer === this) {\n\t\t\tthis.device.indexBuffer = null;\n\t\t}\n\t\tif (this.impl.initialized) {\n\t\t\tthis.impl.destroy(device);\n\t\t\tthis.adjustVramSizeTracking(device._vram, -this.storage.byteLength);\n\t\t}\n\t}\n\tadjustVramSizeTracking(vram, size) {\n\t\tvram.ib += size;\n\t}\n\tloseContext() {\n\t\tthis.impl.loseContext();\n\t}\n\tgetFormat() {\n\t\treturn this.format;\n\t}\n\tgetNumIndices() {\n\t\treturn this.numIndices;\n\t}\n\tlock() {\n\t\treturn this.storage;\n\t}\n\tunlock() {\n\t\tthis.impl.unlock(this);\n\t}\n\tsetData(data) {\n\t\tif (data.byteLength !== this.numBytes) {\n\t\t\treturn false;\n\t\t}\n\t\tthis.storage = data;\n\t\tthis.unlock();\n\t\treturn true;\n\t}\n\t_lockTypedArray() {\n\t\tconst lock = this.lock();\n\t\tconst indices = this.format === INDEXFORMAT_UINT32 ? new Uint32Array(lock) : this.format === INDEXFORMAT_UINT16 ? new Uint16Array(lock) : new Uint8Array(lock);\n\t\treturn indices;\n\t}\n\twriteData(data, count) {\n\t\tconst indices = this._lockTypedArray();\n\t\tif (data.length > count) {\n\t\t\tif (ArrayBuffer.isView(data)) {\n\t\t\t\tdata = data.subarray(0, count);\n\t\t\t\tindices.set(data);\n\t\t\t} else {\n\t\t\t\tfor (let i = 0; i < count; i++) indices[i] = data[i];\n\t\t\t}\n\t\t} else {\n\t\t\tindices.set(data);\n\t\t}\n\t\tthis.unlock();\n\t}\n\treadData(data) {\n\t\tconst indices = this._lockTypedArray();\n\t\tconst count = this.numIndices;\n\t\tif (ArrayBuffer.isView(data)) {\n\t\t\tdata.set(indices);\n\t\t} else {\n\t\t\tdata.length = 0;\n\t\t\tfor (let i = 0; i < count; i++) data[i] = indices[i];\n\t\t}\n\t\treturn count;\n\t}\n}\n\nexport { IndexBuffer };\n","import '../../core/tracing.js';\nimport { Color } from '../../core/math/color.js';\n\nclass ColorAttachmentOps {\n\tconstructor() {\n\t\tthis.clearValue = new Color(0, 0, 0, 1);\n\t\tthis.clear = false;\n\t\tthis.store = false;\n\t\tthis.resolve = true;\n\t\tthis.mipmaps = false;\n\t}\n}\nclass DepthStencilAttachmentOps {\n\tconstructor() {\n\t\tthis.clearDepthValue = 1;\n\t\tthis.clearStencilValue = 0;\n\t\tthis.clearDepth = false;\n\t\tthis.clearStencil = false;\n\t\tthis.storeDepth = false;\n\t\tthis.storeStencil = false;\n\t}\n}\nclass RenderPass {\n\tget colorOps() {\n\t\treturn this.colorArrayOps[0];\n\t}\n\tconstructor(graphicsDevice) {\n\t\tthis.name = '';\n\t\tthis.enabled = true;\n\t\tthis.executeEnabled = true;\n\t\tthis.renderTarget = void 0;\n\t\tthis.options = void 0;\n\t\tthis.samples = 0;\n\t\tthis.colorArrayOps = [];\n\t\tthis.depthStencilOps = void 0;\n\t\tthis.requiresCubemaps = true;\n\t\tthis.fullSizeClearRect = true;\n\t\tthis.beforePasses = [];\n\t\tthis.afterPasses = [];\n\t\tthis.device = graphicsDevice;\n\t}\n\tinit(renderTarget = null, options = null) {\n\t\tvar _renderTarget$_colorB;\n\t\tthis.options = options;\n\t\tif (options) {\n\t\t\tvar _this$options$scaleX, _this$options$scaleY;\n\t\t\tthis.options.scaleX = (_this$options$scaleX = this.options.scaleX) != null ? _this$options$scaleX : 1;\n\t\t\tthis.options.scaleY = (_this$options$scaleY = this.options.scaleY) != null ? _this$options$scaleY : 1;\n\t\t}\n\t\tthis.renderTarget = renderTarget;\n\t\tthis.samples = Math.max(this.renderTarget ? this.renderTarget.samples : this.device.samples, 1);\n\t\tthis.depthStencilOps = new DepthStencilAttachmentOps();\n\t\tconst numColorOps = renderTarget ? (_renderTarget$_colorB = renderTarget._colorBuffers) == null ? void 0 : _renderTarget$_colorB.length : 1;\n\t\tfor (let i = 0; i < numColorOps; i++) {\n\t\t\tvar _this$renderTarget;\n\t\t\tconst colorOps = new ColorAttachmentOps();\n\t\t\tthis.colorArrayOps[i] = colorOps;\n\t\t\tif (this.samples === 1) {\n\t\t\t\tcolorOps.store = true;\n\t\t\t\tcolorOps.resolve = false;\n\t\t\t}\n\t\t\tif ((_this$renderTarget = this.renderTarget) != null && (_this$renderTarget = _this$renderTarget._colorBuffers) != null && _this$renderTarget[i].mipmaps) {\n\t\t\t\tcolorOps.mipmaps = true;\n\t\t\t}\n\t\t}\n\t\tthis.postInit();\n\t}\n\tdestroy() {}\n\tpostInit() {}\n\tframeUpdate() {\n\t\tif (this.options && this.renderTarget) {\n\t\t\tvar _this$options$resizeS;\n\t\t\tconst resizeSource = (_this$options$resizeS = this.options.resizeSource) != null ? _this$options$resizeS : this.device.backBuffer;\n\t\t\tconst width = Math.floor(resizeSource.width * this.options.scaleX);\n\t\t\tconst height = Math.floor(resizeSource.height * this.options.scaleY);\n\t\t\tthis.renderTarget.resize(width, height);\n\t\t}\n\t}\n\tbefore() {}\n\texecute() {}\n\tafter() {}\n\tsetClearColor(color) {\n\t\tconst count = this.colorArrayOps.length;\n\t\tfor (let i = 0; i < count; i++) {\n\t\t\tconst colorOps = this.colorArrayOps[i];\n\t\t\tcolorOps.clearValue.copy(color);\n\t\t\tcolorOps.clear = true;\n\t\t}\n\t}\n\tsetClearDepth(depthValue) {\n\t\tthis.depthStencilOps.clearDepthValue = depthValue;\n\t\tthis.depthStencilOps.clearDepth = true;\n\t}\n\tsetClearStencil(stencilValue) {\n\t\tthis.depthStencilOps.clearStencilValue = stencilValue;\n\t\tthis.depthStencilOps.clearStencil = true;\n\t}\n\trender() {\n\t\tif (this.enabled) {\n\t\t\tconst device = this.device;\n\t\t\tconst realPass = this.renderTarget !== undefined;\n\t\t\tthis.before();\n\t\t\tif (this.executeEnabled) {\n\t\t\t\tif (realPass) {\n\t\t\t\t\tdevice.startRenderPass(this);\n\t\t\t\t}\n\t\t\t\tthis.execute();\n\t\t\t\tif (realPass) {\n\t\t\t\t\tdevice.endRenderPass(this);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.after();\n\t\t\tdevice.renderPassIndex++;\n\t\t}\n\t}\n}\n\nexport { ColorAttachmentOps, DepthStencilAttachmentOps, RenderPass };\n","import '../../core/tracing.js';\nimport { typedArrayTypes } from './constants.js';\n\nfunction set1(a) {\n\tthis.array[this.index] = a;\n}\nfunction set2(a, b) {\n\tthis.array[this.index] = a;\n\tthis.array[this.index + 1] = b;\n}\nfunction set3(a, b, c) {\n\tthis.array[this.index] = a;\n\tthis.array[this.index + 1] = b;\n\tthis.array[this.index + 2] = c;\n}\nfunction set4(a, b, c, d) {\n\tthis.array[this.index] = a;\n\tthis.array[this.index + 1] = b;\n\tthis.array[this.index + 2] = c;\n\tthis.array[this.index + 3] = d;\n}\nfunction arraySet1(index, inputArray, inputIndex) {\n\tthis.array[index] = inputArray[inputIndex];\n}\nfunction arraySet2(index, inputArray, inputIndex) {\n\tthis.array[index] = inputArray[inputIndex];\n\tthis.array[index + 1] = inputArray[inputIndex + 1];\n}\nfunction arraySet3(index, inputArray, inputIndex) {\n\tthis.array[index] = inputArray[inputIndex];\n\tthis.array[index + 1] = inputArray[inputIndex + 1];\n\tthis.array[index + 2] = inputArray[inputIndex + 2];\n}\nfunction arraySet4(index, inputArray, inputIndex) {\n\tthis.array[index] = inputArray[inputIndex];\n\tthis.array[index + 1] = inputArray[inputIndex + 1];\n\tthis.array[index + 2] = inputArray[inputIndex + 2];\n\tthis.array[index + 3] = inputArray[inputIndex + 3];\n}\nfunction arrayGet1(offset, outputArray, outputIndex) {\n\toutputArray[outputIndex] = this.array[offset];\n}\nfunction arrayGet2(offset, outputArray, outputIndex) {\n\toutputArray[outputIndex] = this.array[offset];\n\toutputArray[outputIndex + 1] = this.array[offset + 1];\n}\nfunction arrayGet3(offset, outputArray, outputIndex) {\n\toutputArray[outputIndex] = this.array[offset];\n\toutputArray[outputIndex + 1] = this.array[offset + 1];\n\toutputArray[outputIndex + 2] = this.array[offset + 2];\n}\nfunction arrayGet4(offset, outputArray, outputIndex) {\n\toutputArray[outputIndex] = this.array[offset];\n\toutputArray[outputIndex + 1] = this.array[offset + 1];\n\toutputArray[outputIndex + 2] = this.array[offset + 2];\n\toutputArray[outputIndex + 3] = this.array[offset + 3];\n}\nclass VertexIteratorAccessor {\n\tconstructor(buffer, vertexElement, vertexFormat) {\n\t\tthis.index = 0;\n\t\tthis.numComponents = vertexElement.numComponents;\n\t\tif (vertexFormat.interleaved) {\n\t\t\tthis.array = new typedArrayTypes[vertexElement.dataType](buffer, vertexElement.offset);\n\t\t} else {\n\t\t\tthis.array = new typedArrayTypes[vertexElement.dataType](buffer, vertexElement.offset, vertexFormat.vertexCount * vertexElement.numComponents);\n\t\t}\n\t\tthis.stride = vertexElement.stride / this.array.constructor.BYTES_PER_ELEMENT;\n\t\tswitch (vertexElement.numComponents) {\n\t\t\tcase 1:\n\t\t\t\tthis.set = set1;\n\t\t\t\tthis.getToArray = arrayGet1;\n\t\t\t\tthis.setFromArray = arraySet1;\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tthis.set = set2;\n\t\t\t\tthis.getToArray = arrayGet2;\n\t\t\t\tthis.setFromArray = arraySet2;\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\t\tthis.set = set3;\n\t\t\t\tthis.getToArray = arrayGet3;\n\t\t\t\tthis.setFromArray = arraySet3;\n\t\t\t\tbreak;\n\t\t\tcase 4:\n\t\t\t\tthis.set = set4;\n\t\t\t\tthis.getToArray = arrayGet4;\n\t\t\t\tthis.setFromArray = arraySet4;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\tget(offset) {\n\t\treturn this.array[this.index + offset];\n\t}\n\tset(a, b, c, d) {}\n\tgetToArray(offset, outputArray, outputIndex) {}\n\tsetFromArray(index, inputArray, inputIndex) {}\n}\nclass VertexIterator {\n\tconstructor(vertexBuffer) {\n\t\tthis.vertexBuffer = vertexBuffer;\n\t\tthis.vertexFormatSize = vertexBuffer.getFormat().size;\n\t\tthis.buffer = this.vertexBuffer.lock();\n\t\tthis.accessors = [];\n\t\tthis.element = {};\n\t\tconst vertexFormat = this.vertexBuffer.getFormat();\n\t\tfor (let i = 0; i < vertexFormat.elements.length; i++) {\n\t\t\tconst vertexElement = vertexFormat.elements[i];\n\t\t\tthis.accessors[i] = new VertexIteratorAccessor(this.buffer, vertexElement, vertexFormat);\n\t\t\tthis.element[vertexElement.name] = this.accessors[i];\n\t\t}\n\t}\n\tnext(count = 1) {\n\t\tlet i = 0;\n\t\tconst accessors = this.accessors;\n\t\tconst numAccessors = this.accessors.length;\n\t\twhile (i < numAccessors) {\n\t\t\tconst accessor = accessors[i++];\n\t\t\taccessor.index += count * accessor.stride;\n\t\t}\n\t}\n\tend() {\n\t\tthis.vertexBuffer.unlock();\n\t}\n\twriteData(semantic, data, numVertices) {\n\t\tconst element = this.element[semantic];\n\t\tif (element) {\n\t\t\tif (numVertices > this.vertexBuffer.numVertices) {\n\t\t\t\tnumVertices = this.vertexBuffer.numVertices;\n\t\t\t}\n\t\t\tconst numComponents = element.numComponents;\n\t\t\tif (this.vertexBuffer.getFormat().interleaved) {\n\t\t\t\tlet index = 0;\n\t\t\t\tfor (let i = 0; i < numVertices; i++) {\n\t\t\t\t\telement.setFromArray(index, data, i * numComponents);\n\t\t\t\t\tindex += element.stride;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (data.length > numVertices * numComponents) {\n\t\t\t\t\tconst copyCount = numVertices * numComponents;\n\t\t\t\t\tif (ArrayBuffer.isView(data)) {\n\t\t\t\t\t\tdata = data.subarray(0, copyCount);\n\t\t\t\t\t\telement.array.set(data);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfor (let i = 0; i < copyCount; i++) element.array[i] = data[i];\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\telement.array.set(data);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treadData(semantic, data) {\n\t\tconst element = this.element[semantic];\n\t\tlet count = 0;\n\t\tif (element) {\n\t\t\tcount = this.vertexBuffer.numVertices;\n\t\t\tlet i;\n\t\t\tconst numComponents = element.numComponents;\n\t\t\tif (this.vertexBuffer.getFormat().interleaved) {\n\t\t\t\tif (Array.isArray(data)) data.length = 0;\n\t\t\t\telement.index = 0;\n\t\t\t\tlet offset = 0;\n\t\t\t\tfor (i = 0; i < count; i++) {\n\t\t\t\t\telement.getToArray(offset, data, i * numComponents);\n\t\t\t\t\toffset += element.stride;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (ArrayBuffer.isView(data)) {\n\t\t\t\t\tdata.set(element.array);\n\t\t\t\t} else {\n\t\t\t\t\tdata.length = 0;\n\t\t\t\t\tconst copyCount = count * numComponents;\n\t\t\t\t\tfor (i = 0; i < copyCount; i++) data[i] = element.array[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn count;\n\t}\n}\n\nexport { VertexIterator, VertexIteratorAccessor };\n","const ACTION_MOUSE = 'mouse';\nconst ACTION_KEYBOARD = 'keyboard';\nconst ACTION_GAMEPAD = 'gamepad';\nconst AXIS_MOUSE_X = 'mousex';\nconst AXIS_MOUSE_Y = 'mousey';\nconst AXIS_PAD_L_X = 'padlx';\nconst AXIS_PAD_L_Y = 'padly';\nconst AXIS_PAD_R_X = 'padrx';\nconst AXIS_PAD_R_Y = 'padry';\nconst AXIS_KEY = 'key';\nconst EVENT_KEYDOWN = 'keydown';\nconst EVENT_KEYUP = 'keyup';\nconst EVENT_MOUSEDOWN = 'mousedown';\nconst EVENT_MOUSEMOVE = 'mousemove';\nconst EVENT_MOUSEUP = 'mouseup';\nconst EVENT_MOUSEWHEEL = 'mousewheel';\nconst EVENT_TOUCHSTART = 'touchstart';\nconst EVENT_TOUCHEND = 'touchend';\nconst EVENT_TOUCHMOVE = 'touchmove';\nconst EVENT_TOUCHCANCEL = 'touchcancel';\nconst EVENT_SELECT = 'select';\nconst EVENT_SELECTSTART = 'selectstart';\nconst EVENT_SELECTEND = 'selectend';\nconst KEY_BACKSPACE = 8;\nconst KEY_TAB = 9;\nconst KEY_RETURN = 13;\nconst KEY_ENTER = 13;\nconst KEY_SHIFT = 16;\nconst KEY_CONTROL = 17;\nconst KEY_ALT = 18;\nconst KEY_PAUSE = 19;\nconst KEY_CAPS_LOCK = 20;\nconst KEY_ESCAPE = 27;\nconst KEY_SPACE = 32;\nconst KEY_PAGE_UP = 33;\nconst KEY_PAGE_DOWN = 34;\nconst KEY_END = 35;\nconst KEY_HOME = 36;\nconst KEY_LEFT = 37;\nconst KEY_UP = 38;\nconst KEY_RIGHT = 39;\nconst KEY_DOWN = 40;\nconst KEY_PRINT_SCREEN = 44;\nconst KEY_INSERT = 45;\nconst KEY_DELETE = 46;\nconst KEY_0 = 48;\nconst KEY_1 = 49;\nconst KEY_2 = 50;\nconst KEY_3 = 51;\nconst KEY_4 = 52;\nconst KEY_5 = 53;\nconst KEY_6 = 54;\nconst KEY_7 = 55;\nconst KEY_8 = 56;\nconst KEY_9 = 57;\nconst KEY_SEMICOLON = 59;\nconst KEY_EQUAL = 61;\nconst KEY_A = 65;\nconst KEY_B = 66;\nconst KEY_C = 67;\nconst KEY_D = 68;\nconst KEY_E = 69;\nconst KEY_F = 70;\nconst KEY_G = 71;\nconst KEY_H = 72;\nconst KEY_I = 73;\nconst KEY_J = 74;\nconst KEY_K = 75;\nconst KEY_L = 76;\nconst KEY_M = 77;\nconst KEY_N = 78;\nconst KEY_O = 79;\nconst KEY_P = 80;\nconst KEY_Q = 81;\nconst KEY_R = 82;\nconst KEY_S = 83;\nconst KEY_T = 84;\nconst KEY_U = 85;\nconst KEY_V = 86;\nconst KEY_W = 87;\nconst KEY_X = 88;\nconst KEY_Y = 89;\nconst KEY_Z = 90;\nconst KEY_WINDOWS = 91;\nconst KEY_CONTEXT_MENU = 93;\nconst KEY_NUMPAD_0 = 96;\nconst KEY_NUMPAD_1 = 97;\nconst KEY_NUMPAD_2 = 98;\nconst KEY_NUMPAD_3 = 99;\nconst KEY_NUMPAD_4 = 100;\nconst KEY_NUMPAD_5 = 101;\nconst KEY_NUMPAD_6 = 102;\nconst KEY_NUMPAD_7 = 103;\nconst KEY_NUMPAD_8 = 104;\nconst KEY_NUMPAD_9 = 105;\nconst KEY_MULTIPLY = 106;\nconst KEY_ADD = 107;\nconst KEY_SEPARATOR = 108;\nconst KEY_SUBTRACT = 109;\nconst KEY_DECIMAL = 110;\nconst KEY_DIVIDE = 111;\nconst KEY_F1 = 112;\nconst KEY_F2 = 113;\nconst KEY_F3 = 114;\nconst KEY_F4 = 115;\nconst KEY_F5 = 116;\nconst KEY_F6 = 117;\nconst KEY_F7 = 118;\nconst KEY_F8 = 119;\nconst KEY_F9 = 120;\nconst KEY_F10 = 121;\nconst KEY_F11 = 122;\nconst KEY_F12 = 123;\nconst KEY_COMMA = 188;\nconst KEY_PERIOD = 190;\nconst KEY_SLASH = 191;\nconst KEY_OPEN_BRACKET = 219;\nconst KEY_BACK_SLASH = 220;\nconst KEY_CLOSE_BRACKET = 221;\nconst KEY_META = 224;\nconst MOUSEBUTTON_NONE = -1;\nconst MOUSEBUTTON_LEFT = 0;\nconst MOUSEBUTTON_MIDDLE = 1;\nconst MOUSEBUTTON_RIGHT = 2;\nconst PAD_1 = 0;\nconst PAD_2 = 1;\nconst PAD_3 = 2;\nconst PAD_4 = 3;\nconst PAD_FACE_1 = 0;\nconst PAD_FACE_2 = 1;\nconst PAD_FACE_3 = 2;\nconst PAD_FACE_4 = 3;\nconst PAD_L_SHOULDER_1 = 4;\nconst PAD_R_SHOULDER_1 = 5;\nconst PAD_L_SHOULDER_2 = 6;\nconst PAD_R_SHOULDER_2 = 7;\nconst PAD_SELECT = 8;\nconst PAD_START = 9;\nconst PAD_L_STICK_BUTTON = 10;\nconst PAD_R_STICK_BUTTON = 11;\nconst PAD_UP = 12;\nconst PAD_DOWN = 13;\nconst PAD_LEFT = 14;\nconst PAD_RIGHT = 15;\nconst PAD_VENDOR = 16;\nconst PAD_L_STICK_X = 0;\nconst PAD_L_STICK_Y = 1;\nconst PAD_R_STICK_X = 2;\nconst PAD_R_STICK_Y = 3;\nconst EVENT_GAMEPADCONNECTED = 'gamepadconnected';\nconst EVENT_GAMEPADDISCONNECTED = 'gamepaddisconnected';\nconst XRPAD_TOUCHPAD_X = 0;\nconst XRPAD_TOUCHPAD_Y = 1;\nconst XRPAD_STICK_X = 2;\nconst XRPAD_STICK_Y = 3;\nconst XRPAD_TOUCHPAD_BUTTON = 2;\nconst XRPAD_TRIGGER = 0;\nconst XRPAD_SQUEEZE = 1;\nconst XRPAD_STICK_BUTTON = 3;\nconst XRPAD_A = 4;\nconst XRPAD_B = 5;\n\nexport { ACTION_GAMEPAD, ACTION_KEYBOARD, ACTION_MOUSE, AXIS_KEY, AXIS_MOUSE_X, AXIS_MOUSE_Y, AXIS_PAD_L_X, AXIS_PAD_L_Y, AXIS_PAD_R_X, AXIS_PAD_R_Y, EVENT_GAMEPADCONNECTED, EVENT_GAMEPADDISCONNECTED, EVENT_KEYDOWN, EVENT_KEYUP, EVENT_MOUSEDOWN, EVENT_MOUSEMOVE, EVENT_MOUSEUP, EVENT_MOUSEWHEEL, EVENT_SELECT, EVENT_SELECTEND, EVENT_SELECTSTART, EVENT_TOUCHCANCEL, EVENT_TOUCHEND, EVENT_TOUCHMOVE, EVENT_TOUCHSTART, KEY_0, KEY_1, KEY_2, KEY_3, KEY_4, KEY_5, KEY_6, KEY_7, KEY_8, KEY_9, KEY_A, KEY_ADD, KEY_ALT, KEY_B, KEY_BACKSPACE, KEY_BACK_SLASH, KEY_C, KEY_CAPS_LOCK, KEY_CLOSE_BRACKET, KEY_COMMA, KEY_CONTEXT_MENU, KEY_CONTROL, KEY_D, KEY_DECIMAL, KEY_DELETE, KEY_DIVIDE, KEY_DOWN, KEY_E, KEY_END, KEY_ENTER, KEY_EQUAL, KEY_ESCAPE, KEY_F, KEY_F1, KEY_F10, KEY_F11, KEY_F12, KEY_F2, KEY_F3, KEY_F4, KEY_F5, KEY_F6, KEY_F7, KEY_F8, KEY_F9, KEY_G, KEY_H, KEY_HOME, KEY_I, KEY_INSERT, KEY_J, KEY_K, KEY_L, KEY_LEFT, KEY_M, KEY_META, KEY_MULTIPLY, KEY_N, KEY_NUMPAD_0, KEY_NUMPAD_1, KEY_NUMPAD_2, KEY_NUMPAD_3, KEY_NUMPAD_4, KEY_NUMPAD_5, KEY_NUMPAD_6, KEY_NUMPAD_7, KEY_NUMPAD_8, KEY_NUMPAD_9, KEY_O, KEY_OPEN_BRACKET, KEY_P, KEY_PAGE_DOWN, KEY_PAGE_UP, KEY_PAUSE, KEY_PERIOD, KEY_PRINT_SCREEN, KEY_Q, KEY_R, KEY_RETURN, KEY_RIGHT, KEY_S, KEY_SEMICOLON, KEY_SEPARATOR, KEY_SHIFT, KEY_SLASH, KEY_SPACE, KEY_SUBTRACT, KEY_T, KEY_TAB, KEY_U, KEY_UP, KEY_V, KEY_W, KEY_WINDOWS, KEY_X, KEY_Y, KEY_Z, MOUSEBUTTON_LEFT, MOUSEBUTTON_MIDDLE, MOUSEBUTTON_NONE, MOUSEBUTTON_RIGHT, PAD_1, PAD_2, PAD_3, PAD_4, PAD_DOWN, PAD_FACE_1, PAD_FACE_2, PAD_FACE_3, PAD_FACE_4, PAD_LEFT, PAD_L_SHOULDER_1, PAD_L_SHOULDER_2, PAD_L_STICK_BUTTON, PAD_L_STICK_X, PAD_L_STICK_Y, PAD_RIGHT, PAD_R_SHOULDER_1, PAD_R_SHOULDER_2, PAD_R_STICK_BUTTON, PAD_R_STICK_X, PAD_R_STICK_Y, PAD_SELECT, PAD_START, PAD_UP, PAD_VENDOR, XRPAD_A, XRPAD_B, XRPAD_SQUEEZE, XRPAD_STICK_BUTTON, XRPAD_STICK_X, XRPAD_STICK_Y, XRPAD_TOUCHPAD_BUTTON, XRPAD_TOUCHPAD_X, XRPAD_TOUCHPAD_Y, XRPAD_TRIGGER };\n","import { extend } from '../../core/core.js';\nimport { now } from '../../core/time.js';\nimport { path } from '../../core/path.js';\nimport { URI } from '../../core/uri.js';\nimport { math } from '../../core/math/math.js';\n\nclass Http {\n\tget(url, options, callback) {\n\t\tif (typeof options === 'function') {\n\t\t\tcallback = options;\n\t\t\toptions = {};\n\t\t}\n\t\treturn this.request('GET', url, options, callback);\n\t}\n\tpost(url, data, options, callback) {\n\t\tif (typeof options === 'function') {\n\t\t\tcallback = options;\n\t\t\toptions = {};\n\t\t}\n\t\toptions.postdata = data;\n\t\treturn this.request('POST', url, options, callback);\n\t}\n\tput(url, data, options, callback) {\n\t\tif (typeof options === 'function') {\n\t\t\tcallback = options;\n\t\t\toptions = {};\n\t\t}\n\t\toptions.postdata = data;\n\t\treturn this.request('PUT', url, options, callback);\n\t}\n\tdel(url, options, callback) {\n\t\tif (typeof options === 'function') {\n\t\t\tcallback = options;\n\t\t\toptions = {};\n\t\t}\n\t\treturn this.request('DELETE', url, options, callback);\n\t}\n\trequest(method, url, options, callback) {\n\t\tlet uri, query, postdata;\n\t\tlet errored = false;\n\t\tif (typeof options === 'function') {\n\t\t\tcallback = options;\n\t\t\toptions = {};\n\t\t}\n\t\tif (options.retry) {\n\t\t\toptions = Object.assign({\n\t\t\t\tretries: 0,\n\t\t\t\tmaxRetries: 5\n\t\t\t}, options);\n\t\t}\n\t\toptions.callback = callback;\n\t\tif (options.async == null) {\n\t\t\toptions.async = true;\n\t\t}\n\t\tif (options.headers == null) {\n\t\t\toptions.headers = {};\n\t\t}\n\t\tif (options.postdata != null) {\n\t\t\tif (options.postdata instanceof Document) {\n\t\t\t\tpostdata = options.postdata;\n\t\t\t} else if (options.postdata instanceof FormData) {\n\t\t\t\tpostdata = options.postdata;\n\t\t\t} else if (options.postdata instanceof Object) {\n\t\t\t\tlet contentType = options.headers['Content-Type'];\n\t\t\t\tif (contentType === undefined) {\n\t\t\t\t\toptions.headers['Content-Type'] = Http.ContentType.FORM_URLENCODED;\n\t\t\t\t\tcontentType = options.headers['Content-Type'];\n\t\t\t\t}\n\t\t\t\tswitch (contentType) {\n\t\t\t\t\tcase Http.ContentType.FORM_URLENCODED:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpostdata = '';\n\t\t\t\t\t\t\tlet bFirstItem = true;\n\t\t\t\t\t\t\tfor (const key in options.postdata) {\n\t\t\t\t\t\t\t\tif (options.postdata.hasOwnProperty(key)) {\n\t\t\t\t\t\t\t\t\tif (bFirstItem) {\n\t\t\t\t\t\t\t\t\t\tbFirstItem = false;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tpostdata += '&';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tconst encodedKey = encodeURIComponent(key);\n\t\t\t\t\t\t\t\t\tconst encodedValue = encodeURIComponent(options.postdata[key]);\n\t\t\t\t\t\t\t\t\tpostdata += `${encodedKey}=${encodedValue}`;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\tdefault:\n\t\t\t\t\tcase Http.ContentType.JSON:\n\t\t\t\t\t\tif (contentType == null) {\n\t\t\t\t\t\t\toptions.headers['Content-Type'] = Http.ContentType.JSON;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tpostdata = JSON.stringify(options.postdata);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tpostdata = options.postdata;\n\t\t\t}\n\t\t}\n\t\tif (options.cache === false) {\n\t\t\tconst timestamp = now();\n\t\t\turi = new URI(url);\n\t\t\tif (!uri.query) {\n\t\t\t\turi.query = 'ts=' + timestamp;\n\t\t\t} else {\n\t\t\t\turi.query = uri.query + '&ts=' + timestamp;\n\t\t\t}\n\t\t\turl = uri.toString();\n\t\t}\n\t\tif (options.query) {\n\t\t\turi = new URI(url);\n\t\t\tquery = extend(uri.getQuery(), options.query);\n\t\t\turi.setQuery(query);\n\t\t\turl = uri.toString();\n\t\t}\n\t\tconst xhr = new XMLHttpRequest();\n\t\txhr.open(method, url, options.async);\n\t\txhr.withCredentials = options.withCredentials !== undefined ? options.withCredentials : false;\n\t\txhr.responseType = options.responseType || this._guessResponseType(url);\n\t\tfor (const header in options.headers) {\n\t\t\tif (options.headers.hasOwnProperty(header)) {\n\t\t\t\txhr.setRequestHeader(header, options.headers[header]);\n\t\t\t}\n\t\t}\n\t\txhr.onreadystatechange = () => {\n\t\t\tthis._onReadyStateChange(method, url, options, xhr);\n\t\t};\n\t\txhr.onerror = () => {\n\t\t\tthis._onError(method, url, options, xhr);\n\t\t\terrored = true;\n\t\t};\n\t\ttry {\n\t\t\txhr.send(postdata);\n\t\t} catch (e) {\n\t\t\tif (!errored) {\n\t\t\t\toptions.error(xhr.status, xhr, e);\n\t\t\t}\n\t\t}\n\t\treturn xhr;\n\t}\n\t_guessResponseType(url) {\n\t\tconst uri = new URI(url);\n\t\tconst ext = path.getExtension(uri.path).toLowerCase();\n\t\tif (Http.binaryExtensions.indexOf(ext) >= 0) {\n\t\t\treturn Http.ResponseType.ARRAY_BUFFER;\n\t\t} else if (ext === '.json') {\n\t\t\treturn Http.ResponseType.JSON;\n\t\t} else if (ext === '.xml') {\n\t\t\treturn Http.ResponseType.DOCUMENT;\n\t\t}\n\t\treturn Http.ResponseType.TEXT;\n\t}\n\t_isBinaryContentType(contentType) {\n\t\tconst binTypes = [Http.ContentType.BASIS, Http.ContentType.BIN, Http.ContentType.DDS, Http.ContentType.GLB, Http.ContentType.MP3, Http.ContentType.MP4, Http.ContentType.OGG, Http.ContentType.OPUS, Http.ContentType.WAV];\n\t\tif (binTypes.indexOf(contentType) >= 0) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\t_isBinaryResponseType(responseType) {\n\t\treturn responseType === Http.ResponseType.ARRAY_BUFFER || responseType === Http.ResponseType.BLOB || responseType === Http.ResponseType.JSON;\n\t}\n\t_onReadyStateChange(method, url, options, xhr) {\n\t\tif (xhr.readyState === 4) {\n\t\t\tswitch (xhr.status) {\n\t\t\t\tcase 0:\n\t\t\t\t\t{\n\t\t\t\t\t\tif (xhr.responseURL && xhr.responseURL.startsWith('file:///')) {\n\t\t\t\t\t\t\tthis._onSuccess(method, url, options, xhr);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis._onError(method, url, options, xhr);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tcase 200:\n\t\t\t\tcase 201:\n\t\t\t\tcase 206:\n\t\t\t\tcase 304:\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._onSuccess(method, url, options, xhr);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tdefault:\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._onError(method, url, options, xhr);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t_onSuccess(method, url, options, xhr) {\n\t\tlet response;\n\t\tlet contentType;\n\t\tconst header = xhr.getResponseHeader('Content-Type');\n\t\tif (header) {\n\t\t\tconst parts = header.split(';');\n\t\t\tcontentType = parts[0].trim();\n\t\t}\n\t\ttry {\n\t\t\tif (this._isBinaryContentType(contentType) || this._isBinaryResponseType(xhr.responseType)) {\n\t\t\t\tresponse = xhr.response;\n\t\t\t} else if (contentType === Http.ContentType.JSON || url.split('?')[0].endsWith('.json')) {\n\t\t\t\tresponse = JSON.parse(xhr.responseText);\n\t\t\t} else if (xhr.responseType === Http.ResponseType.DOCUMENT || contentType === Http.ContentType.XML) {\n\t\t\t\tresponse = xhr.responseXML;\n\t\t\t} else {\n\t\t\t\tresponse = xhr.responseText;\n\t\t\t}\n\t\t\toptions.callback(null, response);\n\t\t} catch (err) {\n\t\t\toptions.callback(err);\n\t\t}\n\t}\n\t_onError(method, url, options, xhr) {\n\t\tif (options.retrying) {\n\t\t\treturn;\n\t\t}\n\t\tif (options.retry && options.retries < options.maxRetries) {\n\t\t\toptions.retries++;\n\t\t\toptions.retrying = true;\n\t\t\tconst retryDelay = math.clamp(Math.pow(2, options.retries) * Http.retryDelay, 0, options.maxRetryDelay || 5000);\n\t\t\tconsole.log(`${method}: ${url} - Error ${xhr.status}. Retrying in ${retryDelay} ms`);\n\t\t\tsetTimeout(() => {\n\t\t\t\toptions.retrying = false;\n\t\t\t\tthis.request(method, url, options, options.callback);\n\t\t\t}, retryDelay);\n\t\t} else {\n\t\t\toptions.callback(xhr.status === 0 ? 'Network error' : xhr.status, null);\n\t\t}\n\t}\n}\nHttp.ContentType = {\n\tAAC: 'audio/aac',\n\tBASIS: 'image/basis',\n\tBIN: 'application/octet-stream',\n\tDDS: 'image/dds',\n\tFORM_URLENCODED: 'application/x-www-form-urlencoded',\n\tGIF: 'image/gif',\n\tGLB: 'model/gltf-binary',\n\tJPEG: 'image/jpeg',\n\tJSON: 'application/json',\n\tMP3: 'audio/mpeg',\n\tMP4: 'audio/mp4',\n\tOGG: 'audio/ogg',\n\tOPUS: 'audio/ogg; codecs=\"opus\"',\n\tPNG: 'image/png',\n\tTEXT: 'text/plain',\n\tWAV: 'audio/x-wav',\n\tXML: 'application/xml'\n};\nHttp.ResponseType = {\n\tTEXT: 'text',\n\tARRAY_BUFFER: 'arraybuffer',\n\tBLOB: 'blob',\n\tDOCUMENT: 'document',\n\tJSON: 'json'\n};\nHttp.binaryExtensions = ['.model', '.wav', '.ogg', '.mp3', '.mp4', '.m4a', '.aac', '.dds', '.basis', '.glb', '.opus'];\nHttp.retryDelay = 100;\nconst http = new Http();\n\nexport { Http, http };\n","function hasAudioContext() {\n\treturn !!(typeof AudioContext !== 'undefined' || typeof webkitAudioContext !== 'undefined');\n}\n\nexport { hasAudioContext };\n","import { math } from '../../core/math/math.js';\nimport { hasAudioContext } from './capabilities.js';\n\nclass Channel {\n\tconstructor(manager, sound, options = {}) {\n\t\tvar _options$volume, _options$loop, _options$pitch;\n\t\tthis.volume = (_options$volume = options.volume) != null ? _options$volume : 1;\n\t\tthis.loop = (_options$loop = options.loop) != null ? _options$loop : false;\n\t\tthis.pitch = (_options$pitch = options.pitch) != null ? _options$pitch : 1;\n\t\tthis.sound = sound;\n\t\tthis.paused = false;\n\t\tthis.suspended = false;\n\t\tthis.manager = manager;\n\t\tthis.source = null;\n\t\tif (hasAudioContext()) {\n\t\t\tthis.startTime = 0;\n\t\t\tthis.startOffset = 0;\n\t\t\tconst context = manager.context;\n\t\t\tthis.gain = context.createGain();\n\t\t} else if (sound.audio) {\n\t\t\tthis.source = sound.audio.cloneNode(false);\n\t\t\tthis.source.pause();\n\t\t}\n\t}\n\tgetVolume() {\n\t\treturn this.volume;\n\t}\n\tgetLoop() {\n\t\treturn this.loop;\n\t}\n\tsetLoop(loop) {\n\t\tthis.loop = loop;\n\t\tif (this.source) {\n\t\t\tthis.source.loop = loop;\n\t\t}\n\t}\n\tgetPitch() {\n\t\treturn this.pitch;\n\t}\n\tonManagerVolumeChange() {\n\t\tthis.setVolume(this.getVolume());\n\t}\n\tonManagerSuspend() {\n\t\tif (this.isPlaying() && !this.suspended) {\n\t\t\tthis.suspended = true;\n\t\t\tthis.pause();\n\t\t}\n\t}\n\tonManagerResume() {\n\t\tif (this.suspended) {\n\t\t\tthis.suspended = false;\n\t\t\tthis.unpause();\n\t\t}\n\t}\n\tplay() {\n\t\tif (this.source) {\n\t\t\tthrow new Error('Call stop() before calling play()');\n\t\t}\n\t\tthis._createSource();\n\t\tif (!this.source) {\n\t\t\treturn;\n\t\t}\n\t\tthis.startTime = this.manager.context.currentTime;\n\t\tthis.source.start(0, this.startOffset % this.source.buffer.duration);\n\t\tthis.setVolume(this.volume);\n\t\tthis.setLoop(this.loop);\n\t\tthis.setPitch(this.pitch);\n\t\tthis.manager.on('volumechange', this.onManagerVolumeChange, this);\n\t\tthis.manager.on('suspend', this.onManagerSuspend, this);\n\t\tthis.manager.on('resume', this.onManagerResume, this);\n\t\tif (this.manager.suspended) this.onManagerSuspend();\n\t}\n\tpause() {\n\t\tif (this.source) {\n\t\t\tthis.paused = true;\n\t\t\tthis.startOffset += this.manager.context.currentTime - this.startTime;\n\t\t\tthis.source.stop(0);\n\t\t\tthis.source = null;\n\t\t}\n\t}\n\tunpause() {\n\t\tif (this.source || !this.paused) {\n\t\t\tconsole.warn('Call pause() before unpausing.');\n\t\t\treturn;\n\t\t}\n\t\tthis._createSource();\n\t\tif (!this.source) {\n\t\t\treturn;\n\t\t}\n\t\tthis.startTime = this.manager.context.currentTime;\n\t\tthis.source.start(0, this.startOffset % this.source.buffer.duration);\n\t\tthis.setVolume(this.volume);\n\t\tthis.setLoop(this.loop);\n\t\tthis.setPitch(this.pitch);\n\t\tthis.paused = false;\n\t}\n\tstop() {\n\t\tif (this.source) {\n\t\t\tthis.source.stop(0);\n\t\t\tthis.source = null;\n\t\t}\n\t\tthis.manager.off('volumechange', this.onManagerVolumeChange, this);\n\t\tthis.manager.off('suspend', this.onManagerSuspend, this);\n\t\tthis.manager.off('resume', this.onManagerResume, this);\n\t}\n\tsetVolume(volume) {\n\t\tvolume = math.clamp(volume, 0, 1);\n\t\tthis.volume = volume;\n\t\tif (this.gain) {\n\t\t\tthis.gain.gain.value = volume * this.manager.volume;\n\t\t}\n\t}\n\tsetPitch(pitch) {\n\t\tthis.pitch = pitch;\n\t\tif (this.source) {\n\t\t\tthis.source.playbackRate.value = pitch;\n\t\t}\n\t}\n\tisPlaying() {\n\t\treturn !this.paused && this.source.playbackState === this.source.PLAYING_STATE;\n\t}\n\tgetDuration() {\n\t\treturn this.source ? this.source.buffer.duration : 0;\n\t}\n\t_createSource() {\n\t\tconst context = this.manager.context;\n\t\tif (this.sound.buffer) {\n\t\t\tthis.source = context.createBufferSource();\n\t\t\tthis.source.buffer = this.sound.buffer;\n\t\t\tthis.source.connect(this.gain);\n\t\t\tthis.gain.connect(context.destination);\n\t\t\tif (!this.loop) {\n\t\t\t\tthis.source.onended = this.pause.bind(this);\n\t\t\t}\n\t\t}\n\t}\n}\nif (!hasAudioContext()) {\n\tObject.assign(Channel.prototype, {\n\t\tplay: function () {\n\t\t\tif (this.source) {\n\t\t\t\tthis.paused = false;\n\t\t\t\tthis.setVolume(this.volume);\n\t\t\t\tthis.setLoop(this.loop);\n\t\t\t\tthis.setPitch(this.pitch);\n\t\t\t\tthis.source.play();\n\t\t\t}\n\t\t\tthis.manager.on('volumechange', this.onManagerVolumeChange, this);\n\t\t\tthis.manager.on('suspend', this.onManagerSuspend, this);\n\t\t\tthis.manager.on('resume', this.onManagerResume, this);\n\t\t\tif (this.manager.suspended) this.onManagerSuspend();\n\t\t},\n\t\tpause: function () {\n\t\t\tif (this.source) {\n\t\t\t\tthis.paused = true;\n\t\t\t\tthis.source.pause();\n\t\t\t}\n\t\t},\n\t\tunpause: function () {\n\t\t\tif (this.source) {\n\t\t\t\tthis.paused = false;\n\t\t\t\tthis.source.play();\n\t\t\t}\n\t\t},\n\t\tstop: function () {\n\t\t\tif (this.source) {\n\t\t\t\tthis.source.pause();\n\t\t\t}\n\t\t\tthis.manager.off('volumechange', this.onManagerVolumeChange, this);\n\t\t\tthis.manager.off('suspend', this.onManagerSuspend, this);\n\t\t\tthis.manager.off('resume', this.onManagerResume, this);\n\t\t},\n\t\tsetVolume: function (volume) {\n\t\t\tvolume = math.clamp(volume, 0, 1);\n\t\t\tthis.volume = volume;\n\t\t\tif (this.source) {\n\t\t\t\tthis.source.volume = volume * this.manager.volume;\n\t\t\t}\n\t\t},\n\t\tsetPitch: function (pitch) {\n\t\t\tthis.pitch = pitch;\n\t\t\tif (this.source) {\n\t\t\t\tthis.source.playbackRate = pitch;\n\t\t\t}\n\t\t},\n\t\tgetDuration: function () {\n\t\t\treturn this.source && !isNaN(this.source.duration) ? this.source.duration : 0;\n\t\t},\n\t\tisPlaying: function () {\n\t\t\treturn !this.source.paused;\n\t\t}\n\t});\n}\n\nexport { Channel };\n","import '../../core/tracing.js';\nimport { math } from '../../core/math/math.js';\nimport { Vec3 } from '../../core/math/vec3.js';\nimport { DISTANCE_INVERSE, DISTANCE_LINEAR, DISTANCE_EXPONENTIAL } from './constants.js';\nimport { hasAudioContext } from './capabilities.js';\nimport { Channel } from './channel.js';\n\nconst MAX_DISTANCE = 10000;\nclass Channel3d extends Channel {\n\tconstructor(manager, sound, options) {\n\t\tsuper(manager, sound, options);\n\t\tthis.position = new Vec3();\n\t\tthis.velocity = new Vec3();\n\t\tif (hasAudioContext()) {\n\t\t\tthis.panner = manager.context.createPanner();\n\t\t} else {\n\t\t\tthis.maxDistance = MAX_DISTANCE;\n\t\t\tthis.minDistance = 1;\n\t\t\tthis.rollOffFactor = 1;\n\t\t\tthis.distanceModel = DISTANCE_INVERSE;\n\t\t}\n\t}\n\tgetPosition() {\n\t\treturn this.position;\n\t}\n\tsetPosition(position) {\n\t\tthis.position.copy(position);\n\t\tconst panner = this.panner;\n\t\tif ('positionX' in panner) {\n\t\t\tpanner.positionX.value = position.x;\n\t\t\tpanner.positionY.value = position.y;\n\t\t\tpanner.positionZ.value = position.z;\n\t\t} else if (panner.setPosition) {\n\t\t\tpanner.setPosition(position.x, position.y, position.z);\n\t\t}\n\t}\n\tgetVelocity() {\n\t\treturn this.velocity;\n\t}\n\tsetVelocity(velocity) {\n\t\tthis.velocity.copy(velocity);\n\t}\n\tgetMaxDistance() {\n\t\treturn this.panner.maxDistance;\n\t}\n\tsetMaxDistance(max) {\n\t\tthis.panner.maxDistance = max;\n\t}\n\tgetMinDistance() {\n\t\treturn this.panner.refDistance;\n\t}\n\tsetMinDistance(min) {\n\t\tthis.panner.refDistance = min;\n\t}\n\tgetRollOffFactor() {\n\t\treturn this.panner.rolloffFactor;\n\t}\n\tsetRollOffFactor(factor) {\n\t\tthis.panner.rolloffFactor = factor;\n\t}\n\tgetDistanceModel() {\n\t\treturn this.panner.distanceModel;\n\t}\n\tsetDistanceModel(distanceModel) {\n\t\tthis.panner.distanceModel = distanceModel;\n\t}\n\t_createSource() {\n\t\tconst context = this.manager.context;\n\t\tthis.source = context.createBufferSource();\n\t\tthis.source.buffer = this.sound.buffer;\n\t\tthis.source.connect(this.panner);\n\t\tthis.panner.connect(this.gain);\n\t\tthis.gain.connect(context.destination);\n\t\tif (!this.loop) {\n\t\t\tthis.source.onended = this.pause.bind(this);\n\t\t}\n\t}\n}\nif (!hasAudioContext()) {\n\tlet offset = new Vec3();\n\tconst fallOff = function fallOff(posOne, posTwo, refDistance, maxDistance, rolloffFactor, distanceModel) {\n\t\toffset = offset.sub2(posOne, posTwo);\n\t\tconst distance = offset.length();\n\t\tif (distance < refDistance) {\n\t\t\treturn 1;\n\t\t} else if (distance > maxDistance) {\n\t\t\treturn 0;\n\t\t}\n\t\tlet result = 0;\n\t\tif (distanceModel === DISTANCE_LINEAR) {\n\t\t\tresult = 1 - rolloffFactor * (distance - refDistance) / (maxDistance - refDistance);\n\t\t} else if (distanceModel === DISTANCE_INVERSE) {\n\t\t\tresult = refDistance / (refDistance + rolloffFactor * (distance - refDistance));\n\t\t} else if (distanceModel === DISTANCE_EXPONENTIAL) {\n\t\t\tresult = Math.pow(distance / refDistance, -rolloffFactor);\n\t\t}\n\t\treturn math.clamp(result, 0, 1);\n\t};\n\tObject.assign(Channel3d.prototype, {\n\t\tsetPosition: function (position) {\n\t\t\tthis.position.copy(position);\n\t\t\tif (this.source) {\n\t\t\t\tconst listener = this.manager.listener;\n\t\t\t\tconst lpos = listener.getPosition();\n\t\t\t\tconst factor = fallOff(lpos, this.position, this.minDistance, this.maxDistance, this.rollOffFactor, this.distanceModel);\n\t\t\t\tconst v = this.getVolume();\n\t\t\t\tthis.source.volume = v * factor;\n\t\t\t}\n\t\t},\n\t\tgetMaxDistance: function () {\n\t\t\treturn this.maxDistance;\n\t\t},\n\t\tsetMaxDistance: function (max) {\n\t\t\tthis.maxDistance = max;\n\t\t},\n\t\tgetMinDistance: function () {\n\t\t\treturn this.minDistance;\n\t\t},\n\t\tsetMinDistance: function (min) {\n\t\t\tthis.minDistance = min;\n\t\t},\n\t\tgetRollOffFactor: function () {\n\t\t\treturn this.rollOffFactor;\n\t\t},\n\t\tsetRollOffFactor: function (factor) {\n\t\t\tthis.rollOffFactor = factor;\n\t\t},\n\t\tgetDistanceModel: function () {\n\t\t\treturn this.distanceModel;\n\t\t},\n\t\tsetDistanceModel: function (distanceModel) {\n\t\t\tthis.distanceModel = distanceModel;\n\t\t}\n\t});\n}\n\nexport { Channel3d };\n","import '../../core/tracing.js';\nimport { Mat4 } from '../../core/math/mat4.js';\nimport { Vec3 } from '../../core/math/vec3.js';\n\nclass Listener {\n\tconstructor(manager) {\n\t\tthis._manager = manager;\n\t\tthis.position = new Vec3();\n\t\tthis.velocity = new Vec3();\n\t\tthis.orientation = new Mat4();\n\t}\n\tgetPosition() {\n\t\treturn this.position;\n\t}\n\tsetPosition(position) {\n\t\tthis.position.copy(position);\n\t\tconst listener = this.listener;\n\t\tif (listener) {\n\t\t\tif ('positionX' in listener) {\n\t\t\t\tlistener.positionX.value = position.x;\n\t\t\t\tlistener.positionY.value = position.y;\n\t\t\t\tlistener.positionZ.value = position.z;\n\t\t\t} else if (listener.setPosition) {\n\t\t\t\tlistener.setPosition(position.x, position.y, position.z);\n\t\t\t}\n\t\t}\n\t}\n\tgetVelocity() {\n\t\treturn this.velocity;\n\t}\n\tsetVelocity(velocity) {}\n\tsetOrientation(orientation) {\n\t\tthis.orientation.copy(orientation);\n\t\tconst listener = this.listener;\n\t\tif (listener) {\n\t\t\tconst m = orientation.data;\n\t\t\tif ('forwardX' in listener) {\n\t\t\t\tlistener.forwardX.value = -m[8];\n\t\t\t\tlistener.forwardY.value = -m[9];\n\t\t\t\tlistener.forwardZ.value = -m[10];\n\t\t\t\tlistener.upX.value = m[4];\n\t\t\t\tlistener.upY.value = m[5];\n\t\t\t\tlistener.upZ.value = m[6];\n\t\t\t} else if (listener.setOrientation) {\n\t\t\t\tlistener.setOrientation(-m[8], -m[9], -m[10], m[4], m[5], m[6]);\n\t\t\t}\n\t\t}\n\t}\n\tgetOrientation() {\n\t\treturn this.orientation;\n\t}\n\tget listener() {\n\t\tconst context = this._manager.context;\n\t\treturn context ? context.listener : null;\n\t}\n}\n\nexport { Listener };\n","import '../../core/tracing.js';\nimport { EventHandler } from '../../core/event-handler.js';\nimport { math } from '../../core/math/math.js';\nimport { Channel } from '../audio/channel.js';\nimport { Channel3d } from '../audio/channel3d.js';\nimport { Listener } from './listener.js';\n\nconst CONTEXT_STATE_RUNNING = 'running';\nconst USER_INPUT_EVENTS = ['click', 'touchstart', 'mousedown'];\nclass SoundManager extends EventHandler {\n\tconstructor() {\n\t\tsuper();\n\t\tthis._context = null;\n\t\tthis.AudioContext = typeof AudioContext !== 'undefined' && AudioContext || typeof webkitAudioContext !== 'undefined' && webkitAudioContext;\n\t\tif (!this.AudioContext) ;\n\t\tthis._unlockHandlerFunc = this._unlockHandler.bind(this);\n\t\tthis._userSuspended = false;\n\t\tthis.listener = new Listener(this);\n\t\tthis._volume = 1;\n\t}\n\tset volume(volume) {\n\t\tvolume = math.clamp(volume, 0, 1);\n\t\tthis._volume = volume;\n\t\tthis.fire('volumechange', volume);\n\t}\n\tget volume() {\n\t\treturn this._volume;\n\t}\n\tget suspended() {\n\t\treturn this._userSuspended;\n\t}\n\tget context() {\n\t\tif (!this._context && this.AudioContext) {\n\t\t\tthis._context = new this.AudioContext();\n\t\t\tif (this._context.state !== CONTEXT_STATE_RUNNING) {\n\t\t\t\tthis._registerUnlockListeners();\n\t\t\t}\n\t\t}\n\t\treturn this._context;\n\t}\n\tsuspend() {\n\t\tif (!this._userSuspended) {\n\t\t\tthis._userSuspended = true;\n\t\t\tif (this._context && this._context.state === CONTEXT_STATE_RUNNING) {\n\t\t\t\tthis._suspend();\n\t\t\t}\n\t\t}\n\t}\n\tresume() {\n\t\tif (this._userSuspended) {\n\t\t\tthis._userSuspended = false;\n\t\t\tif (this._context && this._context.state !== CONTEXT_STATE_RUNNING) {\n\t\t\t\tthis._resume();\n\t\t\t}\n\t\t}\n\t}\n\tdestroy() {\n\t\tthis.fire('destroy');\n\t\tif (this._context) {\n\t\t\tvar _this$_context;\n\t\t\tthis._removeUnlockListeners();\n\t\t\t(_this$_context = this._context) == null || _this$_context.close();\n\t\t\tthis._context = null;\n\t\t}\n\t}\n\tplaySound(sound, options = {}) {\n\t\tlet channel = null;\n\t\tif (Channel) {\n\t\t\tchannel = new Channel(this, sound, options);\n\t\t\tchannel.play();\n\t\t}\n\t\treturn channel;\n\t}\n\tplaySound3d(sound, position, options = {}) {\n\t\tlet channel = null;\n\t\tif (Channel3d) {\n\t\t\tchannel = new Channel3d(this, sound, options);\n\t\t\tchannel.setPosition(position);\n\t\t\tif (options.volume) {\n\t\t\t\tchannel.setVolume(options.volume);\n\t\t\t}\n\t\t\tif (options.loop) {\n\t\t\t\tchannel.setLoop(options.loop);\n\t\t\t}\n\t\t\tif (options.maxDistance) {\n\t\t\t\tchannel.setMaxDistance(options.maxDistance);\n\t\t\t}\n\t\t\tif (options.minDistance) {\n\t\t\t\tchannel.setMinDistance(options.minDistance);\n\t\t\t}\n\t\t\tif (options.rollOffFactor) {\n\t\t\t\tchannel.setRollOffFactor(options.rollOffFactor);\n\t\t\t}\n\t\t\tif (options.distanceModel) {\n\t\t\t\tchannel.setDistanceModel(options.distanceModel);\n\t\t\t}\n\t\t\tchannel.play();\n\t\t}\n\t\treturn channel;\n\t}\n\t_resume() {\n\t\tthis._context.resume().then(() => {\n\t\t\tconst source = this._context.createBufferSource();\n\t\t\tsource.buffer = this._context.createBuffer(1, 1, this._context.sampleRate);\n\t\t\tsource.connect(this._context.destination);\n\t\t\tsource.start(0);\n\t\t\tsource.onended = event => {\n\t\t\t\tsource.disconnect(0);\n\t\t\t\tthis.fire('resume');\n\t\t\t};\n\t\t}, e => {}).catch(e => {});\n\t}\n\t_suspend() {\n\t\tthis._context.suspend().then(() => {\n\t\t\tthis.fire('suspend');\n\t\t}, e => {}).catch(e => {});\n\t}\n\t_unlockHandler() {\n\t\tthis._removeUnlockListeners();\n\t\tif (!this._userSuspended && this._context.state !== CONTEXT_STATE_RUNNING) {\n\t\t\tthis._resume();\n\t\t}\n\t}\n\t_registerUnlockListeners() {\n\t\tUSER_INPUT_EVENTS.forEach(eventName => {\n\t\t\twindow.addEventListener(eventName, this._unlockHandlerFunc, false);\n\t\t});\n\t}\n\t_removeUnlockListeners() {\n\t\tUSER_INPUT_EVENTS.forEach(eventName => {\n\t\t\twindow.removeEventListener(eventName, this._unlockHandlerFunc, false);\n\t\t});\n\t}\n}\n\nexport { SoundManager };\n","class Sound {\n\tconstructor(resource) {\n\t\tthis.audio = void 0;\n\t\tthis.buffer = void 0;\n\t\tif (resource instanceof Audio) {\n\t\t\tthis.audio = resource;\n\t\t} else {\n\t\t\tthis.buffer = resource;\n\t\t}\n\t}\n\tget duration() {\n\t\tlet duration = 0;\n\t\tif (this.buffer) {\n\t\t\tduration = this.buffer.duration;\n\t\t} else if (this.audio) {\n\t\t\tduration = this.audio.duration;\n\t\t}\n\t\treturn duration || 0;\n\t}\n}\n\nexport { Sound };\n","import { EventHandler } from '../../core/event-handler.js';\nimport { math } from '../../core/math/math.js';\nimport { hasAudioContext } from '../audio/capabilities.js';\n\nconst STATE_PLAYING = 0;\nconst STATE_PAUSED = 1;\nconst STATE_STOPPED = 2;\nfunction capTime(time, duration) {\n\treturn time % duration || 0;\n}\nclass SoundInstance extends EventHandler {\n\tconstructor(manager, sound, options) {\n\t\tsuper();\n\t\tthis.source = null;\n\t\tthis._manager = manager;\n\t\tthis._volume = options.volume !== undefined ? math.clamp(Number(options.volume) || 0, 0, 1) : 1;\n\t\tthis._pitch = options.pitch !== undefined ? Math.max(0.01, Number(options.pitch) || 0) : 1;\n\t\tthis._loop = !!(options.loop !== undefined ? options.loop : false);\n\t\tthis._sound = sound;\n\t\tthis._state = STATE_STOPPED;\n\t\tthis._suspended = false;\n\t\tthis._suspendEndEvent = 0;\n\t\tthis._suspendInstanceEvents = false;\n\t\tthis._playWhenLoaded = true;\n\t\tthis._startTime = Math.max(0, Number(options.startTime) || 0);\n\t\tthis._duration = Math.max(0, Number(options.duration) || 0);\n\t\tthis._startOffset = null;\n\t\tthis._onPlayCallback = options.onPlay;\n\t\tthis._onPauseCallback = options.onPause;\n\t\tthis._onResumeCallback = options.onResume;\n\t\tthis._onStopCallback = options.onStop;\n\t\tthis._onEndCallback = options.onEnd;\n\t\tif (hasAudioContext()) {\n\t\t\tthis._startedAt = 0;\n\t\t\tthis._currentTime = 0;\n\t\t\tthis._currentOffset = 0;\n\t\t\tthis._inputNode = null;\n\t\t\tthis._connectorNode = null;\n\t\t\tthis._firstNode = null;\n\t\t\tthis._lastNode = null;\n\t\t\tthis._waitingContextSuspension = false;\n\t\t\tthis._initializeNodes();\n\t\t\tthis._endedHandler = this._onEnded.bind(this);\n\t\t} else {\n\t\t\tthis._isReady = false;\n\t\t\tthis._loadedMetadataHandler = this._onLoadedMetadata.bind(this);\n\t\t\tthis._timeUpdateHandler = this._onTimeUpdate.bind(this);\n\t\t\tthis._endedHandler = this._onEnded.bind(this);\n\t\t\tthis._createSource();\n\t\t}\n\t}\n\tset currentTime(value) {\n\t\tif (value < 0) return;\n\t\tif (this._state === STATE_PLAYING) {\n\t\t\tconst suspend = this._suspendInstanceEvents;\n\t\t\tthis._suspendInstanceEvents = true;\n\t\t\tthis.stop();\n\t\t\tthis._startOffset = value;\n\t\t\tthis.play();\n\t\t\tthis._suspendInstanceEvents = suspend;\n\t\t} else {\n\t\t\tthis._startOffset = value;\n\t\t\tthis._currentTime = value;\n\t\t}\n\t}\n\tget currentTime() {\n\t\tif (this._startOffset !== null) {\n\t\t\treturn this._startOffset;\n\t\t}\n\t\tif (this._state === STATE_PAUSED) {\n\t\t\treturn this._currentTime;\n\t\t}\n\t\tif (this._state === STATE_STOPPED || !this.source) {\n\t\t\treturn 0;\n\t\t}\n\t\tthis._updateCurrentTime();\n\t\treturn this._currentTime;\n\t}\n\tset duration(value) {\n\t\tthis._duration = Math.max(0, Number(value) || 0);\n\t\tconst isPlaying = this._state === STATE_PLAYING;\n\t\tthis.stop();\n\t\tif (isPlaying) {\n\t\t\tthis.play();\n\t\t}\n\t}\n\tget duration() {\n\t\tif (!this._sound) {\n\t\t\treturn 0;\n\t\t}\n\t\tif (this._duration) {\n\t\t\treturn capTime(this._duration, this._sound.duration);\n\t\t}\n\t\treturn this._sound.duration;\n\t}\n\tget isPaused() {\n\t\treturn this._state === STATE_PAUSED;\n\t}\n\tget isPlaying() {\n\t\treturn this._state === STATE_PLAYING;\n\t}\n\tget isStopped() {\n\t\treturn this._state === STATE_STOPPED;\n\t}\n\tget isSuspended() {\n\t\treturn this._suspended;\n\t}\n\tset loop(value) {\n\t\tthis._loop = !!value;\n\t\tif (this.source) {\n\t\t\tthis.source.loop = this._loop;\n\t\t}\n\t}\n\tget loop() {\n\t\treturn this._loop;\n\t}\n\tset pitch(pitch) {\n\t\tthis._currentOffset = this.currentTime;\n\t\tthis._startedAt = this._manager.context.currentTime;\n\t\tthis._pitch = Math.max(Number(pitch) || 0, 0.01);\n\t\tif (this.source) {\n\t\t\tthis.source.playbackRate.value = this._pitch;\n\t\t}\n\t}\n\tget pitch() {\n\t\treturn this._pitch;\n\t}\n\tset sound(value) {\n\t\tthis._sound = value;\n\t\tif (this._state !== STATE_STOPPED) {\n\t\t\tthis.stop();\n\t\t} else {\n\t\t\tthis._createSource();\n\t\t}\n\t}\n\tget sound() {\n\t\treturn this._sound;\n\t}\n\tset startTime(value) {\n\t\tthis._startTime = Math.max(0, Number(value) || 0);\n\t\tconst isPlaying = this._state === STATE_PLAYING;\n\t\tthis.stop();\n\t\tif (isPlaying) {\n\t\t\tthis.play();\n\t\t}\n\t}\n\tget startTime() {\n\t\treturn this._startTime;\n\t}\n\tset volume(volume) {\n\t\tvolume = math.clamp(volume, 0, 1);\n\t\tthis._volume = volume;\n\t\tif (this.gain) {\n\t\t\tthis.gain.gain.value = volume * this._manager.volume;\n\t\t}\n\t}\n\tget volume() {\n\t\treturn this._volume;\n\t}\n\t_onPlay() {\n\t\tthis.fire('play');\n\t\tif (this._onPlayCallback) this._onPlayCallback(this);\n\t}\n\t_onPause() {\n\t\tthis.fire('pause');\n\t\tif (this._onPauseCallback) this._onPauseCallback(this);\n\t}\n\t_onResume() {\n\t\tthis.fire('resume');\n\t\tif (this._onResumeCallback) this._onResumeCallback(this);\n\t}\n\t_onStop() {\n\t\tthis.fire('stop');\n\t\tif (this._onStopCallback) this._onStopCallback(this);\n\t}\n\t_onEnded() {\n\t\tif (this._suspendEndEvent > 0) {\n\t\t\tthis._suspendEndEvent--;\n\t\t\treturn;\n\t\t}\n\t\tthis.fire('end');\n\t\tif (this._onEndCallback) this._onEndCallback(this);\n\t\tthis.stop();\n\t}\n\t_onManagerVolumeChange() {\n\t\tthis.volume = this._volume;\n\t}\n\t_onManagerSuspend() {\n\t\tif (this._state === STATE_PLAYING && !this._suspended) {\n\t\t\tthis._suspended = true;\n\t\t\tthis.pause();\n\t\t}\n\t}\n\t_onManagerResume() {\n\t\tif (this._suspended) {\n\t\t\tthis._suspended = false;\n\t\t\tthis.resume();\n\t\t}\n\t}\n\t_initializeNodes() {\n\t\tthis.gain = this._manager.context.createGain();\n\t\tthis._inputNode = this.gain;\n\t\tthis._connectorNode = this.gain;\n\t\tthis._connectorNode.connect(this._manager.context.destination);\n\t}\n\tplay() {\n\t\tif (this._state !== STATE_STOPPED) {\n\t\t\tthis.stop();\n\t\t}\n\t\tthis._state = STATE_PLAYING;\n\t\tthis._playWhenLoaded = false;\n\t\tif (this._waitingContextSuspension) {\n\t\t\treturn false;\n\t\t}\n\t\tif (this._manager.suspended) {\n\t\t\tthis._manager.once('resume', this._playAudioImmediate, this);\n\t\t\tthis._waitingContextSuspension = true;\n\t\t\treturn false;\n\t\t}\n\t\tthis._playAudioImmediate();\n\t\treturn true;\n\t}\n\t_playAudioImmediate() {\n\t\tthis._waitingContextSuspension = false;\n\t\tif (this._state !== STATE_PLAYING) {\n\t\t\treturn;\n\t\t}\n\t\tif (!this.source) {\n\t\t\tthis._createSource();\n\t\t}\n\t\tlet offset = capTime(this._startOffset, this.duration);\n\t\toffset = capTime(this._startTime + offset, this._sound.duration);\n\t\tthis._startOffset = null;\n\t\tif (this._duration) {\n\t\t\tthis.source.start(0, offset, this._duration);\n\t\t} else {\n\t\t\tthis.source.start(0, offset);\n\t\t}\n\t\tthis._startedAt = this._manager.context.currentTime;\n\t\tthis._currentTime = 0;\n\t\tthis._currentOffset = offset;\n\t\tthis.volume = this._volume;\n\t\tthis.loop = this._loop;\n\t\tthis.pitch = this._pitch;\n\t\tthis._manager.on('volumechange', this._onManagerVolumeChange, this);\n\t\tthis._manager.on('suspend', this._onManagerSuspend, this);\n\t\tthis._manager.on('resume', this._onManagerResume, this);\n\t\tthis._manager.on('destroy', this._onManagerDestroy, this);\n\t\tif (!this._suspendInstanceEvents) {\n\t\t\tthis._onPlay();\n\t\t}\n\t}\n\tpause() {\n\t\tthis._playWhenLoaded = false;\n\t\tif (this._state !== STATE_PLAYING) return false;\n\t\tthis._state = STATE_PAUSED;\n\t\tif (this._waitingContextSuspension) {\n\t\t\treturn true;\n\t\t}\n\t\tthis._updateCurrentTime();\n\t\tthis._suspendEndEvent++;\n\t\tthis.source.stop(0);\n\t\tthis.source = null;\n\t\tthis._startOffset = null;\n\t\tif (!this._suspendInstanceEvents) this._onPause();\n\t\treturn true;\n\t}\n\tresume() {\n\t\tif (this._state !== STATE_PAUSED) {\n\t\t\treturn false;\n\t\t}\n\t\tlet offset = this.currentTime;\n\t\tthis._state = STATE_PLAYING;\n\t\tif (this._waitingContextSuspension) {\n\t\t\treturn true;\n\t\t}\n\t\tif (!this.source) {\n\t\t\tthis._createSource();\n\t\t}\n\t\tif (this._startOffset !== null) {\n\t\t\toffset = capTime(this._startOffset, this.duration);\n\t\t\toffset = capTime(this._startTime + offset, this._sound.duration);\n\t\t\tthis._startOffset = null;\n\t\t}\n\t\tif (this._duration) {\n\t\t\tthis.source.start(0, offset, this._duration);\n\t\t} else {\n\t\t\tthis.source.start(0, offset);\n\t\t}\n\t\tthis._startedAt = this._manager.context.currentTime;\n\t\tthis._currentOffset = offset;\n\t\tthis.volume = this._volume;\n\t\tthis.loop = this._loop;\n\t\tthis.pitch = this._pitch;\n\t\tthis._playWhenLoaded = false;\n\t\tif (!this._suspendInstanceEvents) this._onResume();\n\t\treturn true;\n\t}\n\tstop() {\n\t\tthis._playWhenLoaded = false;\n\t\tif (this._state === STATE_STOPPED) return false;\n\t\tconst wasPlaying = this._state === STATE_PLAYING;\n\t\tthis._state = STATE_STOPPED;\n\t\tif (this._waitingContextSuspension) {\n\t\t\treturn true;\n\t\t}\n\t\tthis._manager.off('volumechange', this._onManagerVolumeChange, this);\n\t\tthis._manager.off('suspend', this._onManagerSuspend, this);\n\t\tthis._manager.off('resume', this._onManagerResume, this);\n\t\tthis._manager.off('destroy', this._onManagerDestroy, this);\n\t\tthis._startedAt = 0;\n\t\tthis._currentTime = 0;\n\t\tthis._currentOffset = 0;\n\t\tthis._startOffset = null;\n\t\tthis._suspendEndEvent++;\n\t\tif (wasPlaying && this.source) {\n\t\t\tthis.source.stop(0);\n\t\t}\n\t\tthis.source = null;\n\t\tif (!this._suspendInstanceEvents) this._onStop();\n\t\treturn true;\n\t}\n\tsetExternalNodes(firstNode, lastNode) {\n\t\tif (!firstNode) {\n\t\t\tconsole.error('The firstNode must be a valid Audio Node');\n\t\t\treturn;\n\t\t}\n\t\tif (!lastNode) {\n\t\t\tlastNode = firstNode;\n\t\t}\n\t\tconst speakers = this._manager.context.destination;\n\t\tif (this._firstNode !== firstNode) {\n\t\t\tif (this._firstNode) {\n\t\t\t\tthis._connectorNode.disconnect(this._firstNode);\n\t\t\t} else {\n\t\t\t\tthis._connectorNode.disconnect(speakers);\n\t\t\t}\n\t\t\tthis._firstNode = firstNode;\n\t\t\tthis._connectorNode.connect(firstNode);\n\t\t}\n\t\tif (this._lastNode !== lastNode) {\n\t\t\tif (this._lastNode) {\n\t\t\t\tthis._lastNode.disconnect(speakers);\n\t\t\t}\n\t\t\tthis._lastNode = lastNode;\n\t\t\tthis._lastNode.connect(speakers);\n\t\t}\n\t}\n\tclearExternalNodes() {\n\t\tconst speakers = this._manager.context.destination;\n\t\tif (this._firstNode) {\n\t\t\tthis._connectorNode.disconnect(this._firstNode);\n\t\t\tthis._firstNode = null;\n\t\t}\n\t\tif (this._lastNode) {\n\t\t\tthis._lastNode.disconnect(speakers);\n\t\t\tthis._lastNode = null;\n\t\t}\n\t\tthis._connectorNode.connect(speakers);\n\t}\n\tgetExternalNodes() {\n\t\treturn [this._firstNode, this._lastNode];\n\t}\n\t_createSource() {\n\t\tif (!this._sound) {\n\t\t\treturn null;\n\t\t}\n\t\tconst context = this._manager.context;\n\t\tif (this._sound.buffer) {\n\t\t\tthis.source = context.createBufferSource();\n\t\t\tthis.source.buffer = this._sound.buffer;\n\t\t\tthis.source.connect(this._inputNode);\n\t\t\tthis.source.onended = this._endedHandler;\n\t\t\tthis.source.loopStart = capTime(this._startTime, this.source.buffer.duration);\n\t\t\tif (this._duration) {\n\t\t\t\tthis.source.loopEnd = Math.max(this.source.loopStart, capTime(this._startTime + this._duration, this.source.buffer.duration));\n\t\t\t}\n\t\t}\n\t\treturn this.source;\n\t}\n\t_updateCurrentTime() {\n\t\tthis._currentTime = capTime((this._manager.context.currentTime - this._startedAt) * this._pitch + this._currentOffset, this.duration);\n\t}\n\t_onManagerDestroy() {\n\t\tif (this.source && this._state === STATE_PLAYING) {\n\t\t\tthis.source.stop(0);\n\t\t\tthis.source = null;\n\t\t}\n\t}\n}\nif (!hasAudioContext()) {\n\tObject.assign(SoundInstance.prototype, {\n\t\tplay: function () {\n\t\t\tif (this._state !== STATE_STOPPED) {\n\t\t\t\tthis.stop();\n\t\t\t}\n\t\t\tif (!this.source) {\n\t\t\t\tif (!this._createSource()) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.volume = this._volume;\n\t\t\tthis.pitch = this._pitch;\n\t\t\tthis.loop = this._loop;\n\t\t\tthis.source.play();\n\t\t\tthis._state = STATE_PLAYING;\n\t\t\tthis._playWhenLoaded = false;\n\t\t\tthis._manager.on('volumechange', this._onManagerVolumeChange, this);\n\t\t\tthis._manager.on('suspend', this._onManagerSuspend, this);\n\t\t\tthis._manager.on('resume', this._onManagerResume, this);\n\t\t\tthis._manager.on('destroy', this._onManagerDestroy, this);\n\t\t\tif (this._manager.suspended) this._onManagerSuspend();\n\t\t\tif (!this._suspendInstanceEvents) this._onPlay();\n\t\t\treturn true;\n\t\t},\n\t\tpause: function () {\n\t\t\tif (!this.source || this._state !== STATE_PLAYING) return false;\n\t\t\tthis._suspendEndEvent++;\n\t\t\tthis.source.pause();\n\t\t\tthis._playWhenLoaded = false;\n\t\t\tthis._state = STATE_PAUSED;\n\t\t\tthis._startOffset = null;\n\t\t\tif (!this._suspendInstanceEvents) this._onPause();\n\t\t\treturn true;\n\t\t},\n\t\tresume: function () {\n\t\t\tif (!this.source || this._state !== STATE_PAUSED) return false;\n\t\t\tthis._state = STATE_PLAYING;\n\t\t\tthis._playWhenLoaded = false;\n\t\t\tif (this.source.paused) {\n\t\t\t\tthis.source.play();\n\t\t\t\tif (!this._suspendInstanceEvents) this._onResume();\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\tstop: function () {\n\t\t\tif (!this.source || this._state === STATE_STOPPED) return false;\n\t\t\tthis._manager.off('volumechange', this._onManagerVolumeChange, this);\n\t\t\tthis._manager.off('suspend', this._onManagerSuspend, this);\n\t\t\tthis._manager.off('resume', this._onManagerResume, this);\n\t\t\tthis._manager.off('destroy', this._onManagerDestroy, this);\n\t\t\tthis._suspendEndEvent++;\n\t\t\tthis.source.pause();\n\t\t\tthis._playWhenLoaded = false;\n\t\t\tthis._state = STATE_STOPPED;\n\t\t\tthis._startOffset = null;\n\t\t\tif (!this._suspendInstanceEvents) this._onStop();\n\t\t\treturn true;\n\t\t},\n\t\tsetExternalNodes: function () {},\n\t\tclearExternalNodes: function () {},\n\t\tgetExternalNodes: function () {\n\t\t\treturn [null, null];\n\t\t},\n\t\t_onLoadedMetadata: function () {\n\t\t\tthis.source.removeEventListener('loadedmetadata', this._loadedMetadataHandler);\n\t\t\tthis._isReady = true;\n\t\t\tlet offset = capTime(this._startOffset, this.duration);\n\t\t\toffset = capTime(this._startTime + offset, this._sound.duration);\n\t\t\tthis._startOffset = null;\n\t\t\tthis.source.currentTime = offset;\n\t\t},\n\t\t_createSource: function () {\n\t\t\tif (this._sound && this._sound.audio) {\n\t\t\t\tthis._isReady = false;\n\t\t\t\tthis.source = this._sound.audio.cloneNode(true);\n\t\t\t\tthis.source.addEventListener('loadedmetadata', this._loadedMetadataHandler);\n\t\t\t\tthis.source.addEventListener('timeupdate', this._timeUpdateHandler);\n\t\t\t\tthis.source.onended = this._endedHandler;\n\t\t\t}\n\t\t\treturn this.source;\n\t\t},\n\t\t_onTimeUpdate: function () {\n\t\t\tif (!this._duration) return;\n\t\t\tif (this.source.currentTime > capTime(this._startTime + this._duration, this.source.duration)) {\n\t\t\t\tif (this.loop) {\n\t\t\t\t\tthis.source.currentTime = capTime(this._startTime, this.source.duration);\n\t\t\t\t} else {\n\t\t\t\t\tthis.source.removeEventListener('timeupdate', this._timeUpdateHandler);\n\t\t\t\t\tthis.source.pause();\n\t\t\t\t\tthis._onEnded();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t_onManagerDestroy: function () {\n\t\t\tif (this.source) {\n\t\t\t\tthis.source.pause();\n\t\t\t}\n\t\t}\n\t});\n\tObject.defineProperty(SoundInstance.prototype, 'volume', {\n\t\tget: function () {\n\t\t\treturn this._volume;\n\t\t},\n\t\tset: function (volume) {\n\t\t\tvolume = math.clamp(volume, 0, 1);\n\t\t\tthis._volume = volume;\n\t\t\tif (this.source) {\n\t\t\t\tthis.source.volume = volume * this._manager.volume;\n\t\t\t}\n\t\t}\n\t});\n\tObject.defineProperty(SoundInstance.prototype, 'pitch', {\n\t\tget: function () {\n\t\t\treturn this._pitch;\n\t\t},\n\t\tset: function (pitch) {\n\t\t\tthis._pitch = Math.max(Number(pitch) || 0, 0.01);\n\t\t\tif (this.source) {\n\t\t\t\tthis.source.playbackRate = this._pitch;\n\t\t\t}\n\t\t}\n\t});\n\tObject.defineProperty(SoundInstance.prototype, 'sound', {\n\t\tget: function () {\n\t\t\treturn this._sound;\n\t\t},\n\t\tset: function (value) {\n\t\t\tthis.stop();\n\t\t\tthis._sound = value;\n\t\t}\n\t});\n\tObject.defineProperty(SoundInstance.prototype, 'currentTime', {\n\t\tget: function () {\n\t\t\tif (this._startOffset !== null) {\n\t\t\t\treturn this._startOffset;\n\t\t\t}\n\t\t\tif (this._state === STATE_STOPPED || !this.source) {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\treturn this.source.currentTime - this._startTime;\n\t\t},\n\t\tset: function (value) {\n\t\t\tif (value < 0) return;\n\t\t\tthis._startOffset = value;\n\t\t\tif (this.source && this._isReady) {\n\t\t\t\tthis.source.currentTime = capTime(this._startTime + capTime(value, this.duration), this._sound.duration);\n\t\t\t\tthis._startOffset = null;\n\t\t\t}\n\t\t}\n\t});\n}\n\nexport { SoundInstance };\n","import '../../core/tracing.js';\nimport { math } from '../../core/math/math.js';\nimport { Vec3 } from '../../core/math/vec3.js';\nimport { DISTANCE_LINEAR, DISTANCE_INVERSE, DISTANCE_EXPONENTIAL } from '../audio/constants.js';\nimport { hasAudioContext } from '../audio/capabilities.js';\nimport { SoundInstance } from './instance.js';\n\nconst MAX_DISTANCE = 10000;\nclass SoundInstance3d extends SoundInstance {\n\tconstructor(manager, sound, options = {}) {\n\t\tsuper(manager, sound, options);\n\t\tthis._position = new Vec3();\n\t\tthis._velocity = new Vec3();\n\t\tif (options.position) this.position = options.position;\n\t\tthis.maxDistance = options.maxDistance !== undefined ? Number(options.maxDistance) : MAX_DISTANCE;\n\t\tthis.refDistance = options.refDistance !== undefined ? Number(options.refDistance) : 1;\n\t\tthis.rollOffFactor = options.rollOffFactor !== undefined ? Number(options.rollOffFactor) : 1;\n\t\tthis.distanceModel = options.distanceModel !== undefined ? options.distanceModel : DISTANCE_LINEAR;\n\t}\n\t_initializeNodes() {\n\t\tthis.gain = this._manager.context.createGain();\n\t\tthis.panner = this._manager.context.createPanner();\n\t\tthis.panner.connect(this.gain);\n\t\tthis._inputNode = this.panner;\n\t\tthis._connectorNode = this.gain;\n\t\tthis._connectorNode.connect(this._manager.context.destination);\n\t}\n\tset position(value) {\n\t\tthis._position.copy(value);\n\t\tconst panner = this.panner;\n\t\tif ('positionX' in panner) {\n\t\t\tpanner.positionX.value = value.x;\n\t\t\tpanner.positionY.value = value.y;\n\t\t\tpanner.positionZ.value = value.z;\n\t\t} else if (panner.setPosition) {\n\t\t\tpanner.setPosition(value.x, value.y, value.z);\n\t\t}\n\t}\n\tget position() {\n\t\treturn this._position;\n\t}\n\tset velocity(velocity) {\n\t\tthis._velocity.copy(velocity);\n\t}\n\tget velocity() {\n\t\treturn this._velocity;\n\t}\n\tset maxDistance(value) {\n\t\tthis.panner.maxDistance = value;\n\t}\n\tget maxDistance() {\n\t\treturn this.panner.maxDistance;\n\t}\n\tset refDistance(value) {\n\t\tthis.panner.refDistance = value;\n\t}\n\tget refDistance() {\n\t\treturn this.panner.refDistance;\n\t}\n\tset rollOffFactor(value) {\n\t\tthis.panner.rolloffFactor = value;\n\t}\n\tget rollOffFactor() {\n\t\treturn this.panner.rolloffFactor;\n\t}\n\tset distanceModel(value) {\n\t\tthis.panner.distanceModel = value;\n\t}\n\tget distanceModel() {\n\t\treturn this.panner.distanceModel;\n\t}\n}\nif (!hasAudioContext()) {\n\tlet offset = new Vec3();\n\tconst fallOff = function fallOff(posOne, posTwo, refDistance, maxDistance, rollOffFactor, distanceModel) {\n\t\toffset = offset.sub2(posOne, posTwo);\n\t\tconst distance = offset.length();\n\t\tif (distance < refDistance) {\n\t\t\treturn 1;\n\t\t} else if (distance > maxDistance) {\n\t\t\treturn 0;\n\t\t}\n\t\tlet result = 0;\n\t\tif (distanceModel === DISTANCE_LINEAR) {\n\t\t\tresult = 1 - rollOffFactor * (distance - refDistance) / (maxDistance - refDistance);\n\t\t} else if (distanceModel === DISTANCE_INVERSE) {\n\t\t\tresult = refDistance / (refDistance + rollOffFactor * (distance - refDistance));\n\t\t} else if (distanceModel === DISTANCE_EXPONENTIAL) {\n\t\t\tresult = Math.pow(distance / refDistance, -rollOffFactor);\n\t\t}\n\t\treturn math.clamp(result, 0, 1);\n\t};\n\tObject.defineProperty(SoundInstance3d.prototype, 'position', {\n\t\tget: function () {\n\t\t\treturn this._position;\n\t\t},\n\t\tset: function (position) {\n\t\t\tthis._position.copy(position);\n\t\t\tif (this.source) {\n\t\t\t\tconst listener = this._manager.listener;\n\t\t\t\tconst lpos = listener.getPosition();\n\t\t\t\tconst factor = fallOff(lpos, this._position, this.refDistance, this.maxDistance, this.rollOffFactor, this.distanceModel);\n\t\t\t\tconst v = this.volume;\n\t\t\t\tthis.source.volume = v * factor * this._manager.volume;\n\t\t\t}\n\t\t}\n\t});\n\tObject.defineProperty(SoundInstance3d.prototype, 'maxDistance', {\n\t\tget: function () {\n\t\t\treturn this._maxDistance;\n\t\t},\n\t\tset: function (value) {\n\t\t\tthis._maxDistance = value;\n\t\t}\n\t});\n\tObject.defineProperty(SoundInstance3d.prototype, 'refDistance', {\n\t\tget: function () {\n\t\t\treturn this._refDistance;\n\t\t},\n\t\tset: function (value) {\n\t\t\tthis._refDistance = value;\n\t\t}\n\t});\n\tObject.defineProperty(SoundInstance3d.prototype, 'rollOffFactor', {\n\t\tget: function () {\n\t\t\treturn this._rollOffFactor;\n\t\t},\n\t\tset: function (value) {\n\t\t\tthis._rollOffFactor = value;\n\t\t}\n\t});\n\tObject.defineProperty(SoundInstance3d.prototype, 'distanceModel', {\n\t\tget: function () {\n\t\t\treturn this._distanceModel;\n\t\t},\n\t\tset: function (value) {\n\t\t\tthis._distanceModel = value;\n\t\t}\n\t});\n}\n\nexport { SoundInstance3d };\n","const BLEND_SUBTRACTIVE = 0;\nconst BLEND_ADDITIVE = 1;\nconst BLEND_NORMAL = 2;\nconst BLEND_NONE = 3;\nconst BLEND_PREMULTIPLIED = 4;\nconst BLEND_MULTIPLICATIVE = 5;\nconst BLEND_ADDITIVEALPHA = 6;\nconst BLEND_MULTIPLICATIVE2X = 7;\nconst BLEND_SCREEN = 8;\nconst BLEND_MIN = 9;\nconst BLEND_MAX = 10;\nconst FOG_NONE = 'none';\nconst FOG_LINEAR = 'linear';\nconst FOG_EXP = 'exp';\nconst FOG_EXP2 = 'exp2';\nconst FRESNEL_NONE = 0;\nconst FRESNEL_SCHLICK = 2;\nconst LAYER_HUD = 0;\nconst LAYER_GIZMO = 1;\nconst LAYER_FX = 2;\nconst LAYER_WORLD = 15;\nconst LAYERID_WORLD = 0;\nconst LAYERID_DEPTH = 1;\nconst LAYERID_SKYBOX = 2;\nconst LAYERID_IMMEDIATE = 3;\nconst LAYERID_UI = 4;\nconst LIGHTTYPE_DIRECTIONAL = 0;\nconst LIGHTTYPE_OMNI = 1;\nconst LIGHTTYPE_POINT = LIGHTTYPE_OMNI;\nconst LIGHTTYPE_SPOT = 2;\nconst LIGHTTYPE_COUNT = 3;\nconst LIGHTSHAPE_PUNCTUAL = 0;\nconst LIGHTSHAPE_RECT = 1;\nconst LIGHTSHAPE_DISK = 2;\nconst LIGHTSHAPE_SPHERE = 3;\nconst LIGHTFALLOFF_LINEAR = 0;\nconst LIGHTFALLOFF_INVERSESQUARED = 1;\nconst SHADOW_PCF3 = 0;\nconst SHADOW_DEPTH = 0;\nconst SHADOW_VSM8 = 1;\nconst SHADOW_VSM16 = 2;\nconst SHADOW_VSM32 = 3;\nconst SHADOW_PCF5 = 4;\nconst SHADOW_PCF1 = 5;\nconst SHADOW_PCSS = 6;\nconst shadowTypeToString = {};\nshadowTypeToString[SHADOW_PCF3] = 'PCF3';\nshadowTypeToString[SHADOW_VSM8] = 'VSM8';\nshadowTypeToString[SHADOW_VSM16] = 'VSM16';\nshadowTypeToString[SHADOW_VSM32] = 'VSM32';\nshadowTypeToString[SHADOW_PCF5] = 'PCF5';\nshadowTypeToString[SHADOW_PCF1] = 'PCF1';\nshadowTypeToString[SHADOW_PCSS] = 'PCSS';\nconst BLUR_BOX = 0;\nconst BLUR_GAUSSIAN = 1;\nconst PARTICLESORT_NONE = 0;\nconst PARTICLESORT_DISTANCE = 1;\nconst PARTICLESORT_NEWER_FIRST = 2;\nconst PARTICLESORT_OLDER_FIRST = 3;\nconst PARTICLEMODE_GPU = 0;\nconst PARTICLEMODE_CPU = 1;\nconst EMITTERSHAPE_BOX = 0;\nconst EMITTERSHAPE_SPHERE = 1;\nconst PARTICLEORIENTATION_SCREEN = 0;\nconst PARTICLEORIENTATION_WORLD = 1;\nconst PARTICLEORIENTATION_EMITTER = 2;\nconst PROJECTION_PERSPECTIVE = 0;\nconst PROJECTION_ORTHOGRAPHIC = 1;\nconst RENDERSTYLE_SOLID = 0;\nconst RENDERSTYLE_WIREFRAME = 1;\nconst RENDERSTYLE_POINTS = 2;\nconst CUBEPROJ_NONE = 0;\nconst CUBEPROJ_BOX = 1;\nconst SPECULAR_PHONG = 0;\nconst SPECULAR_BLINN = 1;\nconst DETAILMODE_MUL = 'mul';\nconst DETAILMODE_ADD = 'add';\nconst DETAILMODE_SCREEN = 'screen';\nconst DETAILMODE_OVERLAY = 'overlay';\nconst DETAILMODE_MIN = 'min';\nconst DETAILMODE_MAX = 'max';\nconst GAMMA_NONE = 0;\nconst GAMMA_SRGB = 1;\nconst GAMMA_SRGBFAST = 2;\nconst GAMMA_SRGBHDR = 3;\nconst TONEMAP_LINEAR = 0;\nconst TONEMAP_FILMIC = 1;\nconst TONEMAP_HEJL = 2;\nconst TONEMAP_ACES = 3;\nconst TONEMAP_ACES2 = 4;\nconst SPECOCC_NONE = 0;\nconst SPECOCC_AO = 1;\nconst SPECOCC_GLOSSDEPENDENT = 2;\nconst SHADERDEF_NOSHADOW = 1;\nconst SHADERDEF_SKIN = 2;\nconst SHADERDEF_UV0 = 4;\nconst SHADERDEF_UV1 = 8;\nconst SHADERDEF_VCOLOR = 16;\nconst SHADERDEF_INSTANCING = 32;\nconst SHADERDEF_LM = 64;\nconst SHADERDEF_DIRLM = 128;\nconst SHADERDEF_SCREENSPACE = 256;\nconst SHADERDEF_TANGENTS = 512;\nconst SHADERDEF_MORPH_POSITION = 1024;\nconst SHADERDEF_MORPH_NORMAL = 2048;\nconst SHADERDEF_MORPH_TEXTURE_BASED = 4096;\nconst SHADERDEF_LMAMBIENT = 8192;\nconst LINEBATCH_WORLD = 0;\nconst LINEBATCH_OVERLAY = 1;\nconst LINEBATCH_GIZMO = 2;\nconst SHADOWUPDATE_NONE = 0;\nconst SHADOWUPDATE_THISFRAME = 1;\nconst SHADOWUPDATE_REALTIME = 2;\nconst SORTKEY_FORWARD = 0;\nconst SORTKEY_DEPTH = 1;\nconst MASK_AFFECT_DYNAMIC = 1;\nconst MASK_AFFECT_LIGHTMAPPED = 2;\nconst MASK_BAKE = 4;\nconst SHADER_FORWARD = 0;\nconst SHADER_FORWARDHDR = 1;\nconst SHADER_DEPTH = 2;\nconst SHADER_PICK = 3;\nconst SHADER_SHADOW = 4;\nconst SHADERPASS_FORWARD = 'forward';\nconst SHADERPASS_ALBEDO = 'debug_albedo';\nconst SHADERPASS_WORLDNORMAL = 'debug_world_normal';\nconst SHADERPASS_OPACITY = 'debug_opacity';\nconst SHADERPASS_SPECULARITY = 'debug_specularity';\nconst SHADERPASS_GLOSS = 'debug_gloss';\nconst SHADERPASS_METALNESS = 'debug_metalness';\nconst SHADERPASS_AO = 'debug_ao';\nconst SHADERPASS_EMISSION = 'debug_emission';\nconst SHADERPASS_LIGHTING = 'debug_lighting';\nconst SHADERPASS_UV0 = 'debug_uv0';\nconst SPRITE_RENDERMODE_SIMPLE = 0;\nconst SPRITE_RENDERMODE_SLICED = 1;\nconst SPRITE_RENDERMODE_TILED = 2;\nconst BAKE_COLOR = 0;\nconst BAKE_COLORDIR = 1;\nconst VIEW_CENTER = 0;\nconst VIEW_LEFT = 1;\nconst VIEW_RIGHT = 2;\nconst SORTMODE_NONE = 0;\nconst SORTMODE_MANUAL = 1;\nconst SORTMODE_MATERIALMESH = 2;\nconst SORTMODE_BACK2FRONT = 3;\nconst SORTMODE_FRONT2BACK = 4;\nconst SORTMODE_CUSTOM = 5;\nconst ASPECT_AUTO = 0;\nconst ASPECT_MANUAL = 1;\nconst ORIENTATION_HORIZONTAL = 0;\nconst ORIENTATION_VERTICAL = 1;\n\nexport { ASPECT_AUTO, ASPECT_MANUAL, BAKE_COLOR, BAKE_COLORDIR, BLEND_ADDITIVE, BLEND_ADDITIVEALPHA, BLEND_MAX, BLEND_MIN, BLEND_MULTIPLICATIVE, BLEND_MULTIPLICATIVE2X, BLEND_NONE, BLEND_NORMAL, BLEND_PREMULTIPLIED, BLEND_SCREEN, BLEND_SUBTRACTIVE, BLUR_BOX, BLUR_GAUSSIAN, CUBEPROJ_BOX, CUBEPROJ_NONE, DETAILMODE_ADD, DETAILMODE_MAX, DETAILMODE_MIN, DETAILMODE_MUL, DETAILMODE_OVERLAY, DETAILMODE_SCREEN, EMITTERSHAPE_BOX, EMITTERSHAPE_SPHERE, FOG_EXP, FOG_EXP2, FOG_LINEAR, FOG_NONE, FRESNEL_NONE, FRESNEL_SCHLICK, GAMMA_NONE, GAMMA_SRGB, GAMMA_SRGBFAST, GAMMA_SRGBHDR, LAYERID_DEPTH, LAYERID_IMMEDIATE, LAYERID_SKYBOX, LAYERID_UI, LAYERID_WORLD, LAYER_FX, LAYER_GIZMO, LAYER_HUD, LAYER_WORLD, LIGHTFALLOFF_INVERSESQUARED, LIGHTFALLOFF_LINEAR, LIGHTSHAPE_DISK, LIGHTSHAPE_PUNCTUAL, LIGHTSHAPE_RECT, LIGHTSHAPE_SPHERE, LIGHTTYPE_COUNT, LIGHTTYPE_DIRECTIONAL, LIGHTTYPE_OMNI, LIGHTTYPE_POINT, LIGHTTYPE_SPOT, LINEBATCH_GIZMO, LINEBATCH_OVERLAY, LINEBATCH_WORLD, MASK_AFFECT_DYNAMIC, MASK_AFFECT_LIGHTMAPPED, MASK_BAKE, ORIENTATION_HORIZONTAL, ORIENTATION_VERTICAL, PARTICLEMODE_CPU, PARTICLEMODE_GPU, PARTICLEORIENTATION_EMITTER, PARTICLEORIENTATION_SCREEN, PARTICLEORIENTATION_WORLD, PARTICLESORT_DISTANCE, PARTICLESORT_NEWER_FIRST, PARTICLESORT_NONE, PARTICLESORT_OLDER_FIRST, PROJECTION_ORTHOGRAPHIC, PROJECTION_PERSPECTIVE, RENDERSTYLE_POINTS, RENDERSTYLE_SOLID, RENDERSTYLE_WIREFRAME, SHADERDEF_DIRLM, SHADERDEF_INSTANCING, SHADERDEF_LM, SHADERDEF_LMAMBIENT, SHADERDEF_MORPH_NORMAL, SHADERDEF_MORPH_POSITION, SHADERDEF_MORPH_TEXTURE_BASED, SHADERDEF_NOSHADOW, SHADERDEF_SCREENSPACE, SHADERDEF_SKIN, SHADERDEF_TANGENTS, SHADERDEF_UV0, SHADERDEF_UV1, SHADERDEF_VCOLOR, SHADERPASS_ALBEDO, SHADERPASS_AO, SHADERPASS_EMISSION, SHADERPASS_FORWARD, SHADERPASS_GLOSS, SHADERPASS_LIGHTING, SHADERPASS_METALNESS, SHADERPASS_OPACITY, SHADERPASS_SPECULARITY, SHADERPASS_UV0, SHADERPASS_WORLDNORMAL, SHADER_DEPTH, SHADER_FORWARD, SHADER_FORWARDHDR, SHADER_PICK, SHADER_SHADOW, SHADOWUPDATE_NONE, SHADOWUPDATE_REALTIME, SHADOWUPDATE_THISFRAME, SHADOW_DEPTH, SHADOW_PCF1, SHADOW_PCF3, SHADOW_PCF5, SHADOW_PCSS, SHADOW_VSM16, SHADOW_VSM32, SHADOW_VSM8, SORTKEY_DEPTH, SORTKEY_FORWARD, SORTMODE_BACK2FRONT, SORTMODE_CUSTOM, SORTMODE_FRONT2BACK, SORTMODE_MANUAL, SORTMODE_MATERIALMESH, SORTMODE_NONE, SPECOCC_AO, SPECOCC_GLOSSDEPENDENT, SPECOCC_NONE, SPECULAR_BLINN, SPECULAR_PHONG, SPRITE_RENDERMODE_SIMPLE, SPRITE_RENDERMODE_SLICED, SPRITE_RENDERMODE_TILED, TONEMAP_ACES, TONEMAP_ACES2, TONEMAP_FILMIC, TONEMAP_HEJL, TONEMAP_LINEAR, VIEW_CENTER, VIEW_LEFT, VIEW_RIGHT, shadowTypeToString };\n","class RefCountedObject {\n\tconstructor() {\n\t\tthis._refCount = 0;\n\t}\n\tincRefCount() {\n\t\tthis._refCount++;\n\t}\n\tdecRefCount() {\n\t\tthis._refCount--;\n\t}\n\tget refCount() {\n\t\treturn this._refCount;\n\t}\n}\n\nexport { RefCountedObject };\n","class GraphicsDeviceAccess {\n\tstatic set(graphicsDevice) {\n\t\tGraphicsDeviceAccess._graphicsDevice = graphicsDevice;\n\t}\n\tstatic get() {\n\t\treturn GraphicsDeviceAccess._graphicsDevice;\n\t}\n}\nGraphicsDeviceAccess._graphicsDevice = null;\n\nexport { GraphicsDeviceAccess };\n","import '../core/tracing.js';\nimport { RefCountedObject } from '../core/ref-counted-object.js';\nimport { Vec3 } from '../core/math/vec3.js';\nimport { BoundingBox } from '../core/shape/bounding-box.js';\nimport { SEMANTIC_POSITION, SEMANTIC_BLENDWEIGHT, SEMANTIC_BLENDINDICES, TYPE_UINT16, TYPE_INT16, TYPE_UINT8, TYPE_INT8, BUFFER_STATIC, BUFFER_DYNAMIC, TYPE_FLOAT32, SEMANTIC_NORMAL, SEMANTIC_TEXCOORD, SEMANTIC_COLOR, PRIMITIVE_TRIANGLES, INDEXFORMAT_UINT32, INDEXFORMAT_UINT16, PRIMITIVE_POINTS, typedArrayIndexFormats, PRIMITIVE_LINES } from '../platform/graphics/constants.js';\nimport { IndexBuffer } from '../platform/graphics/index-buffer.js';\nimport { VertexBuffer } from '../platform/graphics/vertex-buffer.js';\nimport { VertexFormat } from '../platform/graphics/vertex-format.js';\nimport { VertexIterator } from '../platform/graphics/vertex-iterator.js';\nimport { GraphicsDeviceAccess } from '../platform/graphics/graphics-device-access.js';\nimport { RENDERSTYLE_WIREFRAME, RENDERSTYLE_POINTS, RENDERSTYLE_SOLID } from './constants.js';\n\nlet id = 0;\nclass GeometryData {\n\tconstructor() {\n\t\tthis.initDefaults();\n\t}\n\tinitDefaults() {\n\t\tthis.recreate = false;\n\t\tthis.verticesUsage = BUFFER_STATIC;\n\t\tthis.indicesUsage = BUFFER_STATIC;\n\t\tthis.maxVertices = 0;\n\t\tthis.maxIndices = 0;\n\t\tthis.vertexCount = 0;\n\t\tthis.indexCount = 0;\n\t\tthis.vertexStreamsUpdated = false;\n\t\tthis.indexStreamUpdated = false;\n\t\tthis.vertexStreamDictionary = {};\n\t\tthis.indices = null;\n\t}\n\t_changeVertexCount(count, semantic) {\n\t\tif (!this.vertexCount) {\n\t\t\tthis.vertexCount = count;\n\t\t}\n\t}\n}\nGeometryData.DEFAULT_COMPONENTS_POSITION = 3;\nGeometryData.DEFAULT_COMPONENTS_NORMAL = 3;\nGeometryData.DEFAULT_COMPONENTS_UV = 2;\nGeometryData.DEFAULT_COMPONENTS_COLORS = 4;\nclass GeometryVertexStream {\n\tconstructor(data, componentCount, dataType, dataTypeNormalize) {\n\t\tthis.data = data;\n\t\tthis.componentCount = componentCount;\n\t\tthis.dataType = dataType;\n\t\tthis.dataTypeNormalize = dataTypeNormalize;\n\t}\n}\nclass Mesh extends RefCountedObject {\n\tconstructor(graphicsDevice) {\n\t\tsuper();\n\t\tthis._aabbVer = 0;\n\t\tthis._aabb = new BoundingBox();\n\t\tthis.id = id++;\n\t\tthis.device = graphicsDevice || GraphicsDeviceAccess.get();\n\t\tthis.vertexBuffer = null;\n\t\tthis.indexBuffer = [null];\n\t\tthis.primitive = [{\n\t\t\ttype: 0,\n\t\t\tbase: 0,\n\t\t\tcount: 0\n\t\t}];\n\t\tthis.skin = null;\n\t\tthis._morph = null;\n\t\tthis._geometryData = null;\n\t\tthis.boneAabb = null;\n\t}\n\tset morph(morph) {\n\t\tif (morph !== this._morph) {\n\t\t\tif (this._morph) {\n\t\t\t\tthis._morph.decRefCount();\n\t\t\t}\n\t\t\tthis._morph = morph;\n\t\t\tif (morph) {\n\t\t\t\tmorph.incRefCount();\n\t\t\t}\n\t\t}\n\t}\n\tget morph() {\n\t\treturn this._morph;\n\t}\n\tset aabb(aabb) {\n\t\tthis._aabb = aabb;\n\t\tthis._aabbVer++;\n\t}\n\tget aabb() {\n\t\treturn this._aabb;\n\t}\n\tdestroy() {\n\t\tconst morph = this.morph;\n\t\tif (morph) {\n\t\t\tthis.morph = null;\n\t\t\tif (morph.refCount < 1) {\n\t\t\t\tmorph.destroy();\n\t\t\t}\n\t\t}\n\t\tif (this.vertexBuffer) {\n\t\t\tthis.vertexBuffer.destroy();\n\t\t\tthis.vertexBuffer = null;\n\t\t}\n\t\tfor (let j = 0; j < this.indexBuffer.length; j++) {\n\t\t\tthis._destroyIndexBuffer(j);\n\t\t}\n\t\tthis.indexBuffer.length = 0;\n\t\tthis._geometryData = null;\n\t}\n\t_destroyIndexBuffer(index) {\n\t\tif (this.indexBuffer[index]) {\n\t\t\tthis.indexBuffer[index].destroy();\n\t\t\tthis.indexBuffer[index] = null;\n\t\t}\n\t}\n\t_initBoneAabbs(morphTargets) {\n\t\tthis.boneAabb = [];\n\t\tthis.boneUsed = [];\n\t\tlet x, y, z;\n\t\tlet bMax, bMin;\n\t\tconst boneMin = [];\n\t\tconst boneMax = [];\n\t\tconst boneUsed = this.boneUsed;\n\t\tconst numBones = this.skin.boneNames.length;\n\t\tlet maxMorphX, maxMorphY, maxMorphZ;\n\t\tfor (let i = 0; i < numBones; i++) {\n\t\t\tboneMin[i] = new Vec3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE);\n\t\t\tboneMax[i] = new Vec3(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE);\n\t\t}\n\t\tconst iterator = new VertexIterator(this.vertexBuffer);\n\t\tconst posElement = iterator.element[SEMANTIC_POSITION];\n\t\tconst weightsElement = iterator.element[SEMANTIC_BLENDWEIGHT];\n\t\tconst indicesElement = iterator.element[SEMANTIC_BLENDINDICES];\n\t\tconst numVerts = this.vertexBuffer.numVertices;\n\t\tfor (let j = 0; j < numVerts; j++) {\n\t\t\tfor (let k = 0; k < 4; k++) {\n\t\t\t\tconst boneWeight = weightsElement.array[weightsElement.index + k];\n\t\t\t\tif (boneWeight > 0) {\n\t\t\t\t\tconst boneIndex = indicesElement.array[indicesElement.index + k];\n\t\t\t\t\tboneUsed[boneIndex] = true;\n\t\t\t\t\tx = posElement.array[posElement.index];\n\t\t\t\t\ty = posElement.array[posElement.index + 1];\n\t\t\t\t\tz = posElement.array[posElement.index + 2];\n\t\t\t\t\tbMax = boneMax[boneIndex];\n\t\t\t\t\tbMin = boneMin[boneIndex];\n\t\t\t\t\tif (bMin.x > x) bMin.x = x;\n\t\t\t\t\tif (bMin.y > y) bMin.y = y;\n\t\t\t\t\tif (bMin.z > z) bMin.z = z;\n\t\t\t\t\tif (bMax.x < x) bMax.x = x;\n\t\t\t\t\tif (bMax.y < y) bMax.y = y;\n\t\t\t\t\tif (bMax.z < z) bMax.z = z;\n\t\t\t\t\tif (morphTargets) {\n\t\t\t\t\t\tlet minMorphX = maxMorphX = x;\n\t\t\t\t\t\tlet minMorphY = maxMorphY = y;\n\t\t\t\t\t\tlet minMorphZ = maxMorphZ = z;\n\t\t\t\t\t\tfor (let l = 0; l < morphTargets.length; l++) {\n\t\t\t\t\t\t\tconst target = morphTargets[l];\n\t\t\t\t\t\t\tconst dx = target.deltaPositions[j * 3];\n\t\t\t\t\t\t\tconst dy = target.deltaPositions[j * 3 + 1];\n\t\t\t\t\t\t\tconst dz = target.deltaPositions[j * 3 + 2];\n\t\t\t\t\t\t\tif (dx < 0) {\n\t\t\t\t\t\t\t\tminMorphX += dx;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tmaxMorphX += dx;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (dy < 0) {\n\t\t\t\t\t\t\t\tminMorphY += dy;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tmaxMorphY += dy;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (dz < 0) {\n\t\t\t\t\t\t\t\tminMorphZ += dz;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tmaxMorphZ += dz;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (bMin.x > minMorphX) bMin.x = minMorphX;\n\t\t\t\t\t\tif (bMin.y > minMorphY) bMin.y = minMorphY;\n\t\t\t\t\t\tif (bMin.z > minMorphZ) bMin.z = minMorphZ;\n\t\t\t\t\t\tif (bMax.x < maxMorphX) bMax.x = maxMorphX;\n\t\t\t\t\t\tif (bMax.y < maxMorphY) bMax.y = maxMorphY;\n\t\t\t\t\t\tif (bMax.z < maxMorphZ) bMax.z = maxMorphZ;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\titerator.next();\n\t\t}\n\t\tconst positionElement = this.vertexBuffer.getFormat().elements.find(e => e.name === SEMANTIC_POSITION);\n\t\tif (positionElement && positionElement.normalize) {\n\t\t\tconst func = (() => {\n\t\t\t\tswitch (positionElement.dataType) {\n\t\t\t\t\tcase TYPE_INT8:\n\t\t\t\t\t\treturn x => Math.max(x / 127.0, -1.0);\n\t\t\t\t\tcase TYPE_UINT8:\n\t\t\t\t\t\treturn x => x / 255.0;\n\t\t\t\t\tcase TYPE_INT16:\n\t\t\t\t\t\treturn x => Math.max(x / 32767.0, -1.0);\n\t\t\t\t\tcase TYPE_UINT16:\n\t\t\t\t\t\treturn x => x / 65535.0;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treturn x => x;\n\t\t\t\t}\n\t\t\t})();\n\t\t\tfor (let i = 0; i < numBones; i++) {\n\t\t\t\tif (boneUsed[i]) {\n\t\t\t\t\tconst min = boneMin[i];\n\t\t\t\t\tconst max = boneMax[i];\n\t\t\t\t\tmin.set(func(min.x), func(min.y), func(min.z));\n\t\t\t\t\tmax.set(func(max.x), func(max.y), func(max.z));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor (let i = 0; i < numBones; i++) {\n\t\t\tconst aabb = new BoundingBox();\n\t\t\taabb.setMinMax(boneMin[i], boneMax[i]);\n\t\t\tthis.boneAabb.push(aabb);\n\t\t}\n\t}\n\t_initGeometryData() {\n\t\tif (!this._geometryData) {\n\t\t\tthis._geometryData = new GeometryData();\n\t\t\tif (this.vertexBuffer) {\n\t\t\t\tthis._geometryData.vertexCount = this.vertexBuffer.numVertices;\n\t\t\t\tthis._geometryData.maxVertices = this.vertexBuffer.numVertices;\n\t\t\t}\n\t\t\tif (this.indexBuffer.length > 0 && this.indexBuffer[0]) {\n\t\t\t\tthis._geometryData.indexCount = this.indexBuffer[0].numIndices;\n\t\t\t\tthis._geometryData.maxIndices = this.indexBuffer[0].numIndices;\n\t\t\t}\n\t\t}\n\t}\n\tclear(verticesDynamic, indicesDynamic, maxVertices = 0, maxIndices = 0) {\n\t\tthis._initGeometryData();\n\t\tthis._geometryData.initDefaults();\n\t\tthis._geometryData.recreate = true;\n\t\tthis._geometryData.maxVertices = maxVertices;\n\t\tthis._geometryData.maxIndices = maxIndices;\n\t\tthis._geometryData.verticesUsage = verticesDynamic ? BUFFER_STATIC : BUFFER_DYNAMIC;\n\t\tthis._geometryData.indicesUsage = indicesDynamic ? BUFFER_STATIC : BUFFER_DYNAMIC;\n\t}\n\tsetVertexStream(semantic, data, componentCount, numVertices, dataType = TYPE_FLOAT32, dataTypeNormalize = false) {\n\t\tthis._initGeometryData();\n\t\tconst vertexCount = numVertices || data.length / componentCount;\n\t\tthis._geometryData._changeVertexCount(vertexCount, semantic);\n\t\tthis._geometryData.vertexStreamsUpdated = true;\n\t\tthis._geometryData.vertexStreamDictionary[semantic] = new GeometryVertexStream(data, componentCount, dataType, dataTypeNormalize);\n\t}\n\tgetVertexStream(semantic, data) {\n\t\tlet count = 0;\n\t\tlet done = false;\n\t\tif (this._geometryData) {\n\t\t\tconst stream = this._geometryData.vertexStreamDictionary[semantic];\n\t\t\tif (stream) {\n\t\t\t\tdone = true;\n\t\t\t\tcount = this._geometryData.vertexCount;\n\t\t\t\tif (ArrayBuffer.isView(data)) {\n\t\t\t\t\tdata.set(stream.data);\n\t\t\t\t} else {\n\t\t\t\t\tdata.length = 0;\n\t\t\t\t\tdata.push(stream.data);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (!done) {\n\t\t\tif (this.vertexBuffer) {\n\t\t\t\tconst iterator = new VertexIterator(this.vertexBuffer);\n\t\t\t\tcount = iterator.readData(semantic, data);\n\t\t\t}\n\t\t}\n\t\treturn count;\n\t}\n\tsetPositions(positions, componentCount = GeometryData.DEFAULT_COMPONENTS_POSITION, numVertices) {\n\t\tthis.setVertexStream(SEMANTIC_POSITION, positions, componentCount, numVertices, TYPE_FLOAT32, false);\n\t}\n\tsetNormals(normals, componentCount = GeometryData.DEFAULT_COMPONENTS_NORMAL, numVertices) {\n\t\tthis.setVertexStream(SEMANTIC_NORMAL, normals, componentCount, numVertices, TYPE_FLOAT32, false);\n\t}\n\tsetUvs(channel, uvs, componentCount = GeometryData.DEFAULT_COMPONENTS_UV, numVertices) {\n\t\tthis.setVertexStream(SEMANTIC_TEXCOORD + channel, uvs, componentCount, numVertices, TYPE_FLOAT32, false);\n\t}\n\tsetColors(colors, componentCount = GeometryData.DEFAULT_COMPONENTS_COLORS, numVertices) {\n\t\tthis.setVertexStream(SEMANTIC_COLOR, colors, componentCount, numVertices, TYPE_FLOAT32, false);\n\t}\n\tsetColors32(colors, numVertices) {\n\t\tthis.setVertexStream(SEMANTIC_COLOR, colors, GeometryData.DEFAULT_COMPONENTS_COLORS, numVertices, TYPE_UINT8, true);\n\t}\n\tsetIndices(indices, numIndices) {\n\t\tthis._initGeometryData();\n\t\tthis._geometryData.indexStreamUpdated = true;\n\t\tthis._geometryData.indices = indices;\n\t\tthis._geometryData.indexCount = numIndices || indices.length;\n\t}\n\tgetPositions(positions) {\n\t\treturn this.getVertexStream(SEMANTIC_POSITION, positions);\n\t}\n\tgetNormals(normals) {\n\t\treturn this.getVertexStream(SEMANTIC_NORMAL, normals);\n\t}\n\tgetUvs(channel, uvs) {\n\t\treturn this.getVertexStream(SEMANTIC_TEXCOORD + channel, uvs);\n\t}\n\tgetColors(colors) {\n\t\treturn this.getVertexStream(SEMANTIC_COLOR, colors);\n\t}\n\tgetIndices(indices) {\n\t\tlet count = 0;\n\t\tif (this._geometryData && this._geometryData.indices) {\n\t\t\tconst streamIndices = this._geometryData.indices;\n\t\t\tcount = this._geometryData.indexCount;\n\t\t\tif (ArrayBuffer.isView(indices)) {\n\t\t\t\tindices.set(streamIndices);\n\t\t\t} else {\n\t\t\t\tindices.length = 0;\n\t\t\t\tfor (let i = 0, il = streamIndices.length; i < il; i++) {\n\t\t\t\t\tindices.push(streamIndices[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (this.indexBuffer.length > 0 && this.indexBuffer[0]) {\n\t\t\t\tconst indexBuffer = this.indexBuffer[0];\n\t\t\t\tcount = indexBuffer.readData(indices);\n\t\t\t}\n\t\t}\n\t\treturn count;\n\t}\n\tupdate(primitiveType = PRIMITIVE_TRIANGLES, updateBoundingBox = true) {\n\t\tif (this._geometryData) {\n\t\t\tif (updateBoundingBox) {\n\t\t\t\tconst stream = this._geometryData.vertexStreamDictionary[SEMANTIC_POSITION];\n\t\t\t\tif (stream) {\n\t\t\t\t\tif (stream.componentCount === 3) {\n\t\t\t\t\t\tthis._aabb.compute(stream.data, this._geometryData.vertexCount);\n\t\t\t\t\t\tthis._aabbVer++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet destroyVB = this._geometryData.recreate;\n\t\t\tif (this._geometryData.vertexCount > this._geometryData.maxVertices) {\n\t\t\t\tdestroyVB = true;\n\t\t\t\tthis._geometryData.maxVertices = this._geometryData.vertexCount;\n\t\t\t}\n\t\t\tif (destroyVB) {\n\t\t\t\tif (this.vertexBuffer) {\n\t\t\t\t\tthis.vertexBuffer.destroy();\n\t\t\t\t\tthis.vertexBuffer = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet destroyIB = this._geometryData.recreate;\n\t\t\tif (this._geometryData.indexCount > this._geometryData.maxIndices) {\n\t\t\t\tdestroyIB = true;\n\t\t\t\tthis._geometryData.maxIndices = this._geometryData.indexCount;\n\t\t\t}\n\t\t\tif (destroyIB) {\n\t\t\t\tif (this.indexBuffer.length > 0 && this.indexBuffer[0]) {\n\t\t\t\t\tthis.indexBuffer[0].destroy();\n\t\t\t\t\tthis.indexBuffer[0] = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this._geometryData.vertexStreamsUpdated) {\n\t\t\t\tthis._updateVertexBuffer();\n\t\t\t}\n\t\t\tif (this._geometryData.indexStreamUpdated) {\n\t\t\t\tthis._updateIndexBuffer();\n\t\t\t}\n\t\t\tthis.primitive[0].type = primitiveType;\n\t\t\tif (this.indexBuffer.length > 0 && this.indexBuffer[0]) {\n\t\t\t\tif (this._geometryData.indexStreamUpdated) {\n\t\t\t\t\tthis.primitive[0].count = this._geometryData.indexCount;\n\t\t\t\t\tthis.primitive[0].indexed = true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this._geometryData.vertexStreamsUpdated) {\n\t\t\t\t\tthis.primitive[0].count = this._geometryData.vertexCount;\n\t\t\t\t\tthis.primitive[0].indexed = false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._geometryData.vertexCount = 0;\n\t\t\tthis._geometryData.indexCount = 0;\n\t\t\tthis._geometryData.vertexStreamsUpdated = false;\n\t\t\tthis._geometryData.indexStreamUpdated = false;\n\t\t\tthis._geometryData.recreate = false;\n\t\t\tthis.updateRenderStates();\n\t\t}\n\t}\n\t_buildVertexFormat(vertexCount) {\n\t\tconst vertexDesc = [];\n\t\tfor (const semantic in this._geometryData.vertexStreamDictionary) {\n\t\t\tconst stream = this._geometryData.vertexStreamDictionary[semantic];\n\t\t\tvertexDesc.push({\n\t\t\t\tsemantic: semantic,\n\t\t\t\tcomponents: stream.componentCount,\n\t\t\t\ttype: stream.dataType,\n\t\t\t\tnormalize: stream.dataTypeNormalize\n\t\t\t});\n\t\t}\n\t\treturn new VertexFormat(this.device, vertexDesc, vertexCount);\n\t}\n\t_updateVertexBuffer() {\n\t\tif (!this.vertexBuffer) {\n\t\t\tconst allocateVertexCount = this._geometryData.maxVertices;\n\t\t\tconst format = this._buildVertexFormat(allocateVertexCount);\n\t\t\tthis.vertexBuffer = new VertexBuffer(this.device, format, allocateVertexCount, this._geometryData.verticesUsage);\n\t\t}\n\t\tconst iterator = new VertexIterator(this.vertexBuffer);\n\t\tconst numVertices = this._geometryData.vertexCount;\n\t\tfor (const semantic in this._geometryData.vertexStreamDictionary) {\n\t\t\tconst stream = this._geometryData.vertexStreamDictionary[semantic];\n\t\t\titerator.writeData(semantic, stream.data, numVertices);\n\t\t\tdelete this._geometryData.vertexStreamDictionary[semantic];\n\t\t}\n\t\titerator.end();\n\t}\n\t_updateIndexBuffer() {\n\t\tif (this.indexBuffer.length <= 0 || !this.indexBuffer[0]) {\n\t\t\tconst createFormat = this._geometryData.maxVertices > 0xffff ? INDEXFORMAT_UINT32 : INDEXFORMAT_UINT16;\n\t\t\tthis.indexBuffer[0] = new IndexBuffer(this.device, createFormat, this._geometryData.maxIndices, this._geometryData.indicesUsage);\n\t\t}\n\t\tconst srcIndices = this._geometryData.indices;\n\t\tif (srcIndices) {\n\t\t\tconst indexBuffer = this.indexBuffer[0];\n\t\t\tindexBuffer.writeData(srcIndices, this._geometryData.indexCount);\n\t\t\tthis._geometryData.indices = null;\n\t\t}\n\t}\n\tprepareRenderState(renderStyle) {\n\t\tif (renderStyle === RENDERSTYLE_WIREFRAME) {\n\t\t\tthis.generateWireframe();\n\t\t} else if (renderStyle === RENDERSTYLE_POINTS) {\n\t\t\tthis.primitive[RENDERSTYLE_POINTS] = {\n\t\t\t\ttype: PRIMITIVE_POINTS,\n\t\t\t\tbase: 0,\n\t\t\t\tcount: this.vertexBuffer ? this.vertexBuffer.numVertices : 0,\n\t\t\t\tindexed: false\n\t\t\t};\n\t\t}\n\t}\n\tupdateRenderStates() {\n\t\tif (this.primitive[RENDERSTYLE_POINTS]) {\n\t\t\tthis.prepareRenderState(RENDERSTYLE_POINTS);\n\t\t}\n\t\tif (this.primitive[RENDERSTYLE_WIREFRAME]) {\n\t\t\tthis.prepareRenderState(RENDERSTYLE_WIREFRAME);\n\t\t}\n\t}\n\tgenerateWireframe() {\n\t\tthis._destroyIndexBuffer(RENDERSTYLE_WIREFRAME);\n\t\tconst numVertices = this.vertexBuffer.numVertices;\n\t\tconst lines = [];\n\t\tlet format;\n\t\tif (this.indexBuffer.length > 0 && this.indexBuffer[0]) {\n\t\t\tconst offsets = [[0, 1], [1, 2], [2, 0]];\n\t\t\tconst base = this.primitive[RENDERSTYLE_SOLID].base;\n\t\t\tconst count = this.primitive[RENDERSTYLE_SOLID].count;\n\t\t\tconst indexBuffer = this.indexBuffer[RENDERSTYLE_SOLID];\n\t\t\tconst srcIndices = new typedArrayIndexFormats[indexBuffer.format](indexBuffer.storage);\n\t\t\tconst seen = new Set();\n\t\t\tfor (let j = base; j < base + count; j += 3) {\n\t\t\t\tfor (let k = 0; k < 3; k++) {\n\t\t\t\t\tconst i1 = srcIndices[j + offsets[k][0]];\n\t\t\t\t\tconst i2 = srcIndices[j + offsets[k][1]];\n\t\t\t\t\tconst hash = i1 > i2 ? i2 * numVertices + i1 : i1 * numVertices + i2;\n\t\t\t\t\tif (!seen.has(hash)) {\n\t\t\t\t\t\tseen.add(hash);\n\t\t\t\t\t\tlines.push(i1, i2);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tformat = indexBuffer.format;\n\t\t} else {\n\t\t\tfor (let i = 0; i < numVertices; i += 3) {\n\t\t\t\tlines.push(i, i + 1, i + 1, i + 2, i + 2, i);\n\t\t\t}\n\t\t\tformat = lines.length > 65535 ? INDEXFORMAT_UINT32 : INDEXFORMAT_UINT16;\n\t\t}\n\t\tconst wireBuffer = new IndexBuffer(this.vertexBuffer.device, format, lines.length);\n\t\tconst dstIndices = new typedArrayIndexFormats[wireBuffer.format](wireBuffer.storage);\n\t\tdstIndices.set(lines);\n\t\twireBuffer.unlock();\n\t\tthis.primitive[RENDERSTYLE_WIREFRAME] = {\n\t\t\ttype: PRIMITIVE_LINES,\n\t\t\tbase: 0,\n\t\t\tcount: lines.length,\n\t\t\tindexed: true\n\t\t};\n\t\tthis.indexBuffer[RENDERSTYLE_WIREFRAME] = wireBuffer;\n\t}\n}\n\nexport { Mesh };\n","import { Vec2 } from '../core/math/vec2.js';\nimport { Vec3 } from '../core/math/vec3.js';\nimport { SEMANTIC_TANGENT, SEMANTIC_BLENDINDICES, TYPE_UINT8, SEMANTIC_BLENDWEIGHT } from '../platform/graphics/constants.js';\nimport { Mesh } from './mesh.js';\n\nconst primitiveUv1Padding = 4.0 / 64;\nconst primitiveUv1PaddingScale = 1.0 - primitiveUv1Padding * 2;\nconst shapePrimitives = [];\nfunction calculateNormals(positions, indices) {\n\tconst triangleCount = indices.length / 3;\n\tconst vertexCount = positions.length / 3;\n\tconst p1 = new Vec3();\n\tconst p2 = new Vec3();\n\tconst p3 = new Vec3();\n\tconst p1p2 = new Vec3();\n\tconst p1p3 = new Vec3();\n\tconst faceNormal = new Vec3();\n\tconst normals = [];\n\tfor (let i = 0; i < positions.length; i++) {\n\t\tnormals[i] = 0;\n\t}\n\tfor (let i = 0; i < triangleCount; i++) {\n\t\tconst i1 = indices[i * 3];\n\t\tconst i2 = indices[i * 3 + 1];\n\t\tconst i3 = indices[i * 3 + 2];\n\t\tp1.set(positions[i1 * 3], positions[i1 * 3 + 1], positions[i1 * 3 + 2]);\n\t\tp2.set(positions[i2 * 3], positions[i2 * 3 + 1], positions[i2 * 3 + 2]);\n\t\tp3.set(positions[i3 * 3], positions[i3 * 3 + 1], positions[i3 * 3 + 2]);\n\t\tp1p2.sub2(p2, p1);\n\t\tp1p3.sub2(p3, p1);\n\t\tfaceNormal.cross(p1p2, p1p3).normalize();\n\t\tnormals[i1 * 3] += faceNormal.x;\n\t\tnormals[i1 * 3 + 1] += faceNormal.y;\n\t\tnormals[i1 * 3 + 2] += faceNormal.z;\n\t\tnormals[i2 * 3] += faceNormal.x;\n\t\tnormals[i2 * 3 + 1] += faceNormal.y;\n\t\tnormals[i2 * 3 + 2] += faceNormal.z;\n\t\tnormals[i3 * 3] += faceNormal.x;\n\t\tnormals[i3 * 3 + 1] += faceNormal.y;\n\t\tnormals[i3 * 3 + 2] += faceNormal.z;\n\t}\n\tfor (let i = 0; i < vertexCount; i++) {\n\t\tconst nx = normals[i * 3];\n\t\tconst ny = normals[i * 3 + 1];\n\t\tconst nz = normals[i * 3 + 2];\n\t\tconst invLen = 1 / Math.sqrt(nx * nx + ny * ny + nz * nz);\n\t\tnormals[i * 3] *= invLen;\n\t\tnormals[i * 3 + 1] *= invLen;\n\t\tnormals[i * 3 + 2] *= invLen;\n\t}\n\treturn normals;\n}\nfunction calculateTangents(positions, normals, uvs, indices) {\n\tconst triangleCount = indices.length / 3;\n\tconst vertexCount = positions.length / 3;\n\tconst v1 = new Vec3();\n\tconst v2 = new Vec3();\n\tconst v3 = new Vec3();\n\tconst w1 = new Vec2();\n\tconst w2 = new Vec2();\n\tconst w3 = new Vec2();\n\tconst sdir = new Vec3();\n\tconst tdir = new Vec3();\n\tconst tan1 = new Float32Array(vertexCount * 3);\n\tconst tan2 = new Float32Array(vertexCount * 3);\n\tconst tangents = [];\n\tfor (let i = 0; i < triangleCount; i++) {\n\t\tconst i1 = indices[i * 3];\n\t\tconst i2 = indices[i * 3 + 1];\n\t\tconst i3 = indices[i * 3 + 2];\n\t\tv1.set(positions[i1 * 3], positions[i1 * 3 + 1], positions[i1 * 3 + 2]);\n\t\tv2.set(positions[i2 * 3], positions[i2 * 3 + 1], positions[i2 * 3 + 2]);\n\t\tv3.set(positions[i3 * 3], positions[i3 * 3 + 1], positions[i3 * 3 + 2]);\n\t\tw1.set(uvs[i1 * 2], uvs[i1 * 2 + 1]);\n\t\tw2.set(uvs[i2 * 2], uvs[i2 * 2 + 1]);\n\t\tw3.set(uvs[i3 * 2], uvs[i3 * 2 + 1]);\n\t\tconst x1 = v2.x - v1.x;\n\t\tconst x2 = v3.x - v1.x;\n\t\tconst y1 = v2.y - v1.y;\n\t\tconst y2 = v3.y - v1.y;\n\t\tconst z1 = v2.z - v1.z;\n\t\tconst z2 = v3.z - v1.z;\n\t\tconst s1 = w2.x - w1.x;\n\t\tconst s2 = w3.x - w1.x;\n\t\tconst _t = w2.y - w1.y;\n\t\tconst _t2 = w3.y - w1.y;\n\t\tconst area = s1 * _t2 - s2 * _t;\n\t\tif (area === 0) {\n\t\t\tsdir.set(0, 1, 0);\n\t\t\ttdir.set(1, 0, 0);\n\t\t} else {\n\t\t\tconst r = 1 / area;\n\t\t\tsdir.set((_t2 * x1 - _t * x2) * r, (_t2 * y1 - _t * y2) * r, (_t2 * z1 - _t * z2) * r);\n\t\t\ttdir.set((s1 * x2 - s2 * x1) * r, (s1 * y2 - s2 * y1) * r, (s1 * z2 - s2 * z1) * r);\n\t\t}\n\t\ttan1[i1 * 3 + 0] += sdir.x;\n\t\ttan1[i1 * 3 + 1] += sdir.y;\n\t\ttan1[i1 * 3 + 2] += sdir.z;\n\t\ttan1[i2 * 3 + 0] += sdir.x;\n\t\ttan1[i2 * 3 + 1] += sdir.y;\n\t\ttan1[i2 * 3 + 2] += sdir.z;\n\t\ttan1[i3 * 3 + 0] += sdir.x;\n\t\ttan1[i3 * 3 + 1] += sdir.y;\n\t\ttan1[i3 * 3 + 2] += sdir.z;\n\t\ttan2[i1 * 3 + 0] += tdir.x;\n\t\ttan2[i1 * 3 + 1] += tdir.y;\n\t\ttan2[i1 * 3 + 2] += tdir.z;\n\t\ttan2[i2 * 3 + 0] += tdir.x;\n\t\ttan2[i2 * 3 + 1] += tdir.y;\n\t\ttan2[i2 * 3 + 2] += tdir.z;\n\t\ttan2[i3 * 3 + 0] += tdir.x;\n\t\ttan2[i3 * 3 + 1] += tdir.y;\n\t\ttan2[i3 * 3 + 2] += tdir.z;\n\t}\n\tconst t1 = new Vec3();\n\tconst t2 = new Vec3();\n\tconst n = new Vec3();\n\tconst temp = new Vec3();\n\tfor (let i = 0; i < vertexCount; i++) {\n\t\tn.set(normals[i * 3], normals[i * 3 + 1], normals[i * 3 + 2]);\n\t\tt1.set(tan1[i * 3], tan1[i * 3 + 1], tan1[i * 3 + 2]);\n\t\tt2.set(tan2[i * 3], tan2[i * 3 + 1], tan2[i * 3 + 2]);\n\t\tconst ndott = n.dot(t1);\n\t\ttemp.copy(n).mulScalar(ndott);\n\t\ttemp.sub2(t1, temp).normalize();\n\t\ttangents[i * 4] = temp.x;\n\t\ttangents[i * 4 + 1] = temp.y;\n\t\ttangents[i * 4 + 2] = temp.z;\n\t\ttemp.cross(n, t1);\n\t\ttangents[i * 4 + 3] = temp.dot(t2) < 0.0 ? -1.0 : 1.0;\n\t}\n\treturn tangents;\n}\nfunction createMesh(device, positions, opts) {\n\tconst mesh = new Mesh(device);\n\tmesh.setPositions(positions);\n\tif (opts) {\n\t\tif (opts.normals) {\n\t\t\tmesh.setNormals(opts.normals);\n\t\t}\n\t\tif (opts.tangents) {\n\t\t\tmesh.setVertexStream(SEMANTIC_TANGENT, opts.tangents, 4);\n\t\t}\n\t\tif (opts.colors) {\n\t\t\tmesh.setColors32(opts.colors);\n\t\t}\n\t\tif (opts.uvs) {\n\t\t\tmesh.setUvs(0, opts.uvs);\n\t\t}\n\t\tif (opts.uvs1) {\n\t\t\tmesh.setUvs(1, opts.uvs1);\n\t\t}\n\t\tif (opts.blendIndices) {\n\t\t\tmesh.setVertexStream(SEMANTIC_BLENDINDICES, opts.blendIndices, 4, opts.blendIndices.length / 4, TYPE_UINT8);\n\t\t}\n\t\tif (opts.blendWeights) {\n\t\t\tmesh.setVertexStream(SEMANTIC_BLENDWEIGHT, opts.blendWeights, 4);\n\t\t}\n\t\tif (opts.indices) {\n\t\t\tmesh.setIndices(opts.indices);\n\t\t}\n\t}\n\tmesh.update();\n\treturn mesh;\n}\nfunction createTorus(device, opts = {}) {\n\tvar _opts$tubeRadius, _opts$ringRadius, _opts$segments, _opts$sides, _opts$calculateTangen;\n\tconst rc = (_opts$tubeRadius = opts.tubeRadius) != null ? _opts$tubeRadius : 0.2;\n\tconst rt = (_opts$ringRadius = opts.ringRadius) != null ? _opts$ringRadius : 0.3;\n\tconst segments = (_opts$segments = opts.segments) != null ? _opts$segments : 30;\n\tconst sides = (_opts$sides = opts.sides) != null ? _opts$sides : 20;\n\tconst calcTangents = (_opts$calculateTangen = opts.calculateTangents) != null ? _opts$calculateTangen : false;\n\tconst positions = [];\n\tconst normals = [];\n\tconst uvs = [];\n\tconst indices = [];\n\tfor (let i = 0; i <= sides; i++) {\n\t\tfor (let j = 0; j <= segments; j++) {\n\t\t\tconst x = Math.cos(2 * Math.PI * j / segments) * (rt + rc * Math.cos(2 * Math.PI * i / sides));\n\t\t\tconst y = Math.sin(2 * Math.PI * i / sides) * rc;\n\t\t\tconst z = Math.sin(2 * Math.PI * j / segments) * (rt + rc * Math.cos(2 * Math.PI * i / sides));\n\t\t\tconst nx = Math.cos(2 * Math.PI * j / segments) * Math.cos(2 * Math.PI * i / sides);\n\t\t\tconst ny = Math.sin(2 * Math.PI * i / sides);\n\t\t\tconst nz = Math.sin(2 * Math.PI * j / segments) * Math.cos(2 * Math.PI * i / sides);\n\t\t\tconst u = i / sides;\n\t\t\tconst v = 1 - j / segments;\n\t\t\tpositions.push(x, y, z);\n\t\t\tnormals.push(nx, ny, nz);\n\t\t\tuvs.push(u, 1.0 - v);\n\t\t\tif (i < sides && j < segments) {\n\t\t\t\tconst first = i * (segments + 1) + j;\n\t\t\t\tconst second = (i + 1) * (segments + 1) + j;\n\t\t\t\tconst third = i * (segments + 1) + (j + 1);\n\t\t\t\tconst fourth = (i + 1) * (segments + 1) + (j + 1);\n\t\t\t\tindices.push(first, second, third);\n\t\t\t\tindices.push(second, fourth, third);\n\t\t\t}\n\t\t}\n\t}\n\tconst options = {\n\t\tnormals: normals,\n\t\tuvs: uvs,\n\t\tuvs1: uvs,\n\t\tindices: indices\n\t};\n\tif (calcTangents) {\n\t\toptions.tangents = calculateTangents(positions, normals, uvs, indices);\n\t}\n\treturn createMesh(device, positions, options);\n}\nfunction _createConeData(baseRadius, peakRadius, height, heightSegments, capSegments, roundedCaps) {\n\tconst pos = new Vec3();\n\tconst bottomToTop = new Vec3();\n\tconst norm = new Vec3();\n\tconst top = new Vec3();\n\tconst bottom = new Vec3();\n\tconst tangent = new Vec3();\n\tconst positions = [];\n\tconst normals = [];\n\tconst uvs = [];\n\tconst uvs1 = [];\n\tconst indices = [];\n\tlet offset;\n\tif (height > 0) {\n\t\tfor (let i = 0; i <= heightSegments; i++) {\n\t\t\tfor (let j = 0; j <= capSegments; j++) {\n\t\t\t\tconst theta = j / capSegments * 2 * Math.PI - Math.PI;\n\t\t\t\tconst sinTheta = Math.sin(theta);\n\t\t\t\tconst cosTheta = Math.cos(theta);\n\t\t\t\tbottom.set(sinTheta * baseRadius, -height / 2, cosTheta * baseRadius);\n\t\t\t\ttop.set(sinTheta * peakRadius, height / 2, cosTheta * peakRadius);\n\t\t\t\tpos.lerp(bottom, top, i / heightSegments);\n\t\t\t\tbottomToTop.sub2(top, bottom).normalize();\n\t\t\t\ttangent.set(cosTheta, 0, -sinTheta);\n\t\t\t\tnorm.cross(tangent, bottomToTop).normalize();\n\t\t\t\tpositions.push(pos.x, pos.y, pos.z);\n\t\t\t\tnormals.push(norm.x, norm.y, norm.z);\n\t\t\t\tlet u = j / capSegments;\n\t\t\t\tlet v = i / heightSegments;\n\t\t\t\tuvs.push(u, 1 - v);\n\t\t\t\tconst _v = v;\n\t\t\t\tv = u;\n\t\t\t\tu = _v;\n\t\t\t\tu = u * primitiveUv1PaddingScale + primitiveUv1Padding;\n\t\t\t\tv = v * primitiveUv1PaddingScale + primitiveUv1Padding;\n\t\t\t\tu /= 3;\n\t\t\t\tuvs1.push(u, 1 - v);\n\t\t\t\tif (i < heightSegments && j < capSegments) {\n\t\t\t\t\tconst first = i * (capSegments + 1) + j;\n\t\t\t\t\tconst second = i * (capSegments + 1) + (j + 1);\n\t\t\t\t\tconst third = (i + 1) * (capSegments + 1) + j;\n\t\t\t\t\tconst fourth = (i + 1) * (capSegments + 1) + (j + 1);\n\t\t\t\t\tindices.push(first, second, third);\n\t\t\t\t\tindices.push(second, fourth, third);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tif (roundedCaps) {\n\t\tconst latitudeBands = Math.floor(capSegments / 2);\n\t\tconst longitudeBands = capSegments;\n\t\tconst capOffset = height / 2;\n\t\tfor (let lat = 0; lat <= latitudeBands; lat++) {\n\t\t\tconst theta = lat * Math.PI * 0.5 / latitudeBands;\n\t\t\tconst sinTheta = Math.sin(theta);\n\t\t\tconst cosTheta = Math.cos(theta);\n\t\t\tfor (let lon = 0; lon <= longitudeBands; lon++) {\n\t\t\t\tconst phi = lon * 2 * Math.PI / longitudeBands - Math.PI / 2;\n\t\t\t\tconst sinPhi = Math.sin(phi);\n\t\t\t\tconst cosPhi = Math.cos(phi);\n\t\t\t\tconst x = cosPhi * sinTheta;\n\t\t\t\tconst y = cosTheta;\n\t\t\t\tconst z = sinPhi * sinTheta;\n\t\t\t\tlet u = 1 - lon / longitudeBands;\n\t\t\t\tlet v = 1 - lat / latitudeBands;\n\t\t\t\tpositions.push(x * peakRadius, y * peakRadius + capOffset, z * peakRadius);\n\t\t\t\tnormals.push(x, y, z);\n\t\t\t\tuvs.push(u, 1 - v);\n\t\t\t\tu = u * primitiveUv1PaddingScale + primitiveUv1Padding;\n\t\t\t\tv = v * primitiveUv1PaddingScale + primitiveUv1Padding;\n\t\t\t\tu /= 3;\n\t\t\t\tv /= 3;\n\t\t\t\tu += 1.0 / 3;\n\t\t\t\tuvs1.push(u, 1 - v);\n\t\t\t}\n\t\t}\n\t\toffset = (heightSegments + 1) * (capSegments + 1);\n\t\tfor (let lat = 0; lat < latitudeBands; ++lat) {\n\t\t\tfor (let lon = 0; lon < longitudeBands; ++lon) {\n\t\t\t\tconst first = lat * (longitudeBands + 1) + lon;\n\t\t\t\tconst second = first + longitudeBands + 1;\n\t\t\t\tindices.push(offset + first + 1, offset + second, offset + first);\n\t\t\t\tindices.push(offset + first + 1, offset + second + 1, offset + second);\n\t\t\t}\n\t\t}\n\t\tfor (let lat = 0; lat <= latitudeBands; lat++) {\n\t\t\tconst theta = Math.PI * 0.5 + lat * Math.PI * 0.5 / latitudeBands;\n\t\t\tconst sinTheta = Math.sin(theta);\n\t\t\tconst cosTheta = Math.cos(theta);\n\t\t\tfor (let lon = 0; lon <= longitudeBands; lon++) {\n\t\t\t\tconst phi = lon * 2 * Math.PI / longitudeBands - Math.PI / 2;\n\t\t\t\tconst sinPhi = Math.sin(phi);\n\t\t\t\tconst cosPhi = Math.cos(phi);\n\t\t\t\tconst x = cosPhi * sinTheta;\n\t\t\t\tconst y = cosTheta;\n\t\t\t\tconst z = sinPhi * sinTheta;\n\t\t\t\tlet u = 1 - lon / longitudeBands;\n\t\t\t\tlet v = 1 - lat / latitudeBands;\n\t\t\t\tpositions.push(x * peakRadius, y * peakRadius - capOffset, z * peakRadius);\n\t\t\t\tnormals.push(x, y, z);\n\t\t\t\tuvs.push(u, 1 - v);\n\t\t\t\tu = u * primitiveUv1PaddingScale + primitiveUv1Padding;\n\t\t\t\tv = v * primitiveUv1PaddingScale + primitiveUv1Padding;\n\t\t\t\tu /= 3;\n\t\t\t\tv /= 3;\n\t\t\t\tu += 2.0 / 3;\n\t\t\t\tuvs1.push(u, 1 - v);\n\t\t\t}\n\t\t}\n\t\toffset = (heightSegments + 1) * (capSegments + 1) + (longitudeBands + 1) * (latitudeBands + 1);\n\t\tfor (let lat = 0; lat < latitudeBands; ++lat) {\n\t\t\tfor (let lon = 0; lon < longitudeBands; ++lon) {\n\t\t\t\tconst first = lat * (longitudeBands + 1) + lon;\n\t\t\t\tconst second = first + longitudeBands + 1;\n\t\t\t\tindices.push(offset + first + 1, offset + second, offset + first);\n\t\t\t\tindices.push(offset + first + 1, offset + second + 1, offset + second);\n\t\t\t}\n\t\t}\n\t} else {\n\t\toffset = (heightSegments + 1) * (capSegments + 1);\n\t\tif (baseRadius > 0) {\n\t\t\tfor (let i = 0; i < capSegments; i++) {\n\t\t\t\tconst theta = i / capSegments * 2 * Math.PI;\n\t\t\t\tconst x = Math.sin(theta);\n\t\t\t\tconst y = -height / 2;\n\t\t\t\tconst z = Math.cos(theta);\n\t\t\t\tlet u = 1 - (x + 1) / 2;\n\t\t\t\tlet v = (z + 1) / 2;\n\t\t\t\tpositions.push(x * baseRadius, y, z * baseRadius);\n\t\t\t\tnormals.push(0, -1, 0);\n\t\t\t\tuvs.push(u, 1 - v);\n\t\t\t\tu = u * primitiveUv1PaddingScale + primitiveUv1Padding;\n\t\t\t\tv = v * primitiveUv1PaddingScale + primitiveUv1Padding;\n\t\t\t\tu /= 3;\n\t\t\t\tv /= 3;\n\t\t\t\tu += 1 / 3;\n\t\t\t\tuvs1.push(u, 1 - v);\n\t\t\t\tif (i > 1) {\n\t\t\t\t\tindices.push(offset, offset + i, offset + i - 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\toffset += capSegments;\n\t\tif (peakRadius > 0) {\n\t\t\tfor (let i = 0; i < capSegments; i++) {\n\t\t\t\tconst theta = i / capSegments * 2 * Math.PI;\n\t\t\t\tconst x = Math.sin(theta);\n\t\t\t\tconst y = height / 2;\n\t\t\t\tconst z = Math.cos(theta);\n\t\t\t\tlet u = 1 - (x + 1) / 2;\n\t\t\t\tlet v = (z + 1) / 2;\n\t\t\t\tpositions.push(x * peakRadius, y, z * peakRadius);\n\t\t\t\tnormals.push(0, 1, 0);\n\t\t\t\tuvs.push(u, 1 - v);\n\t\t\t\tu = u * primitiveUv1PaddingScale + primitiveUv1Padding;\n\t\t\t\tv = v * primitiveUv1PaddingScale + primitiveUv1Padding;\n\t\t\t\tu /= 3;\n\t\t\t\tv /= 3;\n\t\t\t\tu += 2 / 3;\n\t\t\t\tuvs1.push(u, 1 - v);\n\t\t\t\tif (i > 1) {\n\t\t\t\t\tindices.push(offset, offset + i - 1, offset + i);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn {\n\t\tpositions: positions,\n\t\tnormals: normals,\n\t\tuvs: uvs,\n\t\tuvs1: uvs1,\n\t\tindices: indices\n\t};\n}\nfunction createCylinder(device, opts = {}) {\n\tvar _opts$radius, _opts$height, _opts$heightSegments, _opts$capSegments, _opts$calculateTangen2;\n\tconst radius = (_opts$radius = opts.radius) != null ? _opts$radius : 0.5;\n\tconst height = (_opts$height = opts.height) != null ? _opts$height : 1;\n\tconst heightSegments = (_opts$heightSegments = opts.heightSegments) != null ? _opts$heightSegments : 5;\n\tconst capSegments = (_opts$capSegments = opts.capSegments) != null ? _opts$capSegments : 20;\n\tconst calcTangents = (_opts$calculateTangen2 = opts.calculateTangents) != null ? _opts$calculateTangen2 : false;\n\tconst options = _createConeData(radius, radius, height, heightSegments, capSegments, false);\n\tif (calcTangents) {\n\t\toptions.tangents = calculateTangents(options.positions, options.normals, options.uvs, options.indices);\n\t}\n\treturn createMesh(device, options.positions, options);\n}\nfunction createCapsule(device, opts = {}) {\n\tvar _opts$radius2, _opts$height2, _opts$heightSegments2, _opts$sides2, _opts$calculateTangen3;\n\tconst radius = (_opts$radius2 = opts.radius) != null ? _opts$radius2 : 0.3;\n\tconst height = (_opts$height2 = opts.height) != null ? _opts$height2 : 1;\n\tconst heightSegments = (_opts$heightSegments2 = opts.heightSegments) != null ? _opts$heightSegments2 : 1;\n\tconst sides = (_opts$sides2 = opts.sides) != null ? _opts$sides2 : 20;\n\tconst calcTangents = (_opts$calculateTangen3 = opts.calculateTangents) != null ? _opts$calculateTangen3 : false;\n\tconst options = _createConeData(radius, radius, height - 2 * radius, heightSegments, sides, true);\n\tif (calcTangents) {\n\t\toptions.tangents = calculateTangents(options.positions, options.normals, options.uvs, options.indices);\n\t}\n\treturn createMesh(device, options.positions, options);\n}\nfunction createCone(device, opts = {}) {\n\tvar _opts$baseRadius, _opts$peakRadius, _opts$height3, _opts$heightSegments3, _opts$capSegments2, _opts$calculateTangen4;\n\tconst baseRadius = (_opts$baseRadius = opts.baseRadius) != null ? _opts$baseRadius : 0.5;\n\tconst peakRadius = (_opts$peakRadius = opts.peakRadius) != null ? _opts$peakRadius : 0;\n\tconst height = (_opts$height3 = opts.height) != null ? _opts$height3 : 1;\n\tconst heightSegments = (_opts$heightSegments3 = opts.heightSegments) != null ? _opts$heightSegments3 : 5;\n\tconst capSegments = (_opts$capSegments2 = opts.capSegments) != null ? _opts$capSegments2 : 18;\n\tconst calcTangents = (_opts$calculateTangen4 = opts.calculateTangents) != null ? _opts$calculateTangen4 : false;\n\tconst options = _createConeData(baseRadius, peakRadius, height, heightSegments, capSegments, false);\n\tif (calcTangents) {\n\t\toptions.tangents = calculateTangents(options.positions, options.normals, options.uvs, options.indices);\n\t}\n\treturn createMesh(device, options.positions, options);\n}\nfunction createSphere(device, opts = {}) {\n\tvar _opts$radius3, _opts$latitudeBands, _opts$longitudeBands, _opts$calculateTangen5;\n\tconst radius = (_opts$radius3 = opts.radius) != null ? _opts$radius3 : 0.5;\n\tconst latitudeBands = (_opts$latitudeBands = opts.latitudeBands) != null ? _opts$latitudeBands : 16;\n\tconst longitudeBands = (_opts$longitudeBands = opts.longitudeBands) != null ? _opts$longitudeBands : 16;\n\tconst calcTangents = (_opts$calculateTangen5 = opts.calculateTangents) != null ? _opts$calculateTangen5 : false;\n\tconst positions = [];\n\tconst normals = [];\n\tconst uvs = [];\n\tconst indices = [];\n\tfor (let lat = 0; lat <= latitudeBands; lat++) {\n\t\tconst theta = lat * Math.PI / latitudeBands;\n\t\tconst sinTheta = Math.sin(theta);\n\t\tconst cosTheta = Math.cos(theta);\n\t\tfor (let lon = 0; lon <= longitudeBands; lon++) {\n\t\t\tconst phi = lon * 2 * Math.PI / longitudeBands - Math.PI / 2;\n\t\t\tconst sinPhi = Math.sin(phi);\n\t\t\tconst cosPhi = Math.cos(phi);\n\t\t\tconst x = cosPhi * sinTheta;\n\t\t\tconst y = cosTheta;\n\t\t\tconst z = sinPhi * sinTheta;\n\t\t\tconst u = 1 - lon / longitudeBands;\n\t\t\tconst v = 1 - lat / latitudeBands;\n\t\t\tpositions.push(x * radius, y * radius, z * radius);\n\t\t\tnormals.push(x, y, z);\n\t\t\tuvs.push(u, 1 - v);\n\t\t}\n\t}\n\tfor (let lat = 0; lat < latitudeBands; ++lat) {\n\t\tfor (let lon = 0; lon < longitudeBands; ++lon) {\n\t\t\tconst first = lat * (longitudeBands + 1) + lon;\n\t\t\tconst second = first + longitudeBands + 1;\n\t\t\tindices.push(first + 1, second, first);\n\t\t\tindices.push(first + 1, second + 1, second);\n\t\t}\n\t}\n\tconst options = {\n\t\tnormals: normals,\n\t\tuvs: uvs,\n\t\tuvs1: uvs,\n\t\tindices: indices\n\t};\n\tif (calcTangents) {\n\t\toptions.tangents = calculateTangents(positions, normals, uvs, indices);\n\t}\n\treturn createMesh(device, positions, options);\n}\nfunction createPlane(device, opts = {}) {\n\tvar _opts$halfExtents, _opts$widthSegments, _opts$lengthSegments, _opts$calculateTangen6;\n\tconst he = (_opts$halfExtents = opts.halfExtents) != null ? _opts$halfExtents : new Vec2(0.5, 0.5);\n\tconst ws = (_opts$widthSegments = opts.widthSegments) != null ? _opts$widthSegments : 5;\n\tconst ls = (_opts$lengthSegments = opts.lengthSegments) != null ? _opts$lengthSegments : 5;\n\tconst calcTangents = (_opts$calculateTangen6 = opts.calculateTangents) != null ? _opts$calculateTangen6 : false;\n\tconst positions = [];\n\tconst normals = [];\n\tconst uvs = [];\n\tconst indices = [];\n\tlet vcounter = 0;\n\tfor (let i = 0; i <= ws; i++) {\n\t\tfor (let j = 0; j <= ls; j++) {\n\t\t\tconst x = -he.x + 2 * he.x * i / ws;\n\t\t\tconst y = 0.0;\n\t\t\tconst z = -(-he.y + 2 * he.y * j / ls);\n\t\t\tconst u = i / ws;\n\t\t\tconst v = j / ls;\n\t\t\tpositions.push(x, y, z);\n\t\t\tnormals.push(0, 1, 0);\n\t\t\tuvs.push(u, 1 - v);\n\t\t\tif (i < ws && j < ls) {\n\t\t\t\tindices.push(vcounter + ls + 1, vcounter + 1, vcounter);\n\t\t\t\tindices.push(vcounter + ls + 1, vcounter + ls + 2, vcounter + 1);\n\t\t\t}\n\t\t\tvcounter++;\n\t\t}\n\t}\n\tconst options = {\n\t\tnormals: normals,\n\t\tuvs: uvs,\n\t\tuvs1: uvs,\n\t\tindices: indices\n\t};\n\tif (calcTangents) {\n\t\toptions.tangents = calculateTangents(positions, normals, uvs, indices);\n\t}\n\treturn createMesh(device, positions, options);\n}\nfunction createBox(device, opts = {}) {\n\tvar _opts$halfExtents2, _opts$widthSegments2, _opts$lengthSegments2, _opts$heightSegments4, _opts$calculateTangen7;\n\tconst he = (_opts$halfExtents2 = opts.halfExtents) != null ? _opts$halfExtents2 : new Vec3(0.5, 0.5, 0.5);\n\tconst ws = (_opts$widthSegments2 = opts.widthSegments) != null ? _opts$widthSegments2 : 1;\n\tconst ls = (_opts$lengthSegments2 = opts.lengthSegments) != null ? _opts$lengthSegments2 : 1;\n\tconst hs = (_opts$heightSegments4 = opts.heightSegments) != null ? _opts$heightSegments4 : 1;\n\tconst calcTangents = (_opts$calculateTangen7 = opts.calculateTangents) != null ? _opts$calculateTangen7 : false;\n\tconst corners = [new Vec3(-he.x, -he.y, he.z), new Vec3(he.x, -he.y, he.z), new Vec3(he.x, he.y, he.z), new Vec3(-he.x, he.y, he.z), new Vec3(he.x, -he.y, -he.z), new Vec3(-he.x, -he.y, -he.z), new Vec3(-he.x, he.y, -he.z), new Vec3(he.x, he.y, -he.z)];\n\tconst faceAxes = [[0, 1, 3], [4, 5, 7], [3, 2, 6], [1, 0, 4], [1, 4, 2], [5, 0, 6]];\n\tconst faceNormals = [[0, 0, 1], [0, 0, -1], [0, 1, 0], [0, -1, 0], [1, 0, 0], [-1, 0, 0]];\n\tconst sides = {\n\t\tFRONT: 0,\n\t\tBACK: 1,\n\t\tTOP: 2,\n\t\tBOTTOM: 3,\n\t\tRIGHT: 4,\n\t\tLEFT: 5\n\t};\n\tconst positions = [];\n\tconst normals = [];\n\tconst uvs = [];\n\tconst uvs1 = [];\n\tconst indices = [];\n\tlet vcounter = 0;\n\tconst generateFace = (side, uSegments, vSegments) => {\n\t\tconst temp1 = new Vec3();\n\t\tconst temp2 = new Vec3();\n\t\tconst temp3 = new Vec3();\n\t\tconst r = new Vec3();\n\t\tfor (let i = 0; i <= uSegments; i++) {\n\t\t\tfor (let j = 0; j <= vSegments; j++) {\n\t\t\t\ttemp1.lerp(corners[faceAxes[side][0]], corners[faceAxes[side][1]], i / uSegments);\n\t\t\t\ttemp2.lerp(corners[faceAxes[side][0]], corners[faceAxes[side][2]], j / vSegments);\n\t\t\t\ttemp3.sub2(temp2, corners[faceAxes[side][0]]);\n\t\t\t\tr.add2(temp1, temp3);\n\t\t\t\tlet u = i / uSegments;\n\t\t\t\tlet v = j / vSegments;\n\t\t\t\tpositions.push(r.x, r.y, r.z);\n\t\t\t\tnormals.push(faceNormals[side][0], faceNormals[side][1], faceNormals[side][2]);\n\t\t\t\tuvs.push(u, 1 - v);\n\t\t\t\tu = u * primitiveUv1PaddingScale + primitiveUv1Padding;\n\t\t\t\tv = v * primitiveUv1PaddingScale + primitiveUv1Padding;\n\t\t\t\tu /= 3;\n\t\t\t\tv /= 3;\n\t\t\t\tu += side % 3 / 3;\n\t\t\t\tv += Math.floor(side / 3) / 3;\n\t\t\t\tuvs1.push(u, 1 - v);\n\t\t\t\tif (i < uSegments && j < vSegments) {\n\t\t\t\t\tindices.push(vcounter + vSegments + 1, vcounter + 1, vcounter);\n\t\t\t\t\tindices.push(vcounter + vSegments + 1, vcounter + vSegments + 2, vcounter + 1);\n\t\t\t\t}\n\t\t\t\tvcounter++;\n\t\t\t}\n\t\t}\n\t};\n\tgenerateFace(sides.FRONT, ws, hs);\n\tgenerateFace(sides.BACK, ws, hs);\n\tgenerateFace(sides.TOP, ws, ls);\n\tgenerateFace(sides.BOTTOM, ws, ls);\n\tgenerateFace(sides.RIGHT, ls, hs);\n\tgenerateFace(sides.LEFT, ls, hs);\n\tconst options = {\n\t\tnormals: normals,\n\t\tuvs: uvs,\n\t\tuvs1: uvs1,\n\t\tindices: indices\n\t};\n\tif (calcTangents) {\n\t\toptions.tangents = calculateTangents(positions, normals, uvs, indices);\n\t}\n\treturn createMesh(device, positions, options);\n}\nfunction getShapePrimitive(device, type) {\n\tlet primData = null;\n\tfor (let i = 0; i < shapePrimitives.length; i++) {\n\t\tif (shapePrimitives[i].type === type && shapePrimitives[i].device === device) {\n\t\t\tprimData = shapePrimitives[i].primData;\n\t\t}\n\t}\n\tif (!primData) {\n\t\tlet mesh, area;\n\t\tswitch (type) {\n\t\t\tcase 'box':\n\t\t\t\tmesh = createBox(device);\n\t\t\t\tarea = {\n\t\t\t\t\tx: 2,\n\t\t\t\t\ty: 2,\n\t\t\t\t\tz: 2,\n\t\t\t\t\tuv: 2.0 / 3\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tcase 'capsule':\n\t\t\t\tmesh = createCapsule(device, {\n\t\t\t\t\tradius: 0.5,\n\t\t\t\t\theight: 2\n\t\t\t\t});\n\t\t\t\tarea = {\n\t\t\t\t\tx: Math.PI * 2,\n\t\t\t\t\ty: Math.PI,\n\t\t\t\t\tz: Math.PI * 2,\n\t\t\t\t\tuv: 1.0 / 3 + 1.0 / 3 / 3 * 2\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tcase 'cone':\n\t\t\t\tmesh = createCone(device, {\n\t\t\t\t\tbaseRadius: 0.5,\n\t\t\t\t\tpeakRadius: 0,\n\t\t\t\t\theight: 1\n\t\t\t\t});\n\t\t\t\tarea = {\n\t\t\t\t\tx: 2.54,\n\t\t\t\t\ty: 2.54,\n\t\t\t\t\tz: 2.54,\n\t\t\t\t\tuv: 1.0 / 3 + 1.0 / 3 / 3\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tcase 'cylinder':\n\t\t\t\tmesh = createCylinder(device, {\n\t\t\t\t\tradius: 0.5,\n\t\t\t\t\theight: 1\n\t\t\t\t});\n\t\t\t\tarea = {\n\t\t\t\t\tx: Math.PI,\n\t\t\t\t\ty: 0.79 * 2,\n\t\t\t\t\tz: Math.PI,\n\t\t\t\t\tuv: 1.0 / 3 + 1.0 / 3 / 3 * 2\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tcase 'plane':\n\t\t\t\tmesh = createPlane(device, {\n\t\t\t\t\thalfExtents: new Vec2(0.5, 0.5),\n\t\t\t\t\twidthSegments: 1,\n\t\t\t\t\tlengthSegments: 1\n\t\t\t\t});\n\t\t\t\tarea = {\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: 1,\n\t\t\t\t\tz: 0,\n\t\t\t\t\tuv: 1\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tcase 'sphere':\n\t\t\t\tmesh = createSphere(device, {\n\t\t\t\t\tradius: 0.5\n\t\t\t\t});\n\t\t\t\tarea = {\n\t\t\t\t\tx: Math.PI,\n\t\t\t\t\ty: Math.PI,\n\t\t\t\t\tz: Math.PI,\n\t\t\t\t\tuv: 1\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tcase 'torus':\n\t\t\t\tmesh = createTorus(device, {\n\t\t\t\t\ttubeRadius: 0.2,\n\t\t\t\t\tringRadius: 0.3\n\t\t\t\t});\n\t\t\t\tarea = {\n\t\t\t\t\tx: Math.PI * 0.5 * 0.5 - Math.PI * 0.1 * 0.1,\n\t\t\t\t\ty: 0.4,\n\t\t\t\t\tz: 0.4,\n\t\t\t\t\tuv: 1\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new Error('Invalid primitive type: ' + type);\n\t\t}\n\t\tmesh.incRefCount();\n\t\tprimData = {\n\t\t\tmesh: mesh,\n\t\t\tarea: area\n\t\t};\n\t\tshapePrimitives.push({\n\t\t\ttype: type,\n\t\t\tdevice: device,\n\t\t\tprimData: primData\n\t\t});\n\t}\n\treturn primData;\n}\n\nexport { calculateNormals, calculateTangents, createBox, createCapsule, createCone, createCylinder, createMesh, createPlane, createSphere, createTorus, getShapePrimitive };\n","import { BINDGROUP_VIEW } from './constants.js';\n\nclass ShaderProcessorOptions {\n\tconstructor(viewUniformFormat, viewBindGroupFormat, vertexFormat) {\n\t\tthis.uniformFormats = [];\n\t\tthis.bindGroupFormats = [];\n\t\tthis.vertexFormat = void 0;\n\t\tthis.uniformFormats[BINDGROUP_VIEW] = viewUniformFormat;\n\t\tthis.bindGroupFormats[BINDGROUP_VIEW] = viewBindGroupFormat;\n\t\tthis.vertexFormat = vertexFormat;\n\t}\n\thasUniform(name) {\n\t\tfor (let i = 0; i < this.uniformFormats.length; i++) {\n\t\t\tconst uniformFormat = this.uniformFormats[i];\n\t\t\tif (uniformFormat != null && uniformFormat.get(name)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\thasTexture(name) {\n\t\tfor (let i = 0; i < this.bindGroupFormats.length; i++) {\n\t\t\tconst groupFormat = this.bindGroupFormats[i];\n\t\t\tif (groupFormat != null && groupFormat.getTexture(name)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\tgetVertexElement(semantic) {\n\t\tvar _this$vertexFormat;\n\t\treturn (_this$vertexFormat = this.vertexFormat) == null ? void 0 : _this$vertexFormat.elements.find(element => element.name === semantic);\n\t}\n\tgenerateKey(device) {\n\t\tlet key = JSON.stringify(this.uniformFormats) + JSON.stringify(this.bindGroupFormats);\n\t\tif (device.isWebGPU) {\n\t\t\tvar _this$vertexFormat2;\n\t\t\tkey += (_this$vertexFormat2 = this.vertexFormat) == null ? void 0 : _this$vertexFormat2.renderingHashString;\n\t\t}\n\t\treturn key;\n\t}\n}\n\nexport { ShaderProcessorOptions };\n","var alphaTestPS = `\nuniform float alpha_ref;\nvoid alphaTest(float a) {\n\tif (a < alpha_ref) discard;\n}\n`;\n\nexport { alphaTestPS as default };\n","var ambientConstantPS = `\nvoid addAmbient(vec3 worldNormal) {\n\tdDiffuseLight += light_globalAmbient;\n}\n`;\n\nexport { ambientConstantPS as default };\n","var ambientEnvPS = `\n#ifndef ENV_ATLAS\n#define ENV_ATLAS\nuniform sampler2D texture_envAtlas;\n#endif\nvoid addAmbient(vec3 worldNormal) {\n\tvec3 dir = normalize(cubeMapRotate(worldNormal) * vec3(-1.0, 1.0, 1.0));\n\tvec2 uv = mapUv(toSphericalUv(dir), vec4(128.0, 256.0 + 128.0, 64.0, 32.0) / atlasSize);\n\tvec4 raw = texture2D(texture_envAtlas, uv);\n\tvec3 linear = $DECODE(raw);\n\tdDiffuseLight += processEnvironment(linear);\n}\n`;\n\nexport { ambientEnvPS as default };\n","var ambientSHPS = `\nuniform vec3 ambientSH[9];\nvoid addAmbient(vec3 worldNormal) {\n\tvec3 n = cubeMapRotate(worldNormal);\n\tvec3 color =\n\t\tambientSH[0] +\n\t\tambientSH[1] * n.x +\n\t\tambientSH[2] * n.y +\n\t\tambientSH[3] * n.z +\n\t\tambientSH[4] * n.x * n.z +\n\t\tambientSH[5] * n.z * n.y +\n\t\tambientSH[6] * n.y * n.x +\n\t\tambientSH[7] * (3.0 * n.z * n.z - 1.0) +\n\t\tambientSH[8] * (n.x * n.x - n.y * n.y);\n\tdDiffuseLight += processEnvironment(max(color, vec3(0.0)));\n}\n`;\n\nexport { ambientSHPS as default };\n","var aoPS = `\nvoid getAO() {\n\tdAo = 1.0;\n\t#ifdef MAPTEXTURE\n\tfloat aoBase = texture2DBias($SAMPLER, $UV, textureBias).$CH;\n\tdAo *= addAoDetail(aoBase);\n\t#endif\n\t#ifdef MAPVERTEX\n\tdAo *= saturate(vVertexColor.$VC);\n\t#endif\n}\n`;\n\nexport { aoPS as default };\n","var aoDetailMapPS = `\nfloat addAoDetail(float ao) {\n#ifdef MAPTEXTURE\n\tfloat aoDetail = texture2DBias($SAMPLER, $UV, textureBias).$CH;\n\treturn detailMode_$DETAILMODE(vec3(ao), vec3(aoDetail)).r;\n#else\n\treturn ao;\n#endif\n}\n`;\n\nexport { aoDetailMapPS as default };\n","var aoDiffuseOccPS = `\nvoid occludeDiffuse(float ao) {\n\tdDiffuseLight *= ao;\n}\n`;\n\nexport { aoDiffuseOccPS as default };\n","var aoSpecOccPS = `\nuniform float material_occludeSpecularIntensity;\nvoid occludeSpecular(float gloss, float ao, vec3 worldNormal, vec3 viewDir) {\n\tfloat specPow = exp2(gloss * 11.0);\n\tfloat specOcc = saturate(pow(dot(worldNormal, viewDir) + ao, 0.01*specPow) - 1.0 + ao);\n\tspecOcc = mix(1.0, specOcc, material_occludeSpecularIntensity);\n\tdSpecularLight *= specOcc;\n\tdReflection *= specOcc;\n\t\n#ifdef LIT_SHEEN\n\tsSpecularLight *= specOcc;\n\tsReflection *= specOcc;\n#endif\n}\n`;\n\nexport { aoSpecOccPS as default };\n","var aoSpecOccConstPS = `\nvoid occludeSpecular(float gloss, float ao, vec3 worldNormal, vec3 viewDir) {\n\tfloat specPow = exp2(gloss * 11.0);\n\tfloat specOcc = saturate(pow(dot(worldNormal, viewDir) + ao, 0.01*specPow) - 1.0 + ao);\n\tdSpecularLight *= specOcc;\n\tdReflection *= specOcc;\n\t\n#ifdef LIT_SHEEN\n\tsSpecularLight *= specOcc;\n\tsReflection *= specOcc;\n#endif\n}\n`;\n\nexport { aoSpecOccConstPS as default };\n","var aoSpecOccConstSimplePS = `\nvoid occludeSpecular(float gloss, float ao, vec3 worldNormal, vec3 viewDir) {\n\tdSpecularLight *= ao;\n\tdReflection *= ao;\n#ifdef LIT_SHEEN\n\tsSpecularLight *= ao;\n\tsReflection *= ao;\n#endif\n}\n`;\n\nexport { aoSpecOccConstSimplePS as default };\n","var aoSpecOccSimplePS = `\nuniform float material_occludeSpecularIntensity;\nvoid occludeSpecular(float gloss, float ao, vec3 worldNormal, vec3 viewDir) {\n\tfloat specOcc = mix(1.0, ao, material_occludeSpecularIntensity);\n\tdSpecularLight *= specOcc;\n\tdReflection *= specOcc;\n#ifdef LIT_SHEEN\n\tsSpecularLight *= specOcc;\n\tsReflection *= specOcc;\n#endif\n}\n`;\n\nexport { aoSpecOccSimplePS as default };\n","var basePS = `\nuniform vec3 view_position;\nuniform vec3 light_globalAmbient;\nfloat square(float x) {\n\treturn x*x;\n}\nfloat saturate(float x) {\n\treturn clamp(x, 0.0, 1.0);\n}\nvec3 saturate(vec3 x) {\n\treturn clamp(x, vec3(0.0), vec3(1.0));\n}\n`;\n\nexport { basePS as default };\n","var baseVS = `\nattribute vec3 vertex_position;\nattribute vec3 vertex_normal;\nattribute vec4 vertex_tangent;\nattribute vec2 vertex_texCoord0;\nattribute vec2 vertex_texCoord1;\nattribute vec4 vertex_color;\nuniform mat4 matrix_viewProjection;\nuniform mat4 matrix_model;\nuniform mat3 matrix_normal;\nvec3 dPositionW;\nmat4 dModelMatrix;\nmat3 dNormalMatrix;\n`;\n\nexport { baseVS as default };\n","var baseNineSlicedPS = `\n#define NINESLICED\nvarying vec2 vMask;\nvarying vec2 vTiledUv;\nuniform mediump vec4 innerOffset;\nuniform mediump vec2 outerScale;\nuniform mediump vec4 atlasRect;\nvec2 nineSlicedUv;\n`;\n\nexport { baseNineSlicedPS as default };\n","var baseNineSlicedVS = `\n#define NINESLICED\nvarying vec2 vMask;\nvarying vec2 vTiledUv;\nuniform mediump vec4 innerOffset;\nuniform mediump vec2 outerScale;\nuniform mediump vec4 atlasRect;\n`;\n\nexport { baseNineSlicedVS as default };\n","var baseNineSlicedTiledPS = `\n#define NINESLICED\n#define NINESLICETILED\nvarying vec2 vMask;\nvarying vec2 vTiledUv;\nuniform mediump vec4 innerOffset;\nuniform mediump vec2 outerScale;\nuniform mediump vec4 atlasRect;\nvec2 nineSlicedUv;\n`;\n\nexport { baseNineSlicedTiledPS as default };\n","var biasConstPS = `\n#define SHADOWBIAS\n#define SHADOW_SAMPLE_Z_BIAS\nfloat getShadowBias(float resolution, float maxBias) {\n\treturn maxBias;\n}\n`;\n\nexport { biasConstPS as default };\n","var blurVSMPS = `\nvarying vec2 vUv0;\nuniform sampler2D source;\nuniform vec2 pixelOffset;\n#ifdef GAUSS\nuniform float weight[SAMPLES];\n#endif\n#ifdef PACKED\nfloat decodeFloatRG(vec2 rg) {\n\treturn rg.y*(1.0/255.0) + rg.x;\n}\nvec2 encodeFloatRG( float v ) {\n\tvec2 enc = vec2(1.0, 255.0) * v;\n\tenc = fract(enc);\n\tenc -= enc.yy * vec2(1.0/255.0, 1.0/255.0);\n\treturn enc;\n}\n#endif\nvoid main(void) {\n\tvec3 moments = vec3(0.0);\n\tvec2 uv = vUv0 - pixelOffset * (float(SAMPLES) * 0.5);\n\tfor (int i=0; i<SAMPLES; i++) {\n\t\tvec4 c = texture2D(source, uv + pixelOffset * float(i));\n\t\t#ifdef PACKED\n\t\tc.xy = vec2(decodeFloatRG(c.xy), decodeFloatRG(c.zw));\n\t\t#endif\n\t\t#ifdef GAUSS\n\t\tmoments += c.xyz * weight[i];\n\t\t#else\n\t\tmoments += c.xyz;\n\t\t#endif\n\t}\n\t#ifndef GAUSS\n\tmoments /= float(SAMPLES);\n\t#endif\n\t#ifdef PACKED\n\tgl_FragColor = vec4(encodeFloatRG(moments.x), encodeFloatRG(moments.y));\n\t#else\n\tgl_FragColor = vec4(moments.x, moments.y, moments.z, 1.0);\n\t#endif\n}\n`;\n\nexport { blurVSMPS as default };\n","var clearCoatPS = `\n#ifdef MAPFLOAT\nuniform float material_clearCoat;\n#endif\nvoid getClearCoat() {\n\tccSpecularity = 1.0;\n\t#ifdef MAPFLOAT\n\tccSpecularity *= material_clearCoat;\n\t#endif\n\t#ifdef MAPTEXTURE\n\tccSpecularity *= texture2DBias($SAMPLER, $UV, textureBias).$CH;\n\t#endif\n\t#ifdef MAPVERTEX\n\tccSpecularity *= saturate(vVertexColor.$VC);\n\t#endif\n}\n`;\n\nexport { clearCoatPS as default };\n","var clearCoatGlossPS = `\n#ifdef MAPFLOAT\nuniform float material_clearCoatGloss;\n#endif\nvoid getClearCoatGlossiness() {\n\tccGlossiness = 1.0;\n\t#ifdef MAPFLOAT\n\tccGlossiness *= material_clearCoatGloss;\n\t#endif\n\t#ifdef MAPTEXTURE\n\tccGlossiness *= texture2DBias($SAMPLER, $UV, textureBias).$CH;\n\t#endif\n\t#ifdef MAPVERTEX\n\tccGlossiness *= saturate(vVertexColor.$VC);\n\t#endif\n\t#ifdef MAPINVERT\n\tccGlossiness = 1.0 - ccGlossiness;\n\t#endif\n\tccGlossiness += 0.0000001;\n}\n`;\n\nexport { clearCoatGlossPS as default };\n","var clearCoatNormalPS = `\n#ifdef MAPTEXTURE\nuniform float material_clearCoatBumpiness;\n#endif\nvoid getClearCoatNormal() {\n#ifdef MAPTEXTURE\n\tvec3 normalMap = unpackNormal(texture2DBias($SAMPLER, $UV, textureBias));\n\tnormalMap = mix(vec3(0.0, 0.0, 1.0), normalMap, material_clearCoatBumpiness);\n\tccNormalW = normalize(dTBN * normalMap);\n#else\n\tccNormalW = dVertexNormalW;\n#endif\n}\n`;\n\nexport { clearCoatNormalPS as default };\n","var clusteredLightUtilsPS = `\nvec2 getCubemapFaceCoordinates(const vec3 dir, out float faceIndex, out vec2 tileOffset)\n{\n\tvec3 vAbs = abs(dir);\n\tfloat ma;\n\tvec2 uv;\n\tif (vAbs.z >= vAbs.x && vAbs.z >= vAbs.y) {\n\t\tfaceIndex = dir.z < 0.0 ? 5.0 : 4.0;\n\t\tma = 0.5 / vAbs.z;\n\t\tuv = vec2(dir.z < 0.0 ? -dir.x : dir.x, -dir.y);\n\t\ttileOffset.x = 2.0;\n\t\ttileOffset.y = dir.z < 0.0 ? 1.0 : 0.0;\n\t} else if(vAbs.y >= vAbs.x) {\n\t\tfaceIndex = dir.y < 0.0 ? 3.0 : 2.0;\n\t\tma = 0.5 / vAbs.y;\n\t\tuv = vec2(dir.x, dir.y < 0.0 ? -dir.z : dir.z);\n\t\ttileOffset.x = 1.0;\n\t\ttileOffset.y = dir.y < 0.0 ? 1.0 : 0.0;\n\t} else {\n\t\tfaceIndex = dir.x < 0.0 ? 1.0 : 0.0;\n\t\tma = 0.5 / vAbs.x;\n\t\tuv = vec2(dir.x < 0.0 ? dir.z : -dir.z, -dir.y);\n\t\ttileOffset.x = 0.0;\n\t\ttileOffset.y = dir.x < 0.0 ? 1.0 : 0.0;\n\t}\n\treturn uv * ma + 0.5;\n}\nvec2 getCubemapAtlasCoordinates(const vec3 omniAtlasViewport, float shadowEdgePixels, float shadowTextureResolution, const vec3 dir) {\n\tfloat faceIndex;\n\tvec2 tileOffset;\n\tvec2 uv = getCubemapFaceCoordinates(dir, faceIndex, tileOffset);\n\tfloat atlasFaceSize = omniAtlasViewport.z;\n\tfloat tileSize = shadowTextureResolution * atlasFaceSize;\n\tfloat offset = shadowEdgePixels / tileSize;\n\tuv = uv * vec2(1.0 - offset * 2.0) + vec2(offset * 1.0);\n\tuv *= atlasFaceSize;\n\tuv += tileOffset * atlasFaceSize;\n\tuv += omniAtlasViewport.xy;\n\treturn uv;\n}\n`;\n\nexport { clusteredLightUtilsPS as default };\n","var clusteredLightCookiesPS = `\nvec3 _getCookieClustered(TEXTURE_ACCEPT(tex), vec2 uv, float intensity, bool isRgb, vec4 cookieChannel) {\n\tvec4 pixel = mix(vec4(1.0), texture2DLodEXT(tex, uv, 0.0), intensity);\n\treturn isRgb == true ? pixel.rgb : vec3(dot(pixel, cookieChannel));\n}\nvec3 getCookie2DClustered(TEXTURE_ACCEPT(tex), mat4 transform, vec3 worldPosition, float intensity, bool isRgb, vec4 cookieChannel) {\n\tvec4 projPos = transform * vec4(worldPosition, 1.0);\n\treturn _getCookieClustered(TEXTURE_PASS(tex), projPos.xy / projPos.w, intensity, isRgb, cookieChannel);\n}\nvec3 getCookieCubeClustered(TEXTURE_ACCEPT(tex), vec3 dir, float intensity, bool isRgb, vec4 cookieChannel, float shadowTextureResolution, float shadowEdgePixels, vec3 omniAtlasViewport) {\n\tvec2 uv = getCubemapAtlasCoordinates(omniAtlasViewport, shadowEdgePixels, shadowTextureResolution, dir);\n\treturn _getCookieClustered(TEXTURE_PASS(tex), uv, intensity, isRgb, cookieChannel);\n}\n`;\n\nexport { clusteredLightCookiesPS as default };\n","var clusteredLightShadowsPS = `\nvoid _getShadowCoordPerspZbuffer(mat4 shadowMatrix, vec4 shadowParams, vec3 wPos) {\n\tvec4 projPos = shadowMatrix * vec4(wPos, 1.0);\n\tprojPos.xyz /= projPos.w;\n\tdShadowCoord = projPos.xyz;\n}\nvoid getShadowCoordPerspZbufferNormalOffset(mat4 shadowMatrix, vec4 shadowParams, vec3 normal) {\n\tvec3 wPos = vPositionW + normal * shadowParams.y;\n\t_getShadowCoordPerspZbuffer(shadowMatrix, shadowParams, wPos);\n}\nvec3 normalOffsetPointShadow(vec4 shadowParams, vec3 lightPos, inout vec3 lightDir, vec3 lightDirNorm, vec3 normal) {\n\tfloat distScale = length(lightDir);\n\tvec3 wPos = vPositionW + normal * shadowParams.y * clamp(1.0 - dot(normal, -lightDirNorm), 0.0, 1.0) * distScale;\n\tvec3 dir = wPos - lightPos;\n\treturn dir;\n}\n#ifdef GL2\n\t#if defined(CLUSTER_SHADOW_TYPE_PCF1)\n\tfloat getShadowOmniClusteredPCF1(SHADOWMAP_ACCEPT(shadowMap), vec4 shadowParams, vec3 omniAtlasViewport, float shadowEdgePixels, vec3 lightDir) {\n\t\tfloat shadowTextureResolution = shadowParams.x;\n\t\tvec2 uv = getCubemapAtlasCoordinates(omniAtlasViewport, shadowEdgePixels, shadowTextureResolution, lightDir);\n\t\tfloat shadowZ = length(lightDir) * shadowParams.w + shadowParams.z;\n\t\treturn textureShadow(shadowMap, vec3(uv, shadowZ));\n\t}\n\t#endif\n\t#if defined(CLUSTER_SHADOW_TYPE_PCF3)\n\tfloat getShadowOmniClusteredPCF3(SHADOWMAP_ACCEPT(shadowMap), vec4 shadowParams, vec3 omniAtlasViewport, float shadowEdgePixels, vec3 lightDir) {\n\t\tfloat shadowTextureResolution = shadowParams.x;\n\t\tvec2 uv = getCubemapAtlasCoordinates(omniAtlasViewport, shadowEdgePixels, shadowTextureResolution, lightDir);\n\t\tfloat shadowZ = length(lightDir) * shadowParams.w + shadowParams.z;\n\t\tvec3 shadowCoord = vec3(uv, shadowZ);\n\t\treturn getShadowPCF3x3(SHADOWMAP_PASS(shadowMap), shadowCoord, shadowParams);\n\t}\n\t#endif\n\t#if defined(CLUSTER_SHADOW_TYPE_PCF5)\n\tfloat getShadowOmniClusteredPCF5(SHADOWMAP_ACCEPT(shadowMap), vec4 shadowParams, vec3 omniAtlasViewport, float shadowEdgePixels, vec3 lightDir) {\n\t\tfloat shadowTextureResolution = shadowParams.x;\n\t\tvec2 uv = getCubemapAtlasCoordinates(omniAtlasViewport, shadowEdgePixels, shadowTextureResolution, lightDir);\n\t\tfloat shadowZ = length(lightDir) * shadowParams.w + shadowParams.z;\n\t\tvec3 shadowCoord = vec3(uv, shadowZ);\n\t\treturn getShadowPCF5x5(SHADOWMAP_PASS(shadowMap), shadowCoord, shadowParams);\n\t}\n\t#endif\n#else\n\t#if defined(CLUSTER_SHADOW_TYPE_PCF1)\n\tfloat getShadowOmniClusteredPCF1(sampler2D shadowMap, vec4 shadowParams, vec3 omniAtlasViewport, float shadowEdgePixels, vec3 lightDir) {\n\t\tfloat shadowTextureResolution = shadowParams.x;\n\t\tvec2 uv = getCubemapAtlasCoordinates(omniAtlasViewport, shadowEdgePixels, shadowTextureResolution, lightDir);\n\t\tfloat depth = unpackFloat(textureShadow(shadowMap, uv));\n\t\tfloat shadowZ = length(lightDir) * shadowParams.w + shadowParams.z;\n\t\treturn depth > shadowZ ? 1.0 : 0.0;\n\t}\n\t#endif\n\t#if defined(CLUSTER_SHADOW_TYPE_PCF3)\n\tfloat getShadowOmniClusteredPCF3(sampler2D shadowMap, vec4 shadowParams, vec3 omniAtlasViewport, float shadowEdgePixels, vec3 lightDir) {\n\t\tfloat shadowTextureResolution = shadowParams.x;\n\t\tvec2 uv = getCubemapAtlasCoordinates(omniAtlasViewport, shadowEdgePixels, shadowTextureResolution, lightDir);\n\t\tfloat shadowZ = length(lightDir) * shadowParams.w + shadowParams.z;\n\t\tvec3 shadowCoord = vec3(uv, shadowZ);\n\t\treturn getShadowPCF3x3(shadowMap, shadowCoord, shadowParams);\n\t}\n\t#endif\n\t#if defined(CLUSTER_SHADOW_TYPE_PCF5)\n\tfloat getShadowOmniClusteredPCF5(sampler2D shadowMap, vec4 shadowParams, vec3 omniAtlasViewport, float shadowEdgePixels, vec3 lightDir) {\n\t\tfloat shadowTextureResolution = shadowParams.x;\n\t\tvec2 uv = getCubemapAtlasCoordinates(omniAtlasViewport, shadowEdgePixels, shadowTextureResolution, lightDir);\n\t\tfloat shadowZ = length(lightDir) * shadowParams.w + shadowParams.z;\n\t\tvec3 shadowCoord = vec3(uv, shadowZ);\n\t\treturn getShadowPCF3x3(shadowMap, shadowCoord, shadowParams);\n\t}\n\t#endif\n#endif\n#ifdef GL2\n\t#if defined(CLUSTER_SHADOW_TYPE_PCF1)\n\tfloat getShadowSpotClusteredPCF1(SHADOWMAP_ACCEPT(shadowMap), vec3 shadowCoord, vec4 shadowParams) {\n\t\treturn textureShadow(shadowMap, shadowCoord);\n\t}\n\t#endif\n\t#if defined(CLUSTER_SHADOW_TYPE_PCF3)\n\tfloat getShadowSpotClusteredPCF3(SHADOWMAP_ACCEPT(shadowMap), vec3 shadowCoord, vec4 shadowParams) {\n\t\treturn getShadowSpotPCF3x3(SHADOWMAP_PASS(shadowMap), shadowCoord, shadowParams);\n\t}\n\t#endif\n\t#if defined(CLUSTER_SHADOW_TYPE_PCF5)\n\tfloat getShadowSpotClusteredPCF5(SHADOWMAP_ACCEPT(shadowMap), vec3 shadowCoord, vec4 shadowParams) {\n\t\treturn getShadowPCF5x5(SHADOWMAP_PASS(shadowMap), shadowCoord, shadowParams);\n\t}\n\t#endif\n#else\n\t#if defined(CLUSTER_SHADOW_TYPE_PCF1)\n\tfloat getShadowSpotClusteredPCF1(sampler2D shadowMap, vec3 shadowCoord, vec4 shadowParams) {\n\t\tfloat depth = unpackFloat(textureShadow(shadowMap, shadowCoord.xy));\n\t\treturn depth > shadowCoord.z ? 1.0 : 0.0;\n\t}\n\t#endif\n\t#if defined(CLUSTER_SHADOW_TYPE_PCF3)\n\tfloat getShadowSpotClusteredPCF3(sampler2D shadowMap, vec3 shadowCoord, vec4 shadowParams) {\n\t\treturn getShadowSpotPCF3x3(shadowMap, shadowCoord, shadowParams);\n\t}\n\t#endif\n\t#if defined(CLUSTER_SHADOW_TYPE_PCF5)\n\tfloat getShadowSpotClusteredPCF5(sampler2D shadowMap, vec3 shadowCoord, vec4 shadowParams) {\n\t\treturn getShadowSpotPCF3x3(shadowMap, shadowCoord, shadowParams);\n\t}\n\t#endif\n#endif\n`;\n\nexport { clusteredLightShadowsPS as default };\n","var clusteredLightPS = `\nuniform highp sampler2D clusterWorldTexture;\nuniform highp sampler2D lightsTexture8;\nuniform highp sampler2D lightsTextureFloat;\n#if defined(CLUSTER_COOKIES)\n\t#define CLUSTER_COOKIES_OR_SHADOWS\n#endif\n#if defined(CLUSTER_SHADOWS)\n\t#define CLUSTER_COOKIES_OR_SHADOWS\n#endif\n#ifdef CLUSTER_SHADOWS\n\t#ifdef GL2\n\t\tuniform sampler2DShadow shadowAtlasTexture;\n\t#else\n\t\tuniform sampler2D shadowAtlasTexture;\n\t#endif\n#endif\n#ifdef CLUSTER_COOKIES\n\tuniform sampler2D cookieAtlasTexture;\n#endif\n#ifdef GL2\n\tuniform int clusterMaxCells;\n#else\n\tuniform float clusterMaxCells;\n\tuniform vec4 lightsTextureInvSize;\n#endif\nuniform float clusterSkip;\nuniform vec3 clusterCellsCountByBoundsSize;\nuniform vec3 clusterTextureSize;\nuniform vec3 clusterBoundsMin;\nuniform vec3 clusterBoundsDelta;\nuniform vec3 clusterCellsDot;\nuniform vec3 clusterCellsMax;\nuniform vec2 clusterCompressionLimit0;\nuniform vec2 shadowAtlasParams;\nstruct ClusterLightData {\n\tvec3 halfWidth;\n\tfloat lightType;\n\tvec3 halfHeight;\n\t#ifdef GL2\n\t\tint lightIndex;\n\t#else\n\t\tfloat lightV;\n\t#endif\n\tvec3 position;\n\tfloat shape;\n\tvec3 direction;\n\tfloat falloffMode;\n\tvec3 color;\n\tfloat shadowIntensity;\n\tvec3 omniAtlasViewport;\n\tfloat range;\n\tvec4 cookieChannelMask;\n\tfloat shadowBias;\n\tfloat shadowNormalBias;\n\tfloat innerConeAngleCos;\n\tfloat outerConeAngleCos;\n\tfloat cookie;\n\tfloat cookieRgb;\n\tfloat cookieIntensity;\n\tfloat mask;\n};\nmat4 lightProjectionMatrix;\n#define isClusteredLightCastShadow(light) ( light.shadowIntensity > 0.0 )\n#define isClusteredLightCookie(light) (light.cookie > 0.5 )\n#define isClusteredLightCookieRgb(light) (light.cookieRgb > 0.5 )\n#define isClusteredLightSpot(light) ( light.lightType > 0.5 )\n#define isClusteredLightFalloffLinear(light) ( light.falloffMode < 0.5 )\n#define isClusteredLightArea(light) ( light.shape > 0.1 )\n#define isClusteredLightRect(light) ( light.shape < 0.3 )\n#define isClusteredLightDisk(light) ( light.shape < 0.6 )\n#ifdef CLUSTER_MESH_DYNAMIC_LIGHTS\n\t#define acceptLightMask(light) ( light.mask < 0.75)\n#else\n\t#define acceptLightMask(light) ( light.mask > 0.25)\n#endif\nvec4 decodeClusterLowRange4Vec4(vec4 d0, vec4 d1, vec4 d2, vec4 d3) {\n\treturn vec4(\n\t\tbytes2floatRange4(d0, -2.0, 2.0),\n\t\tbytes2floatRange4(d1, -2.0, 2.0),\n\t\tbytes2floatRange4(d2, -2.0, 2.0),\n\t\tbytes2floatRange4(d3, -2.0, 2.0)\n\t);\n}\n#ifdef GL2\n\tvec4 sampleLightsTexture8(const ClusterLightData clusterLightData, int index) {\n\t\treturn texelFetch(lightsTexture8, ivec2(index, clusterLightData.lightIndex), 0);\n\t}\n\tvec4 sampleLightTextureF(const ClusterLightData clusterLightData, int index) {\n\t\treturn texelFetch(lightsTextureFloat, ivec2(index, clusterLightData.lightIndex), 0);\n\t}\n#else\n\tvec4 sampleLightsTexture8(const ClusterLightData clusterLightData, float index) {\n\t\treturn texture2DLodEXT(lightsTexture8, vec2(index * lightsTextureInvSize.z, clusterLightData.lightV), 0.0);\n\t}\n\tvec4 sampleLightTextureF(const ClusterLightData clusterLightData, float index) {\n\t\treturn texture2DLodEXT(lightsTextureFloat, vec2(index * lightsTextureInvSize.x, clusterLightData.lightV), 0.0);\n\t}\n#endif\nvoid decodeClusterLightCore(inout ClusterLightData clusterLightData, float lightIndex) {\n\t#ifdef GL2\n\t\tclusterLightData.lightIndex = int(lightIndex);\n\t#else\n\t\tclusterLightData.lightV = (lightIndex + 0.5) * lightsTextureInvSize.w;\n\t#endif\n\tvec4 lightInfo = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_FLAGS);\n\tclusterLightData.lightType = lightInfo.x;\n\tclusterLightData.shape = lightInfo.y;\n\tclusterLightData.falloffMode = lightInfo.z;\n\tclusterLightData.shadowIntensity = lightInfo.w;\n\tvec4 colorA = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_COLOR_A);\n\tvec4 colorB = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_COLOR_B);\n\tclusterLightData.color = vec3(bytes2float2(colorA.xy), bytes2float2(colorA.zw), bytes2float2(colorB.xy)) * clusterCompressionLimit0.y;\n\tclusterLightData.cookie = colorB.z;\n\tclusterLightData.mask = colorB.w;\n\t#ifdef CLUSTER_TEXTURE_FLOAT\n\t\tvec4 lightPosRange = sampleLightTextureF(clusterLightData, CLUSTER_TEXTURE_F_POSITION_RANGE);\n\t\tclusterLightData.position = lightPosRange.xyz;\n\t\tclusterLightData.range = lightPosRange.w;\n\t\tvec4 lightDir_Unused = sampleLightTextureF(clusterLightData, CLUSTER_TEXTURE_F_SPOT_DIRECTION);\n\t\tclusterLightData.direction = lightDir_Unused.xyz;\n\t#else\n\t\tvec4 encPosX = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_POSITION_X);\n\t\tvec4 encPosY = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_POSITION_Y);\n\t\tvec4 encPosZ = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_POSITION_Z);\n\t\tclusterLightData.position = vec3(bytes2float4(encPosX), bytes2float4(encPosY), bytes2float4(encPosZ)) * clusterBoundsDelta + clusterBoundsMin;\n\t\tvec4 encRange = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_RANGE);\n\t\tclusterLightData.range = bytes2float4(encRange) * clusterCompressionLimit0.x;\n\t\tvec4 encDirX = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_SPOT_DIRECTION_X);\n\t\tvec4 encDirY = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_SPOT_DIRECTION_Y);\n\t\tvec4 encDirZ = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_SPOT_DIRECTION_Z);\n\t\tclusterLightData.direction = vec3(bytes2float4(encDirX), bytes2float4(encDirY), bytes2float4(encDirZ)) * 2.0 - 1.0;\n\t#endif\n}\nvoid decodeClusterLightSpot(inout ClusterLightData clusterLightData) {\n\tvec4 coneAngle = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_SPOT_ANGLES);\n\tclusterLightData.innerConeAngleCos = bytes2float2(coneAngle.xy) * 2.0 - 1.0;\n\tclusterLightData.outerConeAngleCos = bytes2float2(coneAngle.zw) * 2.0 - 1.0;\n}\nvoid decodeClusterLightOmniAtlasViewport(inout ClusterLightData clusterLightData) {\n\t#ifdef CLUSTER_TEXTURE_FLOAT\n\t\tclusterLightData.omniAtlasViewport = sampleLightTextureF(clusterLightData, CLUSTER_TEXTURE_F_PROJ_MAT_0).xyz;\n\t#else\n\t\tvec4 viewportA = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_ATLAS_VIEWPORT_A);\n\t\tvec4 viewportB = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_ATLAS_VIEWPORT_B);\n\t\tclusterLightData.omniAtlasViewport = vec3(bytes2float2(viewportA.xy), bytes2float2(viewportA.zw), bytes2float2(viewportB.xy));\n\t#endif\n}\nvoid decodeClusterLightAreaData(inout ClusterLightData clusterLightData) {\n\t#ifdef CLUSTER_TEXTURE_FLOAT\n\t\tclusterLightData.halfWidth = sampleLightTextureF(clusterLightData, CLUSTER_TEXTURE_F_AREA_DATA_WIDTH).xyz;\n\t\tclusterLightData.halfHeight = sampleLightTextureF(clusterLightData, CLUSTER_TEXTURE_F_AREA_DATA_HEIGHT).xyz;\n\t#else\n\t\tvec4 areaWidthX = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_AREA_DATA_WIDTH_X);\n\t\tvec4 areaWidthY = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_AREA_DATA_WIDTH_Y);\n\t\tvec4 areaWidthZ = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_AREA_DATA_WIDTH_Z);\n\t\tclusterLightData.halfWidth = vec3(mantissaExponent2Float(areaWidthX), mantissaExponent2Float(areaWidthY), mantissaExponent2Float(areaWidthZ));\n\t\tvec4 areaHeightX = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_AREA_DATA_HEIGHT_X);\n\t\tvec4 areaHeightY = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_AREA_DATA_HEIGHT_Y);\n\t\tvec4 areaHeightZ = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_AREA_DATA_HEIGHT_Z);\n\t\tclusterLightData.halfHeight = vec3(mantissaExponent2Float(areaHeightX), mantissaExponent2Float(areaHeightY), mantissaExponent2Float(areaHeightZ));\n\t#endif\n}\nvoid decodeClusterLightProjectionMatrixData(inout ClusterLightData clusterLightData) {\n\t\n\t#ifdef CLUSTER_TEXTURE_FLOAT\n\t\tvec4 m0 = sampleLightTextureF(clusterLightData, CLUSTER_TEXTURE_F_PROJ_MAT_0);\n\t\tvec4 m1 = sampleLightTextureF(clusterLightData, CLUSTER_TEXTURE_F_PROJ_MAT_1);\n\t\tvec4 m2 = sampleLightTextureF(clusterLightData, CLUSTER_TEXTURE_F_PROJ_MAT_2);\n\t\tvec4 m3 = sampleLightTextureF(clusterLightData, CLUSTER_TEXTURE_F_PROJ_MAT_3);\n\t#else\n\t\tvec4 m00 = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_PROJ_MAT_00);\n\t\tvec4 m01 = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_PROJ_MAT_01);\n\t\tvec4 m02 = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_PROJ_MAT_02);\n\t\tvec4 m03 = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_PROJ_MAT_03);\n\t\tvec4 m0 = decodeClusterLowRange4Vec4(m00, m01, m02, m03);\n\t\tvec4 m10 = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_PROJ_MAT_10);\n\t\tvec4 m11 = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_PROJ_MAT_11);\n\t\tvec4 m12 = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_PROJ_MAT_12);\n\t\tvec4 m13 = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_PROJ_MAT_13);\n\t\tvec4 m1 = decodeClusterLowRange4Vec4(m10, m11, m12, m13);\n\t\tvec4 m20 = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_PROJ_MAT_20);\n\t\tvec4 m21 = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_PROJ_MAT_21);\n\t\tvec4 m22 = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_PROJ_MAT_22);\n\t\tvec4 m23 = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_PROJ_MAT_23);\n\t\tvec4 m2 = decodeClusterLowRange4Vec4(m20, m21, m22, m23);\n\t\tvec4 m30 = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_PROJ_MAT_30);\n\t\tvec4 m31 = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_PROJ_MAT_31);\n\t\tvec4 m32 = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_PROJ_MAT_32);\n\t\tvec4 m33 = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_PROJ_MAT_33);\n\t\tvec4 m3 = vec4(mantissaExponent2Float(m30), mantissaExponent2Float(m31), mantissaExponent2Float(m32), mantissaExponent2Float(m33));\n\t#endif\n\t\n\tlightProjectionMatrix = mat4(m0, m1, m2, m3);\n}\nvoid decodeClusterLightShadowData(inout ClusterLightData clusterLightData) {\n\t\n\tvec4 biases = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_SHADOW_BIAS);\n\tclusterLightData.shadowBias = bytes2floatRange2(biases.xy, -1.0, 20.0),\n\tclusterLightData.shadowNormalBias = bytes2float2(biases.zw);\n}\nvoid decodeClusterLightCookieData(inout ClusterLightData clusterLightData) {\n\tvec4 cookieA = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_COOKIE_A);\n\tclusterLightData.cookieIntensity = cookieA.x;\n\tclusterLightData.cookieRgb = cookieA.y;\n\tclusterLightData.cookieChannelMask = sampleLightsTexture8(clusterLightData, CLUSTER_TEXTURE_8_COOKIE_B);\n}\nvoid evaluateLight(\n\tClusterLightData light, \n\tvec3 worldNormal, \n\tvec3 viewDir, \n\tvec3 reflectionDir,\n#if defined(LIT_CLEARCOAT)\n\tvec3 clearcoatReflectionDir,\n#endif\n\tfloat gloss, \n\tvec3 specularity, \n\tvec3 geometricNormal, \n\tmat3 tbn, \n#if defined(LIT_IRIDESCENCE)\n\tvec3 iridescenceFresnel,\n#endif\n\tvec3 clearcoat_worldNormal,\n\tfloat clearcoat_gloss,\n\tfloat sheen_gloss,\n\tfloat iridescence_intensity\n) {\n\tvec3 cookieAttenuation = vec3(1.0);\n\tfloat diffuseAttenuation = 1.0;\n\tfloat falloffAttenuation = 1.0;\n\tgetLightDirPoint(light.position);\n\t#ifdef CLUSTER_AREALIGHTS\n\tif (isClusteredLightArea(light)) {\n\t\tdecodeClusterLightAreaData(light);\n\t\tif (isClusteredLightRect(light)) {\n\t\t\tcalcRectLightValues(light.position, light.halfWidth, light.halfHeight);\n\t\t} else if (isClusteredLightDisk(light)) {\n\t\t\tcalcDiskLightValues(light.position, light.halfWidth, light.halfHeight);\n\t\t} else {\n\t\t\tcalcSphereLightValues(light.position, light.halfWidth, light.halfHeight);\n\t\t}\n\t\tfalloffAttenuation = getFalloffWindow(light.range, dLightDirW);\n\t} else\n\t#endif\n\t{\n\t\tif (isClusteredLightFalloffLinear(light))\n\t\t\tfalloffAttenuation = getFalloffLinear(light.range, dLightDirW);\n\t\telse\n\t\t\tfalloffAttenuation = getFalloffInvSquared(light.range, dLightDirW);\n\t}\n\tif (falloffAttenuation > 0.00001) {\n\t\t#ifdef CLUSTER_AREALIGHTS\n\t\tif (isClusteredLightArea(light)) {\n\t\t\tif (isClusteredLightRect(light)) {\n\t\t\t\tdiffuseAttenuation = getRectLightDiffuse(worldNormal, viewDir, dLightDirW, dLightDirNormW) * 16.0;\n\t\t\t} else if (isClusteredLightDisk(light)) {\n\t\t\t\tdiffuseAttenuation = getDiskLightDiffuse(worldNormal, viewDir, dLightDirW, dLightDirNormW) * 16.0;\n\t\t\t} else {\n\t\t\t\tdiffuseAttenuation = getSphereLightDiffuse(worldNormal, viewDir, dLightDirW, dLightDirNormW) * 16.0;\n\t\t\t}\n\t\t} else\n\t\t#endif\n\t\t{\n\t\t\tfalloffAttenuation *= getLightDiffuse(worldNormal, viewDir, dLightDirW, dLightDirNormW); \n\t\t}\n\t\tif (isClusteredLightSpot(light)) {\n\t\t\tdecodeClusterLightSpot(light);\n\t\t\tfalloffAttenuation *= getSpotEffect(light.direction, light.innerConeAngleCos, light.outerConeAngleCos, dLightDirNormW);\n\t\t}\n\t\t#if defined(CLUSTER_COOKIES_OR_SHADOWS)\n\t\tif (falloffAttenuation > 0.00001) {\n\t\t\tif (isClusteredLightCastShadow(light) || isClusteredLightCookie(light)) {\n\t\t\t\tif (isClusteredLightSpot(light)) {\n\t\t\t\t\tdecodeClusterLightProjectionMatrixData(light);\n\t\t\t\t} else {\n\t\t\t\t\tdecodeClusterLightOmniAtlasViewport(light);\n\t\t\t\t}\n\t\t\t\tfloat shadowTextureResolution = shadowAtlasParams.x;\n\t\t\t\tfloat shadowEdgePixels = shadowAtlasParams.y;\n\t\t\t\t#ifdef CLUSTER_COOKIES\n\t\t\t\tif (isClusteredLightCookie(light)) {\n\t\t\t\t\tdecodeClusterLightCookieData(light);\n\t\t\t\t\tif (isClusteredLightSpot(light)) {\n\t\t\t\t\t\tcookieAttenuation = getCookie2DClustered(TEXTURE_PASS(cookieAtlasTexture), lightProjectionMatrix, vPositionW, light.cookieIntensity, isClusteredLightCookieRgb(light), light.cookieChannelMask);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcookieAttenuation = getCookieCubeClustered(TEXTURE_PASS(cookieAtlasTexture), dLightDirW, light.cookieIntensity, isClusteredLightCookieRgb(light), light.cookieChannelMask, shadowTextureResolution, shadowEdgePixels, light.omniAtlasViewport);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t#endif\n\t\t\t\t#ifdef CLUSTER_SHADOWS\n\t\t\t\tif (isClusteredLightCastShadow(light)) {\n\t\t\t\t\tdecodeClusterLightShadowData(light);\n\t\t\t\t\tvec4 shadowParams = vec4(shadowTextureResolution, light.shadowNormalBias, light.shadowBias, 1.0 / light.range);\n\t\t\t\t\tif (isClusteredLightSpot(light)) {\n\t\t\t\t\t\tgetShadowCoordPerspZbufferNormalOffset(lightProjectionMatrix, shadowParams, geometricNormal);\n\t\t\t\t\t\t\n\t\t\t\t\t\t#if defined(CLUSTER_SHADOW_TYPE_PCF1)\n\t\t\t\t\t\t\tfloat shadow = getShadowSpotClusteredPCF1(SHADOWMAP_PASS(shadowAtlasTexture), dShadowCoord, shadowParams);\n\t\t\t\t\t\t#elif defined(CLUSTER_SHADOW_TYPE_PCF3)\n\t\t\t\t\t\t\tfloat shadow = getShadowSpotClusteredPCF3(SHADOWMAP_PASS(shadowAtlasTexture), dShadowCoord, shadowParams);\n\t\t\t\t\t\t#elif defined(CLUSTER_SHADOW_TYPE_PCF5)\n\t\t\t\t\t\t\tfloat shadow = getShadowSpotClusteredPCF5(SHADOWMAP_PASS(shadowAtlasTexture), dShadowCoord, shadowParams);\n\t\t\t\t\t\t#elif defined(CLUSTER_SHADOW_TYPE_PCSS)\n\t\t\t\t\t\t\tfloat shadow = getShadowSpotClusteredPCSS(SHADOWMAP_PASS(shadowAtlasTexture), dShadowCoord, shadowParams);\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\tfalloffAttenuation *= mix(1.0, shadow, light.shadowIntensity);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvec3 dir = normalOffsetPointShadow(shadowParams, dLightPosW, dLightDirW, dLightDirNormW, geometricNormal);\n\t\t\t\t\t\t#if defined(CLUSTER_SHADOW_TYPE_PCF1)\n\t\t\t\t\t\t\tfloat shadow = getShadowOmniClusteredPCF1(SHADOWMAP_PASS(shadowAtlasTexture), shadowParams, light.omniAtlasViewport, shadowEdgePixels, dir);\n\t\t\t\t\t\t#elif defined(CLUSTER_SHADOW_TYPE_PCF3)\n\t\t\t\t\t\t\tfloat shadow = getShadowOmniClusteredPCF3(SHADOWMAP_PASS(shadowAtlasTexture), shadowParams, light.omniAtlasViewport, shadowEdgePixels, dir);\n\t\t\t\t\t\t#elif defined(CLUSTER_SHADOW_TYPE_PCF5)\n\t\t\t\t\t\t\tfloat shadow = getShadowOmniClusteredPCF5(SHADOWMAP_PASS(shadowAtlasTexture), shadowParams, light.omniAtlasViewport, shadowEdgePixels, dir);\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\tfalloffAttenuation *= mix(1.0, shadow, light.shadowIntensity);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t#endif\n\t\t\t}\n\t\t}\n\t\t#endif\n\t\t#ifdef CLUSTER_AREALIGHTS\n\t\tif (isClusteredLightArea(light)) {\n\t\t\t{\n\t\t\t\tvec3 areaDiffuse = (diffuseAttenuation * falloffAttenuation) * light.color * cookieAttenuation;\n\t\t\t\t#if defined(LIT_SPECULAR)\n\t\t\t\t\t#if defined(LIT_CONSERVE_ENERGY)\n\t\t\t\t\t\tareaDiffuse = mix(areaDiffuse, vec3(0), dLTCSpecFres);\n\t\t\t\t\t#endif\n\t\t\t\t#endif\n\t\t\t\tdDiffuseLight += areaDiffuse;\n\t\t\t}\n\t\t\t#ifdef LIT_SPECULAR\n\t\t\t\tfloat areaLightSpecular;\n\t\t\t\tif (isClusteredLightRect(light)) {\n\t\t\t\t\tareaLightSpecular = getRectLightSpecular(worldNormal, viewDir);\n\t\t\t\t} else if (isClusteredLightDisk(light)) {\n\t\t\t\t\tareaLightSpecular = getDiskLightSpecular(worldNormal, viewDir);\n\t\t\t\t} else {\n\t\t\t\t\tareaLightSpecular = getSphereLightSpecular(worldNormal, viewDir);\n\t\t\t\t}\n\t\t\t\tdSpecularLight += dLTCSpecFres * areaLightSpecular * falloffAttenuation * light.color * cookieAttenuation;\n\t\t\t\t#ifdef LIT_CLEARCOAT\n\t\t\t\t\tfloat areaLightSpecularCC;\n\t\t\t\t\tif (isClusteredLightRect(light)) {\n\t\t\t\t\t\tareaLightSpecularCC = getRectLightSpecular(clearcoat_worldNormal, viewDir);\n\t\t\t\t\t} else if (isClusteredLightDisk(light)) {\n\t\t\t\t\t\tareaLightSpecularCC = getDiskLightSpecular(clearcoat_worldNormal, viewDir);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tareaLightSpecularCC = getSphereLightSpecular(clearcoat_worldNormal, viewDir);\n\t\t\t\t\t}\n\t\t\t\t\tccSpecularLight += ccLTCSpecFres * areaLightSpecularCC * falloffAttenuation * light.color  * cookieAttenuation;\n\t\t\t\t#endif\n\t\t\t#endif\n\t\t} else\n\t\t#endif\n\t\t{\n\t\t\t{\n\t\t\t\tvec3 punctualDiffuse = falloffAttenuation * light.color * cookieAttenuation;\n\t\t\t\t#if defined(CLUSTER_AREALIGHTS)\n\t\t\t\t#if defined(LIT_SPECULAR)\n\t\t\t\t#if defined(LIT_CONSERVE_ENERGY)\n\t\t\t\t\tpunctualDiffuse = mix(punctualDiffuse, vec3(0), specularity);\n\t\t\t\t#endif\n\t\t\t\t#endif\n\t\t\t\t#endif\n\t\t\t\tdDiffuseLight += punctualDiffuse;\n\t\t\t}\n\t \n\t\t\t#ifdef LIT_SPECULAR\n\t\t\t\tvec3 halfDir = normalize(-dLightDirNormW + viewDir);\n\t\t\t\t\n\t\t\t\t#ifdef LIT_SPECULAR_FRESNEL\n\t\t\t\t\tdSpecularLight += \n\t\t\t\t\t\tgetLightSpecular(halfDir, reflectionDir, worldNormal, viewDir, dLightDirNormW, gloss, tbn) * falloffAttenuation * light.color * cookieAttenuation * \n\t\t\t\t\t\tgetFresnel(\n\t\t\t\t\t\t\tdot(viewDir, halfDir), \n\t\t\t\t\t\t\tgloss, \n\t\t\t\t\t\t\tspecularity\n\t\t\t\t\t\t#if defined(LIT_IRIDESCENCE)\n\t\t\t\t\t\t\t, iridescenceFresnel,\n\t\t\t\t\t\t\tiridescence_intensity\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t);\n\t\t\t\t#else\n\t\t\t\t\tdSpecularLight += getLightSpecular(halfDir, reflectionDir, worldNormal, viewDir, dLightDirNormW, gloss, tbn) * falloffAttenuation * light.color * cookieAttenuation * specularity;\n\t\t\t\t#endif\n\t\t\t\t#ifdef LIT_CLEARCOAT\n\t\t\t\t\t#ifdef LIT_SPECULAR_FRESNEL\n\t\t\t\t\t\tccSpecularLight += getLightSpecular(halfDir, clearcoatReflectionDir, clearcoat_worldNormal, viewDir, dLightDirNormW, clearcoat_gloss, tbn) * falloffAttenuation * light.color * cookieAttenuation * getFresnelCC(dot(viewDir, halfDir));\n\t\t\t\t\t#else\n\t\t\t\t\t\tccSpecularLight += getLightSpecular(halfDir, clearcoatReflectionDir, clearcoat_worldNormal, viewDir, dLightDirNormW, clearcoat_gloss, tbn) * falloffAttenuation * light.color * cookieAttenuation; \n\t\t\t\t\t#endif\n\t\t\t\t#endif\n\t\t\t\t#ifdef LIT_SHEEN\n\t\t\t\t\tsSpecularLight += getLightSpecularSheen(halfDir, worldNormal, viewDir, dLightDirNormW, sheen_gloss) * falloffAttenuation * light.color * cookieAttenuation;\n\t\t\t\t#endif\n\t\t\t#endif\n\t\t}\n\t}\n\tdAtten = falloffAttenuation;\n\tdAttenD = diffuseAttenuation;\n\tdAtten3 = cookieAttenuation;\n}\nvoid evaluateClusterLight(\n\tfloat lightIndex, \n\tvec3 worldNormal, \n\tvec3 viewDir, \n\tvec3 reflectionDir, \n#if defined(LIT_CLEARCOAT)\n\tvec3 clearcoatReflectionDir,\n#endif\n\tfloat gloss, \n\tvec3 specularity, \n\tvec3 geometricNormal, \n\tmat3 tbn, \n#if defined(LIT_IRIDESCENCE)\n\tvec3 iridescenceFresnel,\n#endif\n\tvec3 clearcoat_worldNormal,\n\tfloat clearcoat_gloss,\n\tfloat sheen_gloss,\n\tfloat iridescence_intensity\n) {\n\tClusterLightData clusterLightData;\n\tdecodeClusterLightCore(clusterLightData, lightIndex);\n\tif (acceptLightMask(clusterLightData))\n\t\tevaluateLight(\n\t\t\tclusterLightData, \n\t\t\tworldNormal, \n\t\t\tviewDir, \n\t\t\treflectionDir, \n#if defined(LIT_CLEARCOAT)\n\t\t\tclearcoatReflectionDir, \n#endif\n\t\t\tgloss, \n\t\t\tspecularity, \n\t\t\tgeometricNormal, \n\t\t\ttbn, \n#if defined(LIT_IRIDESCENCE)\n\t\t\tiridescenceFresnel,\n#endif\n\t\t\tclearcoat_worldNormal,\n\t\t\tclearcoat_gloss,\n\t\t\tsheen_gloss,\n\t\t\tiridescence_intensity\n\t\t);\n}\nvoid addClusteredLights(\n\tvec3 worldNormal, \n\tvec3 viewDir, \n\tvec3 reflectionDir, \n#if defined(LIT_CLEARCOAT)\n\tvec3 clearcoatReflectionDir,\n#endif\n\tfloat gloss, \n\tvec3 specularity, \n\tvec3 geometricNormal, \n\tmat3 tbn, \n#if defined(LIT_IRIDESCENCE)\n\tvec3 iridescenceFresnel,\n#endif\n\tvec3 clearcoat_worldNormal,\n\tfloat clearcoat_gloss,\n\tfloat sheen_gloss,\n\tfloat iridescence_intensity\n) {\n\tif (clusterSkip > 0.5)\n\t\treturn;\n\tvec3 cellCoords = floor((vPositionW - clusterBoundsMin) * clusterCellsCountByBoundsSize);\n\tif (!(any(lessThan(cellCoords, vec3(0.0))) || any(greaterThanEqual(cellCoords, clusterCellsMax)))) {\n\t\tfloat cellIndex = dot(clusterCellsDot, cellCoords);\n\t\tfloat clusterV = floor(cellIndex * clusterTextureSize.y);\n\t\tfloat clusterU = cellIndex - (clusterV * clusterTextureSize.x);\n\t\t#ifdef GL2\n\t\t\tfor (int lightCellIndex = 0; lightCellIndex < clusterMaxCells; lightCellIndex++) {\n\t\t\t\tfloat lightIndex = texelFetch(clusterWorldTexture, ivec2(int(clusterU) + lightCellIndex, clusterV), 0).x;\n\t\t\t\tif (lightIndex <= 0.0)\n\t\t\t\t\t\treturn;\n\t\t\t\tevaluateClusterLight(\n\t\t\t\t\tlightIndex * 255.0, \n\t\t\t\t\tworldNormal, \n\t\t\t\t\tviewDir, \n\t\t\t\t\treflectionDir,\n#if defined(LIT_CLEARCOAT)\n\t\t\t\t\tclearcoatReflectionDir,\n#endif\n\t\t\t\t\tgloss, \n\t\t\t\t\tspecularity, \n\t\t\t\t\tgeometricNormal, \n\t\t\t\t\ttbn, \n#if defined(LIT_IRIDESCENCE)\n\t\t\t\t\tiridescenceFresnel,\n#endif\n\t\t\t\t\tclearcoat_worldNormal,\n\t\t\t\t\tclearcoat_gloss,\n\t\t\t\t\tsheen_gloss,\n\t\t\t\t\tiridescence_intensity\n\t\t\t\t); \n\t\t\t}\n\t\t#else\n\t\t\tclusterV = (clusterV + 0.5) * clusterTextureSize.z;\n\t\t\tconst float maxLightCells = 256.0;\n\t\t\tfor (float lightCellIndex = 0.5; lightCellIndex < maxLightCells; lightCellIndex++) {\n\t\t\t\tfloat lightIndex = texture2DLodEXT(clusterWorldTexture, vec2(clusterTextureSize.y * (clusterU + lightCellIndex), clusterV), 0.0).x;\n\t\t\t\tif (lightIndex <= 0.0)\n\t\t\t\t\treturn;\n\t\t\t\t\n\t\t\t\tevaluateClusterLight(\n\t\t\t\t\tlightIndex * 255.0, \n\t\t\t\t\tworldNormal, \n\t\t\t\t\tviewDir, \n\t\t\t\t\treflectionDir,\n#if defined(LIT_CLEARCOAT)\n\t\t\t\t\tclearcoatReflectionDir,\n#endif\n\t\t\t\t\tgloss, \n\t\t\t\t\tspecularity, \n\t\t\t\t\tgeometricNormal, \n\t\t\t\t\ttbn, \n#if defined(LIT_IRIDESCENCE)\n\t\t\t\t\tiridescenceFresnel,\n#endif\n\t\t\t\t\tclearcoat_worldNormal,\n\t\t\t\t\tclearcoat_gloss,\n\t\t\t\t\tsheen_gloss,\n\t\t\t\t\tiridescence_intensity\n\t\t\t\t); \n\t\t\t\tif (lightCellIndex >= clusterMaxCells) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t#endif\n\t}\n}\n`;\n\nexport { clusteredLightPS as default };\n","var combinePS = `\nvec3 combineColor(vec3 albedo, vec3 sheenSpecularity, float clearcoatSpecularity) {\n\tvec3 ret = vec3(0);\n#ifdef LIT_OLD_AMBIENT\n\tret += (dDiffuseLight - light_globalAmbient) * albedo + material_ambient * light_globalAmbient;\n#else\n\tret += albedo * dDiffuseLight;\n#endif\n#ifdef LIT_SPECULAR\n\tret += dSpecularLight;\n#endif\n#ifdef LIT_REFLECTIONS\n\tret += dReflection.rgb * dReflection.a;\n#endif\n#ifdef LIT_SHEEN\n\tfloat sheenScaling = 1.0 - max(max(sheenSpecularity.r, sheenSpecularity.g), sheenSpecularity.b) * 0.157;\n\tret = ret * sheenScaling + (sSpecularLight + sReflection.rgb) * sheenSpecularity;\n#endif\n#ifdef LIT_CLEARCOAT\n\tfloat clearCoatScaling = 1.0 - ccFresnel * clearcoatSpecularity;\n\tret = ret * clearCoatScaling + (ccSpecularLight + ccReflection.rgb) * clearcoatSpecularity;\n#endif\n\treturn ret;\n}\n`;\n\nexport { combinePS as default };\n","var cookiePS = `\nvec4 getCookie2D(sampler2D tex, mat4 transform, float intensity) {\n\tvec4 projPos = transform * vec4(vPositionW, 1.0);\n\tprojPos.xy /= projPos.w;\n\treturn mix(vec4(1.0), texture2D(tex, projPos.xy), intensity);\n}\nvec4 getCookie2DClip(sampler2D tex, mat4 transform, float intensity) {\n\tvec4 projPos = transform * vec4(vPositionW, 1.0);\n\tprojPos.xy /= projPos.w;\n\tif (projPos.x < 0.0 || projPos.x > 1.0 || projPos.y < 0.0 || projPos.y > 1.0 || projPos.z < 0.0) return vec4(0.0);\n\treturn mix(vec4(1.0), texture2D(tex, projPos.xy), intensity);\n}\nvec4 getCookie2DXform(sampler2D tex, mat4 transform, float intensity, vec4 cookieMatrix, vec2 cookieOffset) {\n\tvec4 projPos = transform * vec4(vPositionW, 1.0);\n\tprojPos.xy /= projPos.w;\n\tprojPos.xy += cookieOffset;\n\tvec2 uv = mat2(cookieMatrix) * (projPos.xy-vec2(0.5)) + vec2(0.5);\n\treturn mix(vec4(1.0), texture2D(tex, uv), intensity);\n}\nvec4 getCookie2DClipXform(sampler2D tex, mat4 transform, float intensity, vec4 cookieMatrix, vec2 cookieOffset) {\n\tvec4 projPos = transform * vec4(vPositionW, 1.0);\n\tprojPos.xy /= projPos.w;\n\tprojPos.xy += cookieOffset;\n\tif (projPos.x < 0.0 || projPos.x > 1.0 || projPos.y < 0.0 || projPos.y > 1.0 || projPos.z < 0.0) return vec4(0.0);\n\tvec2 uv = mat2(cookieMatrix) * (projPos.xy-vec2(0.5)) + vec2(0.5);\n\treturn mix(vec4(1.0), texture2D(tex, uv), intensity);\n}\nvec4 getCookieCube(samplerCube tex, mat4 transform, float intensity) {\n\treturn mix(vec4(1.0), textureCube(tex, dLightDirNormW * mat3(transform)), intensity);\n}\n`;\n\nexport { cookiePS as default };\n","var cubeMapProjectBoxPS = `\nuniform vec3 envBoxMin;\nuniform vec3 envBoxMax;\nvec3 cubeMapProject(vec3 nrdir) {\n\tnrdir = cubeMapRotate(nrdir);\n\tvec3 rbmax = (envBoxMax - vPositionW) / nrdir;\n\tvec3 rbmin = (envBoxMin - vPositionW) / nrdir;\n\tvec3 rbminmax;\n\trbminmax.x = nrdir.x>0.0? rbmax.x : rbmin.x;\n\trbminmax.y = nrdir.y>0.0? rbmax.y : rbmin.y;\n\trbminmax.z = nrdir.z>0.0? rbmax.z : rbmin.z;\n\tfloat fa = min(min(rbminmax.x, rbminmax.y), rbminmax.z);\n\tvec3 posonbox = vPositionW + nrdir * fa;\n\tvec3 envBoxPos = (envBoxMin + envBoxMax) * 0.5;\n\treturn normalize(posonbox - envBoxPos);\n}\n`;\n\nexport { cubeMapProjectBoxPS as default };\n","var cubeMapProjectNonePS = `\nvec3 cubeMapProject(vec3 dir) {\n\treturn cubeMapRotate(dir);\n}\n`;\n\nexport { cubeMapProjectNonePS as default };\n","var cubeMapRotatePS = `\n#ifdef CUBEMAP_ROTATION\nuniform mat3 cubeMapRotationMatrix;\n#endif\nvec3 cubeMapRotate(vec3 refDir) {\n#ifdef CUBEMAP_ROTATION\n\treturn refDir * cubeMapRotationMatrix;\n#else\n\treturn refDir;\n#endif\n}\n`;\n\nexport { cubeMapRotatePS as default };\n","var debugOutputPS = `\n#ifdef DEBUG_ALBEDO_PASS\ngl_FragColor = vec4(gammaCorrectOutput(litArgs_albedo), 1.0);\n#endif\n#ifdef DEBUG_UV0_PASS\ngl_FragColor = vec4(litArgs_albedo , 1.0);\n#endif\n#ifdef DEBUG_WORLD_NORMAL_PASS\ngl_FragColor = vec4(litArgs_worldNormal * 0.5 + 0.5, 1.0);\n#endif\n#ifdef DEBUG_OPACITY_PASS\ngl_FragColor = vec4(vec3(litArgs_opacity) , 1.0);\n#endif\n#ifdef DEBUG_SPECULARITY_PASS\ngl_FragColor = vec4(litArgs_specularity, 1.0);\n#endif\n#ifdef DEBUG_GLOSS_PASS\ngl_FragColor = vec4(vec3(litArgs_gloss) , 1.0);\n#endif\n#ifdef DEBUG_METALNESS_PASS\ngl_FragColor = vec4(vec3(litArgs_metalness) , 1.0);\n#endif\n#ifdef DEBUG_AO_PASS\ngl_FragColor = vec4(vec3(litArgs_ao) , 1.0);\n#endif\n#ifdef DEBUG_EMISSION_PASS\ngl_FragColor = vec4(gammaCorrectOutput(litArgs_emission), 1.0);\n#endif\n`;\n\nexport { debugOutputPS as default };\n","var debugProcessFrontendPS = `\n#ifdef DEBUG_LIGHTING_PASS\nlitArgs_albedo = vec3(0.5);\n#endif\n#ifdef DEBUG_UV0_PASS\n#ifdef VARYING_VUV0\nlitArgs_albedo = vec3(vUv0, 0);\n#else\nlitArgs_albedo = vec3(0);\n#endif\n#endif\n`;\n\nexport { debugProcessFrontendPS as default };\n","var decodePS = `\nvec3 decodeLinear(vec4 raw) {\n\treturn raw.rgb;\n}\nfloat decodeGamma(float raw) {\n\treturn pow(raw, 2.2);\n}\nvec3 decodeGamma(vec3 raw) {\n\treturn pow(raw, vec3(2.2));\n}\nvec3 decodeGamma(vec4 raw) {\n\treturn pow(raw.xyz, vec3(2.2));\n}\nvec3 decodeRGBM(vec4 raw) {\n\tvec3 color = (8.0 * raw.a) * raw.rgb;\n\treturn color * color;\n}\nvec3 decodeRGBP(vec4 raw) {\n\tvec3 color = raw.rgb * (-raw.a * 7.0 + 8.0);\n\treturn color * color;\n}\nvec3 decodeRGBE(vec4 raw) {\n\tif (raw.a == 0.0) {\n\t\treturn vec3(0.0, 0.0, 0.0);\n\t} else {\n\t\treturn raw.xyz * pow(2.0, raw.w * 255.0 - 128.0);\n\t}\n}\nvec4 passThrough(vec4 raw) {\n\treturn raw;\n}\n`;\n\nexport { decodePS as default };\n","var detailModesPS = `\nvec3 detailMode_mul(vec3 c1, vec3 c2) {\n\treturn c1 * c2;\n}\nvec3 detailMode_add(vec3 c1, vec3 c2) {\n\treturn c1 + c2;\n}\nvec3 detailMode_screen(vec3 c1, vec3 c2) {\n\treturn 1.0 - (1.0 - c1)*(1.0 - c2);\n}\nvec3 detailMode_overlay(vec3 c1, vec3 c2) {\n\treturn mix(1.0 - 2.0*(1.0 - c1)*(1.0 - c2), 2.0*c1*c2, step(c1, vec3(0.5)));\n}\nvec3 detailMode_min(vec3 c1, vec3 c2) {\n\treturn min(c1, c2);\n}\nvec3 detailMode_max(vec3 c1, vec3 c2) {\n\treturn max(c1, c2);\n}\n`;\n\nexport { detailModesPS as default };\n","var diffusePS = `\n#ifdef MAPCOLOR\nuniform vec3 material_diffuse;\n#endif\nvoid getAlbedo() {\n\tdAlbedo = vec3(1.0);\n#ifdef MAPCOLOR\n\tdAlbedo *= material_diffuse.rgb;\n#endif\n#ifdef MAPTEXTURE\n\tvec3 albedoBase = $DECODE(texture2DBias($SAMPLER, $UV, textureBias)).$CH;\n\tdAlbedo *= addAlbedoDetail(albedoBase);\n#endif\n#ifdef MAPVERTEX\n\tdAlbedo *= gammaCorrectInput(saturate(vVertexColor.$VC));\n#endif\n}\n`;\n\nexport { diffusePS as default };\n","var diffuseDetailMapPS = `\nvec3 addAlbedoDetail(vec3 albedo) {\n#ifdef MAPTEXTURE\n\tvec3 albedoDetail = $DECODE(texture2DBias($SAMPLER, $UV, textureBias)).$CH;\n\treturn detailMode_$DETAILMODE(albedo, albedoDetail);\n#else\n\treturn albedo;\n#endif\n}\n`;\n\nexport { diffuseDetailMapPS as default };\n","var emissivePS = `\n#ifdef MAPCOLOR\nuniform vec3 material_emissive;\n#endif\n#ifdef MAPFLOAT\nuniform float material_emissiveIntensity;\n#endif\nvoid getEmission() {\n\tdEmission = vec3(1.0);\n\t#ifdef MAPFLOAT\n\tdEmission *= material_emissiveIntensity;\n\t#endif\n\t#ifdef MAPCOLOR\n\tdEmission *= material_emissive;\n\t#endif\n\t#ifdef MAPTEXTURE\n\tdEmission *= $DECODE(texture2DBias($SAMPLER, $UV, textureBias)).$CH;\n\t#endif\n\t#ifdef MAPVERTEX\n\tdEmission *= gammaCorrectInput(saturate(vVertexColor.$VC));\n\t#endif\n}\n`;\n\nexport { emissivePS as default };\n","var encodePS = `\nvec4 encodeLinear(vec3 source) {\n\treturn vec4(source, 1.0);\n}\nvec4 encodeGamma(vec3 source) {\n\treturn vec4(pow(source + 0.0000001, vec3(1.0 / 2.2)), 1.0);\n}\nvec4 encodeRGBM(vec3 source) {\n\tvec4 result;\n\tresult.rgb = pow(source.rgb, vec3(0.5));\n\tresult.rgb *= 1.0 / 8.0;\n\tresult.a = saturate( max( max( result.r, result.g ), max( result.b, 1.0 / 255.0 ) ) );\n\tresult.a = ceil(result.a * 255.0) / 255.0;\n\tresult.rgb /= result.a;\n\treturn result;\n}\nvec4 encodeRGBP(vec3 source) {\n\tvec3 gamma = pow(source, vec3(0.5));\n\tfloat maxVal = min(8.0, max(1.0, max(gamma.x, max(gamma.y, gamma.z))));\n\tfloat v = 1.0 - ((maxVal - 1.0) / 7.0);\n\tv = ceil(v * 255.0) / 255.0;\n\treturn vec4(gamma / (-v * 7.0 + 8.0), v);\t\n}\nvec4 encodeRGBE(vec3 source) {\n\tfloat maxVal = max(source.x, max(source.y, source.z));\n\tif (maxVal < 1e-32) {\n\t\treturn vec4(0, 0, 0, 0);\n\t} else {\n\t\tfloat e = ceil(log2(maxVal));\n\t\treturn vec4(source / pow(2.0, e), (e + 128.0) / 255.0);\n\t}\n}\n`;\n\nexport { encodePS as default };\n","var endPS = `\n\tgl_FragColor.rgb = combineColor(litArgs_albedo, litArgs_sheen_specularity, litArgs_clearcoat_specularity);\n\tgl_FragColor.rgb += litArgs_emission;\n\tgl_FragColor.rgb = addFog(gl_FragColor.rgb);\n\t#ifndef HDR\n\tgl_FragColor.rgb = toneMap(gl_FragColor.rgb);\n\tgl_FragColor.rgb = gammaCorrectOutput(gl_FragColor.rgb);\n\t#endif\n`;\n\nexport { endPS as default };\n","var endVS = `\n`;\n\nexport { endVS as default };\n","var envAtlasPS = `\nconst float atlasSize = 512.0;\nconst float seamSize = 1.0 / atlasSize;\nvec2 mapUv(vec2 uv, vec4 rect) {\n\treturn vec2(mix(rect.x + seamSize, rect.x + rect.z - seamSize, uv.x),\n\t\t\t\tmix(rect.y + seamSize, rect.y + rect.w - seamSize, uv.y));\n}\nvec2 mapRoughnessUv(vec2 uv, float level) {\n\tfloat t = 1.0 / exp2(level);\n\treturn mapUv(uv, vec4(0, 1.0 - t, t, t * 0.5));\n}\nvec2 mapShinyUv(vec2 uv, float level) {\n\tfloat t = 1.0 / exp2(level);\n\treturn mapUv(uv, vec4(1.0 - t, 1.0 - t, t, t * 0.5));\n}\n`;\n\nexport { envAtlasPS as default };\n","var envConstPS = `\nvec3 processEnvironment(vec3 color) {\n\treturn color;\n}\n`;\n\nexport { envConstPS as default };\n","var envMultiplyPS = `\nuniform float skyboxIntensity;\nvec3 processEnvironment(vec3 color) {\n\treturn color * skyboxIntensity;\n}\n`;\n\nexport { envMultiplyPS as default };\n","var extensionPS = `\n`;\n\nexport { extensionPS as default };\n","var extensionVS = `\n`;\n\nexport { extensionVS as default };\n","var falloffInvSquaredPS = `\nfloat getFalloffWindow(float lightRadius, vec3 lightDir) {\n\tfloat sqrDist = dot(lightDir, lightDir);\n\tfloat invRadius = 1.0 / lightRadius;\n\treturn square( saturate( 1.0 - square( sqrDist * square(invRadius) ) ) );\n}\nfloat getFalloffInvSquared(float lightRadius, vec3 lightDir) {\n\tfloat sqrDist = dot(lightDir, lightDir);\n\tfloat falloff = 1.0 / (sqrDist + 1.0);\n\tfloat invRadius = 1.0 / lightRadius;\n\tfalloff *= 16.0;\n\tfalloff *= square( saturate( 1.0 - square( sqrDist * square(invRadius) ) ) );\n\treturn falloff;\n}\n`;\n\nexport { falloffInvSquaredPS as default };\n","var falloffLinearPS = `\nfloat getFalloffLinear(float lightRadius, vec3 lightDir) {\n\tfloat d = length(lightDir);\n\treturn max(((lightRadius - d) / lightRadius), 0.0);\n}\n`;\n\nexport { falloffLinearPS as default };\n","var fixCubemapSeamsNonePS = `\nvec3 fixSeams(vec3 vec, float mipmapIndex) {\n\treturn vec;\n}\nvec3 fixSeams(vec3 vec) {\n\treturn vec;\n}\nvec3 fixSeamsStatic(vec3 vec, float invRecMipSize) {\n\treturn vec;\n}\nvec3 calcSeam(vec3 vec) {\n\treturn vec3(0);\n}\nvec3 applySeam(vec3 vec, vec3 seam, float scale) {\n\treturn vec;\n}\n`;\n\nexport { fixCubemapSeamsNonePS as default };\n","var fixCubemapSeamsStretchPS = `\nvec3 fixSeams(vec3 vec, float mipmapIndex) {\n\tvec3 avec = abs(vec);\n\tfloat scale = 1.0 - exp2(mipmapIndex) / 128.0;\n\tfloat M = max(max(avec.x, avec.y), avec.z);\n\tif (avec.x != M) vec.x *= scale;\n\tif (avec.y != M) vec.y *= scale;\n\tif (avec.z != M) vec.z *= scale;\n\treturn vec;\n}\nvec3 fixSeams(vec3 vec) {\n\tvec3 avec = abs(vec);\n\tfloat scale = 1.0 - 1.0 / 128.0;\n\tfloat M = max(max(avec.x, avec.y), avec.z);\n\tif (avec.x != M) vec.x *= scale;\n\tif (avec.y != M) vec.y *= scale;\n\tif (avec.z != M) vec.z *= scale;\n\treturn vec;\n}\nvec3 fixSeamsStatic(vec3 vec, float invRecMipSize) {\n\tvec3 avec = abs(vec);\n\tfloat scale = invRecMipSize;\n\tfloat M = max(max(avec.x, avec.y), avec.z);\n\tif (avec.x != M) vec.x *= scale;\n\tif (avec.y != M) vec.y *= scale;\n\tif (avec.z != M) vec.z *= scale;\n\treturn vec;\n}\nvec3 calcSeam(vec3 vec) {\n\tvec3 avec = abs(vec);\n\tfloat M = max(avec.x, max(avec.y, avec.z));\n\treturn vec3(avec.x != M ? 1.0 : 0.0,\n\t\t\t\tavec.y != M ? 1.0 : 0.0,\n\t\t\t\tavec.z != M ? 1.0 : 0.0);\n}\nvec3 applySeam(vec3 vec, vec3 seam, float scale) {\n\treturn vec * (seam * -scale + vec3(1.0));\n}\n`;\n\nexport { fixCubemapSeamsStretchPS as default };\n","var floatUnpackingPS = `\nfloat bytes2float2(vec2 data) {\n\treturn dot(data, vec2(1.0, 1.0 / 255.0));\n}\nfloat bytes2float3(vec3 data) {\n\treturn dot(data, vec3(1.0, 1.0 / 255.0, 1.0 / 65025.0));\n}\nfloat bytes2float4(vec4 data) {\n\treturn dot(data, vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n}\nfloat bytes2floatRange2(vec2 data, float min, float max) {\n\treturn mix(min, max, bytes2float2(data));\n}\nfloat bytes2floatRange3(vec3 data, float min, float max) {\n\treturn mix(min, max, bytes2float3(data));\n}\nfloat bytes2floatRange4(vec4 data, float min, float max) {\n\treturn mix(min, max, bytes2float4(data));\n}\nfloat mantissaExponent2Float(vec4 pack)\n{\n\tfloat value = bytes2floatRange3(pack.xyz, -1.0, 1.0);\n\tfloat exponent = floor(pack.w * 255.0 - 127.0);\n\treturn value * exp2(exponent);\n}\n`;\n\nexport { floatUnpackingPS as default };\n","var fogExpPS = `\nuniform vec3 fog_color;\nuniform float fog_density;\nfloat dBlendModeFogFactor = 1.0;\nvec3 addFog(vec3 color) {\n\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\tfloat fogFactor = exp(-depth * fog_density);\n\tfogFactor = clamp(fogFactor, 0.0, 1.0);\n\treturn mix(fog_color * dBlendModeFogFactor, color, fogFactor);\n}\n`;\n\nexport { fogExpPS as default };\n","var fogExp2PS = `\nuniform vec3 fog_color;\nuniform float fog_density;\nfloat dBlendModeFogFactor = 1.0;\nvec3 addFog(vec3 color) {\n\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\tfloat fogFactor = exp(-depth * depth * fog_density * fog_density);\n\tfogFactor = clamp(fogFactor, 0.0, 1.0);\n\treturn mix(fog_color * dBlendModeFogFactor, color, fogFactor);\n}\n`;\n\nexport { fogExp2PS as default };\n","var fogLinearPS = `\nuniform vec3 fog_color;\nuniform float fog_start;\nuniform float fog_end;\nfloat dBlendModeFogFactor = 1.0;\nvec3 addFog(vec3 color) {\n\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\tfloat fogFactor = (fog_end - depth) / (fog_end - fog_start);\n\tfogFactor = clamp(fogFactor, 0.0, 1.0);\n\treturn mix(fog_color * dBlendModeFogFactor, color, fogFactor);\n}\n`;\n\nexport { fogLinearPS as default };\n","var fogNonePS = `\nfloat dBlendModeFogFactor = 1.0;\nvec3 addFog(vec3 color) {\n\treturn color;\n}\n`;\n\nexport { fogNonePS as default };\n","var fresnelSchlickPS = `\nvec3 getFresnel(\n\t\tfloat cosTheta, \n\t\tfloat gloss, \n\t\tvec3 specularity\n#if defined(LIT_IRIDESCENCE)\n\t\t, vec3 iridescenceFresnel, \n\t\tfloat iridescenceIntensity\n#endif\n\t) {\n\tfloat fresnel = pow(1.0 - max(cosTheta, 0.0), 5.0);\n\tfloat glossSq = gloss * gloss;\n\tvec3 ret = specularity + (max(vec3(glossSq), specularity) - specularity) * fresnel;\n#if defined(LIT_IRIDESCENCE)\n\treturn mix(ret, iridescenceFresnel, iridescenceIntensity);\n#else\n\treturn ret;\n#endif\t\n}\nfloat getFresnelCC(float cosTheta) {\n\tfloat fresnel = pow(1.0 - max(cosTheta, 0.0), 5.0);\n\treturn 0.04 + (1.0 - 0.04) * fresnel;\n}\n`;\n\nexport { fresnelSchlickPS as default };\n","var fullscreenQuadPS = `\nvarying vec2 vUv0;\nuniform sampler2D source;\nvoid main(void) {\n\tgl_FragColor = texture2D(source, vUv0);\n}\n`;\n\nexport { fullscreenQuadPS as default };\n","var fullscreenQuadVS = `\nattribute vec2 vertex_position;\nvarying vec2 vUv0;\nvoid main(void)\n{\n\tgl_Position = vec4(vertex_position, 0.5, 1.0);\n\tvUv0 = vertex_position.xy*0.5+0.5;\n}\n`;\n\nexport { fullscreenQuadVS as default };\n","var gamma1_0PS = `\nfloat gammaCorrectInput(float color) {\n\treturn color;\n}\nvec3 gammaCorrectInput(vec3 color) {\n\treturn color;\n}\nvec4 gammaCorrectInput(vec4 color) {\n\treturn color;\n}\nvec3 gammaCorrectOutput(vec3 color) {\n\treturn color;\n}\n`;\n\nexport { gamma1_0PS as default };\n","var gamma2_2PS = `\nfloat gammaCorrectInput(float color) {\n\treturn decodeGamma(color);\n}\nvec3 gammaCorrectInput(vec3 color) {\n\treturn decodeGamma(color);\n}\nvec4 gammaCorrectInput(vec4 color) {\n\treturn vec4(decodeGamma(color.xyz), color.w);\n}\nvec3 gammaCorrectOutput(vec3 color) {\n#ifdef HDR\n\treturn color;\n#else\n\treturn pow(color + 0.0000001, vec3(1.0 / 2.2));\n#endif\n}\n`;\n\nexport { gamma2_2PS as default };\n","var glossPS = `\n#ifdef MAPFLOAT\nuniform float material_gloss;\n#endif\nvoid getGlossiness() {\n\tdGlossiness = 1.0;\n\t#ifdef MAPFLOAT\n\tdGlossiness *= material_gloss;\n\t#endif\n\t#ifdef MAPTEXTURE\n\tdGlossiness *= texture2DBias($SAMPLER, $UV, textureBias).$CH;\n\t#endif\n\t#ifdef MAPVERTEX\n\tdGlossiness *= saturate(vVertexColor.$VC);\n\t#endif\n\t#ifdef MAPINVERT\n\tdGlossiness = 1.0 - dGlossiness;\n\t#endif\n\tdGlossiness += 0.0000001;\n}\n`;\n\nexport { glossPS as default };\n","var iridescenceDiffractionPS = `\nuniform float material_iridescenceRefractionIndex;\n#ifndef PI\n#define PI 3.14159265\n#endif\nfloat iridescence_iorToFresnel(float transmittedIor, float incidentIor) {\n\treturn pow((transmittedIor - incidentIor) / (transmittedIor + incidentIor), 2.0);\n}\nvec3 iridescence_iorToFresnel(vec3 transmittedIor, float incidentIor) {\n\treturn pow((transmittedIor - vec3(incidentIor)) / (transmittedIor + vec3(incidentIor)), vec3(2.0));\n}\nvec3 iridescence_fresnelToIor(vec3 f0) {\n\tvec3 sqrtF0 = sqrt(f0);\n\treturn (vec3(1.0) + sqrtF0) / (vec3(1.0) - sqrtF0);\n}\nvec3 iridescence_sensitivity(float opd, vec3 shift) {\n\tfloat phase = 2.0 * PI * opd * 1.0e-9;\n\tconst vec3 val = vec3(5.4856e-13, 4.4201e-13, 5.2481e-13);\n\tconst vec3 pos = vec3(1.6810e+06, 1.7953e+06, 2.2084e+06);\n\tconst vec3 var = vec3(4.3278e+09, 9.3046e+09, 6.6121e+09);\n\tvec3 xyz = val * sqrt(2.0 * PI * var) * cos(pos * phase + shift) * exp(-pow(phase, 2.0) * var);\n\txyz.x += 9.7470e-14 * sqrt(2.0 * PI * 4.5282e+09) * cos(2.2399e+06 * phase + shift[0]) * exp(-4.5282e+09 * pow(phase, 2.0));\n\txyz /= vec3(1.0685e-07);\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t3.2404542, -0.9692660,  0.0556434,\n\t   -1.5371385,  1.8760108, -0.2040259,\n\t   -0.4985314,  0.0415560,  1.0572252\n\t);\n\treturn XYZ_TO_REC709 * xyz;\n}\nfloat iridescence_fresnel(float cosTheta, float f0) {\n\tfloat x = clamp(1.0 - cosTheta, 0.0, 1.0);\n\tfloat x2 = x * x;\n\tfloat x5 = x * x2 * x2;\n\treturn f0 + (1.0 - f0) * x5;\n} \nvec3 iridescence_fresnel(float cosTheta, vec3 f0) {\n\tfloat x = clamp(1.0 - cosTheta, 0.0, 1.0);\n\tfloat x2 = x * x;\n\tfloat x5 = x * x2 * x2; \n\treturn f0 + (vec3(1.0) - f0) * x5;\n}\nvec3 calcIridescence(float outsideIor, float cosTheta, vec3 base_f0, float iridescenceThickness) {\n\tfloat iridescenceIor = mix(outsideIor, material_iridescenceRefractionIndex, smoothstep(0.0, 0.03, iridescenceThickness));\n\tfloat sinTheta2Sq = pow(outsideIor / iridescenceIor, 2.0) * (1.0 - pow(cosTheta, 2.0));\n\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\tif (cosTheta2Sq < 0.0) {\n\t\treturn vec3(1.0);\n\t}\n\tfloat cosTheta2 = sqrt(cosTheta2Sq);\n\tfloat r0 = iridescence_iorToFresnel(iridescenceIor, outsideIor);\n\tfloat r12 = iridescence_fresnel(cosTheta, r0);\n\tfloat r21 = r12;\n\tfloat t121 = 1.0 - r12;\n\tfloat phi12 = iridescenceIor < outsideIor ? PI : 0.0;\n\tfloat phi21 = PI - phi12;\n\tvec3 baseIor = iridescence_fresnelToIor(base_f0 + vec3(0.0001));\n\tvec3 r1 = iridescence_iorToFresnel(baseIor, iridescenceIor);\n\tvec3 r23 = iridescence_fresnel(cosTheta2, r1);\n\tvec3 phi23 = vec3(0.0);\n\tif (baseIor[0] < iridescenceIor) phi23[0] = PI;\n\tif (baseIor[1] < iridescenceIor) phi23[1] = PI;\n\tif (baseIor[2] < iridescenceIor) phi23[2] = PI;\n\tfloat opd = 2.0 * iridescenceIor * iridescenceThickness * cosTheta2;\n\tvec3 phi = vec3(phi21) + phi23; \n\tvec3 r123Sq = clamp(r12 * r23, 1e-5, 0.9999);\n\tvec3 r123 = sqrt(r123Sq);\n\tvec3 rs = pow(t121, 2.0) * r23 / (1.0 - r123Sq);\n\tvec3 c0 = r12 + rs;\n\tvec3 i = c0;\n\tvec3 cm = rs - t121;\n\tfor (int m = 1; m <= 2; m++) {\n\t\tcm *= r123;\n\t\tvec3 sm = 2.0 * iridescence_sensitivity(float(m) * opd, float(m) * phi);\n\t\ti += cm * sm;\n\t}\n\treturn max(i, vec3(0.0));\n}\nvec3 getIridescence(float cosTheta, vec3 specularity, float iridescenceThickness) {\n\treturn calcIridescence(1.0, cosTheta, specularity, iridescenceThickness);\n}\n`;\n\nexport { iridescenceDiffractionPS as default };\n","var iridescencePS = `\n#ifdef MAPFLOAT\nuniform float material_iridescence;\n#endif\nvoid getIridescence() {\n\tfloat iridescence = 1.0;\n\t#ifdef MAPFLOAT\n\tiridescence *= material_iridescence;\n\t#endif\n\t#ifdef MAPTEXTURE\n\tiridescence *= texture2DBias($SAMPLER, $UV, textureBias).$CH;\n\t#endif\n\tdIridescence = iridescence; \n}\n`;\n\nexport { iridescencePS as default };\n","var iridescenceThicknessPS = `\nuniform float material_iridescenceThicknessMax;\n#ifdef MAPTEXTURE\nuniform float material_iridescenceThicknessMin;\n#endif\nvoid getIridescenceThickness() {\n\t#ifdef MAPTEXTURE\n\tfloat blend = texture2DBias($SAMPLER, $UV, textureBias).$CH;\n\tfloat iridescenceThickness = mix(material_iridescenceThicknessMin, material_iridescenceThicknessMax, blend);\n\t#else\n\tfloat iridescenceThickness = material_iridescenceThicknessMax;\n\t#endif\n\tdIridescenceThickness = iridescenceThickness; \n}\n`;\n\nexport { iridescenceThicknessPS as default };\n","var instancingVS = `\nattribute vec4 instance_line1;\nattribute vec4 instance_line2;\nattribute vec4 instance_line3;\nattribute vec4 instance_line4;\n`;\n\nexport { instancingVS as default };\n","var iorPS = `\n#ifdef MAPFLOAT\nuniform float material_refractionIndex;\n#endif\nvoid getIor() {\n#ifdef MAPFLOAT\n\tdIor = material_refractionIndex;\n#else\n\tdIor = 1.0 / 1.5;\n#endif\n}\n`;\n\nexport { iorPS as default };\n","var lightDiffuseLambertPS = `\nfloat getLightDiffuse(vec3 worldNormal, vec3 viewDir, vec3 lightDir, vec3 lightDirNorm) {\n\treturn max(dot(worldNormal, -lightDirNorm), 0.0);\n}\n`;\n\nexport { lightDiffuseLambertPS as default };\n","var lightDirPointPS = `\nvoid getLightDirPoint(vec3 lightPosW) {\n\tdLightDirW = vPositionW - lightPosW;\n\tdLightDirNormW = normalize(dLightDirW);\n\tdLightPosW = lightPosW;\n}\n`;\n\nexport { lightDirPointPS as default };\n","var lightmapAddPS = `\nvoid addLightMap(\n\tvec3 lightmap, \n\tvec3 dir, \n\tvec3 worldNormal, \n\tvec3 viewDir, \n\tvec3 reflectionDir, \n\tfloat gloss, \n\tvec3 specularity, \n\tvec3 vertexNormal, \n\tmat3 tbn\n#if defined(LIT_IRIDESCENCE)\n\tvec3 iridescenceFresnel, \n\tfloat iridescenceIntensity\n#endif\n) {\n\tdDiffuseLight += lightmap;\n}\n`;\n\nexport { lightmapAddPS as default };\n","var lightmapDirAddPS = `\nvoid addLightMap(\n\tvec3 lightmap, \n\tvec3 dir, \n\tvec3 worldNormal, \n\tvec3 viewDir, \n\tvec3 reflectionDir, \n\tfloat gloss, \n\tvec3 specularity, \n\tvec3 vertexNormal, \n\tmat3 tbn\n#if defined(LIT_IRIDESCENCE)\n\tvec3 iridescenceFresnel, \n\tfloat iridescenceIntensity\n#endif\n) {\n\tif (dot(dir, dir) < 0.0001) {\n\t\tdDiffuseLight += lightmap;\n\t} else {\n\t\tfloat vlight = saturate(dot(dir, -vertexNormal));\n\t\tfloat flight = saturate(dot(dir, -worldNormal));\n\t\tfloat nlight = (flight / max(vlight, 0.01)) * 0.5;\n\t\tdDiffuseLight += lightmap * nlight * 2.0;\n\t\tvec3 halfDir = normalize(-dir + viewDir);\n\t\tvec3 specularLight = lightmap * getLightSpecular(halfDir, reflectionDir, worldNormal, viewDir, dir, gloss, tbn);\n#ifdef LIT_SPECULAR_FRESNEL\n\t\tspecularLight *= \n\t\t\tgetFresnel(dot(viewDir, halfDir), \n\t\t\tgloss, \n\t\t\tspecularity\n\t\t#if defined(LIT_IRIDESCENCE)\n\t\t\t, iridescenceFresnel,\n\t\t\tiridescenceIntensity\n\t\t#endif\n\t\t\t);\n#endif\n\t\tdSpecularLight += specularLight;\n\t}\n}\n`;\n\nexport { lightmapDirAddPS as default };\n","var lightmapDirPS = `\nuniform sampler2D texture_lightMap;\nuniform sampler2D texture_dirLightMap;\nvoid getLightMap() {\n\tdLightmap = $DECODE(texture2DBias(texture_lightMap, $UV, textureBias)).$CH;\n\tvec3 dir = texture2DBias(texture_dirLightMap, $UV, textureBias).xyz * 2.0 - 1.0;\n\tfloat dirDot = dot(dir, dir);\n\tdLightmapDir = (dirDot > 0.001) ? dir / sqrt(dirDot) : vec3(0.0);\n}\n`;\n\nexport { lightmapDirPS as default };\n","var lightmapSinglePS = `\nvoid getLightMap() {\n\tdLightmap = vec3(1.0);\n\t#ifdef MAPTEXTURE\n\tdLightmap *= $DECODE(texture2DBias($SAMPLER, $UV, textureBias)).$CH;\n\t#endif\n\t#ifdef MAPVERTEX\n\tdLightmap *= saturate(vVertexColor.$VC);\n\t#endif\n}\n`;\n\nexport { lightmapSinglePS as default };\n","var lightSpecularAnisoGGXPS = `\nfloat calcLightSpecular(float gloss, vec3 worldNormal, vec3 viewDir, vec3 h, vec3 lightDirNorm, mat3 tbn) {\n\tfloat PI = 3.141592653589793;\n\tfloat roughness = max((1.0 - gloss) * (1.0 - gloss), 0.001);\n\tfloat anisotropy = material_anisotropy * roughness;\n \n\tfloat at = max((roughness + anisotropy), roughness / 4.0);\n\tfloat ab = max((roughness - anisotropy), roughness / 4.0);\n\tfloat NoH = dot(worldNormal, h);\n\tfloat ToH = dot(tbn[0], h);\n\tfloat BoH = dot(tbn[1], h);\n\tfloat a2 = at * ab;\n\tvec3 v = vec3(ab * ToH, at * BoH, a2 * NoH);\n\tfloat v2 = dot(v, v);\n\tfloat w2 = a2 / v2;\n\tfloat D = a2 * w2 * w2 * (1.0 / PI);\n\tfloat ToV = dot(tbn[0], viewDir);\n\tfloat BoV = dot(tbn[1], viewDir);\n\tfloat ToL = dot(tbn[0], -lightDirNorm);\n\tfloat BoL = dot(tbn[1], -lightDirNorm);\n\tfloat NoV = dot(worldNormal, viewDir);\n\tfloat NoL = dot(worldNormal, -lightDirNorm);\n\tfloat lambdaV = NoL * length(vec3(at * ToV, ab * BoV, NoV));\n\tfloat lambdaL = NoV * length(vec3(at * ToL, ab * BoL, NoL));\n\tfloat G = 0.5 / (lambdaV + lambdaL);\n\treturn D * G;\n}\nfloat getLightSpecular(vec3 h, vec3 reflDir, vec3 worldNormal, vec3 viewDir, vec3 lightDirNorm, float gloss, mat3 tbn) {\n\treturn calcLightSpecular(gloss, worldNormal, viewDir, h, lightDirNorm, tbn);\n}\n`;\n\nexport { lightSpecularAnisoGGXPS as default };\n","var lightSpecularBlinnPS = `\nfloat calcLightSpecular(float gloss, vec3 worldNormal, vec3 h) {\n\tfloat nh = max( dot( h, worldNormal ), 0.0 );\n\tfloat specPow = exp2(gloss * 11.0);\n\tspecPow = max(specPow, 0.0001);\n\treturn pow(nh, specPow) * (specPow + 2.0) / 8.0;\n}\nfloat getLightSpecular(vec3 h, vec3 reflDir, vec3 worldNormal, vec3 viewDir, vec3 lightDirNorm, float gloss, mat3 tbn) {\n\treturn calcLightSpecular(gloss, worldNormal, h);\n}\n`;\n\nexport { lightSpecularBlinnPS as default };\n","var lightSpecularPhongPS = `\nfloat calcLightSpecular(float gloss, vec3 reflDir, vec3 lightDirNorm) {\n\tfloat specPow = gloss;\n\treturn pow(max(dot(reflDir, -lightDirNorm), 0.0), specPow + 0.0001);\n}\nfloat getLightSpecular(vec3 h, vec3 reflDir, vec3 worldNormal, vec3 viewDir, vec3 lightDirNorm, float gloss, mat3 tbn) {\n\treturn calcLightSpecular(gloss, reflDir, lightDirNorm);\n}\n`;\n\nexport { lightSpecularPhongPS as default };\n","var lightSheenPS = `\nfloat sheenD(vec3 normal, vec3 h, float roughness) {\n\tfloat invR = 1.0 / (roughness * roughness);\n\tfloat cos2h = max(dot(normal, h), 0.0);\n\tcos2h *= cos2h;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\n\treturn (2.0 + invR) * pow(sin2h, invR * 0.5) / (2.0 * PI);\n}\nfloat sheenV(vec3 normal, vec3 viewDir, vec3 light) {\n\tfloat NoV = max(dot(normal, viewDir), 0.000001);\n\tfloat NoL = max(dot(normal, light), 0.000001);\n\treturn 1.0 / (4.0 * (NoL + NoV - NoL * NoV));\n}\nfloat getLightSpecularSheen(vec3 h, vec3 worldNormal, vec3 viewDir, vec3 lightDirNorm, float sheenGloss) {\n\tfloat D = sheenD(worldNormal, h, sheenGloss);\n\tfloat V = sheenV(worldNormal, viewDir, -lightDirNorm);\n\treturn D * V;\n}\n`;\n\nexport { lightSheenPS as default };\n","var linearizeDepthPS = `\n#ifndef LINEARIZE_DEPTH\n#define LINEARIZE_DEPTH\nfloat linearizeDepth(float z, vec4 cameraParams) {\n\tif (cameraParams.w == 0.0)\n\t\treturn (cameraParams.z * cameraParams.y) / (cameraParams.y + z * (cameraParams.z - cameraParams.y));\n\telse\n\t\treturn cameraParams.z + z * (cameraParams.y - cameraParams.z);\n}\n#ifndef CAMERAPLANES\n#define CAMERAPLANES\nuniform vec4 camera_params;\n#endif\n#ifdef GL2\nfloat linearizeDepth(float z) {\n\treturn linearizeDepth(z, camera_params);\n}\n#else\n#ifndef UNPACKFLOAT\n#define UNPACKFLOAT\nfloat unpackFloat(vec4 rgbaDepth) {\n\tconst vec4 bitShift = vec4(1.0 / (256.0 * 256.0 * 256.0), 1.0 / (256.0 * 256.0), 1.0 / 256.0, 1.0);\n\treturn dot(rgbaDepth, bitShift);\n}\n#endif\n#endif\n#endif\n`;\n\nexport { linearizeDepthPS as default };\n","var litShaderArgsPS = `\nvec3 litArgs_albedo;\nfloat litArgs_opacity;\nvec3 litArgs_emission;\nvec3 litArgs_worldNormal;\nfloat litArgs_ao;\nvec3 litArgs_lightmap;\nvec3 litArgs_lightmapDir;\nfloat litArgs_metalness;\nvec3 litArgs_specularity;\nfloat litArgs_specularityFactor;\nfloat litArgs_gloss;\nfloat litArgs_sheen_gloss;\nvec3 litArgs_sheen_specularity;\nfloat litArgs_transmission;\nfloat litArgs_thickness;\nfloat litArgs_ior;\nfloat litArgs_iridescence_intensity;\nfloat litArgs_iridescence_thickness;\nvec3 litArgs_clearcoat_worldNormal;\nfloat litArgs_clearcoat_specularity;\nfloat litArgs_clearcoat_gloss;\n`;\n\nexport { litShaderArgsPS as default };\n","var ltcPS = `\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nstruct Coords {\n\tvec3 coord0;\n\tvec3 coord1;\n\tvec3 coord2;\n\tvec3 coord3;\n};\nfloat LTC_EvaluateRect( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in Coords rectCoords) {\n\tvec3 v1 = rectCoords.coord1 - rectCoords.coord0;\n\tvec3 v2 = rectCoords.coord3 - rectCoords.coord0;\n\t\n\tvec3 lightNormal = cross( v1, v2 );\n\tfloat factor = sign(-dot( lightNormal, P - rectCoords.coord0 ));\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 =  factor * cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords.coord0 - P );\n\tcoords[ 1 ] = mat * ( rectCoords.coord1 - P );\n\tcoords[ 2 ] = mat * ( rectCoords.coord2 - P );\n\tcoords[ 3 ] = mat * ( rectCoords.coord3 - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn result;\n}\nCoords dLTCCoords;\nCoords getLTCLightCoords(vec3 lightPos, vec3 halfWidth, vec3 halfHeight){\n\tCoords coords;\n\tcoords.coord0 = lightPos + halfWidth - halfHeight;\n\tcoords.coord1 = lightPos - halfWidth - halfHeight;\n\tcoords.coord2 = lightPos - halfWidth + halfHeight;\n\tcoords.coord3 = lightPos + halfWidth + halfHeight;\n\treturn coords;\n}\nfloat dSphereRadius;\nCoords getSphereLightCoords(vec3 lightPos, vec3 halfWidth, vec3 halfHeight){\n\tdSphereRadius = max(length(halfWidth), length(halfHeight));\n\tvec3 f = reflect(normalize(lightPos - view_position), vNormalW);\n\tvec3 w = normalize(cross(f, halfHeight));\n\tvec3 h = normalize(cross(f, w));\n\treturn getLTCLightCoords(lightPos, w * dSphereRadius, h * dSphereRadius);\n}\nvec2 dLTCUV;\n#ifdef LIT_CLEARCOAT\nvec2 ccLTCUV;\n#endif\nvec2 getLTCLightUV(float gloss, vec3 worldNormal, vec3 viewDir)\n{\n\tfloat roughness = max((1.0 - gloss) * (1.0 - gloss), 0.001);\n\treturn LTC_Uv( worldNormal, viewDir, roughness );\n}\nvec3 dLTCSpecFres;\n#ifdef LIT_CLEARCOAT\nvec3 ccLTCSpecFres;\n#endif\nvec3 getLTCLightSpecFres(vec2 uv, vec3 specularity)\n{\n\tvec4 t2 = texture2DLodEXT(areaLightsLutTex2, uv, 0.0);\n\t#ifdef AREA_R8_G8_B8_A8_LUTS\n\tt2 *= vec4(0.693103,1,1,1);\n\tt2 += vec4(0.306897,0,0,0);\n\t#endif\n\treturn specularity * t2.x + ( vec3( 1.0 ) - specularity) * t2.y;\n}\nvoid calcLTCLightValues(float gloss, vec3 worldNormal, vec3 viewDir, vec3 specularity, float clearcoatGloss, vec3 clearcoatWorldNormal, float clearcoatSpecularity)\n{\n\tdLTCUV = getLTCLightUV(gloss, worldNormal, viewDir);\n\tdLTCSpecFres = getLTCLightSpecFres(dLTCUV, specularity); \n#ifdef LIT_CLEARCOAT\n\tccLTCUV = getLTCLightUV(clearcoatGloss, clearcoatWorldNormal, viewDir);\n\tccLTCSpecFres = getLTCLightSpecFres(ccLTCUV, vec3(clearcoatSpecularity));\n#endif\n}\nvoid calcRectLightValues(vec3 lightPos, vec3 halfWidth, vec3 halfHeight)\n{\n\tdLTCCoords = getLTCLightCoords(lightPos, halfWidth, halfHeight);\n}\nvoid calcDiskLightValues(vec3 lightPos, vec3 halfWidth, vec3 halfHeight)\n{\n\tcalcRectLightValues(lightPos, halfWidth, halfHeight);\n}\nvoid calcSphereLightValues(vec3 lightPos, vec3 halfWidth, vec3 halfHeight)\n{\n\tdLTCCoords = getSphereLightCoords(lightPos, halfWidth, halfHeight);\n}\nvec3 SolveCubic(vec4 Coefficient)\n{\n\tfloat pi = 3.14159;\n\tCoefficient.xyz /= Coefficient.w;\n\tCoefficient.yz /= 3.0;\n\tfloat A = Coefficient.w;\n\tfloat B = Coefficient.z;\n\tfloat C = Coefficient.y;\n\tfloat D = Coefficient.x;\n\tvec3 Delta = vec3(\n\t\t-Coefficient.z * Coefficient.z + Coefficient.y,\n\t\t-Coefficient.y * Coefficient.z + Coefficient.x,\n\t\tdot(vec2(Coefficient.z, -Coefficient.y), Coefficient.xy)\n\t);\n\tfloat Discriminant = dot(vec2(4.0 * Delta.x, -Delta.y), Delta.zy);\n\tvec3 RootsA, RootsD;\n\tvec2 xlc, xsc;\n\t{\n\t\tfloat A_a = 1.0;\n\t\tfloat C_a = Delta.x;\n\t\tfloat D_a = -2.0 * B * Delta.x + Delta.y;\n\t\tfloat Theta = atan(sqrt(Discriminant), -D_a) / 3.0;\n\t\tfloat x_1a = 2.0 * sqrt(-C_a) * cos(Theta);\n\t\tfloat x_3a = 2.0 * sqrt(-C_a) * cos(Theta + (2.0 / 3.0) * pi);\n\t\tfloat xl;\n\t\tif ((x_1a + x_3a) > 2.0 * B)\n\t\t\txl = x_1a;\n\t\telse\n\t\t\txl = x_3a;\n\t\txlc = vec2(xl - B, A);\n\t}\n\t{\n\t\tfloat A_d = D;\n\t\tfloat C_d = Delta.z;\n\t\tfloat D_d = -D * Delta.y + 2.0 * C * Delta.z;\n\t\tfloat Theta = atan(D * sqrt(Discriminant), -D_d) / 3.0;\n\t\tfloat x_1d = 2.0 * sqrt(-C_d) * cos(Theta);\n\t\tfloat x_3d = 2.0 * sqrt(-C_d) * cos(Theta + (2.0 / 3.0) * pi);\n\t\tfloat xs;\n\t\tif (x_1d + x_3d < 2.0 * C)\n\t\t\txs = x_1d;\n\t\telse\n\t\t\txs = x_3d;\n\t\txsc = vec2(-D, xs + C);\n\t}\n\tfloat E =  xlc.y * xsc.y;\n\tfloat F = -xlc.x * xsc.y - xlc.y * xsc.x;\n\tfloat G =  xlc.x * xsc.x;\n\tvec2 xmc = vec2(C * F - B * G, -B * F + C * E);\n\tvec3 Root = vec3(xsc.x / xsc.y, xmc.x / xmc.y, xlc.x / xlc.y);\n\tif (Root.x < Root.y && Root.x < Root.z)\n\t\tRoot.xyz = Root.yxz;\n\telse if (Root.z < Root.x && Root.z < Root.y)\n\t\tRoot.xyz = Root.xzy;\n\treturn Root;\n}\nfloat LTC_EvaluateDisk(vec3 N, vec3 V, vec3 P, mat3 Minv, Coords points)\n{\n\tvec3 T1, T2;\n\tT1 = normalize(V - N * dot(V, N));\n\tT2 = cross(N, T1);\n\tmat3 R = transposeMat3( mat3( T1, T2, N ) );\n\tvec3 L_[ 3 ];\n\tL_[ 0 ] = R * ( points.coord0 - P );\n\tL_[ 1 ] = R * ( points.coord1 - P );\n\tL_[ 2 ] = R * ( points.coord2 - P );\n\tvec3 Lo_i = vec3(0);\n\tvec3 C  = 0.5 * (L_[0] + L_[2]);\n\tvec3 V1 = 0.5 * (L_[1] - L_[2]);\n\tvec3 V2 = 0.5 * (L_[1] - L_[0]);\n\tC  = Minv * C;\n\tV1 = Minv * V1;\n\tV2 = Minv * V2;\n\tfloat a, b;\n\tfloat d11 = dot(V1, V1);\n\tfloat d22 = dot(V2, V2);\n\tfloat d12 = dot(V1, V2);\n\tif (abs(d12) / sqrt(d11 * d22) > 0.0001)\n\t{\n\t\tfloat tr = d11 + d22;\n\t\tfloat det = -d12 * d12 + d11 * d22;\n\t\tdet = sqrt(det);\n\t\tfloat u = 0.5 * sqrt(tr - 2.0 * det);\n\t\tfloat v = 0.5 * sqrt(tr + 2.0 * det);\n\t\tfloat e_max = (u + v) * (u + v);\n\t\tfloat e_min = (u - v) * (u - v);\n\t\tvec3 V1_, V2_;\n\t\tif (d11 > d22)\n\t\t{\n\t\t\tV1_ = d12 * V1 + (e_max - d11) * V2;\n\t\t\tV2_ = d12 * V1 + (e_min - d11) * V2;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tV1_ = d12*V2 + (e_max - d22)*V1;\n\t\t\tV2_ = d12*V2 + (e_min - d22)*V1;\n\t\t}\n\t\ta = 1.0 / e_max;\n\t\tb = 1.0 / e_min;\n\t\tV1 = normalize(V1_);\n\t\tV2 = normalize(V2_);\n\t}\n\telse\n\t{\n\t\ta = 1.0 / dot(V1, V1);\n\t\tb = 1.0 / dot(V2, V2);\n\t\tV1 *= sqrt(a);\n\t\tV2 *= sqrt(b);\n\t}\n\tvec3 V3 = cross(V1, V2);\n\tif (dot(C, V3) < 0.0)\n\t\tV3 *= -1.0;\n\tfloat L  = dot(V3, C);\n\tfloat x0 = dot(V1, C) / L;\n\tfloat y0 = dot(V2, C) / L;\n\tfloat E1 = inversesqrt(a);\n\tfloat E2 = inversesqrt(b);\n\ta *= L * L;\n\tb *= L * L;\n\tfloat c0 = a * b;\n\tfloat c1 = a * b * (1.0 + x0 * x0 + y0 * y0) - a - b;\n\tfloat c2 = 1.0 - a * (1.0 + x0 * x0) - b * (1.0 + y0 * y0);\n\tfloat c3 = 1.0;\n\tvec3 roots = SolveCubic(vec4(c0, c1, c2, c3));\n\tfloat e1 = roots.x;\n\tfloat e2 = roots.y;\n\tfloat e3 = roots.z;\n\tvec3 avgDir = vec3(a * x0 / (a - e2), b * y0 / (b - e2), 1.0);\n\tmat3 rotate = mat3(V1, V2, V3);\n\tavgDir = rotate * avgDir;\n\tavgDir = normalize(avgDir);\n\tfloat L1 = sqrt(-e2 / e3);\n\tfloat L2 = sqrt(-e2 / e1);\n\tfloat formFactor = L1 * L2 * inversesqrt((1.0 + L1 * L1) * (1.0 + L2 * L2));\n\t\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tvec2 uv = vec2(avgDir.z * 0.5 + 0.5, formFactor);\n\tuv = uv*LUT_SCALE + LUT_BIAS;\n\tfloat scale = texture2DLodEXT(areaLightsLutTex2, uv, 0.0).w;\n\treturn formFactor*scale;\n}\nfloat getRectLightDiffuse(vec3 worldNormal, vec3 viewDir, vec3 lightDir, vec3 lightDirNorm) {\n\treturn LTC_EvaluateRect( worldNormal, viewDir, vPositionW, mat3( 1.0 ), dLTCCoords );\n}\nfloat getDiskLightDiffuse(vec3 worldNormal, vec3 viewDir, vec3 lightDir, vec3 lightDirNorm) {\n\treturn LTC_EvaluateDisk( worldNormal, viewDir, vPositionW, mat3( 1.0 ), dLTCCoords );\n}\nfloat getSphereLightDiffuse(vec3 worldNormal, vec3 viewDir, vec3 lightDir, vec3 lightDirNorm) {\n\tfloat falloff = dSphereRadius / (dot(lightDir, lightDir) + dSphereRadius);\n\treturn getLightDiffuse(worldNormal, viewDir, lightDir, lightDirNorm) * falloff;\n}\nmat3 getLTCLightInvMat(vec2 uv)\n{\n\tvec4 t1 = texture2DLodEXT(areaLightsLutTex1, uv, 0.0);\n\t#ifdef AREA_R8_G8_B8_A8_LUTS\n\tt1 *= vec4(1.001, 0.3239, 0.60437568, 1.0);\n\tt1 += vec4(0.0, -0.2976, -0.01381, 0.0);\n\t#endif\n\treturn mat3(\n\t\tvec3( t1.x, 0, t1.y ),\n\t\tvec3(\t0, 1,\t0 ),\n\t\tvec3( t1.z, 0, t1.w )\n\t);\n}\nfloat calcRectLightSpecular(vec3 worldNormal, vec3 viewDir, vec2 uv) {\n\tmat3 mInv = getLTCLightInvMat(uv);\n\treturn LTC_EvaluateRect( worldNormal, viewDir, vPositionW, mInv, dLTCCoords );\n}\nfloat getRectLightSpecular(vec3 worldNormal, vec3 viewDir) {\n\treturn calcRectLightSpecular(worldNormal, viewDir, dLTCUV);\n}\nfloat calcDiskLightSpecular(vec3 worldNormal, vec3 viewDir, vec2 uv) {\n\tmat3 mInv = getLTCLightInvMat(uv);\n\treturn LTC_EvaluateDisk( worldNormal, viewDir, vPositionW, mInv, dLTCCoords );\n}\nfloat getDiskLightSpecular(vec3 worldNormal, vec3 viewDir) {\n\treturn calcDiskLightSpecular(worldNormal, viewDir, dLTCUV);\n}\nfloat getSphereLightSpecular(vec3 worldNormal, vec3 viewDir) {\n\treturn calcDiskLightSpecular(worldNormal, viewDir, dLTCUV);\n}\n`;\n\nexport { ltcPS as default };\n","var metalnessPS = `\n#ifdef MAPFLOAT\nuniform float material_metalness;\n#endif\nvoid getMetalness() {\n\tfloat metalness = 1.0;\n\t#ifdef MAPFLOAT\n\tmetalness *= material_metalness;\n\t#endif\n\t#ifdef MAPTEXTURE\n\tmetalness *= texture2DBias($SAMPLER, $UV, textureBias).$CH;\n\t#endif\n\t#ifdef MAPVERTEX\n\tmetalness *= saturate(vVertexColor.$VC);\n\t#endif\n\tdMetalness = metalness;\n}\n`;\n\nexport { metalnessPS as default };\n","var msdfPS = `\nuniform sampler2D texture_msdfMap;\n#ifdef GL_OES_standard_derivatives\n#define USE_FWIDTH\n#endif\n#ifdef GL2\n#define USE_FWIDTH\n#endif\nfloat median(float r, float g, float b) {\n\treturn max(min(r, g), min(max(r, g), b));\n}\nfloat map (float min, float max, float v) {\n\treturn (v - min) / (max - min);\n}\nuniform float font_sdfIntensity;\nuniform float font_pxrange;\nuniform float font_textureWidth;\n#ifdef UNIFORM_TEXT_PARAMETERS\nuniform vec4 outline_color;\nuniform float outline_thickness;\nuniform vec4 shadow_color;\nuniform vec2 shadow_offset;\n#else\nvarying vec4 outline_color;\nvarying float outline_thickness;\nvarying vec4 shadow_color;\nvarying vec2 shadow_offset;\n#endif\nvec4 applyMsdf(vec4 color) {\n\tvec3 tsample = texture2D(texture_msdfMap, vUv0).rgb;\n\tvec2 uvShdw = vUv0 - shadow_offset;\n\tvec3 ssample = texture2D(texture_msdfMap, uvShdw).rgb;\n\tfloat sigDist = median(tsample.r, tsample.g, tsample.b);\n\tfloat sigDistShdw = median(ssample.r, ssample.g, ssample.b);\n\tfloat smoothingMax = 0.2;\n\t#ifdef USE_FWIDTH\n\tvec2 w = fwidth(vUv0);\n\tfloat smoothing = clamp(w.x * font_textureWidth / font_pxrange, 0.0, smoothingMax);\n\t#else\n\tfloat font_size = 16.0;\n\tfloat smoothing = clamp(font_pxrange / font_size, 0.0, smoothingMax);\n\t#endif\n\tfloat mapMin = 0.05;\n\tfloat mapMax = clamp(1.0 - font_sdfIntensity, mapMin, 1.0);\n\tfloat sigDistInner = map(mapMin, mapMax, sigDist);\n\tfloat sigDistOutline = map(mapMin, mapMax, sigDist + outline_thickness);\n\tsigDistShdw = map(mapMin, mapMax, sigDistShdw + outline_thickness);\n\tfloat center = 0.5;\n\tfloat inside = smoothstep(center-smoothing, center+smoothing, sigDistInner);\n\tfloat outline = smoothstep(center-smoothing, center+smoothing, sigDistOutline);\n\tfloat shadow = smoothstep(center-smoothing, center+smoothing, sigDistShdw);\n\tvec4 tcolor = (outline > inside) ? outline * vec4(outline_color.a * outline_color.rgb, outline_color.a) : vec4(0.0);\n\ttcolor = mix(tcolor, color, inside);\n\tvec4 scolor = (shadow > outline) ? shadow * vec4(shadow_color.a * shadow_color.rgb, shadow_color.a) : tcolor;\n\ttcolor = mix(scolor, tcolor, outline);\n\t\n\treturn tcolor;\n}\n`;\n\nexport { msdfPS as default };\n","var metalnessModulatePS = `\nvec3 getSpecularModulate(in vec3 specularity, in vec3 albedo, in float metalness, in float f0) {\n\tvec3 dielectricF0 = f0 * specularity;\n\treturn mix(dielectricF0, albedo, metalness);\n}\nvec3 getAlbedoModulate(in vec3 albedo, in float metalness) {\n\treturn albedo * (1.0 - metalness);\n}\n`;\n\nexport { metalnessModulatePS as default };\n","var msdfVS = `\nattribute vec3 vertex_outlineParameters;\nattribute vec3 vertex_shadowParameters;\nvarying vec4 outline_color;\nvarying float outline_thickness;\nvarying vec4 shadow_color;\nvarying vec2 shadow_offset;\nvoid unpackMsdfParams() {\n\tvec3 little = mod(vertex_outlineParameters, 256.);\n\tvec3 big = (vertex_outlineParameters - little) / 256.;\n\toutline_color.rb = little.xy / 255.;\n\toutline_color.ga = big.xy / 255.;\n\toutline_thickness = little.z / 255. * 0.2;\n\tlittle = mod(vertex_shadowParameters, 256.);\n\tbig = (vertex_shadowParameters - little) / 256.;\n\tshadow_color.rb = little.xy / 255.;\n\tshadow_color.ga = big.xy / 255.;\n\tshadow_offset = (vec2(little.z, big.z) / 127. - 1.) * 0.005;\n}\n`;\n\nexport { msdfVS as default };\n","var normalVS = `\n#ifdef MORPHING_TEXTURE_BASED_NORMAL\nuniform highp sampler2D morphNormalTex;\n#endif\nvec3 getNormal() {\n\t#ifdef SKIN\n\tdNormalMatrix = mat3(dModelMatrix[0].xyz, dModelMatrix[1].xyz, dModelMatrix[2].xyz);\n\t#elif defined(INSTANCING)\n\tdNormalMatrix = mat3(instance_line1.xyz, instance_line2.xyz, instance_line3.xyz);\n\t#else\n\tdNormalMatrix = matrix_normal;\n\t#endif\n\tvec3 tempNormal = vertex_normal;\n\t#ifdef MORPHING\n\t#ifdef MORPHING_NRM03\n\ttempNormal += morph_weights_a[0] * morph_nrm0;\n\ttempNormal += morph_weights_a[1] * morph_nrm1;\n\ttempNormal += morph_weights_a[2] * morph_nrm2;\n\ttempNormal += morph_weights_a[3] * morph_nrm3;\n\t#endif\n\t#ifdef MORPHING_NRM47\n\ttempNormal += morph_weights_b[0] * morph_nrm4;\n\ttempNormal += morph_weights_b[1] * morph_nrm5;\n\ttempNormal += morph_weights_b[2] * morph_nrm6;\n\ttempNormal += morph_weights_b[3] * morph_nrm7;\n\t#endif\n\t#endif\n\t#ifdef MORPHING_TEXTURE_BASED_NORMAL\n\t\t#ifdef WEBGPU\n\t\t\tivec2 morphUV = getTextureMorphCoords();\n\t\t\tvec3 morphNormal = texelFetch(morphNormalTex, ivec2(morphUV), 0).xyz;\n\t\t#else\n\t\t\tvec2 morphUV = getTextureMorphCoords();\n\t\t\tvec3 morphNormal = texture2D(morphNormalTex, morphUV).xyz;\n\t\t#endif\n\ttempNormal += morphNormal;\n\t#endif\n\treturn normalize(dNormalMatrix * tempNormal);\n}\n`;\n\nexport { normalVS as default };\n","var normalDetailMapPS = `\n#ifdef MAPTEXTURE\nuniform float material_normalDetailMapBumpiness;\nvec3 blendNormals(vec3 n1, vec3 n2) {\n\tn1 += vec3(0, 0, 1);\n\tn2 *= vec3(-1, -1, 1);\n\treturn n1 * dot(n1, n2) / n1.z - n2;\n}\n#endif\nvec3 addNormalDetail(vec3 normalMap) {\n#ifdef MAPTEXTURE\n\tvec3 normalDetailMap = unpackNormal(texture2DBias($SAMPLER, $UV, textureBias));\n\tnormalDetailMap = mix(vec3(0.0, 0.0, 1.0), normalDetailMap, material_normalDetailMapBumpiness);\n\treturn blendNormals(normalMap, normalDetailMap);\n#else\n\treturn normalMap;\n#endif\n}\n`;\n\nexport { normalDetailMapPS as default };\n","var normalInstancedVS = `\nvec3 getNormal() {\n\tdNormalMatrix = mat3(instance_line1.xyz, instance_line2.xyz, instance_line3.xyz);\n\treturn normalize(dNormalMatrix * vertex_normal);\n}\n`;\n\nexport { normalInstancedVS as default };\n","var normalMapPS = `\n#ifdef MAPTEXTURE\nuniform float material_bumpiness;\n#endif\nvoid getNormal() {\n#ifdef MAPTEXTURE\n\tvec3 normalMap = unpackNormal(texture2DBias($SAMPLER, $UV, textureBias));\n\tnormalMap = mix(vec3(0.0, 0.0, 1.0), normalMap, material_bumpiness);\n\tdNormalW = normalize(dTBN * addNormalDetail(normalMap));\n#else\n\tdNormalW = dVertexNormalW;\n#endif\n}\n`;\n\nexport { normalMapPS as default };\n","var normalSkinnedVS = `\nvec3 getNormal() {\n\tdNormalMatrix = mat3(dModelMatrix[0].xyz, dModelMatrix[1].xyz, dModelMatrix[2].xyz);\n\treturn normalize(dNormalMatrix * vertex_normal);\n}\n`;\n\nexport { normalSkinnedVS as default };\n","var normalXYPS = `\nvec3 unpackNormal(vec4 nmap) {\n\tvec3 normal;\n\tnormal.xy = nmap.wy * 2.0 - 1.0;\n\tnormal.z = sqrt(1.0 - saturate(dot(normal.xy, normal.xy)));\n\treturn normal;\n}\n`;\n\nexport { normalXYPS as default };\n","var normalXYZPS = `\nvec3 unpackNormal(vec4 nmap) {\n\treturn nmap.xyz * 2.0 - 1.0;\n}\n`;\n\nexport { normalXYZPS as default };\n","var opacityPS = `\n#ifdef MAPFLOAT\nuniform float material_opacity;\n#endif\nvoid getOpacity() {\n\tdAlpha = 1.0;\n\t#ifdef MAPFLOAT\n\tdAlpha *= material_opacity;\n\t#endif\n\t#ifdef MAPTEXTURE\n\tdAlpha *= texture2DBias($SAMPLER, $UV, textureBias).$CH;\n\t#endif\n\t#ifdef MAPVERTEX\n\tdAlpha *= clamp(vVertexColor.$VC, 0.0, 1.0);\n\t#endif\n}\n`;\n\nexport { opacityPS as default };\n","var outputPS = `\n`;\n\nexport { outputPS as default };\n","var outputAlphaPS = `\ngl_FragColor.a = litArgs_opacity;\n`;\n\nexport { outputAlphaPS as default };\n","var outputAlphaOpaquePS = `\n\tgl_FragColor.a = 1.0;\n`;\n\nexport { outputAlphaOpaquePS as default };\n","var outputAlphaPremulPS = `\ngl_FragColor.rgb *= litArgs_opacity;\ngl_FragColor.a = litArgs_opacity;\n`;\n\nexport { outputAlphaPremulPS as default };\n","var outputTex2DPS = `\nvarying vec2 vUv0;\nuniform sampler2D source;\nvoid main(void) {\n\tgl_FragColor = texture2D(source, vUv0);\n}\n`;\n\nexport { outputTex2DPS as default };\n","var packDepthPS = `\nvec4 packFloat(float depth) {\n\tconst vec4 bit_shift = vec4(256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0);\n\tconst vec4 bit_mask  = vec4(0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);\n\tvec4 res = mod(depth * bit_shift * vec4(255), vec4(256) ) / vec4(255);\n\tres -= res.xxyz * bit_mask;\n\treturn res;\n}\n`;\n\nexport { packDepthPS as default };\n","var sheenPS = `\n#ifdef MAPCOLOR\nuniform vec3 material_sheen;\n#endif\nvoid getSheen() {\n\tvec3 sheenColor = vec3(1, 1, 1);\n\t#ifdef MAPCOLOR\n\tsheenColor *= material_sheen;\n\t#endif\n\t#ifdef MAPTEXTURE\n\tsheenColor *= $DECODE(texture2DBias($SAMPLER, $UV, textureBias)).$CH;\n\t#endif\n\t#ifdef MAPVERTEX\n\tsheenColor *= saturate(vVertexColor.$VC);\n\t#endif\n\tsSpecularity = sheenColor;\n}\n`;\n\nexport { sheenPS as default };\n","var sheenGlossPS = `\n#ifdef MAPFLOAT\nuniform float material_sheenGloss;\n#endif\nvoid getSheenGlossiness() {\n\tfloat sheenGlossiness = 1.0;\n\t#ifdef MAPFLOAT\n\tsheenGlossiness *= material_sheenGloss;\n\t#endif\n\t#ifdef MAPTEXTURE\n\tsheenGlossiness *= texture2DBias($SAMPLER, $UV, textureBias).$CH;\n\t#endif\n\t#ifdef MAPVERTEX\n\tsheenGlossiness *= saturate(vVertexColor.$VC);\n\t#endif\n\t#ifdef MAPINVERT\n\tsheenGlossiness = 1.0 - sheenGlossiness;\n\t#endif\n\tsheenGlossiness += 0.0000001;\n\tsGlossiness = sheenGlossiness;\n}\n`;\n\nexport { sheenGlossPS as default };\n","var parallaxPS = `\nuniform float material_heightMapFactor;\nvoid getParallax() {\n\tfloat parallaxScale = material_heightMapFactor;\n\tfloat height = texture2DBias($SAMPLER, $UV, textureBias).$CH;\n\theight = height * parallaxScale - parallaxScale*0.5;\n\tvec3 viewDirT = dViewDirW * dTBN;\n\tviewDirT.z += 0.42;\n\tdUvOffset = height * (viewDirT.xy / viewDirT.z);\n}\n`;\n\nexport { parallaxPS as default };\n","var particlePS = `\nvarying vec4 texCoordsAlphaLife;\nuniform sampler2D colorMap;\nuniform sampler2D colorParam;\nuniform float graphSampleSize;\nuniform float graphNumSamples;\n#ifndef CAMERAPLANES\n#define CAMERAPLANES\nuniform vec4 camera_params;\n#endif\nuniform float softening;\nuniform float colorMult;\nfloat saturate(float x) {\n\treturn clamp(x, 0.0, 1.0);\n}\n#ifndef UNPACKFLOAT\n#define UNPACKFLOAT\nfloat unpackFloat(vec4 rgbaDepth) {\n\tconst vec4 bitShift = vec4(1.0 / (256.0 * 256.0 * 256.0), 1.0 / (256.0 * 256.0), 1.0 / 256.0, 1.0);\n\tfloat depth = dot(rgbaDepth, bitShift);\n\treturn depth;\n}\n#endif\nvoid main(void) {\n\tvec4 tex  = gammaCorrectInput(texture2D(colorMap, vec2(texCoordsAlphaLife.x, 1.0 - texCoordsAlphaLife.y)));\n\tvec4 ramp = gammaCorrectInput(texture2D(colorParam, vec2(texCoordsAlphaLife.w, 0.0)));\n\tramp.rgb *= colorMult;\n\tramp.a += texCoordsAlphaLife.z;\n\tvec3 rgb = tex.rgb * ramp.rgb;\n\tfloat a  = tex.a * ramp.a;\n`;\n\nexport { particlePS as default };\n","var particleVS = `\nvec3 unpack3NFloats(float src) {\n\tfloat r = fract(src);\n\tfloat g = fract(src * 256.0);\n\tfloat b = fract(src * 65536.0);\n\treturn vec3(r, g, b);\n}\nfloat saturate(float x) {\n\treturn clamp(x, 0.0, 1.0);\n}\nvec4 tex1Dlod_lerp(highp sampler2D tex, vec2 tc) {\n\treturn mix( texture2D(tex,tc), texture2D(tex,tc + graphSampleSize), fract(tc.x*graphNumSamples) );\n}\nvec4 tex1Dlod_lerp(highp sampler2D tex, vec2 tc, out vec3 w) {\n\tvec4 a = texture2D(tex,tc);\n\tvec4 b = texture2D(tex,tc + graphSampleSize);\n\tfloat c = fract(tc.x*graphNumSamples);\n\tvec3 unpackedA = unpack3NFloats(a.w);\n\tvec3 unpackedB = unpack3NFloats(b.w);\n\tw = mix(unpackedA, unpackedB, c);\n\treturn mix(a, b, c);\n}\nvec2 rotate(vec2 quadXY, float pRotation, out mat2 rotMatrix) {\n\tfloat c = cos(pRotation);\n\tfloat s = sin(pRotation);\n\tmat2 m = mat2(c, -s, s, c);\n\trotMatrix = m;\n\treturn m * quadXY;\n}\nvec3 billboard(vec3 InstanceCoords, vec2 quadXY) {\n\t#ifdef SCREEN_SPACE\n\t\tvec3 pos = vec3(-1, 0, 0) * quadXY.x + vec3(0, -1, 0) * quadXY.y;\n\t#else\n\t\tvec3 pos = -matrix_viewInverse[0].xyz * quadXY.x + -matrix_viewInverse[1].xyz * quadXY.y;\n\t#endif\n\treturn pos;\n}\nvec3 customFace(vec3 InstanceCoords, vec2 quadXY) {\n\tvec3 pos = faceTangent * quadXY.x + faceBinorm * quadXY.y;\n\treturn pos;\n}\nvec2 safeNormalize(vec2 v) {\n\tfloat l = length(v);\n\treturn (l > 1e-06) ? v / l : v;\n}\nvoid main(void) {\n\tvec3 meshLocalPos = particle_vertexData.xyz;\n\tfloat id = floor(particle_vertexData.w);\n\tfloat rndFactor = fract(sin(id + 1.0 + seed));\n\tvec3 rndFactor3 = vec3(rndFactor, fract(rndFactor*10.0), fract(rndFactor*100.0));\n\tfloat uv = id / numParticlesPot;\n\treadInput(uv);\n#ifdef LOCAL_SPACE\n\tinVel = mat3(matrix_model) * inVel;\n#endif\n\tvec2 velocityV = safeNormalize((mat3(matrix_view) * inVel).xy);\n\tfloat particleLifetime = lifetime;\n\tif (inLife <= 0.0 || inLife > particleLifetime || !inShow) meshLocalPos = vec3(0.0);\n\tvec2 quadXY = meshLocalPos.xy;\n\tfloat nlife = clamp(inLife / particleLifetime, 0.0, 1.0);\n\tvec3 paramDiv;\n\tvec4 params = tex1Dlod_lerp(internalTex2, vec2(nlife, 0), paramDiv);\n\tfloat scale = params.y;\n\tfloat scaleDiv = paramDiv.x;\n\tfloat alphaDiv = paramDiv.z;\n\tscale += (scaleDiv * 2.0 - 1.0) * scaleDivMult * fract(rndFactor*10000.0);\n#ifndef USE_MESH\n\ttexCoordsAlphaLife = vec4(quadXY * -0.5 + 0.5, (alphaDiv * 2.0 - 1.0) * alphaDivMult * fract(rndFactor*1000.0), nlife);\n#else\n\ttexCoordsAlphaLife = vec4(particle_uv, (alphaDiv * 2.0 - 1.0) * alphaDivMult * fract(rndFactor*1000.0), nlife);\n#endif\n\tvec3 particlePos = inPos;\n\tvec3 particlePosMoved = vec3(0.0);\n\tmat2 rotMatrix;\n`;\n\nexport { particleVS as default };\n","var particleAnimFrameClampVS = `\n\tfloat animFrame = min(floor(texCoordsAlphaLife.w * animTexParams.y) + animTexParams.x, animTexParams.z);\n`;\n\nexport { particleAnimFrameClampVS as default };\n","var particleAnimFrameLoopVS = `\n\tfloat animFrame = floor(mod(texCoordsAlphaLife.w * animTexParams.y + animTexParams.x, animTexParams.z + 1.0));\n`;\n\nexport { particleAnimFrameLoopVS as default };\n","var particleAnimTexVS = `\n\tfloat animationIndex;\n\tif (animTexIndexParams.y == 1.0) {\n\t\tanimationIndex = floor((animTexParams.w + 1.0) * rndFactor3.z) * (animTexParams.z + 1.0);\n\t} else {\n\t\tanimationIndex = animTexIndexParams.x * (animTexParams.z + 1.0);\n\t}\n\tfloat atlasX = (animationIndex + animFrame) * animTexTilesParams.x;\n\tfloat atlasY = 1.0 - floor(atlasX + 1.0) * animTexTilesParams.y;\n\tatlasX = fract(atlasX);\n\ttexCoordsAlphaLife.xy *= animTexTilesParams.xy;\n\ttexCoordsAlphaLife.xy += vec2(atlasX, atlasY);\n`;\n\nexport { particleAnimTexVS as default };\n","var particleInputFloatPS = `\nvoid readInput(float uv) {\n\tvec4 tex = texture2D(particleTexIN, vec2(uv, 0.25));\n\tvec4 tex2 = texture2D(particleTexIN, vec2(uv, 0.75));\n\tinPos = tex.xyz;\n\tinVel = tex2.xyz;\n\tinAngle = (tex.w < 0.0? -tex.w : tex.w) - 1000.0;\n\tinShow = tex.w >= 0.0;\n\tinLife = tex2.w;\n}\n`;\n\nexport { particleInputFloatPS as default };\n","var particleInputRgba8PS = `\n#define PI2 6.283185307179586\nuniform vec3 inBoundsSize;\nuniform vec3 inBoundsCenter;\nuniform float maxVel;\nfloat decodeFloatRG(vec2 rg) {\n\treturn rg.y*(1.0/255.0) + rg.x;\n}\nfloat decodeFloatRGBA( vec4 rgba ) {\n\treturn dot( rgba, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/160581375.0) );\n}\nvoid readInput(float uv) {\n\tvec4 tex0 = texture2D(particleTexIN, vec2(uv, 0.125));\n\tvec4 tex1 = texture2D(particleTexIN, vec2(uv, 0.375));\n\tvec4 tex2 = texture2D(particleTexIN, vec2(uv, 0.625));\n\tvec4 tex3 = texture2D(particleTexIN, vec2(uv, 0.875));\n\tinPos = vec3(decodeFloatRG(tex0.rg), decodeFloatRG(tex0.ba), decodeFloatRG(tex1.rg));\n\tinPos = (inPos - vec3(0.5)) * inBoundsSize + inBoundsCenter;\n\tinVel = tex2.xyz;\n\tinVel = (inVel - vec3(0.5)) * maxVel;\n\tinAngle = decodeFloatRG(tex1.ba) * PI2;\n\tinShow = tex2.a > 0.5;\n\tinLife = decodeFloatRGBA(tex3);\n\tfloat maxNegLife = max(lifetime, (numParticles - 1.0) * (rate+rateDiv));\n\tfloat maxPosLife = lifetime+1.0;\n\tinLife = inLife * (maxNegLife + maxPosLife) - maxNegLife;\n}\n`;\n\nexport { particleInputRgba8PS as default };\n","var particleOutputFloatPS = `\nvoid writeOutput() {\n\tif (gl_FragCoord.y<1.0) {\n\t\tgl_FragColor = vec4(outPos, (outAngle + 1000.0) * visMode);\n\t} else {\n\t\tgl_FragColor = vec4(outVel, outLife);\n\t}\n}\n`;\n\nexport { particleOutputFloatPS as default };\n","var particleOutputRgba8PS = `\nuniform vec3 outBoundsMul;\nuniform vec3 outBoundsAdd;\nvec2 encodeFloatRG( float v ) {\n\tvec2 enc = vec2(1.0, 255.0) * v;\n\tenc = fract(enc);\n\tenc -= enc.yy * vec2(1.0/255.0, 1.0/255.0);\n\treturn enc;\n}\nvec4 encodeFloatRGBA( float v ) {\n\tvec4 enc = vec4(1.0, 255.0, 65025.0, 160581375.0) * v;\n\tenc = fract(enc);\n\tenc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);\n\treturn enc;\n}\nvoid writeOutput() {\n\toutPos = outPos * outBoundsMul + outBoundsAdd;\n\toutAngle = fract(outAngle / PI2);\n\toutVel = (outVel / maxVel) + vec3(0.5);\n\tfloat maxNegLife = max(lifetime, (numParticles - 1.0) * (rate+rateDiv));\n\tfloat maxPosLife = lifetime+1.0;\n\toutLife = (outLife + maxNegLife) / (maxNegLife + maxPosLife);\n\tif (gl_FragCoord.y < 1.0) {\n\t\tgl_FragColor = vec4(encodeFloatRG(outPos.x), encodeFloatRG(outPos.y));\n\t} else if (gl_FragCoord.y < 2.0) {\n\t\tgl_FragColor = vec4(encodeFloatRG(outPos.z), encodeFloatRG(outAngle));\n\t} else if (gl_FragCoord.y < 3.0) {\n\t\tgl_FragColor = vec4(outVel, visMode*0.5+0.5);\n\t} else {\n\t\tgl_FragColor = encodeFloatRGBA(outLife);\n\t}\n}\n`;\n\nexport { particleOutputRgba8PS as default };\n","var particleUpdaterAABBPS = `\nuniform mat3 spawnBounds;\nuniform vec3 spawnPosInnerRatio;\nvec3 calcSpawnPosition(vec3 inBounds, float rndFactor) {\n\tvec3 pos = inBounds - vec3(0.5);\n\tvec3 posAbs = abs(pos);\n\tvec3 maxPos = vec3(max(posAbs.x, max(posAbs.y, posAbs.z)));\n\tvec3 edge = maxPos + (vec3(0.5) - maxPos) * spawnPosInnerRatio;\n\tpos.x = edge.x * (maxPos.x == posAbs.x ? sign(pos.x) : 2.0 * pos.x);\n\tpos.y = edge.y * (maxPos.y == posAbs.y ? sign(pos.y) : 2.0 * pos.y);\n\tpos.z = edge.z * (maxPos.z == posAbs.z ? sign(pos.z) : 2.0 * pos.z);\n#ifndef LOCAL_SPACE\n\treturn emitterPos + spawnBounds * pos;\n#else\n\treturn spawnBounds * pos;\n#endif\n}\nvoid addInitialVelocity(inout vec3 localVelocity, vec3 inBounds) {\n\tlocalVelocity -= vec3(0, 0, initialVelocity);\n}\n`;\n\nexport { particleUpdaterAABBPS as default };\n","var particleUpdaterEndPS = `\n\twriteOutput();\n}\n`;\n\nexport { particleUpdaterEndPS as default };\n","var particleUpdaterInitPS = `\nvarying vec2 vUv0;\nuniform highp sampler2D particleTexIN;\nuniform highp sampler2D internalTex0;\nuniform highp sampler2D internalTex1;\nuniform highp sampler2D internalTex2;\nuniform highp sampler2D internalTex3;\nuniform mat3 emitterMatrix, emitterMatrixInv;\nuniform vec3 emitterScale;\nuniform vec3 emitterPos, frameRandom, localVelocityDivMult, velocityDivMult;\nuniform float delta, rate, rateDiv, lifetime, numParticles, rotSpeedDivMult, radialSpeedDivMult, seed;\nuniform float startAngle, startAngle2;\nuniform float initialVelocity;\nuniform float graphSampleSize;\nuniform float graphNumSamples;\nvec3 inPos;\nvec3 inVel;\nfloat inAngle;\nbool inShow;\nfloat inLife;\nfloat visMode;\nvec3 outPos;\nvec3 outVel;\nfloat outAngle;\nbool outShow;\nfloat outLife;\n`;\n\nexport { particleUpdaterInitPS as default };\n","var particleUpdaterNoRespawnPS = `\n\tif (outLife >= lifetime) {\n\t\toutLife -= max(lifetime, (numParticles - 1.0) * particleRate);\n\t\tvisMode = -1.0;\n\t}\n`;\n\nexport { particleUpdaterNoRespawnPS as default };\n","var particleUpdaterOnStopPS = `\n\tvisMode = outLife < 0.0? -1.0: visMode;\n`;\n\nexport { particleUpdaterOnStopPS as default };\n","var particleUpdaterRespawnPS = `\n\tif (outLife >= lifetime) {\n\t\toutLife -= max(lifetime, (numParticles - 1.0) * particleRate);\n\t\tvisMode = 1.0;\n\t}\n\tvisMode = outLife < 0.0? 1.0: visMode;\n`;\n\nexport { particleUpdaterRespawnPS as default };\n","var particleUpdaterSpherePS = `\nuniform float spawnBoundsSphere;\nuniform float spawnBoundsSphereInnerRatio;\nvec3 calcSpawnPosition(vec3 inBounds, float rndFactor) {\n\tfloat rnd4 = fract(rndFactor * 1000.0);\n\tvec3 norm = normalize(inBounds.xyz - vec3(0.5));\n\tfloat r = rnd4 * (1.0 - spawnBoundsSphereInnerRatio) + spawnBoundsSphereInnerRatio;\n#ifndef LOCAL_SPACE\n\treturn emitterPos + norm * r * spawnBoundsSphere;\n#else\n\treturn norm * r * spawnBoundsSphere;\n#endif\n}\nvoid addInitialVelocity(inout vec3 localVelocity, vec3 inBounds) {\n\tlocalVelocity += normalize(inBounds - vec3(0.5)) * initialVelocity;\n}\n`;\n\nexport { particleUpdaterSpherePS as default };\n","var particleUpdaterStartPS = `\nfloat saturate(float x) {\n\treturn clamp(x, 0.0, 1.0);\n}\nvec3 unpack3NFloats(float src) {\n\tfloat r = fract(src);\n\tfloat g = fract(src * 256.0);\n\tfloat b = fract(src * 65536.0);\n\treturn vec3(r, g, b);\n}\nvec3 tex1Dlod_lerp(highp sampler2D tex, vec2 tc, out vec3 w) {\n\tvec4 a = texture2D(tex, tc);\n\tvec4 b = texture2D(tex, tc + graphSampleSize);\n\tfloat c = fract(tc.x * graphNumSamples);\n\tvec3 unpackedA = unpack3NFloats(a.w);\n\tvec3 unpackedB = unpack3NFloats(b.w);\n\tw = mix(unpackedA, unpackedB, c);\n\treturn mix(a.xyz, b.xyz, c);\n}\n#define HASHSCALE4 vec4(1031, .1030, .0973, .1099)\nvec4 hash41(float p) {\n\tvec4 p4 = fract(vec4(p) * HASHSCALE4);\n\tp4 += dot(p4, p4.wzxy+19.19);\n\treturn fract(vec4((p4.x + p4.y)*p4.z, (p4.x + p4.z)*p4.y, (p4.y + p4.z)*p4.w, (p4.z + p4.w)*p4.x));\n}\nvoid main(void) {\n\tif (gl_FragCoord.x > numParticles) discard;\n\treadInput(vUv0.x);\n\tvisMode = inShow? 1.0 : -1.0;\n\tvec4 rndFactor = hash41(gl_FragCoord.x + seed);\n\tfloat particleRate = rate + rateDiv * rndFactor.x;\n\toutLife = inLife + delta;\n\tfloat nlife = clamp(outLife / lifetime, 0.0, 1.0);\n\tvec3 localVelocityDiv;\n\tvec3 velocityDiv;\n\tvec3 paramDiv;\n\tvec3 localVelocity = tex1Dlod_lerp(internalTex0, vec2(nlife, 0), localVelocityDiv);\n\tvec3 velocity =\t  tex1Dlod_lerp(internalTex1, vec2(nlife, 0), velocityDiv);\n\tvec3 params =\t\ttex1Dlod_lerp(internalTex2, vec2(nlife, 0), paramDiv);\n\tfloat rotSpeed = params.x;\n\tfloat rotSpeedDiv = paramDiv.y;\n\tvec3 radialParams = tex1Dlod_lerp(internalTex3, vec2(nlife, 0), paramDiv);\n\tfloat radialSpeed = radialParams.x;\n\tfloat radialSpeedDiv = radialParams.y;\n\tbool respawn = inLife <= 0.0 || outLife >= lifetime;\n\tinPos = respawn ? calcSpawnPosition(rndFactor.xyz, rndFactor.x) : inPos;\n\tinAngle = respawn ? mix(startAngle, startAngle2, rndFactor.x) : inAngle;\n#ifndef LOCAL_SPACE\n\tvec3 radialVel = inPos - emitterPos;\n#else\n\tvec3 radialVel = inPos;\n#endif\n\tradialVel = (dot(radialVel, radialVel) > 1.0E-8) ? radialSpeed * normalize(radialVel) : vec3(0.0);\n\tradialVel += (radialSpeedDiv * vec3(2.0) - vec3(1.0)) * radialSpeedDivMult * rndFactor.xyz;\n\tlocalVelocity +=\t(localVelocityDiv * vec3(2.0) - vec3(1.0)) * localVelocityDivMult * rndFactor.xyz;\n\tvelocity +=\t\t (velocityDiv * vec3(2.0) - vec3(1.0)) * velocityDivMult * rndFactor.xyz;\n\trotSpeed +=\t\t (rotSpeedDiv * 2.0 - 1.0) * rotSpeedDivMult * rndFactor.y;\n\taddInitialVelocity(localVelocity, rndFactor.xyz);\n#ifndef LOCAL_SPACE\n\toutVel = emitterMatrix * localVelocity + (radialVel + velocity) * emitterScale;\n#else\n\toutVel = (localVelocity + radialVel) / emitterScale + emitterMatrixInv * velocity;\n#endif\n\toutPos = inPos + outVel * delta;\n\toutAngle = inAngle + rotSpeed * delta;\n`;\n\nexport { particleUpdaterStartPS as default };\n","var particle_billboardVS = `\n\tquadXY = rotate(quadXY, inAngle, rotMatrix);\n\tvec3 localPos = billboard(particlePos, quadXY);\n`;\n\nexport { particle_billboardVS as default };\n","var particle_blendAddPS = `\n\tdBlendModeFogFactor = 0.0;\n\trgb *= saturate(gammaCorrectInput(max(a, 0.0)));\n\tif ((rgb.r + rgb.g + rgb.b) < 0.000001) discard;\n`;\n\nexport { particle_blendAddPS as default };\n","var particle_blendMultiplyPS = `\n\trgb = mix(vec3(1.0), rgb, vec3(a));\n\tif (rgb.r + rgb.g + rgb.b > 2.99) discard;\n`;\n\nexport { particle_blendMultiplyPS as default };\n","var particle_blendNormalPS = `\n\tif (a < 0.01) discard;\n`;\n\nexport { particle_blendNormalPS as default };\n","var particle_cpuVS = `\nattribute vec4 particle_vertexData;\nattribute vec4 particle_vertexData2;\nattribute vec4 particle_vertexData3;\nattribute float particle_vertexData4;\n#ifndef USE_MESH\nattribute vec2 particle_vertexData5;\n#else\nattribute vec4 particle_vertexData5;\n#endif\nuniform mat4 matrix_viewProjection;\nuniform mat4 matrix_model;\n#ifndef VIEWMATRIX\n#define VIEWMATRIX\nuniform mat4 matrix_view;\n#endif\nuniform mat3 matrix_normal;\nuniform mat4 matrix_viewInverse;\nuniform float numParticles;\nuniform float lifetime;\nuniform float stretch;\nuniform float seed;\nuniform vec3 wrapBounds;\nuniform vec3 emitterScale;\nuniform vec3 faceTangent;\nuniform vec3 faceBinorm;\nuniform highp sampler2D internalTex0;\nuniform highp sampler2D internalTex1;\nuniform highp sampler2D internalTex2;\nuniform vec3 emitterPos;\nvarying vec4 texCoordsAlphaLife;\nvec2 rotate(vec2 quadXY, float pRotation, out mat2 rotMatrix)\n{\n\tfloat c = cos(pRotation);\n\tfloat s = sin(pRotation);\n\tmat2 m = mat2(c, -s, s, c);\n\trotMatrix = m;\n\treturn m * quadXY;\n}\nvec3 billboard(vec3 InstanceCoords, vec2 quadXY)\n{\n\tvec3 pos = -matrix_viewInverse[0].xyz * quadXY.x + -matrix_viewInverse[1].xyz * quadXY.y;\n\treturn pos;\n}\nvec3 customFace(vec3 InstanceCoords, vec2 quadXY)\n{\n\tvec3 pos = faceTangent * quadXY.x + faceBinorm * quadXY.y;\n\treturn pos;\n}\nvoid main(void)\n{\n\tvec3 particlePos = particle_vertexData.xyz;\n\tvec3 inPos = particlePos;\n\tvec3 vertPos = particle_vertexData3.xyz;\n\tvec3 inVel = vec3(particle_vertexData2.w, particle_vertexData3.w, particle_vertexData5.x);\n\tfloat id = floor(particle_vertexData4);\n\tfloat rndFactor = fract(sin(id + 1.0 + seed));\n\tvec3 rndFactor3 = vec3(rndFactor, fract(rndFactor*10.0), fract(rndFactor*100.0));\n#ifdef LOCAL_SPACE\n\tinVel = mat3(matrix_model) * inVel;\n#endif\n\tvec2 velocityV = normalize((mat3(matrix_view) * inVel).xy);\n\tvec2 quadXY = vertPos.xy;\n#ifdef USE_MESH\n\ttexCoordsAlphaLife = vec4(particle_vertexData5.zw, particle_vertexData2.z, particle_vertexData.w);\n#else\n\ttexCoordsAlphaLife = vec4(quadXY * -0.5 + 0.5, particle_vertexData2.z, particle_vertexData.w);\n#endif\n\tmat2 rotMatrix;\n\tfloat inAngle = particle_vertexData2.x;\n\tvec3 particlePosMoved = vec3(0.0);\n\tvec3 meshLocalPos = particle_vertexData3.xyz;\n`;\n\nexport { particle_cpuVS as default };\n","var particle_cpu_endVS = `\n\tlocalPos *= particle_vertexData2.y * emitterScale;\n\tlocalPos += particlePos;\n\tgl_Position = matrix_viewProjection * vec4(localPos, 1.0);\n`;\n\nexport { particle_cpu_endVS as default };\n","var particle_customFaceVS = `\n\tquadXY = rotate(quadXY, inAngle, rotMatrix);\n\tvec3 localPos = customFace(particlePos, quadXY);\n`;\n\nexport { particle_customFaceVS as default };\n","var particle_endPS = `\n\trgb = addFog(rgb);\n\trgb = toneMap(rgb);\n\trgb = gammaCorrectOutput(rgb);\n\tgl_FragColor = vec4(rgb, a);\n}\n`;\n\nexport { particle_endPS as default };\n","var particle_endVS = `\n\tlocalPos *= scale * emitterScale;\n\tlocalPos += particlePos;\n\t#ifdef SCREEN_SPACE\n\tgl_Position = vec4(localPos.x, localPos.y, 0.0, 1.0);\n\t#else\n\tgl_Position = matrix_viewProjection * vec4(localPos.xyz, 1.0);\n\t#endif\n`;\n\nexport { particle_endVS as default };\n","var particle_halflambertPS = `\n\tvec3 negNormal = normal*0.5+0.5;\n\tvec3 posNormal = -normal*0.5+0.5;\n\tnegNormal *= negNormal;\n\tposNormal *= posNormal;\n`;\n\nexport { particle_halflambertPS as default };\n","var particle_initVS = `\nattribute vec4 particle_vertexData;\n#ifdef USE_MESH\nattribute vec2 particle_uv;\n#endif\nuniform mat4 matrix_viewProjection;\nuniform mat4 matrix_model;\nuniform mat3 matrix_normal;\nuniform mat4 matrix_viewInverse;\n#ifndef VIEWMATRIX\n#define VIEWMATRIX\nuniform mat4 matrix_view;\n#endif\nuniform float numParticles, numParticlesPot;\nuniform float graphSampleSize;\nuniform float graphNumSamples;\nuniform float stretch;\nuniform vec3 wrapBounds;\nuniform vec3 emitterScale, emitterPos, faceTangent, faceBinorm;\nuniform float rate, rateDiv, lifetime, deltaRandomnessStatic, scaleDivMult, alphaDivMult, seed, delta;\nuniform sampler2D particleTexOUT, particleTexIN;\nuniform highp sampler2D internalTex0;\nuniform highp sampler2D internalTex1;\nuniform highp sampler2D internalTex2;\n#ifndef CAMERAPLANES\n#define CAMERAPLANES\nuniform vec4 camera_params;\n#endif\nvarying vec4 texCoordsAlphaLife;\nvec3 inPos;\nvec3 inVel;\nfloat inAngle;\nbool inShow;\nfloat inLife;\n`;\n\nexport { particle_initVS as default };\n","var particle_lambertPS = `\n\tvec3 negNormal = max(normal, vec3(0.0));\n\tvec3 posNormal = max(-normal, vec3(0.0));\n`;\n\nexport { particle_lambertPS as default };\n","var particle_lightingPS = `\n\tvec3 light = negNormal.x*lightCube[0] + posNormal.x*lightCube[1] +\n\t\t\t\t\t\tnegNormal.y*lightCube[2] + posNormal.y*lightCube[3] +\n\t\t\t\t\t\tnegNormal.z*lightCube[4] + posNormal.z*lightCube[5];\n\trgb *= light;\n`;\n\nexport { particle_lightingPS as default };\n","var particle_localShiftVS = `\n\tparticlePos = (matrix_model * vec4(particlePos, 1.0)).xyz;\n`;\n\nexport { particle_localShiftVS as default };\n","var particle_meshVS = `\n\tvec3 localPos = meshLocalPos;\n\tlocalPos.xy = rotate(localPos.xy, inAngle, rotMatrix);\n\tlocalPos.yz = rotate(localPos.yz, inAngle, rotMatrix);\n\tbillboard(particlePos, quadXY);\n`;\n\nexport { particle_meshVS as default };\n","var particle_normalVS = `\n\tNormal = normalize(localPos + matrix_viewInverse[2].xyz);\n`;\n\nexport { particle_normalVS as default };\n","var particle_normalMapPS = `\n\tvec3 normalMap = normalize(texture2D(normalMap, vec2(texCoordsAlphaLife.x, 1.0 - texCoordsAlphaLife.y)).xyz * 2.0 - 1.0);\n\tvec3 normal = ParticleMat * normalMap;\n`;\n\nexport { particle_normalMapPS as default };\n","var particle_pointAlongVS = `\n\tinAngle = atan(velocityV.x, velocityV.y);\n`;\n\nexport { particle_pointAlongVS as default };\n","var particle_softPS = `\n\tfloat depth = getLinearScreenDepth();\n\tfloat particleDepth = vDepth;\n\tfloat depthDiff = saturate(abs(particleDepth - depth) * softening);\n\ta *= depthDiff;\n`;\n\nexport { particle_softPS as default };\n","var particle_softVS = `\n\tvDepth = getLinearDepth(localPos);\n`;\n\nexport { particle_softVS as default };\n","var particle_stretchVS = `\n\tvec3 moveDir = inVel * stretch;\n\tvec3 posPrev = particlePos - moveDir;\n\tposPrev += particlePosMoved;\n\tvec2 centerToVertexV = normalize((mat3(matrix_view) * localPos).xy);\n\tfloat interpolation = dot(-velocityV, centerToVertexV) * 0.5 + 0.5;\n\tparticlePos = mix(particlePos, posPrev, interpolation);\n`;\n\nexport { particle_stretchVS as default };\n","var particle_TBNVS = `\n\tmat3 rot3 = mat3(rotMatrix[0][0], rotMatrix[0][1], 0.0, rotMatrix[1][0], rotMatrix[1][1], 0.0, 0.0, 0.0, 1.0);\n\tParticleMat = mat3(-matrix_viewInverse[0].xyz, -matrix_viewInverse[1].xyz, matrix_viewInverse[2].xyz) * rot3;\n`;\n\nexport { particle_TBNVS as default };\n","var particle_wrapVS = `\n\tvec3 origParticlePos = particlePos;\n\tparticlePos -= matrix_model[3].xyz;\n\tparticlePos = mod(particlePos, wrapBounds) - wrapBounds * 0.5;\n\tparticlePos += matrix_model[3].xyz;\n\tparticlePosMoved = particlePos - origParticlePos;\n`;\n\nexport { particle_wrapVS as default };\n","var reflDirPS = `\nvoid getReflDir(vec3 worldNormal, vec3 viewDir, float gloss, mat3 tbn) {\n\tdReflDirW = normalize(-reflect(viewDir, worldNormal));\n}\n`;\n\nexport { reflDirPS as default };\n","var reflDirAnisoPS = `\nvoid getReflDir(vec3 worldNormal, vec3 viewDir, float gloss, mat3 tbn) {\n\tfloat roughness = sqrt(1.0 - min(gloss, 1.0));\n\tfloat anisotropy = material_anisotropy * roughness;\n\tvec3 anisotropicDirection = anisotropy >= 0.0 ? tbn[1] : tbn[0];\n\tvec3 anisotropicTangent = cross(anisotropicDirection, viewDir);\n\tvec3 anisotropicNormal = cross(anisotropicTangent, anisotropicDirection);\n\tvec3 bentNormal = normalize(mix(normalize(worldNormal), normalize(anisotropicNormal), anisotropy));\n\tdReflDirW = reflect(-viewDir, bentNormal);\n}\n`;\n\nexport { reflDirAnisoPS as default };\n","var reflectionCCPS = `\n#ifdef LIT_CLEARCOAT\nvoid addReflectionCC(vec3 reflDir, float gloss) {\n\tccReflection += calcReflection(reflDir, gloss);\n}\n#endif\n`;\n\nexport { reflectionCCPS as default };\n","var reflectionCubePS = `\nuniform samplerCube texture_cubeMap;\nuniform float material_reflectivity;\nvec3 calcReflection(vec3 reflDir, float gloss) {\n\tvec3 lookupVec = fixSeams(cubeMapProject(reflDir));\n\tlookupVec.x *= -1.0;\n\treturn $DECODE(textureCube(texture_cubeMap, lookupVec));\n}\nvoid addReflection(vec3 reflDir, float gloss) {   \n\tdReflection += vec4(calcReflection(reflDir, gloss), material_reflectivity);\n}\n`;\n\nexport { reflectionCubePS as default };\n","var reflectionEnvHQPS = `\n#ifndef ENV_ATLAS\n#define ENV_ATLAS\nuniform sampler2D texture_envAtlas;\n#endif\nuniform samplerCube texture_cubeMap;\nuniform float material_reflectivity;\nvec3 calcReflection(vec3 reflDir, float gloss) {\n\tvec3 dir = cubeMapProject(reflDir) * vec3(-1.0, 1.0, 1.0);\n\tvec2 uv = toSphericalUv(dir);\n\tfloat level = saturate(1.0 - gloss) * 5.0;\n\tfloat ilevel = floor(level);\n\tfloat flevel = level - ilevel;\n\tvec3 sharp = $DECODE_CUBEMAP(textureCube(texture_cubeMap, fixSeams(dir)));\n\tvec3 roughA = $DECODE(texture2D(texture_envAtlas, mapRoughnessUv(uv, ilevel)));\n\tvec3 roughB = $DECODE(texture2D(texture_envAtlas, mapRoughnessUv(uv, ilevel + 1.0)));\n\treturn processEnvironment(mix(sharp, mix(roughA, roughB, flevel), min(level, 1.0)));\n}\nvoid addReflection(vec3 reflDir, float gloss) {   \n\tdReflection += vec4(calcReflection(reflDir, gloss), material_reflectivity);\n}\n`;\n\nexport { reflectionEnvHQPS as default };\n","var reflectionEnvPS = `\n#ifndef ENV_ATLAS\n#define ENV_ATLAS\nuniform sampler2D texture_envAtlas;\n#endif\nuniform float material_reflectivity;\nfloat shinyMipLevel(vec2 uv) {\n\tvec2 dx = dFdx(uv);\n\tvec2 dy = dFdy(uv);\n\tvec2 uv2 = vec2(fract(uv.x + 0.5), uv.y);\n\tvec2 dx2 = dFdx(uv2);\n\tvec2 dy2 = dFdy(uv2);\n\tfloat maxd = min(max(dot(dx, dx), dot(dy, dy)), max(dot(dx2, dx2), dot(dy2, dy2)));\n\treturn clamp(0.5 * log2(maxd) - 1.0 + textureBias, 0.0, 5.0);\n}\nvec3 calcReflection(vec3 reflDir, float gloss) {\n\tvec3 dir = cubeMapProject(reflDir) * vec3(-1.0, 1.0, 1.0);\n\tvec2 uv = toSphericalUv(dir);\n\tfloat level = saturate(1.0 - gloss) * 5.0;\n\tfloat ilevel = floor(level);\n\tfloat level2 = shinyMipLevel(uv * atlasSize);\n\tfloat ilevel2 = floor(level2);\n\tvec2 uv0, uv1;\n\tfloat weight;\n\tif (ilevel == 0.0) {\n\t\tuv0 = mapShinyUv(uv, ilevel2);\n\t\tuv1 = mapShinyUv(uv, ilevel2 + 1.0);\n\t\tweight = level2 - ilevel2;\n\t} else {\n\t\tuv0 = uv1 = mapRoughnessUv(uv, ilevel);\n\t\tweight = 0.0;\n\t}\n\tvec3 linearA = $DECODE(texture2D(texture_envAtlas, uv0));\n\tvec3 linearB = $DECODE(texture2D(texture_envAtlas, uv1));\n\tvec3 linear0 = mix(linearA, linearB, weight);\n\tvec3 linear1 = $DECODE(texture2D(texture_envAtlas, mapRoughnessUv(uv, ilevel + 1.0)));\n\treturn processEnvironment(mix(linear0, linear1, level - ilevel));\n}\nvoid addReflection(vec3 reflDir, float gloss) {   \n\tdReflection += vec4(calcReflection(reflDir, gloss), material_reflectivity);\n}\n`;\n\nexport { reflectionEnvPS as default };\n","var reflectionSpherePS = `\n#ifndef VIEWMATRIX\n#define VIEWMATRIX\nuniform mat4 matrix_view;\n#endif\nuniform sampler2D texture_sphereMap;\nuniform float material_reflectivity;\nvec3 calcReflection(vec3 reflDir, float gloss) {\n\tvec3 reflDirV = (mat3(matrix_view) * reflDir).xyz;\n\tfloat m = 2.0 * sqrt( dot(reflDirV.xy, reflDirV.xy) + (reflDirV.z+1.0)*(reflDirV.z+1.0) );\n\tvec2 sphereMapUv = reflDirV.xy / m + 0.5;\n\treturn $DECODE(texture2D(texture_sphereMap, sphereMapUv));\n}\nvoid addReflection(vec3 reflDir, float gloss) {   \n\tdReflection += vec4(calcReflection(reflDir, gloss), material_reflectivity);\n}\n`;\n\nexport { reflectionSpherePS as default };\n","var reflectionSphereLowPS = `\nuniform sampler2D texture_sphereMap;\nuniform float material_reflectivity;\nvec3 calcReflection(vec3 reflDir, float gloss) {\n\tvec3 reflDirV = vNormalV;\n\tvec2 sphereMapUv = reflDirV.xy * 0.5 + 0.5;\n\treturn $DECODE(texture2D(texture_sphereMap, sphereMapUv));\n}\nvoid addReflection(vec3 reflDir, float gloss) {   \n\tdReflection += vec4(calcReflection(reflDir, gloss), material_reflectivity);\n}\n`;\n\nexport { reflectionSphereLowPS as default };\n","var reflectionSheenPS = `\nvoid addReflectionSheen(vec3 worldNormal, vec3 viewDir, float gloss) {\n\tfloat NoV = dot(worldNormal, viewDir);\n\tfloat alphaG = gloss * gloss;\n\tfloat a = gloss < 0.25 ? -339.2 * alphaG + 161.4 * gloss - 25.9 : -8.48 * alphaG + 14.3 * gloss - 9.95;\n\tfloat b = gloss < 0.25 ? 44.0 * alphaG - 23.7 * gloss + 3.26 : 1.97 * alphaG - 3.27 * gloss + 0.72;\n\tfloat DG = exp( a * NoV + b ) + ( gloss < 0.25 ? 0.0 : 0.1 * ( gloss - 0.25 ) );\n\tsReflection += calcReflection(worldNormal, 0.0) * saturate(DG);\n}\n`;\n\nexport { reflectionSheenPS as default };\n","var refractionCubePS = `\nvec3 refract2(vec3 viewVec, vec3 normal, float IOR) {\n\tfloat vn = dot(viewVec, normal);\n\tfloat k = 1.0 - IOR * IOR * (1.0 - vn * vn);\n\tvec3 refrVec = IOR * viewVec - (IOR * vn + sqrt(k)) * normal;\n\treturn refrVec;\n}\nvoid addRefraction(\n\tvec3 worldNormal, \n\tvec3 viewDir, \n\tfloat thickness, \n\tfloat gloss, \n\tvec3 specularity, \n\tvec3 albedo, \n\tfloat transmission,\n\tfloat refractionIndex\n#if defined(LIT_IRIDESCENCE)\n\t, vec3 iridescenceFresnel,\n\tfloat iridescenceIntensity\n#endif \n) {\n\tvec4 tmpRefl = dReflection;\n\tvec3 reflectionDir = refract2(-viewDir, worldNormal, refractionIndex);\n\tdReflection = vec4(0);\n\taddReflection(reflectionDir, gloss);\n\tdDiffuseLight = mix(dDiffuseLight, dReflection.rgb * albedo, transmission);\n\tdReflection = tmpRefl;\n}\n`;\n\nexport { refractionCubePS as default };\n","var refractionDynamicPS = `\nuniform float material_invAttenuationDistance;\nuniform vec3 material_attenuation;\nvoid addRefraction(\n\tvec3 worldNormal, \n\tvec3 viewDir, \n\tfloat thickness, \n\tfloat gloss, \n\tvec3 specularity, \n\tvec3 albedo, \n\tfloat transmission,\n\tfloat refractionIndex\n#if defined(LIT_IRIDESCENCE)\n\t, vec3 iridescenceFresnel,\n\tfloat iridescenceIntensity\n#endif\n) {\n\tvec3 modelScale;\n\tmodelScale.x = length(vec3(matrix_model[0].xyz));\n\tmodelScale.y = length(vec3(matrix_model[1].xyz));\n\tmodelScale.z = length(vec3(matrix_model[2].xyz));\n\tvec3 refractionVector = normalize(refract(-viewDir, worldNormal, refractionIndex)) * thickness * modelScale;\n\tvec4 pointOfRefraction = vec4(vPositionW + refractionVector, 1.0);\n\tvec4 projectionPoint = matrix_viewProjection * pointOfRefraction;\n\tvec2 uv = getGrabScreenPos(projectionPoint);\n\t#ifdef SUPPORTS_TEXLOD\n\t\tfloat iorToRoughness = (1.0 - gloss) * clamp((1.0 / refractionIndex) * 2.0 - 2.0, 0.0, 1.0);\n\t\tfloat refractionLod = log2(uScreenSize.x) * iorToRoughness;\n\t\tvec3 refraction = texture2DLodEXT(uSceneColorMap, uv, refractionLod).rgb;\n\t#else\n\t\tvec3 refraction = texture2D(uSceneColorMap, uv).rgb;\n\t#endif\n\tvec3 transmittance;\n\tif (material_invAttenuationDistance != 0.0)\n\t{\n\t\tvec3 attenuation = -log(material_attenuation) * material_invAttenuationDistance;\n\t\ttransmittance = exp(-attenuation * length(refractionVector));\n\t}\n\telse\n\t{\n\t\ttransmittance = refraction;\n\t}\n\tvec3 fresnel = vec3(1.0) - \n\t\tgetFresnel(\n\t\t\tdot(viewDir, worldNormal), \n\t\t\tgloss, \n\t\t\tspecularity\n\t\t#if defined(LIT_IRIDESCENCE)\n\t\t\t, iridescenceFresnel,\n\t\t\tiridescenceIntensity\n\t\t#endif\n\t\t);\n\tdDiffuseLight = mix(dDiffuseLight, refraction * transmittance * fresnel, transmission);\n}\n`;\n\nexport { refractionDynamicPS as default };\n","import decodePS from './decode.js';\nimport encodePS from './encode.js';\n\nvar reprojectPS = `\nvarying vec2 vUv0;\n#ifdef CUBEMAP_SOURCE\n\tuniform samplerCube sourceCube;\n#else\n\tuniform sampler2D sourceTex;\n#endif\n#ifdef USE_SAMPLES_TEX\n\tuniform sampler2D samplesTex;\n\tuniform vec2 samplesTexInverseSize;\n#endif\nuniform vec4 params;\nuniform vec2 params2;\nfloat targetFace() { return params.x; }\nfloat specularPower() { return params.y; }\nfloat sourceCubeSeamScale() { return params.z; }\nfloat targetCubeSeamScale() { return params.w; }\nfloat targetTotalPixels() { return params2.x; }\nfloat sourceTotalPixels() { return params2.y; }\nfloat PI = 3.141592653589793;\nfloat saturate(float x) {\n\treturn clamp(x, 0.0, 1.0);\n}\n${decodePS}\n${encodePS}\nvec3 modifySeams(vec3 dir, float scale) {\n\tvec3 adir = abs(dir);\n\tfloat M = max(max(adir.x, adir.y), adir.z);\n\treturn dir / M * vec3(\n\t\tadir.x == M ? 1.0 : scale,\n\t\tadir.y == M ? 1.0 : scale,\n\t\tadir.z == M ? 1.0 : scale\n\t);\n}\nvec2 toSpherical(vec3 dir) {\n\treturn vec2(dir.xz == vec2(0.0) ? 0.0 : atan(dir.x, dir.z), asin(dir.y));\n}\nvec3 fromSpherical(vec2 uv) {\n\treturn vec3(cos(uv.y) * sin(uv.x),\n\t\t\t\tsin(uv.y),\n\t\t\t\tcos(uv.y) * cos(uv.x));\n}\nvec3 getDirectionEquirect() {\n\treturn fromSpherical((vec2(vUv0.x, 1.0 - vUv0.y) * 2.0 - 1.0) * vec2(PI, PI * 0.5));\n}\nfloat signNotZero(float k){\n\treturn(k >= 0.0) ? 1.0 : -1.0;\n}\nvec2 signNotZero(vec2 v) {\n\treturn vec2(signNotZero(v.x), signNotZero(v.y));\n}\nvec3 octDecode(vec2 o) {\n\tvec3 v = vec3(o.x, 1.0 - abs(o.x) - abs(o.y), o.y);\n\tif (v.y < 0.0) {\n\t\tv.xz = (1.0 - abs(v.zx)) * signNotZero(v.xz);\n\t}\n\treturn normalize(v);\n}\nvec3 getDirectionOctahedral() {\n\treturn octDecode(vec2(vUv0.x, 1.0 - vUv0.y) * 2.0 - 1.0);\n}\nvec2 octEncode(in vec3 v) {\n\tfloat l1norm = abs(v.x) + abs(v.y) + abs(v.z);\n\tvec2 result = v.xz * (1.0 / l1norm);\n\tif (v.y < 0.0) {\n\t\tresult = (1.0 - abs(result.yx)) * signNotZero(result.xy);\n\t}\n\treturn result;\n}\n#ifdef CUBEMAP_SOURCE\n\tvec4 sampleCubemap(vec3 dir) {\n\t\treturn textureCube(sourceCube, modifySeams(dir, 1.0 - sourceCubeSeamScale()));\n\t}\n\tvec4 sampleCubemap(vec2 sph) {\n\treturn sampleCubemap(fromSpherical(sph));\n}\n\tvec4 sampleCubemap(vec3 dir, float mipLevel) {\n\t\treturn textureCubeLodEXT(sourceCube, modifySeams(dir, 1.0 - exp2(mipLevel) * sourceCubeSeamScale()), mipLevel);\n\t}\n\tvec4 sampleCubemap(vec2 sph, float mipLevel) {\n\t\treturn sampleCubemap(fromSpherical(sph), mipLevel);\n\t}\n#else\n\tvec4 sampleEquirect(vec2 sph) {\n\t\tvec2 uv = sph / vec2(PI * 2.0, PI) + 0.5;\n\t\treturn texture2D(sourceTex, vec2(uv.x, 1.0 - uv.y));\n\t}\n\tvec4 sampleEquirect(vec3 dir) {\n\t\treturn sampleEquirect(toSpherical(dir));\n\t}\n\tvec4 sampleEquirect(vec2 sph, float mipLevel) {\n\t\tvec2 uv = sph / vec2(PI * 2.0, PI) + 0.5;\n\t\treturn texture2DLodEXT(sourceTex, vec2(uv.x, 1.0 - uv.y), mipLevel);\n\t}\n\tvec4 sampleEquirect(vec3 dir, float mipLevel) {\n\t\treturn sampleEquirect(toSpherical(dir), mipLevel);\n\t}\n\tvec4 sampleOctahedral(vec3 dir) {\n\t\tvec2 uv = octEncode(dir) * 0.5 + 0.5;\n\t\treturn texture2D(sourceTex, vec2(uv.x, 1.0 - uv.y));\n\t}\n\tvec4 sampleOctahedral(vec2 sph) {\n\t\treturn sampleOctahedral(fromSpherical(sph));\n\t}\n\tvec4 sampleOctahedral(vec3 dir, float mipLevel) {\n\t\tvec2 uv = octEncode(dir) * 0.5 + 0.5;\n\t\treturn texture2DLodEXT(sourceTex, vec2(uv.x, 1.0 - uv.y), mipLevel);\n\t}\n\tvec4 sampleOctahedral(vec2 sph, float mipLevel) {\n\t\treturn sampleOctahedral(fromSpherical(sph), mipLevel);\n\t}\n#endif\nvec3 getDirectionCubemap() {\n\tvec2 st = vUv0 * 2.0 - 1.0;\n\tfloat face = targetFace();\n\tvec3 vec;\n\tif (face == 0.0) {\n\t\tvec = vec3(1, -st.y, -st.x);\n\t} else if (face == 1.0) {\n\t\tvec = vec3(-1, -st.y, st.x);\n\t} else if (face == 2.0) {\n\t\tvec = vec3(st.x, 1, st.y);\n\t} else if (face == 3.0) {\n\t\tvec = vec3(st.x, -1, -st.y);\n\t} else if (face == 4.0) {\n\t\tvec = vec3(st.x, -st.y, 1);\n\t} else {\n\t\tvec = vec3(-st.x, -st.y, -1);\n\t}\n\treturn normalize(modifySeams(vec, 1.0 / (1.0 - targetCubeSeamScale())));\n}\nmat3 matrixFromVector(vec3 n) {\n\tfloat a = 1.0 / (1.0 + n.z);\n\tfloat b = -n.x * n.y * a;\n\tvec3 b1 = vec3(1.0 - n.x * n.x * a, b, -n.x);\n\tvec3 b2 = vec3(b, 1.0 - n.y * n.y * a, -n.y);\n\treturn mat3(b1, b2, n);\n}\nmat3 matrixFromVectorSlow(vec3 n) {\n\tvec3 up = (1.0 - abs(n.y) <= 0.0000001) ? vec3(0.0, 0.0, n.y > 0.0 ? 1.0 : -1.0) : vec3(0.0, 1.0, 0.0);\n\tvec3 x = normalize(cross(up, n));\n\tvec3 y = cross(n, x);\n\treturn mat3(x, y, n);\n}\nvec4 reproject() {\n\tif (NUM_SAMPLES <= 1) {\n\t\treturn ENCODE_FUNC(DECODE_FUNC(SOURCE_FUNC(TARGET_FUNC())));\n\t} else {\n\t\tvec3 t = TARGET_FUNC();\n\t\tvec3 tu = dFdx(t);\n\t\tvec3 tv = dFdy(t);\n\t\tvec3 result = vec3(0.0);\n\t\tfor (float u = 0.0; u < NUM_SAMPLES_SQRT; ++u) {\n\t\t\tfor (float v = 0.0; v < NUM_SAMPLES_SQRT; ++v) {\n\t\t\t\tresult += DECODE_FUNC(SOURCE_FUNC(normalize(t +\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttu * (u / NUM_SAMPLES_SQRT - 0.5) +\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttv * (v / NUM_SAMPLES_SQRT - 0.5))));\n\t\t\t}\n\t\t}\n\t\treturn ENCODE_FUNC(result / (NUM_SAMPLES_SQRT * NUM_SAMPLES_SQRT));\n\t}\n}\nvec4 unpackFloat = vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0);\n#ifdef USE_SAMPLES_TEX\n\tvoid unpackSample(int i, out vec3 L, out float mipLevel) {\n\t\tfloat u = (float(i * 4) + 0.5) * samplesTexInverseSize.x;\n\t\tfloat v = (floor(u) + 0.5) * samplesTexInverseSize.y;\n\t\tvec4 raw;\n\t\traw.x = dot(texture2D(samplesTex, vec2(u, v)), unpackFloat); u += samplesTexInverseSize.x;\n\t\traw.y = dot(texture2D(samplesTex, vec2(u, v)), unpackFloat); u += samplesTexInverseSize.x;\n\t\traw.z = dot(texture2D(samplesTex, vec2(u, v)), unpackFloat); u += samplesTexInverseSize.x;\n\t\traw.w = dot(texture2D(samplesTex, vec2(u, v)), unpackFloat);\n\t\tL.xyz = raw.xyz * 2.0 - 1.0;\n\t\tmipLevel = raw.w * 8.0;\n\t}\n\tvec4 prefilterSamples() {\n\t\tmat3 vecSpace = matrixFromVectorSlow(TARGET_FUNC());\n\t\tvec3 L;\n\t\tfloat mipLevel;\n\t\tvec3 result = vec3(0.0);\n\t\tfloat totalWeight = 0.0;\n\t\tfor (int i = 0; i < NUM_SAMPLES; ++i) {\n\t\t\tunpackSample(i, L, mipLevel);\n\t\t\tresult += DECODE_FUNC(SOURCE_FUNC(vecSpace * L, mipLevel)) * L.z;\n\t\t\ttotalWeight += L.z;\n\t\t}\n\t\treturn ENCODE_FUNC(result / totalWeight);\n\t}\n\tvec4 prefilterSamplesUnweighted() {\n\t\tmat3 vecSpace = matrixFromVectorSlow(TARGET_FUNC());\n\t\tvec3 L;\n\t\tfloat mipLevel;\n\t\tvec3 result = vec3(0.0);\n\t\tfloat totalWeight = 0.0;\n\t\tfor (int i = 0; i < NUM_SAMPLES; ++i) {\n\t\t\tunpackSample(i, L, mipLevel);\n\t\t\tresult += DECODE_FUNC(SOURCE_FUNC(vecSpace * L, mipLevel));\n\t\t}\n\t\treturn ENCODE_FUNC(result / float(NUM_SAMPLES));\n\t}\n#endif\nvoid main(void) {\n\tgl_FragColor = PROCESS_FUNC();\n}\n`;\n\nexport { reprojectPS as default };\n","var screenDepthPS = `\nuniform highp sampler2D uSceneDepthMap;\n#ifndef SCREENSIZE\n#define SCREENSIZE\nuniform vec4 uScreenSize;\n#endif\n#ifndef VIEWMATRIX\n#define VIEWMATRIX\nuniform mat4 matrix_view;\n#endif\n#ifndef LINEARIZE_DEPTH\n#ifndef CAMERAPLANES\n#define CAMERAPLANES\nuniform vec4 camera_params;\n#endif\n#define LINEARIZE_DEPTH\n#ifdef GL2\nfloat linearizeDepth(float z) {\n\tif (camera_params.w == 0.0)\n\t\treturn (camera_params.z * camera_params.y) / (camera_params.y + z * (camera_params.z - camera_params.y));\n\telse\n\t\treturn camera_params.z + z * (camera_params.y - camera_params.z);\n}\n#else\n#ifndef UNPACKFLOAT\n#define UNPACKFLOAT\nfloat unpackFloat(vec4 rgbaDepth) {\n\tconst vec4 bitShift = vec4(1.0 / (256.0 * 256.0 * 256.0), 1.0 / (256.0 * 256.0), 1.0 / 256.0, 1.0);\n\treturn dot(rgbaDepth, bitShift);\n}\n#endif\n#endif\n#endif\nfloat getLinearScreenDepth(vec2 uv) {\n\t#ifdef GL2\n\t\treturn linearizeDepth(texture2D(uSceneDepthMap, uv).r);\n\t#else\n\t\treturn unpackFloat(texture2D(uSceneDepthMap, uv)) * camera_params.y;\n\t#endif\n}\n#ifndef VERTEXSHADER\nfloat getLinearScreenDepth() {\n\tvec2 uv = gl_FragCoord.xy * uScreenSize.zw;\n\treturn getLinearScreenDepth(uv);\n}\n#endif\nfloat getLinearDepth(vec3 pos) {\n\treturn -(matrix_view * vec4(pos, 1.0)).z;\n}\n`;\n\nexport { screenDepthPS as default };\n","var shadowCascadesPS = `\nconst float maxCascades = 4.0;\nmat4 cascadeShadowMat;\nvoid getShadowCascadeMatrix(mat4 shadowMatrixPalette[4], float shadowCascadeDistances[4], float shadowCascadeCount) {\n\tfloat depth = 1.0 / gl_FragCoord.w;\n\tfloat cascadeIndex = 0.0;\n\tfor (float i = 0.0; i < maxCascades; i++) {\n\t\tif (depth < shadowCascadeDistances[int(i)]) {\n\t\t\tcascadeIndex = i;\n\t\t\tbreak;\n\t\t}\n\t}\n\tcascadeIndex = min(cascadeIndex, shadowCascadeCount - 1.0);\n\t#ifdef GL2\n\t\tcascadeShadowMat = shadowMatrixPalette[int(cascadeIndex)];\n\t#else\n\t\tif (cascadeIndex == 0.0) {\n\t\t\tcascadeShadowMat = shadowMatrixPalette[0];\n\t\t}\n\t\telse if (cascadeIndex == 1.0) {\n\t\t\tcascadeShadowMat = shadowMatrixPalette[1];\n\t\t}\n\t\telse if (cascadeIndex == 2.0) {\n\t\t\tcascadeShadowMat = shadowMatrixPalette[2];\n\t\t}\n\t\telse {\n\t\t\tcascadeShadowMat = shadowMatrixPalette[3];\n\t\t}\n\t#endif\n}\nvoid fadeShadow(float shadowCascadeDistances[4]) {\t\t\t\t  \n\tfloat depth = 1.0 / gl_FragCoord.w;\n\tif (depth > shadowCascadeDistances[int(maxCascades - 1.0)]) {\n\t\tdShadowCoord.z = -9999999.0;\n\t}\n}\n`;\n\nexport { shadowCascadesPS as default };\n","var shadowEVSMPS = `\nfloat VSM$(sampler2D tex, vec2 texCoords, float resolution, float Z, float vsmBias, float exponent) {\n\tvec3 moments = texture2D(tex, texCoords).xyz;\n\treturn calculateEVSM(moments, Z, vsmBias, exponent);\n}\nfloat getShadowVSM$(sampler2D shadowMap, vec3 shadowCoord, vec4 shadowParams, float exponent, vec3 lightDir) {\n\treturn VSM$(shadowMap, shadowCoord.xy, shadowParams.x, shadowCoord.z, shadowParams.y, exponent);\n}\nfloat getShadowSpotVSM$(sampler2D shadowMap, vec3 shadowCoord, vec4 shadowParams, float exponent, vec3 lightDir) {\n\treturn VSM$(shadowMap, shadowCoord.xy, shadowParams.x, length(lightDir) * shadowParams.w + shadowParams.z, shadowParams.y, exponent);\n}\n`;\n\nexport { shadowEVSMPS as default };\n","var shadowEVSMnPS = `\nfloat VSM$(TEXTURE_ACCEPT(tex), vec2 texCoords, float resolution, float Z, float vsmBias, float exponent) {\n\tfloat pixelSize = 1.0 / resolution;\n\ttexCoords -= vec2(pixelSize);\n\tvec3 s00 = texture2D(tex, texCoords).xyz;\n\tvec3 s10 = texture2D(tex, texCoords + vec2(pixelSize, 0)).xyz;\n\tvec3 s01 = texture2D(tex, texCoords + vec2(0, pixelSize)).xyz;\n\tvec3 s11 = texture2D(tex, texCoords + vec2(pixelSize)).xyz;\n\tvec2 fr = fract(texCoords * resolution);\n\tvec3 h0 = mix(s00, s10, fr.x);\n\tvec3 h1 = mix(s01, s11, fr.x);\n\tvec3 moments = mix(h0, h1, fr.y);\n\treturn calculateEVSM(moments, Z, vsmBias, exponent);\n}\nfloat getShadowVSM$(TEXTURE_ACCEPT(shadowMap), vec3 shadowCoord, vec4 shadowParams, float exponent, vec3 lightDir) {\n\treturn VSM$(TEXTURE_PASS(shadowMap), shadowCoord.xy, shadowParams.x, shadowCoord.z, shadowParams.y, exponent);\n}\nfloat getShadowSpotVSM$(TEXTURE_ACCEPT(shadowMap), vec3 shadowCoord, vec4 shadowParams, float exponent, vec3 lightDir) {\n\treturn VSM$(TEXTURE_PASS(shadowMap), shadowCoord.xy, shadowParams.x, length(lightDir) * shadowParams.w + shadowParams.z, shadowParams.y, exponent);\n}\n`;\n\nexport { shadowEVSMnPS as default };\n","var shadowPCSSPS = `\n#define PCSS_SAMPLE_COUNT 16\nuniform float pcssDiskSamples[PCSS_SAMPLE_COUNT];\nuniform float pcssSphereSamples[PCSS_SAMPLE_COUNT];\nvec2 vogelDisk(int sampleIndex, float count, float phi, float r) {\n\tconst float GoldenAngle = 2.4;\n\tfloat theta = float(sampleIndex) * GoldenAngle + phi;\n\tfloat sine = sin(theta);\n\tfloat cosine = cos(theta);\n\treturn vec2(r * cosine, r * sine);\n}\nvec3 vogelSphere(int sampleIndex, float count, float phi, float r) {\n\tconst float GoldenAngle = 2.4;\n\tfloat theta = float(sampleIndex) * GoldenAngle + phi;\n\tfloat weight = float(sampleIndex) / count;\n\treturn vec3(cos(theta) * r, weight, sin(theta) * r);\n}\nfloat noise(vec2 screenPos) {\n\tconst float PHI = 1.61803398874989484820459;\n\treturn fract(sin(dot(screenPos * PHI, screenPos)) * screenPos.x);\n}\n#ifndef UNPACKFLOAT\n#define UNPACKFLOAT\nfloat unpackFloat(vec4 rgbaDepth) {\n\tconst vec4 bitShift = vec4(1.0 / (256.0 * 256.0 * 256.0), 1.0 / (256.0 * 256.0), 1.0 / 256.0, 1.0);\n\treturn dot(rgbaDepth, bitShift);\n}\n#endif\nfloat viewSpaceDepth(float depth, mat4 invProjection) {\n\tfloat z = depth * 2.0 - 1.0;\n\tvec4 clipSpace = vec4(0.0, 0.0, z, 1.0);\n\tvec4 viewSpace = invProjection * clipSpace;\n\treturn viewSpace.z;\n}\nfloat PCSSBlockerDistance(TEXTURE_ACCEPT(shadowMap), vec2 sampleCoords[PCSS_SAMPLE_COUNT], vec2 shadowCoords, vec2 searchSize, float z) {\n\tfloat blockers = 0.0;\n\tfloat averageBlocker = 0.0;\n\tfor (int i = 0; i < PCSS_SAMPLE_COUNT; i++) {\n\t\tvec2 offset = sampleCoords[i] * searchSize;\n\t\tvec2 sampleUV = shadowCoords + offset;\n\t#ifdef GL2\n\t\tfloat blocker = textureLod(shadowMap, sampleUV, 0.0).r;\n\t#else\n\t\tfloat blocker = unpackFloat(texture2D(shadowMap, sampleUV));\n\t#endif\t\t\n\t\tfloat isBlocking = step(blocker, z);\n\t\tblockers += isBlocking;\n\t\taverageBlocker += blocker * isBlocking;\n\t}\n\tif (blockers > 0.0)\n\t\treturn averageBlocker /= blockers;\n\treturn -1.0;\n}\nfloat PCSS(TEXTURE_ACCEPT(shadowMap), vec3 shadowCoords, vec4 cameraParams, vec2 shadowSearchArea) {\n\tfloat receiverDepth = shadowCoords.z;\n#ifndef GL2\n\treceiverDepth *= 1.0 / (cameraParams.y - cameraParams.z);\n#endif\n\tvec2 samplePoints[PCSS_SAMPLE_COUNT];\n\tfloat noise = noise( gl_FragCoord.xy ) * 2.0 * PI;\n\tfor (int i = 0; i < PCSS_SAMPLE_COUNT; i++) {\n\t\tfloat pcssPresample = pcssDiskSamples[i];\n\t\tsamplePoints[i] = vogelDisk(i, float(PCSS_SAMPLE_COUNT), noise, pcssPresample);\n\t}\n\tfloat averageBlocker = PCSSBlockerDistance(TEXTURE_PASS(shadowMap), samplePoints, shadowCoords.xy, shadowSearchArea, receiverDepth);\n\tif (averageBlocker == -1.0) {\n\t\treturn 1.0;\n\t} else {\n\t\tvec2 filterRadius = ((receiverDepth - averageBlocker) / averageBlocker) * shadowSearchArea * cameraParams.x;\n\t\tfloat shadow = 0.0;\n\t\tfor (int i = 0; i < PCSS_SAMPLE_COUNT; i ++)\n\t\t{\n\t\t\tvec2 sampleUV = samplePoints[i] * filterRadius;\n\t\t\tsampleUV = shadowCoords.xy + sampleUV;\n\t\t#ifdef GL2\n\t\t\tfloat depth = textureLod(shadowMap, sampleUV, 0.0).r;\n\t\t#else\n\t\t\tfloat depth = unpackFloat(texture2D(shadowMap, sampleUV));\n\t\t#endif\n\t\t\tshadow += step(receiverDepth, depth);\n\t\t}\n\t\treturn shadow / float(PCSS_SAMPLE_COUNT);\n\t} \n}\nfloat PCSSCubeBlockerDistance(samplerCube shadowMap, vec3 lightDirNorm, vec3 samplePoints[PCSS_SAMPLE_COUNT], float z, float shadowSearchArea) {\n\tfloat blockers = 0.0;\n\tfloat averageBlocker = 0.0;\n\tfor (int i = 0; i < PCSS_SAMPLE_COUNT; i++) {\n\t\tvec3 sampleDir = lightDirNorm + samplePoints[i] * shadowSearchArea;\n\t\tsampleDir = normalize(sampleDir);\n\t#ifdef GL2\n\t\tfloat blocker = textureCubeLodEXT(shadowMap, sampleDir, 0.0).r;\n\t#else\n\t\tfloat blocker = unpackFloat(textureCube(shadowMap, sampleDir));\n\t#endif\n\t\tfloat isBlocking = step(blocker, z);\n\t\tblockers += isBlocking;\n\t\taverageBlocker += blocker * isBlocking;\n\t}\n\tif (blockers > 0.0)\n\t\treturn averageBlocker /= float(blockers);\n\treturn -1.0;\n}\nfloat PCSSCube(samplerCube shadowMap, vec4 shadowParams, vec3 shadowCoords, vec4 cameraParams, float shadowSearchArea, vec3 lightDir) {\n\t\n\tvec3 samplePoints[PCSS_SAMPLE_COUNT];\n\tfloat noise = noise( gl_FragCoord.xy ) * 2.0 * PI;\n\tfor (int i = 0; i < PCSS_SAMPLE_COUNT; i++) {\n\t\tfloat r = pcssSphereSamples[i];\n\t\tsamplePoints[i] = vogelSphere(i, float(PCSS_SAMPLE_COUNT), noise, r);\n\t}\n\tfloat receiverDepth = length(lightDir) * shadowParams.w + shadowParams.z;\n\tvec3 lightDirNorm = normalize(lightDir);\n\t\n\tfloat averageBlocker = PCSSCubeBlockerDistance(shadowMap, lightDirNorm, samplePoints, receiverDepth, shadowSearchArea);\n\tif (averageBlocker == -1.0) {\n\t\treturn 1.0;\n\t} else {\n\t\tfloat filterRadius = ((receiverDepth - averageBlocker) / averageBlocker) * shadowSearchArea;\n\t\tfloat shadow = 0.0;\n\t\tfor (int i = 0; i < PCSS_SAMPLE_COUNT; i++)\n\t\t{\n\t\t\tvec3 offset = samplePoints[i] * filterRadius;\n\t\t\tvec3 sampleDir = lightDirNorm + offset;\n\t\t\tsampleDir = normalize(sampleDir);\n\t\t\t#ifdef GL2\n\t\t\t\tfloat depth = textureCubeLodEXT(shadowMap, sampleDir, 0.0).r;\n\t\t\t#else\n\t\t\t\tfloat depth = unpackFloat(textureCube(shadowMap, sampleDir));\n\t\t\t#endif\n\t\t\tshadow += step(receiverDepth, depth);\n\t\t}\n\t\treturn shadow / float(PCSS_SAMPLE_COUNT);\n\t}\n}\nfloat getShadowPointPCSS(samplerCube shadowMap, vec3 shadowCoord, vec4 shadowParams, vec4 cameraParams, vec2 shadowSearchArea, vec3 lightDir) {\n\treturn PCSSCube(shadowMap, shadowParams, shadowCoord, cameraParams, shadowSearchArea.x, lightDir);\n}\nfloat getShadowSpotPCSS(TEXTURE_ACCEPT(shadowMap), vec3 shadowCoord, vec4 shadowParams, vec4 cameraParams, vec2 shadowSearchArea, vec3 lightDir) {\n\treturn PCSS(TEXTURE_PASS(shadowMap), shadowCoord, cameraParams, shadowSearchArea);\n}\nfloat getShadowPCSS(TEXTURE_ACCEPT(shadowMap), vec3 shadowCoord, vec4 shadowParams, vec4 cameraParams, vec2 shadowSearchArea, vec3 lightDir) {\n\treturn PCSS(TEXTURE_PASS(shadowMap), shadowCoord, cameraParams, shadowSearchArea);\n}\n`;\n\nexport { shadowPCSSPS as default };\n","var shadowSampleCoordPS = `\nvec3 getShadowSampleCoord$LIGHT(mat4 shadowTransform, vec4 shadowParams, vec3 worldPosition, vec3 lightPos, inout vec3 lightDir, vec3 lightDirNorm, vec3 normal) {\n\tvec3 surfacePosition = worldPosition;\n#ifdef SHADOW_SAMPLE_POINT\n\t#ifdef SHADOW_SAMPLE_NORMAL_OFFSET\n\t\tfloat distScale = length(lightDir);\n\t\tsurfacePosition = worldPosition + normal * shadowParams.y * clamp(1.0 - dot(normal, -lightDirNorm), 0.0, 1.0) * distScale;\n\t\tlightDir = surfacePosition - lightPos;\n\t\treturn lightDir;\n\t#endif\n#else\n\t#ifdef SHADOW_SAMPLE_SOURCE_ZBUFFER\n\t\t#ifdef SHADOW_SAMPLE_NORMAL_OFFSET\n\t\t\tsurfacePosition = worldPosition + normal * shadowParams.y;\n\t\t#endif\n\t#else\n\t\t#ifdef SHADOW_SAMPLE_NORMAL_OFFSET\n\t\t\t#ifdef SHADOW_SAMPLE_ORTHO\n\t\t\t\tfloat distScale = 1.0;\n\t\t\t#else\n\t\t\t\tfloat distScale = abs(dot(vPositionW - lightPos, lightDirNorm));\n\t\t\t#endif\n\t\t\tsurfacePosition = worldPosition + normal * shadowParams.y * clamp(1.0 - dot(normal, -lightDirNorm), 0.0, 1.0) * distScale;\n\t\t#endif\n\t#endif\n\tvec4 positionInShadowSpace = shadowTransform * vec4(surfacePosition, 1.0);\n\t#ifdef SHADOW_SAMPLE_ORTHO\n\t\tpositionInShadowSpace.z = saturate(positionInShadowSpace.z) - 0.0001;\n\t#else\n\t\t#ifdef SHADOW_SAMPLE_SOURCE_ZBUFFER\n\t\t\tpositionInShadowSpace.xyz /= positionInShadowSpace.w;\n\t\t#else\n\t\t\tpositionInShadowSpace.xy /= positionInShadowSpace.w;\n\t\t\tpositionInShadowSpace.z = length(lightDir) * shadowParams.w;\n\t\t#endif\n\t#endif\n\t#ifdef SHADOW_SAMPLE_Z_BIAS\n\t\tpositionInShadowSpace.z += getShadowBias(shadowParams.x, shadowParams.z);\n\t#endif\n\tsurfacePosition = positionInShadowSpace.xyz;\n#endif\n\treturn surfacePosition;\n}\n`;\n\nexport { shadowSampleCoordPS as default };\n","var shadowStandardPS = `\nvec3 lessThan2(vec3 a, vec3 b) {\n\treturn clamp((b - a)*1000.0, 0.0, 1.0);\n}\n#ifndef UNPACKFLOAT\n#define UNPACKFLOAT\n\tfloat unpackFloat(vec4 rgbaDepth) {\n\t\tconst vec4 bitShift = vec4(1.0 / (256.0 * 256.0 * 256.0), 1.0 / (256.0 * 256.0), 1.0 / 256.0, 1.0);\n\t\treturn dot(rgbaDepth, bitShift);\n\t}\n#endif\n#ifdef GL2\nfloat _getShadowPCF3x3(SHADOWMAP_ACCEPT(shadowMap), vec3 shadowCoord, vec3 shadowParams) {\n\tfloat z = shadowCoord.z;\n\tvec2 uv = shadowCoord.xy * shadowParams.x;\n\tfloat shadowMapSizeInv = 1.0 / shadowParams.x;\n\tvec2 base_uv = floor(uv + 0.5);\n\tfloat s = (uv.x + 0.5 - base_uv.x);\n\tfloat t = (uv.y + 0.5 - base_uv.y);\n\tbase_uv -= vec2(0.5);\n\tbase_uv *= shadowMapSizeInv;\n\tfloat sum = 0.0;\n\tfloat uw0 = (3.0 - 2.0 * s);\n\tfloat uw1 = (1.0 + 2.0 * s);\n\tfloat u0 = (2.0 - s) / uw0 - 1.0;\n\tfloat u1 = s / uw1 + 1.0;\n\tfloat vw0 = (3.0 - 2.0 * t);\n\tfloat vw1 = (1.0 + 2.0 * t);\n\tfloat v0 = (2.0 - t) / vw0 - 1.0;\n\tfloat v1 = t / vw1 + 1.0;\n\tu0 = u0 * shadowMapSizeInv + base_uv.x;\n\tv0 = v0 * shadowMapSizeInv + base_uv.y;\n\tu1 = u1 * shadowMapSizeInv + base_uv.x;\n\tv1 = v1 * shadowMapSizeInv + base_uv.y;\n\tsum += uw0 * vw0 * textureShadow(shadowMap, vec3(u0, v0, z));\n\tsum += uw1 * vw0 * textureShadow(shadowMap, vec3(u1, v0, z));\n\tsum += uw0 * vw1 * textureShadow(shadowMap, vec3(u0, v1, z));\n\tsum += uw1 * vw1 * textureShadow(shadowMap, vec3(u1, v1, z));\n\tsum *= 1.0f / 16.0;\n\treturn sum;\n}\nfloat getShadowPCF3x3(SHADOWMAP_ACCEPT(shadowMap), vec3 shadowCoord, vec4 shadowParams) {\n\treturn _getShadowPCF3x3(SHADOWMAP_PASS(shadowMap), shadowCoord, shadowParams.xyz);\n}\nfloat getShadowSpotPCF3x3(SHADOWMAP_ACCEPT(shadowMap), vec3 shadowCoord, vec4 shadowParams) {\n\treturn _getShadowPCF3x3(SHADOWMAP_PASS(shadowMap), shadowCoord, shadowParams.xyz);\n}\nfloat getShadowPCF1x1(SHADOWMAP_ACCEPT(shadowMap), vec3 shadowCoord, vec4 shadowParams) {\n\treturn textureShadow(shadowMap, shadowCoord);\n}\nfloat getShadowSpotPCF1x1(SHADOWMAP_ACCEPT(shadowMap), vec3 shadowCoord, vec4 shadowParams) {\n\treturn textureShadow(shadowMap, shadowCoord);\n}\n#else\nfloat _xgetShadowPCF3x3(mat3 depthKernel, vec3 shadowCoord, sampler2D shadowMap, vec3 shadowParams) {\n\tmat3 shadowKernel;\n\tvec3 shadowZ = vec3(shadowCoord.z);\n\tshadowKernel[0] = vec3(greaterThan(depthKernel[0], shadowZ));\n\tshadowKernel[1] = vec3(greaterThan(depthKernel[1], shadowZ));\n\tshadowKernel[2] = vec3(greaterThan(depthKernel[2], shadowZ));\n\tvec2 fractionalCoord = fract( shadowCoord.xy * shadowParams.x );\n\tshadowKernel[0] = mix(shadowKernel[0], shadowKernel[1], fractionalCoord.x);\n\tshadowKernel[1] = mix(shadowKernel[1], shadowKernel[2], fractionalCoord.x);\n\tvec4 shadowValues;\n\tshadowValues.x = mix(shadowKernel[0][0], shadowKernel[0][1], fractionalCoord.y);\n\tshadowValues.y = mix(shadowKernel[0][1], shadowKernel[0][2], fractionalCoord.y);\n\tshadowValues.z = mix(shadowKernel[1][0], shadowKernel[1][1], fractionalCoord.y);\n\tshadowValues.w = mix(shadowKernel[1][1], shadowKernel[1][2], fractionalCoord.y);\n\treturn dot( shadowValues, vec4( 1.0 ) ) * 0.25;\n}\nfloat _getShadowPCF3x3(sampler2D shadowMap, vec3 shadowCoord, vec3 shadowParams) {\n\tfloat xoffset = 1.0 / shadowParams.x;\n\tfloat dx0 = -xoffset;\n\tfloat dx1 = xoffset;\n\tmat3 depthKernel;\n\tdepthKernel[0][0] = unpackFloat(textureShadow(shadowMap, shadowCoord.xy + vec2(dx0, dx0)));\n\tdepthKernel[0][1] = unpackFloat(textureShadow(shadowMap, shadowCoord.xy + vec2(dx0, 0.0)));\n\tdepthKernel[0][2] = unpackFloat(textureShadow(shadowMap, shadowCoord.xy + vec2(dx0, dx1)));\n\tdepthKernel[1][0] = unpackFloat(textureShadow(shadowMap, shadowCoord.xy + vec2(0.0, dx0)));\n\tdepthKernel[1][1] = unpackFloat(textureShadow(shadowMap, shadowCoord.xy));\n\tdepthKernel[1][2] = unpackFloat(textureShadow(shadowMap, shadowCoord.xy + vec2(0.0, dx1)));\n\tdepthKernel[2][0] = unpackFloat(textureShadow(shadowMap, shadowCoord.xy + vec2(dx1, dx0)));\n\tdepthKernel[2][1] = unpackFloat(textureShadow(shadowMap, shadowCoord.xy + vec2(dx1, 0.0)));\n\tdepthKernel[2][2] = unpackFloat(textureShadow(shadowMap, shadowCoord.xy + vec2(dx1, dx1)));\n\treturn _xgetShadowPCF3x3(depthKernel, shadowCoord, shadowMap, shadowParams);\n}\nfloat getShadowPCF3x3(sampler2D shadowMap, vec3 shadowCoord, vec4 shadowParams) {\n\treturn _getShadowPCF3x3(shadowMap, shadowCoord, shadowParams.xyz);\n}\nfloat getShadowSpotPCF3x3(sampler2D shadowMap, vec3 shadowCoord, vec4 shadowParams) {\n\treturn _getShadowPCF3x3(shadowMap, shadowCoord, shadowParams.xyz);\n}\nfloat _getShadowPCF1x1(sampler2D shadowMap, vec3 shadowCoord) {\n\tfloat shadowSample = unpackFloat(textureShadow(shadowMap, shadowCoord.xy));\n\treturn shadowSample > shadowCoord.z ? 1.0 : 0.0;\n}\nfloat getShadowPCF1x1(sampler2D shadowMap, vec3 shadowCoord, vec4 shadowParams) {\n\treturn _getShadowPCF1x1(shadowMap, shadowCoord);\n}\nfloat getShadowSpotPCF1x1(sampler2D shadowMap, vec3 shadowCoord, vec4 shadowParams) {\n\treturn _getShadowPCF1x1(shadowMap, shadowCoord);\n}\n#endif\n#ifndef WEBGPU\nfloat _getShadowPoint(samplerCube shadowMap, vec4 shadowParams, vec3 dir) {\n\tvec3 tc = normalize(dir);\n\tvec3 tcAbs = abs(tc);\n\tvec4 dirX = vec4(1,0,0, tc.x);\n\tvec4 dirY = vec4(0,1,0, tc.y);\n\tfloat majorAxisLength = tc.z;\n\tif ((tcAbs.x > tcAbs.y) && (tcAbs.x > tcAbs.z)) {\n\t\tdirX = vec4(0,0,1, tc.z);\n\t\tdirY = vec4(0,1,0, tc.y);\n\t\tmajorAxisLength = tc.x;\n\t} else if ((tcAbs.y > tcAbs.x) && (tcAbs.y > tcAbs.z)) {\n\t\tdirX = vec4(1,0,0, tc.x);\n\t\tdirY = vec4(0,0,1, tc.z);\n\t\tmajorAxisLength = tc.y;\n\t}\n\tfloat shadowParamsInFaceSpace = ((1.0/shadowParams.x) * 2.0) * abs(majorAxisLength);\n\tvec3 xoffset = (dirX.xyz * shadowParamsInFaceSpace);\n\tvec3 yoffset = (dirY.xyz * shadowParamsInFaceSpace);\n\tvec3 dx0 = -xoffset;\n\tvec3 dy0 = -yoffset;\n\tvec3 dx1 = xoffset;\n\tvec3 dy1 = yoffset;\n\tmat3 shadowKernel;\n\tmat3 depthKernel;\n\tdepthKernel[0][0] = unpackFloat(textureCube(shadowMap, tc + dx0 + dy0));\n\tdepthKernel[0][1] = unpackFloat(textureCube(shadowMap, tc + dx0));\n\tdepthKernel[0][2] = unpackFloat(textureCube(shadowMap, tc + dx0 + dy1));\n\tdepthKernel[1][0] = unpackFloat(textureCube(shadowMap, tc + dy0));\n\tdepthKernel[1][1] = unpackFloat(textureCube(shadowMap, tc));\n\tdepthKernel[1][2] = unpackFloat(textureCube(shadowMap, tc + dy1));\n\tdepthKernel[2][0] = unpackFloat(textureCube(shadowMap, tc + dx1 + dy0));\n\tdepthKernel[2][1] = unpackFloat(textureCube(shadowMap, tc + dx1));\n\tdepthKernel[2][2] = unpackFloat(textureCube(shadowMap, tc + dx1 + dy1));\n\tvec3 shadowZ = vec3(length(dir) * shadowParams.w + shadowParams.z);\n\tshadowKernel[0] = vec3(lessThan2(depthKernel[0], shadowZ));\n\tshadowKernel[1] = vec3(lessThan2(depthKernel[1], shadowZ));\n\tshadowKernel[2] = vec3(lessThan2(depthKernel[2], shadowZ));\n\tvec2 uv = (vec2(dirX.w, dirY.w) / abs(majorAxisLength)) * 0.5;\n\tvec2 fractionalCoord = fract( uv * shadowParams.x );\n\tshadowKernel[0] = mix(shadowKernel[0], shadowKernel[1], fractionalCoord.x);\n\tshadowKernel[1] = mix(shadowKernel[1], shadowKernel[2], fractionalCoord.x);\n\tvec4 shadowValues;\n\tshadowValues.x = mix(shadowKernel[0][0], shadowKernel[0][1], fractionalCoord.y);\n\tshadowValues.y = mix(shadowKernel[0][1], shadowKernel[0][2], fractionalCoord.y);\n\tshadowValues.z = mix(shadowKernel[1][0], shadowKernel[1][1], fractionalCoord.y);\n\tshadowValues.w = mix(shadowKernel[1][1], shadowKernel[1][2], fractionalCoord.y);\n\treturn 1.0 - dot( shadowValues, vec4( 1.0 ) ) * 0.25;\n}\nfloat getShadowPointPCF3x3(samplerCube shadowMap, vec3 shadowCoord, vec4 shadowParams, vec3 lightDir) {\n\treturn _getShadowPoint(shadowMap, shadowParams, lightDir);\n}\n#endif\n`;\n\nexport { shadowStandardPS as default };\n","var shadowStandardGL2PS = `\nfloat _getShadowPCF5x5(SHADOWMAP_ACCEPT(shadowMap), vec3 shadowCoord, vec3 shadowParams) {\n\tfloat z = shadowCoord.z;\n\tvec2 uv = shadowCoord.xy * shadowParams.x;\n\tfloat shadowMapSizeInv = 1.0 / shadowParams.x;\n\tvec2 base_uv = floor(uv + 0.5);\n\tfloat s = (uv.x + 0.5 - base_uv.x);\n\tfloat t = (uv.y + 0.5 - base_uv.y);\n\tbase_uv -= vec2(0.5);\n\tbase_uv *= shadowMapSizeInv;\n\tfloat uw0 = (4.0 - 3.0 * s);\n\tfloat uw1 = 7.0;\n\tfloat uw2 = (1.0 + 3.0 * s);\n\tfloat u0 = (3.0 - 2.0 * s) / uw0 - 2.0;\n\tfloat u1 = (3.0 + s) / uw1;\n\tfloat u2 = s / uw2 + 2.0;\n\tfloat vw0 = (4.0 - 3.0 * t);\n\tfloat vw1 = 7.0;\n\tfloat vw2 = (1.0 + 3.0 * t);\n\tfloat v0 = (3.0 - 2.0 * t) / vw0 - 2.0;\n\tfloat v1 = (3.0 + t) / vw1;\n\tfloat v2 = t / vw2 + 2.0;\n\tfloat sum = 0.0;\n\tu0 = u0 * shadowMapSizeInv + base_uv.x;\n\tv0 = v0 * shadowMapSizeInv + base_uv.y;\n\tu1 = u1 * shadowMapSizeInv + base_uv.x;\n\tv1 = v1 * shadowMapSizeInv + base_uv.y;\n\tu2 = u2 * shadowMapSizeInv + base_uv.x;\n\tv2 = v2 * shadowMapSizeInv + base_uv.y;\n\tsum += uw0 * vw0 * textureShadow(shadowMap, vec3(u0, v0, z));\n\tsum += uw1 * vw0 * textureShadow(shadowMap, vec3(u1, v0, z));\n\tsum += uw2 * vw0 * textureShadow(shadowMap, vec3(u2, v0, z));\n\tsum += uw0 * vw1 * textureShadow(shadowMap, vec3(u0, v1, z));\n\tsum += uw1 * vw1 * textureShadow(shadowMap, vec3(u1, v1, z));\n\tsum += uw2 * vw1 * textureShadow(shadowMap, vec3(u2, v1, z));\n\tsum += uw0 * vw2 * textureShadow(shadowMap, vec3(u0, v2, z));\n\tsum += uw1 * vw2 * textureShadow(shadowMap, vec3(u1, v2, z));\n\tsum += uw2 * vw2 * textureShadow(shadowMap, vec3(u2, v2, z));\n\tsum *= 1.0f / 144.0;\n\tsum = saturate(sum);\n\treturn sum;\n}\nfloat getShadowPCF5x5(SHADOWMAP_ACCEPT(shadowMap), vec3 shadowCoord, vec4 shadowParams) {\n\treturn _getShadowPCF5x5(SHADOWMAP_PASS(shadowMap), shadowCoord, shadowParams.xyz);\n}\nfloat getShadowSpotPCF5x5(SHADOWMAP_ACCEPT(shadowMap), vec3 shadowCoord, vec4 shadowParams) {\n\treturn _getShadowPCF5x5(SHADOWMAP_PASS(shadowMap), shadowCoord, shadowParams.xyz);\n}\n`;\n\nexport { shadowStandardGL2PS as default };\n","var shadowVSM8PS = `\nfloat calculateVSM8(vec3 moments, float Z, float vsmBias) {\n\tfloat VSMBias = vsmBias;\n\tfloat depthScale = VSMBias * Z;\n\tfloat minVariance1 = depthScale * depthScale;\n\treturn chebyshevUpperBound(moments.xy, Z, minVariance1, 0.1);\n}\nfloat decodeFloatRG(vec2 rg) {\n\treturn rg.y*(1.0/255.0) + rg.x;\n}\nfloat VSM8(TEXTURE_ACCEPT(tex), vec2 texCoords, float resolution, float Z, float vsmBias, float exponent) {\n\tvec4 c = texture2D(tex, texCoords);\n\tvec3 moments = vec3(decodeFloatRG(c.xy), decodeFloatRG(c.zw), 0.0);\n\treturn calculateVSM8(moments, Z, vsmBias);\n}\nfloat getShadowVSM8(TEXTURE_ACCEPT(shadowMap), vec3 shadowCoord, vec4 shadowParams, float exponent, vec3 lightDir) {\n\treturn VSM8(TEXTURE_PASS(shadowMap), shadowCoord.xy, shadowParams.x, shadowCoord.z, shadowParams.y, 0.0);\n}\nfloat getShadowSpotVSM8(TEXTURE_ACCEPT(shadowMap), vec3 shadowCoord, vec4 shadowParams, float exponent, vec3 lightDir) {\n\treturn VSM8(TEXTURE_PASS(shadowMap), shadowCoord.xy, shadowParams.x, length(lightDir) * shadowParams.w + shadowParams.z, shadowParams.y, 0.0);\n}\n`;\n\nexport { shadowVSM8PS as default };\n","var shadowVSM_commonPS = `\nfloat linstep(float a, float b, float v) {\n\treturn saturate((v - a) / (b - a));\n}\nfloat reduceLightBleeding(float pMax, float amount) {\n\t return linstep(amount, 1.0, pMax);\n}\nfloat chebyshevUpperBound(vec2 moments, float mean, float minVariance, float lightBleedingReduction) {\n\tfloat variance = moments.y - (moments.x * moments.x);\n\tvariance = max(variance, minVariance);\n\tfloat d = mean - moments.x;\n\tfloat pMax = variance / (variance + (d * d));\n\tpMax = reduceLightBleeding(pMax, lightBleedingReduction);\n\treturn (mean <= moments.x ? 1.0 : pMax);\n}\nfloat calculateEVSM(vec3 moments, float Z, float vsmBias, float exponent) {\n\tZ = 2.0 * Z - 1.0;\n\tfloat warpedDepth = exp(exponent * Z);\n\tmoments.xy += vec2(warpedDepth, warpedDepth*warpedDepth) * (1.0 - moments.z);\n\tfloat VSMBias = vsmBias;\n\tfloat depthScale = VSMBias * exponent * warpedDepth;\n\tfloat minVariance1 = depthScale * depthScale;\n\treturn chebyshevUpperBound(moments.xy, warpedDepth, minVariance1, 0.1);\n}\n`;\n\nexport { shadowVSM_commonPS as default };\n","var skinBatchConstVS = `\nattribute float vertex_boneIndices;\nuniform vec4 matrix_pose[BONE_LIMIT * 3];\nmat4 getBoneMatrix(const in float i) {\n\tvec4 v1 = matrix_pose[int(3.0 * i)];\n\tvec4 v2 = matrix_pose[int(3.0 * i + 1.0)];\n\tvec4 v3 = matrix_pose[int(3.0 * i + 2.0)];\n\treturn mat4(\n\t\tv1.x, v2.x, v3.x, 0,\n\t\tv1.y, v2.y, v3.y, 0,\n\t\tv1.z, v2.z, v3.z, 0,\n\t\tv1.w, v2.w, v3.w, 1\n\t);\n}\n`;\n\nexport { skinBatchConstVS as default };\n","var skinBatchTexVS = `\nattribute float vertex_boneIndices;\nuniform highp sampler2D texture_poseMap;\nuniform vec4 texture_poseMapSize;\nmat4 getBoneMatrix(const in float i) {\n\tfloat j = i * 3.0;\n\tfloat dx = texture_poseMapSize.z;\n\tfloat dy = texture_poseMapSize.w;\n\tfloat y = floor(j * dx);\n\tfloat x = j - (y * texture_poseMapSize.x);\n\ty = dy * (y + 0.5);\n\tvec4 v1 = texture2D(texture_poseMap, vec2(dx * (x + 0.5), y));\n\tvec4 v2 = texture2D(texture_poseMap, vec2(dx * (x + 1.5), y));\n\tvec4 v3 = texture2D(texture_poseMap, vec2(dx * (x + 2.5), y));\n\treturn mat4(\n\t\tv1.x, v2.x, v3.x, 0,\n\t\tv1.y, v2.y, v3.y, 0,\n\t\tv1.z, v2.z, v3.z, 0,\n\t\tv1.w, v2.w, v3.w, 1\n\t);\n}\n`;\n\nexport { skinBatchTexVS as default };\n","var skinConstVS = `\nattribute vec4 vertex_boneWeights;\nattribute vec4 vertex_boneIndices;\nuniform vec4 matrix_pose[BONE_LIMIT * 3];\nvoid getBoneMatrix(const in float i, out vec4 v1, out vec4 v2, out vec4 v3) {\n\tv1 = matrix_pose[int(3.0 * i)];\n\tv2 = matrix_pose[int(3.0 * i + 1.0)];\n\tv3 = matrix_pose[int(3.0 * i + 2.0)];\n}\nmat4 getSkinMatrix(const in vec4 indices, const in vec4 weights) {\n\tvec4 a1, a2, a3;\n\tgetBoneMatrix(indices.x, a1, a2, a3);\n\tvec4 b1, b2, b3;\n\tgetBoneMatrix(indices.y, b1, b2, b3);\n\tvec4 c1, c2, c3;\n\tgetBoneMatrix(indices.z, c1, c2, c3);\n\tvec4 d1, d2, d3;\n\tgetBoneMatrix(indices.w, d1, d2, d3);\n\tvec4 v1 = a1 * weights.x + b1 * weights.y + c1 * weights.z + d1 * weights.w;\n\tvec4 v2 = a2 * weights.x + b2 * weights.y + c2 * weights.z + d2 * weights.w;\n\tvec4 v3 = a3 * weights.x + b3 * weights.y + c3 * weights.z + d3 * weights.w;\n\tfloat one = dot(weights, vec4(1.0));\n\treturn mat4(\n\t\tv1.x, v2.x, v3.x, 0,\n\t\tv1.y, v2.y, v3.y, 0,\n\t\tv1.z, v2.z, v3.z, 0,\n\t\tv1.w, v2.w, v3.w, one\n\t);\n}\n`;\n\nexport { skinConstVS as default };\n","var skinTexVS = `\nattribute vec4 vertex_boneWeights;\nattribute vec4 vertex_boneIndices;\nuniform highp sampler2D texture_poseMap;\nuniform vec4 texture_poseMapSize;\nvoid getBoneMatrix(const in float index, out vec4 v1, out vec4 v2, out vec4 v3) {\n\tfloat i = float(index);\n\tfloat j = i * 3.0;\n\tfloat dx = texture_poseMapSize.z;\n\tfloat dy = texture_poseMapSize.w;\n\t\n\tfloat y = floor(j * dx);\n\tfloat x = j - (y * texture_poseMapSize.x);\n\ty = dy * (y + 0.5);\n\tv1 = texture2D(texture_poseMap, vec2(dx * (x + 0.5), y));\n\tv2 = texture2D(texture_poseMap, vec2(dx * (x + 1.5), y));\n\tv3 = texture2D(texture_poseMap, vec2(dx * (x + 2.5), y));\n}\nmat4 getSkinMatrix(const in vec4 indices, const in vec4 weights) {\n\tvec4 a1, a2, a3;\n\tgetBoneMatrix(indices.x, a1, a2, a3);\n\tvec4 b1, b2, b3;\n\tgetBoneMatrix(indices.y, b1, b2, b3);\n\tvec4 c1, c2, c3;\n\tgetBoneMatrix(indices.z, c1, c2, c3);\n\tvec4 d1, d2, d3;\n\tgetBoneMatrix(indices.w, d1, d2, d3);\n\tvec4 v1 = a1 * weights.x + b1 * weights.y + c1 * weights.z + d1 * weights.w;\n\tvec4 v2 = a2 * weights.x + b2 * weights.y + c2 * weights.z + d2 * weights.w;\n\tvec4 v3 = a3 * weights.x + b3 * weights.y + c3 * weights.z + d3 * weights.w;\n\tfloat one = dot(weights, vec4(1.0));\n\treturn mat4(\n\t\tv1.x, v2.x, v3.x, 0,\n\t\tv1.y, v2.y, v3.y, 0,\n\t\tv1.z, v2.z, v3.z, 0,\n\t\tv1.w, v2.w, v3.w, one\n\t);\n}\n`;\n\nexport { skinTexVS as default };\n","var skyboxEnvPS = `\nvarying vec3 vViewDir;\nuniform sampler2D texture_envAtlas;\nuniform float mipLevel;\nvoid main(void) {\n\tvec3 dir = vViewDir * vec3(-1.0, 1.0, 1.0);\n\tvec2 uv = toSphericalUv(normalize(dir));\n\tvec3 linear = $DECODE(texture2D(texture_envAtlas, mapRoughnessUv(uv, mipLevel)));\n\tgl_FragColor = vec4(gammaCorrectOutput(toneMap(processEnvironment(linear))), 1.0);\n}\n`;\n\nexport { skyboxEnvPS as default };\n","var skyboxHDRPS = `\nvarying vec3 vViewDir;\nuniform samplerCube texture_cubeMap;\nvoid main(void) {\n\tvec3 dir=vViewDir;\n\tdir.x *= -1.0;\n\tvec3 linear = $DECODE(textureCube(texture_cubeMap, fixSeamsStatic(dir, $FIXCONST)));\n\tgl_FragColor = vec4(gammaCorrectOutput(toneMap(processEnvironment(linear))), 1.0);\n}\n`;\n\nexport { skyboxHDRPS as default };\n","var skyboxVS = `\nattribute vec3 aPosition;\n#ifndef VIEWMATRIX\n#define VIEWMATRIX\nuniform mat4 matrix_view;\n#endif\nuniform mat4 matrix_projectionSkybox;\nuniform mat3 cubeMapRotationMatrix;\nvarying vec3 vViewDir;\nvoid main(void) {\n\tmat4 view = matrix_view;\n\tview[3][0] = view[3][1] = view[3][2] = 0.0;\n\tgl_Position = matrix_projectionSkybox * view * vec4(aPosition, 1.0);\n\tgl_Position.z = gl_Position.w - 0.00001;\n\tvViewDir = aPosition * cubeMapRotationMatrix;\n}\n`;\n\nexport { skyboxVS as default };\n","var specularPS = `\n#ifdef MAPCOLOR\nuniform vec3 material_specular;\n#endif\nvoid getSpecularity() {\n\tvec3 specularColor = vec3(1,1,1);\n\t#ifdef MAPCOLOR\n\tspecularColor *= material_specular;\n\t#endif\n\t#ifdef MAPTEXTURE\n\tspecularColor *= $DECODE(texture2DBias($SAMPLER, $UV, textureBias)).$CH;\n\t#endif\n\t#ifdef MAPVERTEX\n\tspecularColor *= saturate(vVertexColor.$VC);\n\t#endif\n\tdSpecularity = specularColor;\n}\n`;\n\nexport { specularPS as default };\n","var sphericalPS = `\nconst float PI = 3.141592653589793;\nvec2 toSpherical(vec3 dir) {\n\treturn vec2(dir.xz == vec2(0.0) ? 0.0 : atan(dir.x, dir.z), asin(dir.y));\n}\nvec2 toSphericalUv(vec3 dir) {\n\tvec2 uv = toSpherical(dir) / vec2(PI * 2.0, PI) + 0.5;\n\treturn vec2(uv.x, 1.0 - uv.y);\n}\n`;\n\nexport { sphericalPS as default };\n","var specularityFactorPS = `\n#ifdef MAPFLOAT\nuniform float material_specularityFactor;\n#endif\nvoid getSpecularityFactor() {\n\tfloat specularityFactor = 1.0;\n\t#ifdef MAPFLOAT\n\tspecularityFactor *= material_specularityFactor;\n\t#endif\n\t#ifdef MAPTEXTURE\n\tspecularityFactor *= texture2DBias($SAMPLER, $UV, textureBias).$CH;\n\t#endif\n\t#ifdef MAPVERTEX\n\tspecularityFactor *= saturate(vVertexColor.$VC);\n\t#endif\n\tdSpecularityFactor = specularityFactor;\n}\n`;\n\nexport { specularityFactorPS as default };\n","var spotPS = `\nfloat getSpotEffect(vec3 lightSpotDir, float lightInnerConeAngle, float lightOuterConeAngle, vec3 lightDirNorm) {\n\tfloat cosAngle = dot(lightDirNorm, lightSpotDir);\n\treturn smoothstep(lightOuterConeAngle, lightInnerConeAngle, cosAngle);\n}\n`;\n\nexport { spotPS as default };\n","var startPS = `\nvoid main(void) {\n\tdReflection = vec4(0);\n\t#ifdef LIT_CLEARCOAT\n\tccSpecularLight = vec3(0);\n\tccReflection = vec3(0);\n\t#endif\n`;\n\nexport { startPS as default };\n","var startVS = `\nvoid main(void) {\n\tgl_Position = getPosition();\n`;\n\nexport { startVS as default };\n","var startNineSlicedPS = `\n\tnineSlicedUv = vUv0;\n\tnineSlicedUv.y = 1.0 - nineSlicedUv.y;\n`;\n\nexport { startNineSlicedPS as default };\n","var startNineSlicedTiledPS = `\n\tvec2 tileMask = step(vMask, vec2(0.99999));\n\tvec2 tileSize = 0.5 * (innerOffset.xy + innerOffset.zw);\n\tvec2 tileScale = vec2(1.0) / (vec2(1.0) - tileSize);\n\tvec2 clampedUv = mix(innerOffset.xy * 0.5, vec2(1.0) - innerOffset.zw * 0.5, fract((vTiledUv - tileSize) * tileScale));\n\tclampedUv = clampedUv * atlasRect.zw + atlasRect.xy;\n\tnineSlicedUv = vUv0 * tileMask + clampedUv * (vec2(1.0) - tileMask);\n\tnineSlicedUv.y = 1.0 - nineSlicedUv.y;\n\t\n`;\n\nexport { startNineSlicedTiledPS as default };\n","var storeEVSMPS = `\nfloat exponent = VSM_EXPONENT;\ndepth = 2.0 * depth - 1.0;\ndepth =  exp(exponent * depth);\ngl_FragColor = vec4(depth, depth*depth, 1.0, 1.0);\n`;\n\nexport { storeEVSMPS as default };\n","var tangentBinormalVS = `\nvec3 getTangent() {\n\treturn normalize(dNormalMatrix * vertex_tangent.xyz);\n}\nvec3 getBinormal() {\n\treturn cross(vNormalW, vTangentW) * vertex_tangent.w;\n}\n`;\n\nexport { tangentBinormalVS as default };\n","var TBNPS = `\nvoid getTBN(vec3 tangent, vec3 binormal, vec3 normal) {\n\tdTBN = mat3(normalize(tangent), normalize(binormal), normalize(normal));\n}\n`;\n\nexport { TBNPS as default };\n","var TBNderivativePS = `\nuniform float tbnBasis;\nvoid getTBN(vec3 tangent, vec3 binormal, vec3 normal) {\n\tvec2 uv = $UV;\n\tvec3 dp1 = dFdx( vPositionW );\n\tvec3 dp2 = dFdy( vPositionW );\n\tvec2 duv1 = dFdx( uv );\n\tvec2 duv2 = dFdy( uv );\n\tvec3 dp2perp = cross( dp2, normal );\n\tvec3 dp1perp = cross( normal, dp1 );\n\tvec3 T = dp2perp * duv1.x + dp1perp * duv2.x;\n\tvec3 B = dp2perp * duv1.y + dp1perp * duv2.y;\n\tfloat denom = max( dot(T,T), dot(B,B) );\n\tfloat invmax = (denom == 0.0) ? 0.0 : tbnBasis / sqrt( denom );\n\tdTBN = mat3(T * invmax, -B * invmax, normal );\n}\n`;\n\nexport { TBNderivativePS as default };\n","var TBNfastPS = `\nvoid getTBN(vec3 tangent, vec3 binormal, vec3 normal) {\n\tdTBN = mat3(tangent, binormal, normal);\n}\n`;\n\nexport { TBNfastPS as default };\n","var TBNObjectSpacePS = `\nvoid getTBN(vec3 tangent, vec3 binormal, vec3 normal) {\n\tvec3 B = cross(normal, vObjectSpaceUpW);\n\tvec3 T = cross(normal, B);\n\tif (dot(B,B)==0.0)\n\t{\n\t\tfloat major=max(max(normal.x, normal.y), normal.z);\n\t\tif (normal.x == major)\n\t\t{\n\t\t\tB=cross(normal, vec3(0,1,0));\n\t\t\tT=cross(normal, B);\n\t\t}\n\t\telse if (normal.y == major)\n\t\t{\n\t\t\tB=cross(normal, vec3(0,0,1));\n\t\t\tT=cross(normal, B);\n\t\t}\n\t\telse if (normal.z == major)\n\t\t{\n\t\t\tB=cross(normal, vec3(1,0,0));\n\t\t\tT=cross(normal, B);\n\t\t}\n\t}\n\tdTBN = mat3(normalize(T), normalize(B), normalize(normal));\n}\n`;\n\nexport { TBNObjectSpacePS as default };\n","var textureSamplePS = `\nvec4 texture2DSRGB(sampler2D tex, vec2 uv) {\n\treturn gammaCorrectInput(texture2D(tex, uv));\n}\nvec4 texture2DSRGB(sampler2D tex, vec2 uv, float bias) {\n\treturn gammaCorrectInput(texture2D(tex, uv, bias));\n}\nvec3 texture2DRGBM(sampler2D tex, vec2 uv) {\n\treturn decodeRGBM(texture2D(tex, uv));\n}\nvec3 texture2DRGBM(sampler2D tex, vec2 uv, float bias) {\n\treturn decodeRGBM(texture2D(tex, uv, bias));\n}\nvec3 texture2DRGBE(sampler2D tex, vec2 uv) {\n\treturn decodeRGBM(texture2D(tex, uv));\n}\nvec3 texture2DRGBE(sampler2D tex, vec2 uv, float bias) {\n\treturn decodeRGBM(texture2D(tex, uv, bias));\n}\n`;\n\nexport { textureSamplePS as default };\n","var thicknessPS = `\n#ifdef MAPFLOAT\nuniform float material_thickness;\n#endif\nvoid getThickness() {\n\tdThickness = 1.0;\n\t#ifdef MAPFLOAT\n\tdThickness *= material_thickness;\n\t#endif\n\t#ifdef MAPTEXTURE\n\tdThickness *= texture2DBias($SAMPLER, $UV, textureBias).$CH;\n\t#endif\n\t#ifdef MAPVERTEX\n\tdThickness *= saturate(vVertexColor.$VC);\n\t#endif\n}\n`;\n\nexport { thicknessPS as default };\n","var tonemappingAcesPS = `\nuniform float exposure;\nvec3 toneMap(vec3 color) {\n\tfloat tA = 2.51;\n\tfloat tB = 0.03;\n\tfloat tC = 2.43;\n\tfloat tD = 0.59;\n\tfloat tE = 0.14;\n\tvec3 x = color * exposure;\n\treturn (x*(tA*x+tB))/(x*(tC*x+tD)+tE);\n}\n`;\n\nexport { tonemappingAcesPS as default };\n","var tonemappingAces2PS = `\nuniform float exposure;\nconst mat3 ACESInputMat = mat3(\n\t0.59719, 0.35458, 0.04823,\n\t0.07600, 0.90834, 0.01566,\n\t0.02840, 0.13383, 0.83777\n);\nconst mat3 ACESOutputMat = mat3(\n\t 1.60475, -0.53108, -0.07367,\n\t-0.10208,  1.10813, -0.00605,\n\t-0.00327, -0.07276,  1.07602\n);\nvec3 RRTAndODTFit(vec3 v) {\n\tvec3 a = v * (v + 0.0245786) - 0.000090537;\n\tvec3 b = v * (0.983729 * v + 0.4329510) + 0.238081;\n\treturn a / b;\n}\nvec3 toneMap(vec3 color) {\n\tcolor *= exposure / 0.6;\n\tcolor = color * ACESInputMat;\n\tcolor = RRTAndODTFit(color);\n\tcolor = color * ACESOutputMat;\n\tcolor = clamp(color, 0.0, 1.0);\n\treturn color;\n}\n`;\n\nexport { tonemappingAces2PS as default };\n","var tonemappingFilmicPS = `\nconst float A =  0.15;\nconst float B =  0.50;\nconst float C =  0.10;\nconst float D =  0.20;\nconst float E =  0.02;\nconst float F =  0.30;\nconst float W =  11.2;\nuniform float exposure;\nvec3 uncharted2Tonemap(vec3 x) {\n\t return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;\n}\nvec3 toneMap(vec3 color) {\n\tcolor = uncharted2Tonemap(color * exposure);\n\tvec3 whiteScale = 1.0 / uncharted2Tonemap(vec3(W,W,W));\n\tcolor = color * whiteScale;\n\treturn color;\n}\n`;\n\nexport { tonemappingFilmicPS as default };\n","var tonemappingHejlPS = `\nuniform float exposure;\nvec3 toneMap(vec3 color) {\n\tcolor *= exposure;\n\tconst float  A = 0.22, B = 0.3, C = .1, D = 0.2, E = .01, F = 0.3;\n\tconst float Scl = 1.25;\n\tvec3 h = max( vec3(0.0), color - vec3(0.004) );\n\treturn (h*((Scl*A)*h+Scl*vec3(C*B,C*B,C*B))+Scl*vec3(D*E,D*E,D*E)) / (h*(A*h+vec3(B,B,B))+vec3(D*F,D*F,D*F)) - Scl*vec3(E/F,E/F,E/F);\n}\n`;\n\nexport { tonemappingHejlPS as default };\n","var tonemappingLinearPS = `\nuniform float exposure;\nvec3 toneMap(vec3 color) {\n\treturn color * exposure;\n}\n`;\n\nexport { tonemappingLinearPS as default };\n","var tonemappingNonePS = `\nvec3 toneMap(vec3 color) {\n\treturn color;\n}\n`;\n\nexport { tonemappingNonePS as default };\n","var transformVS = `\n#ifdef PIXELSNAP\nuniform vec4 uScreenSize;\n#endif\n#ifdef SCREENSPACE\nuniform float projectionFlipY;\n#endif\n#ifdef MORPHING\nuniform vec4 morph_weights_a;\nuniform vec4 morph_weights_b;\n#endif\n#ifdef MORPHING_TEXTURE_BASED\n\tuniform vec4 morph_tex_params;\n\t#ifdef WEBGPU\n\t\tivec2 getTextureMorphCoords() {\n\t\t\tivec2 textureSize = ivec2(morph_tex_params.xy);\n\t\t\tint morphGridV = int(morph_vertex_id / textureSize.x);\n\t\t\tint morphGridU = int(morph_vertex_id - (morphGridV * textureSize.x));\n\t\t\tmorphGridV = textureSize.y - morphGridV - 1;\n\t\t\treturn ivec2(morphGridU, morphGridV);\n\t\t}\n\t#else\n\t\tvec2 getTextureMorphCoords() {\n\t\t\tvec2 textureSize = morph_tex_params.xy;\n\t\t\tvec2 invTextureSize = morph_tex_params.zw;\n\t\t\tfloat morphGridV = floor(morph_vertex_id * invTextureSize.x);\n\t\t\tfloat morphGridU = morph_vertex_id - (morphGridV * textureSize.x);\n\t\t\treturn vec2(morphGridU, morphGridV) * invTextureSize + (0.5 * invTextureSize);\n\t\t}\n\t#endif\n#endif\n#ifdef MORPHING_TEXTURE_BASED_POSITION\nuniform highp sampler2D morphPositionTex;\n#endif\nmat4 getModelMatrix() {\n\t#ifdef DYNAMICBATCH\n\treturn getBoneMatrix(vertex_boneIndices);\n\t#elif defined(SKIN)\n\treturn matrix_model * getSkinMatrix(vertex_boneIndices, vertex_boneWeights);\n\t#elif defined(INSTANCING)\n\treturn mat4(instance_line1, instance_line2, instance_line3, instance_line4);\n\t#else\n\treturn matrix_model;\n\t#endif\n}\nvec4 getPosition() {\n\tdModelMatrix = getModelMatrix();\n\tvec3 localPos = vertex_position;\n\t#ifdef NINESLICED\n\tlocalPos.xz *= outerScale;\n\tvec2 positiveUnitOffset = clamp(vertex_position.xz, vec2(0.0), vec2(1.0));\n\tvec2 negativeUnitOffset = clamp(-vertex_position.xz, vec2(0.0), vec2(1.0));\n\tlocalPos.xz += (-positiveUnitOffset * innerOffset.xy + negativeUnitOffset * innerOffset.zw) * vertex_texCoord0.xy;\n\tvTiledUv = (localPos.xz - outerScale + innerOffset.xy) * -0.5 + 1.0;\n\tlocalPos.xz *= -0.5;\n\tlocalPos = localPos.xzy;\n\t#endif\n\t#ifdef MORPHING\n\t#ifdef MORPHING_POS03\n\tlocalPos.xyz += morph_weights_a[0] * morph_pos0;\n\tlocalPos.xyz += morph_weights_a[1] * morph_pos1;\n\tlocalPos.xyz += morph_weights_a[2] * morph_pos2;\n\tlocalPos.xyz += morph_weights_a[3] * morph_pos3;\n\t#endif\n\t#ifdef MORPHING_POS47\n\tlocalPos.xyz += morph_weights_b[0] * morph_pos4;\n\tlocalPos.xyz += morph_weights_b[1] * morph_pos5;\n\tlocalPos.xyz += morph_weights_b[2] * morph_pos6;\n\tlocalPos.xyz += morph_weights_b[3] * morph_pos7;\n\t#endif\n\t#endif\n\t#ifdef MORPHING_TEXTURE_BASED_POSITION\n\t\t#ifdef WEBGPU\n\t\t\tivec2 morphUV = getTextureMorphCoords();\n\t\t\tvec3 morphPos = texelFetch(morphPositionTex, ivec2(morphUV), 0).xyz;\n\t\t#else\n\t\t\tvec2 morphUV = getTextureMorphCoords();\n\t\t\tvec3 morphPos = texture2D(morphPositionTex, morphUV).xyz;\n\t\t#endif\n\t\tlocalPos += morphPos;\n\t#endif\n\tvec4 posW = dModelMatrix * vec4(localPos, 1.0);\n\t#ifdef SCREENSPACE\n\tposW.zw = vec2(0.0, 1.0);\n\t#endif\n\tdPositionW = posW.xyz;\n\tvec4 screenPos;\n\t#ifdef UV1LAYOUT\n\tscreenPos = vec4(vertex_texCoord1.xy * 2.0 - 1.0, 0.5, 1);\n\t#else\n\t#ifdef SCREENSPACE\n\tscreenPos = posW;\n\tscreenPos.y *= projectionFlipY;\n\t#else\n\tscreenPos = matrix_viewProjection * posW;\n\t#endif\n\t#ifdef PIXELSNAP\n\tscreenPos.xy = (screenPos.xy * 0.5) + 0.5;\n\tscreenPos.xy *= uScreenSize.xy;\n\tscreenPos.xy = floor(screenPos.xy);\n\tscreenPos.xy *= uScreenSize.zw;\n\tscreenPos.xy = (screenPos.xy * 2.0) - 1.0;\n\t#endif\n\t#endif\n\treturn screenPos;\n}\nvec3 getWorldPosition() {\n\treturn dPositionW;\n}\n`;\n\nexport { transformVS as default };\n","var transformDeclVS = `\nattribute vec3 vertex_position;\nuniform mat4 matrix_model;\nuniform mat4 matrix_viewProjection;\nvec3 dPositionW;\nmat4 dModelMatrix;\n`;\n\nexport { transformDeclVS as default };\n","var transmissionPS = `\n#ifdef MAPFLOAT\nuniform float material_refraction;\n#endif\nvoid getRefraction() {\n\tfloat refraction = 1.0;\n\t#ifdef MAPFLOAT\n\trefraction = material_refraction;\n\t#endif\n\t#ifdef MAPTEXTURE\n\trefraction *= texture2DBias($SAMPLER, $UV, textureBias).$CH;\n\t#endif\n\t#ifdef MAPVERTEX\n\trefraction *= saturate(vVertexColor.$VC);\n\t#endif\n\tdTransmission = refraction;\n}\n`;\n\nexport { transmissionPS as default };\n","var uv0VS = `\n#ifdef NINESLICED\nvec2 getUv0() {\n\tvec2 uv = vertex_position.xz;\n\tvec2 positiveUnitOffset = clamp(vertex_position.xz, vec2(0.0), vec2(1.0));\n\tvec2 negativeUnitOffset = clamp(-vertex_position.xz, vec2(0.0), vec2(1.0));\n\tuv += (-positiveUnitOffset * innerOffset.xy + negativeUnitOffset * innerOffset.zw) * vertex_texCoord0.xy;\n\tuv = uv * -0.5 + 0.5;\n\tuv = uv * atlasRect.zw + atlasRect.xy;\n\tvMask = vertex_texCoord0.xy;\n\treturn uv;\n}\n#else\nvec2 getUv0() {\n\treturn vertex_texCoord0;\n}\n#endif\n`;\n\nexport { uv0VS as default };\n","var uv1VS = `\nvec2 getUv1() {\n\treturn vertex_texCoord1;\n}\n`;\n\nexport { uv1VS as default };\n","var viewDirPS = `\nvoid getViewDir() {\n\tdViewDirW = normalize(view_position - vPositionW);\n}\n`;\n\nexport { viewDirPS as default };\n","var viewNormalVS = `\n#ifndef VIEWMATRIX\n#define VIEWMATRIX\nuniform mat4 matrix_view;\n#endif\nvec3 getViewNormal() {\n\treturn mat3(matrix_view) * vNormalW;\n}\n`;\n\nexport { viewNormalVS as default };\n","import alphaTestPS from './standard/frag/alphaTest.js';\nimport ambientConstantPS from './lit/frag/ambientConstant.js';\nimport ambientEnvPS from './lit/frag/ambientEnv.js';\nimport ambientSHPS from './lit/frag/ambientSH.js';\nimport aoPS from './standard/frag/ao.js';\nimport aoDetailMapPS from './standard/frag/aoDetailMap.js';\nimport aoDiffuseOccPS from './lit/frag/aoDiffuseOcc.js';\nimport aoSpecOccPS from './lit/frag/aoSpecOcc.js';\nimport aoSpecOccConstPS from './lit/frag/aoSpecOccConst.js';\nimport aoSpecOccConstSimplePS from './lit/frag/aoSpecOccConstSimple.js';\nimport aoSpecOccSimplePS from './lit/frag/aoSpecOccSimple.js';\nimport basePS from './lit/frag/base.js';\nimport baseVS from './lit/vert/base.js';\nimport baseNineSlicedPS from './lit/frag/baseNineSliced.js';\nimport baseNineSlicedVS from './lit/vert/baseNineSliced.js';\nimport baseNineSlicedTiledPS from './lit/frag/baseNineSlicedTiled.js';\nimport biasConstPS from './lit/frag/biasConst.js';\nimport blurVSMPS from './lit/frag/blurVSM.js';\nimport clearCoatPS from './standard/frag/clearCoat.js';\nimport clearCoatGlossPS from './standard/frag/clearCoatGloss.js';\nimport clearCoatNormalPS from './standard/frag/clearCoatNormal.js';\nimport clusteredLightUtilsPS from './lit/frag/clusteredLightUtils.js';\nimport clusteredLightCookiesPS from './lit/frag/clusteredLightCookies.js';\nimport clusteredLightShadowsPS from './lit/frag/clusteredLightShadows.js';\nimport clusteredLightPS from './lit/frag/clusteredLight.js';\nimport combinePS from './lit/frag/combine.js';\nimport cookiePS from './lit/frag/cookie.js';\nimport cubeMapProjectBoxPS from './lit/frag/cubeMapProjectBox.js';\nimport cubeMapProjectNonePS from './lit/frag/cubeMapProjectNone.js';\nimport cubeMapRotatePS from './lit/frag/cubeMapRotate.js';\nimport debugOutputPS from './lit/frag/debug-output.js';\nimport debugProcessFrontendPS from './lit/frag/debug-process-frontend.js';\nimport decodePS from './common/frag/decode.js';\nimport detailModesPS from './standard/frag/detailModes.js';\nimport diffusePS from './standard/frag/diffuse.js';\nimport diffuseDetailMapPS from './standard/frag/diffuseDetailMap.js';\nimport emissivePS from './standard/frag/emissive.js';\nimport encodePS from './common/frag/encode.js';\nimport endPS from './lit/frag/end.js';\nimport endVS from './lit/vert/end.js';\nimport envAtlasPS from './common/frag/envAtlas.js';\nimport envConstPS from './common/frag/envConst.js';\nimport envMultiplyPS from './common/frag/envMultiply.js';\nimport extensionPS from './lit/frag/extension.js';\nimport extensionVS from './lit/vert/extension.js';\nimport falloffInvSquaredPS from './lit/frag/falloffInvSquared.js';\nimport falloffLinearPS from './lit/frag/falloffLinear.js';\nimport fixCubemapSeamsNonePS from './common/frag/fixCubemapSeamsNone.js';\nimport fixCubemapSeamsStretchPS from './common/frag/fixCubemapSeamsStretch.js';\nimport floatUnpackingPS from './lit/frag/float-unpacking.js';\nimport fogExpPS from './lit/frag/fogExp.js';\nimport fogExp2PS from './lit/frag/fogExp2.js';\nimport fogLinearPS from './lit/frag/fogLinear.js';\nimport fogNonePS from './lit/frag/fogNone.js';\nimport fresnelSchlickPS from './lit/frag/fresnelSchlick.js';\nimport fullscreenQuadPS from './common/frag/fullscreenQuad.js';\nimport fullscreenQuadVS from './common/vert/fullscreenQuad.js';\nimport gamma1_0PS from './common/frag/gamma1_0.js';\nimport gamma2_2PS from './common/frag/gamma2_2.js';\nimport gles2PS from '../../../platform/graphics/shader-chunks/frag/gles2.js';\nimport gles3PS from '../../../platform/graphics/shader-chunks/frag/gles3.js';\nimport gles3VS from '../../../platform/graphics/shader-chunks/vert/gles3.js';\nimport glossPS from './standard/frag/gloss.js';\nimport iridescenceDiffractionPS from './lit/frag/iridescenceDiffraction.js';\nimport iridescencePS from './standard/frag/iridescence.js';\nimport iridescenceThicknessPS from './standard/frag/iridescenceThickness.js';\nimport instancingVS from './lit/vert/instancing.js';\nimport iorPS from './standard/frag/ior.js';\nimport lightDiffuseLambertPS from './lit/frag/lightDiffuseLambert.js';\nimport lightDirPointPS from './lit/frag/lightDirPoint.js';\nimport lightmapAddPS from './lit/frag/lightmapAdd.js';\nimport lightmapDirAddPS from './lit/frag/lightmapDirAdd.js';\nimport lightmapDirPS from './standard/frag/lightmapDir.js';\nimport lightmapSinglePS from './standard/frag/lightmapSingle.js';\nimport lightSpecularAnisoGGXPS from './lit/frag/lightSpecularAnisoGGX.js';\nimport lightSpecularBlinnPS from './lit/frag/lightSpecularBlinn.js';\nimport lightSpecularPhongPS from './lit/frag/lightSpecularPhong.js';\nimport lightSheenPS from './lit/frag/lightSheen.js';\nimport linearizeDepthPS from './common/frag/linearizeDepth.js';\nimport litShaderArgsPS from './standard/frag/litShaderArgs.js';\nimport ltcPS from './lit/frag/ltc.js';\nimport metalnessPS from './standard/frag/metalness.js';\nimport msdfPS from './common/frag/msdf.js';\nimport metalnessModulatePS from './lit/frag/metalnessModulate.js';\nimport msdfVS from './common/vert/msdf.js';\nimport normalVS from './lit/vert/normal.js';\nimport normalDetailMapPS from './standard/frag/normalDetailMap.js';\nimport normalInstancedVS from './lit/vert/normalInstanced.js';\nimport normalMapPS from './standard/frag/normalMap.js';\nimport normalSkinnedVS from './lit/vert/normalSkinned.js';\nimport normalXYPS from './standard/frag/normalXY.js';\nimport normalXYZPS from './standard/frag/normalXYZ.js';\nimport opacityPS from './standard/frag/opacity.js';\nimport outputPS from './lit/frag/output.js';\nimport outputAlphaPS from './lit/frag/outputAlpha.js';\nimport outputAlphaOpaquePS from './lit/frag/outputAlphaOpaque.js';\nimport outputAlphaPremulPS from './lit/frag/outputAlphaPremul.js';\nimport outputTex2DPS from './common/frag/outputTex2D.js';\nimport packDepthPS from './common/frag/packDepth.js';\nimport sheenPS from './standard/frag/sheen.js';\nimport sheenGlossPS from './standard/frag/sheenGloss.js';\nimport parallaxPS from './standard/frag/parallax.js';\nimport particlePS from './particle/frag/particle.js';\nimport particleVS from './particle/vert/particle.js';\nimport particleAnimFrameClampVS from './particle/vert/particleAnimFrameClamp.js';\nimport particleAnimFrameLoopVS from './particle/vert/particleAnimFrameLoop.js';\nimport particleAnimTexVS from './particle/vert/particleAnimTex.js';\nimport particleInputFloatPS from './particle/frag/particleInputFloat.js';\nimport particleInputRgba8PS from './particle/frag/particleInputRgba8.js';\nimport particleOutputFloatPS from './particle/frag/particleOutputFloat.js';\nimport particleOutputRgba8PS from './particle/frag/particleOutputRgba8.js';\nimport particleUpdaterAABBPS from './particle/frag/particleUpdaterAABB.js';\nimport particleUpdaterEndPS from './particle/frag/particleUpdaterEnd.js';\nimport particleUpdaterInitPS from './particle/frag/particleUpdaterInit.js';\nimport particleUpdaterNoRespawnPS from './particle/frag/particleUpdaterNoRespawn.js';\nimport particleUpdaterOnStopPS from './particle/frag/particleUpdaterOnStop.js';\nimport particleUpdaterRespawnPS from './particle/frag/particleUpdaterRespawn.js';\nimport particleUpdaterSpherePS from './particle/frag/particleUpdaterSphere.js';\nimport particleUpdaterStartPS from './particle/frag/particleUpdaterStart.js';\nimport particle_billboardVS from './particle/vert/particle_billboard.js';\nimport particle_blendAddPS from './particle/frag/particle_blendAdd.js';\nimport particle_blendMultiplyPS from './particle/frag/particle_blendMultiply.js';\nimport particle_blendNormalPS from './particle/frag/particle_blendNormal.js';\nimport particle_cpuVS from './particle/vert/particle_cpu.js';\nimport particle_cpu_endVS from './particle/vert/particle_cpu_end.js';\nimport particle_customFaceVS from './particle/vert/particle_customFace.js';\nimport particle_endPS from './particle/frag/particle_end.js';\nimport particle_endVS from './particle/vert/particle_end.js';\nimport particle_halflambertPS from './particle/frag/particle_halflambert.js';\nimport particle_initVS from './particle/vert/particle_init.js';\nimport particle_lambertPS from './particle/frag/particle_lambert.js';\nimport particle_lightingPS from './particle/frag/particle_lighting.js';\nimport particle_localShiftVS from './particle/vert/particle_localShift.js';\nimport particle_meshVS from './particle/vert/particle_mesh.js';\nimport particle_normalVS from './particle/vert/particle_normal.js';\nimport particle_normalMapPS from './particle/frag/particle_normalMap.js';\nimport particle_pointAlongVS from './particle/vert/particle_pointAlong.js';\nimport particle_softPS from './particle/frag/particle_soft.js';\nimport particle_softVS from './particle/vert/particle_soft.js';\nimport particle_stretchVS from './particle/vert/particle_stretch.js';\nimport particle_TBNVS from './particle/vert/particle_TBN.js';\nimport particle_wrapVS from './particle/vert/particle_wrap.js';\nimport reflDirPS from './lit/frag/reflDir.js';\nimport reflDirAnisoPS from './lit/frag/reflDirAniso.js';\nimport reflectionCCPS from './lit/frag/reflectionCC.js';\nimport reflectionCubePS from './lit/frag/reflectionCube.js';\nimport reflectionEnvHQPS from './lit/frag/reflectionEnvHQ.js';\nimport reflectionEnvPS from './lit/frag/reflectionEnv.js';\nimport reflectionSpherePS from './lit/frag/reflectionSphere.js';\nimport reflectionSphereLowPS from './lit/frag/reflectionSphereLow.js';\nimport reflectionSheenPS from './lit/frag/reflectionSheen.js';\nimport refractionCubePS from './lit/frag/refractionCube.js';\nimport refractionDynamicPS from './lit/frag/refractionDynamic.js';\nimport reprojectPS from './common/frag/reproject.js';\nimport screenDepthPS from './common/frag/screenDepth.js';\nimport shadowCascadesPS from './lit/frag/shadowCascades.js';\nimport shadowEVSMPS from './lit/frag/shadowEVSM.js';\nimport shadowEVSMnPS from './lit/frag/shadowEVSMn.js';\nimport shadowPCSSPS from './lit/frag/shadowPCSS.js';\nimport shadowSampleCoordPS from './lit/frag/shadowSampleCoord.js';\nimport shadowStandardPS from './lit/frag/shadowStandard.js';\nimport shadowStandardGL2PS from './lit/frag/shadowStandardGL2.js';\nimport shadowVSM8PS from './lit/frag/shadowVSM8.js';\nimport shadowVSM_commonPS from './lit/frag/shadowVSM_common.js';\nimport skinBatchConstVS from './common/vert/skinBatchConst.js';\nimport skinBatchTexVS from './common/vert/skinBatchTex.js';\nimport skinConstVS from './common/vert/skinConst.js';\nimport skinTexVS from './common/vert/skinTex.js';\nimport skyboxEnvPS from './skybox/frag/skyboxEnv.js';\nimport skyboxHDRPS from './skybox/frag/skyboxHDR.js';\nimport skyboxVS from './skybox/vert/skybox.js';\nimport specularPS from './standard/frag/specular.js';\nimport sphericalPS from './common/frag/spherical.js';\nimport specularityFactorPS from './standard/frag/specularityFactor.js';\nimport spotPS from './lit/frag/spot.js';\nimport startPS from './lit/frag/start.js';\nimport startVS from './lit/vert/start.js';\nimport startNineSlicedPS from './lit/frag/startNineSliced.js';\nimport startNineSlicedTiledPS from './lit/frag/startNineSlicedTiled.js';\nimport storeEVSMPS from './lit/frag/storeEVSM.js';\nimport tangentBinormalVS from './lit/vert/tangentBinormal.js';\nimport TBNPS from './lit/frag/TBN.js';\nimport TBNderivativePS from './lit/frag/TBNderivative.js';\nimport TBNfastPS from './lit/frag/TBNfast.js';\nimport TBNObjectSpacePS from './lit/frag/TBNObjectSpace.js';\nimport textureSamplePS from './standard/frag/textureSample.js';\nimport thicknessPS from './standard/frag/thickness.js';\nimport tonemappingAcesPS from './common/frag/tonemappingAces.js';\nimport tonemappingAces2PS from './common/frag/tonemappingAces2.js';\nimport tonemappingFilmicPS from './common/frag/tonemappingFilmic.js';\nimport tonemappingHejlPS from './common/frag/tonemappingHejl.js';\nimport tonemappingLinearPS from './common/frag/tonemappingLinear.js';\nimport tonemappingNonePS from './common/frag/tonemappingNone.js';\nimport transformVS from './common/vert/transform.js';\nimport transformDeclVS from './common/vert/transformDecl.js';\nimport transmissionPS from './standard/frag/transmission.js';\nimport uv0VS from './lit/vert/uv0.js';\nimport uv1VS from './lit/vert/uv1.js';\nimport viewDirPS from './lit/frag/viewDir.js';\nimport viewNormalVS from './lit/vert/viewNormal.js';\nimport webgpuPS from '../../../platform/graphics/shader-chunks/frag/webgpu.js';\nimport webgpuVS from '../../../platform/graphics/shader-chunks/vert/webgpu.js';\n\nconst shaderChunks = {\n\talphaTestPS,\n\tambientConstantPS,\n\tambientEnvPS,\n\tambientSHPS,\n\taoPS,\n\taoDetailMapPS,\n\taoDiffuseOccPS,\n\taoSpecOccPS,\n\taoSpecOccConstPS,\n\taoSpecOccConstSimplePS,\n\taoSpecOccSimplePS,\n\tbasePS,\n\tbaseVS,\n\tbaseNineSlicedPS,\n\tbaseNineSlicedVS,\n\tbaseNineSlicedTiledPS,\n\tbiasConstPS,\n\tblurVSMPS,\n\tclearCoatPS,\n\tclearCoatGlossPS,\n\tclearCoatNormalPS,\n\tclusteredLightCookiesPS,\n\tclusteredLightShadowsPS,\n\tclusteredLightUtilsPS,\n\tclusteredLightPS,\n\tcombinePS,\n\tcookiePS,\n\tcubeMapProjectBoxPS,\n\tcubeMapProjectNonePS,\n\tcubeMapRotatePS,\n\tdebugOutputPS,\n\tdebugProcessFrontendPS,\n\tdetailModesPS,\n\tdiffusePS,\n\tdiffuseDetailMapPS,\n\tdecodePS,\n\temissivePS,\n\tencodePS,\n\tendPS,\n\tendVS,\n\tenvAtlasPS,\n\tenvConstPS,\n\tenvMultiplyPS,\n\textensionPS,\n\textensionVS,\n\tfalloffInvSquaredPS,\n\tfalloffLinearPS,\n\tfixCubemapSeamsNonePS,\n\tfixCubemapSeamsStretchPS,\n\tfloatUnpackingPS,\n\tfogExpPS,\n\tfogExp2PS,\n\tfogLinearPS,\n\tfogNonePS,\n\tfresnelSchlickPS,\n\tfullscreenQuadPS,\n\tfullscreenQuadVS,\n\tgamma1_0PS,\n\tgamma2_2PS,\n\tgles2PS,\n\tgles3PS,\n\tgles3VS,\n\tglossPS,\n\tiridescenceDiffractionPS,\n\tiridescencePS,\n\tiridescenceThicknessPS,\n\tinstancingVS,\n\tiorPS,\n\tlightDiffuseLambertPS,\n\tlightDirPointPS,\n\tlightmapAddPS,\n\tlightmapDirAddPS,\n\tlightmapDirPS,\n\tlightmapSinglePS,\n\tlightSpecularAnisoGGXPS,\n\tlightSpecularBlinnPS,\n\tlightSpecularPhongPS,\n\tlightSheenPS,\n\tlinearizeDepthPS,\n\tlitShaderArgsPS,\n\tltcPS,\n\tmetalnessPS,\n\tmetalnessModulatePS,\n\tmsdfPS,\n\tmsdfVS,\n\tnormalVS,\n\tnormalDetailMapPS,\n\tnormalInstancedVS,\n\tnormalMapPS,\n\tnormalSkinnedVS,\n\tnormalXYPS,\n\tnormalXYZPS,\n\topacityPS,\n\toutputPS,\n\toutputAlphaPS,\n\toutputAlphaOpaquePS,\n\toutputAlphaPremulPS,\n\toutputTex2DPS,\n\tpackDepthPS,\n\tsheenPS,\n\tsheenGlossPS,\n\tparallaxPS,\n\tparticlePS,\n\tparticleVS,\n\tparticleAnimFrameClampVS,\n\tparticleAnimFrameLoopVS,\n\tparticleAnimTexVS,\n\tparticleInputFloatPS,\n\tparticleInputRgba8PS,\n\tparticleOutputFloatPS,\n\tparticleOutputRgba8PS,\n\tparticleUpdaterAABBPS,\n\tparticleUpdaterEndPS,\n\tparticleUpdaterInitPS,\n\tparticleUpdaterNoRespawnPS,\n\tparticleUpdaterOnStopPS,\n\tparticleUpdaterRespawnPS,\n\tparticleUpdaterSpherePS,\n\tparticleUpdaterStartPS,\n\tparticle_billboardVS,\n\tparticle_blendAddPS,\n\tparticle_blendMultiplyPS,\n\tparticle_blendNormalPS,\n\tparticle_cpuVS,\n\tparticle_cpu_endVS,\n\tparticle_customFaceVS,\n\tparticle_endPS,\n\tparticle_endVS,\n\tparticle_halflambertPS,\n\tparticle_initVS,\n\tparticle_lambertPS,\n\tparticle_lightingPS,\n\tparticle_localShiftVS,\n\tparticle_meshVS,\n\tparticle_normalVS,\n\tparticle_normalMapPS,\n\tparticle_pointAlongVS,\n\tparticle_softPS,\n\tparticle_softVS,\n\tparticle_stretchVS,\n\tparticle_TBNVS,\n\tparticle_wrapVS,\n\treflDirPS,\n\treflDirAnisoPS,\n\treflectionCCPS,\n\treflectionCubePS,\n\treflectionEnvHQPS,\n\treflectionEnvPS,\n\treflectionSpherePS,\n\treflectionSphereLowPS,\n\treflectionSheenPS,\n\trefractionCubePS,\n\trefractionDynamicPS,\n\treprojectPS,\n\tscreenDepthPS,\n\tshadowCascadesPS,\n\tshadowEVSMPS,\n\tshadowEVSMnPS,\n\tshadowPCSSPS,\n\tshadowSampleCoordPS,\n\tshadowStandardPS,\n\tshadowStandardGL2PS,\n\tshadowVSM8PS,\n\tshadowVSM_commonPS,\n\tskinBatchConstVS,\n\tskinBatchTexVS,\n\tskinConstVS,\n\tskinTexVS,\n\tskyboxEnvPS,\n\tskyboxHDRPS,\n\tskyboxVS,\n\tspecularPS,\n\tsphericalPS,\n\tspecularityFactorPS,\n\tspotPS,\n\tstartPS,\n\tstartVS,\n\tstartNineSlicedPS,\n\tstartNineSlicedTiledPS,\n\tstoreEVSMPS,\n\ttangentBinormalVS,\n\tTBNPS,\n\tTBNderivativePS,\n\tTBNfastPS,\n\tTBNObjectSpacePS,\n\ttextureSamplePS,\n\tthicknessPS,\n\ttonemappingAcesPS,\n\ttonemappingAces2PS,\n\ttonemappingFilmicPS,\n\ttonemappingHejlPS,\n\ttonemappingLinearPS,\n\ttonemappingNonePS,\n\ttransformVS,\n\ttransformDeclVS,\n\ttransmissionPS,\n\tuv0VS,\n\tuv1VS,\n\tviewDirPS,\n\tviewNormalVS,\n\twebgpuPS,\n\twebgpuVS\n};\n\nexport { shaderChunks };\n","import '../../core/tracing.js';\nimport { DeviceCache } from '../../platform/graphics/device-cache.js';\n\nconst programLibraryDeviceCache = new DeviceCache();\nfunction getProgramLibrary(device) {\n\tconst library = programLibraryDeviceCache.get(device);\n\treturn library;\n}\nfunction setProgramLibrary(device, library) {\n\tprogramLibraryDeviceCache.get(device, () => {\n\t\treturn library;\n\t});\n}\n\nexport { getProgramLibrary, setProgramLibrary };\n","import { GAMMA_SRGB, GAMMA_SRGBFAST, GAMMA_SRGBHDR, TONEMAP_FILMIC, TONEMAP_LINEAR, TONEMAP_HEJL, TONEMAP_ACES, TONEMAP_ACES2 } from '../../constants.js';\nimport { shaderChunks } from '../chunks/chunks.js';\n\nclass ShaderGenerator {\n\tstatic begin() {\n\t\treturn 'void main(void)\\n{\\n';\n\t}\n\tstatic end() {\n\t\treturn '}\\n';\n\t}\n\tstatic skinCode(device, chunks) {\n\t\tif (!chunks) chunks = shaderChunks;\n\t\tif (device.supportsBoneTextures) {\n\t\t\treturn chunks.skinTexVS;\n\t\t}\n\t\treturn \"#define BONE_LIMIT \" + device.getBoneLimit() + \"\\n\" + chunks.skinConstVS;\n\t}\n\tstatic fogCode(value, chunks) {\n\t\tif (!chunks) chunks = shaderChunks;\n\t\tif (value === 'linear') {\n\t\t\treturn chunks.fogLinearPS ? chunks.fogLinearPS : shaderChunks.fogLinearPS;\n\t\t} else if (value === 'exp') {\n\t\t\treturn chunks.fogExpPS ? chunks.fogExpPS : shaderChunks.fogExpPS;\n\t\t} else if (value === 'exp2') {\n\t\t\treturn chunks.fogExp2PS ? chunks.fogExp2PS : shaderChunks.fogExp2PS;\n\t\t}\n\t\treturn chunks.fogNonePS ? chunks.fogNonePS : shaderChunks.fogNonePS;\n\t}\n\tstatic gammaCode(value, chunks) {\n\t\tif (!chunks) chunks = shaderChunks;\n\t\tif (value === GAMMA_SRGB || value === GAMMA_SRGBFAST) {\n\t\t\treturn chunks.gamma2_2PS ? chunks.gamma2_2PS : shaderChunks.gamma2_2PS;\n\t\t} else if (value === GAMMA_SRGBHDR) {\n\t\t\treturn \"#define HDR\\n\" + (chunks.gamma2_2PS ? chunks.gamma2_2PS : shaderChunks.gamma2_2PS);\n\t\t}\n\t\treturn chunks.gamma1_0PS ? chunks.gamma1_0PS : shaderChunks.gamma1_0PS;\n\t}\n\tstatic tonemapCode(value, chunks) {\n\t\tif (!chunks) chunks = shaderChunks;\n\t\tif (value === TONEMAP_FILMIC) {\n\t\t\treturn chunks.tonemappingFilmicPS ? chunks.tonemappingFilmicPS : shaderChunks.tonemappingFilmicPS;\n\t\t} else if (value === TONEMAP_LINEAR) {\n\t\t\treturn chunks.tonemappingLinearPS ? chunks.tonemappingLinearPS : shaderChunks.tonemappingLinearPS;\n\t\t} else if (value === TONEMAP_HEJL) {\n\t\t\treturn chunks.tonemappingHejlPS ? chunks.tonemappingHejlPS : shaderChunks.tonemappingHejlPS;\n\t\t} else if (value === TONEMAP_ACES) {\n\t\t\treturn chunks.tonemappingAcesPS ? chunks.tonemappingAcesPS : shaderChunks.tonemappingAcesPS;\n\t\t} else if (value === TONEMAP_ACES2) {\n\t\t\treturn chunks.tonemappingAces2PS ? chunks.tonemappingAces2PS : shaderChunks.tonemappingAces2PS;\n\t\t}\n\t\treturn chunks.tonemapingNonePS ? chunks.tonemapingNonePS : shaderChunks.tonemappingNonePS;\n\t}\n}\n\nexport { ShaderGenerator };\n","import { Shader } from '../../platform/graphics/shader.js';\nimport { ShaderUtils } from '../../platform/graphics/shader-utils.js';\nimport { shaderChunks } from './chunks/chunks.js';\nimport { getProgramLibrary } from './get-program-library.js';\nimport '../../core/tracing.js';\nimport { ShaderGenerator } from './programs/shader-generator.js';\n\nfunction createShader(device, vsName, fsName, useTransformFeedback = false) {\n\treturn new Shader(device, ShaderUtils.createDefinition(device, {\n\t\tname: `${vsName}_${fsName}`,\n\t\tvertexCode: shaderChunks[vsName],\n\t\tfragmentCode: shaderChunks[fsName],\n\t\tuseTransformFeedback: useTransformFeedback\n\t}));\n}\nfunction createShaderFromCode(device, vsCode, fsCode, uniqueName, attributes, useTransformFeedback = false) {\n\tconst programLibrary = getProgramLibrary(device);\n\tlet shader = programLibrary.getCachedShader(uniqueName);\n\tif (!shader) {\n\t\tshader = new Shader(device, ShaderUtils.createDefinition(device, {\n\t\t\tname: uniqueName,\n\t\t\tvertexCode: vsCode,\n\t\t\tfragmentCode: fsCode,\n\t\t\tattributes: attributes,\n\t\t\tuseTransformFeedback: useTransformFeedback\n\t\t}));\n\t\tprogramLibrary.setCachedShader(uniqueName, shader);\n\t}\n\treturn shader;\n}\nclass ShaderGeneratorPassThrough extends ShaderGenerator {\n\tconstructor(key, shaderDefinition) {\n\t\tsuper();\n\t\tthis.key = key;\n\t\tthis.shaderDefinition = shaderDefinition;\n\t}\n\tgenerateKey(options) {\n\t\treturn this.key;\n\t}\n\tcreateShaderDefinition(device, options) {\n\t\treturn this.shaderDefinition;\n\t}\n}\nfunction processShader(shader, processingOptions) {\n\tvar _shaderDefinition$nam;\n\tconst shaderDefinition = shader.definition;\n\tconst name = (_shaderDefinition$nam = shaderDefinition.name) != null ? _shaderDefinition$nam : 'shader';\n\tconst key = `${name}-id-${shader.id}`;\n\tconst materialGenerator = new ShaderGeneratorPassThrough(key, shaderDefinition);\n\tconst libraryModuleName = 'shader';\n\tconst library = getProgramLibrary(shader.device);\n\tlibrary.register(libraryModuleName, materialGenerator);\n\tconst variant = library.getProgram(libraryModuleName, {}, processingOptions);\n\tlibrary.unregister(libraryModuleName);\n\treturn variant;\n}\nshaderChunks.createShader = createShader;\nshaderChunks.createShaderFromCode = createShaderFromCode;\n\nexport { createShader, createShaderFromCode, processShader };\n","import '../../core/tracing.js';\nimport { Vec4 } from '../../core/math/vec4.js';\nimport { BindGroup } from '../../platform/graphics/bind-group.js';\nimport { BINDGROUP_MESH, PRIMITIVE_TRISTRIP } from '../../platform/graphics/constants.js';\nimport { ShaderProcessorOptions } from '../../platform/graphics/shader-processor-options.js';\nimport { UniformBuffer } from '../../platform/graphics/uniform-buffer.js';\nimport { processShader } from '../shader-lib/utils.js';\n\nconst _quadPrimitive = {\n\ttype: PRIMITIVE_TRISTRIP,\n\tbase: 0,\n\tcount: 4,\n\tindexed: false\n};\nconst _tempViewport = new Vec4();\nconst _tempScissor = new Vec4();\nclass QuadRender {\n\tconstructor(shader) {\n\t\tthis.uniformBuffer = void 0;\n\t\tthis.bindGroup = void 0;\n\t\tconst device = shader.device;\n\t\tthis.shader = shader;\n\t\tif (device.supportsUniformBuffers) {\n\t\t\tconst processingOptions = new ShaderProcessorOptions();\n\t\t\tthis.shader = processShader(shader, processingOptions);\n\t\t\tconst ubFormat = this.shader.meshUniformBufferFormat;\n\t\t\tif (ubFormat) {\n\t\t\t\tthis.uniformBuffer = new UniformBuffer(device, ubFormat, false);\n\t\t\t}\n\t\t\tconst bindGroupFormat = this.shader.meshBindGroupFormat;\n\t\t\tthis.bindGroup = new BindGroup(device, bindGroupFormat, this.uniformBuffer);\n\t\t}\n\t}\n\tdestroy() {\n\t\tvar _this$uniformBuffer, _this$bindGroup;\n\t\t(_this$uniformBuffer = this.uniformBuffer) == null || _this$uniformBuffer.destroy();\n\t\tthis.uniformBuffer = null;\n\t\t(_this$bindGroup = this.bindGroup) == null || _this$bindGroup.destroy();\n\t\tthis.bindGroup = null;\n\t}\n\trender(viewport, scissor) {\n\t\tconst device = this.shader.device;\n\t\tif (viewport) {\n\t\t\tvar _scissor;\n\t\t\t_tempViewport.set(device.vx, device.vy, device.vw, device.vh);\n\t\t\t_tempScissor.set(device.sx, device.sy, device.sw, device.sh);\n\t\t\tscissor = (_scissor = scissor) != null ? _scissor : viewport;\n\t\t\tdevice.setViewport(viewport.x, viewport.y, viewport.z, viewport.w);\n\t\t\tdevice.setScissor(scissor.x, scissor.y, scissor.z, scissor.w);\n\t\t}\n\t\tdevice.setVertexBuffer(device.quadVertexBuffer, 0);\n\t\tconst shader = this.shader;\n\t\tdevice.setShader(shader);\n\t\tif (device.supportsUniformBuffers) {\n\t\t\tvar _bindGroup$defaultUni;\n\t\t\tconst bindGroup = this.bindGroup;\n\t\t\t(_bindGroup$defaultUni = bindGroup.defaultUniformBuffer) == null || _bindGroup$defaultUni.update();\n\t\t\tbindGroup.update();\n\t\t\tdevice.setBindGroup(BINDGROUP_MESH, bindGroup);\n\t\t}\n\t\tdevice.draw(_quadPrimitive);\n\t\tif (viewport) {\n\t\t\tdevice.setViewport(_tempViewport.x, _tempViewport.y, _tempViewport.z, _tempViewport.w);\n\t\t\tdevice.setScissor(_tempScissor.x, _tempScissor.y, _tempScissor.z, _tempScissor.w);\n\t\t}\n\t}\n}\n\nexport { QuadRender };\n","import { CULLFACE_NONE } from '../../platform/graphics/constants.js';\nimport { DepthState } from '../../platform/graphics/depth-state.js';\nimport { RenderPass } from '../../platform/graphics/render-pass.js';\n\nclass RenderPassQuad extends RenderPass {\n\tconstructor(device, quad, rect, scissorRect) {\n\t\tsuper(device);\n\t\tthis.quad = quad;\n\t\tthis.rect = rect;\n\t\tthis.scissorRect = scissorRect;\n\t}\n\texecute() {\n\t\tconst {\n\t\t\tdevice\n\t\t} = this;\n\t\tdevice.setCullMode(CULLFACE_NONE);\n\t\tdevice.setDepthState(DepthState.NODEPTH);\n\t\tdevice.setStencilState(null, null);\n\t\tthis.quad.render(this.rect, this.scissorRect);\n\t}\n}\n\nexport { RenderPassQuad };\n","import '../../core/tracing.js';\nimport { Vec4 } from '../../core/math/vec4.js';\nimport { QuadRender } from './quad-render.js';\nimport { RenderPassQuad } from './render-pass-quad.js';\n\nconst _tempRect = new Vec4();\nfunction drawQuadWithShader(device, target, shader, rect, scissorRect) {\n\tconst quad = new QuadRender(shader);\n\tif (!rect) {\n\t\trect = _tempRect;\n\t\trect.x = 0;\n\t\trect.y = 0;\n\t\trect.z = target ? target.width : device.width;\n\t\trect.w = target ? target.height : device.height;\n\t}\n\tconst renderPass = new RenderPassQuad(device, quad, rect, scissorRect);\n\trenderPass.init(target);\n\trenderPass.colorOps.clear = false;\n\trenderPass.depthStencilOps.clearDepth = false;\n\tif (device.isWebGPU && target === null && device.samples > 1) {\n\t\trenderPass.colorOps.store = true;\n\t}\n\trenderPass.render();\n\tquad.destroy();\n}\nfunction drawTexture(device, texture, target, shader, rect, scissorRect) {\n\tshader = shader || device.getCopyShader();\n\tdevice.constantTexSource.setValue(texture);\n\tdrawQuadWithShader(device, target, shader, rect, scissorRect);\n}\n\nexport { drawQuadWithShader, drawTexture };\n","import '../core/tracing.js';\nimport { SHADER_DEPTH, SHADER_PICK, SHADER_FORWARD, SHADER_FORWARDHDR } from './constants.js';\nimport { DeviceCache } from '../platform/graphics/device-cache.js';\n\nconst shaderPassDeviceCache = new DeviceCache();\nclass ShaderPassInfo {\n\tconstructor(name, index, options = {}) {\n\t\tthis.index = void 0;\n\t\tthis.name = void 0;\n\t\tthis.shaderDefine = void 0;\n\t\tthis.name = name;\n\t\tthis.index = index;\n\t\tObject.assign(this, options);\n\t\tthis.initShaderDefines();\n\t}\n\tinitShaderDefines() {\n\t\tlet keyword;\n\t\tif (this.isShadow) {\n\t\t\tkeyword = 'SHADOW';\n\t\t} else if (this.isForward) {\n\t\t\tkeyword = 'FORWARD';\n\t\t} else if (this.index === SHADER_DEPTH) {\n\t\t\tkeyword = 'DEPTH';\n\t\t} else if (this.index === SHADER_PICK) {\n\t\t\tkeyword = 'PICK';\n\t\t}\n\t\tconst define1 = keyword ? `#define ${keyword}_PASS\\n` : '';\n\t\tconst define2 = `#define ${this.name.toUpperCase()}_PASS\\n`;\n\t\tthis.shaderDefines = define1 + define2;\n\t}\n}\nclass ShaderPass {\n\tconstructor() {\n\t\tthis.passesNamed = new Map();\n\t\tthis.passesIndexed = [];\n\t\tthis.nextIndex = 0;\n\t\tconst add = (name, index, options) => {\n\t\t\tthis.allocate(name, options);\n\t\t};\n\t\tadd('forward', SHADER_FORWARD, {\n\t\t\tisForward: true\n\t\t});\n\t\tadd('forward_hdr', SHADER_FORWARDHDR, {\n\t\t\tisForward: true\n\t\t});\n\t\tadd('depth');\n\t\tadd('pick');\n\t\tadd('shadow');\n\t}\n\tstatic get(device) {\n\t\treturn shaderPassDeviceCache.get(device, () => {\n\t\t\treturn new ShaderPass();\n\t\t});\n\t}\n\tallocate(name, options) {\n\t\tlet info = this.passesNamed.get(name);\n\t\tif (info === undefined) {\n\t\t\tinfo = new ShaderPassInfo(name, this.nextIndex, options);\n\t\t\tthis.passesNamed.set(info.name, info);\n\t\t\tthis.passesIndexed[info.index] = info;\n\t\t\tthis.nextIndex++;\n\t\t}\n\t\treturn info;\n\t}\n\tgetByIndex(index) {\n\t\tconst info = this.passesIndexed[index];\n\t\treturn info;\n\t}\n\tgetByName(name) {\n\t\treturn this.passesNamed.get(name);\n\t}\n}\n\nexport { ShaderPass, ShaderPassInfo };\n","import { SEMANTIC_POSITION, SEMANTIC_BLENDWEIGHT, SEMANTIC_BLENDINDICES, SEMANTIC_COLOR, SEMANTIC_TEXCOORD0 } from '../../../platform/graphics/constants.js';\nimport { ShaderUtils } from '../../../platform/graphics/shader-utils.js';\nimport { shaderChunks } from '../chunks/chunks.js';\nimport { SHADER_DEPTH, SHADER_PICK } from '../../constants.js';\nimport { ShaderPass } from '../../shader-pass.js';\nimport { ShaderGenerator } from './shader-generator.js';\n\nclass ShaderGeneratorBasic extends ShaderGenerator {\n\tgenerateKey(options) {\n\t\tlet key = 'basic';\n\t\tif (options.fog) key += '_fog';\n\t\tif (options.alphaTest) key += '_atst';\n\t\tif (options.vertexColors) key += '_vcol';\n\t\tif (options.diffuseMap) key += '_diff';\n\t\tif (options.skin) key += '_skin';\n\t\tif (options.screenSpace) key += '_ss';\n\t\tif (options.useInstancing) key += '_inst';\n\t\tif (options.useMorphPosition) key += '_morphp';\n\t\tif (options.useMorphNormal) key += '_morphn';\n\t\tif (options.useMorphTextureBased) key += '_morpht';\n\t\tkey += '_' + options.pass;\n\t\treturn key;\n\t}\n\tcreateShaderDefinition(device, options) {\n\t\tconst attributes = {\n\t\t\tvertex_position: SEMANTIC_POSITION\n\t\t};\n\t\tif (options.skin) {\n\t\t\tattributes.vertex_boneWeights = SEMANTIC_BLENDWEIGHT;\n\t\t\tattributes.vertex_boneIndices = SEMANTIC_BLENDINDICES;\n\t\t}\n\t\tif (options.vertexColors) {\n\t\t\tattributes.vertex_color = SEMANTIC_COLOR;\n\t\t}\n\t\tif (options.diffuseMap) {\n\t\t\tattributes.vertex_texCoord0 = SEMANTIC_TEXCOORD0;\n\t\t}\n\t\tconst shaderPassInfo = ShaderPass.get(device).getByIndex(options.pass);\n\t\tconst shaderPassDefines = shaderPassInfo.shaderDefines;\n\t\tlet vshader = shaderPassDefines;\n\t\tvshader += shaderChunks.transformDeclVS;\n\t\tif (options.skin) {\n\t\t\tvshader += ShaderGenerator.skinCode(device);\n\t\t\tvshader += shaderChunks.transformSkinnedVS;\n\t\t} else {\n\t\t\tvshader += shaderChunks.transformVS;\n\t\t}\n\t\tif (options.vertexColors) {\n\t\t\tvshader += 'attribute vec4 vertex_color;\\n';\n\t\t\tvshader += 'varying vec4 vColor;\\n';\n\t\t}\n\t\tif (options.diffuseMap) {\n\t\t\tvshader += 'attribute vec2 vertex_texCoord0;\\n';\n\t\t\tvshader += 'varying vec2 vUv0;\\n';\n\t\t}\n\t\tif (options.pass === SHADER_DEPTH) {\n\t\t\tvshader += 'varying float vDepth;\\n';\n\t\t\tvshader += '#ifndef VIEWMATRIX\\n';\n\t\t\tvshader += '#define VIEWMATRIX\\n';\n\t\t\tvshader += 'uniform mat4 matrix_view;\\n';\n\t\t\tvshader += '#endif\\n';\n\t\t\tvshader += '#ifndef CAMERAPLANES\\n';\n\t\t\tvshader += '#define CAMERAPLANES\\n';\n\t\t\tvshader += 'uniform vec4 camera_params;\\n\\n';\n\t\t\tvshader += '#endif\\n';\n\t\t}\n\t\tvshader += ShaderGenerator.begin();\n\t\tvshader += \"   gl_Position = getPosition();\\n\";\n\t\tif (options.pass === SHADER_DEPTH) {\n\t\t\tvshader += \"    vDepth = -(matrix_view * vec4(getWorldPosition(),1.0)).z * camera_params.x;\\n\";\n\t\t}\n\t\tif (options.vertexColors) {\n\t\t\tvshader += '    vColor = vertex_color;\\n';\n\t\t}\n\t\tif (options.diffuseMap) {\n\t\t\tvshader += '    vUv0 = vertex_texCoord0;\\n';\n\t\t}\n\t\tvshader += ShaderGenerator.end();\n\t\tlet fshader = shaderPassDefines;\n\t\tif (options.vertexColors) {\n\t\t\tfshader += 'varying vec4 vColor;\\n';\n\t\t} else {\n\t\t\tfshader += 'uniform vec4 uColor;\\n';\n\t\t}\n\t\tif (options.diffuseMap) {\n\t\t\tfshader += 'varying vec2 vUv0;\\n';\n\t\t\tfshader += 'uniform sampler2D texture_diffuseMap;\\n';\n\t\t}\n\t\tif (options.fog) {\n\t\t\tfshader += ShaderGenerator.fogCode(options.fog);\n\t\t}\n\t\tif (options.alphaTest) {\n\t\t\tfshader += shaderChunks.alphaTestPS;\n\t\t}\n\t\tif (options.pass === SHADER_DEPTH) {\n\t\t\tfshader += 'varying float vDepth;\\n';\n\t\t\tfshader += shaderChunks.packDepthPS;\n\t\t}\n\t\tfshader += ShaderGenerator.begin();\n\t\tif (options.vertexColors) {\n\t\t\tfshader += '    gl_FragColor = vColor;\\n';\n\t\t} else {\n\t\t\tfshader += '    gl_FragColor = uColor;\\n';\n\t\t}\n\t\tif (options.diffuseMap) {\n\t\t\tfshader += '    gl_FragColor *= texture2D(texture_diffuseMap, vUv0);\\n';\n\t\t}\n\t\tif (options.alphaTest) {\n\t\t\tfshader += \"   alphaTest(gl_FragColor.a);\\n\";\n\t\t}\n\t\tif (options.pass !== SHADER_PICK) {\n\t\t\tif (options.pass === SHADER_DEPTH) {\n\t\t\t\tfshader += \"    gl_FragColor = packFloat(vDepth);\\n\";\n\t\t\t} else {\n\t\t\t\tif (options.fog) {\n\t\t\t\t\tfshader += \"   glFragColor.rgb = addFog(gl_FragColor.rgb);\\n\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfshader += ShaderGenerator.end();\n\t\treturn ShaderUtils.createDefinition(device, {\n\t\t\tname: 'BasicShader',\n\t\t\tattributes: attributes,\n\t\t\tvertexCode: vshader,\n\t\t\tfragmentCode: fshader\n\t\t});\n\t}\n}\nconst basic = new ShaderGeneratorBasic();\n\nexport { basic };\n","import '../../core/tracing.js';\nimport { DeviceCache } from '../../platform/graphics/device-cache.js';\n\nconst defaultMaterialDeviceCache = new DeviceCache();\nfunction getDefaultMaterial(device) {\n\tconst material = defaultMaterialDeviceCache.get(device);\n\treturn material;\n}\nfunction setDefaultMaterial(device, material) {\n\tdefaultMaterialDeviceCache.get(device, () => {\n\t\treturn material;\n\t});\n}\n\nexport { getDefaultMaterial, setDefaultMaterial };\n","import '../../core/tracing.js';\nimport { CULLFACE_BACK, BLENDMODE_ONE, BLENDEQUATION_REVERSE_SUBTRACT, BLENDMODE_ZERO, BLENDEQUATION_ADD, BLENDMODE_SRC_ALPHA, BLENDMODE_ONE_MINUS_SRC_ALPHA, BLENDMODE_DST_COLOR, BLENDMODE_SRC_COLOR, BLENDMODE_ONE_MINUS_DST_COLOR, BLENDEQUATION_MIN, BLENDEQUATION_MAX } from '../../platform/graphics/constants.js';\nimport { BlendState } from '../../platform/graphics/blend-state.js';\nimport { DepthState } from '../../platform/graphics/depth-state.js';\nimport { ShaderProcessorOptions } from '../../platform/graphics/shader-processor-options.js';\nimport { BLEND_NONE, BLEND_NORMAL, BLEND_SUBTRACTIVE, BLEND_PREMULTIPLIED, BLEND_ADDITIVE, BLEND_ADDITIVEALPHA, BLEND_MULTIPLICATIVE2X, BLEND_SCREEN, BLEND_MULTIPLICATIVE, BLEND_MIN, BLEND_MAX } from '../constants.js';\nimport { processShader } from '../shader-lib/utils.js';\nimport { getDefaultMaterial } from './default-material.js';\n\nconst blendModes = [];\nblendModes[BLEND_SUBTRACTIVE] = {\n\tsrc: BLENDMODE_ONE,\n\tdst: BLENDMODE_ONE,\n\top: BLENDEQUATION_REVERSE_SUBTRACT\n};\nblendModes[BLEND_NONE] = {\n\tsrc: BLENDMODE_ONE,\n\tdst: BLENDMODE_ZERO,\n\top: BLENDEQUATION_ADD\n};\nblendModes[BLEND_NORMAL] = {\n\tsrc: BLENDMODE_SRC_ALPHA,\n\tdst: BLENDMODE_ONE_MINUS_SRC_ALPHA,\n\top: BLENDEQUATION_ADD\n};\nblendModes[BLEND_PREMULTIPLIED] = {\n\tsrc: BLENDMODE_ONE,\n\tdst: BLENDMODE_ONE_MINUS_SRC_ALPHA,\n\top: BLENDEQUATION_ADD\n};\nblendModes[BLEND_ADDITIVE] = {\n\tsrc: BLENDMODE_ONE,\n\tdst: BLENDMODE_ONE,\n\top: BLENDEQUATION_ADD\n};\nblendModes[BLEND_ADDITIVEALPHA] = {\n\tsrc: BLENDMODE_SRC_ALPHA,\n\tdst: BLENDMODE_ONE,\n\top: BLENDEQUATION_ADD\n};\nblendModes[BLEND_MULTIPLICATIVE2X] = {\n\tsrc: BLENDMODE_DST_COLOR,\n\tdst: BLENDMODE_SRC_COLOR,\n\top: BLENDEQUATION_ADD\n};\nblendModes[BLEND_SCREEN] = {\n\tsrc: BLENDMODE_ONE_MINUS_DST_COLOR,\n\tdst: BLENDMODE_ONE,\n\top: BLENDEQUATION_ADD\n};\nblendModes[BLEND_MULTIPLICATIVE] = {\n\tsrc: BLENDMODE_DST_COLOR,\n\tdst: BLENDMODE_ZERO,\n\top: BLENDEQUATION_ADD\n};\nblendModes[BLEND_MIN] = {\n\tsrc: BLENDMODE_ONE,\n\tdst: BLENDMODE_ONE,\n\top: BLENDEQUATION_MIN\n};\nblendModes[BLEND_MAX] = {\n\tsrc: BLENDMODE_ONE,\n\tdst: BLENDMODE_ONE,\n\top: BLENDEQUATION_MAX\n};\nlet id = 0;\nclass Material {\n\tconstructor() {\n\t\tthis._shader = null;\n\t\tthis.meshInstances = [];\n\t\tthis.name = 'Untitled';\n\t\tthis.userId = '';\n\t\tthis.id = id++;\n\t\tthis.variants = new Map();\n\t\tthis.parameters = {};\n\t\tthis.alphaTest = 0;\n\t\tthis.alphaToCoverage = false;\n\t\tthis._blendState = new BlendState();\n\t\tthis._depthState = new DepthState();\n\t\tthis.cull = CULLFACE_BACK;\n\t\tthis.stencilFront = null;\n\t\tthis.stencilBack = null;\n\t\tthis.depthBias = 0;\n\t\tthis.slopeDepthBias = 0;\n\t\tthis._shaderVersion = 0;\n\t\tthis._scene = null;\n\t\tthis.dirty = true;\n\t}\n\tset redWrite(value) {\n\t\tthis._blendState.redWrite = value;\n\t}\n\tget redWrite() {\n\t\treturn this._blendState.redWrite;\n\t}\n\tset greenWrite(value) {\n\t\tthis._blendState.greenWrite = value;\n\t}\n\tget greenWrite() {\n\t\treturn this._blendState.greenWrite;\n\t}\n\tset blueWrite(value) {\n\t\tthis._blendState.blueWrite = value;\n\t}\n\tget blueWrite() {\n\t\treturn this._blendState.blueWrite;\n\t}\n\tset alphaWrite(value) {\n\t\tthis._blendState.alphaWrite = value;\n\t}\n\tget alphaWrite() {\n\t\treturn this._blendState.alphaWrite;\n\t}\n\tset shader(shader) {\n\t\tthis._shader = shader;\n\t}\n\tget shader() {\n\t\treturn this._shader;\n\t}\n\tget transparent() {\n\t\treturn this._blendState.blend;\n\t}\n\t_updateTransparency() {\n\t\tconst transparent = this.transparent;\n\t\tconst meshInstances = this.meshInstances;\n\t\tfor (let i = 0; i < meshInstances.length; i++) {\n\t\t\tmeshInstances[i].transparent = transparent;\n\t\t}\n\t}\n\tset blendState(value) {\n\t\tthis._blendState.copy(value);\n\t\tthis._updateTransparency();\n\t}\n\tget blendState() {\n\t\treturn this._blendState;\n\t}\n\tset blendType(type) {\n\t\tconst blendMode = blendModes[type];\n\t\tthis._blendState.setColorBlend(blendMode.op, blendMode.src, blendMode.dst);\n\t\tthis._blendState.setAlphaBlend(blendMode.op, blendMode.src, blendMode.dst);\n\t\tconst blend = type !== BLEND_NONE;\n\t\tif (this._blendState.blend !== blend) {\n\t\t\tthis._blendState.blend = blend;\n\t\t\tthis._updateTransparency();\n\t\t}\n\t\tthis._updateMeshInstanceKeys();\n\t}\n\tget blendType() {\n\t\tif (!this.transparent) {\n\t\t\treturn BLEND_NONE;\n\t\t}\n\t\tconst {\n\t\t\tcolorOp,\n\t\t\tcolorSrcFactor,\n\t\t\tcolorDstFactor,\n\t\t\talphaOp,\n\t\t\talphaSrcFactor,\n\t\t\talphaDstFactor\n\t\t} = this._blendState;\n\t\tfor (let i = 0; i < blendModes.length; i++) {\n\t\t\tconst blendMode = blendModes[i];\n\t\t\tif (blendMode.src === colorSrcFactor && blendMode.dst === colorDstFactor && blendMode.op === colorOp && blendMode.src === alphaSrcFactor && blendMode.dst === alphaDstFactor && blendMode.op === alphaOp) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn BLEND_NORMAL;\n\t}\n\tset depthState(value) {\n\t\tthis._depthState.copy(value);\n\t}\n\tget depthState() {\n\t\treturn this._depthState;\n\t}\n\tset depthTest(value) {\n\t\tthis._depthState.test = value;\n\t}\n\tget depthTest() {\n\t\treturn this._depthState.test;\n\t}\n\tset depthFunc(value) {\n\t\tthis._depthState.func = value;\n\t}\n\tget depthFunc() {\n\t\treturn this._depthState.func;\n\t}\n\tset depthWrite(value) {\n\t\tthis._depthState.write = value;\n\t}\n\tget depthWrite() {\n\t\treturn this._depthState.write;\n\t}\n\tcopy(source) {\n\t\tvar _source$stencilFront;\n\t\tthis.name = source.name;\n\t\tthis._shader = source._shader;\n\t\tthis.alphaTest = source.alphaTest;\n\t\tthis.alphaToCoverage = source.alphaToCoverage;\n\t\tthis._blendState.copy(source._blendState);\n\t\tthis._depthState.copy(source._depthState);\n\t\tthis.cull = source.cull;\n\t\tthis.depthBias = source.depthBias;\n\t\tthis.slopeDepthBias = source.slopeDepthBias;\n\t\tthis.stencilFront = (_source$stencilFront = source.stencilFront) == null ? void 0 : _source$stencilFront.clone();\n\t\tif (source.stencilBack) {\n\t\t\tthis.stencilBack = source.stencilFront === source.stencilBack ? this.stencilFront : source.stencilBack.clone();\n\t\t}\n\t\treturn this;\n\t}\n\tclone() {\n\t\tconst clone = new this.constructor();\n\t\treturn clone.copy(this);\n\t}\n\t_updateMeshInstanceKeys() {\n\t\tconst meshInstances = this.meshInstances;\n\t\tfor (let i = 0; i < meshInstances.length; i++) {\n\t\t\tmeshInstances[i].updateKey();\n\t\t}\n\t}\n\tupdateUniforms(device, scene) {}\n\tgetShaderVariant(device, scene, objDefs, unused, pass, sortedLights, viewUniformFormat, viewBindGroupFormat, vertexFormat) {\n\t\tconst processingOptions = new ShaderProcessorOptions(viewUniformFormat, viewBindGroupFormat, vertexFormat);\n\t\treturn processShader(this._shader, processingOptions);\n\t}\n\tupdate() {\n\t\tthis.dirty = true;\n\t\tif (this._shader) this._shader.failed = false;\n\t}\n\tclearParameters() {\n\t\tthis.parameters = {};\n\t}\n\tgetParameters() {\n\t\treturn this.parameters;\n\t}\n\tclearVariants() {\n\t\tthis.variants.clear();\n\t\tconst meshInstances = this.meshInstances;\n\t\tconst count = meshInstances.length;\n\t\tfor (let i = 0; i < count; i++) {\n\t\t\tmeshInstances[i].clearShaders();\n\t\t}\n\t}\n\tgetParameter(name) {\n\t\treturn this.parameters[name];\n\t}\n\tsetParameter(name, data) {\n\t\tif (data === undefined && typeof name === 'object') {\n\t\t\tconst uniformObject = name;\n\t\t\tif (uniformObject.length) {\n\t\t\t\tfor (let i = 0; i < uniformObject.length; i++) {\n\t\t\t\t\tthis.setParameter(uniformObject[i]);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tname = uniformObject.name;\n\t\t\tdata = uniformObject.value;\n\t\t}\n\t\tconst param = this.parameters[name];\n\t\tif (param) {\n\t\t\tparam.data = data;\n\t\t} else {\n\t\t\tthis.parameters[name] = {\n\t\t\t\tscopeId: null,\n\t\t\t\tdata: data\n\t\t\t};\n\t\t}\n\t}\n\tdeleteParameter(name) {\n\t\tif (this.parameters[name]) {\n\t\t\tdelete this.parameters[name];\n\t\t}\n\t}\n\tsetParameters(device, names) {\n\t\tconst parameters = this.parameters;\n\t\tif (names === undefined) names = parameters;\n\t\tfor (const paramName in names) {\n\t\t\tconst parameter = parameters[paramName];\n\t\t\tif (parameter) {\n\t\t\t\tif (!parameter.scopeId) {\n\t\t\t\t\tparameter.scopeId = device.scope.resolve(paramName);\n\t\t\t\t}\n\t\t\t\tparameter.scopeId.setValue(parameter.data);\n\t\t\t}\n\t\t}\n\t}\n\tdestroy() {\n\t\tthis.variants.clear();\n\t\tthis._shader = null;\n\t\tfor (let i = 0; i < this.meshInstances.length; i++) {\n\t\t\tconst meshInstance = this.meshInstances[i];\n\t\t\tmeshInstance.clearShaders();\n\t\t\tmeshInstance._material = null;\n\t\t\tif (meshInstance.mesh) {\n\t\t\t\tconst defaultMaterial = getDefaultMaterial(meshInstance.mesh.device);\n\t\t\t\tif (this !== defaultMaterial) {\n\t\t\t\t\tmeshInstance.material = defaultMaterial;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.meshInstances.length = 0;\n\t}\n\taddMeshInstanceRef(meshInstance) {\n\t\tthis.meshInstances.push(meshInstance);\n\t}\n\tremoveMeshInstanceRef(meshInstance) {\n\t\tconst meshInstances = this.meshInstances;\n\t\tconst i = meshInstances.indexOf(meshInstance);\n\t\tif (i !== -1) {\n\t\t\tmeshInstances.splice(i, 1);\n\t\t}\n\t}\n}\n\nexport { Material };\n","import { Color } from '../../core/math/color.js';\nimport { ShaderProcessorOptions } from '../../platform/graphics/shader-processor-options.js';\nimport { SHADERDEF_SKIN, SHADERDEF_SCREENSPACE, SHADERDEF_INSTANCING, SHADERDEF_MORPH_POSITION, SHADERDEF_MORPH_NORMAL, SHADERDEF_MORPH_TEXTURE_BASED } from '../constants.js';\nimport { getProgramLibrary } from '../shader-lib/get-program-library.js';\nimport { basic } from '../shader-lib/programs/basic.js';\nimport { Material } from './material.js';\n\nclass BasicMaterial extends Material {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\t\tthis.color = new Color(1, 1, 1, 1);\n\t\tthis.colorUniform = new Float32Array(4);\n\t\tthis.colorMap = null;\n\t\tthis.vertexColors = false;\n\t}\n\tcopy(source) {\n\t\tsuper.copy(source);\n\t\tthis.color.copy(source.color);\n\t\tthis.colorMap = source.colorMap;\n\t\tthis.vertexColors = source.vertexColors;\n\t\treturn this;\n\t}\n\tupdateUniforms(device, scene) {\n\t\tthis.clearParameters();\n\t\tthis.colorUniform[0] = this.color.r;\n\t\tthis.colorUniform[1] = this.color.g;\n\t\tthis.colorUniform[2] = this.color.b;\n\t\tthis.colorUniform[3] = this.color.a;\n\t\tthis.setParameter('uColor', this.colorUniform);\n\t\tif (this.colorMap) {\n\t\t\tthis.setParameter('texture_diffuseMap', this.colorMap);\n\t\t}\n\t}\n\tgetShaderVariant(device, scene, objDefs, unused, pass, sortedLights, viewUniformFormat, viewBindGroupFormat, vertexFormat) {\n\t\tconst options = {\n\t\t\tskin: objDefs && (objDefs & SHADERDEF_SKIN) !== 0,\n\t\t\tscreenSpace: objDefs && (objDefs & SHADERDEF_SCREENSPACE) !== 0,\n\t\t\tuseInstancing: objDefs && (objDefs & SHADERDEF_INSTANCING) !== 0,\n\t\t\tuseMorphPosition: objDefs && (objDefs & SHADERDEF_MORPH_POSITION) !== 0,\n\t\t\tuseMorphNormal: objDefs && (objDefs & SHADERDEF_MORPH_NORMAL) !== 0,\n\t\t\tuseMorphTextureBased: objDefs && (objDefs & SHADERDEF_MORPH_TEXTURE_BASED) !== 0,\n\t\t\talphaTest: this.alphaTest > 0,\n\t\t\tvertexColors: this.vertexColors,\n\t\t\tdiffuseMap: !!this.colorMap,\n\t\t\tpass: pass\n\t\t};\n\t\tconst processingOptions = new ShaderProcessorOptions(viewUniformFormat, viewBindGroupFormat, vertexFormat);\n\t\tconst library = getProgramLibrary(device);\n\t\tlibrary.register('basic', basic);\n\t\treturn library.getProgram('basic', options, processingOptions, this.userId);\n\t}\n}\n\nexport { BasicMaterial };\n","import { BoundingBox } from '../../core/shape/bounding-box.js';\n\nclass Batch {\n\tconstructor(meshInstances, dynamic, batchGroupId) {\n\t\tthis._aabb = new BoundingBox();\n\t\tthis.origMeshInstances = void 0;\n\t\tthis.meshInstance = null;\n\t\tthis.dynamic = void 0;\n\t\tthis.batchGroupId = void 0;\n\t\tthis.origMeshInstances = meshInstances;\n\t\tthis.dynamic = dynamic;\n\t\tthis.batchGroupId = batchGroupId;\n\t}\n\tdestroy(scene, layers) {\n\t\tif (this.meshInstance) {\n\t\t\tthis.removeFromLayers(scene, layers);\n\t\t\tthis.meshInstance.destroy();\n\t\t\tthis.meshInstance = null;\n\t\t}\n\t}\n\taddToLayers(scene, layers) {\n\t\tfor (let i = 0; i < layers.length; i++) {\n\t\t\tconst layer = scene.layers.getLayerById(layers[i]);\n\t\t\tif (layer) {\n\t\t\t\tlayer.addMeshInstances([this.meshInstance]);\n\t\t\t}\n\t\t}\n\t}\n\tremoveFromLayers(scene, layers) {\n\t\tfor (let i = 0; i < layers.length; i++) {\n\t\t\tconst layer = scene.layers.getLayerById(layers[i]);\n\t\t\tif (layer) {\n\t\t\t\tlayer.removeMeshInstances([this.meshInstance]);\n\t\t\t}\n\t\t}\n\t}\n\tupdateBoundingBox() {\n\t\tthis._aabb.copy(this.origMeshInstances[0].aabb);\n\t\tfor (let i = 1; i < this.origMeshInstances.length; i++) {\n\t\t\tthis._aabb.add(this.origMeshInstances[i].aabb);\n\t\t}\n\t\tthis.meshInstance.aabb = this._aabb;\n\t\tthis.meshInstance._aabbVer = 0;\n\t}\n}\n\nexport { Batch };\n","import { LAYERID_WORLD } from '../constants.js';\n\nclass BatchGroup {\n\tconstructor(id, name, dynamic, maxAabbSize, layers = [LAYERID_WORLD]) {\n\t\tthis._ui = false;\n\t\tthis._sprite = false;\n\t\tthis._obj = {\n\t\t\tmodel: [],\n\t\t\telement: [],\n\t\t\tsprite: [],\n\t\t\trender: []\n\t\t};\n\t\tthis.id = void 0;\n\t\tthis.name = void 0;\n\t\tthis.dynamic = void 0;\n\t\tthis.maxAabbSize = void 0;\n\t\tthis.layers = void 0;\n\t\tthis.id = id;\n\t\tthis.name = name;\n\t\tthis.dynamic = dynamic;\n\t\tthis.maxAabbSize = maxAabbSize;\n\t\tthis.layers = layers;\n\t}\n}\nBatchGroup.MODEL = 'model';\nBatchGroup.ELEMENT = 'element';\nBatchGroup.SPRITE = 'sprite';\nBatchGroup.RENDER = 'render';\n\nexport { BatchGroup };\n","import '../core/tracing.js';\nimport { math } from '../core/math/math.js';\nimport { Mat4 } from '../core/math/mat4.js';\nimport { PIXELFORMAT_RGBA32F, FILTER_NEAREST } from '../platform/graphics/constants.js';\nimport { Texture } from '../platform/graphics/texture.js';\n\nconst _invMatrix = new Mat4();\nclass SkinInstance {\n\tconstructor(skin) {\n\t\tthis.bones = void 0;\n\t\tthis._dirty = true;\n\t\tthis._rootBone = null;\n\t\tthis._skinUpdateIndex = -1;\n\t\tthis._updateBeforeCull = true;\n\t\tif (skin) {\n\t\t\tthis.initSkin(skin);\n\t\t}\n\t}\n\tset rootBone(rootBone) {\n\t\tthis._rootBone = rootBone;\n\t}\n\tget rootBone() {\n\t\treturn this._rootBone;\n\t}\n\tinit(device, numBones) {\n\t\tif (device.supportsBoneTextures) {\n\t\t\tconst numPixels = numBones * 3;\n\t\t\tlet width = Math.ceil(Math.sqrt(numPixels));\n\t\t\twidth = math.roundUp(width, 3);\n\t\t\tconst height = Math.ceil(numPixels / width);\n\t\t\tthis.boneTexture = new Texture(device, {\n\t\t\t\twidth: width,\n\t\t\t\theight: height,\n\t\t\t\tformat: PIXELFORMAT_RGBA32F,\n\t\t\t\tmipmaps: false,\n\t\t\t\tminFilter: FILTER_NEAREST,\n\t\t\t\tmagFilter: FILTER_NEAREST,\n\t\t\t\tname: 'skin'\n\t\t\t});\n\t\t\tthis.matrixPalette = this.boneTexture.lock();\n\t\t} else {\n\t\t\tthis.matrixPalette = new Float32Array(numBones * 12);\n\t\t}\n\t}\n\tdestroy() {\n\t\tif (this.boneTexture) {\n\t\t\tthis.boneTexture.destroy();\n\t\t\tthis.boneTexture = null;\n\t\t}\n\t}\n\tresolve(rootBone, entity) {\n\t\tthis.rootBone = rootBone;\n\t\tconst skin = this.skin;\n\t\tconst bones = [];\n\t\tfor (let j = 0; j < skin.boneNames.length; j++) {\n\t\t\tconst boneName = skin.boneNames[j];\n\t\t\tlet bone = rootBone.findByName(boneName);\n\t\t\tif (!bone) {\n\t\t\t\tbone = entity;\n\t\t\t}\n\t\t\tbones.push(bone);\n\t\t}\n\t\tthis.bones = bones;\n\t}\n\tinitSkin(skin) {\n\t\tthis.skin = skin;\n\t\tthis.bones = [];\n\t\tconst numBones = skin.inverseBindPose.length;\n\t\tthis.init(skin.device, numBones);\n\t\tthis.matrices = [];\n\t\tfor (let i = 0; i < numBones; i++) {\n\t\t\tthis.matrices[i] = new Mat4();\n\t\t}\n\t}\n\tuploadBones(device) {\n\t\tif (device.supportsBoneTextures) {\n\t\t\tthis.boneTexture.lock();\n\t\t\tthis.boneTexture.unlock();\n\t\t}\n\t}\n\t_updateMatrices(rootNode, skinUpdateIndex) {\n\t\tif (this._skinUpdateIndex !== skinUpdateIndex) {\n\t\t\tthis._skinUpdateIndex = skinUpdateIndex;\n\t\t\t_invMatrix.copy(rootNode.getWorldTransform()).invert();\n\t\t\tfor (let i = this.bones.length - 1; i >= 0; i--) {\n\t\t\t\tthis.matrices[i].mulAffine2(_invMatrix, this.bones[i].getWorldTransform());\n\t\t\t\tthis.matrices[i].mulAffine2(this.matrices[i], this.skin.inverseBindPose[i]);\n\t\t\t}\n\t\t}\n\t}\n\tupdateMatrices(rootNode, skinUpdateIndex) {\n\t\tif (this._updateBeforeCull) {\n\t\t\tthis._updateMatrices(rootNode, skinUpdateIndex);\n\t\t}\n\t}\n\tupdateMatrixPalette(rootNode, skinUpdateIndex) {\n\t\tthis._updateMatrices(rootNode, skinUpdateIndex);\n\t\tconst mp = this.matrixPalette;\n\t\tconst count = this.bones.length;\n\t\tfor (let i = 0; i < count; i++) {\n\t\t\tconst pe = this.matrices[i].data;\n\t\t\tconst base = i * 12;\n\t\t\tmp[base] = pe[0];\n\t\t\tmp[base + 1] = pe[4];\n\t\t\tmp[base + 2] = pe[8];\n\t\t\tmp[base + 3] = pe[12];\n\t\t\tmp[base + 4] = pe[1];\n\t\t\tmp[base + 5] = pe[5];\n\t\t\tmp[base + 6] = pe[9];\n\t\t\tmp[base + 7] = pe[13];\n\t\t\tmp[base + 8] = pe[2];\n\t\t\tmp[base + 9] = pe[6];\n\t\t\tmp[base + 10] = pe[10];\n\t\t\tmp[base + 11] = pe[14];\n\t\t}\n\t\tthis.uploadBones(this.skin.device);\n\t}\n}\n\nexport { SkinInstance };\n","import { SkinInstance } from '../skin-instance.js';\n\nclass SkinBatchInstance extends SkinInstance {\n\tconstructor(device, nodes, rootNode) {\n\t\tsuper();\n\t\tconst numBones = nodes.length;\n\t\tthis.init(device, numBones);\n\t\tthis.device = device;\n\t\tthis.rootNode = rootNode;\n\t\tthis.bones = nodes;\n\t}\n\tupdateMatrices(rootNode, skinUpdateIndex) {}\n\tupdateMatrixPalette(rootNode, skinUpdateIndex) {\n\t\tconst mp = this.matrixPalette;\n\t\tconst count = this.bones.length;\n\t\tfor (let i = 0; i < count; i++) {\n\t\t\tconst pe = this.bones[i].getWorldTransform().data;\n\t\t\tconst base = i * 12;\n\t\t\tmp[base] = pe[0];\n\t\t\tmp[base + 1] = pe[4];\n\t\t\tmp[base + 2] = pe[8];\n\t\t\tmp[base + 3] = pe[12];\n\t\t\tmp[base + 4] = pe[1];\n\t\t\tmp[base + 5] = pe[5];\n\t\t\tmp[base + 6] = pe[9];\n\t\t\tmp[base + 7] = pe[13];\n\t\t\tmp[base + 8] = pe[2];\n\t\t\tmp[base + 9] = pe[6];\n\t\t\tmp[base + 10] = pe[10];\n\t\t\tmp[base + 11] = pe[14];\n\t\t}\n\t\tthis.uploadBones(this.device);\n\t}\n}\n\nexport { SkinBatchInstance };\n","import { EventHandler } from '../core/event-handler.js';\nimport { Tags } from '../core/tags.js';\nimport '../core/tracing.js';\nimport { Mat3 } from '../core/math/mat3.js';\nimport { Mat4 } from '../core/math/mat4.js';\nimport { Quat } from '../core/math/quat.js';\nimport { Vec3 } from '../core/math/vec3.js';\n\nconst scaleCompensatePosTransform = new Mat4();\nconst scaleCompensatePos = new Vec3();\nconst scaleCompensateRot = new Quat();\nconst scaleCompensateRot2 = new Quat();\nconst scaleCompensateScale = new Vec3();\nconst scaleCompensateScaleForParent = new Vec3();\nconst tmpMat4 = new Mat4();\nconst tmpQuat = new Quat();\nconst position = new Vec3();\nconst invParentWtm = new Mat4();\nconst rotation = new Quat();\nconst invParentRot = new Quat();\nconst matrix = new Mat4();\nconst target = new Vec3();\nconst up = new Vec3();\nclass GraphNode extends EventHandler {\n\tconstructor(name = 'Untitled') {\n\t\tsuper();\n\t\tthis.name = void 0;\n\t\tthis.tags = new Tags(this);\n\t\tthis._labels = {};\n\t\tthis.localPosition = new Vec3();\n\t\tthis.localRotation = new Quat();\n\t\tthis.localScale = new Vec3(1, 1, 1);\n\t\tthis.localEulerAngles = new Vec3();\n\t\tthis.position = new Vec3();\n\t\tthis.rotation = new Quat();\n\t\tthis.eulerAngles = new Vec3();\n\t\tthis._scale = null;\n\t\tthis.localTransform = new Mat4();\n\t\tthis._dirtyLocal = false;\n\t\tthis._aabbVer = 0;\n\t\tthis._frozen = false;\n\t\tthis.worldTransform = new Mat4();\n\t\tthis._dirtyWorld = false;\n\t\tthis._worldScaleSign = 0;\n\t\tthis._normalMatrix = new Mat3();\n\t\tthis._dirtyNormal = true;\n\t\tthis._right = null;\n\t\tthis._up = null;\n\t\tthis._forward = null;\n\t\tthis._parent = null;\n\t\tthis._children = [];\n\t\tthis._graphDepth = 0;\n\t\tthis._enabled = true;\n\t\tthis._enabledInHierarchy = false;\n\t\tthis.scaleCompensation = false;\n\t\tthis.name = name;\n\t}\n\tget right() {\n\t\tif (!this._right) {\n\t\t\tthis._right = new Vec3();\n\t\t}\n\t\treturn this.getWorldTransform().getX(this._right).normalize();\n\t}\n\tget up() {\n\t\tif (!this._up) {\n\t\t\tthis._up = new Vec3();\n\t\t}\n\t\treturn this.getWorldTransform().getY(this._up).normalize();\n\t}\n\tget forward() {\n\t\tif (!this._forward) {\n\t\t\tthis._forward = new Vec3();\n\t\t}\n\t\treturn this.getWorldTransform().getZ(this._forward).normalize().mulScalar(-1);\n\t}\n\tget normalMatrix() {\n\t\tconst normalMat = this._normalMatrix;\n\t\tif (this._dirtyNormal) {\n\t\t\tnormalMat.invertMat4(this.getWorldTransform()).transpose();\n\t\t\tthis._dirtyNormal = false;\n\t\t}\n\t\treturn normalMat;\n\t}\n\tset enabled(enabled) {\n\t\tif (this._enabled !== enabled) {\n\t\t\tvar _this$_parent;\n\t\t\tthis._enabled = enabled;\n\t\t\tif (enabled && (_this$_parent = this._parent) != null && _this$_parent.enabled || !enabled) {\n\t\t\t\tthis._notifyHierarchyStateChanged(this, enabled);\n\t\t\t}\n\t\t}\n\t}\n\tget enabled() {\n\t\treturn this._enabled && this._enabledInHierarchy;\n\t}\n\tget parent() {\n\t\treturn this._parent;\n\t}\n\tget path() {\n\t\tlet node = this._parent;\n\t\tif (!node) {\n\t\t\treturn '';\n\t\t}\n\t\tlet result = this.name;\n\t\twhile (node && node._parent) {\n\t\t\tresult = `${node.name}/${result}`;\n\t\t\tnode = node._parent;\n\t\t}\n\t\treturn result;\n\t}\n\tget root() {\n\t\tlet result = this;\n\t\twhile (result._parent) {\n\t\t\tresult = result._parent;\n\t\t}\n\t\treturn result;\n\t}\n\tget children() {\n\t\treturn this._children;\n\t}\n\tget graphDepth() {\n\t\treturn this._graphDepth;\n\t}\n\t_notifyHierarchyStateChanged(node, enabled) {\n\t\tnode._onHierarchyStateChanged(enabled);\n\t\tconst c = node._children;\n\t\tfor (let i = 0, len = c.length; i < len; i++) {\n\t\t\tif (c[i]._enabled) this._notifyHierarchyStateChanged(c[i], enabled);\n\t\t}\n\t}\n\t_onHierarchyStateChanged(enabled) {\n\t\tthis._enabledInHierarchy = enabled;\n\t\tif (enabled && !this._frozen) this._unfreezeParentToRoot();\n\t}\n\t_cloneInternal(clone) {\n\t\tclone.name = this.name;\n\t\tconst tags = this.tags._list;\n\t\tclone.tags.clear();\n\t\tfor (let i = 0; i < tags.length; i++) clone.tags.add(tags[i]);\n\t\tclone._labels = Object.assign({}, this._labels);\n\t\tclone.localPosition.copy(this.localPosition);\n\t\tclone.localRotation.copy(this.localRotation);\n\t\tclone.localScale.copy(this.localScale);\n\t\tclone.localEulerAngles.copy(this.localEulerAngles);\n\t\tclone.position.copy(this.position);\n\t\tclone.rotation.copy(this.rotation);\n\t\tclone.eulerAngles.copy(this.eulerAngles);\n\t\tclone.localTransform.copy(this.localTransform);\n\t\tclone._dirtyLocal = this._dirtyLocal;\n\t\tclone.worldTransform.copy(this.worldTransform);\n\t\tclone._dirtyWorld = this._dirtyWorld;\n\t\tclone._dirtyNormal = this._dirtyNormal;\n\t\tclone._aabbVer = this._aabbVer + 1;\n\t\tclone._enabled = this._enabled;\n\t\tclone.scaleCompensation = this.scaleCompensation;\n\t\tclone._enabledInHierarchy = false;\n\t}\n\tclone() {\n\t\tconst clone = new this.constructor();\n\t\tthis._cloneInternal(clone);\n\t\treturn clone;\n\t}\n\tcopy(source) {\n\t\tsource._cloneInternal(this);\n\t\treturn this;\n\t}\n\tdestroy() {\n\t\tthis.remove();\n\t\tconst children = this._children;\n\t\twhile (children.length) {\n\t\t\tconst child = children.pop();\n\t\t\tchild._parent = null;\n\t\t\tchild.destroy();\n\t\t}\n\t\tthis.fire('destroy', this);\n\t\tthis.off();\n\t}\n\tfind(attr, value) {\n\t\tlet result,\n\t\t\tresults = [];\n\t\tconst len = this._children.length;\n\t\tif (attr instanceof Function) {\n\t\t\tconst fn = attr;\n\t\t\tresult = fn(this);\n\t\t\tif (result) results.push(this);\n\t\t\tfor (let i = 0; i < len; i++) {\n\t\t\t\tconst descendants = this._children[i].find(fn);\n\t\t\t\tif (descendants.length) results = results.concat(descendants);\n\t\t\t}\n\t\t} else {\n\t\t\tlet testValue;\n\t\t\tif (this[attr]) {\n\t\t\t\tif (this[attr] instanceof Function) {\n\t\t\t\t\ttestValue = this[attr]();\n\t\t\t\t} else {\n\t\t\t\t\ttestValue = this[attr];\n\t\t\t\t}\n\t\t\t\tif (testValue === value) results.push(this);\n\t\t\t}\n\t\t\tfor (let i = 0; i < len; ++i) {\n\t\t\t\tconst descendants = this._children[i].find(attr, value);\n\t\t\t\tif (descendants.length) results = results.concat(descendants);\n\t\t\t}\n\t\t}\n\t\treturn results;\n\t}\n\tfindOne(attr, value) {\n\t\tconst len = this._children.length;\n\t\tlet result = null;\n\t\tif (attr instanceof Function) {\n\t\t\tconst fn = attr;\n\t\t\tresult = fn(this);\n\t\t\tif (result) return this;\n\t\t\tfor (let i = 0; i < len; i++) {\n\t\t\t\tresult = this._children[i].findOne(fn);\n\t\t\t\tif (result) return result;\n\t\t\t}\n\t\t} else {\n\t\t\tlet testValue;\n\t\t\tif (this[attr]) {\n\t\t\t\tif (this[attr] instanceof Function) {\n\t\t\t\t\ttestValue = this[attr]();\n\t\t\t\t} else {\n\t\t\t\t\ttestValue = this[attr];\n\t\t\t\t}\n\t\t\t\tif (testValue === value) {\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (let i = 0; i < len; i++) {\n\t\t\t\tresult = this._children[i].findOne(attr, value);\n\t\t\t\tif (result !== null) return result;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\tfindByTag() {\n\t\tconst query = arguments;\n\t\tconst results = [];\n\t\tconst queryNode = (node, checkNode) => {\n\t\t\tif (checkNode && node.tags.has(...query)) {\n\t\t\t\tresults.push(node);\n\t\t\t}\n\t\t\tfor (let i = 0; i < node._children.length; i++) {\n\t\t\t\tqueryNode(node._children[i], true);\n\t\t\t}\n\t\t};\n\t\tqueryNode(this, false);\n\t\treturn results;\n\t}\n\tfindByName(name) {\n\t\tif (this.name === name) return this;\n\t\tfor (let i = 0; i < this._children.length; i++) {\n\t\t\tconst found = this._children[i].findByName(name);\n\t\t\tif (found !== null) return found;\n\t\t}\n\t\treturn null;\n\t}\n\tfindByPath(path) {\n\t\tconst parts = Array.isArray(path) ? path : path.split('/');\n\t\tlet result = this;\n\t\tfor (let i = 0, imax = parts.length; i < imax; ++i) {\n\t\t\tresult = result.children.find(c => c.name === parts[i]);\n\t\t\tif (!result) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\tforEach(callback, thisArg) {\n\t\tcallback.call(thisArg, this);\n\t\tconst children = this._children;\n\t\tfor (let i = 0; i < children.length; i++) {\n\t\t\tchildren[i].forEach(callback, thisArg);\n\t\t}\n\t}\n\tisDescendantOf(node) {\n\t\tlet parent = this._parent;\n\t\twhile (parent) {\n\t\t\tif (parent === node) return true;\n\t\t\tparent = parent._parent;\n\t\t}\n\t\treturn false;\n\t}\n\tisAncestorOf(node) {\n\t\treturn node.isDescendantOf(this);\n\t}\n\tgetEulerAngles() {\n\t\tthis.getWorldTransform().getEulerAngles(this.eulerAngles);\n\t\treturn this.eulerAngles;\n\t}\n\tgetLocalEulerAngles() {\n\t\tthis.localRotation.getEulerAngles(this.localEulerAngles);\n\t\treturn this.localEulerAngles;\n\t}\n\tgetLocalPosition() {\n\t\treturn this.localPosition;\n\t}\n\tgetLocalRotation() {\n\t\treturn this.localRotation;\n\t}\n\tgetLocalScale() {\n\t\treturn this.localScale;\n\t}\n\tgetLocalTransform() {\n\t\tif (this._dirtyLocal) {\n\t\t\tthis.localTransform.setTRS(this.localPosition, this.localRotation, this.localScale);\n\t\t\tthis._dirtyLocal = false;\n\t\t}\n\t\treturn this.localTransform;\n\t}\n\tgetPosition() {\n\t\tthis.getWorldTransform().getTranslation(this.position);\n\t\treturn this.position;\n\t}\n\tgetRotation() {\n\t\tthis.rotation.setFromMat4(this.getWorldTransform());\n\t\treturn this.rotation;\n\t}\n\tgetScale() {\n\t\tif (!this._scale) {\n\t\t\tthis._scale = new Vec3();\n\t\t}\n\t\treturn this.getWorldTransform().getScale(this._scale);\n\t}\n\tgetWorldTransform() {\n\t\tif (!this._dirtyLocal && !this._dirtyWorld) return this.worldTransform;\n\t\tif (this._parent) this._parent.getWorldTransform();\n\t\tthis._sync();\n\t\treturn this.worldTransform;\n\t}\n\tget worldScaleSign() {\n\t\tif (this._worldScaleSign === 0) {\n\t\t\tthis._worldScaleSign = this.getWorldTransform().scaleSign;\n\t\t}\n\t\treturn this._worldScaleSign;\n\t}\n\tremove() {\n\t\tvar _this$_parent2;\n\t\t(_this$_parent2 = this._parent) == null || _this$_parent2.removeChild(this);\n\t}\n\treparent(parent, index) {\n\t\tthis.remove();\n\t\tif (parent) {\n\t\t\tif (index >= 0) {\n\t\t\t\tparent.insertChild(this, index);\n\t\t\t} else {\n\t\t\t\tparent.addChild(this);\n\t\t\t}\n\t\t}\n\t}\n\tsetLocalEulerAngles(x, y, z) {\n\t\tthis.localRotation.setFromEulerAngles(x, y, z);\n\t\tif (!this._dirtyLocal) this._dirtifyLocal();\n\t}\n\tsetLocalPosition(x, y, z) {\n\t\tif (x instanceof Vec3) {\n\t\t\tthis.localPosition.copy(x);\n\t\t} else {\n\t\t\tthis.localPosition.set(x, y, z);\n\t\t}\n\t\tif (!this._dirtyLocal) this._dirtifyLocal();\n\t}\n\tsetLocalRotation(x, y, z, w) {\n\t\tif (x instanceof Quat) {\n\t\t\tthis.localRotation.copy(x);\n\t\t} else {\n\t\t\tthis.localRotation.set(x, y, z, w);\n\t\t}\n\t\tif (!this._dirtyLocal) this._dirtifyLocal();\n\t}\n\tsetLocalScale(x, y, z) {\n\t\tif (x instanceof Vec3) {\n\t\t\tthis.localScale.copy(x);\n\t\t} else {\n\t\t\tthis.localScale.set(x, y, z);\n\t\t}\n\t\tif (!this._dirtyLocal) this._dirtifyLocal();\n\t}\n\t_dirtifyLocal() {\n\t\tif (!this._dirtyLocal) {\n\t\t\tthis._dirtyLocal = true;\n\t\t\tif (!this._dirtyWorld) this._dirtifyWorld();\n\t\t}\n\t}\n\t_unfreezeParentToRoot() {\n\t\tlet p = this._parent;\n\t\twhile (p) {\n\t\t\tp._frozen = false;\n\t\t\tp = p._parent;\n\t\t}\n\t}\n\t_dirtifyWorld() {\n\t\tif (!this._dirtyWorld) this._unfreezeParentToRoot();\n\t\tthis._dirtifyWorldInternal();\n\t}\n\t_dirtifyWorldInternal() {\n\t\tif (!this._dirtyWorld) {\n\t\t\tthis._frozen = false;\n\t\t\tthis._dirtyWorld = true;\n\t\t\tfor (let i = 0; i < this._children.length; i++) {\n\t\t\t\tif (!this._children[i]._dirtyWorld) this._children[i]._dirtifyWorldInternal();\n\t\t\t}\n\t\t}\n\t\tthis._dirtyNormal = true;\n\t\tthis._worldScaleSign = 0;\n\t\tthis._aabbVer++;\n\t}\n\tsetPosition(x, y, z) {\n\t\tif (x instanceof Vec3) {\n\t\t\tposition.copy(x);\n\t\t} else {\n\t\t\tposition.set(x, y, z);\n\t\t}\n\t\tif (this._parent === null) {\n\t\t\tthis.localPosition.copy(position);\n\t\t} else {\n\t\t\tinvParentWtm.copy(this._parent.getWorldTransform()).invert();\n\t\t\tinvParentWtm.transformPoint(position, this.localPosition);\n\t\t}\n\t\tif (!this._dirtyLocal) this._dirtifyLocal();\n\t}\n\tsetRotation(x, y, z, w) {\n\t\tif (x instanceof Quat) {\n\t\t\trotation.copy(x);\n\t\t} else {\n\t\t\trotation.set(x, y, z, w);\n\t\t}\n\t\tif (this._parent === null) {\n\t\t\tthis.localRotation.copy(rotation);\n\t\t} else {\n\t\t\tconst parentRot = this._parent.getRotation();\n\t\t\tinvParentRot.copy(parentRot).invert();\n\t\t\tthis.localRotation.copy(invParentRot).mul(rotation);\n\t\t}\n\t\tif (!this._dirtyLocal) this._dirtifyLocal();\n\t}\n\tsetEulerAngles(x, y, z) {\n\t\tthis.localRotation.setFromEulerAngles(x, y, z);\n\t\tif (this._parent !== null) {\n\t\t\tconst parentRot = this._parent.getRotation();\n\t\t\tinvParentRot.copy(parentRot).invert();\n\t\t\tthis.localRotation.mul2(invParentRot, this.localRotation);\n\t\t}\n\t\tif (!this._dirtyLocal) this._dirtifyLocal();\n\t}\n\taddChild(node) {\n\t\tthis._prepareInsertChild(node);\n\t\tthis._children.push(node);\n\t\tthis._onInsertChild(node);\n\t}\n\taddChildAndSaveTransform(node) {\n\t\tconst wPos = node.getPosition();\n\t\tconst wRot = node.getRotation();\n\t\tthis._prepareInsertChild(node);\n\t\tnode.setPosition(tmpMat4.copy(this.worldTransform).invert().transformPoint(wPos));\n\t\tnode.setRotation(tmpQuat.copy(this.getRotation()).invert().mul(wRot));\n\t\tthis._children.push(node);\n\t\tthis._onInsertChild(node);\n\t}\n\tinsertChild(node, index) {\n\t\tthis._prepareInsertChild(node);\n\t\tthis._children.splice(index, 0, node);\n\t\tthis._onInsertChild(node);\n\t}\n\t_prepareInsertChild(node) {\n\t\tnode.remove();\n\t}\n\t_fireOnHierarchy(name, nameHierarchy, parent) {\n\t\tthis.fire(name, parent);\n\t\tfor (let i = 0; i < this._children.length; i++) {\n\t\t\tthis._children[i]._fireOnHierarchy(nameHierarchy, nameHierarchy, parent);\n\t\t}\n\t}\n\t_onInsertChild(node) {\n\t\tnode._parent = this;\n\t\tconst enabledInHierarchy = node._enabled && this.enabled;\n\t\tif (node._enabledInHierarchy !== enabledInHierarchy) {\n\t\t\tnode._enabledInHierarchy = enabledInHierarchy;\n\t\t\tnode._notifyHierarchyStateChanged(node, enabledInHierarchy);\n\t\t}\n\t\tnode._updateGraphDepth();\n\t\tnode._dirtifyWorld();\n\t\tif (this._frozen) node._unfreezeParentToRoot();\n\t\tnode._fireOnHierarchy('insert', 'inserthierarchy', this);\n\t\tif (this.fire) this.fire('childinsert', node);\n\t}\n\t_updateGraphDepth() {\n\t\tthis._graphDepth = this._parent ? this._parent._graphDepth + 1 : 0;\n\t\tfor (let i = 0, len = this._children.length; i < len; i++) {\n\t\t\tthis._children[i]._updateGraphDepth();\n\t\t}\n\t}\n\tremoveChild(child) {\n\t\tconst index = this._children.indexOf(child);\n\t\tif (index === -1) {\n\t\t\treturn;\n\t\t}\n\t\tthis._children.splice(index, 1);\n\t\tchild._parent = null;\n\t\tchild._fireOnHierarchy('remove', 'removehierarchy', this);\n\t\tthis.fire('childremove', child);\n\t}\n\t_sync() {\n\t\tif (this._dirtyLocal) {\n\t\t\tthis.localTransform.setTRS(this.localPosition, this.localRotation, this.localScale);\n\t\t\tthis._dirtyLocal = false;\n\t\t}\n\t\tif (this._dirtyWorld) {\n\t\t\tif (this._parent === null) {\n\t\t\t\tthis.worldTransform.copy(this.localTransform);\n\t\t\t} else {\n\t\t\t\tif (this.scaleCompensation) {\n\t\t\t\t\tlet parentWorldScale;\n\t\t\t\t\tconst parent = this._parent;\n\t\t\t\t\tlet scale = this.localScale;\n\t\t\t\t\tlet parentToUseScaleFrom = parent;\n\t\t\t\t\tif (parentToUseScaleFrom) {\n\t\t\t\t\t\twhile (parentToUseScaleFrom && parentToUseScaleFrom.scaleCompensation) {\n\t\t\t\t\t\t\tparentToUseScaleFrom = parentToUseScaleFrom._parent;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (parentToUseScaleFrom) {\n\t\t\t\t\t\t\tparentToUseScaleFrom = parentToUseScaleFrom._parent;\n\t\t\t\t\t\t\tif (parentToUseScaleFrom) {\n\t\t\t\t\t\t\t\tparentWorldScale = parentToUseScaleFrom.worldTransform.getScale();\n\t\t\t\t\t\t\t\tscaleCompensateScale.mul2(parentWorldScale, this.localScale);\n\t\t\t\t\t\t\t\tscale = scaleCompensateScale;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tscaleCompensateRot2.setFromMat4(parent.worldTransform);\n\t\t\t\t\tscaleCompensateRot.mul2(scaleCompensateRot2, this.localRotation);\n\t\t\t\t\tlet tmatrix = parent.worldTransform;\n\t\t\t\t\tif (parent.scaleCompensation) {\n\t\t\t\t\t\tscaleCompensateScaleForParent.mul2(parentWorldScale, parent.getLocalScale());\n\t\t\t\t\t\tscaleCompensatePosTransform.setTRS(parent.worldTransform.getTranslation(scaleCompensatePos), scaleCompensateRot2, scaleCompensateScaleForParent);\n\t\t\t\t\t\ttmatrix = scaleCompensatePosTransform;\n\t\t\t\t\t}\n\t\t\t\t\ttmatrix.transformPoint(this.localPosition, scaleCompensatePos);\n\t\t\t\t\tthis.worldTransform.setTRS(scaleCompensatePos, scaleCompensateRot, scale);\n\t\t\t\t} else {\n\t\t\t\t\tthis.worldTransform.mulAffine2(this._parent.worldTransform, this.localTransform);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._dirtyWorld = false;\n\t\t}\n\t}\n\tsyncHierarchy() {\n\t\tif (!this._enabled) return;\n\t\tif (this._frozen) return;\n\t\tthis._frozen = true;\n\t\tif (this._dirtyLocal || this._dirtyWorld) {\n\t\t\tthis._sync();\n\t\t}\n\t\tconst children = this._children;\n\t\tfor (let i = 0, len = children.length; i < len; i++) {\n\t\t\tchildren[i].syncHierarchy();\n\t\t}\n\t}\n\tlookAt(x, y, z, ux = 0, uy = 1, uz = 0) {\n\t\tif (x instanceof Vec3) {\n\t\t\ttarget.copy(x);\n\t\t\tif (y instanceof Vec3) {\n\t\t\t\tup.copy(y);\n\t\t\t} else {\n\t\t\t\tup.copy(Vec3.UP);\n\t\t\t}\n\t\t} else if (z === undefined) {\n\t\t\treturn;\n\t\t} else {\n\t\t\ttarget.set(x, y, z);\n\t\t\tup.set(ux, uy, uz);\n\t\t}\n\t\tmatrix.setLookAt(this.getPosition(), target, up);\n\t\trotation.setFromMat4(matrix);\n\t\tthis.setRotation(rotation);\n\t}\n\ttranslate(x, y, z) {\n\t\tif (x instanceof Vec3) {\n\t\t\tposition.copy(x);\n\t\t} else {\n\t\t\tposition.set(x, y, z);\n\t\t}\n\t\tposition.add(this.getPosition());\n\t\tthis.setPosition(position);\n\t}\n\ttranslateLocal(x, y, z) {\n\t\tif (x instanceof Vec3) {\n\t\t\tposition.copy(x);\n\t\t} else {\n\t\t\tposition.set(x, y, z);\n\t\t}\n\t\tthis.localRotation.transformVector(position, position);\n\t\tthis.localPosition.add(position);\n\t\tif (!this._dirtyLocal) this._dirtifyLocal();\n\t}\n\trotate(x, y, z) {\n\t\trotation.setFromEulerAngles(x, y, z);\n\t\tif (this._parent === null) {\n\t\t\tthis.localRotation.mul2(rotation, this.localRotation);\n\t\t} else {\n\t\t\tconst rot = this.getRotation();\n\t\t\tconst parentRot = this._parent.getRotation();\n\t\t\tinvParentRot.copy(parentRot).invert();\n\t\t\trotation.mul2(invParentRot, rotation);\n\t\t\tthis.localRotation.mul2(rotation, rot);\n\t\t}\n\t\tif (!this._dirtyLocal) this._dirtifyLocal();\n\t}\n\trotateLocal(x, y, z) {\n\t\trotation.setFromEulerAngles(x, y, z);\n\t\tthis.localRotation.mul(rotation);\n\t\tif (!this._dirtyLocal) this._dirtifyLocal();\n\t}\n}\n\nexport { GraphNode };\n","class RefCountedCache {\n\tconstructor() {\n\t\tthis.cache = new Map();\n\t}\n\tdestroy() {\n\t\tthis.cache.forEach((refCount, object) => {\n\t\t\tobject.destroy();\n\t\t});\n\t\tthis.cache.clear();\n\t}\n\tincRef(object) {\n\t\tconst refCount = (this.cache.get(object) || 0) + 1;\n\t\tthis.cache.set(object, refCount);\n\t}\n\tdecRef(object) {\n\t\tif (object) {\n\t\t\tlet refCount = this.cache.get(object);\n\t\t\tif (refCount) {\n\t\t\t\trefCount--;\n\t\t\t\tif (refCount === 0) {\n\t\t\t\t\tthis.cache.delete(object);\n\t\t\t\t\tobject.destroy();\n\t\t\t\t} else {\n\t\t\t\t\tthis.cache.set(object, refCount);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport { RefCountedCache };\n","import { RefCountedCache } from '../../core/ref-counted-cache.js';\n\nclass LightmapCache {\n\tstatic incRef(texture) {\n\t\tthis.cache.incRef(texture);\n\t}\n\tstatic decRef(texture) {\n\t\tthis.cache.decRef(texture);\n\t}\n\tstatic destroy() {\n\t\tthis.cache.destroy();\n\t}\n}\nLightmapCache.cache = new RefCountedCache();\n\nexport { LightmapCache };\n","import '../core/tracing.js';\nimport { BoundingBox } from '../core/shape/bounding-box.js';\nimport { BoundingSphere } from '../core/shape/bounding-sphere.js';\nimport { BindGroup } from '../platform/graphics/bind-group.js';\nimport { UniformBuffer } from '../platform/graphics/uniform-buffer.js';\nimport { MASK_AFFECT_DYNAMIC, SHADERDEF_UV0, SHADERDEF_UV1, SHADERDEF_VCOLOR, SHADERDEF_TANGENTS, LAYER_WORLD, RENDERSTYLE_SOLID, SHADERDEF_NOSHADOW, SHADERDEF_SKIN, SHADERDEF_MORPH_TEXTURE_BASED, SHADERDEF_MORPH_POSITION, SHADERDEF_MORPH_NORMAL, SHADERDEF_SCREENSPACE, SORTKEY_FORWARD, BLEND_NORMAL, BLEND_NONE, SHADERDEF_INSTANCING, MASK_AFFECT_LIGHTMAPPED, MASK_BAKE, SHADERDEF_LM, SHADERDEF_DIRLM, SHADERDEF_LMAMBIENT } from './constants.js';\nimport { GraphNode } from './graph-node.js';\nimport { getDefaultMaterial } from './materials/default-material.js';\nimport { LightmapCache } from './graphics/lightmap-cache.js';\n\nlet id = 0;\nconst _tmpAabb = new BoundingBox();\nconst _tempBoneAabb = new BoundingBox();\nconst _tempSphere = new BoundingSphere();\nconst _meshSet = new Set();\nclass InstancingData {\n\tconstructor(numObjects) {\n\t\tthis.vertexBuffer = null;\n\t\tthis.count = numObjects;\n\t}\n}\nclass ShaderInstance {\n\tconstructor() {\n\t\tthis.shader = void 0;\n\t\tthis.bindGroup = null;\n\t}\n\tgetBindGroup(device) {\n\t\tif (!this.bindGroup) {\n\t\t\tconst shader = this.shader;\n\t\t\tconst ubFormat = shader.meshUniformBufferFormat;\n\t\t\tconst uniformBuffer = new UniformBuffer(device, ubFormat, false);\n\t\t\tconst bindGroupFormat = shader.meshBindGroupFormat;\n\t\t\tthis.bindGroup = new BindGroup(device, bindGroupFormat, uniformBuffer);\n\t\t}\n\t\treturn this.bindGroup;\n\t}\n\tdestroy() {\n\t\tconst group = this.bindGroup;\n\t\tif (group) {\n\t\t\tvar _group$defaultUniform;\n\t\t\t(_group$defaultUniform = group.defaultUniformBuffer) == null || _group$defaultUniform.destroy();\n\t\t\tgroup.destroy();\n\t\t\tthis.bindGroup = null;\n\t\t}\n\t}\n}\nclass ShaderCacheEntry {\n\tconstructor() {\n\t\tthis.shaderInstances = new Map();\n\t}\n\tdestroy() {\n\t\tthis.shaderInstances.forEach(instance => instance.destroy());\n\t\tthis.shaderInstances.clear();\n\t}\n}\nclass MeshInstance {\n\tconstructor(mesh, material, node = null) {\n\t\tthis.visible = true;\n\t\tthis.castShadow = false;\n\t\tthis.transparent = false;\n\t\tthis._material = null;\n\t\tthis._shaderCache = [];\n\t\tthis.id = id++;\n\t\tthis.pick = true;\n\t\tif (mesh instanceof GraphNode) {\n\t\t\tconst temp = mesh;\n\t\t\tmesh = material;\n\t\t\tmaterial = node;\n\t\t\tnode = temp;\n\t\t}\n\t\tthis._key = [0, 0];\n\t\tthis.node = node;\n\t\tthis._mesh = mesh;\n\t\tmesh.incRefCount();\n\t\tthis.material = material;\n\t\tthis._shaderDefs = MASK_AFFECT_DYNAMIC << 16;\n\t\tthis._shaderDefs |= mesh.vertexBuffer.format.hasUv0 ? SHADERDEF_UV0 : 0;\n\t\tthis._shaderDefs |= mesh.vertexBuffer.format.hasUv1 ? SHADERDEF_UV1 : 0;\n\t\tthis._shaderDefs |= mesh.vertexBuffer.format.hasColor ? SHADERDEF_VCOLOR : 0;\n\t\tthis._shaderDefs |= mesh.vertexBuffer.format.hasTangents ? SHADERDEF_TANGENTS : 0;\n\t\tthis.layer = LAYER_WORLD;\n\t\tthis._renderStyle = RENDERSTYLE_SOLID;\n\t\tthis._receiveShadow = true;\n\t\tthis._screenSpace = false;\n\t\tthis._noDepthDrawGl1 = false;\n\t\tthis.cull = true;\n\t\tthis._updateAabb = true;\n\t\tthis._updateAabbFunc = null;\n\t\tthis._calculateSortDistance = null;\n\t\tthis.updateKey();\n\t\tthis._skinInstance = null;\n\t\tthis._morphInstance = null;\n\t\tthis.instancingData = null;\n\t\tthis._customAabb = null;\n\t\tthis.aabb = new BoundingBox();\n\t\tthis._aabbVer = -1;\n\t\tthis._aabbMeshVer = -1;\n\t\tthis.drawOrder = 0;\n\t\tthis.visibleThisFrame = false;\n\t\tthis.isVisibleFunc = null;\n\t\tthis.parameters = {};\n\t\tthis.stencilFront = null;\n\t\tthis.stencilBack = null;\n\t\tthis.flipFacesFactor = 1;\n\t}\n\tset renderStyle(renderStyle) {\n\t\tthis._renderStyle = renderStyle;\n\t\tthis.mesh.prepareRenderState(renderStyle);\n\t}\n\tget renderStyle() {\n\t\treturn this._renderStyle;\n\t}\n\tset mesh(mesh) {\n\t\tif (mesh === this._mesh) return;\n\t\tif (this._mesh) {\n\t\t\tthis._mesh.decRefCount();\n\t\t}\n\t\tthis._mesh = mesh;\n\t\tif (mesh) {\n\t\t\tmesh.incRefCount();\n\t\t}\n\t}\n\tget mesh() {\n\t\treturn this._mesh;\n\t}\n\tset aabb(aabb) {\n\t\tthis._aabb = aabb;\n\t}\n\tget aabb() {\n\t\tif (!this._updateAabb) {\n\t\t\treturn this._aabb;\n\t\t}\n\t\tif (this._updateAabbFunc) {\n\t\t\treturn this._updateAabbFunc(this._aabb);\n\t\t}\n\t\tlet localAabb = this._customAabb;\n\t\tlet toWorldSpace = !!localAabb;\n\t\tif (!localAabb) {\n\t\t\tlocalAabb = _tmpAabb;\n\t\t\tif (this.skinInstance) {\n\t\t\t\tif (!this.mesh.boneAabb) {\n\t\t\t\t\tconst morphTargets = this._morphInstance ? this._morphInstance.morph._targets : null;\n\t\t\t\t\tthis.mesh._initBoneAabbs(morphTargets);\n\t\t\t\t}\n\t\t\t\tconst boneUsed = this.mesh.boneUsed;\n\t\t\t\tlet first = true;\n\t\t\t\tfor (let i = 0; i < this.mesh.boneAabb.length; i++) {\n\t\t\t\t\tif (boneUsed[i]) {\n\t\t\t\t\t\t_tempBoneAabb.setFromTransformedAabb(this.mesh.boneAabb[i], this.skinInstance.matrices[i]);\n\t\t\t\t\t\tif (first) {\n\t\t\t\t\t\t\tfirst = false;\n\t\t\t\t\t\t\tlocalAabb.center.copy(_tempBoneAabb.center);\n\t\t\t\t\t\t\tlocalAabb.halfExtents.copy(_tempBoneAabb.halfExtents);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlocalAabb.add(_tempBoneAabb);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\ttoWorldSpace = true;\n\t\t\t} else if (this.node._aabbVer !== this._aabbVer || this.mesh._aabbVer !== this._aabbMeshVer) {\n\t\t\t\tif (this.mesh) {\n\t\t\t\t\tlocalAabb.center.copy(this.mesh.aabb.center);\n\t\t\t\t\tlocalAabb.halfExtents.copy(this.mesh.aabb.halfExtents);\n\t\t\t\t} else {\n\t\t\t\t\tlocalAabb.center.set(0, 0, 0);\n\t\t\t\t\tlocalAabb.halfExtents.set(0, 0, 0);\n\t\t\t\t}\n\t\t\t\tif (this.mesh && this.mesh.morph) {\n\t\t\t\t\tconst morphAabb = this.mesh.morph.aabb;\n\t\t\t\t\tlocalAabb._expand(morphAabb.getMin(), morphAabb.getMax());\n\t\t\t\t}\n\t\t\t\ttoWorldSpace = true;\n\t\t\t\tthis._aabbVer = this.node._aabbVer;\n\t\t\t\tthis._aabbMeshVer = this.mesh._aabbVer;\n\t\t\t}\n\t\t}\n\t\tif (toWorldSpace) {\n\t\t\tthis._aabb.setFromTransformedAabb(localAabb, this.node.getWorldTransform());\n\t\t}\n\t\treturn this._aabb;\n\t}\n\tclearShaders() {\n\t\tconst shaderCache = this._shaderCache;\n\t\tfor (let i = 0; i < shaderCache.length; i++) {\n\t\t\tvar _shaderCache$i;\n\t\t\t(_shaderCache$i = shaderCache[i]) == null || _shaderCache$i.destroy();\n\t\t\tshaderCache[i] = null;\n\t\t}\n\t}\n\tgetShaderInstance(shaderPass, lightHash, scene, viewUniformFormat, viewBindGroupFormat, sortedLights) {\n\t\tlet shaderInstance;\n\t\tlet passEntry = this._shaderCache[shaderPass];\n\t\tif (passEntry) {\n\t\t\tshaderInstance = passEntry.shaderInstances.get(lightHash);\n\t\t} else {\n\t\t\tpassEntry = new ShaderCacheEntry();\n\t\t\tthis._shaderCache[shaderPass] = passEntry;\n\t\t}\n\t\tif (!shaderInstance) {\n\t\t\tconst mat = this._material;\n\t\t\tconst shaderDefs = this._shaderDefs;\n\t\t\tconst variantKey = shaderPass + '_' + shaderDefs + '_' + lightHash;\n\t\t\tshaderInstance = new ShaderInstance();\n\t\t\tshaderInstance.shader = mat.variants.get(variantKey);\n\t\t\tif (!shaderInstance.shader) {\n\t\t\t\tconst shader = mat.getShaderVariant(this.mesh.device, scene, shaderDefs, null, shaderPass, sortedLights, viewUniformFormat, viewBindGroupFormat, this._mesh.vertexBuffer.format);\n\t\t\t\tmat.variants.set(variantKey, shader);\n\t\t\t\tshaderInstance.shader = shader;\n\t\t\t}\n\t\t\tpassEntry.shaderInstances.set(lightHash, shaderInstance);\n\t\t}\n\t\treturn shaderInstance;\n\t}\n\tset material(material) {\n\t\tthis.clearShaders();\n\t\tconst prevMat = this._material;\n\t\tif (prevMat) {\n\t\t\tprevMat.removeMeshInstanceRef(this);\n\t\t}\n\t\tthis._material = material;\n\t\tif (material) {\n\t\t\tmaterial.addMeshInstanceRef(this);\n\t\t\tthis.transparent = material.transparent;\n\t\t\tthis.updateKey();\n\t\t}\n\t}\n\tget material() {\n\t\treturn this._material;\n\t}\n\tset layer(layer) {\n\t\tthis._layer = layer;\n\t\tthis.updateKey();\n\t}\n\tget layer() {\n\t\treturn this._layer;\n\t}\n\t_updateShaderDefs(shaderDefs) {\n\t\tif (shaderDefs !== this._shaderDefs) {\n\t\t\tthis._shaderDefs = shaderDefs;\n\t\t\tthis.clearShaders();\n\t\t}\n\t}\n\tset calculateSortDistance(calculateSortDistance) {\n\t\tthis._calculateSortDistance = calculateSortDistance;\n\t}\n\tget calculateSortDistance() {\n\t\treturn this._calculateSortDistance;\n\t}\n\tset receiveShadow(val) {\n\t\tif (this._receiveShadow !== val) {\n\t\t\tthis._receiveShadow = val;\n\t\t\tthis._updateShaderDefs(val ? this._shaderDefs & ~SHADERDEF_NOSHADOW : this._shaderDefs | SHADERDEF_NOSHADOW);\n\t\t}\n\t}\n\tget receiveShadow() {\n\t\treturn this._receiveShadow;\n\t}\n\tset skinInstance(val) {\n\t\tthis._skinInstance = val;\n\t\tthis._updateShaderDefs(val ? this._shaderDefs | SHADERDEF_SKIN : this._shaderDefs & ~SHADERDEF_SKIN);\n\t\tthis._setupSkinUpdate();\n\t}\n\tget skinInstance() {\n\t\treturn this._skinInstance;\n\t}\n\tset morphInstance(val) {\n\t\tvar _this$_morphInstance;\n\t\t(_this$_morphInstance = this._morphInstance) == null || _this$_morphInstance.destroy();\n\t\tthis._morphInstance = val;\n\t\tlet shaderDefs = this._shaderDefs;\n\t\tshaderDefs = val && val.morph.useTextureMorph ? shaderDefs | SHADERDEF_MORPH_TEXTURE_BASED : shaderDefs & ~SHADERDEF_MORPH_TEXTURE_BASED;\n\t\tshaderDefs = val && val.morph.morphPositions ? shaderDefs | SHADERDEF_MORPH_POSITION : shaderDefs & ~SHADERDEF_MORPH_POSITION;\n\t\tshaderDefs = val && val.morph.morphNormals ? shaderDefs | SHADERDEF_MORPH_NORMAL : shaderDefs & ~SHADERDEF_MORPH_NORMAL;\n\t\tthis._updateShaderDefs(shaderDefs);\n\t}\n\tget morphInstance() {\n\t\treturn this._morphInstance;\n\t}\n\tset screenSpace(val) {\n\t\tif (this._screenSpace !== val) {\n\t\t\tthis._screenSpace = val;\n\t\t\tthis._updateShaderDefs(val ? this._shaderDefs | SHADERDEF_SCREENSPACE : this._shaderDefs & ~SHADERDEF_SCREENSPACE);\n\t\t}\n\t}\n\tget screenSpace() {\n\t\treturn this._screenSpace;\n\t}\n\tset key(val) {\n\t\tthis._key[SORTKEY_FORWARD] = val;\n\t}\n\tget key() {\n\t\treturn this._key[SORTKEY_FORWARD];\n\t}\n\tset mask(val) {\n\t\tconst toggles = this._shaderDefs & 0x0000FFFF;\n\t\tthis._updateShaderDefs(toggles | val << 16);\n\t}\n\tget mask() {\n\t\treturn this._shaderDefs >> 16;\n\t}\n\tset instancingCount(value) {\n\t\tif (this.instancingData) this.instancingData.count = value;\n\t}\n\tget instancingCount() {\n\t\treturn this.instancingData ? this.instancingData.count : 0;\n\t}\n\tdestroy() {\n\t\tvar _this$_skinInstance, _this$morphInstance;\n\t\tconst mesh = this.mesh;\n\t\tif (mesh) {\n\t\t\tthis.mesh = null;\n\t\t\tif (mesh.refCount < 1) {\n\t\t\t\tmesh.destroy();\n\t\t\t}\n\t\t}\n\t\tthis.setRealtimeLightmap(MeshInstance.lightmapParamNames[0], null);\n\t\tthis.setRealtimeLightmap(MeshInstance.lightmapParamNames[1], null);\n\t\t(_this$_skinInstance = this._skinInstance) == null || _this$_skinInstance.destroy();\n\t\tthis._skinInstance = null;\n\t\t(_this$morphInstance = this.morphInstance) == null || _this$morphInstance.destroy();\n\t\tthis.morphInstance = null;\n\t\tthis.clearShaders();\n\t\tthis.material = null;\n\t}\n\tstatic _prepareRenderStyleForArray(meshInstances, renderStyle) {\n\t\tif (meshInstances) {\n\t\t\tfor (let i = 0; i < meshInstances.length; i++) {\n\t\t\t\tmeshInstances[i]._renderStyle = renderStyle;\n\t\t\t\tconst mesh = meshInstances[i].mesh;\n\t\t\t\tif (!_meshSet.has(mesh)) {\n\t\t\t\t\t_meshSet.add(mesh);\n\t\t\t\t\tmesh.prepareRenderState(renderStyle);\n\t\t\t\t}\n\t\t\t}\n\t\t\t_meshSet.clear();\n\t\t}\n\t}\n\t_isVisible(camera) {\n\t\tif (this.visible) {\n\t\t\tif (this.isVisibleFunc) {\n\t\t\t\treturn this.isVisibleFunc(camera);\n\t\t\t}\n\t\t\t_tempSphere.center = this.aabb.center;\n\t\t\t_tempSphere.radius = this._aabb.halfExtents.length();\n\t\t\treturn camera.frustum.containsSphere(_tempSphere);\n\t\t}\n\t\treturn false;\n\t}\n\tupdateKey() {\n\t\tconst material = this.material;\n\t\tconst blendType = material.alphaToCoverage || material.alphaTest ? BLEND_NORMAL : material.blendType;\n\t\tthis._key[SORTKEY_FORWARD] = (this.layer & 0x0f) << 27 | (blendType === BLEND_NONE ? 1 : 0) << 26 | (material.id & 0x1ffffff) << 0;\n\t}\n\tsetInstancing(vertexBuffer, cull = false) {\n\t\tif (vertexBuffer) {\n\t\t\tthis.instancingData = new InstancingData(vertexBuffer.numVertices);\n\t\t\tthis.instancingData.vertexBuffer = vertexBuffer;\n\t\t\tvertexBuffer.format.instancing = true;\n\t\t\tthis.cull = cull;\n\t\t} else {\n\t\t\tthis.instancingData = null;\n\t\t\tthis.cull = true;\n\t\t}\n\t\tthis._updateShaderDefs(vertexBuffer ? this._shaderDefs | SHADERDEF_INSTANCING : this._shaderDefs & ~SHADERDEF_INSTANCING);\n\t}\n\tensureMaterial(device) {\n\t\tif (!this.material) {\n\t\t\tthis.material = getDefaultMaterial(device);\n\t\t}\n\t}\n\tclearParameters() {\n\t\tthis.parameters = {};\n\t}\n\tgetParameters() {\n\t\treturn this.parameters;\n\t}\n\tgetParameter(name) {\n\t\treturn this.parameters[name];\n\t}\n\tsetParameter(name, data, passFlags = -262141) {\n\t\tif (data === undefined && typeof name === 'object') {\n\t\t\tconst uniformObject = name;\n\t\t\tif (uniformObject.length) {\n\t\t\t\tfor (let i = 0; i < uniformObject.length; i++) {\n\t\t\t\t\tthis.setParameter(uniformObject[i]);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tname = uniformObject.name;\n\t\t\tdata = uniformObject.value;\n\t\t}\n\t\tconst param = this.parameters[name];\n\t\tif (param) {\n\t\t\tparam.data = data;\n\t\t\tparam.passFlags = passFlags;\n\t\t} else {\n\t\t\tthis.parameters[name] = {\n\t\t\t\tscopeId: null,\n\t\t\t\tdata: data,\n\t\t\t\tpassFlags: passFlags\n\t\t\t};\n\t\t}\n\t}\n\tsetRealtimeLightmap(name, texture) {\n\t\tconst old = this.getParameter(name);\n\t\tif (old === texture) return;\n\t\tif (old) {\n\t\t\tLightmapCache.decRef(old.data);\n\t\t}\n\t\tif (texture) {\n\t\t\tLightmapCache.incRef(texture);\n\t\t\tthis.setParameter(name, texture);\n\t\t} else {\n\t\t\tthis.deleteParameter(name);\n\t\t}\n\t}\n\tdeleteParameter(name) {\n\t\tif (this.parameters[name]) {\n\t\t\tdelete this.parameters[name];\n\t\t}\n\t}\n\tsetParameters(device, passFlag) {\n\t\tconst parameters = this.parameters;\n\t\tfor (const paramName in parameters) {\n\t\t\tconst parameter = parameters[paramName];\n\t\t\tif (parameter.passFlags & passFlag) {\n\t\t\t\tif (!parameter.scopeId) {\n\t\t\t\t\tparameter.scopeId = device.scope.resolve(paramName);\n\t\t\t\t}\n\t\t\t\tparameter.scopeId.setValue(parameter.data);\n\t\t\t}\n\t\t}\n\t}\n\tsetLightmapped(value) {\n\t\tif (value) {\n\t\t\tthis.mask = (this.mask | MASK_AFFECT_LIGHTMAPPED) & ~(MASK_AFFECT_DYNAMIC | MASK_BAKE);\n\t\t} else {\n\t\t\tthis.setRealtimeLightmap(MeshInstance.lightmapParamNames[0], null);\n\t\t\tthis.setRealtimeLightmap(MeshInstance.lightmapParamNames[1], null);\n\t\t\tthis._shaderDefs &= ~(SHADERDEF_LM | SHADERDEF_DIRLM | SHADERDEF_LMAMBIENT);\n\t\t\tthis.mask = (this.mask | MASK_AFFECT_DYNAMIC) & ~(MASK_AFFECT_LIGHTMAPPED | MASK_BAKE);\n\t\t}\n\t}\n\tsetCustomAabb(aabb) {\n\t\tif (aabb) {\n\t\t\tif (this._customAabb) {\n\t\t\t\tthis._customAabb.copy(aabb);\n\t\t\t} else {\n\t\t\t\tthis._customAabb = aabb.clone();\n\t\t\t}\n\t\t} else {\n\t\t\tthis._customAabb = null;\n\t\t\tthis._aabbVer = -1;\n\t\t}\n\t\tthis._setupSkinUpdate();\n\t}\n\t_setupSkinUpdate() {\n\t\tif (this._skinInstance) {\n\t\t\tthis._skinInstance._updateBeforeCull = !this._customAabb;\n\t\t}\n\t}\n}\nMeshInstance.lightmapParamNames = ['texture_lightMap', 'texture_dirLightMap'];\n\nexport { MeshInstance };\n","import '../../core/tracing.js';\nimport '../../core/time.js';\nimport { Mat3 } from '../../core/math/mat3.js';\nimport { Vec3 } from '../../core/math/vec3.js';\nimport { BoundingBox } from '../../core/shape/bounding-box.js';\nimport { PRIMITIVE_TRIFAN, PRIMITIVE_TRISTRIP, SEMANTIC_BLENDINDICES, TYPE_FLOAT32, typedArrayTypes, typedArrayTypesByteSize, SEMANTIC_POSITION, SEMANTIC_NORMAL, SEMANTIC_TANGENT, typedArrayIndexFormats, PRIMITIVE_TRIANGLES } from '../../platform/graphics/constants.js';\nimport { SPRITE_RENDERMODE_SIMPLE } from '../constants.js';\nimport { Mesh } from '../mesh.js';\nimport { MeshInstance } from '../mesh-instance.js';\nimport { shaderChunks } from '../shader-lib/chunks/chunks.js';\nimport { Batch } from './batch.js';\nimport { BatchGroup } from './batch-group.js';\nimport { SkinBatchInstance } from './skin-batch-instance.js';\n\nfunction paramsIdentical(a, b) {\n\tif (a && !b) return false;\n\tif (!a && b) return false;\n\ta = a.data;\n\tb = b.data;\n\tif (a === b) return true;\n\tif (a instanceof Float32Array && b instanceof Float32Array) {\n\t\tif (a.length !== b.length) return false;\n\t\tfor (let i = 0; i < a.length; i++) {\n\t\t\tif (a[i] !== b[i]) return false;\n\t\t}\n\t\treturn true;\n\t}\n\treturn false;\n}\nfunction equalParamSets(params1, params2) {\n\tfor (const param in params1) {\n\t\tif (params1.hasOwnProperty(param) && !paramsIdentical(params1[param], params2[param])) return false;\n\t}\n\tfor (const param in params2) {\n\t\tif (params2.hasOwnProperty(param) && !paramsIdentical(params2[param], params1[param])) return false;\n\t}\n\treturn true;\n}\nconst _triFanIndices = [0, 1, 3, 2, 3, 1];\nconst _triStripIndices = [0, 1, 3, 0, 3, 2];\nconst mat3 = new Mat3();\nfunction getScaleSign(mi) {\n\treturn mi.node.worldTransform.scaleSign;\n}\nclass BatchManager {\n\tconstructor(device, root, scene) {\n\t\tthis.device = device;\n\t\tthis.rootNode = root;\n\t\tthis.scene = scene;\n\t\tthis._init = false;\n\t\tthis._batchGroups = {};\n\t\tthis._batchGroupCounter = 0;\n\t\tthis._batchList = [];\n\t\tthis._dirtyGroups = [];\n\t}\n\tdestroy() {\n\t\tthis.device = null;\n\t\tthis.rootNode = null;\n\t\tthis.scene = null;\n\t\tthis._batchGroups = {};\n\t\tthis._batchList = [];\n\t\tthis._dirtyGroups = [];\n\t}\n\taddGroup(name, dynamic, maxAabbSize, id, layers) {\n\t\tif (id === undefined) {\n\t\t\tid = this._batchGroupCounter;\n\t\t\tthis._batchGroupCounter++;\n\t\t}\n\t\tif (this._batchGroups[id]) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst group = new BatchGroup(id, name, dynamic, maxAabbSize, layers);\n\t\tthis._batchGroups[id] = group;\n\t\treturn group;\n\t}\n\tremoveGroup(id) {\n\t\tif (!this._batchGroups[id]) {\n\t\t\treturn;\n\t\t}\n\t\tconst newBatchList = [];\n\t\tfor (let i = 0; i < this._batchList.length; i++) {\n\t\t\tif (this._batchList[i].batchGroupId === id) {\n\t\t\t\tthis.destroyBatch(this._batchList[i]);\n\t\t\t} else {\n\t\t\t\tnewBatchList.push(this._batchList[i]);\n\t\t\t}\n\t\t}\n\t\tthis._batchList = newBatchList;\n\t\tthis._removeModelsFromBatchGroup(this.rootNode, id);\n\t\tdelete this._batchGroups[id];\n\t}\n\tmarkGroupDirty(id) {\n\t\tif (this._dirtyGroups.indexOf(id) < 0) {\n\t\t\tthis._dirtyGroups.push(id);\n\t\t}\n\t}\n\tgetGroupByName(name) {\n\t\tconst groups = this._batchGroups;\n\t\tfor (const group in groups) {\n\t\t\tif (!groups.hasOwnProperty(group)) continue;\n\t\t\tif (groups[group].name === name) {\n\t\t\t\treturn groups[group];\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\tgetBatches(batchGroupId) {\n\t\tconst results = [];\n\t\tconst len = this._batchList.length;\n\t\tfor (let i = 0; i < len; i++) {\n\t\t\tconst batch = this._batchList[i];\n\t\t\tif (batch.batchGroupId === batchGroupId) {\n\t\t\t\tresults.push(batch);\n\t\t\t}\n\t\t}\n\t\treturn results;\n\t}\n\t_removeModelsFromBatchGroup(node, id) {\n\t\tif (!node.enabled) return;\n\t\tif (node.model && node.model.batchGroupId === id) {\n\t\t\tnode.model.batchGroupId = -1;\n\t\t}\n\t\tif (node.render && node.render.batchGroupId === id) {\n\t\t\tnode.render.batchGroupId = -1;\n\t\t}\n\t\tif (node.element && node.element.batchGroupId === id) {\n\t\t\tnode.element.batchGroupId = -1;\n\t\t}\n\t\tif (node.sprite && node.sprite.batchGroupId === id) {\n\t\t\tnode.sprite.batchGroupId = -1;\n\t\t}\n\t\tfor (let i = 0; i < node._children.length; i++) {\n\t\t\tthis._removeModelsFromBatchGroup(node._children[i], id);\n\t\t}\n\t}\n\tinsert(type, groupId, node) {\n\t\tconst group = this._batchGroups[groupId];\n\t\tif (group) {\n\t\t\tif (group._obj[type].indexOf(node) < 0) {\n\t\t\t\tgroup._obj[type].push(node);\n\t\t\t\tthis.markGroupDirty(groupId);\n\t\t\t}\n\t\t}\n\t}\n\tremove(type, groupId, node) {\n\t\tconst group = this._batchGroups[groupId];\n\t\tif (group) {\n\t\t\tconst idx = group._obj[type].indexOf(node);\n\t\t\tif (idx >= 0) {\n\t\t\t\tgroup._obj[type].splice(idx, 1);\n\t\t\t\tthis.markGroupDirty(groupId);\n\t\t\t}\n\t\t}\n\t}\n\t_extractRender(node, arr, group, groupMeshInstances) {\n\t\tif (node.render) {\n\t\t\tarr = groupMeshInstances[node.render.batchGroupId] = arr.concat(node.render.meshInstances);\n\t\t\tnode.render.removeFromLayers();\n\t\t}\n\t\treturn arr;\n\t}\n\t_extractModel(node, arr, group, groupMeshInstances) {\n\t\tif (node.model && node.model.model) {\n\t\t\tarr = groupMeshInstances[node.model.batchGroupId] = arr.concat(node.model.meshInstances);\n\t\t\tnode.model.removeModelFromLayers();\n\t\t}\n\t\treturn arr;\n\t}\n\t_extractElement(node, arr, group) {\n\t\tif (!node.element) return;\n\t\tlet valid = false;\n\t\tif (node.element._text && node.element._text._model.meshInstances.length > 0) {\n\t\t\tarr.push(node.element._text._model.meshInstances[0]);\n\t\t\tnode.element.removeModelFromLayers(node.element._text._model);\n\t\t\tvalid = true;\n\t\t} else if (node.element._image) {\n\t\t\tarr.push(node.element._image._renderable.meshInstance);\n\t\t\tnode.element.removeModelFromLayers(node.element._image._renderable.model);\n\t\t\tif (node.element._image._renderable.unmaskMeshInstance) {\n\t\t\t\tarr.push(node.element._image._renderable.unmaskMeshInstance);\n\t\t\t\tif (!node.element._image._renderable.unmaskMeshInstance.stencilFront || !node.element._image._renderable.unmaskMeshInstance.stencilBack) {\n\t\t\t\t\tnode.element._dirtifyMask();\n\t\t\t\t\tnode.element._onPrerender();\n\t\t\t\t}\n\t\t\t}\n\t\t\tvalid = true;\n\t\t}\n\t\tif (valid) {\n\t\t\tgroup._ui = true;\n\t\t}\n\t}\n\t_collectAndRemoveMeshInstances(groupMeshInstances, groupIds) {\n\t\tfor (let g = 0; g < groupIds.length; g++) {\n\t\t\tconst id = groupIds[g];\n\t\t\tconst group = this._batchGroups[id];\n\t\t\tif (!group) continue;\n\t\t\tlet arr = groupMeshInstances[id];\n\t\t\tif (!arr) arr = groupMeshInstances[id] = [];\n\t\t\tfor (let m = 0; m < group._obj.model.length; m++) {\n\t\t\t\tarr = this._extractModel(group._obj.model[m], arr, group, groupMeshInstances);\n\t\t\t}\n\t\t\tfor (let r = 0; r < group._obj.render.length; r++) {\n\t\t\t\tarr = this._extractRender(group._obj.render[r], arr, group, groupMeshInstances);\n\t\t\t}\n\t\t\tfor (let e = 0; e < group._obj.element.length; e++) {\n\t\t\t\tthis._extractElement(group._obj.element[e], arr, group);\n\t\t\t}\n\t\t\tfor (let s = 0; s < group._obj.sprite.length; s++) {\n\t\t\t\tconst node = group._obj.sprite[s];\n\t\t\t\tif (node.sprite && node.sprite._meshInstance && (group.dynamic || node.sprite.sprite._renderMode === SPRITE_RENDERMODE_SIMPLE)) {\n\t\t\t\t\tarr.push(node.sprite._meshInstance);\n\t\t\t\t\tnode.sprite.removeModelFromLayers();\n\t\t\t\t\tgroup._sprite = true;\n\t\t\t\t\tnode.sprite._batchGroup = group;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tgenerate(groupIds) {\n\t\tconst groupMeshInstances = {};\n\t\tif (!groupIds) {\n\t\t\tgroupIds = Object.keys(this._batchGroups);\n\t\t}\n\t\tconst newBatchList = [];\n\t\tfor (let i = 0; i < this._batchList.length; i++) {\n\t\t\tif (groupIds.indexOf(this._batchList[i].batchGroupId) < 0) {\n\t\t\t\tnewBatchList.push(this._batchList[i]);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tthis.destroyBatch(this._batchList[i]);\n\t\t}\n\t\tthis._batchList = newBatchList;\n\t\tthis._collectAndRemoveMeshInstances(groupMeshInstances, groupIds);\n\t\tif (groupIds === this._dirtyGroups) {\n\t\t\tthis._dirtyGroups.length = 0;\n\t\t} else {\n\t\t\tconst newDirtyGroups = [];\n\t\t\tfor (let i = 0; i < this._dirtyGroups.length; i++) {\n\t\t\t\tif (groupIds.indexOf(this._dirtyGroups[i]) < 0) newDirtyGroups.push(this._dirtyGroups[i]);\n\t\t\t}\n\t\t\tthis._dirtyGroups = newDirtyGroups;\n\t\t}\n\t\tlet group, lists, groupData, batch;\n\t\tfor (const groupId in groupMeshInstances) {\n\t\t\tif (!groupMeshInstances.hasOwnProperty(groupId)) continue;\n\t\t\tgroup = groupMeshInstances[groupId];\n\t\t\tgroupData = this._batchGroups[groupId];\n\t\t\tif (!groupData) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlists = this.prepare(group, groupData.dynamic, groupData.maxAabbSize, groupData._ui || groupData._sprite);\n\t\t\tfor (let i = 0; i < lists.length; i++) {\n\t\t\t\tbatch = this.create(lists[i], groupData.dynamic, parseInt(groupId, 10));\n\t\t\t\tif (batch) {\n\t\t\t\t\tbatch.addToLayers(this.scene, groupData.layers);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tprepare(meshInstances, dynamic, maxAabbSize = Number.POSITIVE_INFINITY, translucent) {\n\t\tif (meshInstances.length === 0) return [];\n\t\tconst halfMaxAabbSize = maxAabbSize * 0.5;\n\t\tconst maxInstanceCount = this.device.supportsBoneTextures ? 1024 : this.device.boneLimit;\n\t\tconst maxNumVertices = this.device.extUintElement ? 0xffffffff : 0xffff;\n\t\tconst aabb = new BoundingBox();\n\t\tconst testAabb = new BoundingBox();\n\t\tlet skipTranslucentAabb = null;\n\t\tlet sf;\n\t\tconst lists = [];\n\t\tlet j = 0;\n\t\tif (translucent) {\n\t\t\tmeshInstances.sort(function (a, b) {\n\t\t\t\treturn a.drawOrder - b.drawOrder;\n\t\t\t});\n\t\t}\n\t\tlet meshInstancesLeftA = meshInstances;\n\t\tlet meshInstancesLeftB;\n\t\tconst skipMesh = translucent ? function (mi) {\n\t\t\tif (skipTranslucentAabb) {\n\t\t\t\tskipTranslucentAabb.add(mi.aabb);\n\t\t\t} else {\n\t\t\t\tskipTranslucentAabb = mi.aabb.clone();\n\t\t\t}\n\t\t\tmeshInstancesLeftB.push(mi);\n\t\t} : function (mi) {\n\t\t\tmeshInstancesLeftB.push(mi);\n\t\t};\n\t\twhile (meshInstancesLeftA.length > 0) {\n\t\t\tlists[j] = [meshInstancesLeftA[0]];\n\t\t\tmeshInstancesLeftB = [];\n\t\t\tconst material = meshInstancesLeftA[0].material;\n\t\t\tconst layer = meshInstancesLeftA[0].layer;\n\t\t\tconst defs = meshInstancesLeftA[0]._shaderDefs;\n\t\t\tconst params = meshInstancesLeftA[0].parameters;\n\t\t\tconst stencil = meshInstancesLeftA[0].stencilFront;\n\t\t\tlet vertCount = meshInstancesLeftA[0].mesh.vertexBuffer.getNumVertices();\n\t\t\tconst drawOrder = meshInstancesLeftA[0].drawOrder;\n\t\t\taabb.copy(meshInstancesLeftA[0].aabb);\n\t\t\tconst scaleSign = getScaleSign(meshInstancesLeftA[0]);\n\t\t\tconst vertexFormatBatchingHash = meshInstancesLeftA[0].mesh.vertexBuffer.format.batchingHash;\n\t\t\tconst indexed = meshInstancesLeftA[0].mesh.primitive[0].indexed;\n\t\t\tskipTranslucentAabb = null;\n\t\t\tfor (let i = 1; i < meshInstancesLeftA.length; i++) {\n\t\t\t\tconst mi = meshInstancesLeftA[i];\n\t\t\t\tif (dynamic && lists[j].length >= maxInstanceCount) {\n\t\t\t\t\tmeshInstancesLeftB = meshInstancesLeftB.concat(meshInstancesLeftA.slice(i));\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (material !== mi.material || layer !== mi.layer || vertexFormatBatchingHash !== mi.mesh.vertexBuffer.format.batchingHash || indexed !== mi.mesh.primitive[0].indexed || defs !== mi._shaderDefs || vertCount + mi.mesh.vertexBuffer.getNumVertices() > maxNumVertices) {\n\t\t\t\t\tskipMesh(mi);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\ttestAabb.copy(aabb);\n\t\t\t\ttestAabb.add(mi.aabb);\n\t\t\t\tif (testAabb.halfExtents.x > halfMaxAabbSize || testAabb.halfExtents.y > halfMaxAabbSize || testAabb.halfExtents.z > halfMaxAabbSize) {\n\t\t\t\t\tskipMesh(mi);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (stencil) {\n\t\t\t\t\tif (!(sf = mi.stencilFront) || stencil.func !== sf.func || stencil.zpass !== sf.zpass) {\n\t\t\t\t\t\tskipMesh(mi);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (scaleSign !== getScaleSign(mi)) {\n\t\t\t\t\tskipMesh(mi);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (!equalParamSets(params, mi.parameters)) {\n\t\t\t\t\tskipMesh(mi);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (translucent && skipTranslucentAabb && skipTranslucentAabb.intersects(mi.aabb) && mi.drawOrder !== drawOrder) {\n\t\t\t\t\tskipMesh(mi);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\taabb.add(mi.aabb);\n\t\t\t\tvertCount += mi.mesh.vertexBuffer.getNumVertices();\n\t\t\t\tlists[j].push(mi);\n\t\t\t}\n\t\t\tj++;\n\t\t\tmeshInstancesLeftA = meshInstancesLeftB;\n\t\t}\n\t\treturn lists;\n\t}\n\tcollectBatchedMeshData(meshInstances, dynamic) {\n\t\tlet streams = null;\n\t\tlet batchNumVerts = 0;\n\t\tlet batchNumIndices = 0;\n\t\tlet material = null;\n\t\tfor (let i = 0; i < meshInstances.length; i++) {\n\t\t\tif (meshInstances[i].visible) {\n\t\t\t\tconst mesh = meshInstances[i].mesh;\n\t\t\t\tconst numVerts = mesh.vertexBuffer.numVertices;\n\t\t\t\tbatchNumVerts += numVerts;\n\t\t\t\tif (mesh.primitive[0].indexed) {\n\t\t\t\t\tbatchNumIndices += mesh.primitive[0].count;\n\t\t\t\t} else {\n\t\t\t\t\tconst primitiveType = mesh.primitive[0].type;\n\t\t\t\t\tif (primitiveType === PRIMITIVE_TRIFAN || primitiveType === PRIMITIVE_TRISTRIP) {\n\t\t\t\t\t\tif (mesh.primitive[0].count === 4) batchNumIndices += 6;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!streams) {\n\t\t\t\t\tmaterial = meshInstances[i].material;\n\t\t\t\t\tstreams = {};\n\t\t\t\t\tconst elems = mesh.vertexBuffer.format.elements;\n\t\t\t\t\tfor (let j = 0; j < elems.length; j++) {\n\t\t\t\t\t\tconst semantic = elems[j].name;\n\t\t\t\t\t\tstreams[semantic] = {\n\t\t\t\t\t\t\tnumComponents: elems[j].numComponents,\n\t\t\t\t\t\t\tdataType: elems[j].dataType,\n\t\t\t\t\t\t\tnormalize: elems[j].normalize,\n\t\t\t\t\t\t\tcount: 0\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\tif (dynamic) {\n\t\t\t\t\t\tstreams[SEMANTIC_BLENDINDICES] = {\n\t\t\t\t\t\t\tnumComponents: 1,\n\t\t\t\t\t\t\tdataType: TYPE_FLOAT32,\n\t\t\t\t\t\t\tnormalize: false,\n\t\t\t\t\t\t\tcount: 0\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\tstreams: streams,\n\t\t\tbatchNumVerts: batchNumVerts,\n\t\t\tbatchNumIndices: batchNumIndices,\n\t\t\tmaterial: material\n\t\t};\n\t}\n\tcreate(meshInstances, dynamic, batchGroupId) {\n\t\tif (!this._init) {\n\t\t\tconst boneLimit = '#define BONE_LIMIT ' + this.device.getBoneLimit() + '\\n';\n\t\t\tthis.transformVS = boneLimit + '#define DYNAMICBATCH\\n' + shaderChunks.transformVS;\n\t\t\tthis.skinTexVS = shaderChunks.skinBatchTexVS;\n\t\t\tthis.skinConstVS = shaderChunks.skinBatchConstVS;\n\t\t\tthis.vertexFormats = {};\n\t\t\tthis._init = true;\n\t\t}\n\t\tlet stream = null;\n\t\tlet semantic;\n\t\tlet mesh, numVerts;\n\t\tlet batch = null;\n\t\tconst batchData = this.collectBatchedMeshData(meshInstances, dynamic);\n\t\tif (batchData.streams) {\n\t\t\tconst streams = batchData.streams;\n\t\t\tlet material = batchData.material;\n\t\t\tconst batchNumVerts = batchData.batchNumVerts;\n\t\t\tconst batchNumIndices = batchData.batchNumIndices;\n\t\t\tbatch = new Batch(meshInstances, dynamic, batchGroupId);\n\t\t\tthis._batchList.push(batch);\n\t\t\tlet indexBase, numIndices, indexData;\n\t\t\tlet verticesOffset = 0;\n\t\t\tlet indexOffset = 0;\n\t\t\tlet transform;\n\t\t\tconst vec = new Vec3();\n\t\t\tconst indexArrayType = batchNumVerts <= 0xffff ? Uint16Array : Uint32Array;\n\t\t\tconst indices = new indexArrayType(batchNumIndices);\n\t\t\tfor (semantic in streams) {\n\t\t\t\tstream = streams[semantic];\n\t\t\t\tstream.typeArrayType = typedArrayTypes[stream.dataType];\n\t\t\t\tstream.elementByteSize = typedArrayTypesByteSize[stream.dataType];\n\t\t\t\tstream.buffer = new stream.typeArrayType(batchNumVerts * stream.numComponents);\n\t\t\t}\n\t\t\tfor (let i = 0; i < meshInstances.length; i++) {\n\t\t\t\tif (!meshInstances[i].visible) continue;\n\t\t\t\tmesh = meshInstances[i].mesh;\n\t\t\t\tnumVerts = mesh.vertexBuffer.numVertices;\n\t\t\t\tif (!dynamic) {\n\t\t\t\t\ttransform = meshInstances[i].node.getWorldTransform();\n\t\t\t\t}\n\t\t\t\tfor (semantic in streams) {\n\t\t\t\t\tif (semantic !== SEMANTIC_BLENDINDICES) {\n\t\t\t\t\t\tstream = streams[semantic];\n\t\t\t\t\t\tconst subarray = new stream.typeArrayType(stream.buffer.buffer, stream.elementByteSize * stream.count);\n\t\t\t\t\t\tconst totalComponents = mesh.getVertexStream(semantic, subarray) * stream.numComponents;\n\t\t\t\t\t\tstream.count += totalComponents;\n\t\t\t\t\t\tif (!dynamic && stream.numComponents >= 3) {\n\t\t\t\t\t\t\tif (semantic === SEMANTIC_POSITION) {\n\t\t\t\t\t\t\t\tfor (let j = 0; j < totalComponents; j += stream.numComponents) {\n\t\t\t\t\t\t\t\t\tvec.set(subarray[j], subarray[j + 1], subarray[j + 2]);\n\t\t\t\t\t\t\t\t\ttransform.transformPoint(vec, vec);\n\t\t\t\t\t\t\t\t\tsubarray[j] = vec.x;\n\t\t\t\t\t\t\t\t\tsubarray[j + 1] = vec.y;\n\t\t\t\t\t\t\t\t\tsubarray[j + 2] = vec.z;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if (semantic === SEMANTIC_NORMAL || semantic === SEMANTIC_TANGENT) {\n\t\t\t\t\t\t\t\tmat3.invertMat4(transform).transpose();\n\t\t\t\t\t\t\t\tfor (let j = 0; j < totalComponents; j += stream.numComponents) {\n\t\t\t\t\t\t\t\t\tvec.set(subarray[j], subarray[j + 1], subarray[j + 2]);\n\t\t\t\t\t\t\t\t\tmat3.transformVector(vec, vec);\n\t\t\t\t\t\t\t\t\tsubarray[j] = vec.x;\n\t\t\t\t\t\t\t\t\tsubarray[j + 1] = vec.y;\n\t\t\t\t\t\t\t\t\tsubarray[j + 2] = vec.z;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (dynamic) {\n\t\t\t\t\tstream = streams[SEMANTIC_BLENDINDICES];\n\t\t\t\t\tfor (let j = 0; j < numVerts; j++) stream.buffer[stream.count++] = i;\n\t\t\t\t}\n\t\t\t\tif (mesh.primitive[0].indexed) {\n\t\t\t\t\tindexBase = mesh.primitive[0].base;\n\t\t\t\t\tnumIndices = mesh.primitive[0].count;\n\t\t\t\t\tconst srcFormat = mesh.indexBuffer[0].getFormat();\n\t\t\t\t\tindexData = new typedArrayIndexFormats[srcFormat](mesh.indexBuffer[0].storage);\n\t\t\t\t} else {\n\t\t\t\t\tconst primitiveType = mesh.primitive[0].type;\n\t\t\t\t\tif (primitiveType === PRIMITIVE_TRIFAN || primitiveType === PRIMITIVE_TRISTRIP) {\n\t\t\t\t\t\tif (mesh.primitive[0].count === 4) {\n\t\t\t\t\t\t\tindexBase = 0;\n\t\t\t\t\t\t\tnumIndices = 6;\n\t\t\t\t\t\t\tindexData = primitiveType === PRIMITIVE_TRIFAN ? _triFanIndices : _triStripIndices;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnumIndices = 0;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (let j = 0; j < numIndices; j++) {\n\t\t\t\t\tindices[j + indexOffset] = indexData[indexBase + j] + verticesOffset;\n\t\t\t\t}\n\t\t\t\tindexOffset += numIndices;\n\t\t\t\tverticesOffset += numVerts;\n\t\t\t}\n\t\t\tmesh = new Mesh(this.device);\n\t\t\tfor (semantic in streams) {\n\t\t\t\tstream = streams[semantic];\n\t\t\t\tmesh.setVertexStream(semantic, stream.buffer, stream.numComponents, undefined, stream.dataType, stream.normalize);\n\t\t\t}\n\t\t\tif (indices.length > 0) mesh.setIndices(indices);\n\t\t\tmesh.update(PRIMITIVE_TRIANGLES, false);\n\t\t\tif (dynamic) {\n\t\t\t\tmaterial = material.clone();\n\t\t\t\tmaterial.chunks.transformVS = this.transformVS;\n\t\t\t\tmaterial.chunks.skinTexVS = this.skinTexVS;\n\t\t\t\tmaterial.chunks.skinConstVS = this.skinConstVS;\n\t\t\t\tmaterial.update();\n\t\t\t}\n\t\t\tconst meshInstance = new MeshInstance(mesh, material, this.rootNode);\n\t\t\tmeshInstance.castShadow = batch.origMeshInstances[0].castShadow;\n\t\t\tmeshInstance.parameters = batch.origMeshInstances[0].parameters;\n\t\t\tmeshInstance.layer = batch.origMeshInstances[0].layer;\n\t\t\tmeshInstance._shaderDefs = batch.origMeshInstances[0]._shaderDefs;\n\t\t\tmeshInstance.cull = batch.origMeshInstances[0].cull;\n\t\t\tconst batchGroup = this._batchGroups[batchGroupId];\n\t\t\tif (batchGroup && batchGroup._ui) meshInstance.cull = false;\n\t\t\tif (dynamic) {\n\t\t\t\tconst nodes = [];\n\t\t\t\tfor (let i = 0; i < batch.origMeshInstances.length; i++) {\n\t\t\t\t\tnodes.push(batch.origMeshInstances[i].node);\n\t\t\t\t}\n\t\t\t\tmeshInstance.skinInstance = new SkinBatchInstance(this.device, nodes, this.rootNode);\n\t\t\t}\n\t\t\tmeshInstance._updateAabb = false;\n\t\t\tmeshInstance.drawOrder = batch.origMeshInstances[0].drawOrder;\n\t\t\tmeshInstance.stencilFront = batch.origMeshInstances[0].stencilFront;\n\t\t\tmeshInstance.stencilBack = batch.origMeshInstances[0].stencilBack;\n\t\t\tmeshInstance.flipFacesFactor = getScaleSign(batch.origMeshInstances[0]);\n\t\t\tmeshInstance.castShadow = batch.origMeshInstances[0].castShadow;\n\t\t\tbatch.meshInstance = meshInstance;\n\t\t\tbatch.updateBoundingBox();\n\t\t}\n\t\treturn batch;\n\t}\n\tupdateAll() {\n\t\tif (this._dirtyGroups.length > 0) {\n\t\t\tthis.generate(this._dirtyGroups);\n\t\t}\n\t\tfor (let i = 0; i < this._batchList.length; i++) {\n\t\t\tif (!this._batchList[i].dynamic) continue;\n\t\t\tthis._batchList[i].updateBoundingBox();\n\t\t}\n\t}\n\tclone(batch, clonedMeshInstances) {\n\t\tconst batch2 = new Batch(clonedMeshInstances, batch.dynamic, batch.batchGroupId);\n\t\tthis._batchList.push(batch2);\n\t\tconst nodes = [];\n\t\tfor (let i = 0; i < clonedMeshInstances.length; i++) {\n\t\t\tnodes.push(clonedMeshInstances[i].node);\n\t\t}\n\t\tbatch2.meshInstance = new MeshInstance(batch.meshInstance.mesh, batch.meshInstance.material, batch.meshInstance.node);\n\t\tbatch2.meshInstance._updateAabb = false;\n\t\tbatch2.meshInstance.parameters = clonedMeshInstances[0].parameters;\n\t\tbatch2.meshInstance.cull = clonedMeshInstances[0].cull;\n\t\tbatch2.meshInstance.layer = clonedMeshInstances[0].layer;\n\t\tif (batch.dynamic) {\n\t\t\tbatch2.meshInstance.skinInstance = new SkinBatchInstance(this.device, nodes, this.rootNode);\n\t\t}\n\t\tbatch2.meshInstance.castShadow = batch.meshInstance.castShadow;\n\t\tbatch2.meshInstance._shader = batch.meshInstance._shader.slice();\n\t\tbatch2.meshInstance.castShadow = batch.meshInstance.castShadow;\n\t\treturn batch2;\n\t}\n\tdestroyBatch(batch) {\n\t\tbatch.destroy(this.scene, this._batchGroups[batch.batchGroupId].layers);\n\t}\n}\n\nexport { BatchManager };\n","import { FILTER_LINEAR_MIPMAP_LINEAR, FILTER_LINEAR, ADDRESS_CLAMP_TO_EDGE } from '../../platform/graphics/constants.js';\nimport { RenderPass } from '../../platform/graphics/render-pass.js';\nimport { RenderTarget } from '../../platform/graphics/render-target.js';\nimport { Texture } from '../../platform/graphics/texture.js';\n\nconst _colorUniformNames = ['uSceneColorMap', 'texture_grabPass'];\nclass RenderPassColorGrab extends RenderPass {\n\tconstructor(device, camera) {\n\t\tsuper(device);\n\t\tthis.colorRenderTarget = null;\n\t\tthis.camera = null;\n\t\tthis.camera = camera;\n\t}\n\tdestroy() {\n\t\tsuper.destroy();\n\t\tthis.releaseRenderTarget(this.colorRenderTarget);\n\t}\n\tshouldReallocate(targetRT, sourceTexture, sourceFormat) {\n\t\tconst targetFormat = targetRT == null ? void 0 : targetRT.colorBuffer.format;\n\t\tif (targetFormat !== sourceFormat) return true;\n\t\tconst width = (sourceTexture == null ? void 0 : sourceTexture.width) || this.device.width;\n\t\tconst height = (sourceTexture == null ? void 0 : sourceTexture.height) || this.device.height;\n\t\treturn !targetRT || width !== targetRT.width || height !== targetRT.height;\n\t}\n\tallocateRenderTarget(renderTarget, sourceRenderTarget, device, format) {\n\t\tconst mipmaps = device.isWebGL2;\n\t\tconst texture = new Texture(device, {\n\t\t\tname: _colorUniformNames[0],\n\t\t\tformat,\n\t\t\twidth: sourceRenderTarget ? sourceRenderTarget.colorBuffer.width : device.width,\n\t\t\theight: sourceRenderTarget ? sourceRenderTarget.colorBuffer.height : device.height,\n\t\t\tmipmaps,\n\t\t\tminFilter: mipmaps ? FILTER_LINEAR_MIPMAP_LINEAR : FILTER_LINEAR,\n\t\t\tmagFilter: FILTER_LINEAR,\n\t\t\taddressU: ADDRESS_CLAMP_TO_EDGE,\n\t\t\taddressV: ADDRESS_CLAMP_TO_EDGE\n\t\t});\n\t\tif (renderTarget) {\n\t\t\trenderTarget.destroyFrameBuffers();\n\t\t\trenderTarget._colorBuffer = texture;\n\t\t\trenderTarget._colorBuffers = [texture];\n\t\t} else {\n\t\t\trenderTarget = new RenderTarget({\n\t\t\t\tname: 'ColorGrabRT',\n\t\t\t\tcolorBuffer: texture,\n\t\t\t\tdepth: false,\n\t\t\t\tstencil: false,\n\t\t\t\tautoResolve: false\n\t\t\t});\n\t\t}\n\t\treturn renderTarget;\n\t}\n\treleaseRenderTarget(rt) {\n\t\tif (rt) {\n\t\t\trt.destroyTextureBuffers();\n\t\t\trt.destroy();\n\t\t}\n\t}\n\tbefore() {\n\t\tvar _camera$renderTarget$, _camera$renderTarget, _camera$renderTarget2;\n\t\tconst camera = this.camera;\n\t\tconst device = this.device;\n\t\tconst sourceFormat = (_camera$renderTarget$ = (_camera$renderTarget = camera.renderTarget) == null ? void 0 : _camera$renderTarget.colorBuffer.format) != null ? _camera$renderTarget$ : this.device.backBufferFormat;\n\t\tif (this.shouldReallocate(this.colorRenderTarget, (_camera$renderTarget2 = camera.renderTarget) == null ? void 0 : _camera$renderTarget2.colorBuffer, sourceFormat)) {\n\t\t\tthis.releaseRenderTarget(this.colorRenderTarget);\n\t\t\tthis.colorRenderTarget = this.allocateRenderTarget(this.colorRenderTarget, camera.renderTarget, device, sourceFormat);\n\t\t}\n\t\tconst colorBuffer = this.colorRenderTarget.colorBuffer;\n\t\t_colorUniformNames.forEach(name => device.scope.resolve(name).setValue(colorBuffer));\n\t}\n\texecute() {\n\t\tconst device = this.device;\n\t\tconst colorBuffer = this.colorRenderTarget.colorBuffer;\n\t\tif (device.isWebGPU) {\n\t\t\tdevice.copyRenderTarget(this.camera.renderTarget, this.colorRenderTarget, true, false);\n\t\t\tdevice.mipmapRenderer.generate(this.colorRenderTarget.colorBuffer.impl);\n\t\t} else if (device.isWebGL2) {\n\t\t\tdevice.copyRenderTarget(device.renderTarget, this.colorRenderTarget, true, false);\n\t\t\tdevice.activeTexture(device.maxCombinedTextures - 1);\n\t\t\tdevice.bindTexture(colorBuffer);\n\t\t\tdevice.gl.generateMipmap(colorBuffer.impl._glTarget);\n\t\t} else {\n\t\t\tif (!colorBuffer.impl._glTexture) {\n\t\t\t\tcolorBuffer.impl.initialize(device, colorBuffer);\n\t\t\t}\n\t\t\tdevice.bindTexture(colorBuffer);\n\t\t\tconst gl = device.gl;\n\t\t\tgl.copyTexImage2D(gl.TEXTURE_2D, 0, colorBuffer.impl._glFormat, 0, 0, colorBuffer.width, colorBuffer.height, 0);\n\t\t\tcolorBuffer._needsUpload = false;\n\t\t\tcolorBuffer._needsMipmapsUpload = false;\n\t\t}\n\t}\n}\n\nexport { RenderPassColorGrab };\n","import { FILTER_NEAREST, ADDRESS_CLAMP_TO_EDGE, PIXELFORMAT_DEPTHSTENCIL, PIXELFORMAT_R32F } from '../../platform/graphics/constants.js';\nimport { RenderPass } from '../../platform/graphics/render-pass.js';\nimport { RenderTarget } from '../../platform/graphics/render-target.js';\nimport { Texture } from '../../platform/graphics/texture.js';\n\nconst _depthUniformNames = ['uSceneDepthMap', 'uDepthMap'];\nclass RenderPassDepthGrab extends RenderPass {\n\tconstructor(device, camera) {\n\t\tsuper(device);\n\t\tthis.depthRenderTarget = null;\n\t\tthis.camera = null;\n\t\tthis.camera = camera;\n\t}\n\tdestroy() {\n\t\tsuper.destroy();\n\t\tthis.releaseRenderTarget(this.depthRenderTarget);\n\t}\n\tshouldReallocate(targetRT, sourceTexture) {\n\t\tconst width = (sourceTexture == null ? void 0 : sourceTexture.width) || this.device.width;\n\t\tconst height = (sourceTexture == null ? void 0 : sourceTexture.height) || this.device.height;\n\t\treturn !targetRT || width !== targetRT.width || height !== targetRT.height;\n\t}\n\tallocateRenderTarget(renderTarget, sourceRenderTarget, device, format, isDepth) {\n\t\tconst texture = new Texture(device, {\n\t\t\tname: _depthUniformNames[0],\n\t\t\tformat,\n\t\t\twidth: sourceRenderTarget ? sourceRenderTarget.colorBuffer.width : device.width,\n\t\t\theight: sourceRenderTarget ? sourceRenderTarget.colorBuffer.height : device.height,\n\t\t\tmipmaps: false,\n\t\t\tminFilter: FILTER_NEAREST,\n\t\t\tmagFilter: FILTER_NEAREST,\n\t\t\taddressU: ADDRESS_CLAMP_TO_EDGE,\n\t\t\taddressV: ADDRESS_CLAMP_TO_EDGE\n\t\t});\n\t\tif (renderTarget) {\n\t\t\trenderTarget.destroyFrameBuffers();\n\t\t\tif (isDepth) {\n\t\t\t\trenderTarget._depthBuffer = texture;\n\t\t\t} else {\n\t\t\t\trenderTarget._colorBuffer = texture;\n\t\t\t\trenderTarget._colorBuffers = [texture];\n\t\t\t}\n\t\t} else {\n\t\t\trenderTarget = new RenderTarget({\n\t\t\t\tname: 'DepthGrabRT',\n\t\t\t\tcolorBuffer: isDepth ? null : texture,\n\t\t\t\tdepthBuffer: isDepth ? texture : null,\n\t\t\t\tdepth: !isDepth,\n\t\t\t\tstencil: device.supportsStencil,\n\t\t\t\tautoResolve: false\n\t\t\t});\n\t\t}\n\t\treturn renderTarget;\n\t}\n\treleaseRenderTarget(rt) {\n\t\tif (rt) {\n\t\t\trt.destroyTextureBuffers();\n\t\t\trt.destroy();\n\t\t}\n\t}\n\tbefore() {\n\t\tvar _camera$renderTarget$2, _camera$renderTarget2, _camera$renderTarget3;\n\t\tconst camera = this.camera;\n\t\tconst device = this.device;\n\t\tlet useDepthBuffer = true;\n\t\tlet format = PIXELFORMAT_DEPTHSTENCIL;\n\t\tif (device.isWebGPU) {\n\t\t\tvar _camera$renderTarget$, _camera$renderTarget;\n\t\t\tconst numSamples = (_camera$renderTarget$ = (_camera$renderTarget = camera.renderTarget) == null ? void 0 : _camera$renderTarget.samples) != null ? _camera$renderTarget$ : device.samples;\n\t\t\tif (numSamples > 1) {\n\t\t\t\tformat = PIXELFORMAT_R32F;\n\t\t\t\tuseDepthBuffer = false;\n\t\t\t}\n\t\t}\n\t\tconst sourceTexture = (_camera$renderTarget$2 = (_camera$renderTarget2 = camera.renderTarget) == null ? void 0 : _camera$renderTarget2.depthBuffer) != null ? _camera$renderTarget$2 : (_camera$renderTarget3 = camera.renderTarget) == null ? void 0 : _camera$renderTarget3.colorBuffer;\n\t\tif (this.shouldReallocate(this.depthRenderTarget, sourceTexture)) {\n\t\t\tthis.releaseRenderTarget(this.depthRenderTarget);\n\t\t\tthis.depthRenderTarget = this.allocateRenderTarget(this.depthRenderTarget, camera.renderTarget, device, format, useDepthBuffer);\n\t\t}\n\t\tconst colorBuffer = useDepthBuffer ? this.depthRenderTarget.depthBuffer : this.depthRenderTarget.colorBuffer;\n\t\t_depthUniformNames.forEach(name => device.scope.resolve(name).setValue(colorBuffer));\n\t}\n\texecute() {\n\t\tconst device = this.device;\n\t\tif (device.isWebGL2 && device.renderTarget.samples > 1) {\n\t\t\tconst src = device.renderTarget.impl._glFrameBuffer;\n\t\t\tconst dest = this.depthRenderTarget;\n\t\t\tdevice.renderTarget = dest;\n\t\t\tdevice.updateBegin();\n\t\t\tthis.depthRenderTarget.impl.internalResolve(device, src, dest.impl._glFrameBuffer, this.depthRenderTarget, device.gl.DEPTH_BUFFER_BIT);\n\t\t} else {\n\t\t\tdevice.copyRenderTarget(device.renderTarget, this.depthRenderTarget, false, true);\n\t\t}\n\t}\n}\n\nexport { RenderPassDepthGrab };\n","import { Color } from '../../core/math/color.js';\nimport { PIXELFORMAT_RGBA8, FILTER_NEAREST, ADDRESS_CLAMP_TO_EDGE } from '../../platform/graphics/constants.js';\nimport { Texture } from '../../platform/graphics/texture.js';\nimport { RenderPass } from '../../platform/graphics/render-pass.js';\nimport { BlendState } from '../../platform/graphics/blend-state.js';\nimport { RenderTarget } from '../../platform/graphics/render-target.js';\nimport { LAYERID_DEPTH, SHADER_DEPTH } from '../constants.js';\n\nconst webgl1DepthClearColor = new Color(254.0 / 255, 254.0 / 255, 254.0 / 255, 254.0 / 255);\nconst tempMeshInstances = [];\nconst lights = [[], [], []];\nconst _depthUniformNames = ['uSceneDepthMap', 'uDepthMap'];\nclass RenderPassDepth extends RenderPass {\n\tconstructor(device, renderer, camera) {\n\t\tsuper(device);\n\t\tthis.renderer = renderer;\n\t\tthis.camera = camera;\n\t}\n\tdestroy() {\n\t\tsuper.destroy();\n\t\tthis.releaseRenderTarget(this.renderTarget);\n\t}\n\tupdate(scene) {\n\t\tthis.scene = scene;\n\t}\n\tshouldReallocate(targetRT, sourceRT) {\n\t\tconst width = sourceRT.width;\n\t\tconst height = sourceRT.height;\n\t\treturn !targetRT || width !== targetRT.width || height !== targetRT.height;\n\t}\n\tallocateRenderTarget(renderTarget, sourceRT, device) {\n\t\tvar _sourceRT$width, _sourceRT$height;\n\t\tconst texture = new Texture(device, {\n\t\t\tname: _depthUniformNames[0],\n\t\t\tformat: PIXELFORMAT_RGBA8,\n\t\t\twidth: (_sourceRT$width = sourceRT == null ? void 0 : sourceRT.width) != null ? _sourceRT$width : this.device.width,\n\t\t\theight: (_sourceRT$height = sourceRT == null ? void 0 : sourceRT.height) != null ? _sourceRT$height : this.device.height,\n\t\t\tmipmaps: false,\n\t\t\tminFilter: FILTER_NEAREST,\n\t\t\tmagFilter: FILTER_NEAREST,\n\t\t\taddressU: ADDRESS_CLAMP_TO_EDGE,\n\t\t\taddressV: ADDRESS_CLAMP_TO_EDGE\n\t\t});\n\t\tif (renderTarget) {\n\t\t\trenderTarget.destroyFrameBuffers();\n\t\t\trenderTarget._colorBuffer = texture;\n\t\t\trenderTarget._colorBuffers = [texture];\n\t\t} else {\n\t\t\trenderTarget = new RenderTarget({\n\t\t\t\tname: `${_depthUniformNames[0]}RT}`,\n\t\t\t\tcolorBuffer: texture,\n\t\t\t\tdepth: true,\n\t\t\t\tstencil: false\n\t\t\t});\n\t\t}\n\t\treturn renderTarget;\n\t}\n\treleaseRenderTarget(rt) {\n\t\tif (rt) {\n\t\t\trt.destroyTextureBuffers();\n\t\t\trt.destroy();\n\t\t}\n\t}\n\tbefore() {\n\t\tvar _camera$renderTarget;\n\t\tconst camera = this.camera;\n\t\tconst device = this.device;\n\t\tconst sourceRT = (_camera$renderTarget = camera.renderTarget) != null ? _camera$renderTarget : device.backBuffer;\n\t\tif (this.shouldReallocate(this.renderTarget, sourceRT)) {\n\t\t\tvar _this$renderTarget;\n\t\t\t(_this$renderTarget = this.renderTarget) == null || _this$renderTarget.destroyTextureBuffers();\n\t\t\tconst renderTarget = this.allocateRenderTarget(this.renderTarget, camera.renderTarget, device);\n\t\t\tif (!this.renderTarget) {\n\t\t\t\tthis.init(renderTarget);\n\t\t\t\tthis.setClearColor(webgl1DepthClearColor);\n\t\t\t\tthis.setClearDepth(1.0);\n\t\t\t} else {\n\t\t\t\tthis.renderTarget = renderTarget;\n\t\t\t}\n\t\t}\n\t\tconst colorBuffer = this.renderTarget.colorBuffer;\n\t\t_depthUniformNames.forEach(name => device.scope.resolve(name).setValue(colorBuffer));\n\t}\n\texecute() {\n\t\tconst {\n\t\t\tdevice,\n\t\t\trenderer,\n\t\t\tcamera,\n\t\t\tscene,\n\t\t\trenderTarget\n\t\t} = this;\n\t\tconst layers = scene.layers.layerList;\n\t\tconst subLayerEnabled = scene.layers.subLayerEnabled;\n\t\tconst isTransparent = scene.layers.subLayerList;\n\t\tfor (let i = 0; i < layers.length; i++) {\n\t\t\tconst layer = layers[i];\n\t\t\tif (layer.enabled && subLayerEnabled[i]) {\n\t\t\t\tif (layer.camerasSet.has(camera)) {\n\t\t\t\t\tif (layer.id === LAYERID_DEPTH) break;\n\t\t\t\t\tconst culledInstances = layer.getCulledInstances(camera);\n\t\t\t\t\tconst meshInstances = isTransparent[i] ? culledInstances.transparent : culledInstances.opaque;\n\t\t\t\t\tfor (let j = 0; j < meshInstances.length; j++) {\n\t\t\t\t\t\tvar _meshInstance$materia;\n\t\t\t\t\t\tconst meshInstance = meshInstances[j];\n\t\t\t\t\t\tif ((_meshInstance$materia = meshInstance.material) != null && _meshInstance$materia.depthWrite && !meshInstance._noDepthDrawGl1) {\n\t\t\t\t\t\t\ttempMeshInstances.push(meshInstance);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\trenderer.setCameraUniforms(camera, renderTarget);\n\t\t\t\t\trenderer.renderForward(camera, tempMeshInstances, lights, SHADER_DEPTH, meshInstance => {\n\t\t\t\t\t\tdevice.setBlendState(BlendState.NOBLEND);\n\t\t\t\t\t}, layer);\n\t\t\t\t\ttempMeshInstances.length = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport { RenderPassDepth };\n","import { Color } from '../core/math/color.js';\nimport { Mat4 } from '../core/math/mat4.js';\nimport { Vec3 } from '../core/math/vec3.js';\nimport { Vec4 } from '../core/math/vec4.js';\nimport { math } from '../core/math/math.js';\nimport { Frustum } from '../core/shape/frustum.js';\nimport { ASPECT_AUTO, LAYERID_WORLD, LAYERID_DEPTH, LAYERID_SKYBOX, LAYERID_UI, LAYERID_IMMEDIATE, PROJECTION_PERSPECTIVE } from './constants.js';\nimport { RenderPassColorGrab } from './graphics/render-pass-color-grab.js';\nimport { RenderPassDepthGrab } from './graphics/render-pass-depth-grab.js';\nimport { RenderPassDepth } from './graphics/render-pass-depth.js';\n\nconst _deviceCoord = new Vec3();\nconst _halfSize = new Vec3();\nconst _point = new Vec3();\nconst _invViewProjMat = new Mat4();\nconst _frustumPoints = [new Vec3(), new Vec3(), new Vec3(), new Vec3(), new Vec3(), new Vec3(), new Vec3(), new Vec3()];\nclass Camera {\n\tconstructor() {\n\t\tthis.shaderPassInfo = null;\n\t\tthis.renderPassColorGrab = null;\n\t\tthis.renderPassDepthGrab = null;\n\t\tthis.renderPasses = [];\n\t\tthis._aspectRatio = 16 / 9;\n\t\tthis._aspectRatioMode = ASPECT_AUTO;\n\t\tthis._calculateProjection = null;\n\t\tthis._calculateTransform = null;\n\t\tthis._clearColor = new Color(0.75, 0.75, 0.75, 1);\n\t\tthis._clearColorBuffer = true;\n\t\tthis._clearDepth = 1;\n\t\tthis._clearDepthBuffer = true;\n\t\tthis._clearStencil = 0;\n\t\tthis._clearStencilBuffer = true;\n\t\tthis._cullFaces = true;\n\t\tthis._farClip = 1000;\n\t\tthis._flipFaces = false;\n\t\tthis._fov = 45;\n\t\tthis._frustumCulling = true;\n\t\tthis._horizontalFov = false;\n\t\tthis._layers = [LAYERID_WORLD, LAYERID_DEPTH, LAYERID_SKYBOX, LAYERID_UI, LAYERID_IMMEDIATE];\n\t\tthis._layersSet = new Set(this._layers);\n\t\tthis._nearClip = 0.1;\n\t\tthis._node = null;\n\t\tthis._orthoHeight = 10;\n\t\tthis._projection = PROJECTION_PERSPECTIVE;\n\t\tthis._rect = new Vec4(0, 0, 1, 1);\n\t\tthis._renderTarget = null;\n\t\tthis._scissorRect = new Vec4(0, 0, 1, 1);\n\t\tthis._scissorRectClear = false;\n\t\tthis._aperture = 16.0;\n\t\tthis._shutter = 1.0 / 1000.0;\n\t\tthis._sensitivity = 1000;\n\t\tthis._projMat = new Mat4();\n\t\tthis._projMatDirty = true;\n\t\tthis._projMatSkybox = new Mat4();\n\t\tthis._viewMat = new Mat4();\n\t\tthis._viewMatDirty = true;\n\t\tthis._viewProjMat = new Mat4();\n\t\tthis._viewProjMatDirty = true;\n\t\tthis.frustum = new Frustum();\n\t\tthis._xr = null;\n\t\tthis._xrProperties = {\n\t\t\thorizontalFov: this._horizontalFov,\n\t\t\tfov: this._fov,\n\t\t\taspectRatio: this._aspectRatio,\n\t\t\tfarClip: this._farClip,\n\t\t\tnearClip: this._nearClip\n\t\t};\n\t}\n\tdestroy() {\n\t\tvar _this$renderPassColor, _this$renderPassDepth;\n\t\t(_this$renderPassColor = this.renderPassColorGrab) == null || _this$renderPassColor.destroy();\n\t\tthis.renderPassColorGrab = null;\n\t\t(_this$renderPassDepth = this.renderPassDepthGrab) == null || _this$renderPassDepth.destroy();\n\t\tthis.renderPassDepthGrab = null;\n\t\tthis.renderPasses.length = 0;\n\t}\n\tget fullSizeClearRect() {\n\t\tconst rect = this._scissorRectClear ? this.scissorRect : this._rect;\n\t\treturn rect.x === 0 && rect.y === 0 && rect.z === 1 && rect.w === 1;\n\t}\n\tset aspectRatio(newValue) {\n\t\tif (this._aspectRatio !== newValue) {\n\t\t\tthis._aspectRatio = newValue;\n\t\t\tthis._projMatDirty = true;\n\t\t}\n\t}\n\tget aspectRatio() {\n\t\tvar _this$xr;\n\t\treturn (_this$xr = this.xr) != null && _this$xr.active ? this._xrProperties.aspectRatio : this._aspectRatio;\n\t}\n\tset aspectRatioMode(newValue) {\n\t\tif (this._aspectRatioMode !== newValue) {\n\t\t\tthis._aspectRatioMode = newValue;\n\t\t\tthis._projMatDirty = true;\n\t\t}\n\t}\n\tget aspectRatioMode() {\n\t\treturn this._aspectRatioMode;\n\t}\n\tset calculateProjection(newValue) {\n\t\tthis._calculateProjection = newValue;\n\t\tthis._projMatDirty = true;\n\t}\n\tget calculateProjection() {\n\t\treturn this._calculateProjection;\n\t}\n\tset calculateTransform(newValue) {\n\t\tthis._calculateTransform = newValue;\n\t}\n\tget calculateTransform() {\n\t\treturn this._calculateTransform;\n\t}\n\tset clearColor(newValue) {\n\t\tthis._clearColor.copy(newValue);\n\t}\n\tget clearColor() {\n\t\treturn this._clearColor;\n\t}\n\tset clearColorBuffer(newValue) {\n\t\tthis._clearColorBuffer = newValue;\n\t}\n\tget clearColorBuffer() {\n\t\treturn this._clearColorBuffer;\n\t}\n\tset clearDepth(newValue) {\n\t\tthis._clearDepth = newValue;\n\t}\n\tget clearDepth() {\n\t\treturn this._clearDepth;\n\t}\n\tset clearDepthBuffer(newValue) {\n\t\tthis._clearDepthBuffer = newValue;\n\t}\n\tget clearDepthBuffer() {\n\t\treturn this._clearDepthBuffer;\n\t}\n\tset clearStencil(newValue) {\n\t\tthis._clearStencil = newValue;\n\t}\n\tget clearStencil() {\n\t\treturn this._clearStencil;\n\t}\n\tset clearStencilBuffer(newValue) {\n\t\tthis._clearStencilBuffer = newValue;\n\t}\n\tget clearStencilBuffer() {\n\t\treturn this._clearStencilBuffer;\n\t}\n\tset cullFaces(newValue) {\n\t\tthis._cullFaces = newValue;\n\t}\n\tget cullFaces() {\n\t\treturn this._cullFaces;\n\t}\n\tset farClip(newValue) {\n\t\tif (this._farClip !== newValue) {\n\t\t\tthis._farClip = newValue;\n\t\t\tthis._projMatDirty = true;\n\t\t}\n\t}\n\tget farClip() {\n\t\tvar _this$xr2;\n\t\treturn (_this$xr2 = this.xr) != null && _this$xr2.active ? this._xrProperties.farClip : this._farClip;\n\t}\n\tset flipFaces(newValue) {\n\t\tthis._flipFaces = newValue;\n\t}\n\tget flipFaces() {\n\t\treturn this._flipFaces;\n\t}\n\tset fov(newValue) {\n\t\tif (this._fov !== newValue) {\n\t\t\tthis._fov = newValue;\n\t\t\tthis._projMatDirty = true;\n\t\t}\n\t}\n\tget fov() {\n\t\tvar _this$xr3;\n\t\treturn (_this$xr3 = this.xr) != null && _this$xr3.active ? this._xrProperties.fov : this._fov;\n\t}\n\tset frustumCulling(newValue) {\n\t\tthis._frustumCulling = newValue;\n\t}\n\tget frustumCulling() {\n\t\treturn this._frustumCulling;\n\t}\n\tset horizontalFov(newValue) {\n\t\tif (this._horizontalFov !== newValue) {\n\t\t\tthis._horizontalFov = newValue;\n\t\t\tthis._projMatDirty = true;\n\t\t}\n\t}\n\tget horizontalFov() {\n\t\tvar _this$xr4;\n\t\treturn (_this$xr4 = this.xr) != null && _this$xr4.active ? this._xrProperties.horizontalFov : this._horizontalFov;\n\t}\n\tset layers(newValue) {\n\t\tthis._layers = newValue.slice(0);\n\t\tthis._layersSet = new Set(this._layers);\n\t}\n\tget layers() {\n\t\treturn this._layers;\n\t}\n\tget layersSet() {\n\t\treturn this._layersSet;\n\t}\n\tset nearClip(newValue) {\n\t\tif (this._nearClip !== newValue) {\n\t\t\tthis._nearClip = newValue;\n\t\t\tthis._projMatDirty = true;\n\t\t}\n\t}\n\tget nearClip() {\n\t\tvar _this$xr5;\n\t\treturn (_this$xr5 = this.xr) != null && _this$xr5.active ? this._xrProperties.nearClip : this._nearClip;\n\t}\n\tset node(newValue) {\n\t\tthis._node = newValue;\n\t}\n\tget node() {\n\t\treturn this._node;\n\t}\n\tset orthoHeight(newValue) {\n\t\tif (this._orthoHeight !== newValue) {\n\t\t\tthis._orthoHeight = newValue;\n\t\t\tthis._projMatDirty = true;\n\t\t}\n\t}\n\tget orthoHeight() {\n\t\treturn this._orthoHeight;\n\t}\n\tset projection(newValue) {\n\t\tif (this._projection !== newValue) {\n\t\t\tthis._projection = newValue;\n\t\t\tthis._projMatDirty = true;\n\t\t}\n\t}\n\tget projection() {\n\t\treturn this._projection;\n\t}\n\tget projectionMatrix() {\n\t\tthis._evaluateProjectionMatrix();\n\t\treturn this._projMat;\n\t}\n\tset rect(newValue) {\n\t\tthis._rect.copy(newValue);\n\t}\n\tget rect() {\n\t\treturn this._rect;\n\t}\n\tset renderTarget(newValue) {\n\t\tthis._renderTarget = newValue;\n\t}\n\tget renderTarget() {\n\t\treturn this._renderTarget;\n\t}\n\tset scissorRect(newValue) {\n\t\tthis._scissorRect.copy(newValue);\n\t}\n\tget scissorRect() {\n\t\treturn this._scissorRect;\n\t}\n\tget viewMatrix() {\n\t\tif (this._viewMatDirty) {\n\t\t\tconst wtm = this._node.getWorldTransform();\n\t\t\tthis._viewMat.copy(wtm).invert();\n\t\t\tthis._viewMatDirty = false;\n\t\t}\n\t\treturn this._viewMat;\n\t}\n\tset aperture(newValue) {\n\t\tthis._aperture = newValue;\n\t}\n\tget aperture() {\n\t\treturn this._aperture;\n\t}\n\tset sensitivity(newValue) {\n\t\tthis._sensitivity = newValue;\n\t}\n\tget sensitivity() {\n\t\treturn this._sensitivity;\n\t}\n\tset shutter(newValue) {\n\t\tthis._shutter = newValue;\n\t}\n\tget shutter() {\n\t\treturn this._shutter;\n\t}\n\tset xr(newValue) {\n\t\tif (this._xr !== newValue) {\n\t\t\tthis._xr = newValue;\n\t\t\tthis._projMatDirty = true;\n\t\t}\n\t}\n\tget xr() {\n\t\treturn this._xr;\n\t}\n\tclone() {\n\t\treturn new Camera().copy(this);\n\t}\n\tcopy(other) {\n\t\tthis._aspectRatio = other._aspectRatio;\n\t\tthis._farClip = other._farClip;\n\t\tthis._fov = other._fov;\n\t\tthis._horizontalFov = other._horizontalFov;\n\t\tthis._nearClip = other._nearClip;\n\t\tthis._xrProperties.aspectRatio = other._xrProperties.aspectRatio;\n\t\tthis._xrProperties.farClip = other._xrProperties.farClip;\n\t\tthis._xrProperties.fov = other._xrProperties.fov;\n\t\tthis._xrProperties.horizontalFov = other._xrProperties.horizontalFov;\n\t\tthis._xrProperties.nearClip = other._xrProperties.nearClip;\n\t\tthis.aspectRatioMode = other.aspectRatioMode;\n\t\tthis.calculateProjection = other.calculateProjection;\n\t\tthis.calculateTransform = other.calculateTransform;\n\t\tthis.clearColor = other.clearColor;\n\t\tthis.clearColorBuffer = other.clearColorBuffer;\n\t\tthis.clearDepth = other.clearDepth;\n\t\tthis.clearDepthBuffer = other.clearDepthBuffer;\n\t\tthis.clearStencil = other.clearStencil;\n\t\tthis.clearStencilBuffer = other.clearStencilBuffer;\n\t\tthis.cullFaces = other.cullFaces;\n\t\tthis.flipFaces = other.flipFaces;\n\t\tthis.frustumCulling = other.frustumCulling;\n\t\tthis.layers = other.layers;\n\t\tthis.orthoHeight = other.orthoHeight;\n\t\tthis.projection = other.projection;\n\t\tthis.rect = other.rect;\n\t\tthis.renderTarget = other.renderTarget;\n\t\tthis.scissorRect = other.scissorRect;\n\t\tthis.aperture = other.aperture;\n\t\tthis.shutter = other.shutter;\n\t\tthis.sensitivity = other.sensitivity;\n\t\tthis.shaderPassInfo = other.shaderPassInfo;\n\t\tthis._projMatDirty = true;\n\t\treturn this;\n\t}\n\t_enableRenderPassColorGrab(device, enable) {\n\t\tif (enable) {\n\t\t\tif (!this.renderPassColorGrab) {\n\t\t\t\tthis.renderPassColorGrab = new RenderPassColorGrab(device, this);\n\t\t\t}\n\t\t} else {\n\t\t\tvar _this$renderPassColor2;\n\t\t\t(_this$renderPassColor2 = this.renderPassColorGrab) == null || _this$renderPassColor2.destroy();\n\t\t\tthis.renderPassColorGrab = null;\n\t\t}\n\t}\n\t_enableRenderPassDepthGrab(device, renderer, enable) {\n\t\tif (enable) {\n\t\t\tif (!this.renderPassDepthGrab) {\n\t\t\t\tthis.renderPassDepthGrab = device.isWebGL1 ? new RenderPassDepth(device, renderer, this) : new RenderPassDepthGrab(device, this);\n\t\t\t}\n\t\t} else {\n\t\t\tvar _this$renderPassDepth2;\n\t\t\t(_this$renderPassDepth2 = this.renderPassDepthGrab) == null || _this$renderPassDepth2.destroy();\n\t\t\tthis.renderPassDepthGrab = null;\n\t\t}\n\t}\n\t_updateViewProjMat() {\n\t\tif (this._projMatDirty || this._viewMatDirty || this._viewProjMatDirty) {\n\t\t\tthis._viewProjMat.mul2(this.projectionMatrix, this.viewMatrix);\n\t\t\tthis._viewProjMatDirty = false;\n\t\t}\n\t}\n\tworldToScreen(worldCoord, cw, ch, screenCoord = new Vec3()) {\n\t\tthis._updateViewProjMat();\n\t\tthis._viewProjMat.transformPoint(worldCoord, screenCoord);\n\t\tconst vpm = this._viewProjMat.data;\n\t\tconst w = worldCoord.x * vpm[3] + worldCoord.y * vpm[7] + worldCoord.z * vpm[11] + 1 * vpm[15];\n\t\tscreenCoord.x = (screenCoord.x / w + 1) * 0.5 * cw;\n\t\tscreenCoord.y = (1 - screenCoord.y / w) * 0.5 * ch;\n\t\treturn screenCoord;\n\t}\n\tscreenToWorld(x, y, z, cw, ch, worldCoord = new Vec3()) {\n\t\tconst range = this.farClip - this.nearClip;\n\t\t_deviceCoord.set(x / cw, (ch - y) / ch, z / range);\n\t\t_deviceCoord.mulScalar(2);\n\t\t_deviceCoord.sub(Vec3.ONE);\n\t\tif (this._projection === PROJECTION_PERSPECTIVE) {\n\t\t\tMat4._getPerspectiveHalfSize(_halfSize, this.fov, this.aspectRatio, this.nearClip, this.horizontalFov);\n\t\t\t_halfSize.x *= _deviceCoord.x;\n\t\t\t_halfSize.y *= _deviceCoord.y;\n\t\t\tconst invView = this._node.getWorldTransform();\n\t\t\t_halfSize.z = -this.nearClip;\n\t\t\tinvView.transformPoint(_halfSize, _point);\n\t\t\tconst cameraPos = this._node.getPosition();\n\t\t\tworldCoord.sub2(_point, cameraPos);\n\t\t\tworldCoord.normalize();\n\t\t\tworldCoord.mulScalar(z);\n\t\t\tworldCoord.add(cameraPos);\n\t\t} else {\n\t\t\tthis._updateViewProjMat();\n\t\t\t_invViewProjMat.copy(this._viewProjMat).invert();\n\t\t\t_invViewProjMat.transformPoint(_deviceCoord, worldCoord);\n\t\t}\n\t\treturn worldCoord;\n\t}\n\t_evaluateProjectionMatrix() {\n\t\tif (this._projMatDirty) {\n\t\t\tif (this._projection === PROJECTION_PERSPECTIVE) {\n\t\t\t\tthis._projMat.setPerspective(this.fov, this.aspectRatio, this.nearClip, this.farClip, this.horizontalFov);\n\t\t\t\tthis._projMatSkybox.copy(this._projMat);\n\t\t\t} else {\n\t\t\t\tconst y = this._orthoHeight;\n\t\t\t\tconst x = y * this.aspectRatio;\n\t\t\t\tthis._projMat.setOrtho(-x, x, -y, y, this.nearClip, this.farClip);\n\t\t\t\tthis._projMatSkybox.setPerspective(this.fov, this.aspectRatio, this.nearClip, this.farClip);\n\t\t\t}\n\t\t\tthis._projMatDirty = false;\n\t\t}\n\t}\n\tgetProjectionMatrixSkybox() {\n\t\tthis._evaluateProjectionMatrix();\n\t\treturn this._projMatSkybox;\n\t}\n\tgetExposure() {\n\t\tconst ev100 = Math.log2(this._aperture * this._aperture / this._shutter * 100.0 / this._sensitivity);\n\t\treturn 1.0 / (Math.pow(2.0, ev100) * 1.2);\n\t}\n\tgetScreenSize(sphere) {\n\t\tif (this._projection === PROJECTION_PERSPECTIVE) {\n\t\t\tconst distance = this._node.getPosition().distance(sphere.center);\n\t\t\tif (distance < sphere.radius) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tconst viewAngle = Math.asin(sphere.radius / distance);\n\t\t\tconst sphereViewHeight = Math.tan(viewAngle);\n\t\t\tconst screenViewHeight = Math.tan(this.fov / 2 * math.DEG_TO_RAD);\n\t\t\treturn Math.min(sphereViewHeight / screenViewHeight, 1);\n\t\t}\n\t\treturn math.clamp(sphere.radius / this._orthoHeight, 0, 1);\n\t}\n\tgetFrustumCorners(near = this.nearClip, far = this.farClip) {\n\t\tconst fov = this.fov * Math.PI / 180.0;\n\t\tlet y = this._projection === PROJECTION_PERSPECTIVE ? Math.tan(fov / 2.0) * near : this._orthoHeight;\n\t\tlet x = y * this.aspectRatio;\n\t\tconst points = _frustumPoints;\n\t\tpoints[0].x = x;\n\t\tpoints[0].y = -y;\n\t\tpoints[0].z = -near;\n\t\tpoints[1].x = x;\n\t\tpoints[1].y = y;\n\t\tpoints[1].z = -near;\n\t\tpoints[2].x = -x;\n\t\tpoints[2].y = y;\n\t\tpoints[2].z = -near;\n\t\tpoints[3].x = -x;\n\t\tpoints[3].y = -y;\n\t\tpoints[3].z = -near;\n\t\tif (this._projection === PROJECTION_PERSPECTIVE) {\n\t\t\ty = Math.tan(fov / 2.0) * far;\n\t\t\tx = y * this.aspectRatio;\n\t\t}\n\t\tpoints[4].x = x;\n\t\tpoints[4].y = -y;\n\t\tpoints[4].z = -far;\n\t\tpoints[5].x = x;\n\t\tpoints[5].y = y;\n\t\tpoints[5].z = -far;\n\t\tpoints[6].x = -x;\n\t\tpoints[6].y = y;\n\t\tpoints[6].z = -far;\n\t\tpoints[7].x = -x;\n\t\tpoints[7].y = -y;\n\t\tpoints[7].z = -far;\n\t\treturn points;\n\t}\n\tsetXrProperties(properties) {\n\t\tObject.assign(this._xrProperties, properties);\n\t\tthis._projMatDirty = true;\n\t}\n}\n\nexport { Camera };\n","import { BLEND_NONE, FOG_NONE, GAMMA_NONE } from '../../constants.js';\n\nclass LitShaderOptions {\n\tconstructor() {\n\t\tthis.hasTangents = false;\n\t\tthis.chunks = {};\n\t\tthis.pass = 0;\n\t\tthis.alphaTest = false;\n\t\tthis.blendType = BLEND_NONE;\n\t\tthis.separateAmbient = false;\n\t\tthis.screenSpace = false;\n\t\tthis.skin = false;\n\t\tthis.useInstancing = false;\n\t\tthis.useMorphPosition = false;\n\t\tthis.useMorphNormal = false;\n\t\tthis.useMorphTextureBased = false;\n\t\tthis.nineSlicedMode = 0;\n\t\tthis.clusteredLightingEnabled = true;\n\t\tthis.clusteredLightingCookiesEnabled = false;\n\t\tthis.clusteredLightingShadowsEnabled = false;\n\t\tthis.clusteredLightingShadowType = 0;\n\t\tthis.clusteredLightingAreaLightsEnabled = false;\n\t\tthis.vertexColors = false;\n\t\tthis.lightMapEnabled = false;\n\t\tthis.dirLightMapEnabled = false;\n\t\tthis.useHeights = false;\n\t\tthis.useNormals = false;\n\t\tthis.useClearCoatNormals = false;\n\t\tthis.useAo = false;\n\t\tthis.diffuseMapEnabled = false;\n\t\tthis.useAmbientTint = false;\n\t\tthis.customFragmentShader = null;\n\t\tthis.pixelSnap = false;\n\t\tthis.shadingModel = 0;\n\t\tthis.ambientSH = false;\n\t\tthis.fastTbn = false;\n\t\tthis.twoSidedLighting = false;\n\t\tthis.occludeDirect = false;\n\t\tthis.occludeSpecular = 0;\n\t\tthis.occludeSpecularFloat = false;\n\t\tthis.useMsdf = false;\n\t\tthis.msdfTextAttribute = false;\n\t\tthis.alphaToCoverage = false;\n\t\tthis.opacityFadesSpecular = false;\n\t\tthis.cubeMapProjection = 0;\n\t\tthis.conserveEnergy = false;\n\t\tthis.useSpecular = false;\n\t\tthis.useSpecularityFactor = false;\n\t\tthis.enableGGXSpecular = false;\n\t\tthis.fresnelModel = 0;\n\t\tthis.useRefraction = false;\n\t\tthis.useClearCoat = false;\n\t\tthis.useSheen = false;\n\t\tthis.useIridescence = false;\n\t\tthis.useMetalness = false;\n\t\tthis.useDynamicRefraction = false;\n\t\tthis.fog = FOG_NONE;\n\t\tthis.gamma = GAMMA_NONE;\n\t\tthis.toneMap = -1;\n\t\tthis.fixSeams = false;\n\t\tthis.reflectionSource = null;\n\t\tthis.reflectionEncoding = null;\n\t\tthis.reflectionCubemapEncoding = null;\n\t\tthis.ambientSource = 'constant';\n\t\tthis.ambientEncoding = null;\n\t\tthis.skyboxIntensity = 1.0;\n\t\tthis.useCubeMapRotation = false;\n\t\tthis.lightMapWithoutAmbient = false;\n\t\tthis.lights = [];\n\t\tthis.noShadow = false;\n\t\tthis.lightMaskDynamic = 0x0;\n\t\tthis.userAttributes = {};\n\t}\n}\n\nexport { LitShaderOptions };\n","import { SHADER_FORWARDHDR, GAMMA_SRGBHDR, TONEMAP_LINEAR, SHADERDEF_SCREENSPACE, SHADERDEF_SKIN, SHADERDEF_INSTANCING, SHADERDEF_MORPH_POSITION, SHADERDEF_MORPH_NORMAL, SHADERDEF_MORPH_TEXTURE_BASED, SHADERDEF_TANGENTS, SPRITE_RENDERMODE_SIMPLE, CUBEPROJ_NONE, SPECULAR_BLINN, GAMMA_NONE, MASK_AFFECT_DYNAMIC, LIGHTTYPE_DIRECTIONAL, LIGHTTYPE_OMNI, LIGHTTYPE_SPOT, SHADERDEF_NOSHADOW } from '../constants.js';\n\nclass LitMaterialOptionsBuilder {\n\tstatic update(litOptions, material, scene, objDefs, pass, sortedLights) {\n\t\tLitMaterialOptionsBuilder.updateSharedOptions(litOptions, material, scene, objDefs, pass);\n\t\tLitMaterialOptionsBuilder.updateMaterialOptions(litOptions, material);\n\t\tLitMaterialOptionsBuilder.updateEnvOptions(litOptions, material, scene);\n\t\tLitMaterialOptionsBuilder.updateLightingOptions(litOptions, material, objDefs, sortedLights);\n\t\tif (pass === SHADER_FORWARDHDR) {\n\t\t\tlitOptions.gamma = GAMMA_SRGBHDR;\n\t\t\tlitOptions.toneMap = TONEMAP_LINEAR;\n\t\t}\n\t}\n\tstatic updateSharedOptions(litOptions, material, scene, objDefs, pass) {\n\t\tlitOptions.chunks = material.chunks;\n\t\tlitOptions.pass = pass;\n\t\tlitOptions.alphaTest = material.alphaTest > 0;\n\t\tlitOptions.blendType = material.blendType;\n\t\tlitOptions.screenSpace = objDefs && (objDefs & SHADERDEF_SCREENSPACE) !== 0;\n\t\tlitOptions.skin = objDefs && (objDefs & SHADERDEF_SKIN) !== 0;\n\t\tlitOptions.useInstancing = objDefs && (objDefs & SHADERDEF_INSTANCING) !== 0;\n\t\tlitOptions.useMorphPosition = objDefs && (objDefs & SHADERDEF_MORPH_POSITION) !== 0;\n\t\tlitOptions.useMorphNormal = objDefs && (objDefs & SHADERDEF_MORPH_NORMAL) !== 0;\n\t\tlitOptions.useMorphTextureBased = objDefs && (objDefs & SHADERDEF_MORPH_TEXTURE_BASED) !== 0;\n\t\tlitOptions.hasTangents = objDefs && (objDefs & SHADERDEF_TANGENTS) !== 0;\n\t\tlitOptions.nineSlicedMode = material.nineSlicedMode || SPRITE_RENDERMODE_SIMPLE;\n\t\tif (material.useLighting && scene.clusteredLightingEnabled) {\n\t\t\tlitOptions.clusteredLightingEnabled = true;\n\t\t\tlitOptions.clusteredLightingCookiesEnabled = scene.lighting.cookiesEnabled;\n\t\t\tlitOptions.clusteredLightingShadowsEnabled = scene.lighting.shadowsEnabled;\n\t\t\tlitOptions.clusteredLightingShadowType = scene.lighting.shadowType;\n\t\t\tlitOptions.clusteredLightingAreaLightsEnabled = scene.lighting.areaLightsEnabled;\n\t\t} else {\n\t\t\tlitOptions.clusteredLightingEnabled = false;\n\t\t\tlitOptions.clusteredLightingCookiesEnabled = false;\n\t\t\tlitOptions.clusteredLightingShadowsEnabled = false;\n\t\t\tlitOptions.clusteredLightingAreaLightsEnabled = false;\n\t\t}\n\t}\n\tstatic updateMaterialOptions(litOptions, material) {\n\t\tlitOptions.useAmbientTint = false;\n\t\tlitOptions.separateAmbient = false;\n\t\tlitOptions.customFragmentShader = null;\n\t\tlitOptions.pixelSnap = material.pixelSnap;\n\t\tlitOptions.shadingModel = material.shadingModel;\n\t\tlitOptions.ambientSH = material.ambientSH;\n\t\tlitOptions.fastTbn = material.fastTbn;\n\t\tlitOptions.twoSidedLighting = material.twoSidedLighting;\n\t\tlitOptions.occludeDirect = material.occludeDirect;\n\t\tlitOptions.occludeSpecular = material.occludeSpecular;\n\t\tlitOptions.occludeSpecularFloat = material.occludeSpecularIntensity !== 1.0;\n\t\tlitOptions.useMsdf = false;\n\t\tlitOptions.msdfTextAttribute = false;\n\t\tlitOptions.alphaToCoverage = material.alphaToCoverage;\n\t\tlitOptions.opacityFadesSpecular = material.opacityFadesSpecular;\n\t\tlitOptions.cubeMapProjection = CUBEPROJ_NONE;\n\t\tlitOptions.conserveEnergy = material.conserveEnergy && material.shadingModel === SPECULAR_BLINN;\n\t\tlitOptions.useSpecular = material.hasSpecular;\n\t\tlitOptions.useSpecularityFactor = material.hasSpecularityFactor;\n\t\tlitOptions.enableGGXSpecular = material.ggxSpecular;\n\t\tlitOptions.fresnelModel = material.fresnelModel;\n\t\tlitOptions.useRefraction = material.hasRefraction;\n\t\tlitOptions.useClearCoat = material.hasClearCoat;\n\t\tlitOptions.useSheen = material.hasSheen;\n\t\tlitOptions.useIridescence = material.hasIrridescence;\n\t\tlitOptions.useMetalness = material.hasMetalness;\n\t\tlitOptions.useDynamicRefraction = material.dynamicRefraction;\n\t\tlitOptions.vertexColors = false;\n\t\tlitOptions.lightMapEnabled = material.hasLighting;\n\t\tlitOptions.dirLightMapEnabled = material.dirLightMap;\n\t\tlitOptions.useHeights = material.hasHeights;\n\t\tlitOptions.useNormals = material.hasNormals;\n\t\tlitOptions.useClearCoatNormals = material.hasClearCoatNormals;\n\t\tlitOptions.useAo = material.hasAo;\n\t\tlitOptions.diffuseMapEnabled = material.hasDiffuseMap;\n\t}\n\tstatic updateEnvOptions(litOptions, material, scene) {\n\t\tlitOptions.fog = material.useFog ? scene.fog : 'none';\n\t\tlitOptions.gamma = material.useGammaTonemap ? scene.gammaCorrection : GAMMA_NONE;\n\t\tlitOptions.toneMap = material.useGammaTonemap ? scene.toneMapping : -1;\n\t\tlitOptions.fixSeams = false;\n\t\tif (material.useSkybox && scene.envAtlas && scene.skybox) {\n\t\t\tlitOptions.reflectionSource = 'envAtlasHQ';\n\t\t\tlitOptions.reflectionEncoding = scene.envAtlas.encoding;\n\t\t\tlitOptions.reflectionCubemapEncoding = scene.skybox.encoding;\n\t\t} else if (material.useSkybox && scene.envAtlas) {\n\t\t\tlitOptions.reflectionSource = 'envAtlas';\n\t\t\tlitOptions.reflectionEncoding = scene.envAtlas.encoding;\n\t\t} else if (material.useSkybox && scene.skybox) {\n\t\t\tlitOptions.reflectionSource = 'cubeMap';\n\t\t\tlitOptions.reflectionEncoding = scene.skybox.encoding;\n\t\t} else {\n\t\t\tlitOptions.reflectionSource = null;\n\t\t\tlitOptions.reflectionEncoding = null;\n\t\t}\n\t\tif (material.ambientSH) {\n\t\t\tlitOptions.ambientSource = 'ambientSH';\n\t\t\tlitOptions.ambientEncoding = null;\n\t\t} else if (litOptions.reflectionSource && scene.envAtlas) {\n\t\t\tlitOptions.ambientSource = 'envAtlas';\n\t\t\tlitOptions.ambientEncoding = scene.envAtlas.encoding;\n\t\t} else {\n\t\t\tlitOptions.ambientSource = 'constant';\n\t\t\tlitOptions.ambientEncoding = null;\n\t\t}\n\t\tconst hasSkybox = !!litOptions.reflectionSource;\n\t\tlitOptions.skyboxIntensity = hasSkybox && (scene.skyboxIntensity !== 1 || scene.physicalUnits);\n\t\tlitOptions.useCubeMapRotation = hasSkybox && scene._skyboxRotationShaderInclude;\n\t}\n\tstatic updateLightingOptions(litOptions, material, objDefs, sortedLights) {\n\t\tlitOptions.lightMapWithoutAmbient = false;\n\t\tif (material.useLighting) {\n\t\t\tconst lightsFiltered = [];\n\t\t\tconst mask = objDefs ? objDefs >> 16 : MASK_AFFECT_DYNAMIC;\n\t\t\tlitOptions.lightMaskDynamic = !!(mask & MASK_AFFECT_DYNAMIC);\n\t\t\tlitOptions.lightMapWithoutAmbient = false;\n\t\t\tif (sortedLights) {\n\t\t\t\tLitMaterialOptionsBuilder.collectLights(LIGHTTYPE_DIRECTIONAL, sortedLights[LIGHTTYPE_DIRECTIONAL], lightsFiltered, mask);\n\t\t\t\tLitMaterialOptionsBuilder.collectLights(LIGHTTYPE_OMNI, sortedLights[LIGHTTYPE_OMNI], lightsFiltered, mask);\n\t\t\t\tLitMaterialOptionsBuilder.collectLights(LIGHTTYPE_SPOT, sortedLights[LIGHTTYPE_SPOT], lightsFiltered, mask);\n\t\t\t}\n\t\t\tlitOptions.lights = lightsFiltered;\n\t\t} else {\n\t\t\tlitOptions.lights = [];\n\t\t}\n\t\tif (litOptions.lights.length === 0 || (objDefs & SHADERDEF_NOSHADOW) !== 0) {\n\t\t\tlitOptions.noShadow = true;\n\t\t}\n\t}\n\tstatic collectLights(lType, lights, lightsFiltered, mask) {\n\t\tfor (let i = 0; i < lights.length; i++) {\n\t\t\tconst light = lights[i];\n\t\t\tif (light.enabled) {\n\t\t\t\tif (light.mask & mask) {\n\t\t\t\t\tlightsFiltered.push(light);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport { LitMaterialOptionsBuilder };\n","class ChunkBuilder {\n\tconstructor() {\n\t\tthis.code = '';\n\t}\n\tappend(...chunks) {\n\t\tchunks.forEach(chunk => {\n\t\t\tif (chunk.endsWith('\\n')) {\n\t\t\t\tthis.code += chunk;\n\t\t\t} else {\n\t\t\t\tthis.code += chunk + '\\n';\n\t\t\t}\n\t\t});\n\t}\n\tprepend(...chunks) {\n\t\tchunks.forEach(chunk => {\n\t\t\tif (chunk.endsWith('\\n')) {\n\t\t\t\tthis.code = chunk + this.code;\n\t\t\t} else {\n\t\t\t\tthis.code = chunk + '\\n' + this.code;\n\t\t\t}\n\t\t});\n\t}\n}\n\nexport { ChunkBuilder };\n","const decodeTable = {\n\t'linear': 'decodeLinear',\n\t'srgb': 'decodeGamma',\n\t'rgbm': 'decodeRGBM',\n\t'rgbe': 'decodeRGBE',\n\t'rgbp': 'decodeRGBP'\n};\nconst encodeTable = {\n\t'linear': 'encodeLinear',\n\t'srgb': 'encodeGamma',\n\t'rgbm': 'encodeRGBM',\n\t'rgbe': 'encodeRGBE',\n\t'rgbp': 'encodeRGBP'\n};\nclass ChunkUtils {\n\tstatic decodeFunc(encoding) {\n\t\treturn decodeTable[encoding] || 'decodeGamma';\n\t}\n\tstatic encodeFunc(encoding) {\n\t\treturn encodeTable[encoding] || 'encodeGamma';\n\t}\n}\n\nexport { ChunkUtils };\n","import { Quat } from '../../core/math/quat.js';\nimport { Vec3 } from '../../core/math/vec3.js';\nimport { Mat4 } from '../../core/math/mat4.js';\nimport { ASPECT_MANUAL, LIGHTTYPE_DIRECTIONAL, PROJECTION_ORTHOGRAPHIC, LIGHTTYPE_SPOT, PROJECTION_PERSPECTIVE, LIGHTTYPE_OMNI } from '../constants.js';\nimport { Camera } from '../camera.js';\nimport { GraphNode } from '../graph-node.js';\n\nconst _viewMat = new Mat4();\nconst _viewProjMat = new Mat4();\nconst _viewportMatrix = new Mat4();\nclass LightCamera {\n\tstatic create(name, lightType, face) {\n\t\tconst camera = new Camera();\n\t\tcamera.node = new GraphNode(name);\n\t\tcamera.aspectRatio = 1;\n\t\tcamera.aspectRatioMode = ASPECT_MANUAL;\n\t\tcamera._scissorRectClear = true;\n\t\tswitch (lightType) {\n\t\t\tcase LIGHTTYPE_OMNI:\n\t\t\t\tcamera.node.setRotation(LightCamera.pointLightRotations[face]);\n\t\t\t\tcamera.fov = 90;\n\t\t\t\tcamera.projection = PROJECTION_PERSPECTIVE;\n\t\t\t\tbreak;\n\t\t\tcase LIGHTTYPE_SPOT:\n\t\t\t\tcamera.projection = PROJECTION_PERSPECTIVE;\n\t\t\t\tbreak;\n\t\t\tcase LIGHTTYPE_DIRECTIONAL:\n\t\t\t\tcamera.projection = PROJECTION_ORTHOGRAPHIC;\n\t\t\t\tbreak;\n\t\t}\n\t\treturn camera;\n\t}\n\tstatic evalSpotCookieMatrix(light) {\n\t\tlet cookieCamera = LightCamera._spotCookieCamera;\n\t\tif (!cookieCamera) {\n\t\t\tcookieCamera = LightCamera.create('SpotCookieCamera', LIGHTTYPE_SPOT);\n\t\t\tLightCamera._spotCookieCamera = cookieCamera;\n\t\t}\n\t\tcookieCamera.fov = light._outerConeAngle * 2;\n\t\tconst cookieNode = cookieCamera._node;\n\t\tcookieNode.setPosition(light._node.getPosition());\n\t\tcookieNode.setRotation(light._node.getRotation());\n\t\tcookieNode.rotateLocal(-90, 0, 0);\n\t\t_viewMat.setTRS(cookieNode.getPosition(), cookieNode.getRotation(), Vec3.ONE).invert();\n\t\t_viewProjMat.mul2(cookieCamera.projectionMatrix, _viewMat);\n\t\tconst cookieMatrix = light.cookieMatrix;\n\t\tconst rectViewport = light.atlasViewport;\n\t\t_viewportMatrix.setViewport(rectViewport.x, rectViewport.y, rectViewport.z, rectViewport.w);\n\t\tcookieMatrix.mul2(_viewportMatrix, _viewProjMat);\n\t\treturn cookieMatrix;\n\t}\n}\nLightCamera.pointLightRotations = [new Quat().setFromEulerAngles(0, 90, 180), new Quat().setFromEulerAngles(0, -90, 180), new Quat().setFromEulerAngles(90, 0, 0), new Quat().setFromEulerAngles(-90, 0, 0), new Quat().setFromEulerAngles(0, 180, 180), new Quat().setFromEulerAngles(0, 0, 180)];\nLightCamera._spotCookieCamera = null;\n\nexport { LightCamera };\n","import { Vec3 } from '../../core/math/vec3.js';\nimport { ADDRESS_CLAMP_TO_EDGE, TEXTURETYPE_DEFAULT, FILTER_NEAREST, PIXELFORMAT_RGBA8, PIXELFORMAT_RGBA32F } from '../../platform/graphics/constants.js';\nimport { FloatPacking } from '../../core/math/float-packing.js';\nimport { MASK_AFFECT_DYNAMIC, MASK_AFFECT_LIGHTMAPPED, LIGHTTYPE_SPOT, LIGHTSHAPE_PUNCTUAL } from '../constants.js';\nimport { Texture } from '../../platform/graphics/texture.js';\nimport { LightCamera } from '../renderer/light-camera.js';\n\nvar _class;\nconst epsilon = 0.000001;\nconst tempVec3 = new Vec3();\nconst tempAreaLightSizes = new Float32Array(6);\nconst areaHalfAxisWidth = new Vec3(-0.5, 0, 0);\nconst areaHalfAxisHeight = new Vec3(0, 0, 0.5);\nconst TextureIndex8 = {\n\tFLAGS: 0,\n\tCOLOR_A: 1,\n\tCOLOR_B: 2,\n\tSPOT_ANGLES: 3,\n\tSHADOW_BIAS: 4,\n\tCOOKIE_A: 5,\n\tCOOKIE_B: 6,\n\tCOUNT_ALWAYS: 7,\n\tPOSITION_X: 7,\n\tPOSITION_Y: 8,\n\tPOSITION_Z: 9,\n\tRANGE: 10,\n\tSPOT_DIRECTION_X: 11,\n\tSPOT_DIRECTION_Y: 12,\n\tSPOT_DIRECTION_Z: 13,\n\tPROJ_MAT_00: 14,\n\tATLAS_VIEWPORT_A: 14,\n\tPROJ_MAT_01: 15,\n\tATLAS_VIEWPORT_B: 15,\n\tPROJ_MAT_02: 16,\n\tPROJ_MAT_03: 17,\n\tPROJ_MAT_10: 18,\n\tPROJ_MAT_11: 19,\n\tPROJ_MAT_12: 20,\n\tPROJ_MAT_13: 21,\n\tPROJ_MAT_20: 22,\n\tPROJ_MAT_21: 23,\n\tPROJ_MAT_22: 24,\n\tPROJ_MAT_23: 25,\n\tPROJ_MAT_30: 26,\n\tPROJ_MAT_31: 27,\n\tPROJ_MAT_32: 28,\n\tPROJ_MAT_33: 29,\n\tAREA_DATA_WIDTH_X: 30,\n\tAREA_DATA_WIDTH_Y: 31,\n\tAREA_DATA_WIDTH_Z: 32,\n\tAREA_DATA_HEIGHT_X: 33,\n\tAREA_DATA_HEIGHT_Y: 34,\n\tAREA_DATA_HEIGHT_Z: 35,\n\tCOUNT: 36\n};\nconst TextureIndexFloat = {\n\tPOSITION_RANGE: 0,\n\tSPOT_DIRECTION: 1,\n\tPROJ_MAT_0: 2,\n\tATLAS_VIEWPORT: 2,\n\tPROJ_MAT_1: 3,\n\tPROJ_MAT_2: 4,\n\tPROJ_MAT_3: 5,\n\tAREA_DATA_WIDTH: 6,\n\tAREA_DATA_HEIGHT: 7,\n\tCOUNT: 8\n};\nclass LightsBuffer {\n\tstatic initShaderDefines() {\n\t\tconst clusterTextureFormat = LightsBuffer.lightTextureFormat === LightsBuffer.FORMAT_FLOAT ? 'FLOAT' : '8BIT';\n\t\tLightsBuffer.shaderDefines = `\n\t\t\t\t\t\t\\n#define CLUSTER_TEXTURE_${clusterTextureFormat}\n\t\t\t\t\t\t${LightsBuffer.buildShaderDefines(TextureIndex8, 'CLUSTER_TEXTURE_8_')}\n\t\t\t\t\t\t${LightsBuffer.buildShaderDefines(TextureIndexFloat, 'CLUSTER_TEXTURE_F_')}\n\t\t\t\t`;\n\t}\n\tstatic buildShaderDefines(object, prefix) {\n\t\tlet str = '';\n\t\tconst floatOffset = LightsBuffer.useTexelFetch ? '' : '.5';\n\t\tObject.keys(object).forEach(key => {\n\t\t\tstr += `\\n#define ${prefix}${key} ${object[key]}${floatOffset}`;\n\t\t});\n\t\treturn str;\n\t}\n\tstatic init(device) {\n\t\tLightsBuffer.lightTextureFormat = device.extTextureFloat && device.maxTextures > 8 ? LightsBuffer.FORMAT_FLOAT : LightsBuffer.FORMAT_8BIT;\n\t\tLightsBuffer.useTexelFetch = device.supportsTextureFetch;\n\t\tLightsBuffer.initShaderDefines();\n\t}\n\tstatic createTexture(device, width, height, format, name) {\n\t\tconst tex = new Texture(device, {\n\t\t\tname: name,\n\t\t\twidth: width,\n\t\t\theight: height,\n\t\t\tmipmaps: false,\n\t\t\tformat: format,\n\t\t\taddressU: ADDRESS_CLAMP_TO_EDGE,\n\t\t\taddressV: ADDRESS_CLAMP_TO_EDGE,\n\t\t\ttype: TEXTURETYPE_DEFAULT,\n\t\t\tmagFilter: FILTER_NEAREST,\n\t\t\tminFilter: FILTER_NEAREST,\n\t\t\tanisotropy: 1\n\t\t});\n\t\treturn tex;\n\t}\n\tconstructor(device) {\n\t\tthis.device = device;\n\t\tthis.cookiesEnabled = false;\n\t\tthis.shadowsEnabled = false;\n\t\tthis.areaLightsEnabled = false;\n\t\tthis.maxLights = 255;\n\t\tlet pixelsPerLight8 = TextureIndex8.COUNT_ALWAYS;\n\t\tlet pixelsPerLightFloat = 0;\n\t\tif (LightsBuffer.lightTextureFormat === LightsBuffer.FORMAT_FLOAT) {\n\t\t\tpixelsPerLightFloat = TextureIndexFloat.COUNT;\n\t\t} else {\n\t\t\tpixelsPerLight8 = TextureIndex8.COUNT;\n\t\t}\n\t\tthis.lights8 = new Uint8ClampedArray(4 * pixelsPerLight8 * this.maxLights);\n\t\tthis.lightsTexture8 = LightsBuffer.createTexture(this.device, pixelsPerLight8, this.maxLights, PIXELFORMAT_RGBA8, 'LightsTexture8');\n\t\tthis._lightsTexture8Id = this.device.scope.resolve('lightsTexture8');\n\t\tif (pixelsPerLightFloat) {\n\t\t\tthis.lightsFloat = new Float32Array(4 * pixelsPerLightFloat * this.maxLights);\n\t\t\tthis.lightsTextureFloat = LightsBuffer.createTexture(this.device, pixelsPerLightFloat, this.maxLights, PIXELFORMAT_RGBA32F, 'LightsTextureFloat');\n\t\t\tthis._lightsTextureFloatId = this.device.scope.resolve('lightsTextureFloat');\n\t\t} else {\n\t\t\tthis.lightsFloat = null;\n\t\t\tthis.lightsTextureFloat = null;\n\t\t\tthis._lightsTextureFloatId = undefined;\n\t\t}\n\t\tthis._lightsTextureInvSizeId = this.device.scope.resolve('lightsTextureInvSize');\n\t\tthis._lightsTextureInvSizeData = new Float32Array(4);\n\t\tthis._lightsTextureInvSizeData[0] = pixelsPerLightFloat ? 1.0 / this.lightsTextureFloat.width : 0;\n\t\tthis._lightsTextureInvSizeData[1] = pixelsPerLightFloat ? 1.0 / this.lightsTextureFloat.height : 0;\n\t\tthis._lightsTextureInvSizeData[2] = 1.0 / this.lightsTexture8.width;\n\t\tthis._lightsTextureInvSizeData[3] = 1.0 / this.lightsTexture8.height;\n\t\tthis.invMaxColorValue = 0;\n\t\tthis.invMaxAttenuation = 0;\n\t\tthis.boundsMin = new Vec3();\n\t\tthis.boundsDelta = new Vec3();\n\t}\n\tdestroy() {\n\t\tif (this.lightsTexture8) {\n\t\t\tthis.lightsTexture8.destroy();\n\t\t\tthis.lightsTexture8 = null;\n\t\t}\n\t\tif (this.lightsTextureFloat) {\n\t\t\tthis.lightsTextureFloat.destroy();\n\t\t\tthis.lightsTextureFloat = null;\n\t\t}\n\t}\n\tsetCompressionRanges(maxAttenuation, maxColorValue) {\n\t\tthis.invMaxColorValue = 1 / maxColorValue;\n\t\tthis.invMaxAttenuation = 1 / maxAttenuation;\n\t}\n\tsetBounds(min, delta) {\n\t\tthis.boundsMin.copy(min);\n\t\tthis.boundsDelta.copy(delta);\n\t}\n\tuploadTextures() {\n\t\tif (this.lightsTextureFloat) {\n\t\t\tthis.lightsTextureFloat.lock().set(this.lightsFloat);\n\t\t\tthis.lightsTextureFloat.unlock();\n\t\t}\n\t\tthis.lightsTexture8.lock().set(this.lights8);\n\t\tthis.lightsTexture8.unlock();\n\t}\n\tupdateUniforms() {\n\t\tthis._lightsTexture8Id.setValue(this.lightsTexture8);\n\t\tif (LightsBuffer.lightTextureFormat === LightsBuffer.FORMAT_FLOAT) {\n\t\t\tthis._lightsTextureFloatId.setValue(this.lightsTextureFloat);\n\t\t}\n\t\tthis._lightsTextureInvSizeId.setValue(this._lightsTextureInvSizeData);\n\t}\n\tgetSpotDirection(direction, spot) {\n\t\tconst mat = spot._node.getWorldTransform();\n\t\tmat.getY(direction).mulScalar(-1);\n\t\tdirection.normalize();\n\t}\n\tgetLightAreaSizes(light) {\n\t\tconst mat = light._node.getWorldTransform();\n\t\tmat.transformVector(areaHalfAxisWidth, tempVec3);\n\t\ttempAreaLightSizes[0] = tempVec3.x;\n\t\ttempAreaLightSizes[1] = tempVec3.y;\n\t\ttempAreaLightSizes[2] = tempVec3.z;\n\t\tmat.transformVector(areaHalfAxisHeight, tempVec3);\n\t\ttempAreaLightSizes[3] = tempVec3.x;\n\t\ttempAreaLightSizes[4] = tempVec3.y;\n\t\ttempAreaLightSizes[5] = tempVec3.z;\n\t\treturn tempAreaLightSizes;\n\t}\n\taddLightDataFlags(data8, index, light, isSpot, castShadows, shadowIntensity) {\n\t\tdata8[index + 0] = isSpot ? 255 : 0;\n\t\tdata8[index + 1] = light._shape * 64;\n\t\tdata8[index + 2] = light._falloffMode * 255;\n\t\tdata8[index + 3] = castShadows ? shadowIntensity * 255 : 0;\n\t}\n\taddLightDataColor(data8, index, light, gammaCorrection, isCookie) {\n\t\tconst invMaxColorValue = this.invMaxColorValue;\n\t\tconst color = gammaCorrection ? light._linearFinalColor : light._finalColor;\n\t\tFloatPacking.float2Bytes(color[0] * invMaxColorValue, data8, index + 0, 2);\n\t\tFloatPacking.float2Bytes(color[1] * invMaxColorValue, data8, index + 2, 2);\n\t\tFloatPacking.float2Bytes(color[2] * invMaxColorValue, data8, index + 4, 2);\n\t\tdata8[index + 6] = isCookie ? 255 : 0;\n\t\tconst isDynamic = !!(light.mask & MASK_AFFECT_DYNAMIC);\n\t\tconst isLightmapped = !!(light.mask & MASK_AFFECT_LIGHTMAPPED);\n\t\tdata8[index + 7] = isDynamic && isLightmapped ? 127 : isLightmapped ? 255 : 0;\n\t}\n\taddLightDataSpotAngles(data8, index, light) {\n\t\tFloatPacking.float2Bytes(light._innerConeAngleCos * (0.5 - epsilon) + 0.5, data8, index + 0, 2);\n\t\tFloatPacking.float2Bytes(light._outerConeAngleCos * (0.5 - epsilon) + 0.5, data8, index + 2, 2);\n\t}\n\taddLightDataShadowBias(data8, index, light) {\n\t\tconst lightRenderData = light.getRenderData(null, 0);\n\t\tconst biases = light._getUniformBiasValues(lightRenderData);\n\t\tFloatPacking.float2BytesRange(biases.bias, data8, index, -1, 20, 2);\n\t\tFloatPacking.float2Bytes(biases.normalBias, data8, index + 2, 2);\n\t}\n\taddLightDataPositionRange(data8, index, light, pos) {\n\t\tconst normPos = tempVec3.sub2(pos, this.boundsMin).div(this.boundsDelta);\n\t\tFloatPacking.float2Bytes(normPos.x, data8, index + 0, 4);\n\t\tFloatPacking.float2Bytes(normPos.y, data8, index + 4, 4);\n\t\tFloatPacking.float2Bytes(normPos.z, data8, index + 8, 4);\n\t\tFloatPacking.float2Bytes(light.attenuationEnd * this.invMaxAttenuation, data8, index + 12, 4);\n\t}\n\taddLightDataSpotDirection(data8, index, light) {\n\t\tthis.getSpotDirection(tempVec3, light);\n\t\tFloatPacking.float2Bytes(tempVec3.x * (0.5 - epsilon) + 0.5, data8, index + 0, 4);\n\t\tFloatPacking.float2Bytes(tempVec3.y * (0.5 - epsilon) + 0.5, data8, index + 4, 4);\n\t\tFloatPacking.float2Bytes(tempVec3.z * (0.5 - epsilon) + 0.5, data8, index + 8, 4);\n\t}\n\taddLightDataLightProjMatrix(data8, index, lightProjectionMatrix) {\n\t\tconst matData = lightProjectionMatrix.data;\n\t\tfor (let m = 0; m < 12; m++) FloatPacking.float2BytesRange(matData[m], data8, index + 4 * m, -2, 2, 4);\n\t\tfor (let m = 12; m < 16; m++) {\n\t\t\tFloatPacking.float2MantissaExponent(matData[m], data8, index + 4 * m, 4);\n\t\t}\n\t}\n\taddLightDataCookies(data8, index, light) {\n\t\tconst isRgb = light._cookieChannel === 'rgb';\n\t\tdata8[index + 0] = Math.floor(light.cookieIntensity * 255);\n\t\tdata8[index + 1] = isRgb ? 255 : 0;\n\t\tif (!isRgb) {\n\t\t\tconst channel = light._cookieChannel;\n\t\t\tdata8[index + 4] = channel === 'rrr' ? 255 : 0;\n\t\t\tdata8[index + 5] = channel === 'ggg' ? 255 : 0;\n\t\t\tdata8[index + 6] = channel === 'bbb' ? 255 : 0;\n\t\t\tdata8[index + 7] = channel === 'aaa' ? 255 : 0;\n\t\t}\n\t}\n\taddLightAtlasViewport(data8, index, atlasViewport) {\n\t\tFloatPacking.float2Bytes(atlasViewport.x, data8, index + 0, 2);\n\t\tFloatPacking.float2Bytes(atlasViewport.y, data8, index + 2, 2);\n\t\tFloatPacking.float2Bytes(atlasViewport.z / 3, data8, index + 4, 2);\n\t}\n\taddLightAreaSizes(data8, index, light) {\n\t\tconst areaSizes = this.getLightAreaSizes(light);\n\t\tfor (let i = 0; i < 6; i++) {\n\t\t\tFloatPacking.float2MantissaExponent(areaSizes[i], data8, index + 4 * i, 4);\n\t\t}\n\t}\n\taddLightData(light, lightIndex, gammaCorrection) {\n\t\tconst isSpot = light._type === LIGHTTYPE_SPOT;\n\t\tconst hasAtlasViewport = light.atlasViewportAllocated;\n\t\tconst isCookie = this.cookiesEnabled && !!light._cookie && hasAtlasViewport;\n\t\tconst isArea = this.areaLightsEnabled && light.shape !== LIGHTSHAPE_PUNCTUAL;\n\t\tconst castShadows = this.shadowsEnabled && light.castShadows && hasAtlasViewport;\n\t\tconst pos = light._node.getPosition();\n\t\tlet lightProjectionMatrix = null;\n\t\tlet atlasViewport = null;\n\t\tif (isSpot) {\n\t\t\tif (castShadows) {\n\t\t\t\tconst lightRenderData = light.getRenderData(null, 0);\n\t\t\t\tlightProjectionMatrix = lightRenderData.shadowMatrix;\n\t\t\t} else if (isCookie) {\n\t\t\t\tlightProjectionMatrix = LightCamera.evalSpotCookieMatrix(light);\n\t\t\t}\n\t\t} else {\n\t\t\tif (castShadows || isCookie) {\n\t\t\t\tatlasViewport = light.atlasViewport;\n\t\t\t}\n\t\t}\n\t\tconst data8 = this.lights8;\n\t\tconst data8Start = lightIndex * this.lightsTexture8.width * 4;\n\t\tthis.addLightDataFlags(data8, data8Start + 4 * TextureIndex8.FLAGS, light, isSpot, castShadows, light.shadowIntensity);\n\t\tthis.addLightDataColor(data8, data8Start + 4 * TextureIndex8.COLOR_A, light, gammaCorrection, isCookie);\n\t\tif (isSpot) {\n\t\t\tthis.addLightDataSpotAngles(data8, data8Start + 4 * TextureIndex8.SPOT_ANGLES, light);\n\t\t}\n\t\tif (light.castShadows) {\n\t\t\tthis.addLightDataShadowBias(data8, data8Start + 4 * TextureIndex8.SHADOW_BIAS, light);\n\t\t}\n\t\tif (isCookie) {\n\t\t\tthis.addLightDataCookies(data8, data8Start + 4 * TextureIndex8.COOKIE_A, light);\n\t\t}\n\t\tif (LightsBuffer.lightTextureFormat === LightsBuffer.FORMAT_FLOAT) {\n\t\t\tconst dataFloat = this.lightsFloat;\n\t\t\tconst dataFloatStart = lightIndex * this.lightsTextureFloat.width * 4;\n\t\t\tdataFloat[dataFloatStart + 4 * TextureIndexFloat.POSITION_RANGE + 0] = pos.x;\n\t\t\tdataFloat[dataFloatStart + 4 * TextureIndexFloat.POSITION_RANGE + 1] = pos.y;\n\t\t\tdataFloat[dataFloatStart + 4 * TextureIndexFloat.POSITION_RANGE + 2] = pos.z;\n\t\t\tdataFloat[dataFloatStart + 4 * TextureIndexFloat.POSITION_RANGE + 3] = light.attenuationEnd;\n\t\t\tif (isSpot) {\n\t\t\t\tthis.getSpotDirection(tempVec3, light);\n\t\t\t\tdataFloat[dataFloatStart + 4 * TextureIndexFloat.SPOT_DIRECTION + 0] = tempVec3.x;\n\t\t\t\tdataFloat[dataFloatStart + 4 * TextureIndexFloat.SPOT_DIRECTION + 1] = tempVec3.y;\n\t\t\t\tdataFloat[dataFloatStart + 4 * TextureIndexFloat.SPOT_DIRECTION + 2] = tempVec3.z;\n\t\t\t}\n\t\t\tif (lightProjectionMatrix) {\n\t\t\t\tconst matData = lightProjectionMatrix.data;\n\t\t\t\tfor (let m = 0; m < 16; m++) dataFloat[dataFloatStart + 4 * TextureIndexFloat.PROJ_MAT_0 + m] = matData[m];\n\t\t\t}\n\t\t\tif (atlasViewport) {\n\t\t\t\tdataFloat[dataFloatStart + 4 * TextureIndexFloat.ATLAS_VIEWPORT + 0] = atlasViewport.x;\n\t\t\t\tdataFloat[dataFloatStart + 4 * TextureIndexFloat.ATLAS_VIEWPORT + 1] = atlasViewport.y;\n\t\t\t\tdataFloat[dataFloatStart + 4 * TextureIndexFloat.ATLAS_VIEWPORT + 2] = atlasViewport.z / 3;\n\t\t\t}\n\t\t\tif (isArea) {\n\t\t\t\tconst areaSizes = this.getLightAreaSizes(light);\n\t\t\t\tdataFloat[dataFloatStart + 4 * TextureIndexFloat.AREA_DATA_WIDTH + 0] = areaSizes[0];\n\t\t\t\tdataFloat[dataFloatStart + 4 * TextureIndexFloat.AREA_DATA_WIDTH + 1] = areaSizes[1];\n\t\t\t\tdataFloat[dataFloatStart + 4 * TextureIndexFloat.AREA_DATA_WIDTH + 2] = areaSizes[2];\n\t\t\t\tdataFloat[dataFloatStart + 4 * TextureIndexFloat.AREA_DATA_HEIGHT + 0] = areaSizes[3];\n\t\t\t\tdataFloat[dataFloatStart + 4 * TextureIndexFloat.AREA_DATA_HEIGHT + 1] = areaSizes[4];\n\t\t\t\tdataFloat[dataFloatStart + 4 * TextureIndexFloat.AREA_DATA_HEIGHT + 2] = areaSizes[5];\n\t\t\t}\n\t\t} else {\n\t\t\tthis.addLightDataPositionRange(data8, data8Start + 4 * TextureIndex8.POSITION_X, light, pos);\n\t\t\tif (isSpot) {\n\t\t\t\tthis.addLightDataSpotDirection(data8, data8Start + 4 * TextureIndex8.SPOT_DIRECTION_X, light);\n\t\t\t}\n\t\t\tif (lightProjectionMatrix) {\n\t\t\t\tthis.addLightDataLightProjMatrix(data8, data8Start + 4 * TextureIndex8.PROJ_MAT_00, lightProjectionMatrix);\n\t\t\t}\n\t\t\tif (atlasViewport) {\n\t\t\t\tthis.addLightAtlasViewport(data8, data8Start + 4 * TextureIndex8.ATLAS_VIEWPORT_A, atlasViewport);\n\t\t\t}\n\t\t\tif (isArea) {\n\t\t\t\tthis.addLightAreaSizes(data8, data8Start + 4 * TextureIndex8.AREA_DATA_WIDTH_X, light);\n\t\t\t}\n\t\t}\n\t}\n}\n_class = LightsBuffer;\nLightsBuffer.FORMAT_FLOAT = 0;\nLightsBuffer.FORMAT_8BIT = 1;\nLightsBuffer.lightTextureFormat = _class.FORMAT_8BIT;\nLightsBuffer.useTexelFetch = false;\nLightsBuffer.shaderDefines = '';\n\nexport { LightsBuffer };\n","import { SEMANTIC_POSITION, SEMANTIC_ATTR12, SEMANTIC_ATTR13, SEMANTIC_ATTR14, SEMANTIC_ATTR15, SEMANTIC_NORMAL, SEMANTIC_TANGENT, SEMANTIC_COLOR, SEMANTIC_ATTR8, SEMANTIC_ATTR9, SEMANTIC_ATTR10, SEMANTIC_ATTR11, SEMANTIC_BLENDWEIGHT, SEMANTIC_BLENDINDICES, PIXELFORMAT_RGBA8, SHADERTAG_MATERIAL, SEMANTIC_TEXCOORD0, SEMANTIC_TEXCOORD1 } from '../../../platform/graphics/constants.js';\nimport { shaderChunks } from '../chunks/chunks.js';\nimport { ChunkUtils } from '../chunk-utils.js';\nimport { SPRITE_RENDERMODE_SLICED, SPRITE_RENDERMODE_TILED, LIGHTSHAPE_SPHERE, LIGHTSHAPE_DISK, LIGHTSHAPE_RECT, SHADER_DEPTH, LIGHTTYPE_DIRECTIONAL, SHADOW_VSM32, LIGHTTYPE_OMNI, SHADOW_PCSS, SHADOW_VSM8, LIGHTSHAPE_PUNCTUAL, LIGHTTYPE_SPOT, FRESNEL_SCHLICK, SPECOCC_GLOSSDEPENDENT, SPECOCC_AO, SHADOW_PCF3, SHADOW_PCF5, SHADOW_PCF1, SHADOW_VSM16, SPECULAR_PHONG, shadowTypeToString, LIGHTFALLOFF_LINEAR, BLEND_NORMAL, BLEND_PREMULTIPLIED, BLEND_ADDITIVEALPHA, SHADER_PICK } from '../../constants.js';\nimport { LightsBuffer } from '../../lighting/lights-buffer.js';\nimport { ShaderPass } from '../../shader-pass.js';\nimport '../../../core/tracing.js';\nimport { ShaderUtils } from '../../../platform/graphics/shader-utils.js';\nimport { ChunkBuilder } from '../chunk-builder.js';\nimport { ShaderGenerator } from './shader-generator.js';\n\nconst builtinAttributes = {\n\tvertex_normal: SEMANTIC_NORMAL,\n\tvertex_tangent: SEMANTIC_TANGENT,\n\tvertex_texCoord0: SEMANTIC_TEXCOORD0,\n\tvertex_texCoord1: SEMANTIC_TEXCOORD1,\n\tvertex_color: SEMANTIC_COLOR,\n\tvertex_boneWeights: SEMANTIC_BLENDWEIGHT,\n\tvertex_boneIndices: SEMANTIC_BLENDINDICES\n};\nconst builtinVaryings = {\n\tvVertexColor: \"vec4\",\n\tvPositionW: \"vec3\",\n\tvNormalV: \"vec3\",\n\tvNormalW: \"vec3\",\n\tvTangentW: \"vec3\",\n\tvBinormalW: \"vec3\",\n\tvObjectSpaceUpW: \"vec3\",\n\tvUv0: \"vec2\",\n\tvUv1: \"vec2\"\n};\nclass LitShader {\n\tconstructor(device, options) {\n\t\tthis.device = device;\n\t\tthis.options = options;\n\t\tthis.attributes = {\n\t\t\tvertex_position: SEMANTIC_POSITION\n\t\t};\n\t\tif (options.userAttributes) {\n\t\t\tfor (const [semantic, name] of Object.entries(options.userAttributes)) {\n\t\t\t\tthis.attributes[name] = semantic;\n\t\t\t}\n\t\t}\n\t\tif (options.chunks) {\n\t\t\tconst userChunks = options.chunks;\n\t\t\tthis.chunks = Object.create(shaderChunks);\n\t\t\tfor (const chunkName in shaderChunks) {\n\t\t\t\tif (userChunks.hasOwnProperty(chunkName)) {\n\t\t\t\t\tconst chunk = userChunks[chunkName];\n\t\t\t\t\tfor (const a in builtinAttributes) {\n\t\t\t\t\t\tif (builtinAttributes.hasOwnProperty(a) && chunk.indexOf(a) >= 0) {\n\t\t\t\t\t\t\tthis.attributes[a] = builtinAttributes[a];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.chunks[chunkName] = chunk;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthis.chunks = shaderChunks;\n\t\t}\n\t\tthis.shaderPassInfo = ShaderPass.get(this.device).getByIndex(options.pass);\n\t\tthis.shadowPass = this.shaderPassInfo.isShadow;\n\t\tthis.lighting = options.lights.length > 0 || options.dirLightMapEnabled || options.clusteredLightingEnabled;\n\t\tthis.reflections = !!options.reflectionSource;\n\t\tthis.needsNormal = this.lighting || this.reflections || options.useSpecular || options.ambientSH || options.useHeights || options.enableGGXSpecular || options.clusteredLightingEnabled && !this.shadowPass || options.useClearCoatNormals;\n\t\tthis.needsNormal = this.needsNormal && !this.shadowPass;\n\t\tthis.needsSceneColor = options.useDynamicRefraction;\n\t\tthis.needsScreenSize = options.useDynamicRefraction;\n\t\tthis.needsTransforms = options.useDynamicRefraction;\n\t\tthis.varyings = \"\";\n\t\tthis.varyingDefines = \"\";\n\t\tthis.vshader = null;\n\t\tthis.frontendDecl = null;\n\t\tthis.frontendCode = null;\n\t\tthis.frontendFunc = null;\n\t\tthis.lightingUv = null;\n\t\tthis.defines = [];\n\t\tthis.fshader = null;\n\t}\n\t_vsAddBaseCode(code, chunks, options) {\n\t\tcode += chunks.baseVS;\n\t\tif (options.nineSlicedMode === SPRITE_RENDERMODE_SLICED || options.nineSlicedMode === SPRITE_RENDERMODE_TILED) {\n\t\t\tcode += chunks.baseNineSlicedVS;\n\t\t}\n\t\treturn code;\n\t}\n\t_vsAddTransformCode(code, device, chunks, options) {\n\t\tcode += this.chunks.transformVS;\n\t\treturn code;\n\t}\n\t_setMapTransform(codes, name, id, uv) {\n\t\tconst checkId = id + uv * 100;\n\t\tif (!codes[3][checkId]) {\n\t\t\tconst varName = `texture_${name}MapTransform`;\n\t\t\tcodes[0] += `uniform vec3 ${varName}0;\\n`;\n\t\t\tcodes[0] += `uniform vec3 ${varName}1;\\n`;\n\t\t\tcodes[1] += `varying vec2 vUV${uv}_${id};\\n`;\n\t\t\tcodes[2] += `   vUV${uv}_${id} = vec2(dot(vec3(uv${uv}, 1), ${varName}0), dot(vec3(uv${uv}, 1), ${varName}1));\\n`;\n\t\t\tcodes[3][checkId] = true;\n\t\t}\n\t\treturn codes;\n\t}\n\t_fsGetBaseCode() {\n\t\tconst options = this.options;\n\t\tconst chunks = this.chunks;\n\t\tlet result = this.chunks.basePS;\n\t\tif (options.nineSlicedMode === SPRITE_RENDERMODE_SLICED) {\n\t\t\tresult += chunks.baseNineSlicedPS;\n\t\t} else if (options.nineSlicedMode === SPRITE_RENDERMODE_TILED) {\n\t\t\tresult += chunks.baseNineSlicedTiledPS;\n\t\t}\n\t\treturn result;\n\t}\n\t_fsGetStartCode(code, device, chunks, options) {\n\t\tlet result = chunks.startPS;\n\t\tif (options.nineSlicedMode === SPRITE_RENDERMODE_SLICED) {\n\t\t\tresult += chunks.startNineSlicedPS;\n\t\t} else if (options.nineSlicedMode === SPRITE_RENDERMODE_TILED) {\n\t\t\tresult += chunks.startNineSlicedTiledPS;\n\t\t}\n\t\treturn result;\n\t}\n\t_getLightSourceShapeString(shape) {\n\t\tswitch (shape) {\n\t\t\tcase LIGHTSHAPE_RECT:\n\t\t\t\treturn 'Rect';\n\t\t\tcase LIGHTSHAPE_DISK:\n\t\t\t\treturn 'Disk';\n\t\t\tcase LIGHTSHAPE_SPHERE:\n\t\t\t\treturn 'Sphere';\n\t\t\tdefault:\n\t\t\t\treturn '';\n\t\t}\n\t}\n\tgenerateVertexShader(useUv, useUnmodifiedUv, mapTransforms) {\n\t\tconst device = this.device;\n\t\tconst options = this.options;\n\t\tconst chunks = this.chunks;\n\t\tlet code = '';\n\t\tlet codeBody = '';\n\t\tcode = this._vsAddBaseCode(code, chunks, options);\n\t\tcodeBody += \"   vPositionW    = getWorldPosition();\\n\";\n\t\tif (this.options.pass === SHADER_DEPTH) {\n\t\t\tcode += 'varying float vDepth;\\n';\n\t\t\tcode += '#ifndef VIEWMATRIX\\n';\n\t\t\tcode += '#define VIEWMATRIX\\n';\n\t\t\tcode += 'uniform mat4 matrix_view;\\n';\n\t\t\tcode += '#endif\\n';\n\t\t\tcode += '#ifndef CAMERAPLANES\\n';\n\t\t\tcode += '#define CAMERAPLANES\\n';\n\t\t\tcode += 'uniform vec4 camera_params;\\n\\n';\n\t\t\tcode += '#endif\\n';\n\t\t\tcodeBody += \"    vDepth = -(matrix_view * vec4(vPositionW,1.0)).z * camera_params.x;\\n\";\n\t\t}\n\t\tif (this.options.useInstancing) {\n\t\t\tthis.attributes.instance_line1 = SEMANTIC_ATTR12;\n\t\t\tthis.attributes.instance_line2 = SEMANTIC_ATTR13;\n\t\t\tthis.attributes.instance_line3 = SEMANTIC_ATTR14;\n\t\t\tthis.attributes.instance_line4 = SEMANTIC_ATTR15;\n\t\t\tcode += chunks.instancingVS;\n\t\t}\n\t\tif (this.needsNormal) {\n\t\t\tthis.attributes.vertex_normal = SEMANTIC_NORMAL;\n\t\t\tcodeBody += \"   vNormalW = getNormal();\\n\";\n\t\t\tif (options.reflectionSource === 'sphereMap' && device.fragmentUniformsCount <= 16) {\n\t\t\t\tcode += chunks.viewNormalVS;\n\t\t\t\tcodeBody += \"   vNormalV    = getViewNormal();\\n\";\n\t\t\t}\n\t\t\tif (options.hasTangents && (options.useHeights || options.useNormals || options.enableGGXSpecular)) {\n\t\t\t\tthis.attributes.vertex_tangent = SEMANTIC_TANGENT;\n\t\t\t\tcode += chunks.tangentBinormalVS;\n\t\t\t\tcodeBody += \"   vTangentW   = getTangent();\\n\";\n\t\t\t\tcodeBody += \"   vBinormalW  = getBinormal();\\n\";\n\t\t\t} else if (options.enableGGXSpecular || !device.extStandardDerivatives) {\n\t\t\t\tcodeBody += \"   vObjectSpaceUpW = normalize(dNormalMatrix * vec3(0, 1, 0));\\n\";\n\t\t\t}\n\t\t}\n\t\tconst maxUvSets = 2;\n\t\tfor (let i = 0; i < maxUvSets; i++) {\n\t\t\tif (useUv[i]) {\n\t\t\t\tthis.attributes[\"vertex_texCoord\" + i] = \"TEXCOORD\" + i;\n\t\t\t\tcode += chunks[\"uv\" + i + \"VS\"];\n\t\t\t\tcodeBody += \"   vec2 uv\" + i + \" = getUv\" + i + \"();\\n\";\n\t\t\t}\n\t\t\tif (useUnmodifiedUv[i]) {\n\t\t\t\tcodeBody += \"   vUv\" + i + \" = uv\" + i + \";\\n\";\n\t\t\t}\n\t\t}\n\t\tconst codes = [code, this.varyings, codeBody, []];\n\t\tmapTransforms.forEach(mapTransform => {\n\t\t\tthis._setMapTransform(codes, mapTransform.name, mapTransform.id, mapTransform.uv);\n\t\t});\n\t\tcode = codes[0];\n\t\tthis.varyings = codes[1];\n\t\tcodeBody = codes[2];\n\t\tif (options.vertexColors) {\n\t\t\tthis.attributes.vertex_color = SEMANTIC_COLOR;\n\t\t\tcodeBody += \"   vVertexColor = vertex_color;\\n\";\n\t\t}\n\t\tif (options.useMsdf && options.msdfTextAttribute) {\n\t\t\tthis.attributes.vertex_outlineParameters = SEMANTIC_ATTR8;\n\t\t\tthis.attributes.vertex_shadowParameters = SEMANTIC_ATTR9;\n\t\t\tcodeBody += \"    unpackMsdfParams();\\n\";\n\t\t\tcode += chunks.msdfVS;\n\t\t}\n\t\tif (options.useMorphPosition || options.useMorphNormal) {\n\t\t\tif (options.useMorphTextureBased) {\n\t\t\t\tcode += \"#define MORPHING_TEXTURE_BASED\\n\";\n\t\t\t\tif (options.useMorphPosition) {\n\t\t\t\t\tcode += \"#define MORPHING_TEXTURE_BASED_POSITION\\n\";\n\t\t\t\t}\n\t\t\t\tif (options.useMorphNormal) {\n\t\t\t\t\tcode += \"#define MORPHING_TEXTURE_BASED_NORMAL\\n\";\n\t\t\t\t}\n\t\t\t\tthis.attributes.morph_vertex_id = SEMANTIC_ATTR15;\n\t\t\t\tconst morphIdType = device.isWebGPU ? 'uint' : 'float';\n\t\t\t\tcode += `attribute ${morphIdType} morph_vertex_id;\\n`;\n\t\t\t} else {\n\t\t\t\tcode += \"#define MORPHING\\n\";\n\t\t\t\tif (options.useMorphPosition) {\n\t\t\t\t\tthis.attributes.morph_pos0 = SEMANTIC_ATTR8;\n\t\t\t\t\tthis.attributes.morph_pos1 = SEMANTIC_ATTR9;\n\t\t\t\t\tthis.attributes.morph_pos2 = SEMANTIC_ATTR10;\n\t\t\t\t\tthis.attributes.morph_pos3 = SEMANTIC_ATTR11;\n\t\t\t\t\tcode += \"#define MORPHING_POS03\\n\";\n\t\t\t\t\tcode += \"attribute vec3 morph_pos0;\\n\";\n\t\t\t\t\tcode += \"attribute vec3 morph_pos1;\\n\";\n\t\t\t\t\tcode += \"attribute vec3 morph_pos2;\\n\";\n\t\t\t\t\tcode += \"attribute vec3 morph_pos3;\\n\";\n\t\t\t\t} else if (options.useMorphNormal) {\n\t\t\t\t\tthis.attributes.morph_nrm0 = SEMANTIC_ATTR8;\n\t\t\t\t\tthis.attributes.morph_nrm1 = SEMANTIC_ATTR9;\n\t\t\t\t\tthis.attributes.morph_nrm2 = SEMANTIC_ATTR10;\n\t\t\t\t\tthis.attributes.morph_nrm3 = SEMANTIC_ATTR11;\n\t\t\t\t\tcode += \"#define MORPHING_NRM03\\n\";\n\t\t\t\t\tcode += \"attribute vec3 morph_nrm0;\\n\";\n\t\t\t\t\tcode += \"attribute vec3 morph_nrm1;\\n\";\n\t\t\t\t\tcode += \"attribute vec3 morph_nrm2;\\n\";\n\t\t\t\t\tcode += \"attribute vec3 morph_nrm3;\\n\";\n\t\t\t\t}\n\t\t\t\tif (!options.useMorphNormal) {\n\t\t\t\t\tthis.attributes.morph_pos4 = SEMANTIC_ATTR12;\n\t\t\t\t\tthis.attributes.morph_pos5 = SEMANTIC_ATTR13;\n\t\t\t\t\tthis.attributes.morph_pos6 = SEMANTIC_ATTR14;\n\t\t\t\t\tthis.attributes.morph_pos7 = SEMANTIC_ATTR15;\n\t\t\t\t\tcode += \"#define MORPHING_POS47\\n\";\n\t\t\t\t\tcode += \"attribute vec3 morph_pos4;\\n\";\n\t\t\t\t\tcode += \"attribute vec3 morph_pos5;\\n\";\n\t\t\t\t\tcode += \"attribute vec3 morph_pos6;\\n\";\n\t\t\t\t\tcode += \"attribute vec3 morph_pos7;\\n\";\n\t\t\t\t} else {\n\t\t\t\t\tthis.attributes.morph_nrm4 = SEMANTIC_ATTR12;\n\t\t\t\t\tthis.attributes.morph_nrm5 = SEMANTIC_ATTR13;\n\t\t\t\t\tthis.attributes.morph_nrm6 = SEMANTIC_ATTR14;\n\t\t\t\t\tthis.attributes.morph_nrm7 = SEMANTIC_ATTR15;\n\t\t\t\t\tcode += \"#define MORPHING_NRM47\\n\";\n\t\t\t\t\tcode += \"attribute vec3 morph_nrm4;\\n\";\n\t\t\t\t\tcode += \"attribute vec3 morph_nrm5;\\n\";\n\t\t\t\t\tcode += \"attribute vec3 morph_nrm6;\\n\";\n\t\t\t\t\tcode += \"attribute vec3 morph_nrm7;\\n\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (options.skin) {\n\t\t\tthis.attributes.vertex_boneWeights = SEMANTIC_BLENDWEIGHT;\n\t\t\tthis.attributes.vertex_boneIndices = SEMANTIC_BLENDINDICES;\n\t\t\tcode += ShaderGenerator.skinCode(device, chunks);\n\t\t\tcode += \"#define SKIN\\n\";\n\t\t} else if (options.useInstancing) {\n\t\t\tcode += \"#define INSTANCING\\n\";\n\t\t}\n\t\tif (options.screenSpace) {\n\t\t\tcode += \"#define SCREENSPACE\\n\";\n\t\t}\n\t\tif (options.pixelSnap) {\n\t\t\tcode += \"#define PIXELSNAP\\n\";\n\t\t}\n\t\tcode = this._vsAddTransformCode(code, device, chunks, options);\n\t\tif (this.needsNormal) {\n\t\t\tcode += chunks.normalVS;\n\t\t}\n\t\tcode += \"\\n\";\n\t\tcode += chunks.startVS;\n\t\tcode += codeBody;\n\t\tcode += chunks.endVS;\n\t\tcode += \"}\";\n\t\tObject.keys(builtinVaryings).forEach(v => {\n\t\t\tif (code.indexOf(v) >= 0) {\n\t\t\t\tthis.varyings += `varying ${builtinVaryings[v]} ${v};\\n`;\n\t\t\t\tthis.varyingDefines += `#define VARYING_${v.toUpperCase()}\\n`;\n\t\t\t}\n\t\t});\n\t\tconst shaderPassDefines = this.shaderPassInfo.shaderDefines;\n\t\tthis.vshader = shaderPassDefines + this.varyings + code;\n\t}\n\t_fsGetBeginCode() {\n\t\tlet code = this.shaderPassInfo.shaderDefines;\n\t\tfor (let i = 0; i < this.defines.length; i++) {\n\t\t\tcode += `#define ${this.defines[i]}\\n`;\n\t\t}\n\t\treturn code;\n\t}\n\t_fsGetPickPassCode() {\n\t\tlet code = this._fsGetBeginCode();\n\t\tcode += \"uniform vec4 uColor;\\n\";\n\t\tcode += this.varyings;\n\t\tcode += this.varyingDefines;\n\t\tcode += this.frontendDecl;\n\t\tcode += this.frontendCode;\n\t\tcode += ShaderGenerator.begin();\n\t\tcode += this.frontendFunc;\n\t\tcode += \"    gl_FragColor = uColor;\\n\";\n\t\tcode += ShaderGenerator.end();\n\t\treturn code;\n\t}\n\t_fsGetDepthPassCode() {\n\t\tconst chunks = this.chunks;\n\t\tlet code = this._fsGetBeginCode();\n\t\tcode += 'varying float vDepth;\\n';\n\t\tcode += this.varyings;\n\t\tcode += this.varyingDefines;\n\t\tcode += chunks.packDepthPS;\n\t\tcode += this.frontendDecl;\n\t\tcode += this.frontendCode;\n\t\tcode += ShaderGenerator.begin();\n\t\tcode += this.frontendFunc;\n\t\tcode += \"    gl_FragColor = packFloat(vDepth);\\n\";\n\t\tcode += ShaderGenerator.end();\n\t\treturn code;\n\t}\n\t_fsGetShadowPassCode() {\n\t\tconst device = this.device;\n\t\tconst options = this.options;\n\t\tconst chunks = this.chunks;\n\t\tconst varyings = this.varyings;\n\t\tconst lightType = this.shaderPassInfo.lightType;\n\t\tlet shadowType = this.shaderPassInfo.shadowType;\n\t\tif (lightType !== LIGHTTYPE_DIRECTIONAL && options.clusteredLightingEnabled) {\n\t\t\tif (shadowType === SHADOW_VSM8 || shadowType === SHADOW_VSM16 || shadowType === SHADOW_VSM32 || shadowType === SHADOW_PCSS) {\n\t\t\t\tshadowType = SHADOW_PCF3;\n\t\t\t}\n\t\t}\n\t\tlet code = this._fsGetBeginCode();\n\t\tif (device.extStandardDerivatives && device.isWebGL1) {\n\t\t\tcode += 'uniform vec2 polygonOffset;\\n';\n\t\t}\n\t\tif (shadowType === SHADOW_VSM32) {\n\t\t\tif (device.textureFloatHighPrecision) {\n\t\t\t\tcode += '#define VSM_EXPONENT 15.0\\n\\n';\n\t\t\t} else {\n\t\t\t\tcode += '#define VSM_EXPONENT 5.54\\n\\n';\n\t\t\t}\n\t\t} else if (shadowType === SHADOW_VSM16) {\n\t\t\tcode += '#define VSM_EXPONENT 5.54\\n\\n';\n\t\t}\n\t\tif (lightType !== LIGHTTYPE_DIRECTIONAL) {\n\t\t\tcode += 'uniform vec3 view_position;\\n';\n\t\t\tcode += 'uniform float light_radius;\\n';\n\t\t}\n\t\tcode += varyings;\n\t\tcode += this.varyingDefines;\n\t\tcode += this.frontendDecl;\n\t\tcode += this.frontendCode;\n\t\tconst mayPackDepth = shadowType === SHADOW_PCF1 || shadowType === SHADOW_PCF3 || shadowType === SHADOW_PCF5 || shadowType === SHADOW_PCSS;\n\t\tconst mustPackDepth = lightType === LIGHTTYPE_OMNI && shadowType !== SHADOW_PCSS && !options.clusteredLightingEnabled;\n\t\tconst usePackedDepth = mayPackDepth && !device.supportsDepthShadow || mustPackDepth;\n\t\tif (usePackedDepth) {\n\t\t\tcode += chunks.packDepthPS;\n\t\t} else if (shadowType === SHADOW_VSM8) {\n\t\t\tcode += \"vec2 encodeFloatRG( float v ) {\\n\";\n\t\t\tcode += \"    vec2 enc = vec2(1.0, 255.0) * v;\\n\";\n\t\t\tcode += \"    enc = fract(enc);\\n\";\n\t\t\tcode += \"    enc -= enc.yy * vec2(1.0/255.0, 1.0/255.0);\\n\";\n\t\t\tcode += \"    return enc;\\n\";\n\t\t\tcode += \"}\\n\\n\";\n\t\t}\n\t\tif (shadowType === SHADOW_PCSS) {\n\t\t\tcode += shaderChunks.linearizeDepthPS;\n\t\t}\n\t\tcode += ShaderGenerator.begin();\n\t\tcode += this.frontendFunc;\n\t\tconst isVsm = shadowType === SHADOW_VSM8 || shadowType === SHADOW_VSM16 || shadowType === SHADOW_VSM32;\n\t\tconst applySlopeScaleBias = device.isWebGL1 && device.extStandardDerivatives;\n\t\tconst usePerspectiveDepth = lightType === LIGHTTYPE_DIRECTIONAL || !isVsm && lightType === LIGHTTYPE_SPOT;\n\t\tlet hasModifiedDepth = false;\n\t\tif (usePerspectiveDepth) {\n\t\t\tcode += \"    float depth = gl_FragCoord.z;\\n\";\n\t\t} else {\n\t\t\tcode += \"    float depth = min(distance(view_position, vPositionW) / light_radius, 0.99999);\\n\";\n\t\t\thasModifiedDepth = true;\n\t\t}\n\t\tif (applySlopeScaleBias) {\n\t\t\tcode += \"    float minValue = 2.3374370500153186e-10; //(1.0 / 255.0) / (256.0 * 256.0 * 256.0);\\n\";\n\t\t\tcode += \"    depth += polygonOffset.x * max(abs(dFdx(depth)), abs(dFdy(depth))) + minValue * polygonOffset.y;\\n\";\n\t\t\thasModifiedDepth = true;\n\t\t}\n\t\tif (usePackedDepth) {\n\t\t\tcode += \"    gl_FragColor = packFloat(depth);\\n\";\n\t\t} else if (!isVsm) {\n\t\t\tconst exportR32 = shadowType === SHADOW_PCSS;\n\t\t\tif (exportR32) {\n\t\t\t\tcode += \"    gl_FragColor.r = depth;\\n\";\n\t\t\t} else {\n\t\t\t\tif (hasModifiedDepth) {\n\t\t\t\t\tcode += \"    gl_FragDepth = depth;\\n\";\n\t\t\t\t}\n\t\t\t\tcode += \"    gl_FragColor = vec4(1.0);\\n\";\n\t\t\t}\n\t\t} else if (shadowType === SHADOW_VSM8) {\n\t\t\tcode += \"    gl_FragColor = vec4(encodeFloatRG(depth), encodeFloatRG(depth*depth));\\n\";\n\t\t} else {\n\t\t\tcode += chunks.storeEVSMPS;\n\t\t}\n\t\tcode += ShaderGenerator.end();\n\t\treturn code;\n\t}\n\t_fsGetLitPassCode() {\n\t\tconst device = this.device;\n\t\tconst options = this.options;\n\t\tconst chunks = this.chunks;\n\t\tconst decl = new ChunkBuilder();\n\t\tconst func = new ChunkBuilder();\n\t\tconst backend = new ChunkBuilder();\n\t\tconst code = new ChunkBuilder();\n\t\tif (options.opacityFadesSpecular === false) {\n\t\t\tdecl.append('uniform float material_alphaFade;');\n\t\t}\n\t\tif (options.useSpecular) {\n\t\t\tthis.defines.push(\"LIT_SPECULAR\");\n\t\t\tif (this.reflections) {\n\t\t\t\tthis.defines.push(\"LIT_REFLECTIONS\");\n\t\t\t}\n\t\t\tif (options.useClearCoat) {\n\t\t\t\tthis.defines.push(\"LIT_CLEARCOAT\");\n\t\t\t}\n\t\t\tif (options.fresnelModel > 0) {\n\t\t\t\tthis.defines.push(\"LIT_SPECULAR_FRESNEL\");\n\t\t\t}\n\t\t\tif (options.conserveEnergy) {\n\t\t\t\tthis.defines.push(\"LIT_CONSERVE_ENERGY\");\n\t\t\t}\n\t\t\tif (options.useSheen) {\n\t\t\t\tthis.defines.push(\"LIT_SHEEN\");\n\t\t\t}\n\t\t\tif (options.useIridescence) {\n\t\t\t\tthis.defines.push(\"LIT_IRIDESCENCE\");\n\t\t\t}\n\t\t}\n\t\tconst shadowTypeUsed = [];\n\t\tlet numShadowLights = 0;\n\t\tlet shadowedDirectionalLightUsed = false;\n\t\tlet useVsm = false;\n\t\tlet usePcss = false;\n\t\tlet hasAreaLights = options.lights.some(function (light) {\n\t\t\treturn light._shape && light._shape !== LIGHTSHAPE_PUNCTUAL;\n\t\t});\n\t\tif (options.clusteredLightingEnabled && options.clusteredLightingAreaLightsEnabled) {\n\t\t\thasAreaLights = true;\n\t\t}\n\t\tlet areaLutsPrecision = 'highp';\n\t\tif (device.areaLightLutFormat === PIXELFORMAT_RGBA8) {\n\t\t\tdecl.append(\"#define AREA_R8_G8_B8_A8_LUTS\");\n\t\t\tareaLutsPrecision = 'lowp';\n\t\t}\n\t\tif (hasAreaLights || options.clusteredLightingEnabled) {\n\t\t\tdecl.append(\"#define AREA_LIGHTS\");\n\t\t\tdecl.append(`uniform ${areaLutsPrecision} sampler2D areaLightsLutTex1;`);\n\t\t\tdecl.append(`uniform ${areaLutsPrecision} sampler2D areaLightsLutTex2;`);\n\t\t}\n\t\tfor (let i = 0; i < options.lights.length; i++) {\n\t\t\tconst light = options.lights[i];\n\t\t\tconst lightType = light._type;\n\t\t\tif (options.clusteredLightingEnabled && lightType !== LIGHTTYPE_DIRECTIONAL) continue;\n\t\t\tconst lightShape = hasAreaLights && light._shape ? light._shape : LIGHTSHAPE_PUNCTUAL;\n\t\t\tdecl.append(\"uniform vec3 light\" + i + \"_color;\");\n\t\t\tif (light._shadowType === SHADOW_PCSS && light.castShadows && !options.noShadow) {\n\t\t\t\tdecl.append(`uniform float light${i}_shadowSearchArea;`);\n\t\t\t\tdecl.append(`uniform vec4 light${i}_cameraParams;`);\n\t\t\t}\n\t\t\tif (lightType === LIGHTTYPE_DIRECTIONAL) {\n\t\t\t\tdecl.append(\"uniform vec3 light\" + i + \"_direction;\");\n\t\t\t} else {\n\t\t\t\tdecl.append(\"uniform vec3 light\" + i + \"_position;\");\n\t\t\t\tdecl.append(\"uniform float light\" + i + \"_radius;\");\n\t\t\t\tif (lightType === LIGHTTYPE_SPOT) {\n\t\t\t\t\tdecl.append(\"uniform vec3 light\" + i + \"_direction;\");\n\t\t\t\t\tdecl.append(\"uniform float light\" + i + \"_innerConeAngle;\");\n\t\t\t\t\tdecl.append(\"uniform float light\" + i + \"_outerConeAngle;\");\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (lightShape !== LIGHTSHAPE_PUNCTUAL) {\n\t\t\t\tif (lightType === LIGHTTYPE_DIRECTIONAL) {\n\t\t\t\t\tdecl.append(\"uniform vec3 light\" + i + \"_position;\");\n\t\t\t\t}\n\t\t\t\tdecl.append(\"uniform vec3 light\" + i + \"_halfWidth;\");\n\t\t\t\tdecl.append(\"uniform vec3 light\" + i + \"_halfHeight;\");\n\t\t\t}\n\t\t\tif (light.castShadows && !options.noShadow) {\n\t\t\t\tdecl.append(\"uniform mat4 light\" + i + \"_shadowMatrix;\");\n\t\t\t\tdecl.append(\"uniform float light\" + i + \"_shadowIntensity;\");\n\t\t\t\tif (lightType === LIGHTTYPE_DIRECTIONAL) {\n\t\t\t\t\tdecl.append(\"uniform mat4 light\" + i + \"_shadowMatrixPalette[4];\");\n\t\t\t\t\tdecl.append(\"uniform float light\" + i + \"_shadowCascadeDistances[4];\");\n\t\t\t\t\tdecl.append(\"uniform float light\" + i + \"_shadowCascadeCount;\");\n\t\t\t\t}\n\t\t\t\tdecl.append(\"uniform vec4 light\" + i + \"_shadowParams;\");\n\t\t\t\tif (lightType === LIGHTTYPE_DIRECTIONAL) {\n\t\t\t\t\tshadowedDirectionalLightUsed = true;\n\t\t\t\t}\n\t\t\t\tif (lightType === LIGHTTYPE_OMNI) {\n\t\t\t\t\tdecl.append(\"uniform samplerCube light\" + i + \"_shadowMap;\");\n\t\t\t\t} else {\n\t\t\t\t\tif (light._isPcf && device.supportsDepthShadow) {\n\t\t\t\t\t\tdecl.append(\"uniform sampler2DShadow light\" + i + \"_shadowMap;\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdecl.append(\"uniform sampler2D light\" + i + \"_shadowMap;\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tnumShadowLights++;\n\t\t\t\tshadowTypeUsed[light._shadowType] = true;\n\t\t\t\tif (light._isVsm) useVsm = true;\n\t\t\t\tif (light._shadowType === SHADOW_PCSS) usePcss = true;\n\t\t\t}\n\t\t\tif (light._cookie) {\n\t\t\t\tif (light._cookie._cubemap) {\n\t\t\t\t\tif (lightType === LIGHTTYPE_OMNI) {\n\t\t\t\t\t\tdecl.append(\"uniform samplerCube light\" + i + \"_cookie;\");\n\t\t\t\t\t\tdecl.append(\"uniform float light\" + i + \"_cookieIntensity;\");\n\t\t\t\t\t\tif (!light.castShadows || options.noShadow) {\n\t\t\t\t\t\t\tdecl.append(\"uniform mat4 light\" + i + \"_shadowMatrix;\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (lightType === LIGHTTYPE_SPOT) {\n\t\t\t\t\t\tdecl.append(\"uniform sampler2D light\" + i + \"_cookie;\");\n\t\t\t\t\t\tdecl.append(\"uniform float light\" + i + \"_cookieIntensity;\");\n\t\t\t\t\t\tif (!light.castShadows || options.noShadow) {\n\t\t\t\t\t\t\tdecl.append(\"uniform mat4 light\" + i + \"_shadowMatrix;\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (light._cookieTransform) {\n\t\t\t\t\t\t\tdecl.append(\"uniform vec4 light\" + i + \"_cookieMatrix;\");\n\t\t\t\t\t\t\tdecl.append(\"uniform vec2 light\" + i + \"_cookieOffset;\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst hasTBN = this.needsNormal && (options.useNormals || options.useClearCoatNormals || options.enableGGXSpecular && !options.useHeights);\n\t\tif (hasTBN) {\n\t\t\tif (options.hasTangents) {\n\t\t\t\tfunc.append(options.fastTbn ? chunks.TBNfastPS : chunks.TBNPS);\n\t\t\t} else {\n\t\t\t\tif (device.extStandardDerivatives && (options.useNormals || options.useClearCoatNormals)) {\n\t\t\t\t\tfunc.append(chunks.TBNderivativePS.replace(/\\$UV/g, this.lightingUv));\n\t\t\t\t} else {\n\t\t\t\t\tfunc.append(chunks.TBNObjectSpacePS);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfunc.append(chunks.sphericalPS);\n\t\tfunc.append(chunks.decodePS);\n\t\tfunc.append(ShaderGenerator.gammaCode(options.gamma, chunks));\n\t\tfunc.append(ShaderGenerator.tonemapCode(options.toneMap, chunks));\n\t\tfunc.append(ShaderGenerator.fogCode(options.fog, chunks));\n\t\tfunc.append(this.frontendCode);\n\t\tif (options.useCubeMapRotation) {\n\t\t\tdecl.append(\"#define CUBEMAP_ROTATION\");\n\t\t}\n\t\tif (this.needsNormal) {\n\t\t\tfunc.append(chunks.cubeMapRotatePS);\n\t\t\tfunc.append(options.cubeMapProjection > 0 ? chunks.cubeMapProjectBoxPS : chunks.cubeMapProjectNonePS);\n\t\t\tfunc.append(options.skyboxIntensity ? chunks.envMultiplyPS : chunks.envConstPS);\n\t\t}\n\t\tif (this.lighting && options.useSpecular || this.reflections) {\n\t\t\tif (options.useMetalness) {\n\t\t\t\tfunc.append(chunks.metalnessModulatePS);\n\t\t\t}\n\t\t\tif (options.fresnelModel === FRESNEL_SCHLICK) {\n\t\t\t\tfunc.append(chunks.fresnelSchlickPS);\n\t\t\t}\n\t\t\tif (options.useIridescence) {\n\t\t\t\tfunc.append(chunks.iridescenceDiffractionPS);\n\t\t\t}\n\t\t}\n\t\tif (options.useAo) {\n\t\t\tfunc.append(chunks.aoDiffuseOccPS);\n\t\t\tswitch (options.occludeSpecular) {\n\t\t\t\tcase SPECOCC_AO:\n\t\t\t\t\tfunc.append(options.occludeSpecularFloat ? chunks.aoSpecOccSimplePS : chunks.aoSpecOccConstSimplePS);\n\t\t\t\t\tbreak;\n\t\t\t\tcase SPECOCC_GLOSSDEPENDENT:\n\t\t\t\t\tfunc.append(options.occludeSpecularFloat ? chunks.aoSpecOccPS : chunks.aoSpecOccConstPS);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (options.reflectionSource === 'envAtlasHQ') {\n\t\t\tfunc.append(options.fixSeams ? chunks.fixCubemapSeamsStretchPS : chunks.fixCubemapSeamsNonePS);\n\t\t\tfunc.append(chunks.envAtlasPS);\n\t\t\tfunc.append(chunks.reflectionEnvHQPS.replace(/\\$DECODE_CUBEMAP/g, ChunkUtils.decodeFunc(options.reflectionCubemapEncoding)).replace(/\\$DECODE/g, ChunkUtils.decodeFunc(options.reflectionEncoding)));\n\t\t} else if (options.reflectionSource === 'envAtlas') {\n\t\t\tfunc.append(chunks.envAtlasPS);\n\t\t\tfunc.append(chunks.reflectionEnvPS.replace(/\\$DECODE/g, ChunkUtils.decodeFunc(options.reflectionEncoding)));\n\t\t} else if (options.reflectionSource === 'cubeMap') {\n\t\t\tfunc.append(options.fixSeams ? chunks.fixCubemapSeamsStretchPS : chunks.fixCubemapSeamsNonePS);\n\t\t\tfunc.append(chunks.reflectionCubePS.replace(/\\$DECODE/g, ChunkUtils.decodeFunc(options.reflectionEncoding)));\n\t\t} else if (options.reflectionSource === 'sphereMap') {\n\t\t\tconst scode = device.fragmentUniformsCount > 16 ? chunks.reflectionSpherePS : chunks.reflectionSphereLowPS;\n\t\t\tfunc.append(scode.replace(/\\$DECODE/g, ChunkUtils.decodeFunc(options.reflectionEncoding)));\n\t\t}\n\t\tif (this.reflections) {\n\t\t\tif (options.useClearCoat) {\n\t\t\t\tfunc.append(chunks.reflectionCCPS);\n\t\t\t}\n\t\t\tif (options.useSheen) {\n\t\t\t\tfunc.append(chunks.reflectionSheenPS);\n\t\t\t}\n\t\t}\n\t\tif (options.useRefraction) {\n\t\t\tif (options.useDynamicRefraction) {\n\t\t\t\tfunc.append(chunks.refractionDynamicPS);\n\t\t\t} else if (this.reflections) {\n\t\t\t\tfunc.append(chunks.refractionCubePS);\n\t\t\t}\n\t\t}\n\t\tif (options.useSheen) {\n\t\t\tfunc.append(chunks.lightSheenPS);\n\t\t}\n\t\tif (options.clusteredLightingEnabled) {\n\t\t\tfunc.append(chunks.clusteredLightUtilsPS);\n\t\t\tif (options.clusteredLightingCookiesEnabled) func.append(chunks.clusteredLightCookiesPS);\n\t\t\tif (options.clusteredLightingShadowsEnabled && !options.noShadow) {\n\t\t\t\tshadowTypeUsed[SHADOW_PCF3] = true;\n\t\t\t\tshadowTypeUsed[SHADOW_PCF5] = true;\n\t\t\t\tshadowTypeUsed[SHADOW_PCSS] = true;\n\t\t\t}\n\t\t}\n\t\tif (numShadowLights > 0 || options.clusteredLightingEnabled) {\n\t\t\tif (shadowedDirectionalLightUsed) {\n\t\t\t\tfunc.append(chunks.shadowCascadesPS);\n\t\t\t}\n\t\t\tif (shadowTypeUsed[SHADOW_PCF1] || shadowTypeUsed[SHADOW_PCF3]) {\n\t\t\t\tfunc.append(chunks.shadowStandardPS);\n\t\t\t}\n\t\t\tif (shadowTypeUsed[SHADOW_PCF5] && !device.isWebGL1) {\n\t\t\t\tfunc.append(chunks.shadowStandardGL2PS);\n\t\t\t}\n\t\t\tif (useVsm) {\n\t\t\t\tfunc.append(chunks.shadowVSM_commonPS);\n\t\t\t\tif (shadowTypeUsed[SHADOW_VSM8]) {\n\t\t\t\t\tfunc.append(chunks.shadowVSM8PS);\n\t\t\t\t}\n\t\t\t\tif (shadowTypeUsed[SHADOW_VSM16]) {\n\t\t\t\t\tfunc.append(device.extTextureHalfFloatLinear ? chunks.shadowEVSMPS.replace(/\\$/g, \"16\") : chunks.shadowEVSMnPS.replace(/\\$/g, \"16\"));\n\t\t\t\t}\n\t\t\t\tif (shadowTypeUsed[SHADOW_VSM32]) {\n\t\t\t\t\tfunc.append(device.extTextureFloatLinear ? chunks.shadowEVSMPS.replace(/\\$/g, \"32\") : chunks.shadowEVSMnPS.replace(/\\$/g, \"32\"));\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (usePcss) {\n\t\t\t\tfunc.append(chunks.linearizeDepthPS);\n\t\t\t\tfunc.append(chunks.shadowPCSSPS);\n\t\t\t}\n\t\t\tif (!(device.isWebGL2 || device.isWebGPU || device.extStandardDerivatives)) {\n\t\t\t\tfunc.append(chunks.biasConstPS);\n\t\t\t}\n\t\t}\n\t\tif (options.enableGGXSpecular) func.append(\"uniform float material_anisotropy;\");\n\t\tif (this.lighting) {\n\t\t\tfunc.append(chunks.lightDiffuseLambertPS);\n\t\t\tif (hasAreaLights || options.clusteredLightingAreaLightsEnabled) {\n\t\t\t\tfunc.append(chunks.ltcPS);\n\t\t\t}\n\t\t}\n\t\tlet useOldAmbient = false;\n\t\tif (options.useSpecular) {\n\t\t\tif (this.lighting) {\n\t\t\t\tfunc.append(options.shadingModel === SPECULAR_PHONG ? chunks.lightSpecularPhongPS : options.enableGGXSpecular ? chunks.lightSpecularAnisoGGXPS : chunks.lightSpecularBlinnPS);\n\t\t\t}\n\t\t\tif (!options.fresnelModel && !this.reflections && !options.diffuseMapEnabled) {\n\t\t\t\tdecl.append(\"uniform vec3 material_ambient;\");\n\t\t\t\tdecl.append(\"#define LIT_OLD_AMBIENT\");\n\t\t\t\tuseOldAmbient = true;\n\t\t\t}\n\t\t}\n\t\tfunc.append(chunks.combinePS);\n\t\tif (options.lightMapEnabled) {\n\t\t\tfunc.append(options.useSpecular && options.dirLightMapEnabled ? chunks.lightmapDirAddPS : chunks.lightmapAddPS);\n\t\t}\n\t\tconst addAmbient = !options.lightMapEnabled || options.lightMapWithoutAmbient;\n\t\tif (addAmbient) {\n\t\t\tif (options.ambientSource === 'ambientSH') {\n\t\t\t\tfunc.append(chunks.ambientSHPS);\n\t\t\t} else if (options.ambientSource === 'envAtlas') {\n\t\t\t\tif (options.reflectionSource !== 'envAtlas' && options.reflectionSource !== 'envAtlasHQ') {\n\t\t\t\t\tfunc.append(chunks.envAtlasPS);\n\t\t\t\t}\n\t\t\t\tfunc.append(chunks.ambientEnvPS.replace(/\\$DECODE/g, ChunkUtils.decodeFunc(options.ambientEncoding)));\n\t\t\t} else {\n\t\t\t\tfunc.append(chunks.ambientConstantPS);\n\t\t\t}\n\t\t}\n\t\tif (options.useAmbientTint && !useOldAmbient) {\n\t\t\tdecl.append(\"uniform vec3 material_ambient;\");\n\t\t}\n\t\tif (options.useMsdf) {\n\t\t\tif (!options.msdfTextAttribute) {\n\t\t\t\tdecl.append(\"#define UNIFORM_TEXT_PARAMETERS\");\n\t\t\t}\n\t\t\tfunc.append(chunks.msdfPS);\n\t\t}\n\t\tif (this.needsNormal) {\n\t\t\tfunc.append(chunks.viewDirPS);\n\t\t\tif (options.useSpecular) {\n\t\t\t\tfunc.append(options.enableGGXSpecular ? chunks.reflDirAnisoPS : chunks.reflDirPS);\n\t\t\t}\n\t\t}\n\t\tlet hasPointLights = false;\n\t\tlet usesLinearFalloff = false;\n\t\tlet usesInvSquaredFalloff = false;\n\t\tlet usesSpot = false;\n\t\tlet usesCookie = false;\n\t\tlet usesCookieNow;\n\t\tif (options.clusteredLightingEnabled && this.lighting) {\n\t\t\tusesSpot = true;\n\t\t\thasPointLights = true;\n\t\t\tusesLinearFalloff = true;\n\t\t\tusesCookie = true;\n\t\t\tfunc.append(chunks.floatUnpackingPS);\n\t\t\tif (options.lightMaskDynamic) decl.append(\"#define CLUSTER_MESH_DYNAMIC_LIGHTS\");\n\t\t\tif (options.clusteredLightingCookiesEnabled) decl.append(\"#define CLUSTER_COOKIES\");\n\t\t\tif (options.clusteredLightingShadowsEnabled && !options.noShadow) {\n\t\t\t\tdecl.append(\"#define CLUSTER_SHADOWS\");\n\t\t\t\tdecl.append(\"#define CLUSTER_SHADOW_TYPE_\" + shadowTypeToString[options.clusteredLightingShadowType]);\n\t\t\t}\n\t\t\tif (options.clusteredLightingAreaLightsEnabled) decl.append(\"#define CLUSTER_AREALIGHTS\");\n\t\t\tdecl.append(LightsBuffer.shaderDefines);\n\t\t\tif (options.clusteredLightingShadowsEnabled && !options.noShadow) {\n\t\t\t\tfunc.append(chunks.clusteredLightShadowsPS);\n\t\t\t}\n\t\t\tfunc.append(chunks.clusteredLightPS);\n\t\t}\n\t\tif (options.twoSidedLighting) {\n\t\t\tdecl.append(\"uniform float twoSidedLightingNegScaleFactor;\");\n\t\t}\n\t\tcode.append(this._fsGetStartCode(code, device, chunks, options));\n\t\tif (this.needsNormal) {\n\t\t\tif (options.twoSidedLighting) {\n\t\t\t\tcode.append(\"    dVertexNormalW = normalize(gl_FrontFacing ? vNormalW * twoSidedLightingNegScaleFactor : -vNormalW * twoSidedLightingNegScaleFactor);\");\n\t\t\t} else {\n\t\t\t\tcode.append(\"    dVertexNormalW = normalize(vNormalW);\");\n\t\t\t}\n\t\t\tif ((options.useHeights || options.useNormals) && options.hasTangents) {\n\t\t\t\tif (options.twoSidedLighting) {\n\t\t\t\t\tcode.append(\"    dTangentW = gl_FrontFacing ? vTangentW * twoSidedLightingNegScaleFactor : -vTangentW * twoSidedLightingNegScaleFactor;\");\n\t\t\t\t\tcode.append(\"    dBinormalW = gl_FrontFacing ? vBinormalW * twoSidedLightingNegScaleFactor : -vBinormalW * twoSidedLightingNegScaleFactor;\");\n\t\t\t\t} else {\n\t\t\t\t\tcode.append(\"    dTangentW = vTangentW;\");\n\t\t\t\t\tcode.append(\"    dBinormalW = vBinormalW;\");\n\t\t\t\t}\n\t\t\t}\n\t\t\tcode.append(\"    getViewDir();\");\n\t\t\tif (hasTBN) {\n\t\t\t\tcode.append(\"    getTBN(dTangentW, dBinormalW, dVertexNormalW);\");\n\t\t\t}\n\t\t}\n\t\tcode.append(this.frontendFunc);\n\t\tif (this.needsNormal) {\n\t\t\tif (options.useSpecular) {\n\t\t\t\tbackend.append(\"    getReflDir(litArgs_worldNormal, dViewDirW, litArgs_gloss, dTBN);\");\n\t\t\t}\n\t\t\tif (options.useClearCoat) {\n\t\t\t\tbackend.append(\"    ccReflDirW = normalize(-reflect(dViewDirW, litArgs_clearcoat_worldNormal));\");\n\t\t\t}\n\t\t}\n\t\tif (this.lighting && options.useSpecular || this.reflections) {\n\t\t\tif (options.useMetalness) {\n\t\t\t\tbackend.append(\"    float f0 = 1.0 / litArgs_ior; f0 = (f0 - 1.0) / (f0 + 1.0); f0 *= f0;\");\n\t\t\t\tbackend.append(\"    litArgs_specularity = getSpecularModulate(litArgs_specularity, litArgs_albedo, litArgs_metalness, f0);\");\n\t\t\t\tbackend.append(\"    litArgs_albedo = getAlbedoModulate(litArgs_albedo, litArgs_metalness);\");\n\t\t\t}\n\t\t\tif (options.useIridescence) {\n\t\t\t\tbackend.append(\"    vec3 iridescenceFresnel = getIridescence(saturate(dot(dViewDirW, litArgs_worldNormal)), litArgs_specularity, litArgs_iridescence_thickness);\");\n\t\t\t}\n\t\t}\n\t\tif (addAmbient) {\n\t\t\tbackend.append(\"    addAmbient(litArgs_worldNormal);\");\n\t\t\tif (options.conserveEnergy && options.useSpecular) {\n\t\t\t\tbackend.append(`   dDiffuseLight = dDiffuseLight * (1.0 - litArgs_specularity);`);\n\t\t\t}\n\t\t\tif (options.separateAmbient) {\n\t\t\t\tbackend.append(`\n\t\t\t\t\t\t\t\t\t\tvec3 dAmbientLight = dDiffuseLight;\n\t\t\t\t\t\t\t\t\t\tdDiffuseLight = vec3(0);\n\t\t\t\t\t\t\t\t`);\n\t\t\t}\n\t\t}\n\t\tif (options.useAmbientTint && !useOldAmbient) {\n\t\t\tbackend.append(\"    dDiffuseLight *= material_ambient;\");\n\t\t}\n\t\tif (options.useAo && !options.occludeDirect) {\n\t\t\tbackend.append(\"    occludeDiffuse(litArgs_ao);\");\n\t\t}\n\t\tif (options.lightMapEnabled) {\n\t\t\tbackend.append(`    addLightMap(\n\t\t\t\t\t\t\t\tlitArgs_lightmap, \n\t\t\t\t\t\t\t\tlitArgs_lightmapDir, \n\t\t\t\t\t\t\t\tlitArgs_worldNormal, \n\t\t\t\t\t\t\t\tdViewDirW, \n\t\t\t\t\t\t\t\tdReflDirW, \n\t\t\t\t\t\t\t\tlitArgs_gloss, \n\t\t\t\t\t\t\t\tlitArgs_specularity, \n\t\t\t\t\t\t\t\tdVertexNormalW,\n\t\t\t\t\t\t\t\tdTBN\n\t\t\t\t\t\t#if defined(LIT_IRIDESCENCE)\n\t\t\t\t\t\t\t\t, iridescenceFresnel,\n\t\t\t\t\t\t\t\tlitArgs_iridescence_intensity\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t\t);`);\n\t\t}\n\t\tif (this.lighting || this.reflections) {\n\t\t\tif (this.reflections) {\n\t\t\t\tif (options.useClearCoat) {\n\t\t\t\t\tbackend.append(\"    addReflectionCC(ccReflDirW, litArgs_clearcoat_gloss);\");\n\t\t\t\t\tif (options.fresnelModel > 0) {\n\t\t\t\t\t\tbackend.append(\"    ccFresnel = getFresnelCC(dot(dViewDirW, litArgs_clearcoat_worldNormal));\");\n\t\t\t\t\t\tbackend.append(\"    ccReflection.rgb *= ccFresnel;\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbackend.append(\"    ccFresnel = 0.0;\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (options.useSpecularityFactor) {\n\t\t\t\t\tbackend.append(\"    ccReflection.rgb *= litArgs_specularityFactor;\");\n\t\t\t\t}\n\t\t\t\tif (options.useSheen) {\n\t\t\t\t\tbackend.append(\"    addReflectionSheen(litArgs_worldNormal, dViewDirW, litArgs_sheen_gloss);\");\n\t\t\t\t}\n\t\t\t\tbackend.append(\"    addReflection(dReflDirW, litArgs_gloss);\");\n\t\t\t\tif (options.fresnelModel > 0) {\n\t\t\t\t\tbackend.append(`    dReflection.rgb *= \n\t\t\t\t\t\t\t\t\t\t\t\tgetFresnel(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdot(dViewDirW, litArgs_worldNormal), \n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlitArgs_gloss, \n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlitArgs_specularity\n\t\t\t\t\t\t\t\t\t\t\t\t#if defined(LIT_IRIDESCENCE)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t, iridescenceFresnel,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlitArgs_iridescence_intensity\n\t\t\t\t\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t);`);\n\t\t\t\t} else {\n\t\t\t\t\tbackend.append(\"    dReflection.rgb *= litArgs_specularity;\");\n\t\t\t\t}\n\t\t\t\tif (options.useSpecularityFactor) {\n\t\t\t\t\tbackend.append(\"    dReflection.rgb *= litArgs_specularityFactor;\");\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (hasAreaLights) {\n\t\t\t\tbackend.append(\"    dSpecularLight *= litArgs_specularity;\");\n\t\t\t\tif (options.useSpecular) {\n\t\t\t\t\tbackend.append(\"    calcLTCLightValues(litArgs_gloss, litArgs_worldNormal, dViewDirW, litArgs_specularity, litArgs_clearcoat_gloss, litArgs_clearcoat_worldNormal, litArgs_clearcoat_specularity);\");\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (let i = 0; i < options.lights.length; i++) {\n\t\t\t\tconst light = options.lights[i];\n\t\t\t\tconst lightType = light._type;\n\t\t\t\tif (options.clusteredLightingEnabled && lightType !== LIGHTTYPE_DIRECTIONAL) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tusesCookieNow = false;\n\t\t\t\tconst lightShape = hasAreaLights && light._shape ? light.shape : LIGHTSHAPE_PUNCTUAL;\n\t\t\t\tconst shapeString = hasAreaLights && light._shape ? this._getLightSourceShapeString(lightShape) : '';\n\t\t\t\tif (lightShape !== LIGHTSHAPE_PUNCTUAL) {\n\t\t\t\t\tbackend.append(\"    calc\" + shapeString + \"LightValues(light\" + i + \"_position, light\" + i + \"_halfWidth, light\" + i + \"_halfHeight);\");\n\t\t\t\t}\n\t\t\t\tif (lightType === LIGHTTYPE_DIRECTIONAL) {\n\t\t\t\t\tbackend.append(\"    dLightDirNormW = light\" + i + \"_direction;\");\n\t\t\t\t\tbackend.append(\"    dAtten = 1.0;\");\n\t\t\t\t} else {\n\t\t\t\t\tif (light._cookie) {\n\t\t\t\t\t\tif (lightType === LIGHTTYPE_SPOT && !light._cookie._cubemap) {\n\t\t\t\t\t\t\tusesCookie = true;\n\t\t\t\t\t\t\tusesCookieNow = true;\n\t\t\t\t\t\t} else if (lightType === LIGHTTYPE_OMNI && light._cookie._cubemap) {\n\t\t\t\t\t\t\tusesCookie = true;\n\t\t\t\t\t\t\tusesCookieNow = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbackend.append(\"    getLightDirPoint(light\" + i + \"_position);\");\n\t\t\t\t\thasPointLights = true;\n\t\t\t\t\tif (usesCookieNow) {\n\t\t\t\t\t\tif (lightType === LIGHTTYPE_SPOT) {\n\t\t\t\t\t\t\tbackend.append(\"    dAtten3 = getCookie2D\" + (light._cookieFalloff ? \"\" : \"Clip\") + (light._cookieTransform ? \"Xform\" : \"\") + \"(light\" + i + \"_cookie, light\" + i + \"_shadowMatrix, light\" + i + \"_cookieIntensity\" + (light._cookieTransform ? \", light\" + i + \"_cookieMatrix, light\" + i + \"_cookieOffset\" : \"\") + \").\" + light._cookieChannel + \";\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbackend.append(\"    dAtten3 = getCookieCube(light\" + i + \"_cookie, light\" + i + \"_shadowMatrix, light\" + i + \"_cookieIntensity).\" + light._cookieChannel + \";\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (lightShape === LIGHTSHAPE_PUNCTUAL) {\n\t\t\t\t\t\tif (light._falloffMode === LIGHTFALLOFF_LINEAR) {\n\t\t\t\t\t\t\tbackend.append(\"    dAtten = getFalloffLinear(light\" + i + \"_radius, dLightDirW);\");\n\t\t\t\t\t\t\tusesLinearFalloff = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbackend.append(\"    dAtten = getFalloffInvSquared(light\" + i + \"_radius, dLightDirW);\");\n\t\t\t\t\t\t\tusesInvSquaredFalloff = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbackend.append(\"    dAtten = getFalloffWindow(light\" + i + \"_radius, dLightDirW);\");\n\t\t\t\t\t\tusesInvSquaredFalloff = true;\n\t\t\t\t\t}\n\t\t\t\t\tbackend.append(\"    if (dAtten > 0.00001) {\");\n\t\t\t\t\tif (lightType === LIGHTTYPE_SPOT) {\n\t\t\t\t\t\tif (!(usesCookieNow && !light._cookieFalloff)) {\n\t\t\t\t\t\t\tbackend.append(\"    dAtten *= getSpotEffect(light\" + i + \"_direction, light\" + i + \"_innerConeAngle, light\" + i + \"_outerConeAngle, dLightDirNormW);\");\n\t\t\t\t\t\t\tusesSpot = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (lightShape !== LIGHTSHAPE_PUNCTUAL) {\n\t\t\t\t\tif (lightType === LIGHTTYPE_DIRECTIONAL) {\n\t\t\t\t\t\tbackend.append(\"    dAttenD = getLightDiffuse(litArgs_worldNormal, dViewDirW, dLightDirW, dLightDirNormW);\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbackend.append(\"    dAttenD = get\" + shapeString + \"LightDiffuse(litArgs_worldNormal, dViewDirW, dLightDirW, dLightDirNormW) * 16.0;\");\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tbackend.append(\"    dAtten *= getLightDiffuse(litArgs_worldNormal, dViewDirW, dLightDirW, dLightDirNormW);\");\n\t\t\t\t}\n\t\t\t\tif (light.castShadows && !options.noShadow) {\n\t\t\t\t\tconst pcssShadows = light._shadowType === SHADOW_PCSS;\n\t\t\t\t\tconst vsmShadows = light._shadowType === SHADOW_VSM8 || light._shadowType === SHADOW_VSM16 || light._shadowType === SHADOW_VSM32;\n\t\t\t\t\tconst pcfShadows = light._shadowType === SHADOW_PCF1 || light._shadowType === SHADOW_PCF3 || light._shadowType === SHADOW_PCF5;\n\t\t\t\t\tlet shadowReadMode = null;\n\t\t\t\t\tlet evsmExp;\n\t\t\t\t\tswitch (light._shadowType) {\n\t\t\t\t\t\tcase SHADOW_VSM8:\n\t\t\t\t\t\t\tshadowReadMode = \"VSM8\";\n\t\t\t\t\t\t\tevsmExp = \"0.0\";\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase SHADOW_VSM16:\n\t\t\t\t\t\t\tshadowReadMode = \"VSM16\";\n\t\t\t\t\t\t\tevsmExp = \"5.54\";\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase SHADOW_VSM32:\n\t\t\t\t\t\t\tshadowReadMode = \"VSM32\";\n\t\t\t\t\t\t\tif (device.textureFloatHighPrecision) {\n\t\t\t\t\t\t\t\tevsmExp = \"15.0\";\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tevsmExp = \"5.54\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase SHADOW_PCF1:\n\t\t\t\t\t\t\tshadowReadMode = \"PCF1x1\";\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase SHADOW_PCF5:\n\t\t\t\t\t\t\tshadowReadMode = \"PCF5x5\";\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase SHADOW_PCSS:\n\t\t\t\t\t\t\tshadowReadMode = \"PCSS\";\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase SHADOW_PCF3:\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tshadowReadMode = \"PCF3x3\";\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tif (shadowReadMode !== null) {\n\t\t\t\t\t\tif (light._normalOffsetBias && !light._isVsm) {\n\t\t\t\t\t\t\tfunc.append(\"#define SHADOW_SAMPLE_NORMAL_OFFSET\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (lightType === LIGHTTYPE_DIRECTIONAL) {\n\t\t\t\t\t\t\tfunc.append(\"#define SHADOW_SAMPLE_ORTHO\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ((pcfShadows || pcssShadows) && device.isWebGL2 || device.isWebGPU || device.extStandardDerivatives) {\n\t\t\t\t\t\t\tfunc.append(\"#define SHADOW_SAMPLE_SOURCE_ZBUFFER\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (lightType === LIGHTTYPE_OMNI) {\n\t\t\t\t\t\t\tfunc.append(\"#define SHADOW_SAMPLE_POINT\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst coordCode = chunks.shadowSampleCoordPS;\n\t\t\t\t\t\tfunc.append(coordCode.replace(\"$LIGHT\", i));\n\t\t\t\t\t\tfunc.append(\"#undef SHADOW_SAMPLE_NORMAL_OFFSET\");\n\t\t\t\t\t\tfunc.append(\"#undef SHADOW_SAMPLE_ORTHO\");\n\t\t\t\t\t\tfunc.append(\"#undef SHADOW_SAMPLE_SOURCE_ZBUFFER\");\n\t\t\t\t\t\tfunc.append(\"#undef SHADOW_SAMPLE_POINT\");\n\t\t\t\t\t\tlet shadowMatrix = `light${i}_shadowMatrix`;\n\t\t\t\t\t\tif (lightType === LIGHTTYPE_DIRECTIONAL && light.numCascades > 1) {\n\t\t\t\t\t\t\tbackend.append(`    getShadowCascadeMatrix(light${i}_shadowMatrixPalette, light${i}_shadowCascadeDistances, light${i}_shadowCascadeCount);`);\n\t\t\t\t\t\t\tshadowMatrix = `cascadeShadowMat`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbackend.append(`    dShadowCoord = getShadowSampleCoord${i}(${shadowMatrix}, light${i}_shadowParams, vPositionW, dLightPosW, dLightDirW, dLightDirNormW, dVertexNormalW);`);\n\t\t\t\t\t\tif (lightType === LIGHTTYPE_DIRECTIONAL) {\n\t\t\t\t\t\t\tbackend.append(`    fadeShadow(light${i}_shadowCascadeDistances);`);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar shadowCoordArgs = `SHADOWMAP_PASS(light${i}_shadowMap), dShadowCoord, light${i}_shadowParams`;\n\t\t\t\t\t\tif (vsmShadows) {\n\t\t\t\t\t\t\tshadowCoordArgs = `${shadowCoordArgs}, ${evsmExp}, dLightDirW`;\n\t\t\t\t\t\t} else if (pcssShadows) {\n\t\t\t\t\t\t\tlet penumbraSizeArg = `vec2(light${i}_shadowSearchArea)`;\n\t\t\t\t\t\t\tif (lightShape !== LIGHTSHAPE_PUNCTUAL) {\n\t\t\t\t\t\t\t\tpenumbraSizeArg = `vec2(length(light${i}_halfWidth), length(light${i}_halfHeight)) * light${i}_shadowSearchArea`;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tshadowCoordArgs = `${shadowCoordArgs}, light${i}_cameraParams, ${penumbraSizeArg}, dLightDirW`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (lightType === LIGHTTYPE_OMNI) {\n\t\t\t\t\t\t\tshadowReadMode = `Point${shadowReadMode}`;\n\t\t\t\t\t\t\tif (!pcssShadows) {\n\t\t\t\t\t\t\t\tshadowCoordArgs = `${shadowCoordArgs}, dLightDirW`;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (lightType === LIGHTTYPE_SPOT) {\n\t\t\t\t\t\t\tshadowReadMode = `Spot${shadowReadMode}`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbackend.append(`    float shadow${i} = getShadow${shadowReadMode}(${shadowCoordArgs});`);\n\t\t\t\t\t\tbackend.append(`    dAtten *= mix(1.0, shadow${i}, light${i}_shadowIntensity);`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (lightShape !== LIGHTSHAPE_PUNCTUAL) {\n\t\t\t\t\tif (options.conserveEnergy && options.useSpecular) {\n\t\t\t\t\t\tbackend.append(\"    dDiffuseLight += ((dAttenD * dAtten) * light\" + i + \"_color\" + (usesCookieNow ? \" * dAtten3\" : \"\") + \") * (1.0 - dLTCSpecFres);\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbackend.append(\"    dDiffuseLight += (dAttenD * dAtten) * light\" + i + \"_color\" + (usesCookieNow ? \" * dAtten3\" : \"\") + \";\");\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (hasAreaLights && options.conserveEnergy && options.useSpecular) {\n\t\t\t\t\t\tbackend.append(\"    dDiffuseLight += (dAtten * light\" + i + \"_color\" + (usesCookieNow ? \" * dAtten3\" : \"\") + \") * (1.0 - litArgs_specularity);\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbackend.append(\"    dDiffuseLight += dAtten * light\" + i + \"_color\" + (usesCookieNow ? \" * dAtten3\" : \"\") + \";\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (options.useSpecular) {\n\t\t\t\t\tbackend.append(\"    dHalfDirW = normalize(-dLightDirNormW + dViewDirW);\");\n\t\t\t\t}\n\t\t\t\tif (light.affectSpecularity) {\n\t\t\t\t\tif (lightShape !== LIGHTSHAPE_PUNCTUAL) {\n\t\t\t\t\t\tif (options.useClearCoat) {\n\t\t\t\t\t\t\tbackend.append(`    ccSpecularLight += ccLTCSpecFres * get${shapeString}LightSpecular(litArgs_clearcoat_worldNormal, dViewDirW) * dAtten * light${i}_color` + (usesCookieNow ? \" * dAtten3\" : \"\") + \";\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (options.useSpecular) {\n\t\t\t\t\t\t\tbackend.append(`    dSpecularLight += dLTCSpecFres * get${shapeString}LightSpecular(litArgs_worldNormal, dViewDirW) * dAtten * light${i}_color` + (usesCookieNow ? \" * dAtten3\" : \"\") + \";\");\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar calcFresnel = false;\n\t\t\t\t\t\tif (lightType === LIGHTTYPE_DIRECTIONAL && options.fresnelModel > 0) {\n\t\t\t\t\t\t\tcalcFresnel = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (options.useClearCoat) {\n\t\t\t\t\t\t\tbackend.append(`    ccSpecularLight += getLightSpecular(dHalfDirW, ccReflDirW, litArgs_clearcoat_worldNormal, dViewDirW, dLightDirNormW, litArgs_clearcoat_gloss, dTBN) * dAtten * light${i}_color` + (usesCookieNow ? \" * dAtten3\" : \"\") + (calcFresnel ? \" * getFresnelCC(dot(dViewDirW, dHalfDirW));\" : \";\"));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (options.useSheen) {\n\t\t\t\t\t\t\tbackend.append(`    sSpecularLight += getLightSpecularSheen(dHalfDirW, litArgs_worldNormal, dViewDirW, dLightDirNormW, litArgs_sheen_gloss) * dAtten * light${i}_color` + (usesCookieNow ? \" * dAtten3;\" : \";\"));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (options.useSpecular) {\n\t\t\t\t\t\t\tbackend.append(`    dSpecularLight += getLightSpecular(dHalfDirW, dReflDirW, litArgs_worldNormal, dViewDirW, dLightDirNormW, litArgs_gloss, dTBN) * dAtten * light${i}_color` + (usesCookieNow ? \" * dAtten3\" : \"\") + (calcFresnel ? ` \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t* getFresnel(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdot(dViewDirW, dHalfDirW), \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlitArgs_gloss, \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlitArgs_specularity\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t#if defined(LIT_IRIDESCENCE)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t, iridescenceFresnel, \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlitArgs_iridescence_intensity\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);` : `* litArgs_specularity;`));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (lightType !== LIGHTTYPE_DIRECTIONAL) {\n\t\t\t\t\tbackend.append(\"    }\");\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (options.clusteredLightingEnabled && this.lighting) {\n\t\t\t\tusesLinearFalloff = true;\n\t\t\t\tusesInvSquaredFalloff = true;\n\t\t\t\thasPointLights = true;\n\t\t\t\tbackend.append(`    addClusteredLights(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlitArgs_worldNormal, \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdViewDirW, \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdReflDirW,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t#if defined(LIT_CLEARCOAT)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tccReflDirW,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlitArgs_gloss, \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlitArgs_specularity, \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdVertexNormalW, \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdTBN, \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t#if defined(LIT_IRIDESCENCE)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tiridescenceFresnel,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlitArgs_clearcoat_worldNormal, \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlitArgs_clearcoat_gloss,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlitArgs_sheen_gloss,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlitArgs_iridescence_intensity\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);`);\n\t\t\t}\n\t\t\tif (hasAreaLights) {\n\t\t\t\tif (options.useClearCoat) {\n\t\t\t\t\tbackend.append(\"    litArgs_clearcoat_specularity = 1.0;\");\n\t\t\t\t}\n\t\t\t\tif (options.useSpecular) {\n\t\t\t\t\tbackend.append(\"    litArgs_specularity = vec3(1);\");\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (options.useRefraction) {\n\t\t\t\tbackend.append(`    addRefraction(\n\t\t\t\t\t\t\t\t\t\t\t\tlitArgs_worldNormal, \n\t\t\t\t\t\t\t\t\t\t\t\tdViewDirW, \n\t\t\t\t\t\t\t\t\t\t\t\tlitArgs_thickness, \n\t\t\t\t\t\t\t\t\t\t\t\tlitArgs_gloss, \n\t\t\t\t\t\t\t\t\t\t\t\tlitArgs_specularity, \n\t\t\t\t\t\t\t\t\t\t\t\tlitArgs_albedo, \n\t\t\t\t\t\t\t\t\t\t\t\tlitArgs_transmission,\n\t\t\t\t\t\t\t\t\t\t\t\tlitArgs_ior\n\t\t\t\t\t\t\t\t\t\t#if defined(LIT_IRIDESCENCE)\n\t\t\t\t\t\t\t\t\t\t\t\t, iridescenceFresnel, \n\t\t\t\t\t\t\t\t\t\t\t\tlitArgs_iridescence_intensity\n\t\t\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t\t\t\t);`);\n\t\t\t}\n\t\t}\n\t\tif (options.useAo) {\n\t\t\tif (options.occludeDirect) {\n\t\t\t\tbackend.append(\"    occludeDiffuse(litArgs_ao);\");\n\t\t\t}\n\t\t\tif (options.occludeSpecular === SPECOCC_AO || options.occludeSpecular === SPECOCC_GLOSSDEPENDENT) {\n\t\t\t\tbackend.append(\"    occludeSpecular(litArgs_gloss, litArgs_ao, litArgs_worldNormal, dViewDirW);\");\n\t\t\t}\n\t\t}\n\t\tif (options.useSpecularityFactor) {\n\t\t\tbackend.append(\"    dSpecularLight *= litArgs_specularityFactor;\");\n\t\t}\n\t\tif (options.opacityFadesSpecular === false) {\n\t\t\tif (options.blendType === BLEND_NORMAL || options.blendType === BLEND_PREMULTIPLIED) {\n\t\t\t\tbackend.append(\"float specLum = dot((dSpecularLight + dReflection.rgb * dReflection.a), vec3( 0.2126, 0.7152, 0.0722 ));\");\n\t\t\t\tbackend.append(\"#ifdef LIT_CLEARCOAT\\n specLum += dot(ccSpecularLight * litArgs_clearcoat_specularity + ccReflection.rgb * litArgs_clearcoat_specularity, vec3( 0.2126, 0.7152, 0.0722 ));\\n#endif\");\n\t\t\t\tbackend.append(\"litArgs_opacity = clamp(litArgs_opacity + gammaCorrectInput(specLum), 0.0, 1.0);\");\n\t\t\t}\n\t\t\tbackend.append(\"litArgs_opacity *= material_alphaFade;\");\n\t\t}\n\t\tbackend.append(chunks.endPS);\n\t\tif (options.blendType === BLEND_NORMAL || options.blendType === BLEND_ADDITIVEALPHA || options.alphaToCoverage) {\n\t\t\tbackend.append(chunks.outputAlphaPS);\n\t\t} else if (options.blendType === BLEND_PREMULTIPLIED) {\n\t\t\tbackend.append(chunks.outputAlphaPremulPS);\n\t\t} else {\n\t\t\tbackend.append(chunks.outputAlphaOpaquePS);\n\t\t}\n\t\tif (options.useMsdf) {\n\t\t\tbackend.append(\"    gl_FragColor = applyMsdf(gl_FragColor);\");\n\t\t}\n\t\tbackend.append(chunks.outputPS);\n\t\tbackend.append(chunks.debugOutputPS);\n\t\tif (hasPointLights) {\n\t\t\tfunc.prepend(chunks.lightDirPointPS);\n\t\t}\n\t\tif (usesLinearFalloff) {\n\t\t\tfunc.prepend(chunks.falloffLinearPS);\n\t\t}\n\t\tif (usesInvSquaredFalloff) {\n\t\t\tfunc.prepend(chunks.falloffInvSquaredPS);\n\t\t}\n\t\tif (usesSpot) {\n\t\t\tfunc.prepend(chunks.spotPS);\n\t\t}\n\t\tif (usesCookie && !options.clusteredLightingEnabled) {\n\t\t\tfunc.prepend(chunks.cookiePS);\n\t\t}\n\t\tlet structCode = \"\";\n\t\tconst backendCode = `void evaluateBackend() {\\n${backend.code}\\n}`;\n\t\tfunc.append(backendCode);\n\t\tcode.append(chunks.debugProcessFrontendPS);\n\t\tcode.append(\"    evaluateBackend();\");\n\t\tcode.append(ShaderGenerator.end());\n\t\tconst mergedCode = decl.code + func.code + code.code;\n\t\tif (mergedCode.includes(\"dTBN\")) structCode += \"mat3 dTBN;\\n\";\n\t\tif (mergedCode.includes(\"dVertexNormalW\")) structCode += \"vec3 dVertexNormalW;\\n\";\n\t\tif (mergedCode.includes(\"dTangentW\")) structCode += \"vec3 dTangentW;\\n\";\n\t\tif (mergedCode.includes(\"dBinormalW\")) structCode += \"vec3 dBinormalW;\\n\";\n\t\tif (mergedCode.includes(\"dViewDirW\")) structCode += \"vec3 dViewDirW;\\n\";\n\t\tif (mergedCode.includes(\"dReflDirW\")) structCode += \"vec3 dReflDirW;\\n\";\n\t\tif (mergedCode.includes(\"dHalfDirW\")) structCode += \"vec3 dHalfDirW;\\n\";\n\t\tif (mergedCode.includes(\"ccReflDirW\")) structCode += \"vec3 ccReflDirW;\\n\";\n\t\tif (mergedCode.includes(\"dLightDirNormW\")) structCode += \"vec3 dLightDirNormW;\\n\";\n\t\tif (mergedCode.includes(\"dLightDirW\")) structCode += \"vec3 dLightDirW;\\n\";\n\t\tif (mergedCode.includes(\"dLightPosW\")) structCode += \"vec3 dLightPosW;\\n\";\n\t\tif (mergedCode.includes(\"dShadowCoord\")) structCode += \"vec3 dShadowCoord;\\n\";\n\t\tif (mergedCode.includes(\"dReflection\")) structCode += \"vec4 dReflection;\\n\";\n\t\tif (mergedCode.includes(\"dDiffuseLight\")) structCode += \"vec3 dDiffuseLight;\\n\";\n\t\tif (mergedCode.includes(\"dSpecularLight\")) structCode += \"vec3 dSpecularLight;\\n\";\n\t\tif (mergedCode.includes(\"dAtten\")) structCode += \"float dAtten;\\n\";\n\t\tif (mergedCode.includes(\"dAttenD\")) structCode += \"float dAttenD;\\n\";\n\t\tif (mergedCode.includes(\"dAtten3\")) structCode += \"vec3 dAtten3;\\n\";\n\t\tif (mergedCode.includes(\"dMsdf\")) structCode += \"vec4 dMsdf;\\n\";\n\t\tif (mergedCode.includes(\"ccFresnel\")) structCode += \"float ccFresnel;\\n\";\n\t\tif (mergedCode.includes(\"ccReflection\")) structCode += \"vec3 ccReflection;\\n\";\n\t\tif (mergedCode.includes(\"ccSpecularLight\")) structCode += \"vec3 ccSpecularLight;\\n\";\n\t\tif (mergedCode.includes(\"ccSpecularityNoFres\")) structCode += \"float ccSpecularityNoFres;\\n\";\n\t\tif (mergedCode.includes(\"sSpecularLight\")) structCode += \"vec3 sSpecularLight;\\n\";\n\t\tif (mergedCode.includes(\"sReflection\")) structCode += \"vec3 sReflection;\\n\";\n\t\tconst result = this._fsGetBeginCode() + this.varyings + this.varyingDefines + this._fsGetBaseCode() + structCode + this.frontendDecl + mergedCode;\n\t\treturn result;\n\t}\n\tgenerateFragmentShader(frontendDecl, frontendCode, frontendFunc, lightingUv) {\n\t\tvar _this$handleCompatibi;\n\t\tconst options = this.options;\n\t\tthis.frontendDecl = frontendDecl;\n\t\tthis.frontendCode = frontendCode;\n\t\tthis.frontendFunc = frontendFunc;\n\t\tthis.lightingUv = lightingUv;\n\t\tif (options.pass === SHADER_PICK) {\n\t\t\tthis.fshader = this._fsGetPickPassCode();\n\t\t} else if (options.pass === SHADER_DEPTH) {\n\t\t\tthis.fshader = this._fsGetDepthPassCode();\n\t\t} else if (this.shadowPass) {\n\t\t\tthis.fshader = this._fsGetShadowPassCode();\n\t\t} else if (options.customFragmentShader) {\n\t\t\tthis.fshader = this._fsGetBeginCode() + options.customFragmentShader;\n\t\t} else {\n\t\t\tthis.fshader = this._fsGetLitPassCode();\n\t\t}\n\t\t(_this$handleCompatibi = this.handleCompatibility) == null || _this$handleCompatibi.call(this);\n\t}\n\tgetDefinition() {\n\t\tconst definition = ShaderUtils.createDefinition(this.device, {\n\t\t\tname: 'LitShader',\n\t\t\tattributes: this.attributes,\n\t\t\tvertexCode: this.vshader,\n\t\t\tfragmentCode: this.fshader\n\t\t});\n\t\tif (this.shaderPassInfo.isForward) {\n\t\t\tdefinition.tag = SHADERTAG_MATERIAL;\n\t\t}\n\t\treturn definition;\n\t}\n}\n\nexport { LitShader };\n","import { LIGHTTYPE_DIRECTIONAL } from '../../constants.js';\n\nconst LitOptionsUtils = {\n\tgenerateKey(options) {\n\t\treturn \"lit\" + Object.keys(options).sort().map(key => {\n\t\t\tif (key === \"chunks\") {\n\t\t\t\treturn LitOptionsUtils.generateChunksKey(options);\n\t\t\t} else if (key === \"lights\") {\n\t\t\t\treturn LitOptionsUtils.generateLightsKey(options);\n\t\t\t}\n\t\t\treturn key + options[key];\n\t\t}).join(\"\\n\");\n\t},\n\tgenerateLightsKey(options) {\n\t\treturn 'lights:' + options.lights.map(light => {\n\t\t\treturn !options.clusteredLightingEnabled || light._type === LIGHTTYPE_DIRECTIONAL ? `${light.key},` : '';\n\t\t}).join(\"\");\n\t},\n\tgenerateChunksKey(options) {\n\t\tvar _options$chunks;\n\t\treturn 'chunks:\\n' + Object.keys((_options$chunks = options.chunks) != null ? _options$chunks : {}).sort().map(key => key + options.chunks[key]).join(\"\");\n\t}\n};\n\nexport { LitOptionsUtils };\n","import { Vec3 } from '../../core/math/vec3.js';\nimport { math } from '../../core/math/math.js';\nimport { BoundingBox } from '../../core/shape/bounding-box.js';\nimport { PIXELFORMAT_L8 } from '../../platform/graphics/constants.js';\nimport { MASK_AFFECT_DYNAMIC, MASK_AFFECT_LIGHTMAPPED, LIGHTTYPE_SPOT, LIGHTTYPE_DIRECTIONAL } from '../constants.js';\nimport { LightsBuffer } from './lights-buffer.js';\nimport '../../core/tracing.js';\n\nconst tempVec3 = new Vec3();\nconst tempMin3 = new Vec3();\nconst tempMax3 = new Vec3();\nconst tempBox = new BoundingBox();\nconst epsilon = 0.000001;\nclass ClusterLight {\n\tconstructor() {\n\t\tthis.light = null;\n\t\tthis.min = new Vec3();\n\t\tthis.max = new Vec3();\n\t}\n}\nclass WorldClusters {\n\tconstructor(device) {\n\t\tthis.clusterTexture = void 0;\n\t\tthis.device = device;\n\t\tthis.name = 'Untitled';\n\t\tthis.reportCount = 0;\n\t\tthis.boundsMin = new Vec3();\n\t\tthis.boundsMax = new Vec3();\n\t\tthis.boundsDelta = new Vec3();\n\t\tthis._cells = new Vec3(1, 1, 1);\n\t\tthis._cellsLimit = new Vec3();\n\t\tthis.cells = this._cells;\n\t\tthis.maxCellLightCount = 4;\n\t\tthis._maxAttenuation = 0;\n\t\tthis._maxColorValue = 0;\n\t\tthis._usedLights = [];\n\t\tthis._usedLights.push(new ClusterLight());\n\t\tthis.lightsBuffer = new LightsBuffer(device);\n\t\tthis.registerUniforms(device);\n\t}\n\tset maxCellLightCount(count) {\n\t\tif (count !== this._maxCellLightCount) {\n\t\t\tthis._maxCellLightCount = count;\n\t\t\tthis._cellsDirty = true;\n\t\t}\n\t}\n\tget maxCellLightCount() {\n\t\treturn this._maxCellLightCount;\n\t}\n\tset cells(value) {\n\t\ttempVec3.copy(value).floor();\n\t\tif (!this._cells.equals(tempVec3)) {\n\t\t\tthis._cells.copy(tempVec3);\n\t\t\tthis._cellsLimit.copy(tempVec3).sub(Vec3.ONE);\n\t\t\tthis._cellsDirty = true;\n\t\t}\n\t}\n\tget cells() {\n\t\treturn this._cells;\n\t}\n\tdestroy() {\n\t\tthis.lightsBuffer.destroy();\n\t\tthis.releaseClusterTexture();\n\t}\n\treleaseClusterTexture() {\n\t\tif (this.clusterTexture) {\n\t\t\tthis.clusterTexture.destroy();\n\t\t\tthis.clusterTexture = null;\n\t\t}\n\t}\n\tregisterUniforms(device) {\n\t\tthis._clusterSkipId = device.scope.resolve('clusterSkip');\n\t\tthis._clusterMaxCellsId = device.scope.resolve('clusterMaxCells');\n\t\tthis._clusterWorldTextureId = device.scope.resolve('clusterWorldTexture');\n\t\tthis._clusterTextureSizeId = device.scope.resolve('clusterTextureSize');\n\t\tthis._clusterTextureSizeData = new Float32Array(3);\n\t\tthis._clusterBoundsMinId = device.scope.resolve('clusterBoundsMin');\n\t\tthis._clusterBoundsMinData = new Float32Array(3);\n\t\tthis._clusterBoundsDeltaId = device.scope.resolve('clusterBoundsDelta');\n\t\tthis._clusterBoundsDeltaData = new Float32Array(3);\n\t\tthis._clusterCellsCountByBoundsSizeId = device.scope.resolve('clusterCellsCountByBoundsSize');\n\t\tthis._clusterCellsCountByBoundsSizeData = new Float32Array(3);\n\t\tthis._clusterCellsDotId = device.scope.resolve('clusterCellsDot');\n\t\tthis._clusterCellsDotData = new Float32Array(3);\n\t\tthis._clusterCellsMaxId = device.scope.resolve('clusterCellsMax');\n\t\tthis._clusterCellsMaxData = new Float32Array(3);\n\t\tthis._clusterCompressionLimit0Id = device.scope.resolve('clusterCompressionLimit0');\n\t\tthis._clusterCompressionLimit0Data = new Float32Array(2);\n\t}\n\tupdateParams(lightingParams) {\n\t\tif (lightingParams) {\n\t\t\tthis.cells = lightingParams.cells;\n\t\t\tthis.maxCellLightCount = lightingParams.maxLightsPerCell;\n\t\t\tthis.lightsBuffer.cookiesEnabled = lightingParams.cookiesEnabled;\n\t\t\tthis.lightsBuffer.shadowsEnabled = lightingParams.shadowsEnabled;\n\t\t\tthis.lightsBuffer.areaLightsEnabled = lightingParams.areaLightsEnabled;\n\t\t}\n\t}\n\tupdateCells() {\n\t\tif (this._cellsDirty) {\n\t\t\tthis._cellsDirty = false;\n\t\t\tconst cx = this._cells.x;\n\t\t\tconst cy = this._cells.y;\n\t\t\tconst cz = this._cells.z;\n\t\t\tconst numCells = cx * cy * cz;\n\t\t\tconst totalPixels = this.maxCellLightCount * numCells;\n\t\t\tlet width = Math.ceil(Math.sqrt(totalPixels));\n\t\t\twidth = math.roundUp(width, this.maxCellLightCount);\n\t\t\tconst height = Math.ceil(totalPixels / width);\n\t\t\tthis._clusterCellsMaxData[0] = cx;\n\t\t\tthis._clusterCellsMaxData[1] = cy;\n\t\t\tthis._clusterCellsMaxData[2] = cz;\n\t\t\tthis._clusterCellsDotData[0] = this.maxCellLightCount;\n\t\t\tthis._clusterCellsDotData[1] = cx * cz * this.maxCellLightCount;\n\t\t\tthis._clusterCellsDotData[2] = cx * this.maxCellLightCount;\n\t\t\tthis.clusters = new Uint8ClampedArray(totalPixels);\n\t\t\tthis.counts = new Int32Array(numCells);\n\t\t\tthis._clusterTextureSizeData[0] = width;\n\t\t\tthis._clusterTextureSizeData[1] = 1.0 / width;\n\t\t\tthis._clusterTextureSizeData[2] = 1.0 / height;\n\t\t\tthis.releaseClusterTexture();\n\t\t\tthis.clusterTexture = LightsBuffer.createTexture(this.device, width, height, PIXELFORMAT_L8, 'ClusterTexture');\n\t\t}\n\t}\n\tuploadTextures() {\n\t\tthis.clusterTexture.lock().set(this.clusters);\n\t\tthis.clusterTexture.unlock();\n\t\tthis.lightsBuffer.uploadTextures();\n\t}\n\tupdateUniforms() {\n\t\tthis._clusterSkipId.setValue(this._usedLights.length > 1 ? 0 : 1);\n\t\tthis.lightsBuffer.updateUniforms();\n\t\tthis._clusterWorldTextureId.setValue(this.clusterTexture);\n\t\tthis._clusterMaxCellsId.setValue(this.maxCellLightCount);\n\t\tconst boundsDelta = this.boundsDelta;\n\t\tthis._clusterCellsCountByBoundsSizeData[0] = this._cells.x / boundsDelta.x;\n\t\tthis._clusterCellsCountByBoundsSizeData[1] = this._cells.y / boundsDelta.y;\n\t\tthis._clusterCellsCountByBoundsSizeData[2] = this._cells.z / boundsDelta.z;\n\t\tthis._clusterCellsCountByBoundsSizeId.setValue(this._clusterCellsCountByBoundsSizeData);\n\t\tthis._clusterBoundsMinData[0] = this.boundsMin.x;\n\t\tthis._clusterBoundsMinData[1] = this.boundsMin.y;\n\t\tthis._clusterBoundsMinData[2] = this.boundsMin.z;\n\t\tthis._clusterBoundsDeltaData[0] = boundsDelta.x;\n\t\tthis._clusterBoundsDeltaData[1] = boundsDelta.y;\n\t\tthis._clusterBoundsDeltaData[2] = boundsDelta.z;\n\t\tthis._clusterCompressionLimit0Data[0] = this._maxAttenuation;\n\t\tthis._clusterCompressionLimit0Data[1] = this._maxColorValue;\n\t\tthis._clusterTextureSizeId.setValue(this._clusterTextureSizeData);\n\t\tthis._clusterBoundsMinId.setValue(this._clusterBoundsMinData);\n\t\tthis._clusterBoundsDeltaId.setValue(this._clusterBoundsDeltaData);\n\t\tthis._clusterCellsDotId.setValue(this._clusterCellsDotData);\n\t\tthis._clusterCellsMaxId.setValue(this._clusterCellsMaxData);\n\t\tthis._clusterCompressionLimit0Id.setValue(this._clusterCompressionLimit0Data);\n\t}\n\tevalLightCellMinMax(clusteredLight, min, max) {\n\t\tmin.copy(clusteredLight.min);\n\t\tmin.sub(this.boundsMin);\n\t\tmin.div(this.boundsDelta);\n\t\tmin.mul2(min, this.cells);\n\t\tmin.floor();\n\t\tmax.copy(clusteredLight.max);\n\t\tmax.sub(this.boundsMin);\n\t\tmax.div(this.boundsDelta);\n\t\tmax.mul2(max, this.cells);\n\t\tmax.ceil();\n\t\tmin.max(Vec3.ZERO);\n\t\tmax.min(this._cellsLimit);\n\t}\n\tcollectLights(lights) {\n\t\tconst maxLights = this.lightsBuffer.maxLights;\n\t\tconst usedLights = this._usedLights;\n\t\tlet lightIndex = 1;\n\t\tlights.forEach(light => {\n\t\t\tconst runtimeLight = !!(light.mask & (MASK_AFFECT_DYNAMIC | MASK_AFFECT_LIGHTMAPPED));\n\t\t\tconst zeroAngleSpotlight = light.type === LIGHTTYPE_SPOT && light._outerConeAngle === 0;\n\t\t\tif (light.enabled && light.type !== LIGHTTYPE_DIRECTIONAL && light.visibleThisFrame && light.intensity > 0 && runtimeLight && !zeroAngleSpotlight) {\n\t\t\t\tif (lightIndex < maxLights) {\n\t\t\t\t\tlet clusteredLight;\n\t\t\t\t\tif (lightIndex < usedLights.length) {\n\t\t\t\t\t\tclusteredLight = usedLights[lightIndex];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tclusteredLight = new ClusterLight();\n\t\t\t\t\t\tusedLights.push(clusteredLight);\n\t\t\t\t\t}\n\t\t\t\t\tclusteredLight.light = light;\n\t\t\t\t\tlight.getBoundingBox(tempBox);\n\t\t\t\t\tclusteredLight.min.copy(tempBox.getMin());\n\t\t\t\t\tclusteredLight.max.copy(tempBox.getMax());\n\t\t\t\t\tlightIndex++;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tusedLights.length = lightIndex;\n\t}\n\tevaluateBounds() {\n\t\tconst usedLights = this._usedLights;\n\t\tconst min = this.boundsMin;\n\t\tconst max = this.boundsMax;\n\t\tif (usedLights.length > 1) {\n\t\t\tmin.copy(usedLights[1].min);\n\t\t\tmax.copy(usedLights[1].max);\n\t\t\tfor (let i = 2; i < usedLights.length; i++) {\n\t\t\t\tmin.min(usedLights[i].min);\n\t\t\t\tmax.max(usedLights[i].max);\n\t\t\t}\n\t\t} else {\n\t\t\tmin.set(0, 0, 0);\n\t\t\tmax.set(1, 1, 1);\n\t\t}\n\t\tthis.boundsDelta.sub2(max, min);\n\t\tthis.lightsBuffer.setBounds(min, this.boundsDelta);\n\t}\n\tevaluateCompressionLimits(gammaCorrection) {\n\t\tlet maxAttenuation = 0;\n\t\tlet maxColorValue = 0;\n\t\tconst usedLights = this._usedLights;\n\t\tfor (let i = 1; i < usedLights.length; i++) {\n\t\t\tconst light = usedLights[i].light;\n\t\t\tmaxAttenuation = Math.max(light.attenuationEnd, maxAttenuation);\n\t\t\tconst color = gammaCorrection ? light._linearFinalColor : light._finalColor;\n\t\t\tmaxColorValue = Math.max(color[0], maxColorValue);\n\t\t\tmaxColorValue = Math.max(color[1], maxColorValue);\n\t\t\tmaxColorValue = Math.max(color[2], maxColorValue);\n\t\t}\n\t\tthis._maxAttenuation = maxAttenuation + epsilon;\n\t\tthis._maxColorValue = maxColorValue + epsilon;\n\t\tthis.lightsBuffer.setCompressionRanges(this._maxAttenuation, this._maxColorValue);\n\t}\n\tupdateClusters(gammaCorrection) {\n\t\tthis.counts.fill(0);\n\t\tthis.clusters.fill(0);\n\t\tconst divX = this._cells.x;\n\t\tconst divZ = this._cells.z;\n\t\tconst counts = this.counts;\n\t\tconst limit = this._maxCellLightCount;\n\t\tconst clusters = this.clusters;\n\t\tconst pixelsPerCellCount = this.maxCellLightCount;\n\t\tconst usedLights = this._usedLights;\n\t\tfor (let i = 1; i < usedLights.length; i++) {\n\t\t\tconst clusteredLight = usedLights[i];\n\t\t\tconst light = clusteredLight.light;\n\t\t\tthis.lightsBuffer.addLightData(light, i, gammaCorrection);\n\t\t\tthis.evalLightCellMinMax(clusteredLight, tempMin3, tempMax3);\n\t\t\tconst xStart = tempMin3.x;\n\t\t\tconst xEnd = tempMax3.x;\n\t\t\tconst yStart = tempMin3.y;\n\t\t\tconst yEnd = tempMax3.y;\n\t\t\tconst zStart = tempMin3.z;\n\t\t\tconst zEnd = tempMax3.z;\n\t\t\tfor (let x = xStart; x <= xEnd; x++) {\n\t\t\t\tfor (let z = zStart; z <= zEnd; z++) {\n\t\t\t\t\tfor (let y = yStart; y <= yEnd; y++) {\n\t\t\t\t\t\tconst clusterIndex = x + divX * (z + y * divZ);\n\t\t\t\t\t\tconst count = counts[clusterIndex];\n\t\t\t\t\t\tif (count < limit) {\n\t\t\t\t\t\t\tclusters[pixelsPerCellCount * clusterIndex + count] = i;\n\t\t\t\t\t\t\tcounts[clusterIndex] = count + 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tupdate(lights, gammaCorrection, lightingParams) {\n\t\tthis.updateParams(lightingParams);\n\t\tthis.updateCells();\n\t\tthis.collectLights(lights);\n\t\tthis.evaluateBounds();\n\t\tthis.evaluateCompressionLimits(gammaCorrection);\n\t\tthis.updateClusters(gammaCorrection);\n\t\tthis.uploadTextures();\n\t}\n\tactivate() {\n\t\tthis.updateUniforms();\n\t}\n}\n\nexport { WorldClusters };\n","import { PIXELFORMAT_RGBA32F, PIXELFORMAT_RGBA16F, PIXELFORMAT_DEPTH, PIXELFORMAT_R32F, PIXELFORMAT_RGBA8, FILTER_NEAREST, FILTER_LINEAR, ADDRESS_CLAMP_TO_EDGE, FUNC_LESS } from '../../platform/graphics/constants.js';\nimport { RenderTarget } from '../../platform/graphics/render-target.js';\nimport { Texture } from '../../platform/graphics/texture.js';\nimport { SHADOW_VSM32, SHADOW_VSM16, SHADOW_PCF5, SHADOW_PCF1, SHADOW_PCF3, SHADOW_PCSS, LIGHTTYPE_OMNI } from '../constants.js';\n\nclass ShadowMap {\n\tconstructor(texture, targets) {\n\t\tthis.texture = texture;\n\t\tthis.cached = false;\n\t\tthis.renderTargets = targets;\n\t}\n\tdestroy() {\n\t\tif (this.texture) {\n\t\t\tthis.texture.destroy();\n\t\t\tthis.texture = null;\n\t\t}\n\t\tconst targets = this.renderTargets;\n\t\tfor (let i = 0; i < targets.length; i++) {\n\t\t\ttargets[i].destroy();\n\t\t}\n\t\tthis.renderTargets.length = 0;\n\t}\n\tstatic getShadowFormat(device, shadowType) {\n\t\tif (shadowType === SHADOW_VSM32) {\n\t\t\treturn PIXELFORMAT_RGBA32F;\n\t\t} else if (shadowType === SHADOW_VSM16) {\n\t\t\treturn PIXELFORMAT_RGBA16F;\n\t\t} else if (shadowType === SHADOW_PCF5) {\n\t\t\treturn PIXELFORMAT_DEPTH;\n\t\t} else if ((shadowType === SHADOW_PCF1 || shadowType === SHADOW_PCF3) && device.supportsDepthShadow) {\n\t\t\treturn PIXELFORMAT_DEPTH;\n\t\t} else if (shadowType === SHADOW_PCSS && !device.isWebGL1) {\n\t\t\treturn PIXELFORMAT_R32F;\n\t\t}\n\t\treturn PIXELFORMAT_RGBA8;\n\t}\n\tstatic getShadowFiltering(device, shadowType) {\n\t\tif ((shadowType === SHADOW_PCF1 || shadowType === SHADOW_PCF3 || shadowType === SHADOW_PCSS) && !device.supportsDepthShadow) {\n\t\t\treturn FILTER_NEAREST;\n\t\t} else if (shadowType === SHADOW_VSM32) {\n\t\t\treturn device.extTextureFloatLinear ? FILTER_LINEAR : FILTER_NEAREST;\n\t\t} else if (shadowType === SHADOW_VSM16) {\n\t\t\treturn device.extTextureHalfFloatLinear ? FILTER_LINEAR : FILTER_NEAREST;\n\t\t}\n\t\treturn FILTER_LINEAR;\n\t}\n\tstatic create(device, light) {\n\t\tlet shadowMap = null;\n\t\tif (light._type === LIGHTTYPE_OMNI) {\n\t\t\tshadowMap = this.createCubemap(device, light._shadowResolution, light._shadowType);\n\t\t} else {\n\t\t\tshadowMap = this.create2dMap(device, light._shadowResolution, light._shadowType);\n\t\t}\n\t\treturn shadowMap;\n\t}\n\tstatic createAtlas(device, resolution, shadowType) {\n\t\tconst shadowMap = this.create2dMap(device, resolution, shadowType);\n\t\tconst targets = shadowMap.renderTargets;\n\t\tconst rt = targets[0];\n\t\tfor (let i = 0; i < 5; i++) {\n\t\t\ttargets.push(rt);\n\t\t}\n\t\treturn shadowMap;\n\t}\n\tstatic create2dMap(device, size, shadowType) {\n\t\tconst format = this.getShadowFormat(device, shadowType);\n\t\tconst filter = this.getShadowFiltering(device, shadowType);\n\t\tconst texture = new Texture(device, {\n\t\t\tformat: format,\n\t\t\twidth: size,\n\t\t\theight: size,\n\t\t\tmipmaps: false,\n\t\t\tminFilter: filter,\n\t\t\tmagFilter: filter,\n\t\t\taddressU: ADDRESS_CLAMP_TO_EDGE,\n\t\t\taddressV: ADDRESS_CLAMP_TO_EDGE,\n\t\t\tname: 'ShadowMap2D'\n\t\t});\n\t\tlet target = null;\n\t\tif (shadowType === SHADOW_PCF5 || (shadowType === SHADOW_PCF1 || shadowType === SHADOW_PCF3) && device.supportsDepthShadow) {\n\t\t\ttexture.compareOnRead = true;\n\t\t\ttexture.compareFunc = FUNC_LESS;\n\t\t\ttarget = new RenderTarget({\n\t\t\t\tdepthBuffer: texture\n\t\t\t});\n\t\t} else {\n\t\t\ttarget = new RenderTarget({\n\t\t\t\tcolorBuffer: texture,\n\t\t\t\tdepth: true\n\t\t\t});\n\t\t}\n\t\tif (device.isWebGPU) {\n\t\t\ttarget.flipY = true;\n\t\t}\n\t\treturn new ShadowMap(texture, [target]);\n\t}\n\tstatic createCubemap(device, size, shadowType) {\n\t\tconst format = shadowType === SHADOW_PCSS && !device.isWebGL1 ? PIXELFORMAT_R32F : PIXELFORMAT_RGBA8;\n\t\tconst cubemap = new Texture(device, {\n\t\t\tformat: format,\n\t\t\twidth: size,\n\t\t\theight: size,\n\t\t\tcubemap: true,\n\t\t\tmipmaps: false,\n\t\t\tminFilter: FILTER_NEAREST,\n\t\t\tmagFilter: FILTER_NEAREST,\n\t\t\taddressU: ADDRESS_CLAMP_TO_EDGE,\n\t\t\taddressV: ADDRESS_CLAMP_TO_EDGE,\n\t\t\tname: 'ShadowMapCube'\n\t\t});\n\t\tconst targets = [];\n\t\tfor (let i = 0; i < 6; i++) {\n\t\t\tconst target = new RenderTarget({\n\t\t\t\tcolorBuffer: cubemap,\n\t\t\t\tface: i,\n\t\t\t\tdepth: true\n\t\t\t});\n\t\t\ttargets.push(target);\n\t\t}\n\t\treturn new ShadowMap(cubemap, targets);\n\t}\n}\n\nexport { ShadowMap };\n","import { Vec2 } from '../../core/math/vec2.js';\nimport { Vec4 } from '../../core/math/vec4.js';\nimport { PIXELFORMAT_RGBA8, FILTER_NEAREST, ADDRESS_CLAMP_TO_EDGE } from '../../platform/graphics/constants.js';\nimport { RenderTarget } from '../../platform/graphics/render-target.js';\nimport { Texture } from '../../platform/graphics/texture.js';\nimport { SHADOW_PCF3, LIGHTTYPE_SPOT, LIGHTTYPE_OMNI } from '../constants.js';\nimport { ShadowMap } from '../renderer/shadow-map.js';\n\nconst _tempArray = [];\nconst _tempArray2 = [];\nconst _viewport = new Vec4();\nconst _scissor = new Vec4();\nclass Slot {\n\tconstructor(rect) {\n\t\tthis.size = Math.floor(rect.w * 1024);\n\t\tthis.used = false;\n\t\tthis.lightId = -1;\n\t\tthis.rect = rect;\n\t}\n}\nclass LightTextureAtlas {\n\tconstructor(device) {\n\t\tthis.device = device;\n\t\tthis.version = 1;\n\t\tthis.shadowAtlasResolution = 2048;\n\t\tthis.shadowAtlas = null;\n\t\tthis.shadowEdgePixels = 3;\n\t\tthis.cookieAtlasResolution = 4;\n\t\tthis.cookieAtlas = new Texture(this.device, {\n\t\t\tname: 'CookieAtlas',\n\t\t\twidth: this.cookieAtlasResolution,\n\t\t\theight: this.cookieAtlasResolution,\n\t\t\tformat: PIXELFORMAT_RGBA8,\n\t\t\tcubemap: false,\n\t\t\tmipmaps: false,\n\t\t\tminFilter: FILTER_NEAREST,\n\t\t\tmagFilter: FILTER_NEAREST,\n\t\t\taddressU: ADDRESS_CLAMP_TO_EDGE,\n\t\t\taddressV: ADDRESS_CLAMP_TO_EDGE\n\t\t});\n\t\tthis.cookieRenderTarget = new RenderTarget({\n\t\t\tcolorBuffer: this.cookieAtlas,\n\t\t\tdepth: false,\n\t\t\tflipY: true\n\t\t});\n\t\tthis.slots = [];\n\t\tthis.atlasSplit = [];\n\t\tthis.cubeSlotsOffsets = [new Vec2(0, 0), new Vec2(0, 1), new Vec2(1, 0), new Vec2(1, 1), new Vec2(2, 0), new Vec2(2, 1)];\n\t\tthis.scissorVec = new Vec4();\n\t\tthis.allocateShadowAtlas(1);\n\t\tthis.allocateCookieAtlas(1);\n\t\tthis.allocateUniforms();\n\t}\n\tdestroy() {\n\t\tthis.destroyShadowAtlas();\n\t\tthis.destroyCookieAtlas();\n\t}\n\tdestroyShadowAtlas() {\n\t\tvar _this$shadowAtlas;\n\t\t(_this$shadowAtlas = this.shadowAtlas) == null || _this$shadowAtlas.destroy();\n\t\tthis.shadowAtlas = null;\n\t}\n\tdestroyCookieAtlas() {\n\t\tvar _this$cookieAtlas, _this$cookieRenderTar;\n\t\t(_this$cookieAtlas = this.cookieAtlas) == null || _this$cookieAtlas.destroy();\n\t\tthis.cookieAtlas = null;\n\t\t(_this$cookieRenderTar = this.cookieRenderTarget) == null || _this$cookieRenderTar.destroy();\n\t\tthis.cookieRenderTarget = null;\n\t}\n\tallocateShadowAtlas(resolution) {\n\t\tif (!this.shadowAtlas || this.shadowAtlas.texture.width !== resolution) {\n\t\t\tthis.version++;\n\t\t\tthis.destroyShadowAtlas();\n\t\t\tthis.shadowAtlas = ShadowMap.createAtlas(this.device, resolution, SHADOW_PCF3);\n\t\t\tthis.shadowAtlas.cached = true;\n\t\t\tconst scissorOffset = 4 / this.shadowAtlasResolution;\n\t\t\tthis.scissorVec.set(scissorOffset, scissorOffset, -2 * scissorOffset, -2 * scissorOffset);\n\t\t}\n\t}\n\tallocateCookieAtlas(resolution) {\n\t\tif (this.cookieAtlas.width !== resolution) {\n\t\t\tthis.cookieRenderTarget.resize(resolution, resolution);\n\t\t\tthis.version++;\n\t\t}\n\t}\n\tallocateUniforms() {\n\t\tthis._shadowAtlasTextureId = this.device.scope.resolve('shadowAtlasTexture');\n\t\tthis._shadowAtlasParamsId = this.device.scope.resolve('shadowAtlasParams');\n\t\tthis._shadowAtlasParams = new Float32Array(2);\n\t\tthis._cookieAtlasTextureId = this.device.scope.resolve('cookieAtlasTexture');\n\t}\n\tupdateUniforms() {\n\t\tconst isShadowFilterPcf = true;\n\t\tconst rt = this.shadowAtlas.renderTargets[0];\n\t\tconst isDepthShadow = !this.device.isWebGL1 && isShadowFilterPcf;\n\t\tconst shadowBuffer = isDepthShadow ? rt.depthBuffer : rt.colorBuffer;\n\t\tthis._shadowAtlasTextureId.setValue(shadowBuffer);\n\t\tthis._shadowAtlasParams[0] = this.shadowAtlasResolution;\n\t\tthis._shadowAtlasParams[1] = this.shadowEdgePixels;\n\t\tthis._shadowAtlasParamsId.setValue(this._shadowAtlasParams);\n\t\tthis._cookieAtlasTextureId.setValue(this.cookieAtlas);\n\t}\n\tsubdivide(numLights, lightingParams) {\n\t\tlet atlasSplit = lightingParams.atlasSplit;\n\t\tif (!atlasSplit) {\n\t\t\tconst gridSize = Math.ceil(Math.sqrt(numLights));\n\t\t\tatlasSplit = _tempArray2;\n\t\t\tatlasSplit[0] = gridSize;\n\t\t\tatlasSplit.length = 1;\n\t\t}\n\t\tconst arraysEqual = (a, b) => a.length === b.length && a.every((v, i) => v === b[i]);\n\t\tif (!arraysEqual(atlasSplit, this.atlasSplit)) {\n\t\t\tthis.version++;\n\t\t\tthis.slots.length = 0;\n\t\t\tthis.atlasSplit.length = 0;\n\t\t\tthis.atlasSplit.push(...atlasSplit);\n\t\t\tconst splitCount = this.atlasSplit[0];\n\t\t\tif (splitCount > 1) {\n\t\t\t\tconst invSize = 1 / splitCount;\n\t\t\t\tfor (let i = 0; i < splitCount; i++) {\n\t\t\t\t\tfor (let j = 0; j < splitCount; j++) {\n\t\t\t\t\t\tconst rect = new Vec4(i * invSize, j * invSize, invSize, invSize);\n\t\t\t\t\t\tconst nextLevelSplit = this.atlasSplit[1 + i * splitCount + j];\n\t\t\t\t\t\tif (nextLevelSplit > 1) {\n\t\t\t\t\t\t\tfor (let x = 0; x < nextLevelSplit; x++) {\n\t\t\t\t\t\t\t\tfor (let y = 0; y < nextLevelSplit; y++) {\n\t\t\t\t\t\t\t\t\tconst invSizeNext = invSize / nextLevelSplit;\n\t\t\t\t\t\t\t\t\tconst rectNext = new Vec4(rect.x + x * invSizeNext, rect.y + y * invSizeNext, invSizeNext, invSizeNext);\n\t\t\t\t\t\t\t\t\tthis.slots.push(new Slot(rectNext));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.slots.push(new Slot(rect));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.slots.push(new Slot(new Vec4(0, 0, 1, 1)));\n\t\t\t}\n\t\t\tthis.slots.sort((a, b) => {\n\t\t\t\treturn b.size - a.size;\n\t\t\t});\n\t\t}\n\t}\n\tcollectLights(localLights, lightingParams) {\n\t\tconst cookiesEnabled = lightingParams.cookiesEnabled;\n\t\tconst shadowsEnabled = lightingParams.shadowsEnabled;\n\t\tlet needsShadowAtlas = false;\n\t\tlet needsCookieAtlas = false;\n\t\tconst lights = _tempArray;\n\t\tlights.length = 0;\n\t\tconst processLights = list => {\n\t\t\tfor (let i = 0; i < list.length; i++) {\n\t\t\t\tconst light = list[i];\n\t\t\t\tif (light.visibleThisFrame) {\n\t\t\t\t\tconst lightShadow = shadowsEnabled && light.castShadows;\n\t\t\t\t\tconst lightCookie = cookiesEnabled && !!light.cookie;\n\t\t\t\t\tneedsShadowAtlas || (needsShadowAtlas = lightShadow);\n\t\t\t\t\tneedsCookieAtlas || (needsCookieAtlas = lightCookie);\n\t\t\t\t\tif (lightShadow || lightCookie) {\n\t\t\t\t\t\tlights.push(light);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tif (cookiesEnabled || shadowsEnabled) {\n\t\t\tprocessLights(localLights);\n\t\t}\n\t\tlights.sort((a, b) => {\n\t\t\treturn b.maxScreenSize - a.maxScreenSize;\n\t\t});\n\t\tif (needsShadowAtlas) {\n\t\t\tthis.allocateShadowAtlas(this.shadowAtlasResolution);\n\t\t}\n\t\tif (needsCookieAtlas) {\n\t\t\tthis.allocateCookieAtlas(this.cookieAtlasResolution);\n\t\t}\n\t\tif (needsShadowAtlas || needsCookieAtlas) {\n\t\t\tthis.subdivide(lights.length, lightingParams);\n\t\t}\n\t\treturn lights;\n\t}\n\tsetupSlot(light, rect) {\n\t\tlight.atlasViewport.copy(rect);\n\t\tconst faceCount = light.numShadowFaces;\n\t\tfor (let face = 0; face < faceCount; face++) {\n\t\t\tif (light.castShadows || light._cookie) {\n\t\t\t\t_viewport.copy(rect);\n\t\t\t\t_scissor.copy(rect);\n\t\t\t\tif (light._type === LIGHTTYPE_SPOT) {\n\t\t\t\t\t_viewport.add(this.scissorVec);\n\t\t\t\t}\n\t\t\t\tif (light._type === LIGHTTYPE_OMNI) {\n\t\t\t\t\tconst smallSize = _viewport.z / 3;\n\t\t\t\t\tconst offset = this.cubeSlotsOffsets[face];\n\t\t\t\t\t_viewport.x += smallSize * offset.x;\n\t\t\t\t\t_viewport.y += smallSize * offset.y;\n\t\t\t\t\t_viewport.z = smallSize;\n\t\t\t\t\t_viewport.w = smallSize;\n\t\t\t\t\t_scissor.copy(_viewport);\n\t\t\t\t}\n\t\t\t\tif (light.castShadows) {\n\t\t\t\t\tconst lightRenderData = light.getRenderData(null, face);\n\t\t\t\t\tlightRenderData.shadowViewport.copy(_viewport);\n\t\t\t\t\tlightRenderData.shadowScissor.copy(_scissor);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tassignSlot(light, slotIndex, slotReassigned) {\n\t\tlight.atlasViewportAllocated = true;\n\t\tconst slot = this.slots[slotIndex];\n\t\tslot.lightId = light.id;\n\t\tslot.used = true;\n\t\tif (slotReassigned) {\n\t\t\tlight.atlasSlotUpdated = true;\n\t\t\tlight.atlasVersion = this.version;\n\t\t\tlight.atlasSlotIndex = slotIndex;\n\t\t}\n\t}\n\tupdate(localLights, lightingParams) {\n\t\tthis.shadowAtlasResolution = lightingParams.shadowAtlasResolution;\n\t\tthis.cookieAtlasResolution = lightingParams.cookieAtlasResolution;\n\t\tconst lights = this.collectLights(localLights, lightingParams);\n\t\tif (lights.length > 0) {\n\t\t\tconst slots = this.slots;\n\t\t\tfor (let i = 0; i < slots.length; i++) {\n\t\t\t\tslots[i].used = false;\n\t\t\t}\n\t\t\tconst assignCount = Math.min(lights.length, slots.length);\n\t\t\tfor (let i = 0; i < assignCount; i++) {\n\t\t\t\tconst light = lights[i];\n\t\t\t\tif (light.castShadows) light._shadowMap = this.shadowAtlas;\n\t\t\t\tconst previousSlot = slots[light.atlasSlotIndex];\n\t\t\t\tif (light.atlasVersion === this.version && light.id === (previousSlot == null ? void 0 : previousSlot.lightId)) {\n\t\t\t\t\tconst _previousSlot = slots[light.atlasSlotIndex];\n\t\t\t\t\tif (_previousSlot.size === slots[i].size && !_previousSlot.used) {\n\t\t\t\t\t\tthis.assignSlot(light, light.atlasSlotIndex, false);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet usedCount = 0;\n\t\t\tfor (let i = 0; i < assignCount; i++) {\n\t\t\t\twhile (usedCount < slots.length && slots[usedCount].used) usedCount++;\n\t\t\t\tconst light = lights[i];\n\t\t\t\tif (!light.atlasViewportAllocated) {\n\t\t\t\t\tthis.assignSlot(light, usedCount, true);\n\t\t\t\t}\n\t\t\t\tconst slot = slots[light.atlasSlotIndex];\n\t\t\t\tthis.setupSlot(light, slot.rect);\n\t\t\t}\n\t\t}\n\t\tthis.updateUniforms();\n\t}\n}\n\nexport { LightTextureAtlas };\n","import { Vec3 } from '../../core/math/vec3.js';\nimport { LIGHTTYPE_DIRECTIONAL } from '../constants.js';\n\nconst lightCubeDir = [new Vec3(-1, 0, 0), new Vec3(1, 0, 0), new Vec3(0, -1, 0), new Vec3(0, 1, 0), new Vec3(0, 0, -1), new Vec3(0, 0, 1)];\nclass LightCube {\n\tconstructor() {\n\t\tthis.colors = new Float32Array(6 * 3);\n\t}\n\tupdate(ambientLight, lights) {\n\t\tconst colors = this.colors;\n\t\tconst {\n\t\t\tr,\n\t\t\tg,\n\t\t\tb\n\t\t} = ambientLight;\n\t\tfor (let j = 0; j < 6; j++) {\n\t\t\tcolors[j * 3] = r;\n\t\t\tcolors[j * 3 + 1] = g;\n\t\t\tcolors[j * 3 + 2] = b;\n\t\t}\n\t\tfor (let j = 0; j < lights.length; j++) {\n\t\t\tconst light = lights[j];\n\t\t\tif (light._type === LIGHTTYPE_DIRECTIONAL) {\n\t\t\t\tfor (let c = 0; c < 6; c++) {\n\t\t\t\t\tconst weight = Math.max(lightCubeDir[c].dot(light._direction), 0) * light._intensity;\n\t\t\t\t\tconst lightColor = light._color;\n\t\t\t\t\tcolors[c * 3] += lightColor.r * weight;\n\t\t\t\t\tcolors[c * 3 + 1] += lightColor.g * weight;\n\t\t\t\t\tcolors[c * 3 + 2] += lightColor.b * weight;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport { LightCube };\n","import { LIGHTTYPE_OMNI } from '../constants.js';\nimport { ShadowMap } from './shadow-map.js';\n\nclass ShadowMapCache {\n\tconstructor() {\n\t\tthis.cache = new Map();\n\t}\n\tdestroy() {\n\t\tthis.clear();\n\t\tthis.cache = null;\n\t}\n\tclear() {\n\t\tthis.cache.forEach(shadowMaps => {\n\t\t\tshadowMaps.forEach(shadowMap => {\n\t\t\t\tshadowMap.destroy();\n\t\t\t});\n\t\t});\n\t\tthis.cache.clear();\n\t}\n\tgetKey(light) {\n\t\tconst isCubeMap = light._type === LIGHTTYPE_OMNI;\n\t\tconst shadowType = light._shadowType;\n\t\tconst resolution = light._shadowResolution;\n\t\treturn `${isCubeMap}-${shadowType}-${resolution}`;\n\t}\n\tget(device, light) {\n\t\tconst key = this.getKey(light);\n\t\tconst shadowMaps = this.cache.get(key);\n\t\tif (shadowMaps && shadowMaps.length) {\n\t\t\treturn shadowMaps.pop();\n\t\t}\n\t\tconst shadowMap = ShadowMap.create(device, light);\n\t\tshadowMap.cached = true;\n\t\treturn shadowMap;\n\t}\n\tadd(light, shadowMap) {\n\t\tconst key = this.getKey(light);\n\t\tconst shadowMaps = this.cache.get(key);\n\t\tif (shadowMaps) {\n\t\t\tshadowMaps.push(shadowMap);\n\t\t} else {\n\t\t\tthis.cache.set(key, [shadowMap]);\n\t\t}\n\t}\n}\n\nexport { ShadowMapCache };\n","import '../../core/tracing.js';\nimport { RenderPass } from '../../platform/graphics/render-pass.js';\n\nclass RenderPassShadowLocalNonClustered extends RenderPass {\n\tconstructor(device, shadowRenderer, light, face, applyVsm) {\n\t\tsuper(device);\n\t\tthis.requiresCubemaps = false;\n\t\tthis.shadowRenderer = shadowRenderer;\n\t\tthis.light = light;\n\t\tthis.face = face;\n\t\tthis.applyVsm = applyVsm;\n\t\tthis.shadowCamera = shadowRenderer.prepareFace(light, null, face);\n\t\tshadowRenderer.setupRenderPass(this, this.shadowCamera, true);\n\t}\n\texecute() {\n\t\tthis.shadowRenderer.renderFace(this.light, null, this.face, false);\n\t}\n\tafter() {\n\t\tif (this.applyVsm) {\n\t\t\tthis.shadowRenderer.renderVsm(this.light, this.shadowCamera);\n\t\t}\n\t}\n}\n\nexport { RenderPassShadowLocalNonClustered };\n","import { math } from '../../core/math/math.js';\nimport { ShadowMap } from './shadow-map.js';\nimport { LIGHTTYPE_SPOT, LIGHTTYPE_OMNI } from '../constants.js';\nimport { RenderPassShadowLocalNonClustered } from './render-pass-shadow-local-non-clustered.js';\n\nclass ShadowRendererLocal {\n\tconstructor(renderer, shadowRenderer) {\n\t\tthis.shadowLights = [];\n\t\tthis.renderer = void 0;\n\t\tthis.shadowRenderer = void 0;\n\t\tthis.device = void 0;\n\t\tthis.renderer = renderer;\n\t\tthis.shadowRenderer = shadowRenderer;\n\t\tthis.device = renderer.device;\n\t}\n\tcull(light, comp, casters = null) {\n\t\tconst isClustered = this.renderer.scene.clusteredLightingEnabled;\n\t\tlight.visibleThisFrame = true;\n\t\tif (!isClustered) {\n\t\t\tif (!light._shadowMap) {\n\t\t\t\tlight._shadowMap = ShadowMap.create(this.device, light);\n\t\t\t}\n\t\t}\n\t\tconst type = light._type;\n\t\tconst faceCount = type === LIGHTTYPE_SPOT ? 1 : 6;\n\t\tfor (let face = 0; face < faceCount; face++) {\n\t\t\tconst lightRenderData = light.getRenderData(null, face);\n\t\t\tconst shadowCam = lightRenderData.shadowCamera;\n\t\t\tshadowCam.nearClip = light.attenuationEnd / 1000;\n\t\t\tshadowCam.farClip = light.attenuationEnd;\n\t\t\tlightRenderData.depthRangeCompensation = shadowCam.farClip - shadowCam.nearClip;\n\t\t\tconst shadowCamNode = shadowCam._node;\n\t\t\tconst lightNode = light._node;\n\t\t\tshadowCamNode.setPosition(lightNode.getPosition());\n\t\t\tif (type === LIGHTTYPE_SPOT) {\n\t\t\t\tshadowCam.fov = light._outerConeAngle * 2;\n\t\t\t\tshadowCamNode.setRotation(lightNode.getRotation());\n\t\t\t\tshadowCamNode.rotateLocal(-90, 0, 0);\n\t\t\t} else if (type === LIGHTTYPE_OMNI) {\n\t\t\t\tif (isClustered) {\n\t\t\t\t\tconst tileSize = this.shadowRenderer.lightTextureAtlas.shadowAtlasResolution * light.atlasViewport.z / 3;\n\t\t\t\t\tconst texelSize = 2 / tileSize;\n\t\t\t\t\tconst filterSize = texelSize * this.shadowRenderer.lightTextureAtlas.shadowEdgePixels;\n\t\t\t\t\tshadowCam.fov = Math.atan(1 + filterSize) * math.RAD_TO_DEG * 2;\n\t\t\t\t} else {\n\t\t\t\t\tshadowCam.fov = 90;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.renderer.updateCameraFrustum(shadowCam);\n\t\t\tthis.shadowRenderer.cullShadowCasters(comp, light, lightRenderData.visibleCasters, shadowCam, casters);\n\t\t}\n\t}\n\tprepareLights(shadowLights, lights) {\n\t\tlet shadowCamera;\n\t\tfor (let i = 0; i < lights.length; i++) {\n\t\t\tconst light = lights[i];\n\t\t\tif (this.shadowRenderer.needsShadowRendering(light) && light.atlasViewportAllocated) {\n\t\t\t\tshadowLights.push(light);\n\t\t\t\tfor (let face = 0; face < light.numShadowFaces; face++) {\n\t\t\t\t\tshadowCamera = this.shadowRenderer.prepareFace(light, null, face);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn shadowCamera;\n\t}\n\tbuildNonClusteredRenderPasses(frameGraph, localLights) {\n\t\tfor (let i = 0; i < localLights.length; i++) {\n\t\t\tconst light = localLights[i];\n\t\t\tif (this.shadowRenderer.needsShadowRendering(light)) {\n\t\t\t\tconst applyVsm = light._type === LIGHTTYPE_SPOT;\n\t\t\t\tconst faceCount = light.numShadowFaces;\n\t\t\t\tfor (let face = 0; face < faceCount; face++) {\n\t\t\t\t\tconst renderPass = new RenderPassShadowLocalNonClustered(this.device, this.shadowRenderer, light, face, applyVsm);\n\t\t\t\t\tframeGraph.addRenderPass(renderPass);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport { ShadowRendererLocal };\n","import '../../core/tracing.js';\nimport { RenderPass } from '../../platform/graphics/render-pass.js';\nimport { SHADOWUPDATE_NONE, SHADOWUPDATE_THISFRAME } from '../constants.js';\n\nclass RenderPassShadowDirectional extends RenderPass {\n\tconstructor(device, shadowRenderer, light, camera, allCascadesRendering) {\n\t\tsuper(device);\n\t\tthis.shadowRenderer = shadowRenderer;\n\t\tthis.light = light;\n\t\tthis.camera = camera;\n\t\tthis.allCascadesRendering = allCascadesRendering;\n\t}\n\texecute() {\n\t\tconst {\n\t\t\tlight,\n\t\t\tcamera,\n\t\t\tshadowRenderer,\n\t\t\tallCascadesRendering\n\t\t} = this;\n\t\tconst faceCount = light.numShadowFaces;\n\t\tconst shadowUpdateOverrides = light.shadowUpdateOverrides;\n\t\tfor (let face = 0; face < faceCount; face++) {\n\t\t\tif ((shadowUpdateOverrides == null ? void 0 : shadowUpdateOverrides[face]) !== SHADOWUPDATE_NONE) {\n\t\t\t\tshadowRenderer.renderFace(light, camera, face, !allCascadesRendering);\n\t\t\t}\n\t\t\tif ((shadowUpdateOverrides == null ? void 0 : shadowUpdateOverrides[face]) === SHADOWUPDATE_THISFRAME) {\n\t\t\t\tshadowUpdateOverrides[face] = SHADOWUPDATE_NONE;\n\t\t\t}\n\t\t}\n\t}\n\tafter() {\n\t\tthis.shadowRenderer.renderVsm(this.light, this.camera);\n\t}\n}\n\nexport { RenderPassShadowDirectional };\n","import '../../core/tracing.js';\nimport { math } from '../../core/math/math.js';\nimport { Vec3 } from '../../core/math/vec3.js';\nimport { Mat4 } from '../../core/math/mat4.js';\nimport { BoundingBox } from '../../core/shape/bounding-box.js';\nimport { SHADOWUPDATE_NONE } from '../constants.js';\nimport { ShadowMap } from './shadow-map.js';\nimport { RenderPassShadowDirectional } from './render-pass-shadow-directional.js';\n\nconst visibleSceneAabb = new BoundingBox();\nconst center = new Vec3();\nconst shadowCamView = new Mat4();\nconst aabbPoints = [new Vec3(), new Vec3(), new Vec3(), new Vec3(), new Vec3(), new Vec3(), new Vec3(), new Vec3()];\nconst _depthRange = {\n\tmin: 0,\n\tmax: 0\n};\nfunction getDepthRange(cameraViewMatrix, aabbMin, aabbMax) {\n\taabbPoints[0].x = aabbPoints[1].x = aabbPoints[2].x = aabbPoints[3].x = aabbMin.x;\n\taabbPoints[1].y = aabbPoints[3].y = aabbPoints[7].y = aabbPoints[5].y = aabbMin.y;\n\taabbPoints[2].z = aabbPoints[3].z = aabbPoints[6].z = aabbPoints[7].z = aabbMin.z;\n\taabbPoints[4].x = aabbPoints[5].x = aabbPoints[6].x = aabbPoints[7].x = aabbMax.x;\n\taabbPoints[0].y = aabbPoints[2].y = aabbPoints[4].y = aabbPoints[6].y = aabbMax.y;\n\taabbPoints[0].z = aabbPoints[1].z = aabbPoints[4].z = aabbPoints[5].z = aabbMax.z;\n\tlet minz = 9999999999;\n\tlet maxz = -9999999999;\n\tfor (let i = 0; i < 8; ++i) {\n\t\tcameraViewMatrix.transformPoint(aabbPoints[i], aabbPoints[i]);\n\t\tconst z = aabbPoints[i].z;\n\t\tif (z < minz) minz = z;\n\t\tif (z > maxz) maxz = z;\n\t}\n\t_depthRange.min = minz;\n\t_depthRange.max = maxz;\n\treturn _depthRange;\n}\nclass ShadowRendererDirectional {\n\tconstructor(renderer, shadowRenderer) {\n\t\tthis.renderer = void 0;\n\t\tthis.shadowRenderer = void 0;\n\t\tthis.device = void 0;\n\t\tthis.renderer = renderer;\n\t\tthis.shadowRenderer = shadowRenderer;\n\t\tthis.device = renderer.device;\n\t}\n\tcull(light, comp, camera, casters = null) {\n\t\tlight.visibleThisFrame = true;\n\t\tif (!light._shadowMap) {\n\t\t\tlight._shadowMap = ShadowMap.create(this.device, light);\n\t\t}\n\t\tconst nearDist = camera._nearClip;\n\t\tthis.generateSplitDistances(light, nearDist, Math.min(camera._farClip, light.shadowDistance));\n\t\tconst shadowUpdateOverrides = light.shadowUpdateOverrides;\n\t\tfor (let cascade = 0; cascade < light.numCascades; cascade++) {\n\t\t\tif ((shadowUpdateOverrides == null ? void 0 : shadowUpdateOverrides[cascade]) === SHADOWUPDATE_NONE) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tconst lightRenderData = light.getRenderData(camera, cascade);\n\t\t\tconst shadowCam = lightRenderData.shadowCamera;\n\t\t\tshadowCam.renderTarget = light._shadowMap.renderTargets[0];\n\t\t\tlightRenderData.shadowViewport.copy(light.cascades[cascade]);\n\t\t\tlightRenderData.shadowScissor.copy(light.cascades[cascade]);\n\t\t\tconst shadowCamNode = shadowCam._node;\n\t\t\tconst lightNode = light._node;\n\t\t\tshadowCamNode.setPosition(lightNode.getPosition());\n\t\t\tshadowCamNode.setRotation(lightNode.getRotation());\n\t\t\tshadowCamNode.rotateLocal(-90, 0, 0);\n\t\t\tconst frustumNearDist = cascade === 0 ? nearDist : light._shadowCascadeDistances[cascade - 1];\n\t\t\tconst frustumFarDist = light._shadowCascadeDistances[cascade];\n\t\t\tconst frustumPoints = camera.getFrustumCorners(frustumNearDist, frustumFarDist);\n\t\t\tcenter.set(0, 0, 0);\n\t\t\tconst cameraWorldMat = camera.node.getWorldTransform();\n\t\t\tfor (let i = 0; i < 8; i++) {\n\t\t\t\tcameraWorldMat.transformPoint(frustumPoints[i], frustumPoints[i]);\n\t\t\t\tcenter.add(frustumPoints[i]);\n\t\t\t}\n\t\t\tcenter.mulScalar(1 / 8);\n\t\t\tlet radius = 0;\n\t\t\tfor (let i = 0; i < 8; i++) {\n\t\t\t\tconst dist = frustumPoints[i].sub(center).length();\n\t\t\t\tif (dist > radius) radius = dist;\n\t\t\t}\n\t\t\tconst right = shadowCamNode.right;\n\t\t\tconst up = shadowCamNode.up;\n\t\t\tconst lightDir = shadowCamNode.forward;\n\t\t\tconst sizeRatio = 0.25 * light._shadowResolution / radius;\n\t\t\tconst x = Math.ceil(center.dot(up) * sizeRatio) / sizeRatio;\n\t\t\tconst y = Math.ceil(center.dot(right) * sizeRatio) / sizeRatio;\n\t\t\tconst scaledUp = up.mulScalar(x);\n\t\t\tconst scaledRight = right.mulScalar(y);\n\t\t\tconst dot = center.dot(lightDir);\n\t\t\tconst scaledDir = lightDir.mulScalar(dot);\n\t\t\tcenter.add2(scaledUp, scaledRight).add(scaledDir);\n\t\t\tshadowCamNode.setPosition(center);\n\t\t\tshadowCamNode.translateLocal(0, 0, 1000000);\n\t\t\tshadowCam.nearClip = 0.01;\n\t\t\tshadowCam.farClip = 2000000;\n\t\t\tshadowCam.orthoHeight = radius;\n\t\t\tthis.renderer.updateCameraFrustum(shadowCam);\n\t\t\tthis.shadowRenderer.cullShadowCasters(comp, light, lightRenderData.visibleCasters, shadowCam, casters);\n\t\t\tlet emptyAabb = true;\n\t\t\tconst visibleCasters = lightRenderData.visibleCasters;\n\t\t\tfor (let i = 0; i < visibleCasters.length; i++) {\n\t\t\t\tconst meshInstance = visibleCasters[i];\n\t\t\t\tif (emptyAabb) {\n\t\t\t\t\temptyAabb = false;\n\t\t\t\t\tvisibleSceneAabb.copy(meshInstance.aabb);\n\t\t\t\t} else {\n\t\t\t\t\tvisibleSceneAabb.add(meshInstance.aabb);\n\t\t\t\t}\n\t\t\t}\n\t\t\tshadowCamView.copy(shadowCamNode.getWorldTransform()).invert();\n\t\t\tconst depthRange = getDepthRange(shadowCamView, visibleSceneAabb.getMin(), visibleSceneAabb.getMax());\n\t\t\tshadowCamNode.translateLocal(0, 0, depthRange.max + 0.1);\n\t\t\tshadowCam.farClip = depthRange.max - depthRange.min + 0.2;\n\t\t\tlightRenderData.depthRangeCompensation = shadowCam.farClip;\n\t\t\tlightRenderData.projectionCompensation = radius;\n\t\t}\n\t}\n\tgenerateSplitDistances(light, nearDist, farDist) {\n\t\tlight._shadowCascadeDistances.fill(farDist);\n\t\tfor (let i = 1; i < light.numCascades; i++) {\n\t\t\tconst fraction = i / light.numCascades;\n\t\t\tconst linearDist = nearDist + (farDist - nearDist) * fraction;\n\t\t\tconst logDist = nearDist * (farDist / nearDist) ** fraction;\n\t\t\tconst dist = math.lerp(linearDist, logDist, light.cascadeDistribution);\n\t\t\tlight._shadowCascadeDistances[i - 1] = dist;\n\t\t}\n\t}\n\taddLightRenderPasses(frameGraph, light, camera) {\n\t\tconst faceCount = light.numShadowFaces;\n\t\tconst shadowUpdateOverrides = light.shadowUpdateOverrides;\n\t\tlet allCascadesRendering = true;\n\t\tlet shadowCamera;\n\t\tfor (let face = 0; face < faceCount; face++) {\n\t\t\tif ((shadowUpdateOverrides == null ? void 0 : shadowUpdateOverrides[face]) === SHADOWUPDATE_NONE) allCascadesRendering = false;\n\t\t\tshadowCamera = this.shadowRenderer.prepareFace(light, camera, face);\n\t\t}\n\t\tconst renderPass = new RenderPassShadowDirectional(this.device, this.shadowRenderer, light, camera, allCascadesRendering);\n\t\tthis.shadowRenderer.setupRenderPass(renderPass, shadowCamera, allCascadesRendering);\n\t\tframeGraph.addRenderPass(renderPass);\n\t}\n\tbuildFrameGraph(frameGraph, directionalLights, camera) {\n\t\tfor (let i = 0; i < directionalLights.length; i++) {\n\t\t\tconst light = directionalLights[i];\n\t\t\tif (this.shadowRenderer.needsShadowRendering(light)) {\n\t\t\t\tthis.addLightRenderPasses(frameGraph, light, camera.camera);\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport { ShadowRendererDirectional };\n","import '../../core/tracing.js';\nimport '../../core/time.js';\nimport { Color } from '../../core/math/color.js';\nimport { Mat4 } from '../../core/math/mat4.js';\nimport { Vec3 } from '../../core/math/vec3.js';\nimport { Vec4 } from '../../core/math/vec4.js';\nimport { UNIFORMTYPE_MAT4, UNIFORM_BUFFER_DEFAULT_SLOT_NAME, SHADERSTAGE_VERTEX, SHADERSTAGE_FRAGMENT } from '../../platform/graphics/constants.js';\nimport { drawQuadWithShader } from '../graphics/quad-render-utils.js';\nimport { SHADOW_VSM8, SHADOW_VSM32, SHADOW_PCF5, SHADOW_PCF1, SHADOW_PCF3, LIGHTTYPE_OMNI, LIGHTTYPE_DIRECTIONAL, SORTKEY_DEPTH, SHADOWUPDATE_NONE, SHADOWUPDATE_THISFRAME, BLUR_GAUSSIAN, SHADER_SHADOW } from '../constants.js';\nimport { ShaderPass } from '../shader-pass.js';\nimport { shaderChunks } from '../shader-lib/chunks/chunks.js';\nimport { createShaderFromCode } from '../shader-lib/utils.js';\nimport { LightCamera } from './light-camera.js';\nimport { UniformBufferFormat, UniformFormat } from '../../platform/graphics/uniform-buffer-format.js';\nimport { BindGroupFormat, BindBufferFormat } from '../../platform/graphics/bind-group-format.js';\nimport { BlendState } from '../../platform/graphics/blend-state.js';\nimport { DepthState } from '../../platform/graphics/depth-state.js';\n\nfunction gauss(x, sigma) {\n\treturn Math.exp(-(x * x) / (2.0 * sigma * sigma));\n}\nfunction gaussWeights(kernelSize) {\n\tconst sigma = (kernelSize - 1) / (2 * 3);\n\tconst halfWidth = (kernelSize - 1) * 0.5;\n\tconst values = new Array(kernelSize);\n\tlet sum = 0.0;\n\tfor (let i = 0; i < kernelSize; ++i) {\n\t\tvalues[i] = gauss(i - halfWidth, sigma);\n\t\tsum += values[i];\n\t}\n\tfor (let i = 0; i < kernelSize; ++i) {\n\t\tvalues[i] /= sum;\n\t}\n\treturn values;\n}\nconst tempSet = new Set();\nconst shadowCamView = new Mat4();\nconst shadowCamViewProj = new Mat4();\nconst pixelOffset = new Float32Array(2);\nconst blurScissorRect = new Vec4(1, 1, 0, 0);\nconst viewportMatrix = new Mat4();\nclass ShadowRenderer {\n\tconstructor(renderer, lightTextureAtlas) {\n\t\tthis.shadowPassCache = [];\n\t\tthis.device = renderer.device;\n\t\tthis.renderer = renderer;\n\t\tthis.lightTextureAtlas = lightTextureAtlas;\n\t\tconst scope = this.device.scope;\n\t\tthis.polygonOffsetId = scope.resolve('polygonOffset');\n\t\tthis.polygonOffset = new Float32Array(2);\n\t\tthis.sourceId = scope.resolve('source');\n\t\tthis.pixelOffsetId = scope.resolve('pixelOffset');\n\t\tthis.weightId = scope.resolve('weight[0]');\n\t\tthis.blurVsmShaderCode = [shaderChunks.blurVSMPS, '#define GAUSS\\n' + shaderChunks.blurVSMPS];\n\t\tconst packed = '#define PACKED\\n';\n\t\tthis.blurPackedVsmShaderCode = [packed + this.blurVsmShaderCode[0], packed + this.blurVsmShaderCode[1]];\n\t\tthis.blurVsmShader = [{}, {}];\n\t\tthis.blurPackedVsmShader = [{}, {}];\n\t\tthis.blurVsmWeights = {};\n\t\tthis.shadowMapLightRadiusId = scope.resolve('light_radius');\n\t\tthis.viewUniformFormat = null;\n\t\tthis.viewBindGroupFormat = null;\n\t\tthis.blendStateWrite = new BlendState();\n\t\tthis.blendStateNoWrite = new BlendState();\n\t\tthis.blendStateNoWrite.setColorWrite(false, false, false, false);\n\t}\n\tstatic createShadowCamera(device, shadowType, type, face) {\n\t\tconst shadowCam = LightCamera.create('ShadowCamera', type, face);\n\t\tif (shadowType >= SHADOW_VSM8 && shadowType <= SHADOW_VSM32) {\n\t\t\tshadowCam.clearColor = new Color(0, 0, 0, 0);\n\t\t} else {\n\t\t\tshadowCam.clearColor = new Color(1, 1, 1, 1);\n\t\t}\n\t\tshadowCam.clearDepthBuffer = true;\n\t\tshadowCam.clearStencilBuffer = false;\n\t\treturn shadowCam;\n\t}\n\tstatic setShadowCameraSettings(shadowCam, device, shadowType, type, isClustered) {\n\t\tlet hwPcf = shadowType === SHADOW_PCF5 || (shadowType === SHADOW_PCF1 || shadowType === SHADOW_PCF3) && device.supportsDepthShadow;\n\t\tif (type === LIGHTTYPE_OMNI && !isClustered) {\n\t\t\thwPcf = false;\n\t\t}\n\t\tshadowCam.clearColorBuffer = !hwPcf;\n\t}\n\t_cullShadowCastersInternal(meshInstances, visible, camera) {\n\t\tconst numInstances = meshInstances.length;\n\t\tfor (let i = 0; i < numInstances; i++) {\n\t\t\tconst meshInstance = meshInstances[i];\n\t\t\tif (meshInstance.castShadow) {\n\t\t\t\tif (!meshInstance.cull || meshInstance._isVisible(camera)) {\n\t\t\t\t\tmeshInstance.visibleThisFrame = true;\n\t\t\t\t\tvisible.push(meshInstance);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tcullShadowCasters(comp, light, visible, camera, casters) {\n\t\tvisible.length = 0;\n\t\tif (casters) {\n\t\t\tthis._cullShadowCastersInternal(casters, visible, camera);\n\t\t} else {\n\t\t\tconst layers = comp.layerList;\n\t\t\tconst len = layers.length;\n\t\t\tfor (let i = 0; i < len; i++) {\n\t\t\t\tconst layer = layers[i];\n\t\t\t\tif (layer._lightsSet.has(light)) {\n\t\t\t\t\tif (!tempSet.has(layer)) {\n\t\t\t\t\t\ttempSet.add(layer);\n\t\t\t\t\t\tthis._cullShadowCastersInternal(layer.shadowCasters, visible, camera);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\ttempSet.clear();\n\t\t}\n\t\tvisible.sort(this.renderer.sortCompareDepth);\n\t}\n\tsetupRenderState(device, light) {\n\t\tconst isClustered = this.renderer.scene.clusteredLightingEnabled;\n\t\tif (device.isWebGL2 || device.isWebGPU) {\n\t\t\tif (light._type === LIGHTTYPE_OMNI && !isClustered) {\n\t\t\t\tdevice.setDepthBias(false);\n\t\t\t} else {\n\t\t\t\tdevice.setDepthBias(true);\n\t\t\t\tdevice.setDepthBiasValues(light.shadowBias * -1000.0, light.shadowBias * -1000.0);\n\t\t\t}\n\t\t} else if (device.extStandardDerivatives) {\n\t\t\tif (light._type === LIGHTTYPE_OMNI) {\n\t\t\t\tthis.polygonOffset[0] = 0;\n\t\t\t\tthis.polygonOffset[1] = 0;\n\t\t\t\tthis.polygonOffsetId.setValue(this.polygonOffset);\n\t\t\t} else {\n\t\t\t\tthis.polygonOffset[0] = light.shadowBias * -1000.0;\n\t\t\t\tthis.polygonOffset[1] = light.shadowBias * -1000.0;\n\t\t\t\tthis.polygonOffsetId.setValue(this.polygonOffset);\n\t\t\t}\n\t\t}\n\t\tconst gpuOrGl2 = device.isWebGL2 || device.isWebGPU;\n\t\tconst useShadowSampler = isClustered ? light._isPcf && gpuOrGl2 : light._isPcf && gpuOrGl2 && light._type !== LIGHTTYPE_OMNI;\n\t\tdevice.setBlendState(useShadowSampler ? this.blendStateNoWrite : this.blendStateWrite);\n\t\tdevice.setDepthState(DepthState.DEFAULT);\n\t\tdevice.setStencilState(null, null);\n\t}\n\trestoreRenderState(device) {\n\t\tif (device.isWebGL2 || device.isWebGPU) {\n\t\t\tdevice.setDepthBias(false);\n\t\t} else if (device.extStandardDerivatives) {\n\t\t\tthis.polygonOffset[0] = 0;\n\t\t\tthis.polygonOffset[1] = 0;\n\t\t\tthis.polygonOffsetId.setValue(this.polygonOffset);\n\t\t}\n\t}\n\tdispatchUniforms(light, shadowCam, lightRenderData, face) {\n\t\tconst shadowCamNode = shadowCam._node;\n\t\tif (light._type !== LIGHTTYPE_DIRECTIONAL) {\n\t\t\tthis.renderer.dispatchViewPos(shadowCamNode.getPosition());\n\t\t\tthis.shadowMapLightRadiusId.setValue(light.attenuationEnd);\n\t\t}\n\t\tshadowCamView.setTRS(shadowCamNode.getPosition(), shadowCamNode.getRotation(), Vec3.ONE).invert();\n\t\tshadowCamViewProj.mul2(shadowCam.projectionMatrix, shadowCamView);\n\t\tconst rectViewport = lightRenderData.shadowViewport;\n\t\tshadowCam.rect = rectViewport;\n\t\tshadowCam.scissorRect = lightRenderData.shadowScissor;\n\t\tviewportMatrix.setViewport(rectViewport.x, rectViewport.y, rectViewport.z, rectViewport.w);\n\t\tlightRenderData.shadowMatrix.mul2(viewportMatrix, shadowCamViewProj);\n\t\tif (light._type === LIGHTTYPE_DIRECTIONAL) {\n\t\t\tlight._shadowMatrixPalette.set(lightRenderData.shadowMatrix.data, face * 16);\n\t\t}\n\t}\n\tgetShadowPass(light) {\n\t\tvar _this$shadowPassCache;\n\t\tconst lightType = light._type;\n\t\tconst shadowType = light._shadowType;\n\t\tlet shadowPassInfo = (_this$shadowPassCache = this.shadowPassCache[lightType]) == null ? void 0 : _this$shadowPassCache[shadowType];\n\t\tif (!shadowPassInfo) {\n\t\t\tconst shadowPassName = `ShadowPass_${lightType}_${shadowType}`;\n\t\t\tshadowPassInfo = ShaderPass.get(this.device).allocate(shadowPassName, {\n\t\t\t\tisShadow: true,\n\t\t\t\tlightType: lightType,\n\t\t\t\tshadowType: shadowType\n\t\t\t});\n\t\t\tif (!this.shadowPassCache[lightType]) this.shadowPassCache[lightType] = [];\n\t\t\tthis.shadowPassCache[lightType][shadowType] = shadowPassInfo;\n\t\t}\n\t\treturn shadowPassInfo.index;\n\t}\n\tsubmitCasters(visibleCasters, light) {\n\t\tconst device = this.device;\n\t\tconst renderer = this.renderer;\n\t\tconst scene = renderer.scene;\n\t\tconst passFlags = 1 << SHADER_SHADOW;\n\t\tconst shadowPass = this.getShadowPass(light);\n\t\tconst count = visibleCasters.length;\n\t\tfor (let i = 0; i < count; i++) {\n\t\t\tconst meshInstance = visibleCasters[i];\n\t\t\tconst mesh = meshInstance.mesh;\n\t\t\tmeshInstance.ensureMaterial(device);\n\t\t\tconst material = meshInstance.material;\n\t\t\trenderer.setBaseConstants(device, material);\n\t\t\trenderer.setSkinning(device, meshInstance);\n\t\t\tif (material.dirty) {\n\t\t\t\tmaterial.updateUniforms(device, scene);\n\t\t\t\tmaterial.dirty = false;\n\t\t\t}\n\t\t\tif (material.chunks) {\n\t\t\t\trenderer.setupCullMode(true, 1, meshInstance);\n\t\t\t\tmaterial.setParameters(device);\n\t\t\t\tmeshInstance.setParameters(device, passFlags);\n\t\t\t}\n\t\t\tconst shaderInstance = meshInstance.getShaderInstance(shadowPass, 0, scene, this.viewUniformFormat, this.viewBindGroupFormat);\n\t\t\tconst shadowShader = shaderInstance.shader;\n\t\t\tmeshInstance._key[SORTKEY_DEPTH] = shadowShader.id;\n\t\t\tif (!shadowShader.failed && !device.setShader(shadowShader)) ;\n\t\t\trenderer.setVertexBuffers(device, mesh);\n\t\t\trenderer.setMorphing(device, meshInstance.morphInstance);\n\t\t\tthis.renderer.setupMeshUniformBuffers(shaderInstance, meshInstance);\n\t\t\tconst style = meshInstance.renderStyle;\n\t\t\tdevice.setIndexBuffer(mesh.indexBuffer[style]);\n\t\t\trenderer.drawInstance(device, meshInstance, mesh, style);\n\t\t\trenderer._shadowDrawCalls++;\n\t\t}\n\t}\n\tneedsShadowRendering(light) {\n\t\tconst needs = light.enabled && light.castShadows && light.shadowUpdateMode !== SHADOWUPDATE_NONE && light.visibleThisFrame;\n\t\tif (light.shadowUpdateMode === SHADOWUPDATE_THISFRAME) {\n\t\t\tlight.shadowUpdateMode = SHADOWUPDATE_NONE;\n\t\t}\n\t\tif (needs) {\n\t\t\tthis.renderer._shadowMapUpdates += light.numShadowFaces;\n\t\t}\n\t\treturn needs;\n\t}\n\tgetLightRenderData(light, camera, face) {\n\t\treturn light.getRenderData(light._type === LIGHTTYPE_DIRECTIONAL ? camera : null, face);\n\t}\n\tsetupRenderPass(renderPass, shadowCamera, clearRenderTarget) {\n\t\tconst rt = shadowCamera.renderTarget;\n\t\trenderPass.init(rt);\n\t\trenderPass.depthStencilOps.clearDepthValue = 1;\n\t\trenderPass.depthStencilOps.clearDepth = clearRenderTarget;\n\t\tif (rt.depthBuffer) {\n\t\t\trenderPass.depthStencilOps.storeDepth = true;\n\t\t} else {\n\t\t\trenderPass.colorOps.clearValue.copy(shadowCamera.clearColor);\n\t\t\trenderPass.colorOps.clear = clearRenderTarget;\n\t\t\trenderPass.depthStencilOps.storeDepth = false;\n\t\t}\n\t\trenderPass.requiresCubemaps = false;\n\t}\n\tprepareFace(light, camera, face) {\n\t\tconst type = light._type;\n\t\tconst shadowType = light._shadowType;\n\t\tconst isClustered = this.renderer.scene.clusteredLightingEnabled;\n\t\tconst lightRenderData = this.getLightRenderData(light, camera, face);\n\t\tconst shadowCam = lightRenderData.shadowCamera;\n\t\tShadowRenderer.setShadowCameraSettings(shadowCam, this.device, shadowType, type, isClustered);\n\t\tconst renderTargetIndex = type === LIGHTTYPE_DIRECTIONAL ? 0 : face;\n\t\tshadowCam.renderTarget = light._shadowMap.renderTargets[renderTargetIndex];\n\t\treturn shadowCam;\n\t}\n\trenderFace(light, camera, face, clear, insideRenderPass = true) {\n\t\tconst device = this.device;\n\t\tconst lightRenderData = this.getLightRenderData(light, camera, face);\n\t\tconst shadowCam = lightRenderData.shadowCamera;\n\t\tthis.dispatchUniforms(light, shadowCam, lightRenderData, face);\n\t\tconst rt = shadowCam.renderTarget;\n\t\tconst renderer = this.renderer;\n\t\trenderer.setCameraUniforms(shadowCam, rt);\n\t\tif (device.supportsUniformBuffers) {\n\t\t\trenderer.setupViewUniformBuffers(lightRenderData.viewBindGroups, this.viewUniformFormat, this.viewBindGroupFormat, 1);\n\t\t}\n\t\tif (insideRenderPass) {\n\t\t\trenderer.setupViewport(shadowCam, rt);\n\t\t\tif (clear) {\n\t\t\t\trenderer.clear(shadowCam);\n\t\t\t}\n\t\t} else {\n\t\t\trenderer.clearView(shadowCam, rt, true, false);\n\t\t}\n\t\tthis.setupRenderState(device, light);\n\t\tthis.submitCasters(lightRenderData.visibleCasters, light);\n\t\tthis.restoreRenderState(device);\n\t}\n\trender(light, camera, insideRenderPass = true) {\n\t\tif (this.needsShadowRendering(light)) {\n\t\t\tconst faceCount = light.numShadowFaces;\n\t\t\tfor (let face = 0; face < faceCount; face++) {\n\t\t\t\tthis.prepareFace(light, camera, face);\n\t\t\t\tthis.renderFace(light, camera, face, true, insideRenderPass);\n\t\t\t}\n\t\t\tthis.renderVsm(light, camera);\n\t\t}\n\t}\n\trenderVsm(light, camera) {\n\t\tif (light._isVsm && light._vsmBlurSize > 1) {\n\t\t\tconst isClustered = this.renderer.scene.clusteredLightingEnabled;\n\t\t\tif (!isClustered || light._type === LIGHTTYPE_DIRECTIONAL) {\n\t\t\t\tthis.applyVsmBlur(light, camera);\n\t\t\t}\n\t\t}\n\t}\n\tgetVsmBlurShader(isVsm8, blurMode, filterSize) {\n\t\tlet blurShader = (isVsm8 ? this.blurPackedVsmShader : this.blurVsmShader)[blurMode][filterSize];\n\t\tif (!blurShader) {\n\t\t\tthis.blurVsmWeights[filterSize] = gaussWeights(filterSize);\n\t\t\tconst blurVS = shaderChunks.fullscreenQuadVS;\n\t\t\tlet blurFS = '#define SAMPLES ' + filterSize + '\\n';\n\t\t\tif (isVsm8) {\n\t\t\t\tblurFS += this.blurPackedVsmShaderCode[blurMode];\n\t\t\t} else {\n\t\t\t\tblurFS += this.blurVsmShaderCode[blurMode];\n\t\t\t}\n\t\t\tconst blurShaderName = 'blurVsm' + blurMode + '' + filterSize + '' + isVsm8;\n\t\t\tblurShader = createShaderFromCode(this.device, blurVS, blurFS, blurShaderName);\n\t\t\tif (isVsm8) {\n\t\t\t\tthis.blurPackedVsmShader[blurMode][filterSize] = blurShader;\n\t\t\t} else {\n\t\t\t\tthis.blurVsmShader[blurMode][filterSize] = blurShader;\n\t\t\t}\n\t\t}\n\t\treturn blurShader;\n\t}\n\tapplyVsmBlur(light, camera) {\n\t\tconst device = this.device;\n\t\tdevice.setBlendState(BlendState.NOBLEND);\n\t\tconst lightRenderData = light.getRenderData(light._type === LIGHTTYPE_DIRECTIONAL ? camera : null, 0);\n\t\tconst shadowCam = lightRenderData.shadowCamera;\n\t\tconst origShadowMap = shadowCam.renderTarget;\n\t\tconst tempShadowMap = this.renderer.shadowMapCache.get(device, light);\n\t\tconst tempRt = tempShadowMap.renderTargets[0];\n\t\tconst isVsm8 = light._shadowType === SHADOW_VSM8;\n\t\tconst blurMode = light.vsmBlurMode;\n\t\tconst filterSize = light._vsmBlurSize;\n\t\tconst blurShader = this.getVsmBlurShader(isVsm8, blurMode, filterSize);\n\t\tblurScissorRect.z = light._shadowResolution - 2;\n\t\tblurScissorRect.w = blurScissorRect.z;\n\t\tthis.sourceId.setValue(origShadowMap.colorBuffer);\n\t\tpixelOffset[0] = 1 / light._shadowResolution;\n\t\tpixelOffset[1] = 0;\n\t\tthis.pixelOffsetId.setValue(pixelOffset);\n\t\tif (blurMode === BLUR_GAUSSIAN) this.weightId.setValue(this.blurVsmWeights[filterSize]);\n\t\tdrawQuadWithShader(device, tempRt, blurShader, null, blurScissorRect);\n\t\tthis.sourceId.setValue(tempRt.colorBuffer);\n\t\tpixelOffset[1] = pixelOffset[0];\n\t\tpixelOffset[0] = 0;\n\t\tthis.pixelOffsetId.setValue(pixelOffset);\n\t\tdrawQuadWithShader(device, origShadowMap, blurShader, null, blurScissorRect);\n\t\tthis.renderer.shadowMapCache.add(light, tempShadowMap);\n\t}\n\tinitViewBindGroupFormat() {\n\t\tif (this.device.supportsUniformBuffers && !this.viewUniformFormat) {\n\t\t\tthis.viewUniformFormat = new UniformBufferFormat(this.device, [new UniformFormat(\"matrix_viewProjection\", UNIFORMTYPE_MAT4)]);\n\t\t\tthis.viewBindGroupFormat = new BindGroupFormat(this.device, [new BindBufferFormat(UNIFORM_BUFFER_DEFAULT_SLOT_NAME, SHADERSTAGE_VERTEX | SHADERSTAGE_FRAGMENT)], []);\n\t\t}\n\t}\n\tframeUpdate() {\n\t\tthis.initViewBindGroupFormat();\n\t}\n}\n\nexport { ShadowRenderer };\n","import '../../core/tracing.js';\nimport { WorldClusters } from '../lighting/world-clusters.js';\n\nconst tempClusterArray = [];\nclass WorldClustersAllocator {\n\tconstructor(graphicsDevice) {\n\t\tthis._empty = null;\n\t\tthis._allocated = [];\n\t\tthis._clusters = new Map();\n\t\tthis.device = graphicsDevice;\n\t}\n\tdestroy() {\n\t\tif (this._empty) {\n\t\t\tthis._empty.destroy();\n\t\t\tthis._empty = null;\n\t\t}\n\t\tthis._allocated.forEach(cluster => {\n\t\t\tcluster.destroy();\n\t\t});\n\t\tthis._allocated.length = 0;\n\t}\n\tget count() {\n\t\treturn this._allocated.length;\n\t}\n\tget empty() {\n\t\tif (!this._empty) {\n\t\t\tconst empty = new WorldClusters(this.device);\n\t\t\tempty.name = 'ClusterEmpty';\n\t\t\tempty.update([], false, null);\n\t\t\tthis._empty = empty;\n\t\t}\n\t\treturn this._empty;\n\t}\n\tassign(renderPasses) {\n\t\tconst empty = this.empty;\n\t\ttempClusterArray.push(...this._allocated);\n\t\tthis._allocated.length = 0;\n\t\tthis._clusters.clear();\n\t\tconst passCount = renderPasses.length;\n\t\tfor (let p = 0; p < passCount; p++) {\n\t\t\tconst renderPass = renderPasses[p];\n\t\t\tconst renderActions = renderPass.renderActions;\n\t\t\tif (renderActions) {\n\t\t\t\tconst count = renderActions.length;\n\t\t\t\tfor (let i = 0; i < count; i++) {\n\t\t\t\t\tconst ra = renderActions[i];\n\t\t\t\t\tra.lightClusters = null;\n\t\t\t\t\tconst layer = ra.layer;\n\t\t\t\t\tif (layer.hasClusteredLights && layer.meshInstances.length) {\n\t\t\t\t\t\tconst hash = layer.getLightIdHash();\n\t\t\t\t\t\tconst existingRenderAction = this._clusters.get(hash);\n\t\t\t\t\t\tlet clusters = existingRenderAction == null ? void 0 : existingRenderAction.lightClusters;\n\t\t\t\t\t\tif (!clusters) {\n\t\t\t\t\t\t\tvar _tempClusterArray$pop;\n\t\t\t\t\t\t\tclusters = (_tempClusterArray$pop = tempClusterArray.pop()) != null ? _tempClusterArray$pop : new WorldClusters(this.device);\n\t\t\t\t\t\t\tthis._allocated.push(clusters);\n\t\t\t\t\t\t\tthis._clusters.set(hash, ra);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tra.lightClusters = clusters;\n\t\t\t\t\t}\n\t\t\t\t\tif (!ra.lightClusters) {\n\t\t\t\t\t\tra.lightClusters = empty;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\ttempClusterArray.forEach(item => item.destroy());\n\t\ttempClusterArray.length = 0;\n\t}\n\tupdate(renderPasses, gammaCorrection, lighting) {\n\t\tthis.assign(renderPasses);\n\t\tthis._clusters.forEach(renderAction => {\n\t\t\tconst layer = renderAction.layer;\n\t\t\tconst cluster = renderAction.lightClusters;\n\t\t\tcluster.update(layer.clusteredLightsSet, gammaCorrection, lighting);\n\t\t});\n\t}\n}\n\nexport { WorldClustersAllocator };\n","import '../../core/tracing.js';\nimport { Vec4 } from '../../core/math/vec4.js';\nimport { Mat4 } from '../../core/math/mat4.js';\nimport { CULLFACE_NONE } from '../../platform/graphics/constants.js';\nimport { LIGHTTYPE_DIRECTIONAL, LIGHTTYPE_OMNI } from '../constants.js';\nimport { createShaderFromCode } from '../shader-lib/utils.js';\nimport { LightCamera } from './light-camera.js';\nimport { BlendState } from '../../platform/graphics/blend-state.js';\nimport { QuadRender } from '../graphics/quad-render.js';\nimport { DepthState } from '../../platform/graphics/depth-state.js';\nimport { RenderPass } from '../../platform/graphics/render-pass.js';\n\nconst textureBlitVertexShader = `\n\tattribute vec2 vertex_position;\n\tvarying vec2 uv0;\n\tvoid main(void) {\n\t\tgl_Position = vec4(vertex_position, 0.5, 1.0);\n\t\tuv0 = vertex_position.xy * 0.5 + 0.5;\n\t\t#ifndef WEBGPU\n\t\t\tuv0.y = 1.0 - uv0.y;\n\t\t#endif\n\t}`;\nconst textureBlitFragmentShader = `\n\tvarying vec2 uv0;\n\tuniform sampler2D blitTexture;\n\tvoid main(void) {\n\t\tgl_FragColor = texture2D(blitTexture, uv0);\n\t}`;\nconst textureCubeBlitFragmentShader = `\n\tvarying vec2 uv0;\n\tuniform samplerCube blitTexture;\n\tuniform mat4 invViewProj;\n\tvoid main(void) {\n\t\tvec4 projPos = vec4(uv0 * 2.0 - 1.0, 0.5, 1.0);\n\t\tvec4 worldPos = invViewProj * projPos;\n\t\tgl_FragColor = textureCube(blitTexture, worldPos.xyz);\n\t}`;\nconst _viewport = new Vec4();\nconst _invViewProjMatrices = [];\nclass RenderPassCookieRenderer extends RenderPass {\n\tconstructor(device, cubeSlotsOffsets) {\n\t\tsuper(device);\n\t\tthis._quadRenderer2D = null;\n\t\tthis._quadRendererCube = null;\n\t\tthis._filteredLights = [];\n\t\tthis._cubeSlotsOffsets = cubeSlotsOffsets;\n\t\tthis.requiresCubemaps = false;\n\t\tthis.blitTextureId = device.scope.resolve('blitTexture');\n\t\tthis.invViewProjId = device.scope.resolve('invViewProj');\n\t}\n\tdestroy() {\n\t\tvar _this$_quadRenderer2D, _this$_quadRendererCu;\n\t\t(_this$_quadRenderer2D = this._quadRenderer2D) == null || _this$_quadRenderer2D.destroy();\n\t\tthis._quadRenderer2D = null;\n\t\t(_this$_quadRendererCu = this._quadRendererCube) == null || _this$_quadRendererCu.destroy();\n\t\tthis._quadRendererCube = null;\n\t}\n\tstatic create(renderTarget, cubeSlotsOffsets) {\n\t\tconst renderPass = new RenderPassCookieRenderer(renderTarget.device, cubeSlotsOffsets);\n\t\trenderPass.init(renderTarget);\n\t\trenderPass.colorOps.clear = false;\n\t\trenderPass.depthStencilOps.clearDepth = false;\n\t\treturn renderPass;\n\t}\n\tupdate(lights) {\n\t\tconst filteredLights = this._filteredLights;\n\t\tthis.filter(lights, filteredLights);\n\t\tthis.executeEnabled = filteredLights.length > 0;\n\t}\n\tfilter(lights, filteredLights) {\n\t\tfor (let i = 0; i < lights.length; i++) {\n\t\t\tconst light = lights[i];\n\t\t\tif (light._type === LIGHTTYPE_DIRECTIONAL) continue;\n\t\t\tif (!light.atlasViewportAllocated) continue;\n\t\t\tif (!light.atlasSlotUpdated) continue;\n\t\t\tif (light.enabled && light.cookie && light.visibleThisFrame) {\n\t\t\t\tfilteredLights.push(light);\n\t\t\t}\n\t\t}\n\t}\n\tinitInvViewProjMatrices() {\n\t\tif (!_invViewProjMatrices.length) {\n\t\t\tfor (let face = 0; face < 6; face++) {\n\t\t\t\tconst camera = LightCamera.create(null, LIGHTTYPE_OMNI, face);\n\t\t\t\tconst projMat = camera.projectionMatrix;\n\t\t\t\tconst viewMat = camera.node.getLocalTransform().clone().invert();\n\t\t\t\t_invViewProjMatrices[face] = new Mat4().mul2(projMat, viewMat).invert();\n\t\t\t}\n\t\t}\n\t}\n\tget quadRenderer2D() {\n\t\tif (!this._quadRenderer2D) {\n\t\t\tconst shader = createShaderFromCode(this.device, textureBlitVertexShader, textureBlitFragmentShader, `cookieRenderer2d`);\n\t\t\tthis._quadRenderer2D = new QuadRender(shader);\n\t\t}\n\t\treturn this._quadRenderer2D;\n\t}\n\tget quadRendererCube() {\n\t\tif (!this._quadRendererCube) {\n\t\t\tconst shader = createShaderFromCode(this.device, textureBlitVertexShader, textureCubeBlitFragmentShader, `cookieRendererCube`);\n\t\t\tthis._quadRendererCube = new QuadRender(shader);\n\t\t}\n\t\treturn this._quadRendererCube;\n\t}\n\texecute() {\n\t\tconst device = this.device;\n\t\tdevice.setBlendState(BlendState.NOBLEND);\n\t\tdevice.setCullMode(CULLFACE_NONE);\n\t\tdevice.setDepthState(DepthState.NODEPTH);\n\t\tdevice.setStencilState();\n\t\tconst renderTargetWidth = this.renderTarget.colorBuffer.width;\n\t\tconst cubeSlotsOffsets = this._cubeSlotsOffsets;\n\t\tconst filteredLights = this._filteredLights;\n\t\tfor (let i = 0; i < filteredLights.length; i++) {\n\t\t\tconst light = filteredLights[i];\n\t\t\tconst faceCount = light.numShadowFaces;\n\t\t\tconst quad = faceCount > 1 ? this.quadRendererCube : this.quadRenderer2D;\n\t\t\tif (faceCount > 1) {\n\t\t\t\tthis.initInvViewProjMatrices();\n\t\t\t}\n\t\t\tthis.blitTextureId.setValue(light.cookie);\n\t\t\tfor (let face = 0; face < faceCount; face++) {\n\t\t\t\t_viewport.copy(light.atlasViewport);\n\t\t\t\tif (faceCount > 1) {\n\t\t\t\t\tconst smallSize = _viewport.z / 3;\n\t\t\t\t\tconst offset = cubeSlotsOffsets[face];\n\t\t\t\t\t_viewport.x += smallSize * offset.x;\n\t\t\t\t\t_viewport.y += smallSize * offset.y;\n\t\t\t\t\t_viewport.z = smallSize;\n\t\t\t\t\t_viewport.w = smallSize;\n\t\t\t\t\tthis.invViewProjId.setValue(_invViewProjMatrices[face].data);\n\t\t\t\t}\n\t\t\t\t_viewport.mulScalar(renderTargetWidth);\n\t\t\t\tquad.render(_viewport);\n\t\t\t}\n\t\t}\n\t\tfilteredLights.length = 0;\n\t}\n}\n\nexport { RenderPassCookieRenderer };\n","import { RenderPass } from '../../platform/graphics/render-pass.js';\n\nclass RenderPassShadowLocalClustered extends RenderPass {\n\tconstructor(device, shadowRenderer, shadowRendererLocal) {\n\t\tsuper(device);\n\t\tthis.requiresCubemaps = false;\n\t\tthis.shadowRenderer = shadowRenderer;\n\t\tthis.shadowRendererLocal = shadowRendererLocal;\n\t}\n\tupdate(localLights) {\n\t\tconst shadowLights = this.shadowRendererLocal.shadowLights;\n\t\tconst shadowCamera = this.shadowRendererLocal.prepareLights(shadowLights, localLights);\n\t\tconst count = shadowLights.length;\n\t\tthis.enabled = count > 0;\n\t\tif (count) {\n\t\t\tthis.shadowRenderer.setupRenderPass(this, shadowCamera, false);\n\t\t}\n\t}\n\texecute() {\n\t\tconst shadowLights = this.shadowRendererLocal.shadowLights;\n\t\tconst count = shadowLights.length;\n\t\tfor (let i = 0; i < count; i++) {\n\t\t\tconst light = shadowLights[i];\n\t\t\tfor (let face = 0; face < light.numShadowFaces; face++) {\n\t\t\t\tthis.shadowRenderer.renderFace(light, null, face, true);\n\t\t\t}\n\t\t}\n\t\tshadowLights.length = 0;\n\t}\n}\n\nexport { RenderPassShadowLocalClustered };\n","import '../../core/time.js';\nimport { RenderPass } from '../../platform/graphics/render-pass.js';\nimport { RenderPassCookieRenderer } from './render-pass-cookie-renderer.js';\nimport { RenderPassShadowLocalClustered } from './render-pass-shadow-local-clustered.js';\n\nclass RenderPassUpdateClustered extends RenderPass {\n\tconstructor(device, renderer, shadowRenderer, shadowRendererLocal, lightTextureAtlas) {\n\t\tsuper(device);\n\t\tthis.renderer = renderer;\n\t\tthis.frameGraph = null;\n\t\tthis.cookiesRenderPass = RenderPassCookieRenderer.create(lightTextureAtlas.cookieRenderTarget, lightTextureAtlas.cubeSlotsOffsets);\n\t\tthis.beforePasses.push(this.cookiesRenderPass);\n\t\tthis.shadowRenderPass = new RenderPassShadowLocalClustered(device, shadowRenderer, shadowRendererLocal);\n\t\tthis.beforePasses.push(this.shadowRenderPass);\n\t}\n\tupdate(frameGraph, shadowsEnabled, cookiesEnabled, lights, localLights) {\n\t\tthis.frameGraph = frameGraph;\n\t\tthis.cookiesRenderPass.enabled = cookiesEnabled;\n\t\tif (cookiesEnabled) {\n\t\t\tthis.cookiesRenderPass.update(lights);\n\t\t}\n\t\tthis.shadowRenderPass.enabled = shadowsEnabled;\n\t\tif (shadowsEnabled) {\n\t\t\tthis.shadowRenderPass.update(localLights);\n\t\t}\n\t}\n\tdestroy() {\n\t\tthis.cookiesRenderPass.destroy();\n\t\tthis.cookiesRenderPass = null;\n\t}\n\texecute() {\n\t\tconst {\n\t\t\trenderer\n\t\t} = this;\n\t\tconst {\n\t\t\tscene\n\t\t} = renderer;\n\t\trenderer.worldClustersAllocator.update(this.frameGraph.renderPasses, scene.gammaCorrection, scene.lighting);\n\t}\n}\n\nexport { RenderPassUpdateClustered };\n","import '../../core/tracing.js';\nimport '../../core/time.js';\nimport { Vec3 } from '../../core/math/vec3.js';\nimport { Mat3 } from '../../core/math/mat3.js';\nimport { Mat4 } from '../../core/math/mat4.js';\nimport { BoundingSphere } from '../../core/shape/bounding-sphere.js';\nimport { SORTKEY_FORWARD, SORTKEY_DEPTH, VIEW_CENTER, PROJECTION_ORTHOGRAPHIC, LIGHTTYPE_DIRECTIONAL, SHADOWUPDATE_NONE, SHADOWUPDATE_THISFRAME } from '../constants.js';\nimport { LightTextureAtlas } from '../lighting/light-texture-atlas.js';\nimport { Material } from '../materials/material.js';\nimport { LightCube } from '../graphics/light-cube.js';\nimport { CLEARFLAG_COLOR, CLEARFLAG_DEPTH, CLEARFLAG_STENCIL, CULLFACE_FRONT, CULLFACE_BACK, CULLFACE_NONE, UNIFORMTYPE_MAT4, UNIFORMTYPE_MAT3, UNIFORMTYPE_VEC3, UNIFORMTYPE_FLOAT, UNIFORMTYPE_VEC2, UNIFORMTYPE_INT, BINDGROUP_VIEW, BINDGROUP_MESH, SEMANTIC_ATTR, UNIFORM_BUFFER_DEFAULT_SLOT_NAME, SHADERSTAGE_VERTEX, SHADERSTAGE_FRAGMENT, TEXTUREDIMENSION_2D, SAMPLETYPE_UNFILTERABLE_FLOAT, SAMPLETYPE_DEPTH, SAMPLETYPE_FLOAT } from '../../platform/graphics/constants.js';\nimport { UniformBuffer } from '../../platform/graphics/uniform-buffer.js';\nimport { BindGroup } from '../../platform/graphics/bind-group.js';\nimport { UniformFormat, UniformBufferFormat } from '../../platform/graphics/uniform-buffer-format.js';\nimport { BindGroupFormat, BindBufferFormat, BindTextureFormat } from '../../platform/graphics/bind-group-format.js';\nimport { ShadowMapCache } from './shadow-map-cache.js';\nimport { ShadowRendererLocal } from './shadow-renderer-local.js';\nimport { ShadowRendererDirectional } from './shadow-renderer-directional.js';\nimport { ShadowRenderer } from './shadow-renderer.js';\nimport { WorldClustersAllocator } from './world-clusters-allocator.js';\nimport { RenderPassUpdateClustered } from './render-pass-update-clustered.js';\n\nlet _skinUpdateIndex = 0;\nconst boneTextureSize = [0, 0, 0, 0];\nconst viewProjMat = new Mat4();\nconst viewInvMat = new Mat4();\nconst viewMat = new Mat4();\nconst viewMat3 = new Mat3();\nconst tempSphere = new BoundingSphere();\nconst _flipYMat = new Mat4().setScale(1, -1, 1);\nconst _tempLightSet = new Set();\nconst _tempLayerSet = new Set();\nconst _fixProjRangeMat = new Mat4().set([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0.5, 0, 0, 0, 0.5, 1]);\nconst _tempProjMat0 = new Mat4();\nconst _tempProjMat1 = new Mat4();\nconst _tempProjMat2 = new Mat4();\nconst _tempProjMat3 = new Mat4();\nconst _tempSet = new Set();\nconst _tempMeshInstances = [];\nconst _tempMeshInstancesSkinned = [];\nclass Renderer {\n\tconstructor(graphicsDevice) {\n\t\tthis.clustersDebugRendered = false;\n\t\tthis.processingMeshInstances = new Set();\n\t\tthis.worldClustersAllocator = void 0;\n\t\tthis.lights = [];\n\t\tthis.localLights = [];\n\t\tthis.device = graphicsDevice;\n\t\tthis.scene = null;\n\t\tthis.worldClustersAllocator = new WorldClustersAllocator(graphicsDevice);\n\t\tthis.lightTextureAtlas = new LightTextureAtlas(graphicsDevice);\n\t\tthis.shadowMapCache = new ShadowMapCache();\n\t\tthis.shadowRenderer = new ShadowRenderer(this, this.lightTextureAtlas);\n\t\tthis._shadowRendererLocal = new ShadowRendererLocal(this, this.shadowRenderer);\n\t\tthis._shadowRendererDirectional = new ShadowRendererDirectional(this, this.shadowRenderer);\n\t\tthis._renderPassUpdateClustered = new RenderPassUpdateClustered(this.device, this, this.shadowRenderer, this._shadowRendererLocal, this.lightTextureAtlas);\n\t\tthis.viewUniformFormat = null;\n\t\tthis.viewBindGroupFormat = null;\n\t\tthis._skinTime = 0;\n\t\tthis._morphTime = 0;\n\t\tthis._cullTime = 0;\n\t\tthis._shadowMapTime = 0;\n\t\tthis._lightClustersTime = 0;\n\t\tthis._layerCompositionUpdateTime = 0;\n\t\tthis._shadowDrawCalls = 0;\n\t\tthis._skinDrawCalls = 0;\n\t\tthis._instancedDrawCalls = 0;\n\t\tthis._shadowMapUpdates = 0;\n\t\tthis._numDrawCallsCulled = 0;\n\t\tthis._camerasRendered = 0;\n\t\tthis._lightClusters = 0;\n\t\tconst scope = graphicsDevice.scope;\n\t\tthis.boneTextureId = scope.resolve('texture_poseMap');\n\t\tthis.boneTextureSizeId = scope.resolve('texture_poseMapSize');\n\t\tthis.poseMatrixId = scope.resolve('matrix_pose[0]');\n\t\tthis.modelMatrixId = scope.resolve('matrix_model');\n\t\tthis.normalMatrixId = scope.resolve('matrix_normal');\n\t\tthis.viewInvId = scope.resolve('matrix_viewInverse');\n\t\tthis.viewPos = new Float32Array(3);\n\t\tthis.viewPosId = scope.resolve('view_position');\n\t\tthis.projId = scope.resolve('matrix_projection');\n\t\tthis.projSkyboxId = scope.resolve('matrix_projectionSkybox');\n\t\tthis.viewId = scope.resolve('matrix_view');\n\t\tthis.viewId3 = scope.resolve('matrix_view3');\n\t\tthis.viewProjId = scope.resolve('matrix_viewProjection');\n\t\tthis.flipYId = scope.resolve('projectionFlipY');\n\t\tthis.tbnBasis = scope.resolve('tbnBasis');\n\t\tthis.nearClipId = scope.resolve('camera_near');\n\t\tthis.farClipId = scope.resolve('camera_far');\n\t\tthis.cameraParams = new Float32Array(4);\n\t\tthis.cameraParamsId = scope.resolve('camera_params');\n\t\tthis.alphaTestId = scope.resolve('alpha_ref');\n\t\tthis.opacityMapId = scope.resolve('texture_opacityMap');\n\t\tthis.exposureId = scope.resolve('exposure');\n\t\tthis.twoSidedLightingNegScaleFactorId = scope.resolve('twoSidedLightingNegScaleFactor');\n\t\tthis.twoSidedLightingNegScaleFactorId.setValue(0);\n\t\tthis.morphWeightsA = scope.resolve('morph_weights_a');\n\t\tthis.morphWeightsB = scope.resolve('morph_weights_b');\n\t\tthis.morphPositionTex = scope.resolve('morphPositionTex');\n\t\tthis.morphNormalTex = scope.resolve('morphNormalTex');\n\t\tthis.morphTexParams = scope.resolve('morph_tex_params');\n\t\tthis.lightCube = new LightCube();\n\t\tthis.constantLightCube = scope.resolve('lightCube[0]');\n\t}\n\tdestroy() {\n\t\tthis.shadowRenderer = null;\n\t\tthis._shadowRendererLocal = null;\n\t\tthis._shadowRendererDirectional = null;\n\t\tthis.shadowMapCache.destroy();\n\t\tthis.shadowMapCache = null;\n\t\tthis._renderPassUpdateClustered.destroy();\n\t\tthis._renderPassUpdateClustered = null;\n\t\tthis.lightTextureAtlas.destroy();\n\t\tthis.lightTextureAtlas = null;\n\t}\n\tsortCompare(drawCallA, drawCallB) {\n\t\tif (drawCallA.layer === drawCallB.layer) {\n\t\t\tif (drawCallA.drawOrder && drawCallB.drawOrder) {\n\t\t\t\treturn drawCallA.drawOrder - drawCallB.drawOrder;\n\t\t\t} else if (drawCallA.zdist && drawCallB.zdist) {\n\t\t\t\treturn drawCallB.zdist - drawCallA.zdist;\n\t\t\t} else if (drawCallA.zdist2 && drawCallB.zdist2) {\n\t\t\t\treturn drawCallA.zdist2 - drawCallB.zdist2;\n\t\t\t}\n\t\t}\n\t\treturn drawCallB._key[SORTKEY_FORWARD] - drawCallA._key[SORTKEY_FORWARD];\n\t}\n\tsortCompareMesh(drawCallA, drawCallB) {\n\t\tif (drawCallA.layer === drawCallB.layer) {\n\t\t\tif (drawCallA.drawOrder && drawCallB.drawOrder) {\n\t\t\t\treturn drawCallA.drawOrder - drawCallB.drawOrder;\n\t\t\t} else if (drawCallA.zdist && drawCallB.zdist) {\n\t\t\t\treturn drawCallB.zdist - drawCallA.zdist;\n\t\t\t}\n\t\t}\n\t\tconst keyA = drawCallA._key[SORTKEY_FORWARD];\n\t\tconst keyB = drawCallB._key[SORTKEY_FORWARD];\n\t\tif (keyA === keyB && drawCallA.mesh && drawCallB.mesh) {\n\t\t\treturn drawCallB.mesh.id - drawCallA.mesh.id;\n\t\t}\n\t\treturn keyB - keyA;\n\t}\n\tsortCompareDepth(drawCallA, drawCallB) {\n\t\tconst keyA = drawCallA._key[SORTKEY_DEPTH];\n\t\tconst keyB = drawCallB._key[SORTKEY_DEPTH];\n\t\tif (keyA === keyB && drawCallA.mesh && drawCallB.mesh) {\n\t\t\treturn drawCallB.mesh.id - drawCallA.mesh.id;\n\t\t}\n\t\treturn keyB - keyA;\n\t}\n\tsetupViewport(camera, renderTarget) {\n\t\tconst device = this.device;\n\t\tconst pixelWidth = renderTarget ? renderTarget.width : device.width;\n\t\tconst pixelHeight = renderTarget ? renderTarget.height : device.height;\n\t\tconst rect = camera.rect;\n\t\tlet x = Math.floor(rect.x * pixelWidth);\n\t\tlet y = Math.floor(rect.y * pixelHeight);\n\t\tlet w = Math.floor(rect.z * pixelWidth);\n\t\tlet h = Math.floor(rect.w * pixelHeight);\n\t\tdevice.setViewport(x, y, w, h);\n\t\tif (camera._scissorRectClear) {\n\t\t\tconst scissorRect = camera.scissorRect;\n\t\t\tx = Math.floor(scissorRect.x * pixelWidth);\n\t\t\ty = Math.floor(scissorRect.y * pixelHeight);\n\t\t\tw = Math.floor(scissorRect.z * pixelWidth);\n\t\t\th = Math.floor(scissorRect.w * pixelHeight);\n\t\t}\n\t\tdevice.setScissor(x, y, w, h);\n\t}\n\tsetCameraUniforms(camera, target) {\n\t\tconst flipY = target == null ? void 0 : target.flipY;\n\t\tlet viewCount = 1;\n\t\tif (camera.xr && camera.xr.session) {\n\t\t\tlet transform;\n\t\t\tconst parent = camera._node.parent;\n\t\t\tif (parent) transform = parent.getWorldTransform();\n\t\t\tconst views = camera.xr.views;\n\t\t\tviewCount = views.length;\n\t\t\tfor (let v = 0; v < viewCount; v++) {\n\t\t\t\tconst view = views[v];\n\t\t\t\tif (parent) {\n\t\t\t\t\tview.viewInvOffMat.mul2(transform, view.viewInvMat);\n\t\t\t\t\tview.viewOffMat.copy(view.viewInvOffMat).invert();\n\t\t\t\t} else {\n\t\t\t\t\tview.viewInvOffMat.copy(view.viewInvMat);\n\t\t\t\t\tview.viewOffMat.copy(view.viewMat);\n\t\t\t\t}\n\t\t\t\tview.viewMat3.setFromMat4(view.viewOffMat);\n\t\t\t\tview.projViewOffMat.mul2(view.projMat, view.viewOffMat);\n\t\t\t\tview.position[0] = view.viewInvOffMat.data[12];\n\t\t\t\tview.position[1] = view.viewInvOffMat.data[13];\n\t\t\t\tview.position[2] = view.viewInvOffMat.data[14];\n\t\t\t\tcamera.frustum.setFromMat4(view.projViewOffMat);\n\t\t\t}\n\t\t} else {\n\t\t\tlet projMat = camera.projectionMatrix;\n\t\t\tif (camera.calculateProjection) {\n\t\t\t\tcamera.calculateProjection(projMat, VIEW_CENTER);\n\t\t\t}\n\t\t\tlet projMatSkybox = camera.getProjectionMatrixSkybox();\n\t\t\tif (flipY) {\n\t\t\t\tprojMat = _tempProjMat0.mul2(_flipYMat, projMat);\n\t\t\t\tprojMatSkybox = _tempProjMat1.mul2(_flipYMat, projMatSkybox);\n\t\t\t}\n\t\t\tif (this.device.isWebGPU) {\n\t\t\t\tprojMat = _tempProjMat2.mul2(_fixProjRangeMat, projMat);\n\t\t\t\tprojMatSkybox = _tempProjMat3.mul2(_fixProjRangeMat, projMatSkybox);\n\t\t\t}\n\t\t\tthis.projId.setValue(projMat.data);\n\t\t\tthis.projSkyboxId.setValue(projMatSkybox.data);\n\t\t\tif (camera.calculateTransform) {\n\t\t\t\tcamera.calculateTransform(viewInvMat, VIEW_CENTER);\n\t\t\t} else {\n\t\t\t\tconst pos = camera._node.getPosition();\n\t\t\t\tconst rot = camera._node.getRotation();\n\t\t\t\tviewInvMat.setTRS(pos, rot, Vec3.ONE);\n\t\t\t}\n\t\t\tthis.viewInvId.setValue(viewInvMat.data);\n\t\t\tviewMat.copy(viewInvMat).invert();\n\t\t\tthis.viewId.setValue(viewMat.data);\n\t\t\tviewMat3.setFromMat4(viewMat);\n\t\t\tthis.viewId3.setValue(viewMat3.data);\n\t\t\tviewProjMat.mul2(projMat, viewMat);\n\t\t\tthis.viewProjId.setValue(viewProjMat.data);\n\t\t\tthis.flipYId.setValue(flipY ? -1 : 1);\n\t\t\tthis.dispatchViewPos(camera._node.getPosition());\n\t\t\tcamera.frustum.setFromMat4(viewProjMat);\n\t\t}\n\t\tthis.tbnBasis.setValue(flipY ? -1 : 1);\n\t\tconst n = camera._nearClip;\n\t\tconst f = camera._farClip;\n\t\tthis.nearClipId.setValue(n);\n\t\tthis.farClipId.setValue(f);\n\t\tthis.cameraParams[0] = 1 / f;\n\t\tthis.cameraParams[1] = f;\n\t\tthis.cameraParams[2] = n;\n\t\tthis.cameraParams[3] = camera.projection === PROJECTION_ORTHOGRAPHIC ? 1 : 0;\n\t\tthis.cameraParamsId.setValue(this.cameraParams);\n\t\tthis.exposureId.setValue(this.scene.physicalUnits ? camera.getExposure() : this.scene.exposure);\n\t\treturn viewCount;\n\t}\n\tclear(camera, clearColor, clearDepth, clearStencil) {\n\t\tconst flags = ((clearColor != null ? clearColor : camera._clearColorBuffer) ? CLEARFLAG_COLOR : 0) | ((clearDepth != null ? clearDepth : camera._clearDepthBuffer) ? CLEARFLAG_DEPTH : 0) | ((clearStencil != null ? clearStencil : camera._clearStencilBuffer) ? CLEARFLAG_STENCIL : 0);\n\t\tif (flags) {\n\t\t\tconst device = this.device;\n\t\t\tdevice.clear({\n\t\t\t\tcolor: [camera._clearColor.r, camera._clearColor.g, camera._clearColor.b, camera._clearColor.a],\n\t\t\t\tdepth: camera._clearDepth,\n\t\t\t\tstencil: camera._clearStencil,\n\t\t\t\tflags: flags\n\t\t\t});\n\t\t}\n\t}\n\tsetCamera(camera, target, clear, renderAction = null) {\n\t\tthis.setCameraUniforms(camera, target);\n\t\tthis.clearView(camera, target, clear, false);\n\t}\n\tclearView(camera, target, clear, forceWrite) {\n\t\tconst device = this.device;\n\t\tdevice.setRenderTarget(target);\n\t\tdevice.updateBegin();\n\t\tif (forceWrite) {\n\t\t\tdevice.setColorWrite(true, true, true, true);\n\t\t\tdevice.setDepthWrite(true);\n\t\t}\n\t\tthis.setupViewport(camera, target);\n\t\tif (clear) {\n\t\t\tconst options = camera._clearOptions;\n\t\t\tdevice.clear(options ? options : {\n\t\t\t\tcolor: [camera._clearColor.r, camera._clearColor.g, camera._clearColor.b, camera._clearColor.a],\n\t\t\t\tdepth: camera._clearDepth,\n\t\t\t\tflags: (camera._clearColorBuffer ? CLEARFLAG_COLOR : 0) | (camera._clearDepthBuffer ? CLEARFLAG_DEPTH : 0) | (camera._clearStencilBuffer ? CLEARFLAG_STENCIL : 0),\n\t\t\t\tstencil: camera._clearStencil\n\t\t\t});\n\t\t}\n\t}\n\tsetupCullMode(cullFaces, flipFactor, drawCall) {\n\t\tconst material = drawCall.material;\n\t\tlet mode = CULLFACE_NONE;\n\t\tif (cullFaces) {\n\t\t\tlet flipFaces = 1;\n\t\t\tif (material.cull === CULLFACE_FRONT || material.cull === CULLFACE_BACK) {\n\t\t\t\tflipFaces = flipFactor * drawCall.flipFacesFactor * drawCall.node.worldScaleSign;\n\t\t\t}\n\t\t\tif (flipFaces < 0) {\n\t\t\t\tmode = material.cull === CULLFACE_FRONT ? CULLFACE_BACK : CULLFACE_FRONT;\n\t\t\t} else {\n\t\t\t\tmode = material.cull;\n\t\t\t}\n\t\t}\n\t\tthis.device.setCullMode(mode);\n\t\tif (mode === CULLFACE_NONE && material.cull === CULLFACE_NONE) {\n\t\t\tthis.twoSidedLightingNegScaleFactorId.setValue(drawCall.node.worldScaleSign);\n\t\t}\n\t}\n\tupdateCameraFrustum(camera) {\n\t\tif (camera.xr && camera.xr.views.length) {\n\t\t\tconst view = camera.xr.views[0];\n\t\t\tviewProjMat.mul2(view.projMat, view.viewOffMat);\n\t\t\tcamera.frustum.setFromMat4(viewProjMat);\n\t\t\treturn;\n\t\t}\n\t\tconst projMat = camera.projectionMatrix;\n\t\tif (camera.calculateProjection) {\n\t\t\tcamera.calculateProjection(projMat, VIEW_CENTER);\n\t\t}\n\t\tif (camera.calculateTransform) {\n\t\t\tcamera.calculateTransform(viewInvMat, VIEW_CENTER);\n\t\t} else {\n\t\t\tconst pos = camera._node.getPosition();\n\t\t\tconst rot = camera._node.getRotation();\n\t\t\tviewInvMat.setTRS(pos, rot, Vec3.ONE);\n\t\t\tthis.viewInvId.setValue(viewInvMat.data);\n\t\t}\n\t\tviewMat.copy(viewInvMat).invert();\n\t\tviewProjMat.mul2(projMat, viewMat);\n\t\tcamera.frustum.setFromMat4(viewProjMat);\n\t}\n\tsetBaseConstants(device, material) {\n\t\tdevice.setCullMode(material.cull);\n\t\tif (material.opacityMap) {\n\t\t\tthis.opacityMapId.setValue(material.opacityMap);\n\t\t}\n\t\tif (material.opacityMap || material.alphaTest > 0) {\n\t\t\tthis.alphaTestId.setValue(material.alphaTest);\n\t\t}\n\t}\n\tupdateCpuSkinMatrices(drawCalls) {\n\t\t_skinUpdateIndex++;\n\t\tconst drawCallsCount = drawCalls.length;\n\t\tif (drawCallsCount === 0) return;\n\t\tfor (let i = 0; i < drawCallsCount; i++) {\n\t\t\tconst si = drawCalls[i].skinInstance;\n\t\t\tif (si) {\n\t\t\t\tsi.updateMatrices(drawCalls[i].node, _skinUpdateIndex);\n\t\t\t\tsi._dirty = true;\n\t\t\t}\n\t\t}\n\t}\n\tupdateGpuSkinMatrices(drawCalls) {\n\t\tfor (const drawCall of drawCalls) {\n\t\t\tconst skin = drawCall.skinInstance;\n\t\t\tif (skin && skin._dirty) {\n\t\t\t\tskin.updateMatrixPalette(drawCall.node, _skinUpdateIndex);\n\t\t\t\tskin._dirty = false;\n\t\t\t}\n\t\t}\n\t}\n\tupdateMorphing(drawCalls) {\n\t\tfor (const drawCall of drawCalls) {\n\t\t\tconst morphInst = drawCall.morphInstance;\n\t\t\tif (morphInst && morphInst._dirty) {\n\t\t\t\tmorphInst.update();\n\t\t\t}\n\t\t}\n\t}\n\tgpuUpdate(drawCalls) {\n\t\tthis.updateGpuSkinMatrices(drawCalls);\n\t\tthis.updateMorphing(drawCalls);\n\t}\n\tsetVertexBuffers(device, mesh) {\n\t\tdevice.setVertexBuffer(mesh.vertexBuffer);\n\t}\n\tsetMorphing(device, morphInstance) {\n\t\tif (morphInstance) {\n\t\t\tif (morphInstance.morph.useTextureMorph) {\n\t\t\t\tdevice.setVertexBuffer(morphInstance.morph.vertexBufferIds);\n\t\t\t\tthis.morphPositionTex.setValue(morphInstance.texturePositions);\n\t\t\t\tthis.morphNormalTex.setValue(morphInstance.textureNormals);\n\t\t\t\tthis.morphTexParams.setValue(morphInstance._textureParams);\n\t\t\t} else {\n\t\t\t\tfor (let t = 0; t < morphInstance._activeVertexBuffers.length; t++) {\n\t\t\t\t\tconst vb = morphInstance._activeVertexBuffers[t];\n\t\t\t\t\tif (vb) {\n\t\t\t\t\t\tconst semantic = SEMANTIC_ATTR + (t + 8);\n\t\t\t\t\t\tvb.format.elements[0].name = semantic;\n\t\t\t\t\t\tvb.format.elements[0].scopeId = device.scope.resolve(semantic);\n\t\t\t\t\t\tvb.format.update();\n\t\t\t\t\t\tdevice.setVertexBuffer(vb);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.morphWeightsA.setValue(morphInstance._shaderMorphWeightsA);\n\t\t\t\tthis.morphWeightsB.setValue(morphInstance._shaderMorphWeightsB);\n\t\t\t}\n\t\t}\n\t}\n\tsetSkinning(device, meshInstance) {\n\t\tif (meshInstance.skinInstance) {\n\t\t\tthis._skinDrawCalls++;\n\t\t\tif (device.supportsBoneTextures) {\n\t\t\t\tconst boneTexture = meshInstance.skinInstance.boneTexture;\n\t\t\t\tthis.boneTextureId.setValue(boneTexture);\n\t\t\t\tboneTextureSize[0] = boneTexture.width;\n\t\t\t\tboneTextureSize[1] = boneTexture.height;\n\t\t\t\tboneTextureSize[2] = 1.0 / boneTexture.width;\n\t\t\t\tboneTextureSize[3] = 1.0 / boneTexture.height;\n\t\t\t\tthis.boneTextureSizeId.setValue(boneTextureSize);\n\t\t\t} else {\n\t\t\t\tthis.poseMatrixId.setValue(meshInstance.skinInstance.matrixPalette);\n\t\t\t}\n\t\t}\n\t}\n\tdispatchViewPos(position) {\n\t\tconst vp = this.viewPos;\n\t\tvp[0] = position.x;\n\t\tvp[1] = position.y;\n\t\tvp[2] = position.z;\n\t\tthis.viewPosId.setValue(vp);\n\t}\n\tinitViewBindGroupFormat(isClustered) {\n\t\tif (this.device.supportsUniformBuffers && !this.viewUniformFormat) {\n\t\t\tconst uniforms = [new UniformFormat(\"matrix_viewProjection\", UNIFORMTYPE_MAT4), new UniformFormat(\"cubeMapRotationMatrix\", UNIFORMTYPE_MAT3), new UniformFormat(\"view_position\", UNIFORMTYPE_VEC3), new UniformFormat(\"skyboxIntensity\", UNIFORMTYPE_FLOAT), new UniformFormat(\"exposure\", UNIFORMTYPE_FLOAT), new UniformFormat(\"textureBias\", UNIFORMTYPE_FLOAT)];\n\t\t\tif (isClustered) {\n\t\t\t\tuniforms.push(...[new UniformFormat(\"clusterCellsCountByBoundsSize\", UNIFORMTYPE_VEC3), new UniformFormat(\"clusterTextureSize\", UNIFORMTYPE_VEC3), new UniformFormat(\"clusterBoundsMin\", UNIFORMTYPE_VEC3), new UniformFormat(\"clusterBoundsDelta\", UNIFORMTYPE_VEC3), new UniformFormat(\"clusterCellsDot\", UNIFORMTYPE_VEC3), new UniformFormat(\"clusterCellsMax\", UNIFORMTYPE_VEC3), new UniformFormat(\"clusterCompressionLimit0\", UNIFORMTYPE_VEC2), new UniformFormat(\"shadowAtlasParams\", UNIFORMTYPE_VEC2), new UniformFormat(\"clusterMaxCells\", UNIFORMTYPE_INT), new UniformFormat(\"clusterSkip\", UNIFORMTYPE_FLOAT)]);\n\t\t\t}\n\t\t\tthis.viewUniformFormat = new UniformBufferFormat(this.device, uniforms);\n\t\t\tconst buffers = [new BindBufferFormat(UNIFORM_BUFFER_DEFAULT_SLOT_NAME, SHADERSTAGE_VERTEX | SHADERSTAGE_FRAGMENT)];\n\t\t\tconst textures = [new BindTextureFormat('lightsTextureFloat', SHADERSTAGE_FRAGMENT, TEXTUREDIMENSION_2D, SAMPLETYPE_UNFILTERABLE_FLOAT), new BindTextureFormat('lightsTexture8', SHADERSTAGE_FRAGMENT, TEXTUREDIMENSION_2D, SAMPLETYPE_UNFILTERABLE_FLOAT), new BindTextureFormat('shadowAtlasTexture', SHADERSTAGE_FRAGMENT, TEXTUREDIMENSION_2D, SAMPLETYPE_DEPTH), new BindTextureFormat('cookieAtlasTexture', SHADERSTAGE_FRAGMENT, TEXTUREDIMENSION_2D, SAMPLETYPE_FLOAT), new BindTextureFormat('areaLightsLutTex1', SHADERSTAGE_FRAGMENT, TEXTUREDIMENSION_2D, SAMPLETYPE_FLOAT), new BindTextureFormat('areaLightsLutTex2', SHADERSTAGE_FRAGMENT, TEXTUREDIMENSION_2D, SAMPLETYPE_FLOAT)];\n\t\t\tif (isClustered) {\n\t\t\t\ttextures.push(...[new BindTextureFormat('clusterWorldTexture', SHADERSTAGE_FRAGMENT, TEXTUREDIMENSION_2D, SAMPLETYPE_UNFILTERABLE_FLOAT)]);\n\t\t\t}\n\t\t\tthis.viewBindGroupFormat = new BindGroupFormat(this.device, buffers, textures);\n\t\t}\n\t}\n\tsetupViewUniformBuffers(viewBindGroups, viewUniformFormat, viewBindGroupFormat, viewCount) {\n\t\tconst device = this.device;\n\t\twhile (viewBindGroups.length < viewCount) {\n\t\t\tconst ub = new UniformBuffer(device, viewUniformFormat, false);\n\t\t\tconst bg = new BindGroup(device, viewBindGroupFormat, ub);\n\t\t\tviewBindGroups.push(bg);\n\t\t}\n\t\tconst viewBindGroup = viewBindGroups[0];\n\t\tviewBindGroup.defaultUniformBuffer.update();\n\t\tviewBindGroup.update();\n\t\tdevice.setBindGroup(BINDGROUP_VIEW, viewBindGroup);\n\t}\n\tsetupMeshUniformBuffers(shaderInstance, meshInstance) {\n\t\tconst device = this.device;\n\t\tif (device.supportsUniformBuffers) {\n\t\t\tthis.modelMatrixId.setValue(meshInstance.node.worldTransform.data);\n\t\t\tthis.normalMatrixId.setValue(meshInstance.node.normalMatrix.data);\n\t\t\tconst meshBindGroup = shaderInstance.getBindGroup(device);\n\t\t\tmeshBindGroup.defaultUniformBuffer.update();\n\t\t\tmeshBindGroup.update();\n\t\t\tdevice.setBindGroup(BINDGROUP_MESH, meshBindGroup);\n\t\t}\n\t}\n\tdrawInstance(device, meshInstance, mesh, style, normal) {\n\t\tconst modelMatrix = meshInstance.node.worldTransform;\n\t\tthis.modelMatrixId.setValue(modelMatrix.data);\n\t\tif (normal) {\n\t\t\tthis.normalMatrixId.setValue(meshInstance.node.normalMatrix.data);\n\t\t}\n\t\tconst instancingData = meshInstance.instancingData;\n\t\tif (instancingData) {\n\t\t\tif (instancingData.count > 0) {\n\t\t\t\tthis._instancedDrawCalls++;\n\t\t\t\tdevice.setVertexBuffer(instancingData.vertexBuffer);\n\t\t\t\tdevice.draw(mesh.primitive[style], instancingData.count);\n\t\t\t}\n\t\t} else {\n\t\t\tdevice.draw(mesh.primitive[style]);\n\t\t}\n\t}\n\tdrawInstance2(device, meshInstance, mesh, style) {\n\t\tconst instancingData = meshInstance.instancingData;\n\t\tif (instancingData) {\n\t\t\tif (instancingData.count > 0) {\n\t\t\t\tthis._instancedDrawCalls++;\n\t\t\t\tdevice.draw(mesh.primitive[style], instancingData.count, true);\n\t\t\t}\n\t\t} else {\n\t\t\tdevice.draw(mesh.primitive[style], undefined, true);\n\t\t}\n\t}\n\tcull(camera, drawCalls, culledInstances) {\n\t\tconst opaque = culledInstances.opaque;\n\t\topaque.length = 0;\n\t\tconst transparent = culledInstances.transparent;\n\t\ttransparent.length = 0;\n\t\tconst doCull = camera.frustumCulling;\n\t\tconst count = drawCalls.length;\n\t\tfor (let i = 0; i < count; i++) {\n\t\t\tconst drawCall = drawCalls[i];\n\t\t\tif (drawCall.visible) {\n\t\t\t\tconst visible = !doCull || !drawCall.cull || drawCall._isVisible(camera);\n\t\t\t\tif (visible) {\n\t\t\t\t\tdrawCall.visibleThisFrame = true;\n\t\t\t\t\tconst bucket = drawCall.transparent ? transparent : opaque;\n\t\t\t\t\tbucket.push(drawCall);\n\t\t\t\t\tif (drawCall.skinInstance || drawCall.morphInstance) this.processingMeshInstances.add(drawCall);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tcollectLights(comp) {\n\t\tthis.lights.length = 0;\n\t\tthis.localLights.length = 0;\n\t\tconst stats = this.scene._stats;\n\t\tconst count = comp.layerList.length;\n\t\tfor (let i = 0; i < count; i++) {\n\t\t\tconst layer = comp.layerList[i];\n\t\t\tif (!_tempLayerSet.has(layer)) {\n\t\t\t\t_tempLayerSet.add(layer);\n\t\t\t\tconst lights = layer._lights;\n\t\t\t\tfor (let j = 0; j < lights.length; j++) {\n\t\t\t\t\tconst light = lights[j];\n\t\t\t\t\tif (!_tempLightSet.has(light)) {\n\t\t\t\t\t\t_tempLightSet.add(light);\n\t\t\t\t\t\tthis.lights.push(light);\n\t\t\t\t\t\tif (light._type !== LIGHTTYPE_DIRECTIONAL) {\n\t\t\t\t\t\t\tthis.localLights.push(light);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tstats.lights = this.lights.length;\n\t\t_tempLightSet.clear();\n\t\t_tempLayerSet.clear();\n\t}\n\tcullLights(camera, lights) {\n\t\tconst clusteredLightingEnabled = this.scene.clusteredLightingEnabled;\n\t\tconst physicalUnits = this.scene.physicalUnits;\n\t\tfor (let i = 0; i < lights.length; i++) {\n\t\t\tconst light = lights[i];\n\t\t\tif (light.enabled) {\n\t\t\t\tif (light._type !== LIGHTTYPE_DIRECTIONAL) {\n\t\t\t\t\tlight.getBoundingSphere(tempSphere);\n\t\t\t\t\tif (camera.frustum.containsSphere(tempSphere)) {\n\t\t\t\t\t\tlight.visibleThisFrame = true;\n\t\t\t\t\t\tlight.usePhysicalUnits = physicalUnits;\n\t\t\t\t\t\tconst screenSize = camera.getScreenSize(tempSphere);\n\t\t\t\t\t\tlight.maxScreenSize = Math.max(light.maxScreenSize, screenSize);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (!clusteredLightingEnabled) {\n\t\t\t\t\t\t\tif (light.castShadows && !light.shadowMap) {\n\t\t\t\t\t\t\t\tlight.visibleThisFrame = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tlight.usePhysicalUnits = this.scene.physicalUnits;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tcullShadowmaps(comp) {\n\t\tconst isClustered = this.scene.clusteredLightingEnabled;\n\t\tfor (let i = 0; i < this.localLights.length; i++) {\n\t\t\tconst light = this.localLights[i];\n\t\t\tif (light._type !== LIGHTTYPE_DIRECTIONAL) {\n\t\t\t\tif (isClustered) {\n\t\t\t\t\tif (light.atlasSlotUpdated && light.shadowUpdateMode === SHADOWUPDATE_NONE) {\n\t\t\t\t\t\tlight.shadowUpdateMode = SHADOWUPDATE_THISFRAME;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (light.shadowUpdateMode === SHADOWUPDATE_NONE && light.castShadows) {\n\t\t\t\t\t\tif (!light.getRenderData(null, 0).shadowCamera.renderTarget) {\n\t\t\t\t\t\t\tlight.shadowUpdateMode = SHADOWUPDATE_THISFRAME;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (light.visibleThisFrame && light.castShadows && light.shadowUpdateMode !== SHADOWUPDATE_NONE) {\n\t\t\t\t\tthis._shadowRendererLocal.cull(light, comp);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst renderActions = comp._renderActions;\n\t\tfor (let i = 0; i < renderActions.length; i++) {\n\t\t\tconst renderAction = renderActions[i];\n\t\t\trenderAction.directionalLights.length = 0;\n\t\t\tconst camera = renderAction.camera.camera;\n\t\t\tif (renderAction.firstCameraUse) {\n\t\t\t\tconst cameraLayers = camera.layers;\n\t\t\t\tfor (let l = 0; l < cameraLayers.length; l++) {\n\t\t\t\t\tconst cameraLayer = comp.getLayerById(cameraLayers[l]);\n\t\t\t\t\tif (cameraLayer) {\n\t\t\t\t\t\tconst layerDirLights = cameraLayer.splitLights[LIGHTTYPE_DIRECTIONAL];\n\t\t\t\t\t\tfor (let j = 0; j < layerDirLights.length; j++) {\n\t\t\t\t\t\t\tconst light = layerDirLights[j];\n\t\t\t\t\t\t\tif (light.castShadows && !_tempSet.has(light)) {\n\t\t\t\t\t\t\t\t_tempSet.add(light);\n\t\t\t\t\t\t\t\trenderAction.directionalLights.push(light);\n\t\t\t\t\t\t\t\tthis._shadowRendererDirectional.cull(light, comp, camera);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t_tempSet.clear();\n\t\t\t}\n\t\t}\n\t}\n\tcullComposition(comp) {\n\t\tthis.processingMeshInstances.clear();\n\t\tconst numCameras = comp.cameras.length;\n\t\tfor (let i = 0; i < numCameras; i++) {\n\t\t\tconst camera = comp.cameras[i];\n\t\t\tlet currentRenderTarget;\n\t\t\tlet cameraChanged = true;\n\t\t\tthis._camerasRendered++;\n\t\t\tconst layerIds = camera.layers;\n\t\t\tfor (let j = 0; j < layerIds.length; j++) {\n\t\t\t\tconst layer = comp.getLayerById(layerIds[j]);\n\t\t\t\tif (layer && layer.enabled) {\n\t\t\t\t\tvar _camera$renderTarget;\n\t\t\t\t\tconst renderTarget = (_camera$renderTarget = camera.renderTarget) != null ? _camera$renderTarget : layer.renderTarget;\n\t\t\t\t\tif (cameraChanged || renderTarget !== currentRenderTarget) {\n\t\t\t\t\t\tcameraChanged = false;\n\t\t\t\t\t\tcurrentRenderTarget = renderTarget;\n\t\t\t\t\t\tcamera.frameUpdate(renderTarget);\n\t\t\t\t\t\tthis.updateCameraFrustum(camera.camera);\n\t\t\t\t\t}\n\t\t\t\t\tthis.cullLights(camera.camera, layer._lights);\n\t\t\t\t\tlayer.onPreCull == null || layer.onPreCull(comp.camerasMap.get(camera));\n\t\t\t\t\tconst culledInstances = layer.getCulledInstances(camera.camera);\n\t\t\t\t\tthis.cull(camera.camera, layer.meshInstances, culledInstances);\n\t\t\t\t\tlayer.onPostCull == null || layer.onPostCull(comp.camerasMap.get(camera));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (this.scene.clusteredLightingEnabled) {\n\t\t\tthis.updateLightTextureAtlas();\n\t\t}\n\t\tthis.cullShadowmaps(comp);\n\t}\n\tupdateShaders(drawCalls, onlyLitShaders) {\n\t\tconst count = drawCalls.length;\n\t\tfor (let i = 0; i < count; i++) {\n\t\t\tconst mat = drawCalls[i].material;\n\t\t\tif (mat) {\n\t\t\t\tif (!_tempSet.has(mat)) {\n\t\t\t\t\t_tempSet.add(mat);\n\t\t\t\t\tif (mat.getShaderVariant !== Material.prototype.getShaderVariant) {\n\t\t\t\t\t\tif (onlyLitShaders) {\n\t\t\t\t\t\t\tif (!mat.useLighting || mat.emitter && !mat.emitter.lighting) continue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tmat.clearVariants();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t_tempSet.clear();\n\t}\n\tbeginFrame(comp) {\n\t\tconst scene = this.scene;\n\t\tconst updateShaders = scene.updateShaders;\n\t\tconst layers = comp.layerList;\n\t\tconst layerCount = layers.length;\n\t\tfor (let i = 0; i < layerCount; i++) {\n\t\t\tconst layer = layers[i];\n\t\t\tconst meshInstances = layer.meshInstances;\n\t\t\tconst count = meshInstances.length;\n\t\t\tfor (let j = 0; j < count; j++) {\n\t\t\t\tconst meshInst = meshInstances[j];\n\t\t\t\tmeshInst.visibleThisFrame = false;\n\t\t\t\tif (updateShaders) {\n\t\t\t\t\t_tempMeshInstances.push(meshInst);\n\t\t\t\t}\n\t\t\t\tif (meshInst.skinInstance) {\n\t\t\t\t\t_tempMeshInstancesSkinned.push(meshInst);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (updateShaders) {\n\t\t\tconst onlyLitShaders = !scene.updateShaders;\n\t\t\tthis.updateShaders(_tempMeshInstances, onlyLitShaders);\n\t\t\tscene.updateShaders = false;\n\t\t\tscene._shaderVersion++;\n\t\t}\n\t\tthis.updateCpuSkinMatrices(_tempMeshInstancesSkinned);\n\t\t_tempMeshInstances.length = 0;\n\t\t_tempMeshInstancesSkinned.length = 0;\n\t\tconst lights = this.lights;\n\t\tconst lightCount = lights.length;\n\t\tfor (let i = 0; i < lightCount; i++) {\n\t\t\tlights[i].beginFrame();\n\t\t}\n\t}\n\tupdateLightTextureAtlas() {\n\t\tthis.lightTextureAtlas.update(this.localLights, this.scene.lighting);\n\t}\n\tupdateLayerComposition(comp) {\n\t\tconst len = comp.layerList.length;\n\t\tfor (let i = 0; i < len; i++) {\n\t\t\tcomp.layerList[i]._postRenderCounter = 0;\n\t\t}\n\t\tconst scene = this.scene;\n\t\tconst shaderVersion = scene._shaderVersion;\n\t\tfor (let i = 0; i < len; i++) {\n\t\t\tconst layer = comp.layerList[i];\n\t\t\tlayer._shaderVersion = shaderVersion;\n\t\t\tlayer._preRenderCalledForCameras = 0;\n\t\t\tlayer._postRenderCalledForCameras = 0;\n\t\t\tconst transparent = comp.subLayerList[i];\n\t\t\tif (transparent) {\n\t\t\t\tlayer._postRenderCounter |= 2;\n\t\t\t} else {\n\t\t\t\tlayer._postRenderCounter |= 1;\n\t\t\t}\n\t\t\tlayer._postRenderCounterMax = layer._postRenderCounter;\n\t\t}\n\t\tcomp._update();\n\t}\n\tframeUpdate() {\n\t\tthis.clustersDebugRendered = false;\n\t\tthis.initViewBindGroupFormat(this.scene.clusteredLightingEnabled);\n\t}\n}\n\nexport { Renderer };\n","class RenderAction {\n\tconstructor() {\n\t\tthis.layer = null;\n\t\tthis.transparent = false;\n\t\tthis.camera = null;\n\t\tthis.renderTarget = null;\n\t\tthis.lightClusters = null;\n\t\tthis.clearColor = false;\n\t\tthis.clearDepth = false;\n\t\tthis.clearStencil = false;\n\t\tthis.triggerPostprocess = false;\n\t\tthis.firstCameraUse = false;\n\t\tthis.lastCameraUse = false;\n\t\tthis.directionalLights = [];\n\t\tthis.viewBindGroups = [];\n\t\tthis.useCameraPasses = false;\n\t}\n\tdestroy() {\n\t\tthis.viewBindGroups.forEach(bg => {\n\t\t\tbg.defaultUniformBuffer.destroy();\n\t\t\tbg.destroy();\n\t\t});\n\t\tthis.viewBindGroups.length = 0;\n\t}\n\tsetupClears(camera, layer) {\n\t\tthis.clearColor = (camera == null ? void 0 : camera.clearColorBuffer) || layer.clearColorBuffer;\n\t\tthis.clearDepth = (camera == null ? void 0 : camera.clearDepthBuffer) || layer.clearDepthBuffer;\n\t\tthis.clearStencil = (camera == null ? void 0 : camera.clearStencilBuffer) || layer.clearStencilBuffer;\n\t}\n\tget hasDirectionalShadowLights() {\n\t\treturn this.directionalLights.length > 0;\n\t}\n}\n\nexport { RenderAction };\n","import { math } from './math.js';\n\nconst _goldenAngle = 2.399963229728653;\nconst random = {\n\tcirclePoint: function (point) {\n\t\tconst r = Math.sqrt(Math.random());\n\t\tconst theta = Math.random() * 2 * Math.PI;\n\t\tpoint.x = r * Math.cos(theta);\n\t\tpoint.y = r * Math.sin(theta);\n\t},\n\tcirclePointDeterministic: function (point, index, numPoints) {\n\t\tconst theta = index * _goldenAngle;\n\t\tconst r = Math.sqrt(index) / Math.sqrt(numPoints);\n\t\tpoint.x = r * Math.cos(theta);\n\t\tpoint.y = r * Math.sin(theta);\n\t},\n\tspherePointDeterministic: function (point, index, numPoints, start = 0, end = 1) {\n\t\tstart = 1 - 2 * start;\n\t\tend = 1 - 2 * end;\n\t\tconst y = math.lerp(start, end, index / numPoints);\n\t\tconst radius = Math.sqrt(1 - y * y);\n\t\tconst theta = _goldenAngle * index;\n\t\tpoint.x = Math.cos(theta) * radius;\n\t\tpoint.y = y;\n\t\tpoint.z = Math.sin(theta) * radius;\n\t},\n\tradicalInverse: function (i) {\n\t\tlet bits = (i << 16 | i >>> 16) >>> 0;\n\t\tbits = ((bits & 0x55555555) << 1 | (bits & 0xAAAAAAAA) >>> 1) >>> 0;\n\t\tbits = ((bits & 0x33333333) << 2 | (bits & 0xCCCCCCCC) >>> 2) >>> 0;\n\t\tbits = ((bits & 0x0F0F0F0F) << 4 | (bits & 0xF0F0F0F0) >>> 4) >>> 0;\n\t\tbits = ((bits & 0x00FF00FF) << 8 | (bits & 0xFF00FF00) >>> 8) >>> 0;\n\t\treturn bits * 2.3283064365386963e-10;\n\t}\n};\n\nexport { random };\n","import '../../core/tracing.js';\nimport { random } from '../../core/math/random.js';\nimport { Vec3 } from '../../core/math/vec3.js';\nimport { TEXTUREPROJECTION_OCTAHEDRAL, TEXTUREPROJECTION_CUBE, FILTER_NEAREST } from '../../platform/graphics/constants.js';\nimport { DeviceCache } from '../../platform/graphics/device-cache.js';\nimport { GraphicsDevice } from '../../platform/graphics/graphics-device.js';\nimport { RenderTarget } from '../../platform/graphics/render-target.js';\nimport { drawQuadWithShader } from './quad-render-utils.js';\nimport { Texture } from '../../platform/graphics/texture.js';\nimport { ChunkUtils } from '../shader-lib/chunk-utils.js';\nimport { shaderChunks } from '../shader-lib/chunks/chunks.js';\nimport { getProgramLibrary } from '../shader-lib/get-program-library.js';\nimport { createShaderFromCode } from '../shader-lib/utils.js';\nimport { BlendState } from '../../platform/graphics/blend-state.js';\n\nconst getProjectionName = projection => {\n\tswitch (projection) {\n\t\tcase TEXTUREPROJECTION_CUBE:\n\t\t\treturn \"Cubemap\";\n\t\tcase TEXTUREPROJECTION_OCTAHEDRAL:\n\t\t\treturn \"Octahedral\";\n\t\tdefault:\n\t\t\treturn \"Equirect\";\n\t}\n};\nconst packFloat32ToRGBA8 = (value, array, offset) => {\n\tif (value <= 0) {\n\t\tarray[offset + 0] = 0;\n\t\tarray[offset + 1] = 0;\n\t\tarray[offset + 2] = 0;\n\t\tarray[offset + 3] = 0;\n\t} else if (value >= 1.0) {\n\t\tarray[offset + 0] = 255;\n\t\tarray[offset + 1] = 0;\n\t\tarray[offset + 2] = 0;\n\t\tarray[offset + 3] = 0;\n\t} else {\n\t\tlet encX = 1 * value % 1;\n\t\tlet encY = 255 * value % 1;\n\t\tlet encZ = 65025 * value % 1;\n\t\tconst encW = 16581375.0 * value % 1;\n\t\tencX -= encY / 255;\n\t\tencY -= encZ / 255;\n\t\tencZ -= encW / 255;\n\t\tarray[offset + 0] = Math.min(255, Math.floor(encX * 256));\n\t\tarray[offset + 1] = Math.min(255, Math.floor(encY * 256));\n\t\tarray[offset + 2] = Math.min(255, Math.floor(encZ * 256));\n\t\tarray[offset + 3] = Math.min(255, Math.floor(encW * 256));\n\t}\n};\nconst packSamples = samples => {\n\tconst numSamples = samples.length;\n\tconst w = Math.min(numSamples, 512);\n\tconst h = Math.ceil(numSamples / w);\n\tconst data = new Uint8Array(w * h * 4);\n\tlet off = 0;\n\tfor (let i = 0; i < numSamples; i += 4) {\n\t\tpackFloat32ToRGBA8(samples[i + 0] * 0.5 + 0.5, data, off + 0);\n\t\tpackFloat32ToRGBA8(samples[i + 1] * 0.5 + 0.5, data, off + 4);\n\t\tpackFloat32ToRGBA8(samples[i + 2] * 0.5 + 0.5, data, off + 8);\n\t\tpackFloat32ToRGBA8(samples[i + 3] / 8, data, off + 12);\n\t\toff += 16;\n\t}\n\treturn {\n\t\twidth: w,\n\t\theight: h,\n\t\tdata: data\n\t};\n};\nconst hemisphereSamplePhong = (dstVec, x, y, specularPower) => {\n\tconst phi = y * 2 * Math.PI;\n\tconst cosTheta = Math.pow(1 - x, 1 / (specularPower + 1));\n\tconst sinTheta = Math.sqrt(1 - cosTheta * cosTheta);\n\tdstVec.set(Math.cos(phi) * sinTheta, Math.sin(phi) * sinTheta, cosTheta).normalize();\n};\nconst hemisphereSampleLambert = (dstVec, x, y) => {\n\tconst phi = y * 2 * Math.PI;\n\tconst cosTheta = Math.sqrt(1 - x);\n\tconst sinTheta = Math.sqrt(x);\n\tdstVec.set(Math.cos(phi) * sinTheta, Math.sin(phi) * sinTheta, cosTheta).normalize();\n};\nconst hemisphereSampleGGX = (dstVec, x, y, a) => {\n\tconst phi = y * 2 * Math.PI;\n\tconst cosTheta = Math.sqrt((1 - x) / (1 + (a * a - 1) * x));\n\tconst sinTheta = Math.sqrt(1 - cosTheta * cosTheta);\n\tdstVec.set(Math.cos(phi) * sinTheta, Math.sin(phi) * sinTheta, cosTheta).normalize();\n};\nconst D_GGX = (NoH, linearRoughness) => {\n\tconst a = NoH * linearRoughness;\n\tconst k = linearRoughness / (1.0 - NoH * NoH + a * a);\n\treturn k * k * (1 / Math.PI);\n};\nconst generatePhongSamples = (numSamples, specularPower) => {\n\tconst H = new Vec3();\n\tconst result = [];\n\tfor (let i = 0; i < numSamples; ++i) {\n\t\themisphereSamplePhong(H, i / numSamples, random.radicalInverse(i), specularPower);\n\t\tresult.push(H.x, H.y, H.z, 0);\n\t}\n\treturn result;\n};\nconst generateLambertSamples = (numSamples, sourceTotalPixels) => {\n\tconst pixelsPerSample = sourceTotalPixels / numSamples;\n\tconst H = new Vec3();\n\tconst result = [];\n\tfor (let i = 0; i < numSamples; ++i) {\n\t\themisphereSampleLambert(H, i / numSamples, random.radicalInverse(i));\n\t\tconst pdf = H.z / Math.PI;\n\t\tconst mipLevel = 0.5 * Math.log2(pixelsPerSample / pdf);\n\t\tresult.push(H.x, H.y, H.z, mipLevel);\n\t}\n\treturn result;\n};\nconst requiredSamplesGGX = {\n\t\"16\": {\n\t\t\"2\": 26,\n\t\t\"8\": 20,\n\t\t\"32\": 17,\n\t\t\"128\": 16,\n\t\t\"512\": 16\n\t},\n\t\"32\": {\n\t\t\"2\": 53,\n\t\t\"8\": 40,\n\t\t\"32\": 34,\n\t\t\"128\": 32,\n\t\t\"512\": 32\n\t},\n\t\"128\": {\n\t\t\"2\": 214,\n\t\t\"8\": 163,\n\t\t\"32\": 139,\n\t\t\"128\": 130,\n\t\t\"512\": 128\n\t},\n\t\"1024\": {\n\t\t\"2\": 1722,\n\t\t\"8\": 1310,\n\t\t\"32\": 1114,\n\t\t\"128\": 1041,\n\t\t\"512\": 1025\n\t}\n};\nconst getRequiredSamplesGGX = (numSamples, specularPower) => {\n\tconst table = requiredSamplesGGX[numSamples];\n\treturn table && table[specularPower] || numSamples;\n};\nconst generateGGXSamples = (numSamples, specularPower, sourceTotalPixels) => {\n\tconst pixelsPerSample = sourceTotalPixels / numSamples;\n\tconst roughness = 1 - Math.log2(specularPower) / 11.0;\n\tconst a = roughness * roughness;\n\tconst H = new Vec3();\n\tconst L = new Vec3();\n\tconst N = new Vec3(0, 0, 1);\n\tconst result = [];\n\tconst requiredSamples = getRequiredSamplesGGX(numSamples, specularPower);\n\tfor (let i = 0; i < requiredSamples; ++i) {\n\t\themisphereSampleGGX(H, i / requiredSamples, random.radicalInverse(i), a);\n\t\tconst NoH = H.z;\n\t\tL.set(H.x, H.y, H.z).mulScalar(2 * NoH).sub(N);\n\t\tif (L.z > 0) {\n\t\t\tconst pdf = D_GGX(Math.min(1, NoH), a) / 4 + 0.001;\n\t\t\tconst mipLevel = 0.5 * Math.log2(pixelsPerSample / pdf);\n\t\t\tresult.push(L.x, L.y, L.z, mipLevel);\n\t\t}\n\t}\n\twhile (result.length < numSamples * 4) {\n\t\tresult.push(0, 0, 0, 0);\n\t}\n\treturn result;\n};\nconst createSamplesTex = (device, name, samples) => {\n\tconst packedSamples = packSamples(samples);\n\treturn new Texture(device, {\n\t\tname: name,\n\t\twidth: packedSamples.width,\n\t\theight: packedSamples.height,\n\t\tmipmaps: false,\n\t\tminFilter: FILTER_NEAREST,\n\t\tmagFilter: FILTER_NEAREST,\n\t\tlevels: [packedSamples.data]\n\t});\n};\nclass SimpleCache {\n\tconstructor(destroyContent = true) {\n\t\tthis.map = new Map();\n\t\tthis.destroyContent = destroyContent;\n\t}\n\tdestroy() {\n\t\tif (this.destroyContent) {\n\t\t\tthis.map.forEach((value, key) => {\n\t\t\t\tvalue.destroy();\n\t\t\t});\n\t\t}\n\t}\n\tget(key, missFunc) {\n\t\tif (!this.map.has(key)) {\n\t\t\tconst result = missFunc();\n\t\t\tthis.map.set(key, result);\n\t\t\treturn result;\n\t\t}\n\t\treturn this.map.get(key);\n\t}\n}\nconst samplesCache = new SimpleCache(false);\nconst deviceCache = new DeviceCache();\nconst getCachedTexture = (device, key, getSamplesFnc) => {\n\tconst cache = deviceCache.get(device, () => {\n\t\treturn new SimpleCache();\n\t});\n\treturn cache.get(key, () => {\n\t\treturn createSamplesTex(device, key, samplesCache.get(key, getSamplesFnc));\n\t});\n};\nconst generateLambertSamplesTex = (device, numSamples, sourceTotalPixels) => {\n\tconst key = `lambert-samples-${numSamples}-${sourceTotalPixels}`;\n\treturn getCachedTexture(device, key, () => {\n\t\treturn generateLambertSamples(numSamples, sourceTotalPixels);\n\t});\n};\nconst generatePhongSamplesTex = (device, numSamples, specularPower) => {\n\tconst key = `phong-samples-${numSamples}-${specularPower}`;\n\treturn getCachedTexture(device, key, () => {\n\t\treturn generatePhongSamples(numSamples, specularPower);\n\t});\n};\nconst generateGGXSamplesTex = (device, numSamples, specularPower, sourceTotalPixels) => {\n\tconst key = `ggx-samples-${numSamples}-${specularPower}-${sourceTotalPixels}`;\n\treturn getCachedTexture(device, key, () => {\n\t\treturn generateGGXSamples(numSamples, specularPower, sourceTotalPixels);\n\t});\n};\nconst vsCode = `\nattribute vec2 vertex_position;\n\nuniform vec4 uvMod;\n\nvarying vec2 vUv0;\n\nvoid main(void) {\n\t\tgl_Position = vec4(vertex_position, 0.5, 1.0);\n\t\tvUv0 = getImageEffectUV((vertex_position.xy * 0.5 + 0.5) * uvMod.xy + uvMod.zw);\n}\n`;\nfunction reprojectTexture(source, target, options = {}) {\n\tvar _options;\n\tif (source instanceof GraphicsDevice) {\n\t\tsource = arguments[1];\n\t\ttarget = arguments[2];\n\t\toptions = {};\n\t\tif (arguments[3] !== undefined) {\n\t\t\toptions.specularPower = arguments[3];\n\t\t}\n\t\tif (arguments[4] !== undefined) {\n\t\t\toptions.numSamples = arguments[4];\n\t\t}\n\t}\n\tconst funcNames = {\n\t\t'none': 'reproject',\n\t\t'lambert': 'prefilterSamplesUnweighted',\n\t\t'phong': 'prefilterSamplesUnweighted',\n\t\t'ggx': 'prefilterSamples'\n\t};\n\tconst specularPower = options.hasOwnProperty('specularPower') ? options.specularPower : 1;\n\tconst face = options.hasOwnProperty('face') ? options.face : null;\n\tconst distribution = options.hasOwnProperty('distribution') ? options.distribution : specularPower === 1 ? 'none' : 'phong';\n\tconst processFunc = funcNames[distribution] || 'reproject';\n\tconst prefilterSamples = processFunc.startsWith('prefilterSamples');\n\tconst decodeFunc = ChunkUtils.decodeFunc(source.encoding);\n\tconst encodeFunc = ChunkUtils.encodeFunc(target.encoding);\n\tconst sourceFunc = `sample${getProjectionName(source.projection)}`;\n\tconst targetFunc = `getDirection${getProjectionName(target.projection)}`;\n\tconst numSamples = options.hasOwnProperty('numSamples') ? options.numSamples : 1024;\n\tconst shaderKey = `${processFunc}_${decodeFunc}_${encodeFunc}_${sourceFunc}_${targetFunc}_${numSamples}`;\n\tconst device = source.device;\n\tlet shader = getProgramLibrary(device).getCachedShader(shaderKey);\n\tif (!shader) {\n\t\tconst defines = `#define PROCESS_FUNC ${processFunc}\\n` + (prefilterSamples ? `#define USE_SAMPLES_TEX\\n` : '') + (source.cubemap ? `#define CUBEMAP_SOURCE\\n` : '') + `#define DECODE_FUNC ${decodeFunc}\\n` + `#define ENCODE_FUNC ${encodeFunc}\\n` + `#define SOURCE_FUNC ${sourceFunc}\\n` + `#define TARGET_FUNC ${targetFunc}\\n` + `#define NUM_SAMPLES ${numSamples}\\n` + `#define NUM_SAMPLES_SQRT ${Math.round(Math.sqrt(numSamples)).toFixed(1)}\\n`;\n\t\tshader = createShaderFromCode(device, vsCode, `${defines}\\n${shaderChunks.reprojectPS}`, shaderKey);\n\t}\n\tdevice.setBlendState(BlendState.NOBLEND);\n\tconst constantSource = device.scope.resolve(source.cubemap ? \"sourceCube\" : \"sourceTex\");\n\tconstantSource.setValue(source);\n\tconst constantParams = device.scope.resolve(\"params\");\n\tconst constantParams2 = device.scope.resolve(\"params2\");\n\tconst uvModParam = device.scope.resolve(\"uvMod\");\n\tif ((_options = options) != null && _options.seamPixels) {\n\t\tconst p = options.seamPixels;\n\t\tconst w = options.rect ? options.rect.z : target.width;\n\t\tconst h = options.rect ? options.rect.w : target.height;\n\t\tconst innerWidth = w - p * 2;\n\t\tconst innerHeight = h - p * 2;\n\t\tuvModParam.setValue([(innerWidth + p * 2) / innerWidth, (innerHeight + p * 2) / innerHeight, -p / innerWidth, -p / innerHeight]);\n\t} else {\n\t\tuvModParam.setValue([1, 1, 0, 0]);\n\t}\n\tconst params = [0, specularPower, source.fixCubemapSeams ? 1.0 / source.width : 0.0, target.fixCubemapSeams ? 1.0 / target.width : 0.0];\n\tconst params2 = [target.width * target.height * (target.cubemap ? 6 : 1), source.width * source.height * (source.cubemap ? 6 : 1)];\n\tif (prefilterSamples) {\n\t\tconst sourceTotalPixels = source.width * source.height * (source.cubemap ? 6 : 1);\n\t\tconst samplesTex = distribution === 'ggx' ? generateGGXSamplesTex(device, numSamples, specularPower, sourceTotalPixels) : distribution === 'lambert' ? generateLambertSamplesTex(device, numSamples, sourceTotalPixels) : generatePhongSamplesTex(device, numSamples, specularPower);\n\t\tdevice.scope.resolve(\"samplesTex\").setValue(samplesTex);\n\t\tdevice.scope.resolve(\"samplesTexInverseSize\").setValue([1.0 / samplesTex.width, 1.0 / samplesTex.height]);\n\t}\n\tfor (let f = 0; f < (target.cubemap ? 6 : 1); f++) {\n\t\tif (face === null || f === face) {\n\t\t\tvar _options2;\n\t\t\tconst renderTarget = new RenderTarget({\n\t\t\t\tcolorBuffer: target,\n\t\t\t\tface: f,\n\t\t\t\tdepth: false,\n\t\t\t\tflipY: device.isWebGPU\n\t\t\t});\n\t\t\tparams[0] = f;\n\t\t\tconstantParams.setValue(params);\n\t\t\tconstantParams2.setValue(params2);\n\t\t\tdrawQuadWithShader(device, renderTarget, shader, (_options2 = options) == null ? void 0 : _options2.rect);\n\t\t\trenderTarget.destroy();\n\t\t}\n\t}\n}\n\nexport { reprojectTexture };\n","import { Vec4 } from '../../core/math/vec4.js';\nimport { Texture } from '../../platform/graphics/texture.js';\nimport { reprojectTexture } from './reproject-texture.js';\nimport { PIXELFORMAT_RGBA8, TEXTURETYPE_RGBP, TEXTURETYPE_DEFAULT, ADDRESS_CLAMP_TO_EDGE, TEXTUREPROJECTION_EQUIRECT, PIXELFORMAT_RGBA16F, PIXELFORMAT_RGBA32F } from '../../platform/graphics/constants.js';\n\nconst fixCubemapSeams = true;\nconst calcLevels = (width, height = 0) => {\n\treturn 1 + Math.floor(Math.log2(Math.max(width, height)));\n};\nconst supportsFloat16 = device => {\n\treturn device.extTextureHalfFloat && device.textureHalfFloatRenderable;\n};\nconst supportsFloat32 = device => {\n\treturn device.extTextureFloat && device.textureFloatRenderable;\n};\nconst lightingSourcePixelFormat = device => {\n\treturn supportsFloat16(device) ? PIXELFORMAT_RGBA16F : supportsFloat32(device) ? PIXELFORMAT_RGBA32F : PIXELFORMAT_RGBA8;\n};\nconst lightingPixelFormat = device => {\n\treturn PIXELFORMAT_RGBA8;\n};\nconst createCubemap = (device, size, format, mipmaps) => {\n\treturn new Texture(device, {\n\t\tname: `lighting-${size}`,\n\t\tcubemap: true,\n\t\twidth: size,\n\t\theight: size,\n\t\tformat: format,\n\t\ttype: format === PIXELFORMAT_RGBA8 ? TEXTURETYPE_RGBP : TEXTURETYPE_DEFAULT,\n\t\taddressU: ADDRESS_CLAMP_TO_EDGE,\n\t\taddressV: ADDRESS_CLAMP_TO_EDGE,\n\t\tfixCubemapSeams: fixCubemapSeams,\n\t\tmipmaps: !!mipmaps\n\t});\n};\nclass EnvLighting {\n\tstatic generateSkyboxCubemap(source, size) {\n\t\tconst device = source.device;\n\t\tconst result = createCubemap(device, size || (source.cubemap ? source.width : source.width / 4), PIXELFORMAT_RGBA8, false);\n\t\treprojectTexture(source, result, {\n\t\t\tnumSamples: 1024\n\t\t});\n\t\treturn result;\n\t}\n\tstatic generateLightingSource(source, options) {\n\t\tconst device = source.device;\n\t\tconst format = lightingSourcePixelFormat(device);\n\t\tconst result = (options == null ? void 0 : options.target) || new Texture(device, {\n\t\t\tname: `lighting-source`,\n\t\t\tcubemap: true,\n\t\t\twidth: (options == null ? void 0 : options.size) || 128,\n\t\t\theight: (options == null ? void 0 : options.size) || 128,\n\t\t\tformat: format,\n\t\t\ttype: format === PIXELFORMAT_RGBA8 ? TEXTURETYPE_RGBP : TEXTURETYPE_DEFAULT,\n\t\t\taddressU: ADDRESS_CLAMP_TO_EDGE,\n\t\t\taddressV: ADDRESS_CLAMP_TO_EDGE,\n\t\t\tfixCubemapSeams: false,\n\t\t\tmipmaps: true\n\t\t});\n\t\treprojectTexture(source, result, {\n\t\t\tnumSamples: source.mipmaps ? 1 : 1024\n\t\t});\n\t\treturn result;\n\t}\n\tstatic generateAtlas(source, options) {\n\t\tconst device = source.device;\n\t\tconst format = lightingPixelFormat();\n\t\tconst result = (options == null ? void 0 : options.target) || new Texture(device, {\n\t\t\tname: 'envAtlas',\n\t\t\twidth: (options == null ? void 0 : options.size) || 512,\n\t\t\theight: (options == null ? void 0 : options.size) || 512,\n\t\t\tformat: format,\n\t\t\ttype: TEXTURETYPE_RGBP ,\n\t\t\tprojection: TEXTUREPROJECTION_EQUIRECT,\n\t\t\taddressU: ADDRESS_CLAMP_TO_EDGE,\n\t\t\taddressV: ADDRESS_CLAMP_TO_EDGE,\n\t\t\tmipmaps: false\n\t\t});\n\t\tconst s = result.width / 512;\n\t\tconst rect = new Vec4(0, 0, 512 * s, 256 * s);\n\t\tconst levels = calcLevels(256) - calcLevels(4);\n\t\tfor (let i = 0; i < levels; ++i) {\n\t\t\treprojectTexture(source, result, {\n\t\t\t\tnumSamples: 1,\n\t\t\t\trect: rect,\n\t\t\t\tseamPixels: s\n\t\t\t});\n\t\t\trect.x += rect.w;\n\t\t\trect.y += rect.w;\n\t\t\trect.z = Math.max(1, Math.floor(rect.z * 0.5));\n\t\t\trect.w = Math.max(1, Math.floor(rect.w * 0.5));\n\t\t}\n\t\trect.set(0, 256 * s, 256 * s, 128 * s);\n\t\tfor (let i = 1; i < 7; ++i) {\n\t\t\treprojectTexture(source, result, {\n\t\t\t\tnumSamples: (options == null ? void 0 : options.numReflectionSamples) || 1024,\n\t\t\t\tdistribution: (options == null ? void 0 : options.distribution) || 'ggx',\n\t\t\t\tspecularPower: Math.max(1, 2048 >> i * 2),\n\t\t\t\trect: rect,\n\t\t\t\tseamPixels: s\n\t\t\t});\n\t\t\trect.y += rect.w;\n\t\t\trect.z = Math.max(1, Math.floor(rect.z * 0.5));\n\t\t\trect.w = Math.max(1, Math.floor(rect.w * 0.5));\n\t\t}\n\t\trect.set(128 * s, (256 + 128) * s, 64 * s, 32 * s);\n\t\treprojectTexture(source, result, {\n\t\t\tnumSamples: (options == null ? void 0 : options.numAmbientSamples) || 2048,\n\t\t\tdistribution: 'lambert',\n\t\t\trect: rect,\n\t\t\tseamPixels: s\n\t\t});\n\t\treturn result;\n\t}\n\tstatic generatePrefilteredAtlas(sources, options) {\n\t\tconst device = sources[0].device;\n\t\tconst format = sources[0].format;\n\t\tconst type = sources[0].type;\n\t\tconst result = (options == null ? void 0 : options.target) || new Texture(device, {\n\t\t\tname: 'envPrefilteredAtlas',\n\t\t\twidth: (options == null ? void 0 : options.size) || 512,\n\t\t\theight: (options == null ? void 0 : options.size) || 512,\n\t\t\tformat: format,\n\t\t\ttype: type,\n\t\t\tprojection: TEXTUREPROJECTION_EQUIRECT,\n\t\t\taddressU: ADDRESS_CLAMP_TO_EDGE,\n\t\t\taddressV: ADDRESS_CLAMP_TO_EDGE,\n\t\t\tmipmaps: false\n\t\t});\n\t\tconst s = result.width / 512;\n\t\tconst rect = new Vec4(0, 0, 512 * s, 256 * s);\n\t\tconst levels = calcLevels(512);\n\t\tfor (let i = 0; i < levels; ++i) {\n\t\t\treprojectTexture(sources[0], result, {\n\t\t\t\tnumSamples: 1,\n\t\t\t\trect: rect,\n\t\t\t\tseamPixels: s\n\t\t\t});\n\t\t\trect.x += rect.w;\n\t\t\trect.y += rect.w;\n\t\t\trect.z = Math.max(1, Math.floor(rect.z * 0.5));\n\t\t\trect.w = Math.max(1, Math.floor(rect.w * 0.5));\n\t\t}\n\t\trect.set(0, 256 * s, 256 * s, 128 * s);\n\t\tfor (let i = 1; i < sources.length; ++i) {\n\t\t\treprojectTexture(sources[i], result, {\n\t\t\t\tnumSamples: 1,\n\t\t\t\trect: rect,\n\t\t\t\tseamPixels: s\n\t\t\t});\n\t\t\trect.y += rect.w;\n\t\t\trect.z = Math.max(1, Math.floor(rect.z * 0.5));\n\t\t\trect.w = Math.max(1, Math.floor(rect.w * 0.5));\n\t\t}\n\t\trect.set(128 * s, (256 + 128) * s, 64 * s, 32 * s);\n\t\tif (options != null && options.legacyAmbient) {\n\t\t\treprojectTexture(sources[5], result, {\n\t\t\t\tnumSamples: 1,\n\t\t\t\trect: rect,\n\t\t\t\tseamPixels: s\n\t\t\t});\n\t\t} else {\n\t\t\treprojectTexture(sources[0], result, {\n\t\t\t\tnumSamples: (options == null ? void 0 : options.numSamples) || 2048,\n\t\t\t\tdistribution: 'lambert',\n\t\t\t\trect: rect,\n\t\t\t\tseamPixels: s\n\t\t\t});\n\t\t}\n\t\treturn result;\n\t}\n}\n\nexport { EnvLighting };\n","import { LitShaderOptions } from '../shader-lib/programs/lit-shader-options.js';\n\nclass StandardMaterialOptions {\n\tconstructor() {\n\t\tthis.forceUv1 = false;\n\t\tthis.ambientTint = false;\n\t\tthis.diffuseTint = false;\n\t\tthis.specularTint = false;\n\t\tthis.metalnessTint = false;\n\t\tthis.glossTint = false;\n\t\tthis.emissiveTint = false;\n\t\tthis.opacityTint = false;\n\t\tthis.emissiveEncoding = 'linear';\n\t\tthis.lightMapEncoding = 'linear';\n\t\tthis.packedNormal = false;\n\t\tthis.glossInvert = false;\n\t\tthis.sheenGlossInvert = false;\n\t\tthis.clearCoatGlossInvert = false;\n\t\tthis.litOptions = new LitShaderOptions();\n\t}\n\tget pass() {\n\t\treturn this.litOptions.pass;\n\t}\n}\n\nexport { StandardMaterialOptions };\n","import '../../../core/tracing.js';\nimport { SHADER_FORWARD, SHADER_FORWARDHDR, SPRITE_RENDERMODE_SLICED, SPRITE_RENDERMODE_TILED, SPECULAR_PHONG, FRESNEL_SCHLICK, BLEND_NONE } from '../../constants.js';\nimport { ShaderPass } from '../../shader-pass.js';\nimport { LitShader } from './lit-shader.js';\nimport { ChunkBuilder } from '../chunk-builder.js';\nimport { ChunkUtils } from '../chunk-utils.js';\nimport { StandardMaterialOptions } from '../../materials/standard-material-options.js';\nimport { LitOptionsUtils } from './lit-options-utils.js';\nimport { ShaderGenerator } from './shader-generator.js';\n\nconst _matTex2D = [];\nconst buildPropertiesList = options => {\n\treturn Object.keys(options).filter(key => key !== \"litOptions\").sort();\n};\nclass ShaderGeneratorStandard extends ShaderGenerator {\n\tconstructor(...args) {\n\t\tsuper(...args);\n\t\tthis.optionsContext = new StandardMaterialOptions();\n\t\tthis.optionsContextMin = new StandardMaterialOptions();\n\t}\n\tgenerateKey(options) {\n\t\tlet props;\n\t\tif (options === this.optionsContextMin) {\n\t\t\tif (!this.propsMin) this.propsMin = buildPropertiesList(options);\n\t\t\tprops = this.propsMin;\n\t\t} else if (options === this.optionsContext) {\n\t\t\tif (!this.props) this.props = buildPropertiesList(options);\n\t\t\tprops = this.props;\n\t\t} else {\n\t\t\tprops = buildPropertiesList(options);\n\t\t}\n\t\tconst key = \"standard:\\n\" + props.map(prop => prop + options[prop]).join('\\n') + LitOptionsUtils.generateKey(options.litOptions);\n\t\treturn key;\n\t}\n\t_getUvSourceExpression(transformPropName, uVPropName, options) {\n\t\tconst transformId = options[transformPropName];\n\t\tconst uvChannel = options[uVPropName];\n\t\tconst isMainPass = options.litOptions.pass === SHADER_FORWARD || options.litOptions.pass === SHADER_FORWARDHDR;\n\t\tlet expression;\n\t\tif (isMainPass && options.litOptions.nineSlicedMode === SPRITE_RENDERMODE_SLICED) {\n\t\t\texpression = \"nineSlicedUv\";\n\t\t} else if (isMainPass && options.litOptions.nineSlicedMode === SPRITE_RENDERMODE_TILED) {\n\t\t\texpression = \"nineSlicedUv\";\n\t\t} else {\n\t\t\tif (transformId === 0) {\n\t\t\t\texpression = \"vUv\" + uvChannel;\n\t\t\t} else {\n\t\t\t\texpression = \"vUV\" + uvChannel + \"_\" + transformId;\n\t\t\t}\n\t\t\tif (options.heightMap && transformPropName !== \"heightMapTransform\") {\n\t\t\t\texpression += \" + dUvOffset\";\n\t\t\t}\n\t\t}\n\t\treturn expression;\n\t}\n\t_addMapDef(name, enabled) {\n\t\treturn enabled ? `#define ${name}\\n` : `#undef ${name}\\n`;\n\t}\n\t_addMapDefs(float, color, vertex, map, invert) {\n\t\treturn this._addMapDef(\"MAPFLOAT\", float) + this._addMapDef(\"MAPCOLOR\", color) + this._addMapDef(\"MAPVERTEX\", vertex) + this._addMapDef(\"MAPTEXTURE\", map) + this._addMapDef(\"MAPINVERT\", invert);\n\t}\n\t_addMap(propName, chunkName, options, chunks, mapping, encoding = null) {\n\t\tconst mapPropName = propName + \"Map\";\n\t\tconst uVPropName = mapPropName + \"Uv\";\n\t\tconst identifierPropName = mapPropName + \"Identifier\";\n\t\tconst transformPropName = mapPropName + \"Transform\";\n\t\tconst channelPropName = mapPropName + \"Channel\";\n\t\tconst vertexColorChannelPropName = propName + \"VertexColorChannel\";\n\t\tconst tintPropName = propName + \"Tint\";\n\t\tconst vertexColorPropName = propName + \"VertexColor\";\n\t\tconst detailModePropName = propName + \"Mode\";\n\t\tconst invertName = propName + \"Invert\";\n\t\tconst tintOption = options[tintPropName];\n\t\tconst vertexColorOption = options[vertexColorPropName];\n\t\tconst textureOption = options[mapPropName];\n\t\tconst textureIdentifier = options[identifierPropName];\n\t\tconst detailModeOption = options[detailModePropName];\n\t\tlet subCode = chunks[chunkName];\n\t\tif (textureOption) {\n\t\t\tconst uv = this._getUvSourceExpression(transformPropName, uVPropName, options);\n\t\t\tsubCode = subCode.replace(/\\$UV/g, uv).replace(/\\$CH/g, options[channelPropName]);\n\t\t\tif (mapping && subCode.search(/\\$SAMPLER/g) !== -1) {\n\t\t\t\tlet samplerName = \"texture_\" + mapPropName;\n\t\t\t\tconst alias = mapping[textureIdentifier];\n\t\t\t\tif (alias) {\n\t\t\t\t\tsamplerName = alias;\n\t\t\t\t} else {\n\t\t\t\t\tmapping[textureIdentifier] = samplerName;\n\t\t\t\t}\n\t\t\t\tsubCode = subCode.replace(/\\$SAMPLER/g, samplerName);\n\t\t\t}\n\t\t\tif (encoding) {\n\t\t\t\tif (options[channelPropName] === 'aaa') {\n\t\t\t\t\tsubCode = subCode.replace(/\\$DECODE/g, 'passThrough');\n\t\t\t\t} else {\n\t\t\t\t\tsubCode = subCode.replace(/\\$DECODE/g, ChunkUtils.decodeFunc(!options.litOptions.gamma && encoding === 'srgb' ? 'linear' : encoding));\n\t\t\t\t}\n\t\t\t\tif (subCode.indexOf('$texture2DSAMPLE')) {\n\t\t\t\t\tconst decodeTable = {\n\t\t\t\t\t\tlinear: 'texture2D',\n\t\t\t\t\t\tsrgb: 'texture2DSRGB',\n\t\t\t\t\t\trgbm: 'texture2DRGBM',\n\t\t\t\t\t\trgbe: 'texture2DRGBE'\n\t\t\t\t\t};\n\t\t\t\t\tsubCode = subCode.replace(/\\$texture2DSAMPLE/g, decodeTable[encoding] || 'texture2D');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (vertexColorOption) {\n\t\t\tsubCode = subCode.replace(/\\$VC/g, options[vertexColorChannelPropName]);\n\t\t}\n\t\tif (detailModeOption) {\n\t\t\tsubCode = subCode.replace(/\\$DETAILMODE/g, detailModeOption);\n\t\t}\n\t\tconst isFloatTint = !!(tintOption & 1);\n\t\tconst isVecTint = !!(tintOption & 2);\n\t\tconst invertOption = !!options[invertName];\n\t\tsubCode = this._addMapDefs(isFloatTint, isVecTint, vertexColorOption, textureOption, invertOption) + subCode;\n\t\treturn subCode.replace(/\\$/g, \"\");\n\t}\n\t_correctChannel(p, chan, _matTex2D) {\n\t\tif (_matTex2D[p] > 0) {\n\t\t\tif (_matTex2D[p] < chan.length) {\n\t\t\t\treturn chan.substring(0, _matTex2D[p]);\n\t\t\t} else if (_matTex2D[p] > chan.length) {\n\t\t\t\tlet str = chan;\n\t\t\t\tconst chr = str.charAt(str.length - 1);\n\t\t\t\tconst addLen = _matTex2D[p] - str.length;\n\t\t\t\tfor (let i = 0; i < addLen; i++) str += chr;\n\t\t\t\treturn str;\n\t\t\t}\n\t\t\treturn chan;\n\t\t}\n\t}\n\tcreateShaderDefinition(device, options) {\n\t\tconst shaderPassInfo = ShaderPass.get(device).getByIndex(options.litOptions.pass);\n\t\tconst isForwardPass = shaderPassInfo.isForward;\n\t\tconst litShader = new LitShader(device, options.litOptions);\n\t\tconst useUv = [];\n\t\tconst useUnmodifiedUv = [];\n\t\tconst mapTransforms = [];\n\t\tconst maxUvSets = 2;\n\t\tconst textureMapping = {};\n\t\tfor (const p in _matTex2D) {\n\t\t\tconst mname = p + \"Map\";\n\t\t\tif (options[p + \"VertexColor\"]) {\n\t\t\t\tconst cname = p + \"VertexColorChannel\";\n\t\t\t\toptions[cname] = this._correctChannel(p, options[cname], _matTex2D);\n\t\t\t}\n\t\t\tif (options[mname]) {\n\t\t\t\tconst cname = mname + \"Channel\";\n\t\t\t\tconst tname = mname + \"Transform\";\n\t\t\t\tconst uname = mname + \"Uv\";\n\t\t\t\toptions[uname] = Math.min(options[uname], maxUvSets - 1);\n\t\t\t\toptions[cname] = this._correctChannel(p, options[cname], _matTex2D);\n\t\t\t\tconst uvSet = options[uname];\n\t\t\t\tuseUv[uvSet] = true;\n\t\t\t\tuseUnmodifiedUv[uvSet] = useUnmodifiedUv[uvSet] || options[mname] && !options[tname];\n\t\t\t\tif (options[tname]) {\n\t\t\t\t\tmapTransforms.push({\n\t\t\t\t\t\tname: p,\n\t\t\t\t\t\tid: options[tname],\n\t\t\t\t\t\tuv: options[uname]\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (options.forceUv1) {\n\t\t\tuseUv[1] = true;\n\t\t\tuseUnmodifiedUv[1] = useUnmodifiedUv[1] !== undefined ? useUnmodifiedUv[1] : true;\n\t\t}\n\t\tlitShader.generateVertexShader(useUv, useUnmodifiedUv, mapTransforms);\n\t\tif (options.litOptions.shadingModel === SPECULAR_PHONG) {\n\t\t\toptions.litOptions.fresnelModel = 0;\n\t\t\toptions.litOptions.ambientSH = false;\n\t\t} else {\n\t\t\toptions.litOptions.fresnelModel = options.litOptions.fresnelModel === 0 ? FRESNEL_SCHLICK : options.litOptions.fresnelModel;\n\t\t}\n\t\tconst decl = new ChunkBuilder();\n\t\tconst code = new ChunkBuilder();\n\t\tconst func = new ChunkBuilder();\n\t\tconst args = new ChunkBuilder();\n\t\tlet lightingUv = \"\";\n\t\tif (options.litOptions.nineSlicedMode === SPRITE_RENDERMODE_TILED) {\n\t\t\tdecl.append(`const float textureBias = -1000.0;`);\n\t\t} else {\n\t\t\tdecl.append(`uniform float textureBias;`);\n\t\t}\n\t\tif (isForwardPass) {\n\t\t\tif (options.heightMap) {\n\t\t\t\tdecl.append(\"vec2 dUvOffset;\");\n\t\t\t\tcode.append(this._addMap(\"height\", \"parallaxPS\", options, litShader.chunks, textureMapping));\n\t\t\t\tfunc.append(\"getParallax();\");\n\t\t\t}\n\t\t\tif (options.litOptions.blendType !== BLEND_NONE || options.litOptions.alphaTest || options.litOptions.alphaToCoverage) {\n\t\t\t\tdecl.append(\"float dAlpha;\");\n\t\t\t\tcode.append(this._addMap(\"opacity\", \"opacityPS\", options, litShader.chunks, textureMapping));\n\t\t\t\tfunc.append(\"getOpacity();\");\n\t\t\t\targs.append(\"litArgs_opacity = dAlpha;\");\n\t\t\t\tif (options.litOptions.alphaTest) {\n\t\t\t\t\tcode.append(litShader.chunks.alphaTestPS);\n\t\t\t\t\tfunc.append(\"alphaTest(dAlpha);\");\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tdecl.append(\"float dAlpha = 1.0;\");\n\t\t\t}\n\t\t\tif (litShader.needsNormal) {\n\t\t\t\tif (options.normalMap || options.clearCoatNormalMap) {\n\t\t\t\t\tcode.append(options.packedNormal ? litShader.chunks.normalXYPS : litShader.chunks.normalXYZPS);\n\t\t\t\t\tif (!options.litOptions.hasTangents) {\n\t\t\t\t\t\tconst baseName = options.normalMap ? \"normalMap\" : \"clearCoatNormalMap\";\n\t\t\t\t\t\tlightingUv = this._getUvSourceExpression(`${baseName}Transform`, `${baseName}Uv`, options);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tdecl.append(\"vec3 dNormalW;\");\n\t\t\t\tcode.append(this._addMap(\"normalDetail\", \"normalDetailMapPS\", options, litShader.chunks, textureMapping));\n\t\t\t\tcode.append(this._addMap(\"normal\", \"normalMapPS\", options, litShader.chunks, textureMapping));\n\t\t\t\tfunc.append(\"getNormal();\");\n\t\t\t\targs.append(\"litArgs_worldNormal = dNormalW;\");\n\t\t\t}\n\t\t\tif (litShader.needsSceneColor) {\n\t\t\t\tdecl.append(\"uniform sampler2D uSceneColorMap;\");\n\t\t\t}\n\t\t\tif (litShader.needsScreenSize) {\n\t\t\t\tdecl.append(\"uniform vec4 uScreenSize;\");\n\t\t\t}\n\t\t\tif (litShader.needsTransforms) {\n\t\t\t\tdecl.append(\"uniform mat4 matrix_viewProjection;\");\n\t\t\t\tdecl.append(\"uniform mat4 matrix_model;\");\n\t\t\t}\n\t\t\tif (options.diffuseDetail || options.aoDetail) {\n\t\t\t\tcode.append(litShader.chunks.detailModesPS);\n\t\t\t}\n\t\t\tdecl.append(\"vec3 dAlbedo;\");\n\t\t\tif (options.diffuseDetail) {\n\t\t\t\tcode.append(this._addMap(\"diffuseDetail\", \"diffuseDetailMapPS\", options, litShader.chunks, textureMapping, options.diffuseDetailEncoding));\n\t\t\t}\n\t\t\tcode.append(this._addMap(\"diffuse\", \"diffusePS\", options, litShader.chunks, textureMapping, options.diffuseEncoding));\n\t\t\tfunc.append(\"getAlbedo();\");\n\t\t\targs.append(\"litArgs_albedo = dAlbedo;\");\n\t\t\tif (options.litOptions.useRefraction) {\n\t\t\t\tdecl.append(\"float dTransmission;\");\n\t\t\t\tcode.append(this._addMap(\"refraction\", \"transmissionPS\", options, litShader.chunks, textureMapping));\n\t\t\t\tfunc.append(\"getRefraction();\");\n\t\t\t\targs.append(\"litArgs_transmission = dTransmission;\");\n\t\t\t\tdecl.append(\"float dThickness;\");\n\t\t\t\tcode.append(this._addMap(\"thickness\", \"thicknessPS\", options, litShader.chunks, textureMapping));\n\t\t\t\tfunc.append(\"getThickness();\");\n\t\t\t\targs.append(\"litArgs_thickness = dThickness;\");\n\t\t\t}\n\t\t\tif (options.litOptions.useIridescence) {\n\t\t\t\tdecl.append(\"float dIridescence;\");\n\t\t\t\tcode.append(this._addMap(\"iridescence\", \"iridescencePS\", options, litShader.chunks, textureMapping));\n\t\t\t\tfunc.append(\"getIridescence();\");\n\t\t\t\targs.append(\"litArgs_iridescence_intensity = dIridescence;\");\n\t\t\t\tdecl.append(\"float dIridescenceThickness;\");\n\t\t\t\tcode.append(this._addMap(\"iridescenceThickness\", \"iridescenceThicknessPS\", options, litShader.chunks, textureMapping));\n\t\t\t\tfunc.append(\"getIridescenceThickness();\");\n\t\t\t\targs.append(\"litArgs_iridescence_thickness = dIridescenceThickness;\");\n\t\t\t}\n\t\t\tif (litShader.lighting && options.litOptions.useSpecular || litShader.reflections) {\n\t\t\t\tdecl.append(\"vec3 dSpecularity;\");\n\t\t\t\tdecl.append(\"float dGlossiness;\");\n\t\t\t\tif (options.litOptions.useSheen) {\n\t\t\t\t\tdecl.append(\"vec3 sSpecularity;\");\n\t\t\t\t\tcode.append(this._addMap(\"sheen\", \"sheenPS\", options, litShader.chunks, textureMapping, options.sheenEncoding));\n\t\t\t\t\tfunc.append(\"getSheen();\");\n\t\t\t\t\targs.append(\"litArgs_sheen_specularity = sSpecularity;\");\n\t\t\t\t\tdecl.append(\"float sGlossiness;\");\n\t\t\t\t\tcode.append(this._addMap(\"sheenGloss\", \"sheenGlossPS\", options, litShader.chunks, textureMapping));\n\t\t\t\t\tfunc.append(\"getSheenGlossiness();\");\n\t\t\t\t\targs.append(\"litArgs_sheen_gloss = sGlossiness;\");\n\t\t\t\t}\n\t\t\t\tif (options.litOptions.useMetalness) {\n\t\t\t\t\tdecl.append(\"float dMetalness;\");\n\t\t\t\t\tcode.append(this._addMap(\"metalness\", \"metalnessPS\", options, litShader.chunks, textureMapping));\n\t\t\t\t\tfunc.append(\"getMetalness();\");\n\t\t\t\t\targs.append(\"litArgs_metalness = dMetalness;\");\n\t\t\t\t\tdecl.append(\"float dIor;\");\n\t\t\t\t\tcode.append(this._addMap(\"ior\", \"iorPS\", options, litShader.chunks, textureMapping));\n\t\t\t\t\tfunc.append(\"getIor();\");\n\t\t\t\t\targs.append(\"litArgs_ior = dIor;\");\n\t\t\t\t}\n\t\t\t\tif (options.litOptions.useSpecularityFactor) {\n\t\t\t\t\tdecl.append(\"float dSpecularityFactor;\");\n\t\t\t\t\tcode.append(this._addMap(\"specularityFactor\", \"specularityFactorPS\", options, litShader.chunks, textureMapping));\n\t\t\t\t\tfunc.append(\"getSpecularityFactor();\");\n\t\t\t\t\targs.append(\"litArgs_specularityFactor = dSpecularityFactor;\");\n\t\t\t\t}\n\t\t\t\tif (options.useSpecularColor) {\n\t\t\t\t\tcode.append(this._addMap(\"specular\", \"specularPS\", options, litShader.chunks, textureMapping, options.specularEncoding));\n\t\t\t\t} else {\n\t\t\t\t\tcode.append(\"void getSpecularity() { dSpecularity = vec3(1); }\");\n\t\t\t\t}\n\t\t\t\tcode.append(this._addMap(\"gloss\", \"glossPS\", options, litShader.chunks, textureMapping));\n\t\t\t\tfunc.append(\"getGlossiness();\");\n\t\t\t\tfunc.append(\"getSpecularity();\");\n\t\t\t\targs.append(\"litArgs_specularity = dSpecularity;\");\n\t\t\t\targs.append(\"litArgs_gloss = dGlossiness;\");\n\t\t\t} else {\n\t\t\t\tdecl.append(\"vec3 dSpecularity = vec3(0.0);\");\n\t\t\t\tdecl.append(\"float dGlossiness = 0.0;\");\n\t\t\t}\n\t\t\tif (options.aoDetail) {\n\t\t\t\tcode.append(this._addMap(\"aoDetail\", \"aoDetailMapPS\", options, litShader.chunks, textureMapping));\n\t\t\t}\n\t\t\tif (options.aoMap || options.aoVertexColor) {\n\t\t\t\tdecl.append(\"float dAo;\");\n\t\t\t\tcode.append(this._addMap(\"ao\", \"aoPS\", options, litShader.chunks, textureMapping));\n\t\t\t\tfunc.append(\"getAO();\");\n\t\t\t\targs.append(\"litArgs_ao = dAo;\");\n\t\t\t}\n\t\t\tdecl.append(\"vec3 dEmission;\");\n\t\t\tcode.append(this._addMap(\"emissive\", \"emissivePS\", options, litShader.chunks, textureMapping, options.emissiveEncoding));\n\t\t\tfunc.append(\"getEmission();\");\n\t\t\targs.append(\"litArgs_emission = dEmission;\");\n\t\t\tif (options.litOptions.useClearCoat) {\n\t\t\t\tdecl.append(\"float ccSpecularity;\");\n\t\t\t\tdecl.append(\"float ccGlossiness;\");\n\t\t\t\tdecl.append(\"vec3 ccNormalW;\");\n\t\t\t\tcode.append(this._addMap(\"clearCoat\", \"clearCoatPS\", options, litShader.chunks, textureMapping));\n\t\t\t\tcode.append(this._addMap(\"clearCoatGloss\", \"clearCoatGlossPS\", options, litShader.chunks, textureMapping));\n\t\t\t\tcode.append(this._addMap(\"clearCoatNormal\", \"clearCoatNormalPS\", options, litShader.chunks, textureMapping));\n\t\t\t\tfunc.append(\"getClearCoat();\");\n\t\t\t\tfunc.append(\"getClearCoatGlossiness();\");\n\t\t\t\tfunc.append(\"getClearCoatNormal();\");\n\t\t\t\targs.append(\"litArgs_clearcoat_specularity = ccSpecularity;\");\n\t\t\t\targs.append(\"litArgs_clearcoat_gloss = ccGlossiness;\");\n\t\t\t\targs.append(\"litArgs_clearcoat_worldNormal = ccNormalW;\");\n\t\t\t}\n\t\t\tif (options.lightMap || options.lightVertexColor) {\n\t\t\t\tconst lightmapDir = options.dirLightMap && options.litOptions.useSpecular;\n\t\t\t\tconst lightmapChunkPropName = lightmapDir ? 'lightmapDirPS' : 'lightmapSinglePS';\n\t\t\t\tdecl.append(\"vec3 dLightmap;\");\n\t\t\t\tif (lightmapDir) {\n\t\t\t\t\tdecl.append(\"vec3 dLightmapDir;\");\n\t\t\t\t}\n\t\t\t\tcode.append(this._addMap(\"light\", lightmapChunkPropName, options, litShader.chunks, textureMapping, options.lightMapEncoding));\n\t\t\t\tfunc.append(\"getLightMap();\");\n\t\t\t\targs.append(\"litArgs_lightmap = dLightmap;\");\n\t\t\t\tif (lightmapDir) {\n\t\t\t\t\targs.append(\"litArgs_lightmapDir = dLightmapDir;\");\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (code.code.indexOf('texture2DSRGB') !== -1 || code.code.indexOf('texture2DRGBM') !== -1 || code.code.indexOf('texture2DRGBE') !== -1) {\n\t\t\t\tcode.prepend(litShader.chunks.textureSamplePS);\n\t\t\t}\n\t\t} else {\n\t\t\tif (options.litOptions.alphaTest) {\n\t\t\t\tdecl.append(\"float dAlpha;\");\n\t\t\t\tcode.append(this._addMap(\"opacity\", \"opacityPS\", options, litShader.chunks, textureMapping));\n\t\t\t\tcode.append(litShader.chunks.alphaTestPS);\n\t\t\t\tfunc.append(\"getOpacity();\");\n\t\t\t\tfunc.append(\"alphaTest(dAlpha);\");\n\t\t\t\targs.append(\"litArgs_opacity = dAlpha;\");\n\t\t\t}\n\t\t}\n\t\tdecl.append(litShader.chunks.litShaderArgsPS);\n\t\tcode.append(`void evaluateFrontend() { \\n${func.code}\\n${args.code}\\n }\\n`);\n\t\tfunc.code = `evaluateFrontend();`;\n\t\tfor (const texture in textureMapping) {\n\t\t\tdecl.append(`uniform sampler2D ${textureMapping[texture]};`);\n\t\t}\n\t\tfunc.code = `\\n${func.code.split('\\n').map(l => `    ${l}`).join('\\n')}\\n\\n`;\n\t\tlitShader.generateFragmentShader(decl.code, code.code, func.code, lightingUv);\n\t\treturn litShader.getDefinition();\n\t}\n}\nconst standard = new ShaderGeneratorStandard();\n\nexport { _matTex2D, standard };\n","import { PIXELFORMAT_DXT5, TEXTURETYPE_SWIZZLEGGGR, PIXELFORMAT_RGBA8 } from '../../platform/graphics/constants.js';\nimport { SHADER_FORWARDHDR, GAMMA_SRGBHDR, TONEMAP_LINEAR, SHADERDEF_TANGENTS, SHADERDEF_SCREENSPACE, SHADERDEF_SKIN, SHADERDEF_INSTANCING, SHADERDEF_MORPH_POSITION, SHADERDEF_MORPH_NORMAL, SHADERDEF_MORPH_TEXTURE_BASED, BLEND_NONE, SPECULAR_PHONG, GAMMA_NONE, SHADERDEF_NOSHADOW, SHADERDEF_LM, SHADERDEF_DIRLM, SHADERDEF_LMAMBIENT, MASK_AFFECT_DYNAMIC, LIGHTTYPE_DIRECTIONAL, LIGHTTYPE_OMNI, LIGHTTYPE_SPOT, SHADERDEF_UV0, SHADERDEF_UV1, SHADERDEF_VCOLOR } from '../constants.js';\nimport { _matTex2D } from '../shader-lib/programs/standard.js';\nimport { LitMaterialOptionsBuilder } from './lit-material-options-builder.js';\n\nconst arraysEqual = (a, b) => {\n\tif (a.length !== b.length) {\n\t\treturn false;\n\t}\n\tfor (let i = 0; i < a.length; ++i) {\n\t\tif (a[i] !== b[i]) {\n\t\t\treturn false;\n\t\t}\n\t}\n\treturn true;\n};\nconst notWhite = color => {\n\treturn color.r !== 1 || color.g !== 1 || color.b !== 1;\n};\nconst notBlack = color => {\n\treturn color.r !== 0 || color.g !== 0 || color.b !== 0;\n};\nclass StandardMaterialOptionsBuilder {\n\tconstructor() {\n\t\tthis._mapXForms = null;\n\t}\n\tupdateMinRef(options, scene, stdMat, objDefs, pass, sortedLights) {\n\t\tthis._updateSharedOptions(options, scene, stdMat, objDefs, pass);\n\t\tthis._updateMinOptions(options, stdMat);\n\t\tthis._updateUVOptions(options, stdMat, objDefs, true);\n\t}\n\tupdateRef(options, scene, stdMat, objDefs, pass, sortedLights) {\n\t\tthis._updateSharedOptions(options, scene, stdMat, objDefs, pass);\n\t\tthis._updateEnvOptions(options, stdMat, scene);\n\t\tthis._updateMaterialOptions(options, stdMat);\n\t\tif (pass === SHADER_FORWARDHDR) {\n\t\t\tif (options.litOptions.gamma) options.litOptions.gamma = GAMMA_SRGBHDR;\n\t\t\toptions.litOptions.toneMap = TONEMAP_LINEAR;\n\t\t}\n\t\toptions.litOptions.hasTangents = objDefs && (objDefs & SHADERDEF_TANGENTS) !== 0;\n\t\tthis._updateLightOptions(options, scene, stdMat, objDefs, sortedLights);\n\t\tthis._updateUVOptions(options, stdMat, objDefs, false);\n\t}\n\t_updateSharedOptions(options, scene, stdMat, objDefs, pass) {\n\t\toptions.forceUv1 = stdMat.forceUv1;\n\t\tif (stdMat.userAttributes) {\n\t\t\toptions.litOptions.userAttributes = Object.fromEntries(stdMat.userAttributes.entries());\n\t\t}\n\t\toptions.litOptions.chunks = stdMat.chunks || {};\n\t\toptions.litOptions.pass = pass;\n\t\toptions.litOptions.alphaTest = stdMat.alphaTest > 0;\n\t\toptions.litOptions.blendType = stdMat.blendType;\n\t\toptions.litOptions.screenSpace = objDefs && (objDefs & SHADERDEF_SCREENSPACE) !== 0;\n\t\toptions.litOptions.skin = objDefs && (objDefs & SHADERDEF_SKIN) !== 0;\n\t\toptions.litOptions.useInstancing = objDefs && (objDefs & SHADERDEF_INSTANCING) !== 0;\n\t\toptions.litOptions.useMorphPosition = objDefs && (objDefs & SHADERDEF_MORPH_POSITION) !== 0;\n\t\toptions.litOptions.useMorphNormal = objDefs && (objDefs & SHADERDEF_MORPH_NORMAL) !== 0;\n\t\toptions.litOptions.useMorphTextureBased = objDefs && (objDefs & SHADERDEF_MORPH_TEXTURE_BASED) !== 0;\n\t\toptions.litOptions.nineSlicedMode = stdMat.nineSlicedMode || 0;\n\t\tif (scene.clusteredLightingEnabled && stdMat.useLighting) {\n\t\t\toptions.litOptions.clusteredLightingEnabled = true;\n\t\t\toptions.litOptions.clusteredLightingCookiesEnabled = scene.lighting.cookiesEnabled;\n\t\t\toptions.litOptions.clusteredLightingShadowsEnabled = scene.lighting.shadowsEnabled;\n\t\t\toptions.litOptions.clusteredLightingShadowType = scene.lighting.shadowType;\n\t\t\toptions.litOptions.clusteredLightingAreaLightsEnabled = scene.lighting.areaLightsEnabled;\n\t\t} else {\n\t\t\toptions.litOptions.clusteredLightingEnabled = false;\n\t\t\toptions.litOptions.clusteredLightingCookiesEnabled = false;\n\t\t\toptions.litOptions.clusteredLightingShadowsEnabled = false;\n\t\t\toptions.litOptions.clusteredLightingAreaLightsEnabled = false;\n\t\t}\n\t}\n\t_updateUVOptions(options, stdMat, objDefs, minimalOptions) {\n\t\tlet hasUv0 = false;\n\t\tlet hasUv1 = false;\n\t\tlet hasVcolor = false;\n\t\tif (objDefs) {\n\t\t\thasUv0 = (objDefs & SHADERDEF_UV0) !== 0;\n\t\t\thasUv1 = (objDefs & SHADERDEF_UV1) !== 0;\n\t\t\thasVcolor = (objDefs & SHADERDEF_VCOLOR) !== 0;\n\t\t}\n\t\toptions.litOptions.vertexColors = false;\n\t\tthis._mapXForms = [];\n\t\tconst uniqueTextureMap = {};\n\t\tfor (const p in _matTex2D) {\n\t\t\tthis._updateTexOptions(options, stdMat, p, hasUv0, hasUv1, hasVcolor, minimalOptions, uniqueTextureMap);\n\t\t}\n\t\tthis._mapXForms = null;\n\t\toptions.litOptions.lightMapEnabled = options.lightMap;\n\t\toptions.litOptions.dirLightMapEnabled = options.dirLightMap;\n\t\toptions.litOptions.useHeights = options.heightMap;\n\t\toptions.litOptions.useNormals = options.normalMap;\n\t\toptions.litOptions.useClearCoatNormals = options.clearCoatNormalMap;\n\t\toptions.litOptions.useAo = options.aoMap || options.aoVertexColor;\n\t\toptions.litOptions.diffuseMapEnabled = options.diffuseMap;\n\t}\n\t_updateTexOptions(options, stdMat, p, hasUv0, hasUv1, hasVcolor, minimalOptions, uniqueTextureMap) {\n\t\tconst isOpacity = p === 'opacity';\n\t\tif (!minimalOptions || isOpacity) {\n\t\t\tconst mname = p + 'Map';\n\t\t\tconst vname = p + 'VertexColor';\n\t\t\tconst vcname = p + 'VertexColorChannel';\n\t\t\tconst cname = mname + 'Channel';\n\t\t\tconst tname = mname + 'Transform';\n\t\t\tconst uname = mname + 'Uv';\n\t\t\tconst iname = mname + 'Identifier';\n\t\t\tif (p !== 'light') {\n\t\t\t\toptions[mname] = false;\n\t\t\t\toptions[iname] = undefined;\n\t\t\t\toptions[cname] = '';\n\t\t\t\toptions[tname] = 0;\n\t\t\t\toptions[uname] = 0;\n\t\t\t}\n\t\t\toptions[vname] = false;\n\t\t\toptions[vcname] = '';\n\t\t\tif (isOpacity && stdMat.blendType === BLEND_NONE && stdMat.alphaTest === 0.0 && !stdMat.alphaToCoverage) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (p !== 'height' && stdMat[vname]) {\n\t\t\t\tif (hasVcolor) {\n\t\t\t\t\toptions[vname] = stdMat[vname];\n\t\t\t\t\toptions[vcname] = stdMat[vcname];\n\t\t\t\t\toptions.litOptions.vertexColors = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (stdMat[mname]) {\n\t\t\t\tlet allow = true;\n\t\t\t\tif (stdMat[uname] === 0 && !hasUv0) allow = false;\n\t\t\t\tif (stdMat[uname] === 1 && !hasUv1) allow = false;\n\t\t\t\tif (allow) {\n\t\t\t\t\tconst mapId = stdMat[mname].id;\n\t\t\t\t\tlet identifier = uniqueTextureMap[mapId];\n\t\t\t\t\tif (identifier === undefined) {\n\t\t\t\t\t\tuniqueTextureMap[mapId] = p;\n\t\t\t\t\t\tidentifier = p;\n\t\t\t\t\t}\n\t\t\t\t\toptions[mname] = !!stdMat[mname];\n\t\t\t\t\toptions[iname] = identifier;\n\t\t\t\t\toptions[tname] = this._getMapTransformID(stdMat.getUniform(tname), stdMat[uname]);\n\t\t\t\t\toptions[cname] = stdMat[cname];\n\t\t\t\t\toptions[uname] = stdMat[uname];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t_updateMinOptions(options, stdMat) {\n\t\toptions.opacityTint = stdMat.opacity !== 1 && stdMat.blendType !== BLEND_NONE;\n\t\toptions.litOptions.lights = [];\n\t}\n\t_updateMaterialOptions(options, stdMat) {\n\t\tvar _stdMat$diffuseMap, _stdMat$diffuseDetail, _stdMat$emissiveMap, _stdMat$lightMap;\n\t\tconst diffuseTint = (stdMat.diffuseTint || !stdMat.diffuseMap && !stdMat.diffuseVertexColor) && notWhite(stdMat.diffuse);\n\t\tconst useSpecular = !!(stdMat.useMetalness || stdMat.specularMap || stdMat.sphereMap || stdMat.cubeMap || notBlack(stdMat.specular) || stdMat.specularityFactor > 0 && stdMat.useMetalness || stdMat.enableGGXSpecular || stdMat.clearCoat > 0);\n\t\tconst useSpecularColor = !stdMat.useMetalness || stdMat.useMetalnessSpecularColor;\n\t\tconst specularTint = useSpecular && (stdMat.specularTint || !stdMat.specularMap && !stdMat.specularVertexColor) && notWhite(stdMat.specular);\n\t\tconst specularityFactorTint = useSpecular && stdMat.useMetalnessSpecularColor && (stdMat.specularityFactorTint || stdMat.specularityFactor < 1 && !stdMat.specularityFactorMap);\n\t\tconst emissiveTintColor = !stdMat.emissiveMap || notWhite(stdMat.emissive) && stdMat.emissiveTint;\n\t\tconst emissiveTintIntensity = stdMat.emissiveIntensity !== 1;\n\t\tconst isPackedNormalMap = stdMat.normalMap ? stdMat.normalMap.format === PIXELFORMAT_DXT5 || stdMat.normalMap.type === TEXTURETYPE_SWIZZLEGGGR : false;\n\t\toptions.opacityTint = stdMat.opacity !== 1 && stdMat.blendType !== BLEND_NONE ? 1 : 0;\n\t\toptions.ambientTint = stdMat.ambientTint;\n\t\toptions.diffuseTint = diffuseTint ? 2 : 0;\n\t\toptions.specularTint = specularTint ? 2 : 0;\n\t\toptions.specularityFactorTint = specularityFactorTint ? 1 : 0;\n\t\toptions.metalnessTint = stdMat.useMetalness && stdMat.metalness < 1 ? 1 : 0;\n\t\toptions.glossTint = 1;\n\t\toptions.emissiveTint = (emissiveTintColor ? 2 : 0) + (emissiveTintIntensity ? 1 : 0);\n\t\toptions.diffuseEncoding = (_stdMat$diffuseMap = stdMat.diffuseMap) == null ? void 0 : _stdMat$diffuseMap.encoding;\n\t\toptions.diffuseDetailEncoding = (_stdMat$diffuseDetail = stdMat.diffuseDetailMap) == null ? void 0 : _stdMat$diffuseDetail.encoding;\n\t\toptions.emissiveEncoding = (_stdMat$emissiveMap = stdMat.emissiveMap) == null ? void 0 : _stdMat$emissiveMap.encoding;\n\t\toptions.lightMapEncoding = (_stdMat$lightMap = stdMat.lightMap) == null ? void 0 : _stdMat$lightMap.encoding;\n\t\toptions.packedNormal = isPackedNormalMap;\n\t\toptions.refractionTint = stdMat.refraction !== 1.0 ? 1 : 0;\n\t\toptions.refractionIndexTint = stdMat.refractionIndex !== 1.0 / 1.5 ? 1 : 0;\n\t\toptions.thicknessTint = stdMat.useDynamicRefraction && stdMat.thickness !== 1.0 ? 1 : 0;\n\t\toptions.specularEncoding = stdMat.specularEncoding || 'linear';\n\t\toptions.sheenEncoding = stdMat.sheenEncoding || 'linear';\n\t\toptions.aoMapUv = stdMat.aoUvSet;\n\t\toptions.aoDetail = !!stdMat.aoMap;\n\t\toptions.diffuseDetail = !!stdMat.diffuseMap;\n\t\toptions.normalDetail = !!stdMat.normalMap;\n\t\toptions.diffuseDetailMode = stdMat.diffuseDetailMode;\n\t\toptions.aoDetailMode = stdMat.aoDetailMode;\n\t\toptions.clearCoatTint = stdMat.clearCoat !== 1.0 ? 1 : 0;\n\t\toptions.clearCoatGloss = !!stdMat.clearCoatGloss;\n\t\toptions.clearCoatGlossTint = stdMat.clearCoatGloss !== 1.0 ? 1 : 0;\n\t\toptions.iorTint = stdMat.refractionIndex !== 1.0 / 1.5 ? 1 : 0;\n\t\toptions.iridescenceTint = stdMat.iridescence !== 1.0 ? 1 : 0;\n\t\toptions.sheenTint = stdMat.useSheen && notWhite(stdMat.sheen) ? 2 : 0;\n\t\toptions.sheenGlossTint = 1;\n\t\toptions.glossInvert = stdMat.glossInvert;\n\t\toptions.sheenGlossInvert = stdMat.sheenGlossInvert;\n\t\toptions.clearCoatGlossInvert = stdMat.clearCoatGlossInvert;\n\t\toptions.useSpecularColor = useSpecularColor;\n\t\toptions.litOptions.separateAmbient = false;\n\t\toptions.litOptions.useAmbientTint = stdMat.ambientTint;\n\t\toptions.litOptions.customFragmentShader = stdMat.customFragmentShader;\n\t\toptions.litOptions.pixelSnap = stdMat.pixelSnap;\n\t\toptions.litOptions.shadingModel = stdMat.shadingModel;\n\t\toptions.litOptions.ambientSH = !!stdMat.ambientSH;\n\t\toptions.litOptions.fastTbn = stdMat.fastTbn;\n\t\toptions.litOptions.twoSidedLighting = stdMat.twoSidedLighting;\n\t\toptions.litOptions.occludeSpecular = stdMat.occludeSpecular;\n\t\toptions.litOptions.occludeSpecularFloat = stdMat.occludeSpecularIntensity !== 1.0;\n\t\toptions.litOptions.useMsdf = !!stdMat.msdfMap;\n\t\toptions.litOptions.msdfTextAttribute = !!stdMat.msdfTextAttribute;\n\t\toptions.litOptions.alphaToCoverage = stdMat.alphaToCoverage;\n\t\toptions.litOptions.opacityFadesSpecular = stdMat.opacityFadesSpecular;\n\t\toptions.litOptions.cubeMapProjection = stdMat.cubeMapProjection;\n\t\toptions.litOptions.occludeDirect = stdMat.occludeDirect;\n\t\toptions.litOptions.conserveEnergy = stdMat.conserveEnergy && stdMat.shadingModel !== SPECULAR_PHONG;\n\t\toptions.litOptions.useSpecular = useSpecular;\n\t\toptions.litOptions.useSpecularityFactor = (specularityFactorTint || !!stdMat.specularityFactorMap) && stdMat.useMetalnessSpecularColor;\n\t\toptions.litOptions.enableGGXSpecular = stdMat.enableGGXSpecular;\n\t\toptions.litOptions.fresnelModel = stdMat.fresnelModel;\n\t\toptions.litOptions.useRefraction = (stdMat.refraction || !!stdMat.refractionMap) && (stdMat.useDynamicRefraction || !!options.litOptions.reflectionSource);\n\t\toptions.litOptions.useClearCoat = !!stdMat.clearCoat;\n\t\toptions.litOptions.useSheen = stdMat.useSheen;\n\t\toptions.litOptions.useIridescence = stdMat.useIridescence && stdMat.iridescence !== 0.0;\n\t\toptions.litOptions.useMetalness = stdMat.useMetalness;\n\t\toptions.litOptions.useDynamicRefraction = stdMat.useDynamicRefraction;\n\t}\n\t_updateEnvOptions(options, stdMat, scene) {\n\t\toptions.litOptions.fog = stdMat.useFog ? scene.fog : 'none';\n\t\toptions.litOptions.gamma = stdMat.useGammaTonemap ? scene.gammaCorrection : GAMMA_NONE;\n\t\toptions.litOptions.toneMap = stdMat.useGammaTonemap ? scene.toneMapping : -1;\n\t\toptions.litOptions.fixSeams = stdMat.cubeMap ? stdMat.cubeMap.fixCubemapSeams : false;\n\t\tconst isPhong = stdMat.shadingModel === SPECULAR_PHONG;\n\t\tlet usingSceneEnv = false;\n\t\tif (stdMat.envAtlas && stdMat.cubeMap && !isPhong) {\n\t\t\toptions.litOptions.reflectionSource = 'envAtlasHQ';\n\t\t\toptions.litOptions.reflectionEncoding = stdMat.envAtlas.encoding;\n\t\t\toptions.litOptions.reflectionCubemapEncoding = stdMat.cubeMap.encoding;\n\t\t} else if (stdMat.envAtlas && !isPhong) {\n\t\t\toptions.litOptions.reflectionSource = 'envAtlas';\n\t\t\toptions.litOptions.reflectionEncoding = stdMat.envAtlas.encoding;\n\t\t} else if (stdMat.cubeMap) {\n\t\t\toptions.litOptions.reflectionSource = 'cubeMap';\n\t\t\toptions.litOptions.reflectionEncoding = stdMat.cubeMap.encoding;\n\t\t} else if (stdMat.sphereMap) {\n\t\t\toptions.litOptions.reflectionSource = 'sphereMap';\n\t\t\toptions.litOptions.reflectionEncoding = stdMat.sphereMap.encoding;\n\t\t} else if (stdMat.useSkybox && scene.envAtlas && scene.skybox && !isPhong) {\n\t\t\toptions.litOptions.reflectionSource = 'envAtlasHQ';\n\t\t\toptions.litOptions.reflectionEncoding = scene.envAtlas.encoding;\n\t\t\toptions.litOptions.reflectionCubemapEncoding = scene.skybox.encoding;\n\t\t\tusingSceneEnv = true;\n\t\t} else if (stdMat.useSkybox && scene.envAtlas && !isPhong) {\n\t\t\toptions.litOptions.reflectionSource = 'envAtlas';\n\t\t\toptions.litOptions.reflectionEncoding = scene.envAtlas.encoding;\n\t\t\tusingSceneEnv = true;\n\t\t} else if (stdMat.useSkybox && scene.skybox) {\n\t\t\toptions.litOptions.reflectionSource = 'cubeMap';\n\t\t\toptions.litOptions.reflectionEncoding = scene.skybox.encoding;\n\t\t\tusingSceneEnv = true;\n\t\t} else {\n\t\t\toptions.litOptions.reflectionSource = null;\n\t\t\toptions.litOptions.reflectionEncoding = null;\n\t\t}\n\t\tif (stdMat.ambientSH && !isPhong) {\n\t\t\toptions.litOptions.ambientSource = 'ambientSH';\n\t\t\toptions.litOptions.ambientEncoding = null;\n\t\t} else {\n\t\t\tconst envAtlas = stdMat.envAtlas || (stdMat.useSkybox && scene.envAtlas ? scene.envAtlas : null);\n\t\t\tif (envAtlas && !isPhong) {\n\t\t\t\toptions.litOptions.ambientSource = 'envAtlas';\n\t\t\t\toptions.litOptions.ambientEncoding = envAtlas.encoding;\n\t\t\t} else {\n\t\t\t\toptions.litOptions.ambientSource = 'constant';\n\t\t\t\toptions.litOptions.ambientEncoding = null;\n\t\t\t}\n\t\t}\n\t\toptions.litOptions.skyboxIntensity = usingSceneEnv && (scene.skyboxIntensity !== 1 || scene.physicalUnits);\n\t\toptions.litOptions.useCubeMapRotation = usingSceneEnv && scene._skyboxRotationShaderInclude;\n\t}\n\t_updateLightOptions(options, scene, stdMat, objDefs, sortedLights) {\n\t\toptions.lightMap = false;\n\t\toptions.lightMapChannel = '';\n\t\toptions.lightMapUv = 0;\n\t\toptions.lightMapTransform = 0;\n\t\toptions.litOptions.lightMapWithoutAmbient = false;\n\t\toptions.dirLightMap = false;\n\t\tif (objDefs) {\n\t\t\toptions.litOptions.noShadow = (objDefs & SHADERDEF_NOSHADOW) !== 0;\n\t\t\tif ((objDefs & SHADERDEF_LM) !== 0) {\n\t\t\t\toptions.lightMapEncoding = scene.lightmapPixelFormat === PIXELFORMAT_RGBA8 ? 'rgbm' : 'linear';\n\t\t\t\toptions.lightMap = true;\n\t\t\t\toptions.lightMapChannel = 'rgb';\n\t\t\t\toptions.lightMapUv = 1;\n\t\t\t\toptions.lightMapTransform = 0;\n\t\t\t\toptions.litOptions.lightMapWithoutAmbient = !stdMat.lightMap;\n\t\t\t\tif ((objDefs & SHADERDEF_DIRLM) !== 0) {\n\t\t\t\t\toptions.dirLightMap = true;\n\t\t\t\t}\n\t\t\t\tif ((objDefs & SHADERDEF_LMAMBIENT) !== 0) {\n\t\t\t\t\toptions.litOptions.lightMapWithoutAmbient = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (stdMat.useLighting) {\n\t\t\tconst lightsFiltered = [];\n\t\t\tconst mask = objDefs ? objDefs >> 16 : MASK_AFFECT_DYNAMIC;\n\t\t\toptions.litOptions.lightMaskDynamic = !!(mask & MASK_AFFECT_DYNAMIC);\n\t\t\tif (sortedLights) {\n\t\t\t\tLitMaterialOptionsBuilder.collectLights(LIGHTTYPE_DIRECTIONAL, sortedLights[LIGHTTYPE_DIRECTIONAL], lightsFiltered, mask);\n\t\t\t\tLitMaterialOptionsBuilder.collectLights(LIGHTTYPE_OMNI, sortedLights[LIGHTTYPE_OMNI], lightsFiltered, mask);\n\t\t\t\tLitMaterialOptionsBuilder.collectLights(LIGHTTYPE_SPOT, sortedLights[LIGHTTYPE_SPOT], lightsFiltered, mask);\n\t\t\t}\n\t\t\toptions.litOptions.lights = lightsFiltered;\n\t\t} else {\n\t\t\toptions.litOptions.lights = [];\n\t\t}\n\t\tif (options.litOptions.lights.length === 0) {\n\t\t\toptions.litOptions.noShadow = true;\n\t\t}\n\t}\n\t_getMapTransformID(xform, uv) {\n\t\tif (!xform) return 0;\n\t\tlet xforms = this._mapXForms[uv];\n\t\tif (!xforms) {\n\t\t\txforms = [];\n\t\t\tthis._mapXForms[uv] = xforms;\n\t\t}\n\t\tfor (let i = 0; i < xforms.length; i++) {\n\t\t\tif (arraysEqual(xforms[i][0].value, xform[0].value) && arraysEqual(xforms[i][1].value, xform[1].value)) {\n\t\t\t\treturn i + 1;\n\t\t\t}\n\t\t}\n\t\treturn xforms.push(xform);\n\t}\n}\n\nexport { StandardMaterialOptionsBuilder };\n","import { extends as _extends } from '../../_virtual/_rollupPluginBabelHelpers.js';\n\nfunction _textureParameter(name, channel = true, vertexColor = true) {\n\tconst result = {};\n\tresult[`${name}Map`] = 'texture';\n\tresult[`${name}MapTiling`] = 'vec2';\n\tresult[`${name}MapOffset`] = 'vec2';\n\tresult[`${name}MapRotation`] = 'number';\n\tresult[`${name}MapUv`] = 'number';\n\tif (channel) {\n\t\tresult[`${name}MapChannel`] = 'string';\n\t\tif (vertexColor) {\n\t\t\tresult[`${name}VertexColor`] = 'boolean';\n\t\t\tresult[`${name}VertexColorChannel`] = 'string';\n\t\t}\n\t}\n\treturn result;\n}\nconst standardMaterialParameterTypes = _extends({\n\tname: 'string',\n\tchunks: 'chunks',\n\tmappingFormat: 'string',\n\t_engine: 'boolean',\n\tambient: 'rgb',\n\tambientTint: 'boolean'\n}, _textureParameter('ao'), _textureParameter('aoDetail', true, false), {\n\taoDetailMode: 'string',\n\tdiffuse: 'rgb',\n\tdiffuseTint: 'boolean'\n}, _textureParameter('diffuse'), _textureParameter('diffuseDetail', true, false), {\n\tdiffuseDetailMode: 'string',\n\tspecular: 'rgb',\n\tspecularTint: 'boolean'\n}, _textureParameter('specular'), {\n\toccludeSpecular: 'enum:occludeSpecular',\n\tspecularityFactor: 'number',\n\tspecularityFactorTint: 'boolean'\n}, _textureParameter('specularityFactor'), {\n\tuseMetalness: 'boolean',\n\tmetalness: 'number',\n\tenableGGXSpecular: 'boolean',\n\tanisotropy: 'number',\n\tmetalnessTint: 'boolean'\n}, _textureParameter('metalness'), {\n\tuseMetalnessSpecularColor: 'boolean',\n\tconserveEnergy: 'boolean',\n\tshininess: 'number',\n\tgloss: 'number',\n\tglossInvert: 'boolean'\n}, _textureParameter('gloss'), {\n\tclearCoat: 'number'\n}, _textureParameter('clearCoat'), {\n\tclearCoatGloss: 'number',\n\tclearCoatGlossInvert: 'boolean'\n}, _textureParameter('clearCoatGloss'), {\n\tclearCoatBumpiness: 'number'\n}, _textureParameter('clearCoatNormal', false), {\n\tuseSheen: 'boolean',\n\tsheen: 'rgb',\n\tsheenTint: 'boolean'\n}, _textureParameter('sheen'), {\n\tsheenGloss: 'number',\n\tsheenGlossTint: 'boolean',\n\tsheenGlossInvert: 'boolean'\n}, _textureParameter('sheenGloss'), {\n\tfresnelModel: 'number',\n\temissive: 'rgb',\n\temissiveTint: 'boolean'\n}, _textureParameter('emissive'), {\n\temissiveIntensity: 'number'\n}, _textureParameter('normal', false), {\n\tbumpiness: 'number'\n}, _textureParameter('normalDetail', false), {\n\tnormalDetailMapBumpiness: 'number'\n}, _textureParameter('height', true, false), {\n\theightMapFactor: 'number',\n\talphaToCoverage: 'boolean',\n\talphaTest: 'number',\n\talphaFade: 'number',\n\topacity: 'number'\n}, _textureParameter('opacity'), {\n\topacityFadesSpecular: 'boolean',\n\treflectivity: 'number',\n\trefraction: 'number',\n\trefractionTint: 'boolean'\n}, _textureParameter('refraction'), {\n\trefractionIndex: 'number',\n\tthickness: 'number',\n\tthicknessTint: 'boolean'\n}, _textureParameter('thickness'), {\n\tattenuation: 'rgb',\n\tattenuationDistance: 'number',\n\tuseDynamicRefraction: 'boolean',\n\tsphereMap: 'texture',\n\tcubeMap: 'cubemap',\n\tcubeMapProjection: 'number',\n\tcubeMapProjectionBox: 'boundingbox',\n\tuseIridescence: 'boolean',\n\tiridescence: 'number',\n\tiridescenceTint: 'boolean'\n}, _textureParameter('iridescence'), {\n\tiridescenceThicknessTint: 'boolean',\n\tiridescenceThicknessMin: 'number',\n\tiridescenceThicknessMax: 'number',\n\tiridescenceRefractionIndex: 'number'\n}, _textureParameter('iridescenceThickness'), _textureParameter('light'), {\n\tdepthTest: 'boolean',\n\tdepthFunc: 'enum:depthFunc',\n\tdepthWrite: 'boolean',\n\tdepthBias: 'number',\n\tslopeDepthBias: 'number',\n\tcull: 'enum:cull',\n\tblendType: 'enum:blendType',\n\tshadingModel: 'enum:shadingModel',\n\tuseFog: 'boolean',\n\tuseLighting: 'boolean',\n\tuseSkybox: 'boolean',\n\tuseGammaTonemap: 'boolean',\n\tenvAtlas: 'texture',\n\ttwoSidedLighting: 'boolean'\n});\nconst standardMaterialTextureParameters = [];\nfor (const key in standardMaterialParameterTypes) {\n\tconst type = standardMaterialParameterTypes[key];\n\tif (type === 'texture') {\n\t\tstandardMaterialTextureParameters.push(key);\n\t}\n}\nconst standardMaterialCubemapParameters = [];\nfor (const key in standardMaterialParameterTypes) {\n\tconst type = standardMaterialParameterTypes[key];\n\tif (type === 'cubemap') {\n\t\tstandardMaterialCubemapParameters.push(key);\n\t}\n}\nconst standardMaterialRemovedParameters = {\n\taoMapVertexColor: 'boolean',\n\tdiffuseMapTint: 'boolean',\n\tdiffuseMapVertexColor: 'boolean',\n\temissiveMapTint: 'boolean',\n\temissiveMapVertexColor: 'boolean',\n\tglossMapVertexColor: 'boolean',\n\tmetalnessMapVertexColor: 'boolean',\n\topacityMapVertexColor: 'boolean',\n\tspecularAntialias: 'boolean',\n\tspecularMapTint: 'boolean',\n\tspecularMapVertexColor: 'boolean'\n};\n\nexport { standardMaterialCubemapParameters, standardMaterialParameterTypes, standardMaterialRemovedParameters, standardMaterialTextureParameters };\n","import '../../core/tracing.js';\nimport { Color } from '../../core/math/color.js';\nimport { math } from '../../core/math/math.js';\nimport { Vec2 } from '../../core/math/vec2.js';\nimport { ShaderProcessorOptions } from '../../platform/graphics/shader-processor-options.js';\nimport { CUBEPROJ_BOX, SPECULAR_PHONG, SHADER_DEPTH, SHADER_PICK, SPECOCC_AO, SPECULAR_BLINN, FRESNEL_SCHLICK, CUBEPROJ_NONE, DETAILMODE_MUL } from '../constants.js';\nimport { ShaderPass } from '../shader-pass.js';\nimport { EnvLighting } from '../graphics/env-lighting.js';\nimport { getProgramLibrary } from '../shader-lib/get-program-library.js';\nimport { _matTex2D, standard } from '../shader-lib/programs/standard.js';\nimport { Material } from './material.js';\nimport { StandardMaterialOptionsBuilder } from './standard-material-options-builder.js';\nimport { standardMaterialTextureParameters, standardMaterialCubemapParameters } from './standard-material-parameters.js';\n\nconst _props = {};\nconst _uniforms = {};\nlet _params = new Set();\nclass StandardMaterial extends Material {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.userAttributes = new Map();\n\t\tthis._dirtyShader = true;\n\t\tthis._assetReferences = {};\n\t\tthis._activeParams = new Set();\n\t\tthis._activeLightingParams = new Set();\n\t\tthis.shaderOptBuilder = new StandardMaterialOptionsBuilder();\n\t\tthis.reset();\n\t}\n\treset() {\n\t\tObject.keys(_props).forEach(name => {\n\t\t\tthis[`_${name}`] = _props[name].value();\n\t\t});\n\t\tthis._chunks = {};\n\t\tthis._uniformCache = {};\n\t}\n\tset shader(shader) {}\n\tget shader() {\n\t\treturn null;\n\t}\n\tset chunks(value) {\n\t\tthis._dirtyShader = true;\n\t\tthis._chunks = value;\n\t}\n\tget chunks() {\n\t\tthis._dirtyShader = true;\n\t\treturn this._chunks;\n\t}\n\tcopy(source) {\n\t\tsuper.copy(source);\n\t\tObject.keys(_props).forEach(k => {\n\t\t\tthis[k] = source[k];\n\t\t});\n\t\tfor (const p in source._chunks) {\n\t\t\tif (source._chunks.hasOwnProperty(p)) this._chunks[p] = source._chunks[p];\n\t\t}\n\t\treturn this;\n\t}\n\tsetAttribute(name, semantic) {\n\t\tthis.userAttributes.set(semantic, name);\n\t}\n\t_setParameter(name, value) {\n\t\t_params.add(name);\n\t\tthis.setParameter(name, value);\n\t}\n\t_setParameters(parameters) {\n\t\tparameters.forEach(v => {\n\t\t\tthis._setParameter(v.name, v.value);\n\t\t});\n\t}\n\t_processParameters(paramsName) {\n\t\tconst prevParams = this[paramsName];\n\t\tprevParams.forEach(param => {\n\t\t\tif (!_params.has(param)) {\n\t\t\t\tdelete this.parameters[param];\n\t\t\t}\n\t\t});\n\t\tthis[paramsName] = _params;\n\t\t_params = prevParams;\n\t\t_params.clear();\n\t}\n\t_updateMap(p) {\n\t\tconst mname = p + 'Map';\n\t\tconst map = this[mname];\n\t\tif (map) {\n\t\t\tthis._setParameter('texture_' + mname, map);\n\t\t\tconst tname = mname + 'Transform';\n\t\t\tconst uniform = this.getUniform(tname);\n\t\t\tif (uniform) {\n\t\t\t\tthis._setParameters(uniform);\n\t\t\t}\n\t\t}\n\t}\n\t_allocUniform(name, allocFunc) {\n\t\tlet uniform = this._uniformCache[name];\n\t\tif (!uniform) {\n\t\t\tuniform = allocFunc();\n\t\t\tthis._uniformCache[name] = uniform;\n\t\t}\n\t\treturn uniform;\n\t}\n\tgetUniform(name, device, scene) {\n\t\treturn _uniforms[name](this, device, scene);\n\t}\n\tupdateUniforms(device, scene) {\n\t\tconst getUniform = name => {\n\t\t\treturn this.getUniform(name, device, scene);\n\t\t};\n\t\tthis._setParameter('material_ambient', getUniform('ambient'));\n\t\tif (!this.diffuseMap || this.diffuseTint) {\n\t\t\tthis._setParameter('material_diffuse', getUniform('diffuse'));\n\t\t}\n\t\tif (this.useMetalness) {\n\t\t\tif (!this.metalnessMap || this.metalness < 1) {\n\t\t\t\tthis._setParameter('material_metalness', this.metalness);\n\t\t\t}\n\t\t\tif (!this.specularMap || this.specularTint) {\n\t\t\t\tthis._setParameter('material_specular', getUniform('specular'));\n\t\t\t}\n\t\t\tif (!this.specularityFactorMap || this.specularityFactorTint) {\n\t\t\t\tthis._setParameter('material_specularityFactor', this.specularityFactor);\n\t\t\t}\n\t\t\tif (!this.sheenMap || this.sheenTint) {\n\t\t\t\tthis._setParameter('material_sheen', getUniform('sheen'));\n\t\t\t}\n\t\t\tif (!this.sheenGlossMap || this.sheenGlossTint) {\n\t\t\t\tthis._setParameter('material_sheenGloss', this.sheenGloss);\n\t\t\t}\n\t\t\tthis._setParameter('material_refractionIndex', this.refractionIndex);\n\t\t} else {\n\t\t\tif (!this.specularMap || this.specularTint) {\n\t\t\t\tthis._setParameter('material_specular', getUniform('specular'));\n\t\t\t}\n\t\t}\n\t\tif (this.enableGGXSpecular) {\n\t\t\tthis._setParameter('material_anisotropy', this.anisotropy);\n\t\t}\n\t\tif (this.clearCoat > 0) {\n\t\t\tthis._setParameter('material_clearCoat', this.clearCoat);\n\t\t\tthis._setParameter('material_clearCoatGloss', this.clearCoatGloss);\n\t\t\tthis._setParameter('material_clearCoatBumpiness', this.clearCoatBumpiness);\n\t\t}\n\t\tthis._setParameter('material_gloss', getUniform('gloss'));\n\t\tif (!this.emissiveMap || this.emissiveTint) {\n\t\t\tthis._setParameter('material_emissive', getUniform('emissive'));\n\t\t}\n\t\tif (this.emissiveIntensity !== 1) {\n\t\t\tthis._setParameter('material_emissiveIntensity', this.emissiveIntensity);\n\t\t}\n\t\tif (this.refraction > 0) {\n\t\t\tthis._setParameter('material_refraction', this.refraction);\n\t\t}\n\t\tif (this.useDynamicRefraction) {\n\t\t\tthis._setParameter('material_thickness', this.thickness);\n\t\t\tthis._setParameter('material_attenuation', getUniform('attenuation'));\n\t\t\tthis._setParameter('material_invAttenuationDistance', this.attenuationDistance === 0 ? 0 : 1.0 / this.attenuationDistance);\n\t\t}\n\t\tif (this.useIridescence) {\n\t\t\tthis._setParameter('material_iridescence', this.iridescence);\n\t\t\tthis._setParameter('material_iridescenceRefractionIndex', this.iridescenceRefractionIndex);\n\t\t\tthis._setParameter('material_iridescenceThicknessMin', this.iridescenceThicknessMin);\n\t\t\tthis._setParameter('material_iridescenceThicknessMax', this.iridescenceThicknessMax);\n\t\t}\n\t\tthis._setParameter('material_opacity', this.opacity);\n\t\tif (this.opacityFadesSpecular === false) {\n\t\t\tthis._setParameter('material_alphaFade', this.alphaFade);\n\t\t}\n\t\tif (this.occludeSpecular) {\n\t\t\tthis._setParameter('material_occludeSpecularIntensity', this.occludeSpecularIntensity);\n\t\t}\n\t\tif (this.cubeMapProjection === CUBEPROJ_BOX) {\n\t\t\tthis._setParameter(getUniform('cubeMapProjectionBox'));\n\t\t}\n\t\tfor (const p in _matTex2D) {\n\t\t\tthis._updateMap(p);\n\t\t}\n\t\tif (this.ambientSH) {\n\t\t\tthis._setParameter('ambientSH[0]', this.ambientSH);\n\t\t}\n\t\tif (this.normalMap) {\n\t\t\tthis._setParameter('material_bumpiness', this.bumpiness);\n\t\t}\n\t\tif (this.normalMap && this.normalDetailMap) {\n\t\t\tthis._setParameter('material_normalDetailMapBumpiness', this.normalDetailMapBumpiness);\n\t\t}\n\t\tif (this.heightMap) {\n\t\t\tthis._setParameter('material_heightMapFactor', getUniform('heightMapFactor'));\n\t\t}\n\t\tconst isPhong = this.shadingModel === SPECULAR_PHONG;\n\t\tif (this.envAtlas && this.cubeMap && !isPhong) {\n\t\t\tthis._setParameter('texture_envAtlas', this.envAtlas);\n\t\t\tthis._setParameter('texture_cubeMap', this.cubeMap);\n\t\t} else if (this.envAtlas && !isPhong) {\n\t\t\tthis._setParameter('texture_envAtlas', this.envAtlas);\n\t\t} else if (this.cubeMap) {\n\t\t\tthis._setParameter('texture_cubeMap', this.cubeMap);\n\t\t} else if (this.sphereMap) {\n\t\t\tthis._setParameter('texture_sphereMap', this.sphereMap);\n\t\t}\n\t\tthis._setParameter('material_reflectivity', this.reflectivity);\n\t\tthis._processParameters('_activeParams');\n\t\tif (this._dirtyShader) {\n\t\t\tthis.clearVariants();\n\t\t}\n\t}\n\tupdateEnvUniforms(device, scene) {\n\t\tconst isPhong = this.shadingModel === SPECULAR_PHONG;\n\t\tconst hasLocalEnvOverride = this.envAtlas && !isPhong || this.cubeMap || this.sphereMap;\n\t\tif (!hasLocalEnvOverride && this.useSkybox) {\n\t\t\tif (scene.envAtlas && scene.skybox && !isPhong) {\n\t\t\t\tthis._setParameter('texture_envAtlas', scene.envAtlas);\n\t\t\t\tthis._setParameter('texture_cubeMap', scene.skybox);\n\t\t\t} else if (scene.envAtlas && !isPhong) {\n\t\t\t\tthis._setParameter('texture_envAtlas', scene.envAtlas);\n\t\t\t} else if (scene.skybox) {\n\t\t\t\tthis._setParameter('texture_cubeMap', scene.skybox);\n\t\t\t}\n\t\t}\n\t\tthis._processParameters('_activeLightingParams');\n\t}\n\tgetShaderVariant(device, scene, objDefs, unused, pass, sortedLights, viewUniformFormat, viewBindGroupFormat, vertexFormat) {\n\t\tthis.updateEnvUniforms(device, scene);\n\t\tconst shaderPassInfo = ShaderPass.get(device).getByIndex(pass);\n\t\tconst minimalOptions = pass === SHADER_DEPTH || pass === SHADER_PICK || shaderPassInfo.isShadow;\n\t\tlet options = minimalOptions ? standard.optionsContextMin : standard.optionsContext;\n\t\tif (minimalOptions) this.shaderOptBuilder.updateMinRef(options, scene, this, objDefs, pass, sortedLights);else this.shaderOptBuilder.updateRef(options, scene, this, objDefs, pass, sortedLights);\n\t\tif (this.onUpdateShader) {\n\t\t\toptions = this.onUpdateShader(options);\n\t\t}\n\t\tconst processingOptions = new ShaderProcessorOptions(viewUniformFormat, viewBindGroupFormat, vertexFormat);\n\t\tconst library = getProgramLibrary(device);\n\t\tlibrary.register('standard', standard);\n\t\tconst shader = library.getProgram('standard', options, processingOptions, this.userId);\n\t\tthis._dirtyShader = false;\n\t\treturn shader;\n\t}\n\tdestroy() {\n\t\tfor (const asset in this._assetReferences) {\n\t\t\tthis._assetReferences[asset]._unbind();\n\t\t}\n\t\tthis._assetReferences = null;\n\t\tsuper.destroy();\n\t}\n}\nStandardMaterial.TEXTURE_PARAMETERS = standardMaterialTextureParameters;\nStandardMaterial.CUBEMAP_PARAMETERS = standardMaterialCubemapParameters;\nconst defineUniform = (name, getUniformFunc) => {\n\t_uniforms[name] = getUniformFunc;\n};\nconst definePropInternal = (name, constructorFunc, setterFunc, getterFunc) => {\n\tObject.defineProperty(StandardMaterial.prototype, name, {\n\t\tget: getterFunc || function () {\n\t\t\treturn this[`_${name}`];\n\t\t},\n\t\tset: setterFunc\n\t});\n\t_props[name] = {\n\t\tvalue: constructorFunc\n\t};\n};\nconst defineValueProp = prop => {\n\tconst internalName = `_${prop.name}`;\n\tconst dirtyShaderFunc = prop.dirtyShaderFunc || (() => true);\n\tconst setterFunc = function setterFunc(value) {\n\t\tconst oldValue = this[internalName];\n\t\tif (oldValue !== value) {\n\t\t\tthis._dirtyShader = this._dirtyShader || dirtyShaderFunc(oldValue, value);\n\t\t\tthis[internalName] = value;\n\t\t}\n\t};\n\tdefinePropInternal(prop.name, () => prop.defaultValue, setterFunc, prop.getterFunc);\n};\nconst defineAggProp = prop => {\n\tconst internalName = `_${prop.name}`;\n\tconst dirtyShaderFunc = prop.dirtyShaderFunc || (() => true);\n\tconst setterFunc = function setterFunc(value) {\n\t\tconst oldValue = this[internalName];\n\t\tif (!oldValue.equals(value)) {\n\t\t\tthis._dirtyShader = this._dirtyShader || dirtyShaderFunc(oldValue, value);\n\t\t\tthis[internalName] = oldValue.copy(value);\n\t\t}\n\t};\n\tdefinePropInternal(prop.name, () => prop.defaultValue.clone(), setterFunc, prop.getterFunc);\n};\nconst defineProp = prop => {\n\treturn prop.defaultValue && prop.defaultValue.clone ? defineAggProp(prop) : defineValueProp(prop);\n};\nfunction _defineTex2D(name, channel = \"rgb\", vertexColor = true, uv = 0) {\n\t_matTex2D[name] = channel.length || -1;\n\tdefineProp({\n\t\tname: `${name}Map`,\n\t\tdefaultValue: null,\n\t\tdirtyShaderFunc: (oldValue, newValue) => {\n\t\t\treturn !!oldValue !== !!newValue || oldValue && (oldValue.type !== newValue.type || oldValue.fixCubemapSeams !== newValue.fixCubemapSeams || oldValue.format !== newValue.format);\n\t\t}\n\t});\n\tdefineProp({\n\t\tname: `${name}MapTiling`,\n\t\tdefaultValue: new Vec2(1, 1)\n\t});\n\tdefineProp({\n\t\tname: `${name}MapOffset`,\n\t\tdefaultValue: new Vec2(0, 0)\n\t});\n\tdefineProp({\n\t\tname: `${name}MapRotation`,\n\t\tdefaultValue: 0\n\t});\n\tdefineProp({\n\t\tname: `${name}MapUv`,\n\t\tdefaultValue: uv\n\t});\n\tif (channel) {\n\t\tdefineProp({\n\t\t\tname: `${name}MapChannel`,\n\t\t\tdefaultValue: channel\n\t\t});\n\t\tif (vertexColor) {\n\t\t\tdefineProp({\n\t\t\t\tname: `${name}VertexColor`,\n\t\t\t\tdefaultValue: false\n\t\t\t});\n\t\t\tdefineProp({\n\t\t\t\tname: `${name}VertexColorChannel`,\n\t\t\t\tdefaultValue: channel\n\t\t\t});\n\t\t}\n\t}\n\tconst mapTiling = `${name}MapTiling`;\n\tconst mapOffset = `${name}MapOffset`;\n\tconst mapRotation = `${name}MapRotation`;\n\tconst mapTransform = `${name}MapTransform`;\n\tdefineUniform(mapTransform, (material, device, scene) => {\n\t\tconst tiling = material[mapTiling];\n\t\tconst offset = material[mapOffset];\n\t\tconst rotation = material[mapRotation];\n\t\tif (tiling.x === 1 && tiling.y === 1 && offset.x === 0 && offset.y === 0 && rotation === 0) {\n\t\t\treturn null;\n\t\t}\n\t\tconst uniform = material._allocUniform(mapTransform, () => {\n\t\t\treturn [{\n\t\t\t\tname: `texture_${mapTransform}0`,\n\t\t\t\tvalue: new Float32Array(3)\n\t\t\t}, {\n\t\t\t\tname: `texture_${mapTransform}1`,\n\t\t\t\tvalue: new Float32Array(3)\n\t\t\t}];\n\t\t});\n\t\tconst cr = Math.cos(rotation * math.DEG_TO_RAD);\n\t\tconst sr = Math.sin(rotation * math.DEG_TO_RAD);\n\t\tconst uniform0 = uniform[0].value;\n\t\tuniform0[0] = cr * tiling.x;\n\t\tuniform0[1] = -sr * tiling.y;\n\t\tuniform0[2] = offset.x;\n\t\tconst uniform1 = uniform[1].value;\n\t\tuniform1[0] = sr * tiling.x;\n\t\tuniform1[1] = cr * tiling.y;\n\t\tuniform1[2] = 1.0 - tiling.y - offset.y;\n\t\treturn uniform;\n\t});\n}\nfunction _defineColor(name, defaultValue) {\n\tdefineProp({\n\t\tname: name,\n\t\tdefaultValue: defaultValue,\n\t\tgetterFunc: function () {\n\t\t\tthis._dirtyShader = true;\n\t\t\treturn this[`_${name}`];\n\t\t}\n\t});\n\tdefineUniform(name, (material, device, scene) => {\n\t\tconst uniform = material._allocUniform(name, () => new Float32Array(3));\n\t\tconst color = material[name];\n\t\tconst gamma = material.useGammaTonemap && scene.gammaCorrection;\n\t\tif (gamma) {\n\t\t\tuniform[0] = Math.pow(color.r, 2.2);\n\t\t\tuniform[1] = Math.pow(color.g, 2.2);\n\t\t\tuniform[2] = Math.pow(color.b, 2.2);\n\t\t} else {\n\t\t\tuniform[0] = color.r;\n\t\t\tuniform[1] = color.g;\n\t\t\tuniform[2] = color.b;\n\t\t}\n\t\treturn uniform;\n\t});\n}\nfunction _defineFloat(name, defaultValue, getUniformFunc) {\n\tdefineProp({\n\t\tname: name,\n\t\tdefaultValue: defaultValue,\n\t\tdirtyShaderFunc: (oldValue, newValue) => {\n\t\t\treturn (oldValue === 0 || oldValue === 1) !== (newValue === 0 || newValue === 1);\n\t\t}\n\t});\n\tdefineUniform(name, getUniformFunc);\n}\nfunction _defineObject(name, getUniformFunc) {\n\tdefineProp({\n\t\tname: name,\n\t\tdefaultValue: null,\n\t\tdirtyShaderFunc: (oldValue, newValue) => {\n\t\t\treturn !!oldValue === !!newValue;\n\t\t}\n\t});\n\tdefineUniform(name, getUniformFunc);\n}\nfunction _defineFlag(name, defaultValue) {\n\tdefineProp({\n\t\tname: name,\n\t\tdefaultValue: defaultValue\n\t});\n}\nfunction _defineMaterialProps() {\n\t_defineColor('ambient', new Color(0.7, 0.7, 0.7));\n\t_defineColor('diffuse', new Color(1, 1, 1));\n\t_defineColor('specular', new Color(0, 0, 0));\n\t_defineColor('emissive', new Color(0, 0, 0));\n\t_defineColor('sheen', new Color(1, 1, 1));\n\t_defineColor('attenuation', new Color(1, 1, 1));\n\t_defineFloat('emissiveIntensity', 1);\n\t_defineFloat('specularityFactor', 1);\n\t_defineFloat('sheenGloss', 0.0);\n\t_defineFloat('gloss', 0.25, (material, device, scene) => {\n\t\treturn material.shadingModel === SPECULAR_PHONG ? Math.pow(2, material.gloss * 11) : material.gloss;\n\t});\n\t_defineFloat('heightMapFactor', 1, (material, device, scene) => {\n\t\treturn material.heightMapFactor * 0.025;\n\t});\n\t_defineFloat('opacity', 1);\n\t_defineFloat('alphaFade', 1);\n\t_defineFloat('alphaTest', 0);\n\t_defineFloat('bumpiness', 1);\n\t_defineFloat('normalDetailMapBumpiness', 1);\n\t_defineFloat('reflectivity', 1);\n\t_defineFloat('occludeSpecularIntensity', 1);\n\t_defineFloat('refraction', 0);\n\t_defineFloat('refractionIndex', 1.0 / 1.5);\n\t_defineFloat('thickness', 0);\n\t_defineFloat('attenuationDistance', 0);\n\t_defineFloat('metalness', 1);\n\t_defineFloat('anisotropy', 0);\n\t_defineFloat('clearCoat', 0);\n\t_defineFloat('clearCoatGloss', 1);\n\t_defineFloat('clearCoatBumpiness', 1);\n\t_defineFloat('aoUvSet', 0, null);\n\t_defineFloat('iridescence', 0);\n\t_defineFloat('iridescenceRefractionIndex', 1.0 / 1.5);\n\t_defineFloat('iridescenceThicknessMin', 0);\n\t_defineFloat('iridescenceThicknessMax', 0);\n\t_defineObject('ambientSH');\n\t_defineObject('cubeMapProjectionBox', (material, device, scene) => {\n\t\tconst uniform = material._allocUniform('cubeMapProjectionBox', () => {\n\t\t\treturn [{\n\t\t\t\tname: 'envBoxMin',\n\t\t\t\tvalue: new Float32Array(3)\n\t\t\t}, {\n\t\t\t\tname: 'envBoxMax',\n\t\t\t\tvalue: new Float32Array(3)\n\t\t\t}];\n\t\t});\n\t\tconst bboxMin = material.cubeMapProjectionBox.getMin();\n\t\tconst minUniform = uniform[0].value;\n\t\tminUniform[0] = bboxMin.x;\n\t\tminUniform[1] = bboxMin.y;\n\t\tminUniform[2] = bboxMin.z;\n\t\tconst bboxMax = material.cubeMapProjectionBox.getMax();\n\t\tconst maxUniform = uniform[1].value;\n\t\tmaxUniform[0] = bboxMax.x;\n\t\tmaxUniform[1] = bboxMax.y;\n\t\tmaxUniform[2] = bboxMax.z;\n\t\treturn uniform;\n\t});\n\t_defineFlag('ambientTint', false);\n\t_defineFlag('diffuseTint', false);\n\t_defineFlag('specularTint', false);\n\t_defineFlag('specularityFactorTint', false);\n\t_defineFlag('emissiveTint', false);\n\t_defineFlag('fastTbn', false);\n\t_defineFlag('useMetalness', false);\n\t_defineFlag('useMetalnessSpecularColor', false);\n\t_defineFlag('useSheen', false);\n\t_defineFlag('enableGGXSpecular', false);\n\t_defineFlag('occludeDirect', false);\n\t_defineFlag('normalizeNormalMap', true);\n\t_defineFlag('conserveEnergy', true);\n\t_defineFlag('opacityFadesSpecular', true);\n\t_defineFlag('occludeSpecular', SPECOCC_AO);\n\t_defineFlag('shadingModel', SPECULAR_BLINN);\n\t_defineFlag('fresnelModel', FRESNEL_SCHLICK);\n\t_defineFlag('useDynamicRefraction', false);\n\t_defineFlag('cubeMapProjection', CUBEPROJ_NONE);\n\t_defineFlag('customFragmentShader', null);\n\t_defineFlag('useFog', true);\n\t_defineFlag('useLighting', true);\n\t_defineFlag('useGammaTonemap', true);\n\t_defineFlag('useSkybox', true);\n\t_defineFlag('forceUv1', false);\n\t_defineFlag('pixelSnap', false);\n\t_defineFlag('twoSidedLighting', false);\n\t_defineFlag('nineSlicedMode', undefined);\n\t_defineFlag('msdfTextAttribute', false);\n\t_defineFlag('useIridescence', false);\n\t_defineFlag('glossInvert', false);\n\t_defineFlag('sheenGlossInvert', false);\n\t_defineFlag('clearCoatGlossInvert', false);\n\t_defineTex2D('diffuse');\n\t_defineTex2D('specular');\n\t_defineTex2D('emissive');\n\t_defineTex2D('thickness', 'g');\n\t_defineTex2D('specularityFactor', 'g');\n\t_defineTex2D('normal', '');\n\t_defineTex2D('metalness', 'g');\n\t_defineTex2D('gloss', 'g');\n\t_defineTex2D('opacity', 'a');\n\t_defineTex2D('refraction', 'g');\n\t_defineTex2D('height', 'g', false);\n\t_defineTex2D('ao', 'g');\n\t_defineTex2D('light', 'rgb', true, 1);\n\t_defineTex2D('msdf', '');\n\t_defineTex2D('diffuseDetail', 'rgb', false);\n\t_defineTex2D('normalDetail', '');\n\t_defineTex2D('aoDetail', 'g', false);\n\t_defineTex2D('clearCoat', 'g');\n\t_defineTex2D('clearCoatGloss', 'g');\n\t_defineTex2D('clearCoatNormal', '');\n\t_defineTex2D('sheen', 'rgb');\n\t_defineTex2D('sheenGloss', 'g');\n\t_defineTex2D('iridescence', 'g');\n\t_defineTex2D('iridescenceThickness', 'g');\n\t_defineFlag('diffuseDetailMode', DETAILMODE_MUL);\n\t_defineFlag('aoDetailMode', DETAILMODE_MUL);\n\t_defineObject('cubeMap');\n\t_defineObject('sphereMap');\n\t_defineObject('envAtlas');\n\tconst getterFunc = function getterFunc() {\n\t\treturn this._prefilteredCubemaps;\n\t};\n\tconst setterFunc = function setterFunc(value) {\n\t\tconst cubemaps = this._prefilteredCubemaps;\n\t\tvalue = value || [];\n\t\tlet changed = false;\n\t\tlet complete = true;\n\t\tfor (let i = 0; i < 6; ++i) {\n\t\t\tconst v = value[i] || null;\n\t\t\tif (cubemaps[i] !== v) {\n\t\t\t\tcubemaps[i] = v;\n\t\t\t\tchanged = true;\n\t\t\t}\n\t\t\tcomplete = complete && !!cubemaps[i];\n\t\t}\n\t\tif (changed) {\n\t\t\tif (complete) {\n\t\t\t\tthis.envAtlas = EnvLighting.generatePrefilteredAtlas(cubemaps, {\n\t\t\t\t\ttarget: this.envAtlas\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tif (this.envAtlas) {\n\t\t\t\t\tthis.envAtlas.destroy();\n\t\t\t\t\tthis.envAtlas = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._dirtyShader = true;\n\t\t}\n\t};\n\tconst empty = [null, null, null, null, null, null];\n\tdefinePropInternal('prefilteredCubemaps', () => empty.slice(), setterFunc, getterFunc);\n}\n_defineMaterialProps();\n\nexport { StandardMaterial };\n","import '../../core/tracing.js';\nimport '../../core/time.js';\nimport { BlendState } from '../../platform/graphics/blend-state.js';\nimport { RenderPass } from '../../platform/graphics/render-pass.js';\nimport { RenderAction } from '../composition/render-action.js';\nimport '../lighting/world-clusters-debug.js';\n\nclass RenderPassRenderActions extends RenderPass {\n\tconstructor(device, layerComposition, scene, renderer) {\n\t\tsuper(device);\n\t\tthis.layerComposition = void 0;\n\t\tthis.scene = void 0;\n\t\tthis.renderer = void 0;\n\t\tthis.renderActions = [];\n\t\tthis.layerComposition = layerComposition;\n\t\tthis.scene = scene;\n\t\tthis.renderer = renderer;\n\t}\n\taddRenderAction(renderAction) {\n\t\tthis.renderActions.push(renderAction);\n\t\tif (this.renderActions.length === 1) {\n\t\t\tconst camera = renderAction.camera;\n\t\t\tthis.fullSizeClearRect = camera.camera.fullSizeClearRect;\n\t\t\tif (this.fullSizeClearRect) {\n\t\t\t\tif (renderAction.clearColor) {\n\t\t\t\t\tthis.setClearColor(camera.camera.clearColor);\n\t\t\t\t}\n\t\t\t\tif (renderAction.clearDepth) {\n\t\t\t\t\tthis.setClearDepth(camera.camera.clearDepth);\n\t\t\t\t}\n\t\t\t\tif (renderAction.clearStencil) {\n\t\t\t\t\tthis.setClearStencil(camera.camera.clearStencil);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\taddLayer(camera, layer, transparent, autoClears = true) {\n\t\tconst ra = new RenderAction();\n\t\tra.renderTarget = this.renderTarget;\n\t\tra.camera = camera;\n\t\tra.layer = layer;\n\t\tra.transparent = transparent;\n\t\tif (autoClears) {\n\t\t\tconst firstRa = this.renderActions.length === 0;\n\t\t\tra.setupClears(firstRa ? camera : undefined, layer);\n\t\t}\n\t\tthis.addRenderAction(ra);\n\t}\n\tbefore() {\n\t\tconst {\n\t\t\trenderActions\n\t\t} = this;\n\t\tif (renderActions.length) {\n\t\t\tconst ra = renderActions[0];\n\t\t\tif (ra.camera.onPreRender && ra.firstCameraUse) {\n\t\t\t\tra.camera.onPreRender();\n\t\t\t}\n\t\t}\n\t}\n\texecute() {\n\t\tconst {\n\t\t\tlayerComposition,\n\t\t\trenderActions\n\t\t} = this;\n\t\tfor (let i = 0; i < renderActions.length; i++) {\n\t\t\tconst ra = renderActions[i];\n\t\t\tif (layerComposition.isEnabled(ra.layer, ra.transparent)) {\n\t\t\t\tthis.renderRenderAction(ra, i === 0);\n\t\t\t}\n\t\t}\n\t}\n\tafter() {\n\t\tconst {\n\t\t\trenderActions\n\t\t} = this;\n\t\tif (renderActions.length) {\n\t\t\tconst ra = renderActions[renderActions.length - 1];\n\t\t\tif (ra.camera.onPostRender && ra.lastCameraUse) {\n\t\t\t\tra.camera.onPostRender();\n\t\t\t}\n\t\t}\n\t}\n\trenderRenderAction(renderAction, firstRenderAction) {\n\t\tconst {\n\t\t\tscene,\n\t\t\trenderer,\n\t\t\tlayerComposition\n\t\t} = this;\n\t\tconst clusteredLightingEnabled = scene.clusteredLightingEnabled;\n\t\tconst device = renderer.device;\n\t\tconst {\n\t\t\tlayer,\n\t\t\ttransparent,\n\t\t\tcamera\n\t\t} = renderAction;\n\t\tconst cameraPass = layerComposition.camerasMap.get(camera);\n\t\tif (!transparent && layer.onPreRenderOpaque) {\n\t\t\tlayer.onPreRenderOpaque(cameraPass);\n\t\t} else if (transparent && layer.onPreRenderTransparent) {\n\t\t\tlayer.onPreRenderTransparent(cameraPass);\n\t\t}\n\t\tif (!(layer._preRenderCalledForCameras & 1 << cameraPass)) {\n\t\t\tif (layer.onPreRender) {\n\t\t\t\tlayer.onPreRender(cameraPass);\n\t\t\t}\n\t\t\tlayer._preRenderCalledForCameras |= 1 << cameraPass;\n\t\t}\n\t\tif (camera) {\n\t\t\tvar _renderAction$renderT, _camera$camera$shader, _camera$camera$shader2;\n\t\t\trenderer.setupViewport(camera.camera, renderAction.renderTarget);\n\t\t\tif (!firstRenderAction || !camera.camera.fullSizeClearRect) {\n\t\t\t\trenderer.clear(camera.camera, renderAction.clearColor, renderAction.clearDepth, renderAction.clearStencil);\n\t\t\t}\n\t\t\tlayer.sortVisible(camera.camera, transparent);\n\t\t\tconst culledInstances = layer.getCulledInstances(camera.camera);\n\t\t\tconst visible = transparent ? culledInstances.transparent : culledInstances.opaque;\n\t\t\tscene.immediate.onPreRenderLayer(layer, visible, transparent);\n\t\t\tif (layer.requiresLightCube) {\n\t\t\t\trenderer.lightCube.update(scene.ambientLight, layer._lights);\n\t\t\t\trenderer.constantLightCube.setValue(renderer.lightCube.colors);\n\t\t\t}\n\t\t\tif (clusteredLightingEnabled && renderAction.lightClusters) {\n\t\t\t\trenderAction.lightClusters.activate();\n\t\t\t\tif (!renderer.clustersDebugRendered && scene.lighting.debugLayer === layer.id) {\n\t\t\t\t\trenderer.clustersDebugRendered = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tscene._activeCamera = camera.camera;\n\t\t\tconst viewCount = renderer.setCameraUniforms(camera.camera, renderAction.renderTarget);\n\t\t\tif (device.supportsUniformBuffers) {\n\t\t\t\trenderer.setupViewUniformBuffers(renderAction.viewBindGroups, renderer.viewUniformFormat, renderer.viewBindGroupFormat, viewCount);\n\t\t\t}\n\t\t\tconst flipFaces = !!(camera.camera._flipFaces ^ (renderAction == null || (_renderAction$renderT = renderAction.renderTarget) == null ? void 0 : _renderAction$renderT.flipY));\n\t\t\tconst shaderPass = (_camera$camera$shader = (_camera$camera$shader2 = camera.camera.shaderPassInfo) == null ? void 0 : _camera$camera$shader2.index) != null ? _camera$camera$shader : layer.shaderPass;\n\t\t\tconst draws = renderer._forwardDrawCalls;\n\t\t\trenderer.renderForward(camera.camera, visible, layer.splitLights, shaderPass, layer.onDrawCall, layer, flipFaces);\n\t\t\tlayer._forwardDrawCalls += renderer._forwardDrawCalls - draws;\n\t\t\tdevice.setBlendState(BlendState.NOBLEND);\n\t\t\tdevice.setStencilState(null, null);\n\t\t\tdevice.setAlphaToCoverage(false);\n\t\t\tdevice.setDepthBias(false);\n\t\t}\n\t\tif (!transparent && layer.onPostRenderOpaque) {\n\t\t\tlayer.onPostRenderOpaque(cameraPass);\n\t\t} else if (transparent && layer.onPostRenderTransparent) {\n\t\t\tlayer.onPostRenderTransparent(cameraPass);\n\t\t}\n\t\tif (layer.onPostRender && !(layer._postRenderCalledForCameras & 1 << cameraPass)) {\n\t\t\tlayer._postRenderCounter &= ~(transparent ? 2 : 1);\n\t\t\tif (layer._postRenderCounter === 0) {\n\t\t\t\tlayer.onPostRender(cameraPass);\n\t\t\t\tlayer._postRenderCalledForCameras |= 1 << cameraPass;\n\t\t\t\tlayer._postRenderCounter = layer._postRenderCounterMax;\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport { RenderPassRenderActions };\n","import '../../core/tracing.js';\nimport { RenderPass } from '../../platform/graphics/render-pass.js';\n\nclass RenderPassPostprocessing extends RenderPass {\n\tconstructor(device, renderer, renderAction) {\n\t\tsuper(device);\n\t\tthis.renderer = renderer;\n\t\tthis.renderAction = renderAction;\n\t\tthis.requiresCubemaps = false;\n\t}\n\texecute() {\n\t\tconst renderAction = this.renderAction;\n\t\tconst camera = renderAction.camera;\n\t\tcamera.onPostprocessing();\n\t}\n}\n\nexport { RenderPassPostprocessing };\n","import '../../core/time.js';\nimport '../../core/tracing.js';\nimport { Vec3 } from '../../core/math/vec3.js';\nimport { LIGHTSHAPE_PUNCTUAL, LIGHTTYPE_OMNI, LIGHTTYPE_SPOT, LIGHTTYPE_DIRECTIONAL, FOG_NONE, FOG_LINEAR, LAYERID_DEPTH } from '../constants.js';\nimport { Renderer } from './renderer.js';\nimport { LightCamera } from './light-camera.js';\nimport { RenderPassRenderActions } from './render-pass-render-actions.js';\nimport { RenderPassPostprocessing } from './render-pass-postprocessing.js';\n\nconst _drawCallList = {\n\tdrawCalls: [],\n\tshaderInstances: [],\n\tisNewMaterial: [],\n\tlightMaskChanged: [],\n\tclear: function () {\n\t\tthis.drawCalls.length = 0;\n\t\tthis.shaderInstances.length = 0;\n\t\tthis.isNewMaterial.length = 0;\n\t\tthis.lightMaskChanged.length = 0;\n\t}\n};\nfunction vogelDiskPrecalculationSamples(numSamples) {\n\tconst samples = [];\n\tfor (let i = 0; i < numSamples; ++i) {\n\t\tconst r = Math.sqrt(i + 0.5) / Math.sqrt(numSamples);\n\t\tsamples.push(r);\n\t}\n\treturn samples;\n}\nfunction vogelSpherePrecalculationSamples(numSamples) {\n\tconst samples = [];\n\tfor (let i = 0; i < numSamples; i++) {\n\t\tconst weight = i / numSamples;\n\t\tconst radius = Math.sqrt(1.0 - weight * weight);\n\t\tsamples.push(radius);\n\t}\n\treturn samples;\n}\nclass ForwardRenderer extends Renderer {\n\tconstructor(graphicsDevice) {\n\t\tsuper(graphicsDevice);\n\t\tconst device = this.device;\n\t\tthis._forwardDrawCalls = 0;\n\t\tthis._materialSwitches = 0;\n\t\tthis._depthMapTime = 0;\n\t\tthis._forwardTime = 0;\n\t\tthis._sortTime = 0;\n\t\tconst scope = device.scope;\n\t\tthis.fogColorId = scope.resolve('fog_color');\n\t\tthis.fogStartId = scope.resolve('fog_start');\n\t\tthis.fogEndId = scope.resolve('fog_end');\n\t\tthis.fogDensityId = scope.resolve('fog_density');\n\t\tthis.ambientId = scope.resolve('light_globalAmbient');\n\t\tthis.skyboxIntensityId = scope.resolve('skyboxIntensity');\n\t\tthis.cubeMapRotationMatrixId = scope.resolve('cubeMapRotationMatrix');\n\t\tthis.pcssDiskSamplesId = scope.resolve('pcssDiskSamples[0]');\n\t\tthis.pcssSphereSamplesId = scope.resolve('pcssSphereSamples[0]');\n\t\tthis.lightColorId = [];\n\t\tthis.lightDir = [];\n\t\tthis.lightDirId = [];\n\t\tthis.lightShadowMapId = [];\n\t\tthis.lightShadowMatrixId = [];\n\t\tthis.lightShadowParamsId = [];\n\t\tthis.lightShadowIntensity = [];\n\t\tthis.lightRadiusId = [];\n\t\tthis.lightPos = [];\n\t\tthis.lightPosId = [];\n\t\tthis.lightWidth = [];\n\t\tthis.lightWidthId = [];\n\t\tthis.lightHeight = [];\n\t\tthis.lightHeightId = [];\n\t\tthis.lightInAngleId = [];\n\t\tthis.lightOutAngleId = [];\n\t\tthis.lightCookieId = [];\n\t\tthis.lightCookieIntId = [];\n\t\tthis.lightCookieMatrixId = [];\n\t\tthis.lightCookieOffsetId = [];\n\t\tthis.lightShadowSearchAreaId = [];\n\t\tthis.lightCameraParamsId = [];\n\t\tthis.shadowMatrixPaletteId = [];\n\t\tthis.shadowCascadeDistancesId = [];\n\t\tthis.shadowCascadeCountId = [];\n\t\tthis.screenSizeId = scope.resolve('uScreenSize');\n\t\tthis._screenSize = new Float32Array(4);\n\t\tthis.fogColor = new Float32Array(3);\n\t\tthis.ambientColor = new Float32Array(3);\n\t\tthis.pcssDiskSamples = vogelDiskPrecalculationSamples(16);\n\t\tthis.pcssSphereSamples = vogelSpherePrecalculationSamples(16);\n\t}\n\tdestroy() {\n\t\tsuper.destroy();\n\t}\n\tdispatchGlobalLights(scene) {\n\t\tthis.ambientColor[0] = scene.ambientLight.r;\n\t\tthis.ambientColor[1] = scene.ambientLight.g;\n\t\tthis.ambientColor[2] = scene.ambientLight.b;\n\t\tif (scene.gammaCorrection) {\n\t\t\tfor (let i = 0; i < 3; i++) {\n\t\t\t\tthis.ambientColor[i] = Math.pow(this.ambientColor[i], 2.2);\n\t\t\t}\n\t\t}\n\t\tif (scene.physicalUnits) {\n\t\t\tfor (let i = 0; i < 3; i++) {\n\t\t\t\tthis.ambientColor[i] *= scene.ambientLuminance;\n\t\t\t}\n\t\t}\n\t\tthis.ambientId.setValue(this.ambientColor);\n\t\tthis.skyboxIntensityId.setValue(scene.physicalUnits ? scene.skyboxLuminance : scene.skyboxIntensity);\n\t\tthis.cubeMapRotationMatrixId.setValue(scene._skyboxRotationMat3.data);\n\t}\n\t_resolveLight(scope, i) {\n\t\tconst light = 'light' + i;\n\t\tthis.lightColorId[i] = scope.resolve(light + '_color');\n\t\tthis.lightDir[i] = new Float32Array(3);\n\t\tthis.lightDirId[i] = scope.resolve(light + '_direction');\n\t\tthis.lightShadowMapId[i] = scope.resolve(light + '_shadowMap');\n\t\tthis.lightShadowMatrixId[i] = scope.resolve(light + '_shadowMatrix');\n\t\tthis.lightShadowParamsId[i] = scope.resolve(light + '_shadowParams');\n\t\tthis.lightShadowIntensity[i] = scope.resolve(light + '_shadowIntensity');\n\t\tthis.lightShadowSearchAreaId[i] = scope.resolve(light + '_shadowSearchArea');\n\t\tthis.lightRadiusId[i] = scope.resolve(light + '_radius');\n\t\tthis.lightPos[i] = new Float32Array(3);\n\t\tthis.lightPosId[i] = scope.resolve(light + '_position');\n\t\tthis.lightWidth[i] = new Float32Array(3);\n\t\tthis.lightWidthId[i] = scope.resolve(light + '_halfWidth');\n\t\tthis.lightHeight[i] = new Float32Array(3);\n\t\tthis.lightHeightId[i] = scope.resolve(light + '_halfHeight');\n\t\tthis.lightInAngleId[i] = scope.resolve(light + '_innerConeAngle');\n\t\tthis.lightOutAngleId[i] = scope.resolve(light + '_outerConeAngle');\n\t\tthis.lightCookieId[i] = scope.resolve(light + '_cookie');\n\t\tthis.lightCookieIntId[i] = scope.resolve(light + '_cookieIntensity');\n\t\tthis.lightCookieMatrixId[i] = scope.resolve(light + '_cookieMatrix');\n\t\tthis.lightCookieOffsetId[i] = scope.resolve(light + '_cookieOffset');\n\t\tthis.lightCameraParamsId[i] = scope.resolve(light + '_cameraParams');\n\t\tthis.shadowMatrixPaletteId[i] = scope.resolve(light + '_shadowMatrixPalette[0]');\n\t\tthis.shadowCascadeDistancesId[i] = scope.resolve(light + '_shadowCascadeDistances[0]');\n\t\tthis.shadowCascadeCountId[i] = scope.resolve(light + '_shadowCascadeCount');\n\t}\n\tsetLTCDirectionalLight(wtm, cnt, dir, campos, far) {\n\t\tthis.lightPos[cnt][0] = campos.x - dir.x * far;\n\t\tthis.lightPos[cnt][1] = campos.y - dir.y * far;\n\t\tthis.lightPos[cnt][2] = campos.z - dir.z * far;\n\t\tthis.lightPosId[cnt].setValue(this.lightPos[cnt]);\n\t\tconst hWidth = wtm.transformVector(new Vec3(-0.5, 0, 0));\n\t\tthis.lightWidth[cnt][0] = hWidth.x * far;\n\t\tthis.lightWidth[cnt][1] = hWidth.y * far;\n\t\tthis.lightWidth[cnt][2] = hWidth.z * far;\n\t\tthis.lightWidthId[cnt].setValue(this.lightWidth[cnt]);\n\t\tconst hHeight = wtm.transformVector(new Vec3(0, 0, 0.5));\n\t\tthis.lightHeight[cnt][0] = hHeight.x * far;\n\t\tthis.lightHeight[cnt][1] = hHeight.y * far;\n\t\tthis.lightHeight[cnt][2] = hHeight.z * far;\n\t\tthis.lightHeightId[cnt].setValue(this.lightHeight[cnt]);\n\t}\n\tdispatchDirectLights(dirs, scene, mask, camera) {\n\t\tlet cnt = 0;\n\t\tconst scope = this.device.scope;\n\t\tfor (let i = 0; i < dirs.length; i++) {\n\t\t\tif (!(dirs[i].mask & mask)) continue;\n\t\t\tconst directional = dirs[i];\n\t\t\tconst wtm = directional._node.getWorldTransform();\n\t\t\tif (!this.lightColorId[cnt]) {\n\t\t\t\tthis._resolveLight(scope, cnt);\n\t\t\t}\n\t\t\tthis.lightColorId[cnt].setValue(scene.gammaCorrection ? directional._linearFinalColor : directional._finalColor);\n\t\t\twtm.getY(directional._direction).mulScalar(-1);\n\t\t\tdirectional._direction.normalize();\n\t\t\tthis.lightDir[cnt][0] = directional._direction.x;\n\t\t\tthis.lightDir[cnt][1] = directional._direction.y;\n\t\t\tthis.lightDir[cnt][2] = directional._direction.z;\n\t\t\tthis.lightDirId[cnt].setValue(this.lightDir[cnt]);\n\t\t\tif (directional.shape !== LIGHTSHAPE_PUNCTUAL) {\n\t\t\t\tthis.setLTCDirectionalLight(wtm, cnt, directional._direction, camera._node.getPosition(), camera.farClip);\n\t\t\t}\n\t\t\tif (directional.castShadows) {\n\t\t\t\tconst lightRenderData = directional.getRenderData(camera, 0);\n\t\t\t\tconst biases = directional._getUniformBiasValues(lightRenderData);\n\t\t\t\tthis.lightShadowMapId[cnt].setValue(lightRenderData.shadowBuffer);\n\t\t\t\tthis.lightShadowMatrixId[cnt].setValue(lightRenderData.shadowMatrix.data);\n\t\t\t\tthis.shadowMatrixPaletteId[cnt].setValue(directional._shadowMatrixPalette);\n\t\t\t\tthis.shadowCascadeDistancesId[cnt].setValue(directional._shadowCascadeDistances);\n\t\t\t\tthis.shadowCascadeCountId[cnt].setValue(directional.numCascades);\n\t\t\t\tthis.lightShadowIntensity[cnt].setValue(directional.shadowIntensity);\n\t\t\t\tconst projectionCompensation = 50.0 / lightRenderData.projectionCompensation;\n\t\t\t\tconst pixelsPerMeter = directional.penumbraSize / lightRenderData.shadowCamera.renderTarget.width;\n\t\t\t\tthis.lightShadowSearchAreaId[cnt].setValue(pixelsPerMeter * projectionCompensation);\n\t\t\t\tconst cameraParams = directional._shadowCameraParams;\n\t\t\t\tcameraParams.length = 4;\n\t\t\t\tcameraParams[0] = lightRenderData.depthRangeCompensation;\n\t\t\t\tcameraParams[1] = lightRenderData.shadowCamera._farClip;\n\t\t\t\tcameraParams[2] = lightRenderData.shadowCamera._nearClip;\n\t\t\t\tcameraParams[3] = 1;\n\t\t\t\tthis.lightCameraParamsId[cnt].setValue(cameraParams);\n\t\t\t\tconst params = directional._shadowRenderParams;\n\t\t\t\tparams.length = 4;\n\t\t\t\tparams[0] = directional._shadowResolution;\n\t\t\t\tparams[1] = biases.normalBias;\n\t\t\t\tparams[2] = biases.bias;\n\t\t\t\tparams[3] = 0;\n\t\t\t\tthis.lightShadowParamsId[cnt].setValue(params);\n\t\t\t}\n\t\t\tcnt++;\n\t\t}\n\t\treturn cnt;\n\t}\n\tsetLTCPositionalLight(wtm, cnt) {\n\t\tconst hWidth = wtm.transformVector(new Vec3(-0.5, 0, 0));\n\t\tthis.lightWidth[cnt][0] = hWidth.x;\n\t\tthis.lightWidth[cnt][1] = hWidth.y;\n\t\tthis.lightWidth[cnt][2] = hWidth.z;\n\t\tthis.lightWidthId[cnt].setValue(this.lightWidth[cnt]);\n\t\tconst hHeight = wtm.transformVector(new Vec3(0, 0, 0.5));\n\t\tthis.lightHeight[cnt][0] = hHeight.x;\n\t\tthis.lightHeight[cnt][1] = hHeight.y;\n\t\tthis.lightHeight[cnt][2] = hHeight.z;\n\t\tthis.lightHeightId[cnt].setValue(this.lightHeight[cnt]);\n\t}\n\tdispatchOmniLight(scene, scope, omni, cnt) {\n\t\tconst wtm = omni._node.getWorldTransform();\n\t\tif (!this.lightColorId[cnt]) {\n\t\t\tthis._resolveLight(scope, cnt);\n\t\t}\n\t\tthis.lightRadiusId[cnt].setValue(omni.attenuationEnd);\n\t\tthis.lightColorId[cnt].setValue(scene.gammaCorrection ? omni._linearFinalColor : omni._finalColor);\n\t\twtm.getTranslation(omni._position);\n\t\tthis.lightPos[cnt][0] = omni._position.x;\n\t\tthis.lightPos[cnt][1] = omni._position.y;\n\t\tthis.lightPos[cnt][2] = omni._position.z;\n\t\tthis.lightPosId[cnt].setValue(this.lightPos[cnt]);\n\t\tif (omni.shape !== LIGHTSHAPE_PUNCTUAL) {\n\t\t\tthis.setLTCPositionalLight(wtm, cnt);\n\t\t}\n\t\tif (omni.castShadows) {\n\t\t\tconst lightRenderData = omni.getRenderData(null, 0);\n\t\t\tthis.lightShadowMapId[cnt].setValue(lightRenderData.shadowBuffer);\n\t\t\tconst biases = omni._getUniformBiasValues(lightRenderData);\n\t\t\tconst params = omni._shadowRenderParams;\n\t\t\tparams.length = 4;\n\t\t\tparams[0] = omni._shadowResolution;\n\t\t\tparams[1] = biases.normalBias;\n\t\t\tparams[2] = biases.bias;\n\t\t\tparams[3] = 1.0 / omni.attenuationEnd;\n\t\t\tthis.lightShadowParamsId[cnt].setValue(params);\n\t\t\tthis.lightShadowIntensity[cnt].setValue(omni.shadowIntensity);\n\t\t\tconst pixelsPerMeter = omni.penumbraSize / lightRenderData.shadowCamera.renderTarget.width;\n\t\t\tthis.lightShadowSearchAreaId[cnt].setValue(pixelsPerMeter);\n\t\t\tconst cameraParams = omni._shadowCameraParams;\n\t\t\tcameraParams.length = 4;\n\t\t\tcameraParams[0] = lightRenderData.depthRangeCompensation;\n\t\t\tcameraParams[1] = lightRenderData.shadowCamera._farClip;\n\t\t\tcameraParams[2] = lightRenderData.shadowCamera._nearClip;\n\t\t\tcameraParams[3] = 0;\n\t\t\tthis.lightCameraParamsId[cnt].setValue(cameraParams);\n\t\t}\n\t\tif (omni._cookie) {\n\t\t\tthis.lightCookieId[cnt].setValue(omni._cookie);\n\t\t\tthis.lightShadowMatrixId[cnt].setValue(wtm.data);\n\t\t\tthis.lightCookieIntId[cnt].setValue(omni.cookieIntensity);\n\t\t}\n\t}\n\tdispatchSpotLight(scene, scope, spot, cnt) {\n\t\tconst wtm = spot._node.getWorldTransform();\n\t\tif (!this.lightColorId[cnt]) {\n\t\t\tthis._resolveLight(scope, cnt);\n\t\t}\n\t\tthis.lightInAngleId[cnt].setValue(spot._innerConeAngleCos);\n\t\tthis.lightOutAngleId[cnt].setValue(spot._outerConeAngleCos);\n\t\tthis.lightRadiusId[cnt].setValue(spot.attenuationEnd);\n\t\tthis.lightColorId[cnt].setValue(scene.gammaCorrection ? spot._linearFinalColor : spot._finalColor);\n\t\twtm.getTranslation(spot._position);\n\t\tthis.lightPos[cnt][0] = spot._position.x;\n\t\tthis.lightPos[cnt][1] = spot._position.y;\n\t\tthis.lightPos[cnt][2] = spot._position.z;\n\t\tthis.lightPosId[cnt].setValue(this.lightPos[cnt]);\n\t\tif (spot.shape !== LIGHTSHAPE_PUNCTUAL) {\n\t\t\tthis.setLTCPositionalLight(wtm, cnt);\n\t\t}\n\t\twtm.getY(spot._direction).mulScalar(-1);\n\t\tspot._direction.normalize();\n\t\tthis.lightDir[cnt][0] = spot._direction.x;\n\t\tthis.lightDir[cnt][1] = spot._direction.y;\n\t\tthis.lightDir[cnt][2] = spot._direction.z;\n\t\tthis.lightDirId[cnt].setValue(this.lightDir[cnt]);\n\t\tif (spot.castShadows) {\n\t\t\tconst lightRenderData = spot.getRenderData(null, 0);\n\t\t\tthis.lightShadowMapId[cnt].setValue(lightRenderData.shadowBuffer);\n\t\t\tthis.lightShadowMatrixId[cnt].setValue(lightRenderData.shadowMatrix.data);\n\t\t\tconst biases = spot._getUniformBiasValues(lightRenderData);\n\t\t\tconst params = spot._shadowRenderParams;\n\t\t\tparams.length = 4;\n\t\t\tparams[0] = spot._shadowResolution;\n\t\t\tparams[1] = biases.normalBias;\n\t\t\tparams[2] = biases.bias;\n\t\t\tparams[3] = 1.0 / spot.attenuationEnd;\n\t\t\tthis.lightShadowParamsId[cnt].setValue(params);\n\t\t\tthis.lightShadowIntensity[cnt].setValue(spot.shadowIntensity);\n\t\t\tconst pixelsPerMeter = spot.penumbraSize / lightRenderData.shadowCamera.renderTarget.width;\n\t\t\tconst fov = lightRenderData.shadowCamera._fov * Math.PI / 180.0;\n\t\t\tconst fovRatio = 1.0 / Math.tan(fov / 2.0);\n\t\t\tthis.lightShadowSearchAreaId[cnt].setValue(pixelsPerMeter * fovRatio);\n\t\t\tconst cameraParams = spot._shadowCameraParams;\n\t\t\tcameraParams.length = 4;\n\t\t\tcameraParams[0] = lightRenderData.depthRangeCompensation;\n\t\t\tcameraParams[1] = lightRenderData.shadowCamera._farClip;\n\t\t\tcameraParams[2] = lightRenderData.shadowCamera._nearClip;\n\t\t\tcameraParams[3] = 0;\n\t\t\tthis.lightCameraParamsId[cnt].setValue(cameraParams);\n\t\t}\n\t\tif (spot._cookie) {\n\t\t\tif (!spot.castShadows) {\n\t\t\t\tconst cookieMatrix = LightCamera.evalSpotCookieMatrix(spot);\n\t\t\t\tthis.lightShadowMatrixId[cnt].setValue(cookieMatrix.data);\n\t\t\t}\n\t\t\tthis.lightCookieId[cnt].setValue(spot._cookie);\n\t\t\tthis.lightCookieIntId[cnt].setValue(spot.cookieIntensity);\n\t\t\tif (spot._cookieTransform) {\n\t\t\t\tspot._cookieTransformUniform[0] = spot._cookieTransform.x;\n\t\t\t\tspot._cookieTransformUniform[1] = spot._cookieTransform.y;\n\t\t\t\tspot._cookieTransformUniform[2] = spot._cookieTransform.z;\n\t\t\t\tspot._cookieTransformUniform[3] = spot._cookieTransform.w;\n\t\t\t\tthis.lightCookieMatrixId[cnt].setValue(spot._cookieTransformUniform);\n\t\t\t\tspot._cookieOffsetUniform[0] = spot._cookieOffset.x;\n\t\t\t\tspot._cookieOffsetUniform[1] = spot._cookieOffset.y;\n\t\t\t\tthis.lightCookieOffsetId[cnt].setValue(spot._cookieOffsetUniform);\n\t\t\t}\n\t\t}\n\t}\n\tdispatchLocalLights(sortedLights, scene, mask, usedDirLights) {\n\t\tlet cnt = usedDirLights;\n\t\tconst scope = this.device.scope;\n\t\tconst omnis = sortedLights[LIGHTTYPE_OMNI];\n\t\tconst numOmnis = omnis.length;\n\t\tfor (let i = 0; i < numOmnis; i++) {\n\t\t\tconst omni = omnis[i];\n\t\t\tif (!(omni.mask & mask)) continue;\n\t\t\tthis.dispatchOmniLight(scene, scope, omni, cnt);\n\t\t\tcnt++;\n\t\t}\n\t\tconst spts = sortedLights[LIGHTTYPE_SPOT];\n\t\tconst numSpts = spts.length;\n\t\tfor (let i = 0; i < numSpts; i++) {\n\t\t\tconst spot = spts[i];\n\t\t\tif (!(spot.mask & mask)) continue;\n\t\t\tthis.dispatchSpotLight(scene, scope, spot, cnt);\n\t\t\tcnt++;\n\t\t}\n\t}\n\trenderForwardPrepareMaterials(camera, drawCalls, sortedLights, layer, pass) {\n\t\tvar _layer$getLightHash;\n\t\tconst addCall = (drawCall, shaderInstance, isNewMaterial, lightMaskChanged) => {\n\t\t\t_drawCallList.drawCalls.push(drawCall);\n\t\t\t_drawCallList.shaderInstances.push(shaderInstance);\n\t\t\t_drawCallList.isNewMaterial.push(isNewMaterial);\n\t\t\t_drawCallList.lightMaskChanged.push(lightMaskChanged);\n\t\t};\n\t\t_drawCallList.clear();\n\t\tconst device = this.device;\n\t\tconst scene = this.scene;\n\t\tconst clusteredLightingEnabled = scene.clusteredLightingEnabled;\n\t\tconst lightHash = (_layer$getLightHash = layer == null ? void 0 : layer.getLightHash(clusteredLightingEnabled)) != null ? _layer$getLightHash : 0;\n\t\tlet prevMaterial = null,\n\t\t\tprevObjDefs,\n\t\t\tprevLightMask;\n\t\tconst drawCallsCount = drawCalls.length;\n\t\tfor (let i = 0; i < drawCallsCount; i++) {\n\t\t\tconst drawCall = drawCalls[i];\n\t\t\tdrawCall.ensureMaterial(device);\n\t\t\tconst material = drawCall.material;\n\t\t\tconst objDefs = drawCall._shaderDefs;\n\t\t\tconst lightMask = drawCall.mask;\n\t\t\tif (material && material === prevMaterial && objDefs !== prevObjDefs) {\n\t\t\t\tprevMaterial = null;\n\t\t\t}\n\t\t\tif (material !== prevMaterial) {\n\t\t\t\tthis._materialSwitches++;\n\t\t\t\tmaterial._scene = scene;\n\t\t\t\tif (material.dirty) {\n\t\t\t\t\tmaterial.updateUniforms(device, scene);\n\t\t\t\t\tmaterial.dirty = false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst shaderInstance = drawCall.getShaderInstance(pass, lightHash, scene, this.viewUniformFormat, this.viewBindGroupFormat, sortedLights);\n\t\t\taddCall(drawCall, shaderInstance, material !== prevMaterial, !prevMaterial || lightMask !== prevLightMask);\n\t\t\tprevMaterial = material;\n\t\t\tprevObjDefs = objDefs;\n\t\t\tprevLightMask = lightMask;\n\t\t}\n\t\tdevice.endShaderBatch == null || device.endShaderBatch();\n\t\treturn _drawCallList;\n\t}\n\trenderForwardInternal(camera, preparedCalls, sortedLights, pass, drawCallback, flipFaces) {\n\t\tconst device = this.device;\n\t\tconst scene = this.scene;\n\t\tconst passFlag = 1 << pass;\n\t\tconst flipFactor = flipFaces ? -1 : 1;\n\t\tconst clusteredLightingEnabled = this.scene.clusteredLightingEnabled;\n\t\tlet skipMaterial = false;\n\t\tconst preparedCallsCount = preparedCalls.drawCalls.length;\n\t\tfor (let i = 0; i < preparedCallsCount; i++) {\n\t\t\tvar _drawCall$stencilFron, _drawCall$stencilBack;\n\t\t\tconst drawCall = preparedCalls.drawCalls[i];\n\t\t\tconst newMaterial = preparedCalls.isNewMaterial[i];\n\t\t\tconst lightMaskChanged = preparedCalls.lightMaskChanged[i];\n\t\t\tconst shaderInstance = preparedCalls.shaderInstances[i];\n\t\t\tconst material = drawCall.material;\n\t\t\tdrawCall._shaderDefs;\n\t\t\tconst lightMask = drawCall.mask;\n\t\t\tif (newMaterial) {\n\t\t\t\tconst shader = shaderInstance.shader;\n\t\t\t\tif (!shader.failed && !device.setShader(shader)) ;\n\t\t\t\tskipMaterial = shader.failed;\n\t\t\t\tif (skipMaterial) break;\n\t\t\t\tmaterial.setParameters(device);\n\t\t\t\tif (lightMaskChanged) {\n\t\t\t\t\tconst usedDirLights = this.dispatchDirectLights(sortedLights[LIGHTTYPE_DIRECTIONAL], scene, lightMask, camera);\n\t\t\t\t\tif (!clusteredLightingEnabled) {\n\t\t\t\t\t\tthis.dispatchLocalLights(sortedLights, scene, lightMask, usedDirLights);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.alphaTestId.setValue(material.alphaTest);\n\t\t\t\tdevice.setBlendState(material.blendState);\n\t\t\t\tdevice.setDepthState(material.depthState);\n\t\t\t\tdevice.setAlphaToCoverage(material.alphaToCoverage);\n\t\t\t\tif (material.depthBias || material.slopeDepthBias) {\n\t\t\t\t\tdevice.setDepthBias(true);\n\t\t\t\t\tdevice.setDepthBiasValues(material.depthBias, material.slopeDepthBias);\n\t\t\t\t} else {\n\t\t\t\t\tdevice.setDepthBias(false);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.setupCullMode(camera._cullFaces, flipFactor, drawCall);\n\t\t\tconst stencilFront = (_drawCall$stencilFron = drawCall.stencilFront) != null ? _drawCall$stencilFron : material.stencilFront;\n\t\t\tconst stencilBack = (_drawCall$stencilBack = drawCall.stencilBack) != null ? _drawCall$stencilBack : material.stencilBack;\n\t\t\tdevice.setStencilState(stencilFront, stencilBack);\n\t\t\tconst mesh = drawCall.mesh;\n\t\t\tdrawCall.setParameters(device, passFlag);\n\t\t\tthis.setVertexBuffers(device, mesh);\n\t\t\tthis.setMorphing(device, drawCall.morphInstance);\n\t\t\tthis.setSkinning(device, drawCall);\n\t\t\tthis.setupMeshUniformBuffers(shaderInstance, drawCall);\n\t\t\tconst style = drawCall.renderStyle;\n\t\t\tdevice.setIndexBuffer(mesh.indexBuffer[style]);\n\t\t\tdrawCallback == null || drawCallback(drawCall, i);\n\t\t\tif (camera.xr && camera.xr.session && camera.xr.views.length) {\n\t\t\t\tconst views = camera.xr.views;\n\t\t\t\tfor (let v = 0; v < views.length; v++) {\n\t\t\t\t\tconst view = views[v];\n\t\t\t\t\tdevice.setViewport(view.viewport.x, view.viewport.y, view.viewport.z, view.viewport.w);\n\t\t\t\t\tthis.projId.setValue(view.projMat.data);\n\t\t\t\t\tthis.projSkyboxId.setValue(view.projMat.data);\n\t\t\t\t\tthis.viewId.setValue(view.viewOffMat.data);\n\t\t\t\t\tthis.viewInvId.setValue(view.viewInvOffMat.data);\n\t\t\t\t\tthis.viewId3.setValue(view.viewMat3.data);\n\t\t\t\t\tthis.viewProjId.setValue(view.projViewOffMat.data);\n\t\t\t\t\tthis.viewPosId.setValue(view.position);\n\t\t\t\t\tif (v === 0) {\n\t\t\t\t\t\tthis.drawInstance(device, drawCall, mesh, style, true);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.drawInstance2(device, drawCall, mesh, style);\n\t\t\t\t\t}\n\t\t\t\t\tthis._forwardDrawCalls++;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.drawInstance(device, drawCall, mesh, style, true);\n\t\t\t\tthis._forwardDrawCalls++;\n\t\t\t}\n\t\t\tif (i < preparedCallsCount - 1 && !preparedCalls.isNewMaterial[i + 1]) {\n\t\t\t\tmaterial.setParameters(device, drawCall.parameters);\n\t\t\t}\n\t\t}\n\t}\n\trenderForward(camera, allDrawCalls, sortedLights, pass, drawCallback, layer, flipFaces) {\n\t\tconst preparedCalls = this.renderForwardPrepareMaterials(camera, allDrawCalls, sortedLights, layer, pass);\n\t\tthis.renderForwardInternal(camera, preparedCalls, sortedLights, pass, drawCallback, flipFaces);\n\t\t_drawCallList.clear();\n\t}\n\tsetSceneConstants() {\n\t\tconst scene = this.scene;\n\t\tthis.dispatchGlobalLights(scene);\n\t\tif (scene.fog !== FOG_NONE) {\n\t\t\tthis.fogColor[0] = scene.fogColor.r;\n\t\t\tthis.fogColor[1] = scene.fogColor.g;\n\t\t\tthis.fogColor[2] = scene.fogColor.b;\n\t\t\tif (scene.gammaCorrection) {\n\t\t\t\tfor (let i = 0; i < 3; i++) {\n\t\t\t\t\tthis.fogColor[i] = Math.pow(this.fogColor[i], 2.2);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.fogColorId.setValue(this.fogColor);\n\t\t\tif (scene.fog === FOG_LINEAR) {\n\t\t\t\tthis.fogStartId.setValue(scene.fogStart);\n\t\t\t\tthis.fogEndId.setValue(scene.fogEnd);\n\t\t\t} else {\n\t\t\t\tthis.fogDensityId.setValue(scene.fogDensity);\n\t\t\t}\n\t\t}\n\t\tconst device = this.device;\n\t\tthis._screenSize[0] = device.width;\n\t\tthis._screenSize[1] = device.height;\n\t\tthis._screenSize[2] = 1 / device.width;\n\t\tthis._screenSize[3] = 1 / device.height;\n\t\tthis.screenSizeId.setValue(this._screenSize);\n\t\tthis.pcssDiskSamplesId.setValue(this.pcssDiskSamples);\n\t\tthis.pcssSphereSamplesId.setValue(this.pcssSphereSamples);\n\t}\n\tbuildFrameGraph(frameGraph, layerComposition) {\n\t\tconst scene = this.scene;\n\t\tconst webgl1 = this.device.isWebGL1;\n\t\tframeGraph.reset();\n\t\tthis.update(layerComposition);\n\t\tif (scene.clusteredLightingEnabled) {\n\t\t\tconst {\n\t\t\t\tshadowsEnabled,\n\t\t\t\tcookiesEnabled\n\t\t\t} = scene.lighting;\n\t\t\tthis._renderPassUpdateClustered.update(frameGraph, shadowsEnabled, cookiesEnabled, this.lights, this.localLights);\n\t\t\tframeGraph.addRenderPass(this._renderPassUpdateClustered);\n\t\t} else {\n\t\t\tthis._shadowRendererLocal.buildNonClusteredRenderPasses(frameGraph, this.localLights);\n\t\t}\n\t\tlet startIndex = 0;\n\t\tlet newStart = true;\n\t\tlet renderTarget = null;\n\t\tconst renderActions = layerComposition._renderActions;\n\t\tfor (let i = startIndex; i < renderActions.length; i++) {\n\t\t\tconst renderAction = renderActions[i];\n\t\t\tconst {\n\t\t\t\tlayer,\n\t\t\t\tcamera\n\t\t\t} = renderAction;\n\t\t\tif (renderAction.useCameraPasses) {\n\t\t\t\tcamera.camera.renderPasses.forEach(renderPass => {\n\t\t\t\t\tframeGraph.addRenderPass(renderPass);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconst depthPass = camera.camera.renderPassDepthGrab;\n\t\t\t\tif (depthPass && webgl1 && renderAction.firstCameraUse) {\n\t\t\t\t\tdepthPass.update(this.scene);\n\t\t\t\t\tframeGraph.addRenderPass(depthPass);\n\t\t\t\t}\n\t\t\t\tconst isDepthLayer = layer.id === LAYERID_DEPTH;\n\t\t\t\tif (webgl1 && isDepthLayer && !camera.renderSceneColorMap) continue;\n\t\t\t\tconst isGrabPass = isDepthLayer && (camera.renderSceneColorMap || camera.renderSceneDepthMap);\n\t\t\t\tif (renderAction.hasDirectionalShadowLights && camera) {\n\t\t\t\t\tthis._shadowRendererDirectional.buildFrameGraph(frameGraph, renderAction.directionalLights, camera);\n\t\t\t\t}\n\t\t\t\tif (newStart) {\n\t\t\t\t\tnewStart = false;\n\t\t\t\t\tstartIndex = i;\n\t\t\t\t\trenderTarget = renderAction.renderTarget;\n\t\t\t\t}\n\t\t\t\tconst nextRenderAction = renderActions[i + 1];\n\t\t\t\tconst isNextLayerDepth = nextRenderAction ? nextRenderAction.layer.id === LAYERID_DEPTH : false;\n\t\t\t\tconst isNextLayerGrabPass = isNextLayerDepth && (camera.renderSceneColorMap || camera.renderSceneDepthMap) && !webgl1;\n\t\t\t\tif (!nextRenderAction || nextRenderAction.renderTarget !== renderTarget || nextRenderAction.hasDirectionalShadowLights || isNextLayerGrabPass || isGrabPass) {\n\t\t\t\t\tconst isDepthOnly = isDepthLayer && startIndex === i;\n\t\t\t\t\tif (!isDepthOnly) {\n\t\t\t\t\t\tthis.addMainRenderPass(frameGraph, layerComposition, renderTarget, startIndex, i);\n\t\t\t\t\t}\n\t\t\t\t\tif (isDepthLayer) {\n\t\t\t\t\t\tif (camera.renderSceneColorMap) {\n\t\t\t\t\t\t\tframeGraph.addRenderPass(camera.camera.renderPassColorGrab);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (camera.renderSceneDepthMap && !webgl1) {\n\t\t\t\t\t\t\tframeGraph.addRenderPass(camera.camera.renderPassDepthGrab);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (renderAction.triggerPostprocess && camera != null && camera.onPostprocessing) {\n\t\t\t\t\t\tconst renderPass = new RenderPassPostprocessing(this.device, this, renderAction);\n\t\t\t\t\t\tframeGraph.addRenderPass(renderPass);\n\t\t\t\t\t}\n\t\t\t\t\tnewStart = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\taddMainRenderPass(frameGraph, layerComposition, renderTarget, startIndex, endIndex) {\n\t\tconst renderPass = new RenderPassRenderActions(this.device, layerComposition, this.scene, this);\n\t\trenderPass.init(renderTarget);\n\t\tconst renderActions = layerComposition._renderActions;\n\t\tfor (let i = startIndex; i <= endIndex; i++) {\n\t\t\trenderPass.addRenderAction(renderActions[i]);\n\t\t}\n\t\tframeGraph.addRenderPass(renderPass);\n\t}\n\tupdate(comp) {\n\t\tthis.frameUpdate();\n\t\tthis.shadowRenderer.frameUpdate();\n\t\tthis.scene._updateSky(this.device);\n\t\tthis.updateLayerComposition(comp);\n\t\tthis.collectLights(comp);\n\t\tthis.beginFrame(comp);\n\t\tthis.setSceneConstants();\n\t\tthis.cullComposition(comp);\n\t\tthis.gpuUpdate(this.processingMeshInstances);\n\t}\n}\n\nexport { ForwardRenderer };\n","import '../core/tracing.js';\nimport { hash32Fnv1a } from '../core/hash.js';\nimport { SORTMODE_MATERIALMESH, SORTMODE_BACK2FRONT, SHADER_FORWARD, LIGHTTYPE_DIRECTIONAL, LAYER_FX, SORTMODE_NONE, SORTMODE_CUSTOM, SORTMODE_FRONT2BACK, SORTKEY_FORWARD } from './constants.js';\nimport { Material } from './materials/material.js';\n\nfunction sortManual(drawCallA, drawCallB) {\n\treturn drawCallA.drawOrder - drawCallB.drawOrder;\n}\nfunction sortMaterialMesh(drawCallA, drawCallB) {\n\tconst keyA = drawCallA._key[SORTKEY_FORWARD];\n\tconst keyB = drawCallB._key[SORTKEY_FORWARD];\n\tif (keyA === keyB && drawCallA.mesh && drawCallB.mesh) {\n\t\treturn drawCallB.mesh.id - drawCallA.mesh.id;\n\t}\n\treturn keyB - keyA;\n}\nfunction sortBackToFront(drawCallA, drawCallB) {\n\treturn drawCallB.zdist - drawCallA.zdist;\n}\nfunction sortFrontToBack(drawCallA, drawCallB) {\n\treturn drawCallA.zdist - drawCallB.zdist;\n}\nconst sortCallbacks = [null, sortManual, sortMaterialMesh, sortBackToFront, sortFrontToBack];\nlet layerCounter = 0;\nconst lightKeys = [];\nconst _tempMaterials = new Set();\nclass CulledInstances {\n\tconstructor() {\n\t\tthis.opaque = [];\n\t\tthis.transparent = [];\n\t}\n}\nclass Layer {\n\tconstructor(options = {}) {\n\t\tvar _options$enabled, _options$opaqueSortMo, _options$transparentS, _options$shaderPass;\n\t\tthis.meshInstances = [];\n\t\tthis.meshInstancesSet = new Set();\n\t\tthis.shadowCasters = [];\n\t\tthis.shadowCastersSet = new Set();\n\t\tthis._visibleInstances = new WeakMap();\n\t\tthis._lights = [];\n\t\tthis._lightsSet = new Set();\n\t\tthis._clusteredLightsSet = new Set();\n\t\tthis._splitLights = [[], [], []];\n\t\tthis._splitLightsDirty = true;\n\t\tthis.requiresLightCube = false;\n\t\tthis.cameras = [];\n\t\tthis.camerasSet = new Set();\n\t\tthis._dirtyComposition = false;\n\t\tif (options.id !== undefined) {\n\t\t\tthis.id = options.id;\n\t\t\tlayerCounter = Math.max(this.id + 1, layerCounter);\n\t\t} else {\n\t\t\tthis.id = layerCounter++;\n\t\t}\n\t\tthis.name = options.name;\n\t\tthis._enabled = (_options$enabled = options.enabled) != null ? _options$enabled : true;\n\t\tthis._refCounter = this._enabled ? 1 : 0;\n\t\tthis.opaqueSortMode = (_options$opaqueSortMo = options.opaqueSortMode) != null ? _options$opaqueSortMo : SORTMODE_MATERIALMESH;\n\t\tthis.transparentSortMode = (_options$transparentS = options.transparentSortMode) != null ? _options$transparentS : SORTMODE_BACK2FRONT;\n\t\tif (options.renderTarget) {\n\t\t\tthis.renderTarget = options.renderTarget;\n\t\t}\n\t\tthis.shaderPass = (_options$shaderPass = options.shaderPass) != null ? _options$shaderPass : SHADER_FORWARD;\n\t\tthis._clearColorBuffer = !!options.clearColorBuffer;\n\t\tthis._clearDepthBuffer = !!options.clearDepthBuffer;\n\t\tthis._clearStencilBuffer = !!options.clearStencilBuffer;\n\t\tthis.onPreCull = options.onPreCull;\n\t\tthis.onPreRender = options.onPreRender;\n\t\tthis.onPreRenderOpaque = options.onPreRenderOpaque;\n\t\tthis.onPreRenderTransparent = options.onPreRenderTransparent;\n\t\tthis.onPostCull = options.onPostCull;\n\t\tthis.onPostRender = options.onPostRender;\n\t\tthis.onPostRenderOpaque = options.onPostRenderOpaque;\n\t\tthis.onPostRenderTransparent = options.onPostRenderTransparent;\n\t\tthis.onDrawCall = options.onDrawCall;\n\t\tthis.onEnable = options.onEnable;\n\t\tthis.onDisable = options.onDisable;\n\t\tif (this._enabled && this.onEnable) {\n\t\t\tthis.onEnable();\n\t\t}\n\t\tthis.layerReference = options.layerReference;\n\t\tthis.customSortCallback = null;\n\t\tthis.customCalculateSortValues = null;\n\t\tthis._lightHash = 0;\n\t\tthis._lightHashDirty = false;\n\t\tthis._lightIdHash = 0;\n\t\tthis._lightIdHashDirty = false;\n\t\tthis._shaderVersion = -1;\n\t}\n\tset enabled(val) {\n\t\tif (val !== this._enabled) {\n\t\t\tthis._dirtyComposition = true;\n\t\t\tthis._enabled = val;\n\t\t\tif (val) {\n\t\t\t\tthis.incrementCounter();\n\t\t\t\tif (this.onEnable) this.onEnable();\n\t\t\t} else {\n\t\t\t\tthis.decrementCounter();\n\t\t\t\tif (this.onDisable) this.onDisable();\n\t\t\t}\n\t\t}\n\t}\n\tget enabled() {\n\t\treturn this._enabled;\n\t}\n\tset clearColorBuffer(val) {\n\t\tthis._clearColorBuffer = val;\n\t\tthis._dirtyComposition = true;\n\t}\n\tget clearColorBuffer() {\n\t\treturn this._clearColorBuffer;\n\t}\n\tset clearDepthBuffer(val) {\n\t\tthis._clearDepthBuffer = val;\n\t\tthis._dirtyComposition = true;\n\t}\n\tget clearDepthBuffer() {\n\t\treturn this._clearDepthBuffer;\n\t}\n\tset clearStencilBuffer(val) {\n\t\tthis._clearStencilBuffer = val;\n\t\tthis._dirtyComposition = true;\n\t}\n\tget clearStencilBuffer() {\n\t\treturn this._clearStencilBuffer;\n\t}\n\tget hasClusteredLights() {\n\t\treturn this._clusteredLightsSet.size > 0;\n\t}\n\tget clusteredLightsSet() {\n\t\treturn this._clusteredLightsSet;\n\t}\n\tincrementCounter() {\n\t\tif (this._refCounter === 0) {\n\t\t\tthis._enabled = true;\n\t\t\tif (this.onEnable) this.onEnable();\n\t\t}\n\t\tthis._refCounter++;\n\t}\n\tdecrementCounter() {\n\t\tif (this._refCounter === 1) {\n\t\t\tthis._enabled = false;\n\t\t\tif (this.onDisable) this.onDisable();\n\t\t} else if (this._refCounter === 0) {\n\t\t\treturn;\n\t\t}\n\t\tthis._refCounter--;\n\t}\n\taddMeshInstances(meshInstances, skipShadowCasters) {\n\t\tconst destMeshInstances = this.meshInstances;\n\t\tconst destMeshInstancesSet = this.meshInstancesSet;\n\t\tfor (let i = 0; i < meshInstances.length; i++) {\n\t\t\tconst mi = meshInstances[i];\n\t\t\tif (!destMeshInstancesSet.has(mi)) {\n\t\t\t\tdestMeshInstances.push(mi);\n\t\t\t\tdestMeshInstancesSet.add(mi);\n\t\t\t\t_tempMaterials.add(mi.material);\n\t\t\t}\n\t\t}\n\t\tif (!skipShadowCasters) {\n\t\t\tthis.addShadowCasters(meshInstances);\n\t\t}\n\t\tif (_tempMaterials.size > 0) {\n\t\t\tconst sceneShaderVer = this._shaderVersion;\n\t\t\t_tempMaterials.forEach(mat => {\n\t\t\t\tif (sceneShaderVer >= 0 && mat._shaderVersion !== sceneShaderVer) {\n\t\t\t\t\tif (mat.getShaderVariant !== Material.prototype.getShaderVariant) {\n\t\t\t\t\t\tmat.clearVariants();\n\t\t\t\t\t}\n\t\t\t\t\tmat._shaderVersion = sceneShaderVer;\n\t\t\t\t}\n\t\t\t});\n\t\t\t_tempMaterials.clear();\n\t\t}\n\t}\n\tremoveMeshInstances(meshInstances, skipShadowCasters) {\n\t\tconst destMeshInstances = this.meshInstances;\n\t\tconst destMeshInstancesSet = this.meshInstancesSet;\n\t\tfor (let i = 0; i < meshInstances.length; i++) {\n\t\t\tconst mi = meshInstances[i];\n\t\t\tif (destMeshInstancesSet.has(mi)) {\n\t\t\t\tdestMeshInstancesSet.delete(mi);\n\t\t\t\tconst j = destMeshInstances.indexOf(mi);\n\t\t\t\tif (j >= 0) {\n\t\t\t\t\tdestMeshInstances.splice(j, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (!skipShadowCasters) {\n\t\t\tthis.removeShadowCasters(meshInstances);\n\t\t}\n\t}\n\taddShadowCasters(meshInstances) {\n\t\tconst shadowCasters = this.shadowCasters;\n\t\tconst shadowCastersSet = this.shadowCastersSet;\n\t\tfor (let i = 0; i < meshInstances.length; i++) {\n\t\t\tconst mi = meshInstances[i];\n\t\t\tif (mi.castShadow && !shadowCastersSet.has(mi)) {\n\t\t\t\tshadowCastersSet.add(mi);\n\t\t\t\tshadowCasters.push(mi);\n\t\t\t}\n\t\t}\n\t}\n\tremoveShadowCasters(meshInstances) {\n\t\tconst shadowCasters = this.shadowCasters;\n\t\tconst shadowCastersSet = this.shadowCastersSet;\n\t\tfor (let i = 0; i < meshInstances.length; i++) {\n\t\t\tconst mi = meshInstances[i];\n\t\t\tif (shadowCastersSet.has(mi)) {\n\t\t\t\tshadowCastersSet.delete(mi);\n\t\t\t\tconst j = shadowCasters.indexOf(mi);\n\t\t\t\tif (j >= 0) {\n\t\t\t\t\tshadowCasters.splice(j, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tclearMeshInstances(skipShadowCasters = false) {\n\t\tthis.meshInstances.length = 0;\n\t\tthis.meshInstancesSet.clear();\n\t\tif (!skipShadowCasters) {\n\t\t\tthis.shadowCasters.length = 0;\n\t\t\tthis.shadowCastersSet.clear();\n\t\t}\n\t}\n\tmarkLightsDirty() {\n\t\tthis._lightHashDirty = true;\n\t\tthis._lightIdHashDirty = true;\n\t\tthis._splitLightsDirty = true;\n\t}\n\taddLight(light) {\n\t\tconst l = light.light;\n\t\tif (!this._lightsSet.has(l)) {\n\t\t\tthis._lightsSet.add(l);\n\t\t\tthis._lights.push(l);\n\t\t\tthis.markLightsDirty();\n\t\t}\n\t\tif (l.type !== LIGHTTYPE_DIRECTIONAL) {\n\t\t\tthis._clusteredLightsSet.add(l);\n\t\t}\n\t}\n\tremoveLight(light) {\n\t\tconst l = light.light;\n\t\tif (this._lightsSet.has(l)) {\n\t\t\tthis._lightsSet.delete(l);\n\t\t\tthis._lights.splice(this._lights.indexOf(l), 1);\n\t\t\tthis.markLightsDirty();\n\t\t}\n\t\tif (l.type !== LIGHTTYPE_DIRECTIONAL) {\n\t\t\tthis._clusteredLightsSet.delete(l);\n\t\t}\n\t}\n\tclearLights() {\n\t\tthis._lightsSet.forEach(light => light.removeLayer(this));\n\t\tthis._lightsSet.clear();\n\t\tthis._clusteredLightsSet.clear();\n\t\tthis._lights.length = 0;\n\t\tthis.markLightsDirty();\n\t}\n\tget splitLights() {\n\t\tif (this._splitLightsDirty) {\n\t\t\tthis._splitLightsDirty = false;\n\t\t\tconst splitLights = this._splitLights;\n\t\t\tfor (let i = 0; i < splitLights.length; i++) splitLights[i].length = 0;\n\t\t\tconst lights = this._lights;\n\t\t\tfor (let i = 0; i < lights.length; i++) {\n\t\t\t\tconst light = lights[i];\n\t\t\t\tif (light.enabled) {\n\t\t\t\t\tsplitLights[light._type].push(light);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (let i = 0; i < splitLights.length; i++) splitLights[i].sort((a, b) => a.key - b.key);\n\t\t}\n\t\treturn this._splitLights;\n\t}\n\tevaluateLightHash(localLights, directionalLights, useIds) {\n\t\tlet hash = 0;\n\t\tconst lights = this._lights;\n\t\tfor (let i = 0; i < lights.length; i++) {\n\t\t\tconst isLocalLight = lights[i].type !== LIGHTTYPE_DIRECTIONAL;\n\t\t\tif (localLights && isLocalLight || directionalLights && !isLocalLight) {\n\t\t\t\tlightKeys.push(useIds ? lights[i].id : lights[i].key);\n\t\t\t}\n\t\t}\n\t\tif (lightKeys.length > 0) {\n\t\t\tlightKeys.sort();\n\t\t\thash = hash32Fnv1a(lightKeys);\n\t\t\tlightKeys.length = 0;\n\t\t}\n\t\treturn hash;\n\t}\n\tgetLightHash(isClustered) {\n\t\tif (this._lightHashDirty) {\n\t\t\tthis._lightHashDirty = false;\n\t\t\tthis._lightHash = this.evaluateLightHash(!isClustered, true, false);\n\t\t}\n\t\treturn this._lightHash;\n\t}\n\tgetLightIdHash() {\n\t\tif (this._lightIdHashDirty) {\n\t\t\tthis._lightIdHashDirty = false;\n\t\t\tthis._lightIdHash = this.evaluateLightHash(true, false, true);\n\t\t}\n\t\treturn this._lightIdHash;\n\t}\n\taddCamera(camera) {\n\t\tif (!this.camerasSet.has(camera.camera)) {\n\t\t\tthis.camerasSet.add(camera.camera);\n\t\t\tthis.cameras.push(camera);\n\t\t\tthis._dirtyComposition = true;\n\t\t}\n\t}\n\tremoveCamera(camera) {\n\t\tif (this.camerasSet.has(camera.camera)) {\n\t\t\tthis.camerasSet.delete(camera.camera);\n\t\t\tconst index = this.cameras.indexOf(camera);\n\t\t\tthis.cameras.splice(index, 1);\n\t\t\tthis._dirtyComposition = true;\n\t\t}\n\t}\n\tclearCameras() {\n\t\tthis.cameras.length = 0;\n\t\tthis.camerasSet.clear();\n\t\tthis._dirtyComposition = true;\n\t}\n\t_calculateSortDistances(drawCalls, drawCallsCount, camPos, camFwd) {\n\t\tfor (let i = 0; i < drawCallsCount; i++) {\n\t\t\tconst drawCall = drawCalls[i];\n\t\t\tif (drawCall.layer <= LAYER_FX) continue;\n\t\t\tif (drawCall.calculateSortDistance) {\n\t\t\t\tdrawCall.zdist = drawCall.calculateSortDistance(drawCall, camPos, camFwd);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst meshPos = drawCall.aabb.center;\n\t\t\tconst tempx = meshPos.x - camPos.x;\n\t\t\tconst tempy = meshPos.y - camPos.y;\n\t\t\tconst tempz = meshPos.z - camPos.z;\n\t\t\tdrawCall.zdist = tempx * camFwd.x + tempy * camFwd.y + tempz * camFwd.z;\n\t\t}\n\t}\n\tgetCulledInstances(camera) {\n\t\tlet instances = this._visibleInstances.get(camera);\n\t\tif (!instances) {\n\t\t\tinstances = new CulledInstances();\n\t\t\tthis._visibleInstances.set(camera, instances);\n\t\t}\n\t\treturn instances;\n\t}\n\tsortVisible(camera, transparent) {\n\t\tconst sortMode = transparent ? this.transparentSortMode : this.opaqueSortMode;\n\t\tif (sortMode === SORTMODE_NONE) return;\n\t\tconst culledInstances = this.getCulledInstances(camera);\n\t\tconst instances = transparent ? culledInstances.transparent : culledInstances.opaque;\n\t\tconst cameraNode = camera.node;\n\t\tif (sortMode === SORTMODE_CUSTOM) {\n\t\t\tconst sortPos = cameraNode.getPosition();\n\t\t\tconst sortDir = cameraNode.forward;\n\t\t\tif (this.customCalculateSortValues) {\n\t\t\t\tthis.customCalculateSortValues(instances, instances.length, sortPos, sortDir);\n\t\t\t}\n\t\t\tif (this.customSortCallback) {\n\t\t\t\tinstances.sort(this.customSortCallback);\n\t\t\t}\n\t\t} else {\n\t\t\tif (sortMode === SORTMODE_BACK2FRONT || sortMode === SORTMODE_FRONT2BACK) {\n\t\t\t\tconst sortPos = cameraNode.getPosition();\n\t\t\t\tconst sortDir = cameraNode.forward;\n\t\t\t\tthis._calculateSortDistances(instances, instances.length, sortPos, sortDir);\n\t\t\t}\n\t\t\tinstances.sort(sortCallbacks[sortMode]);\n\t\t}\n\t}\n}\n\nexport { CulledInstances, Layer };\n","const cmpPriority = (a, b) => a.priority - b.priority;\nconst sortPriority = arr => arr.sort(cmpPriority);\n\nexport { sortPriority };\n","import '../../core/tracing.js';\nimport { EventHandler } from '../../core/event-handler.js';\nimport { sortPriority } from '../../core/sort.js';\nimport { LAYERID_DEPTH } from '../constants.js';\nimport { RenderAction } from './render-action.js';\n\nclass LayerComposition extends EventHandler {\n\tconstructor(name = 'Untitled') {\n\t\tsuper();\n\t\tthis.layerList = [];\n\t\tthis.layerIdMap = new Map();\n\t\tthis.layerNameMap = new Map();\n\t\tthis.layerOpaqueIndexMap = new Map();\n\t\tthis.layerTransparentIndexMap = new Map();\n\t\tthis.subLayerList = [];\n\t\tthis.subLayerEnabled = [];\n\t\tthis.cameras = [];\n\t\tthis.camerasMap = new Map();\n\t\tthis._renderActions = [];\n\t\tthis._dirty = false;\n\t\tthis.name = name;\n\t\tthis._opaqueOrder = {};\n\t\tthis._transparentOrder = {};\n\t}\n\tdestroy() {\n\t\tthis.destroyRenderActions();\n\t}\n\tdestroyRenderActions() {\n\t\tthis._renderActions.forEach(ra => ra.destroy());\n\t\tthis._renderActions.length = 0;\n\t}\n\t_update() {\n\t\tconst len = this.layerList.length;\n\t\tif (!this._dirty) {\n\t\t\tfor (let i = 0; i < len; i++) {\n\t\t\t\tif (this.layerList[i]._dirtyComposition) {\n\t\t\t\t\tthis._dirty = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (this._dirty) {\n\t\t\tthis._dirty = false;\n\t\t\tthis.cameras.length = 0;\n\t\t\tfor (let i = 0; i < len; i++) {\n\t\t\t\tconst layer = this.layerList[i];\n\t\t\t\tlayer._dirtyComposition = false;\n\t\t\t\tfor (let j = 0; j < layer.cameras.length; j++) {\n\t\t\t\t\tconst camera = layer.cameras[j];\n\t\t\t\t\tconst index = this.cameras.indexOf(camera);\n\t\t\t\t\tif (index < 0) {\n\t\t\t\t\t\tthis.cameras.push(camera);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.cameras.length > 1) {\n\t\t\t\tsortPriority(this.cameras);\n\t\t\t}\n\t\t\tthis.camerasMap.clear();\n\t\t\tfor (let i = 0; i < this.cameras.length; i++) {\n\t\t\t\tthis.camerasMap.set(this.cameras[i], i);\n\t\t\t}\n\t\t\tlet renderActionCount = 0;\n\t\t\tthis.destroyRenderActions();\n\t\t\tfor (let i = 0; i < this.cameras.length; i++) {\n\t\t\t\tconst camera = this.cameras[i];\n\t\t\t\tif (camera.camera.renderPasses.length > 0) {\n\t\t\t\t\tthis.addDummyRenderAction(renderActionCount, camera);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tlet cameraFirstRenderAction = true;\n\t\t\t\tconst cameraFirstRenderActionIndex = renderActionCount;\n\t\t\t\tlet lastRenderAction = null;\n\t\t\t\tlet postProcessMarked = false;\n\t\t\t\tfor (let j = 0; j < len; j++) {\n\t\t\t\t\tconst layer = this.layerList[j];\n\t\t\t\t\tconst isLayerEnabled = layer.enabled && this.subLayerEnabled[j];\n\t\t\t\t\tif (isLayerEnabled) {\n\t\t\t\t\t\tif (layer.cameras.length > 0) {\n\t\t\t\t\t\t\tif (camera.layers.indexOf(layer.id) >= 0) {\n\t\t\t\t\t\t\t\tif (!postProcessMarked && layer.id === camera.disablePostEffectsLayer) {\n\t\t\t\t\t\t\t\t\tpostProcessMarked = true;\n\t\t\t\t\t\t\t\t\tif (lastRenderAction) {\n\t\t\t\t\t\t\t\t\t\tlastRenderAction.triggerPostprocess = true;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tconst isTransparent = this.subLayerList[j];\n\t\t\t\t\t\t\t\tlastRenderAction = this.addRenderAction(renderActionCount, layer, isTransparent, camera, cameraFirstRenderAction, postProcessMarked);\n\t\t\t\t\t\t\t\trenderActionCount++;\n\t\t\t\t\t\t\t\tcameraFirstRenderAction = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (cameraFirstRenderActionIndex < renderActionCount) {\n\t\t\t\t\tlastRenderAction.lastCameraUse = true;\n\t\t\t\t}\n\t\t\t\tif (!postProcessMarked && lastRenderAction) {\n\t\t\t\t\tlastRenderAction.triggerPostprocess = true;\n\t\t\t\t}\n\t\t\t\tif (camera.renderTarget && camera.postEffectsEnabled) {\n\t\t\t\t\tthis.propagateRenderTarget(cameraFirstRenderActionIndex - 1, camera);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._logRenderActions();\n\t\t}\n\t}\n\tgetNextRenderAction(renderActionIndex) {\n\t\tconst renderAction = new RenderAction();\n\t\tthis._renderActions.push(renderAction);\n\t\treturn renderAction;\n\t}\n\taddDummyRenderAction(renderActionIndex, camera) {\n\t\tconst renderAction = this.getNextRenderAction(renderActionIndex);\n\t\trenderAction.camera = camera;\n\t\trenderAction.useCameraPasses = true;\n\t}\n\taddRenderAction(renderActionIndex, layer, isTransparent, camera, cameraFirstRenderAction, postProcessMarked) {\n\t\tlet rt = layer.renderTarget;\n\t\tif (camera && camera.renderTarget) {\n\t\t\tif (layer.id !== LAYERID_DEPTH) {\n\t\t\t\trt = camera.renderTarget;\n\t\t\t}\n\t\t}\n\t\tlet used = false;\n\t\tconst renderActions = this._renderActions;\n\t\tfor (let i = renderActionIndex - 1; i >= 0; i--) {\n\t\t\tif (renderActions[i].camera === camera && renderActions[i].renderTarget === rt) {\n\t\t\t\tused = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (postProcessMarked && camera.postEffectsEnabled) {\n\t\t\trt = null;\n\t\t}\n\t\tconst renderAction = this.getNextRenderAction(renderActionIndex);\n\t\trenderAction.triggerPostprocess = false;\n\t\trenderAction.layer = layer;\n\t\trenderAction.transparent = isTransparent;\n\t\trenderAction.camera = camera;\n\t\trenderAction.renderTarget = rt;\n\t\trenderAction.firstCameraUse = cameraFirstRenderAction;\n\t\trenderAction.lastCameraUse = false;\n\t\tconst needsCameraClear = cameraFirstRenderAction || !used;\n\t\tconst needsLayerClear = layer.clearColorBuffer || layer.clearDepthBuffer || layer.clearStencilBuffer;\n\t\tif (needsCameraClear || needsLayerClear) {\n\t\t\trenderAction.setupClears(needsCameraClear ? camera : undefined, layer);\n\t\t}\n\t\treturn renderAction;\n\t}\n\tpropagateRenderTarget(startIndex, fromCamera) {\n\t\tfor (let a = startIndex; a >= 0; a--) {\n\t\t\tconst ra = this._renderActions[a];\n\t\t\tconst layer = ra.layer;\n\t\t\tif (ra.renderTarget && layer.id !== LAYERID_DEPTH) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (layer.id === LAYERID_DEPTH) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (ra.useCameraPasses) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tconst thisCamera = ra == null ? void 0 : ra.camera.camera;\n\t\t\tif (thisCamera) {\n\t\t\t\tif (!fromCamera.camera.rect.equals(thisCamera.rect) || !fromCamera.camera.scissorRect.equals(thisCamera.scissorRect)) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tra.renderTarget = fromCamera.renderTarget;\n\t\t}\n\t}\n\t_logRenderActions() {}\n\t_isLayerAdded(layer) {\n\t\tconst found = this.layerIdMap.get(layer.id) === layer;\n\t\treturn found;\n\t}\n\t_isSublayerAdded(layer, transparent) {\n\t\tconst map = transparent ? this.layerTransparentIndexMap : this.layerOpaqueIndexMap;\n\t\tif (map.get(layer) !== undefined) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\tpush(layer) {\n\t\tif (this._isLayerAdded(layer)) return;\n\t\tthis.layerList.push(layer);\n\t\tthis.layerList.push(layer);\n\t\tthis._opaqueOrder[layer.id] = this.subLayerList.push(false) - 1;\n\t\tthis._transparentOrder[layer.id] = this.subLayerList.push(true) - 1;\n\t\tthis.subLayerEnabled.push(true);\n\t\tthis.subLayerEnabled.push(true);\n\t\tthis._updateLayerMaps();\n\t\tthis._dirty = true;\n\t\tthis.fire('add', layer);\n\t}\n\tinsert(layer, index) {\n\t\tif (this._isLayerAdded(layer)) return;\n\t\tthis.layerList.splice(index, 0, layer, layer);\n\t\tthis.subLayerList.splice(index, 0, false, true);\n\t\tconst count = this.layerList.length;\n\t\tthis._updateOpaqueOrder(index, count - 1);\n\t\tthis._updateTransparentOrder(index, count - 1);\n\t\tthis.subLayerEnabled.splice(index, 0, true, true);\n\t\tthis._updateLayerMaps();\n\t\tthis._dirty = true;\n\t\tthis.fire('add', layer);\n\t}\n\tremove(layer) {\n\t\tlet id = this.layerList.indexOf(layer);\n\t\tdelete this._opaqueOrder[id];\n\t\tdelete this._transparentOrder[id];\n\t\twhile (id >= 0) {\n\t\t\tthis.layerList.splice(id, 1);\n\t\t\tthis.subLayerList.splice(id, 1);\n\t\t\tthis.subLayerEnabled.splice(id, 1);\n\t\t\tid = this.layerList.indexOf(layer);\n\t\t\tthis._dirty = true;\n\t\t\tthis.fire('remove', layer);\n\t\t}\n\t\tconst count = this.layerList.length;\n\t\tthis._updateOpaqueOrder(0, count - 1);\n\t\tthis._updateTransparentOrder(0, count - 1);\n\t\tthis._updateLayerMaps();\n\t}\n\tpushOpaque(layer) {\n\t\tif (this._isSublayerAdded(layer, false)) return;\n\t\tthis.layerList.push(layer);\n\t\tthis._opaqueOrder[layer.id] = this.subLayerList.push(false) - 1;\n\t\tthis.subLayerEnabled.push(true);\n\t\tthis._updateLayerMaps();\n\t\tthis._dirty = true;\n\t\tthis.fire('add', layer);\n\t}\n\tinsertOpaque(layer, index) {\n\t\tif (this._isSublayerAdded(layer, false)) return;\n\t\tthis.layerList.splice(index, 0, layer);\n\t\tthis.subLayerList.splice(index, 0, false);\n\t\tconst count = this.subLayerList.length;\n\t\tthis._updateOpaqueOrder(index, count - 1);\n\t\tthis.subLayerEnabled.splice(index, 0, true);\n\t\tthis._updateLayerMaps();\n\t\tthis._dirty = true;\n\t\tthis.fire('add', layer);\n\t}\n\tremoveOpaque(layer) {\n\t\tfor (let i = 0, len = this.layerList.length; i < len; i++) {\n\t\t\tif (this.layerList[i] === layer && !this.subLayerList[i]) {\n\t\t\t\tthis.layerList.splice(i, 1);\n\t\t\t\tthis.subLayerList.splice(i, 1);\n\t\t\t\tlen--;\n\t\t\t\tthis._updateOpaqueOrder(i, len - 1);\n\t\t\t\tthis.subLayerEnabled.splice(i, 1);\n\t\t\t\tthis._dirty = true;\n\t\t\t\tif (this.layerList.indexOf(layer) < 0) {\n\t\t\t\t\tthis.fire('remove', layer);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tthis._updateLayerMaps();\n\t}\n\tpushTransparent(layer) {\n\t\tif (this._isSublayerAdded(layer, true)) return;\n\t\tthis.layerList.push(layer);\n\t\tthis._transparentOrder[layer.id] = this.subLayerList.push(true) - 1;\n\t\tthis.subLayerEnabled.push(true);\n\t\tthis._updateLayerMaps();\n\t\tthis._dirty = true;\n\t\tthis.fire('add', layer);\n\t}\n\tinsertTransparent(layer, index) {\n\t\tif (this._isSublayerAdded(layer, true)) return;\n\t\tthis.layerList.splice(index, 0, layer);\n\t\tthis.subLayerList.splice(index, 0, true);\n\t\tconst count = this.subLayerList.length;\n\t\tthis._updateTransparentOrder(index, count - 1);\n\t\tthis.subLayerEnabled.splice(index, 0, true);\n\t\tthis._updateLayerMaps();\n\t\tthis._dirty = true;\n\t\tthis.fire('add', layer);\n\t}\n\tremoveTransparent(layer) {\n\t\tfor (let i = 0, len = this.layerList.length; i < len; i++) {\n\t\t\tif (this.layerList[i] === layer && this.subLayerList[i]) {\n\t\t\t\tthis.layerList.splice(i, 1);\n\t\t\t\tthis.subLayerList.splice(i, 1);\n\t\t\t\tlen--;\n\t\t\t\tthis._updateTransparentOrder(i, len - 1);\n\t\t\t\tthis.subLayerEnabled.splice(i, 1);\n\t\t\t\tthis._dirty = true;\n\t\t\t\tif (this.layerList.indexOf(layer) < 0) {\n\t\t\t\t\tthis.fire('remove', layer);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tthis._updateLayerMaps();\n\t}\n\tgetOpaqueIndex(layer) {\n\t\tvar _this$layerOpaqueInde;\n\t\treturn (_this$layerOpaqueInde = this.layerOpaqueIndexMap.get(layer)) != null ? _this$layerOpaqueInde : -1;\n\t}\n\tgetTransparentIndex(layer) {\n\t\tvar _this$layerTransparen;\n\t\treturn (_this$layerTransparen = this.layerTransparentIndexMap.get(layer)) != null ? _this$layerTransparen : -1;\n\t}\n\tisEnabled(layer, transparent) {\n\t\tconst index = transparent ? this.getTransparentIndex(layer) : this.getOpaqueIndex(layer);\n\t\treturn this.subLayerEnabled[index];\n\t}\n\t_updateLayerMaps() {\n\t\tthis.layerIdMap.clear();\n\t\tthis.layerNameMap.clear();\n\t\tthis.layerOpaqueIndexMap.clear();\n\t\tthis.layerTransparentIndexMap.clear();\n\t\tfor (let i = 0; i < this.layerList.length; i++) {\n\t\t\tconst layer = this.layerList[i];\n\t\t\tthis.layerIdMap.set(layer.id, layer);\n\t\t\tthis.layerNameMap.set(layer.name, layer);\n\t\t\tconst subLayerIndexMap = this.subLayerList[i] ? this.layerTransparentIndexMap : this.layerOpaqueIndexMap;\n\t\t\tsubLayerIndexMap.set(layer, i);\n\t\t}\n\t}\n\tgetLayerById(id) {\n\t\tvar _this$layerIdMap$get;\n\t\treturn (_this$layerIdMap$get = this.layerIdMap.get(id)) != null ? _this$layerIdMap$get : null;\n\t}\n\tgetLayerByName(name) {\n\t\tvar _this$layerNameMap$ge;\n\t\treturn (_this$layerNameMap$ge = this.layerNameMap.get(name)) != null ? _this$layerNameMap$ge : null;\n\t}\n\t_updateOpaqueOrder(startIndex, endIndex) {\n\t\tfor (let i = startIndex; i <= endIndex; i++) {\n\t\t\tif (this.subLayerList[i] === false) {\n\t\t\t\tthis._opaqueOrder[this.layerList[i].id] = i;\n\t\t\t}\n\t\t}\n\t}\n\t_updateTransparentOrder(startIndex, endIndex) {\n\t\tfor (let i = startIndex; i <= endIndex; i++) {\n\t\t\tif (this.subLayerList[i] === true) {\n\t\t\t\tthis._transparentOrder[this.layerList[i].id] = i;\n\t\t\t}\n\t\t}\n\t}\n\t_sortLayersDescending(layersA, layersB, order) {\n\t\tlet topLayerA = -1;\n\t\tlet topLayerB = -1;\n\t\tfor (let i = 0, len = layersA.length; i < len; i++) {\n\t\t\tconst id = layersA[i];\n\t\t\tif (order.hasOwnProperty(id)) {\n\t\t\t\ttopLayerA = Math.max(topLayerA, order[id]);\n\t\t\t}\n\t\t}\n\t\tfor (let i = 0, len = layersB.length; i < len; i++) {\n\t\t\tconst id = layersB[i];\n\t\t\tif (order.hasOwnProperty(id)) {\n\t\t\t\ttopLayerB = Math.max(topLayerB, order[id]);\n\t\t\t}\n\t\t}\n\t\tif (topLayerA === -1 && topLayerB !== -1) {\n\t\t\treturn 1;\n\t\t} else if (topLayerB === -1 && topLayerA !== -1) {\n\t\t\treturn -1;\n\t\t}\n\t\treturn topLayerB - topLayerA;\n\t}\n\tsortTransparentLayers(layersA, layersB) {\n\t\treturn this._sortLayersDescending(layersA, layersB, this._transparentOrder);\n\t}\n\tsortOpaqueLayers(layersA, layersB) {\n\t\treturn this._sortLayersDescending(layersA, layersB, this._opaqueOrder);\n\t}\n}\n\nexport { LayerComposition };\n","import { math } from '../core/math/math.js';\nimport { Color } from '../core/math/color.js';\nimport { Mat4 } from '../core/math/mat4.js';\nimport { Vec2 } from '../core/math/vec2.js';\nimport { Vec3 } from '../core/math/vec3.js';\nimport { Vec4 } from '../core/math/vec4.js';\nimport { LIGHTTYPE_DIRECTIONAL, MASK_AFFECT_DYNAMIC, LIGHTFALLOFF_LINEAR, SHADOW_PCF3, BLUR_GAUSSIAN, LIGHTSHAPE_PUNCTUAL, SHADOWUPDATE_REALTIME, LIGHTTYPE_OMNI, SHADOW_PCSS, SHADOW_PCF5, SHADOW_VSM32, SHADOW_VSM16, SHADOW_VSM8, SHADOW_PCF1, MASK_BAKE, SHADOWUPDATE_NONE, SHADOWUPDATE_THISFRAME, LIGHTTYPE_SPOT } from './constants.js';\nimport { ShadowRenderer } from './renderer/shadow-renderer.js';\n\nconst tmpVec = new Vec3();\nconst tmpBiases = {\n\tbias: 0,\n\tnormalBias: 0\n};\nconst chanId = {\n\tr: 0,\n\tg: 1,\n\tb: 2,\n\ta: 3\n};\nconst lightTypes = {\n\t'directional': LIGHTTYPE_DIRECTIONAL,\n\t'omni': LIGHTTYPE_OMNI,\n\t'point': LIGHTTYPE_OMNI,\n\t'spot': LIGHTTYPE_SPOT\n};\nconst directionalCascades = [[new Vec4(0, 0, 1, 1)], [new Vec4(0, 0, 0.5, 0.5), new Vec4(0, 0.5, 0.5, 0.5)], [new Vec4(0, 0, 0.5, 0.5), new Vec4(0, 0.5, 0.5, 0.5), new Vec4(0.5, 0, 0.5, 0.5)], [new Vec4(0, 0, 0.5, 0.5), new Vec4(0, 0.5, 0.5, 0.5), new Vec4(0.5, 0, 0.5, 0.5), new Vec4(0.5, 0.5, 0.5, 0.5)]];\nlet id = 0;\nclass LightRenderData {\n\tconstructor(device, camera, face, light) {\n\t\tthis.light = light;\n\t\tthis.camera = camera;\n\t\tthis.shadowCamera = ShadowRenderer.createShadowCamera(device, light._shadowType, light._type, face);\n\t\tthis.shadowMatrix = new Mat4();\n\t\tthis.shadowViewport = new Vec4(0, 0, 1, 1);\n\t\tthis.shadowScissor = new Vec4(0, 0, 1, 1);\n\t\tthis.depthRangeCompensation = 0;\n\t\tthis.projectionCompensation = 0;\n\t\tthis.face = face;\n\t\tthis.visibleCasters = [];\n\t\tthis.viewBindGroups = [];\n\t}\n\tdestroy() {\n\t\tthis.viewBindGroups.forEach(bg => {\n\t\t\tbg.defaultUniformBuffer.destroy();\n\t\t\tbg.destroy();\n\t\t});\n\t\tthis.viewBindGroups.length = 0;\n\t}\n\tget shadowBuffer() {\n\t\tconst rt = this.shadowCamera.renderTarget;\n\t\tif (rt) {\n\t\t\tconst light = this.light;\n\t\t\tif (light._type === LIGHTTYPE_OMNI) {\n\t\t\t\treturn rt.colorBuffer;\n\t\t\t}\n\t\t\treturn light._isPcf && light.device.supportsDepthShadow ? rt.depthBuffer : rt.colorBuffer;\n\t\t}\n\t\treturn null;\n\t}\n}\nclass Light {\n\tconstructor(graphicsDevice) {\n\t\tthis.layers = new Set();\n\t\tthis.device = graphicsDevice;\n\t\tthis.id = id++;\n\t\tthis._type = LIGHTTYPE_DIRECTIONAL;\n\t\tthis._color = new Color(0.8, 0.8, 0.8);\n\t\tthis._intensity = 1;\n\t\tthis._affectSpecularity = true;\n\t\tthis._luminance = 0;\n\t\tthis._castShadows = false;\n\t\tthis._enabled = false;\n\t\tthis._mask = MASK_AFFECT_DYNAMIC;\n\t\tthis.isStatic = false;\n\t\tthis.key = 0;\n\t\tthis.bakeDir = true;\n\t\tthis.bakeNumSamples = 1;\n\t\tthis.bakeArea = 0;\n\t\tthis.attenuationStart = 10;\n\t\tthis.attenuationEnd = 10;\n\t\tthis._falloffMode = LIGHTFALLOFF_LINEAR;\n\t\tthis._shadowType = SHADOW_PCF3;\n\t\tthis._vsmBlurSize = 11;\n\t\tthis.vsmBlurMode = BLUR_GAUSSIAN;\n\t\tthis.vsmBias = 0.01 * 0.25;\n\t\tthis._cookie = null;\n\t\tthis.cookieIntensity = 1;\n\t\tthis._cookieFalloff = true;\n\t\tthis._cookieChannel = 'rgb';\n\t\tthis._cookieTransform = null;\n\t\tthis._cookieTransformUniform = new Float32Array(4);\n\t\tthis._cookieOffset = null;\n\t\tthis._cookieOffsetUniform = new Float32Array(2);\n\t\tthis._cookieTransformSet = false;\n\t\tthis._cookieOffsetSet = false;\n\t\tthis._innerConeAngle = 40;\n\t\tthis._outerConeAngle = 45;\n\t\tthis.cascades = null;\n\t\tthis._shadowMatrixPalette = null;\n\t\tthis._shadowCascadeDistances = null;\n\t\tthis.numCascades = 1;\n\t\tthis.cascadeDistribution = 0.5;\n\t\tthis._shape = LIGHTSHAPE_PUNCTUAL;\n\t\tthis._finalColor = new Float32Array([0.8, 0.8, 0.8]);\n\t\tconst c = Math.pow(this._finalColor[0], 2.2);\n\t\tthis._linearFinalColor = new Float32Array([c, c, c]);\n\t\tthis._position = new Vec3(0, 0, 0);\n\t\tthis._direction = new Vec3(0, 0, 0);\n\t\tthis._innerConeAngleCos = Math.cos(this._innerConeAngle * Math.PI / 180);\n\t\tthis._updateOuterAngle(this._outerConeAngle);\n\t\tthis._usePhysicalUnits = undefined;\n\t\tthis._shadowMap = null;\n\t\tthis._shadowRenderParams = [];\n\t\tthis._shadowCameraParams = [];\n\t\tthis.shadowDistance = 40;\n\t\tthis._shadowResolution = 1024;\n\t\tthis.shadowBias = -0.0005;\n\t\tthis.shadowIntensity = 1.0;\n\t\tthis._normalOffsetBias = 0.0;\n\t\tthis.shadowUpdateMode = SHADOWUPDATE_REALTIME;\n\t\tthis.shadowUpdateOverrides = null;\n\t\tthis._penumbraSize = 1.0;\n\t\tthis._isVsm = false;\n\t\tthis._isPcf = true;\n\t\tthis._cookieMatrix = null;\n\t\tthis._atlasViewport = null;\n\t\tthis.atlasViewportAllocated = false;\n\t\tthis.atlasVersion = 0;\n\t\tthis.atlasSlotIndex = 0;\n\t\tthis.atlasSlotUpdated = false;\n\t\tthis._node = null;\n\t\tthis._renderData = [];\n\t\tthis.visibleThisFrame = false;\n\t\tthis.maxScreenSize = 0;\n\t}\n\tdestroy() {\n\t\tthis._destroyShadowMap();\n\t\tthis.releaseRenderData();\n\t\tthis._renderData = null;\n\t}\n\treleaseRenderData() {\n\t\tif (this._renderData) {\n\t\t\tfor (let i = 0; i < this._renderData.length; i++) {\n\t\t\t\tthis._renderData[i].destroy();\n\t\t\t}\n\t\t\tthis._renderData.length = 0;\n\t\t}\n\t}\n\taddLayer(layer) {\n\t\tthis.layers.add(layer);\n\t}\n\tremoveLayer(layer) {\n\t\tthis.layers.delete(layer);\n\t}\n\tset numCascades(value) {\n\t\tif (!this.cascades || this.numCascades !== value) {\n\t\t\tthis.cascades = directionalCascades[value - 1];\n\t\t\tthis._shadowMatrixPalette = new Float32Array(4 * 16);\n\t\t\tthis._shadowCascadeDistances = new Float32Array(4);\n\t\t\tthis._destroyShadowMap();\n\t\t\tthis.updateKey();\n\t\t}\n\t}\n\tget numCascades() {\n\t\treturn this.cascades.length;\n\t}\n\tset shadowMap(shadowMap) {\n\t\tif (this._shadowMap !== shadowMap) {\n\t\t\tthis._destroyShadowMap();\n\t\t\tthis._shadowMap = shadowMap;\n\t\t}\n\t}\n\tget shadowMap() {\n\t\treturn this._shadowMap;\n\t}\n\tset mask(value) {\n\t\tif (this._mask !== value) {\n\t\t\tthis._mask = value;\n\t\t\tthis.updateKey();\n\t\t}\n\t}\n\tget mask() {\n\t\treturn this._mask;\n\t}\n\tget numShadowFaces() {\n\t\tconst type = this._type;\n\t\tif (type === LIGHTTYPE_DIRECTIONAL) {\n\t\t\treturn this.numCascades;\n\t\t} else if (type === LIGHTTYPE_OMNI) {\n\t\t\treturn 6;\n\t\t}\n\t\treturn 1;\n\t}\n\tset type(value) {\n\t\tif (this._type === value) return;\n\t\tthis._type = value;\n\t\tthis._destroyShadowMap();\n\t\tthis.updateKey();\n\t\tconst stype = this._shadowType;\n\t\tthis._shadowType = null;\n\t\tthis.shadowUpdateOverrides = null;\n\t\tthis.shadowType = stype;\n\t}\n\tget type() {\n\t\treturn this._type;\n\t}\n\tset shape(value) {\n\t\tif (this._shape === value) return;\n\t\tthis._shape = value;\n\t\tthis._destroyShadowMap();\n\t\tthis.updateKey();\n\t\tconst stype = this._shadowType;\n\t\tthis._shadowType = null;\n\t\tthis.shadowType = stype;\n\t}\n\tget shape() {\n\t\treturn this._shape;\n\t}\n\tset usePhysicalUnits(value) {\n\t\tif (this._usePhysicalUnits !== value) {\n\t\t\tthis._usePhysicalUnits = value;\n\t\t\tthis._updateFinalColor();\n\t\t}\n\t}\n\tget usePhysicalUnits() {\n\t\treturn this._usePhysicalUnits;\n\t}\n\tset shadowType(value) {\n\t\tif (this._shadowType === value) return;\n\t\tconst device = this.device;\n\t\tif (this._type === LIGHTTYPE_OMNI && value !== SHADOW_PCF3 && value !== SHADOW_PCSS) value = SHADOW_PCF3;\n\t\tconst supportsDepthShadow = device.supportsDepthShadow;\n\t\tif (value === SHADOW_PCF5 && !supportsDepthShadow) {\n\t\t\tvalue = SHADOW_PCF3;\n\t\t}\n\t\tif (value === SHADOW_VSM32 && (!device.textureFloatRenderable || !device.textureFloatFilterable)) value = SHADOW_VSM16;\n\t\tif (value === SHADOW_VSM16 && !device.textureHalfFloatRenderable) value = SHADOW_VSM8;\n\t\tthis._isVsm = value >= SHADOW_VSM8 && value <= SHADOW_VSM32;\n\t\tthis._isPcf = value === SHADOW_PCF1 || value === SHADOW_PCF3 || value === SHADOW_PCF5;\n\t\tthis._shadowType = value;\n\t\tthis._destroyShadowMap();\n\t\tthis.updateKey();\n\t}\n\tget shadowType() {\n\t\treturn this._shadowType;\n\t}\n\tset enabled(value) {\n\t\tif (this._enabled !== value) {\n\t\t\tthis._enabled = value;\n\t\t\tthis.layersDirty();\n\t\t}\n\t}\n\tget enabled() {\n\t\treturn this._enabled;\n\t}\n\tset castShadows(value) {\n\t\tif (this._castShadows !== value) {\n\t\t\tthis._castShadows = value;\n\t\t\tthis._destroyShadowMap();\n\t\t\tthis.layersDirty();\n\t\t\tthis.updateKey();\n\t\t}\n\t}\n\tget castShadows() {\n\t\treturn this._castShadows && this._mask !== MASK_BAKE && this._mask !== 0;\n\t}\n\tset shadowResolution(value) {\n\t\tif (this._shadowResolution !== value) {\n\t\t\tif (this._type === LIGHTTYPE_OMNI) {\n\t\t\t\tvalue = Math.min(value, this.device.maxCubeMapSize);\n\t\t\t} else {\n\t\t\t\tvalue = Math.min(value, this.device.maxTextureSize);\n\t\t\t}\n\t\t\tthis._shadowResolution = value;\n\t\t\tthis._destroyShadowMap();\n\t\t}\n\t}\n\tget shadowResolution() {\n\t\treturn this._shadowResolution;\n\t}\n\tset vsmBlurSize(value) {\n\t\tif (this._vsmBlurSize === value) return;\n\t\tif (value % 2 === 0) value++;\n\t\tthis._vsmBlurSize = value;\n\t}\n\tget vsmBlurSize() {\n\t\treturn this._vsmBlurSize;\n\t}\n\tset normalOffsetBias(value) {\n\t\tif (this._normalOffsetBias === value) return;\n\t\tif (!this._normalOffsetBias && value || this._normalOffsetBias && !value) {\n\t\t\tthis.updateKey();\n\t\t}\n\t\tthis._normalOffsetBias = value;\n\t}\n\tget normalOffsetBias() {\n\t\treturn this._normalOffsetBias;\n\t}\n\tset falloffMode(value) {\n\t\tif (this._falloffMode === value) return;\n\t\tthis._falloffMode = value;\n\t\tthis.updateKey();\n\t}\n\tget falloffMode() {\n\t\treturn this._falloffMode;\n\t}\n\tset innerConeAngle(value) {\n\t\tif (this._innerConeAngle === value) return;\n\t\tthis._innerConeAngle = value;\n\t\tthis._innerConeAngleCos = Math.cos(value * Math.PI / 180);\n\t\tif (this._usePhysicalUnits) {\n\t\t\tthis._updateFinalColor();\n\t\t}\n\t}\n\tget innerConeAngle() {\n\t\treturn this._innerConeAngle;\n\t}\n\tset outerConeAngle(value) {\n\t\tif (this._outerConeAngle === value) return;\n\t\tthis._outerConeAngle = value;\n\t\tthis._updateOuterAngle(value);\n\t\tif (this._usePhysicalUnits) {\n\t\t\tthis._updateFinalColor();\n\t\t}\n\t}\n\tget outerConeAngle() {\n\t\treturn this._outerConeAngle;\n\t}\n\tset penumbraSize(value) {\n\t\tthis._penumbraSize = value;\n\t}\n\tget penumbraSize() {\n\t\treturn this._penumbraSize;\n\t}\n\t_updateOuterAngle(angle) {\n\t\tconst radAngle = angle * Math.PI / 180;\n\t\tthis._outerConeAngleCos = Math.cos(radAngle);\n\t\tthis._outerConeAngleSin = Math.sin(radAngle);\n\t}\n\tset intensity(value) {\n\t\tif (this._intensity !== value) {\n\t\t\tthis._intensity = value;\n\t\t\tthis._updateFinalColor();\n\t\t}\n\t}\n\tget intensity() {\n\t\treturn this._intensity;\n\t}\n\tset affectSpecularity(value) {\n\t\tif (this._type === LIGHTTYPE_DIRECTIONAL) {\n\t\t\tthis._affectSpecularity = value;\n\t\t\tthis.updateKey();\n\t\t}\n\t}\n\tget affectSpecularity() {\n\t\treturn this._affectSpecularity;\n\t}\n\tset luminance(value) {\n\t\tif (this._luminance !== value) {\n\t\t\tthis._luminance = value;\n\t\t\tthis._updateFinalColor();\n\t\t}\n\t}\n\tget luminance() {\n\t\treturn this._luminance;\n\t}\n\tget cookieMatrix() {\n\t\tif (!this._cookieMatrix) {\n\t\t\tthis._cookieMatrix = new Mat4();\n\t\t}\n\t\treturn this._cookieMatrix;\n\t}\n\tget atlasViewport() {\n\t\tif (!this._atlasViewport) {\n\t\t\tthis._atlasViewport = new Vec4(0, 0, 1, 1);\n\t\t}\n\t\treturn this._atlasViewport;\n\t}\n\tset cookie(value) {\n\t\tif (this._cookie === value) return;\n\t\tthis._cookie = value;\n\t\tthis.updateKey();\n\t}\n\tget cookie() {\n\t\treturn this._cookie;\n\t}\n\tset cookieFalloff(value) {\n\t\tif (this._cookieFalloff === value) return;\n\t\tthis._cookieFalloff = value;\n\t\tthis.updateKey();\n\t}\n\tget cookieFalloff() {\n\t\treturn this._cookieFalloff;\n\t}\n\tset cookieChannel(value) {\n\t\tif (this._cookieChannel === value) return;\n\t\tif (value.length < 3) {\n\t\t\tconst chr = value.charAt(value.length - 1);\n\t\t\tconst addLen = 3 - value.length;\n\t\t\tfor (let i = 0; i < addLen; i++) value += chr;\n\t\t}\n\t\tthis._cookieChannel = value;\n\t\tthis.updateKey();\n\t}\n\tget cookieChannel() {\n\t\treturn this._cookieChannel;\n\t}\n\tset cookieTransform(value) {\n\t\tif (this._cookieTransform === value) return;\n\t\tthis._cookieTransform = value;\n\t\tthis._cookieTransformSet = !!value;\n\t\tif (value && !this._cookieOffset) {\n\t\t\tthis.cookieOffset = new Vec2();\n\t\t\tthis._cookieOffsetSet = false;\n\t\t}\n\t\tthis.updateKey();\n\t}\n\tget cookieTransform() {\n\t\treturn this._cookieTransform;\n\t}\n\tset cookieOffset(value) {\n\t\tif (this._cookieOffset === value) return;\n\t\tconst xformNew = !!(this._cookieTransformSet || value);\n\t\tif (xformNew && !value && this._cookieOffset) {\n\t\t\tthis._cookieOffset.set(0, 0);\n\t\t} else {\n\t\t\tthis._cookieOffset = value;\n\t\t}\n\t\tthis._cookieOffsetSet = !!value;\n\t\tif (value && !this._cookieTransform) {\n\t\t\tthis.cookieTransform = new Vec4(1, 1, 0, 0);\n\t\t\tthis._cookieTransformSet = false;\n\t\t}\n\t\tthis.updateKey();\n\t}\n\tget cookieOffset() {\n\t\treturn this._cookieOffset;\n\t}\n\tbeginFrame() {\n\t\tthis.visibleThisFrame = this._type === LIGHTTYPE_DIRECTIONAL && this._enabled;\n\t\tthis.maxScreenSize = 0;\n\t\tthis.atlasViewportAllocated = false;\n\t\tthis.atlasSlotUpdated = false;\n\t}\n\t_destroyShadowMap() {\n\t\tthis.releaseRenderData();\n\t\tif (this._shadowMap) {\n\t\t\tif (!this._shadowMap.cached) {\n\t\t\t\tthis._shadowMap.destroy();\n\t\t\t}\n\t\t\tthis._shadowMap = null;\n\t\t}\n\t\tif (this.shadowUpdateMode === SHADOWUPDATE_NONE) {\n\t\t\tthis.shadowUpdateMode = SHADOWUPDATE_THISFRAME;\n\t\t}\n\t\tif (this.shadowUpdateOverrides) {\n\t\t\tfor (let i = 0; i < this.shadowUpdateOverrides.length; i++) {\n\t\t\t\tif (this.shadowUpdateOverrides[i] === SHADOWUPDATE_NONE) {\n\t\t\t\t\tthis.shadowUpdateOverrides[i] = SHADOWUPDATE_THISFRAME;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tgetRenderData(camera, face) {\n\t\tfor (let i = 0; i < this._renderData.length; i++) {\n\t\t\tconst current = this._renderData[i];\n\t\t\tif (current.camera === camera && current.face === face) {\n\t\t\t\treturn current;\n\t\t\t}\n\t\t}\n\t\tconst rd = new LightRenderData(this.device, camera, face, this);\n\t\tthis._renderData.push(rd);\n\t\treturn rd;\n\t}\n\tclone() {\n\t\tconst clone = new Light(this.device);\n\t\tclone.type = this._type;\n\t\tclone.setColor(this._color);\n\t\tclone.intensity = this._intensity;\n\t\tclone.affectSpecularity = this._affectSpecularity;\n\t\tclone.luminance = this._luminance;\n\t\tclone.castShadows = this.castShadows;\n\t\tclone._enabled = this._enabled;\n\t\tclone.attenuationStart = this.attenuationStart;\n\t\tclone.attenuationEnd = this.attenuationEnd;\n\t\tclone.falloffMode = this._falloffMode;\n\t\tclone.shadowType = this._shadowType;\n\t\tclone.vsmBlurSize = this._vsmBlurSize;\n\t\tclone.vsmBlurMode = this.vsmBlurMode;\n\t\tclone.vsmBias = this.vsmBias;\n\t\tclone.penumbraSize = this.penumbraSize;\n\t\tclone.shadowUpdateMode = this.shadowUpdateMode;\n\t\tclone.mask = this.mask;\n\t\tif (this.shadowUpdateOverrides) {\n\t\t\tclone.shadowUpdateOverrides = this.shadowUpdateOverrides.slice();\n\t\t}\n\t\tclone.innerConeAngle = this._innerConeAngle;\n\t\tclone.outerConeAngle = this._outerConeAngle;\n\t\tclone.numCascades = this.numCascades;\n\t\tclone.cascadeDistribution = this.cascadeDistribution;\n\t\tclone.shape = this._shape;\n\t\tclone.shadowBias = this.shadowBias;\n\t\tclone.normalOffsetBias = this._normalOffsetBias;\n\t\tclone.shadowResolution = this._shadowResolution;\n\t\tclone.shadowDistance = this.shadowDistance;\n\t\tclone.shadowIntensity = this.shadowIntensity;\n\t\treturn clone;\n\t}\n\tstatic getLightUnitConversion(type, outerAngle = Math.PI / 4, innerAngle = 0) {\n\t\tswitch (type) {\n\t\t\tcase LIGHTTYPE_SPOT:\n\t\t\t\t{\n\t\t\t\t\tconst falloffEnd = Math.cos(outerAngle);\n\t\t\t\t\tconst falloffStart = Math.cos(innerAngle);\n\t\t\t\t\treturn 2 * Math.PI * (1 - falloffStart + (falloffStart - falloffEnd) / 2.0);\n\t\t\t\t}\n\t\t\tcase LIGHTTYPE_OMNI:\n\t\t\t\treturn 4 * Math.PI;\n\t\t\tcase LIGHTTYPE_DIRECTIONAL:\n\t\t\t\treturn 1;\n\t\t}\n\t}\n\t_getUniformBiasValues(lightRenderData) {\n\t\tconst farClip = lightRenderData.shadowCamera._farClip;\n\t\tswitch (this._type) {\n\t\t\tcase LIGHTTYPE_OMNI:\n\t\t\t\ttmpBiases.bias = this.shadowBias;\n\t\t\t\ttmpBiases.normalBias = this._normalOffsetBias;\n\t\t\t\tbreak;\n\t\t\tcase LIGHTTYPE_SPOT:\n\t\t\t\tif (this._isVsm) {\n\t\t\t\t\ttmpBiases.bias = -0.00001 * 20;\n\t\t\t\t} else {\n\t\t\t\t\ttmpBiases.bias = this.shadowBias * 20;\n\t\t\t\t\tif (this.device.isWebGL1 && this.device.extStandardDerivatives) tmpBiases.bias *= -100;\n\t\t\t\t}\n\t\t\t\ttmpBiases.normalBias = this._isVsm ? this.vsmBias / (this.attenuationEnd / 7.0) : this._normalOffsetBias;\n\t\t\t\tbreak;\n\t\t\tcase LIGHTTYPE_DIRECTIONAL:\n\t\t\t\tif (this._isVsm) {\n\t\t\t\t\ttmpBiases.bias = -0.00001 * 20;\n\t\t\t\t} else {\n\t\t\t\t\ttmpBiases.bias = this.shadowBias / farClip * 100;\n\t\t\t\t\tif (this.device.isWebGL1 && this.device.extStandardDerivatives) tmpBiases.bias *= -100;\n\t\t\t\t}\n\t\t\t\ttmpBiases.normalBias = this._isVsm ? this.vsmBias / (farClip / 7.0) : this._normalOffsetBias;\n\t\t\t\tbreak;\n\t\t}\n\t\treturn tmpBiases;\n\t}\n\tgetColor() {\n\t\treturn this._color;\n\t}\n\tgetBoundingSphere(sphere) {\n\t\tif (this._type === LIGHTTYPE_SPOT) {\n\t\t\tconst size = this.attenuationEnd;\n\t\t\tconst angle = this._outerConeAngle;\n\t\t\tconst cosAngle = this._outerConeAngleCos;\n\t\t\tconst node = this._node;\n\t\t\ttmpVec.copy(node.up);\n\t\t\tif (angle > 45) {\n\t\t\t\tsphere.radius = size * this._outerConeAngleSin;\n\t\t\t\ttmpVec.mulScalar(-size * cosAngle);\n\t\t\t} else {\n\t\t\t\tsphere.radius = size / (2 * cosAngle);\n\t\t\t\ttmpVec.mulScalar(-sphere.radius);\n\t\t\t}\n\t\t\tsphere.center.add2(node.getPosition(), tmpVec);\n\t\t} else if (this._type === LIGHTTYPE_OMNI) {\n\t\t\tsphere.center = this._node.getPosition();\n\t\t\tsphere.radius = this.attenuationEnd;\n\t\t}\n\t}\n\tgetBoundingBox(box) {\n\t\tif (this._type === LIGHTTYPE_SPOT) {\n\t\t\tconst range = this.attenuationEnd;\n\t\t\tconst angle = this._outerConeAngle;\n\t\t\tconst node = this._node;\n\t\t\tconst scl = Math.abs(Math.sin(angle * math.DEG_TO_RAD) * range);\n\t\t\tbox.center.set(0, -range * 0.5, 0);\n\t\t\tbox.halfExtents.set(scl, range * 0.5, scl);\n\t\t\tbox.setFromTransformedAabb(box, node.getWorldTransform(), true);\n\t\t} else if (this._type === LIGHTTYPE_OMNI) {\n\t\t\tbox.center.copy(this._node.getPosition());\n\t\t\tbox.halfExtents.set(this.attenuationEnd, this.attenuationEnd, this.attenuationEnd);\n\t\t}\n\t}\n\t_updateFinalColor() {\n\t\tconst color = this._color;\n\t\tconst r = color.r;\n\t\tconst g = color.g;\n\t\tconst b = color.b;\n\t\tlet i = this._intensity;\n\t\tif (this._usePhysicalUnits) {\n\t\t\ti = this._luminance / Light.getLightUnitConversion(this._type, this._outerConeAngle * math.DEG_TO_RAD, this._innerConeAngle * math.DEG_TO_RAD);\n\t\t}\n\t\tconst finalColor = this._finalColor;\n\t\tconst linearFinalColor = this._linearFinalColor;\n\t\tfinalColor[0] = r * i;\n\t\tfinalColor[1] = g * i;\n\t\tfinalColor[2] = b * i;\n\t\tif (i >= 1) {\n\t\t\tlinearFinalColor[0] = Math.pow(r, 2.2) * i;\n\t\t\tlinearFinalColor[1] = Math.pow(g, 2.2) * i;\n\t\t\tlinearFinalColor[2] = Math.pow(b, 2.2) * i;\n\t\t} else {\n\t\t\tlinearFinalColor[0] = Math.pow(finalColor[0], 2.2);\n\t\t\tlinearFinalColor[1] = Math.pow(finalColor[1], 2.2);\n\t\t\tlinearFinalColor[2] = Math.pow(finalColor[2], 2.2);\n\t\t}\n\t}\n\tsetColor() {\n\t\tif (arguments.length === 1) {\n\t\t\tthis._color.set(arguments[0].r, arguments[0].g, arguments[0].b);\n\t\t} else if (arguments.length === 3) {\n\t\t\tthis._color.set(arguments[0], arguments[1], arguments[2]);\n\t\t}\n\t\tthis._updateFinalColor();\n\t}\n\tlayersDirty() {\n\t\tthis.layers.forEach(layer => {\n\t\t\tlayer.markLightsDirty();\n\t\t});\n\t}\n\tupdateKey() {\n\t\tlet key = this._type << 29 | (this._castShadows ? 1 : 0) << 28 | this._shadowType << 25 | this._falloffMode << 23 | (this._normalOffsetBias !== 0.0 ? 1 : 0) << 22 | (this._cookie ? 1 : 0) << 21 | (this._cookieFalloff ? 1 : 0) << 20 | chanId[this._cookieChannel.charAt(0)] << 18 | (this._cookieTransform ? 1 : 0) << 12 | this._shape << 10 | this.numCascades - 1 << 8 | (this.affectSpecularity ? 1 : 0) << 7 | this.mask << 6;\n\t\tif (this._cookieChannel.length === 3) {\n\t\t\tkey |= chanId[this._cookieChannel.charAt(1)] << 16;\n\t\t\tkey |= chanId[this._cookieChannel.charAt(2)] << 14;\n\t\t}\n\t\tif (key !== this.key) {\n\t\t\tthis.layersDirty();\n\t\t}\n\t\tthis.key = key;\n\t}\n}\n\nexport { Light, lightTypes };\n","import { math } from '../../core/math/math.js';\nimport { Vec3 } from '../../core/math/vec3.js';\nimport { SHADOW_PCF3 } from '../constants.js';\n\nclass LightingParams {\n\tconstructor(supportsAreaLights, maxTextureSize, dirtyLightsFnc) {\n\t\tthis._areaLightsEnabled = false;\n\t\tthis._cells = new Vec3(10, 3, 10);\n\t\tthis._maxLightsPerCell = 255;\n\t\tthis._shadowsEnabled = true;\n\t\tthis._shadowType = SHADOW_PCF3;\n\t\tthis._shadowAtlasResolution = 2048;\n\t\tthis._cookiesEnabled = false;\n\t\tthis._cookieAtlasResolution = 2048;\n\t\tthis.debugLayer = void 0;\n\t\tthis.atlasSplit = null;\n\t\tthis._supportsAreaLights = supportsAreaLights;\n\t\tthis._maxTextureSize = maxTextureSize;\n\t\tthis._dirtyLightsFnc = dirtyLightsFnc;\n\t}\n\tapplySettings(render) {\n\t\tvar _render$lightingShado, _render$lightingCooki, _render$lightingAreaL, _render$lightingShado2, _render$lightingCooki2, _render$lightingMaxLi, _render$lightingShado3;\n\t\tthis.shadowsEnabled = (_render$lightingShado = render.lightingShadowsEnabled) != null ? _render$lightingShado : this.shadowsEnabled;\n\t\tthis.cookiesEnabled = (_render$lightingCooki = render.lightingCookiesEnabled) != null ? _render$lightingCooki : this.cookiesEnabled;\n\t\tthis.areaLightsEnabled = (_render$lightingAreaL = render.lightingAreaLightsEnabled) != null ? _render$lightingAreaL : this.areaLightsEnabled;\n\t\tthis.shadowAtlasResolution = (_render$lightingShado2 = render.lightingShadowAtlasResolution) != null ? _render$lightingShado2 : this.shadowAtlasResolution;\n\t\tthis.cookieAtlasResolution = (_render$lightingCooki2 = render.lightingCookieAtlasResolution) != null ? _render$lightingCooki2 : this.cookieAtlasResolution;\n\t\tthis.maxLightsPerCell = (_render$lightingMaxLi = render.lightingMaxLightsPerCell) != null ? _render$lightingMaxLi : this.maxLightsPerCell;\n\t\tthis.shadowType = (_render$lightingShado3 = render.lightingShadowType) != null ? _render$lightingShado3 : this.shadowType;\n\t\tif (render.lightingCells) this.cell = new Vec3(render.lightingCells);\n\t}\n\tset cells(value) {\n\t\tthis._cells.copy(value);\n\t}\n\tget cells() {\n\t\treturn this._cells;\n\t}\n\tset maxLightsPerCell(value) {\n\t\tthis._maxLightsPerCell = math.clamp(value, 1, 255);\n\t}\n\tget maxLightsPerCell() {\n\t\treturn this._maxLightsPerCell;\n\t}\n\tset cookieAtlasResolution(value) {\n\t\tthis._cookieAtlasResolution = math.clamp(value, 32, this._maxTextureSize);\n\t}\n\tget cookieAtlasResolution() {\n\t\treturn this._cookieAtlasResolution;\n\t}\n\tset shadowAtlasResolution(value) {\n\t\tthis._shadowAtlasResolution = math.clamp(value, 32, this._maxTextureSize);\n\t}\n\tget shadowAtlasResolution() {\n\t\treturn this._shadowAtlasResolution;\n\t}\n\tset shadowType(value) {\n\t\tif (this._shadowType !== value) {\n\t\t\tthis._shadowType = value;\n\t\t\tthis._dirtyLightsFnc();\n\t\t}\n\t}\n\tget shadowType() {\n\t\treturn this._shadowType;\n\t}\n\tset cookiesEnabled(value) {\n\t\tif (this._cookiesEnabled !== value) {\n\t\t\tthis._cookiesEnabled = value;\n\t\t\tthis._dirtyLightsFnc();\n\t\t}\n\t}\n\tget cookiesEnabled() {\n\t\treturn this._cookiesEnabled;\n\t}\n\tset areaLightsEnabled(value) {\n\t\tif (this._supportsAreaLights) {\n\t\t\tif (this._areaLightsEnabled !== value) {\n\t\t\t\tthis._areaLightsEnabled = value;\n\t\t\t\tthis._dirtyLightsFnc();\n\t\t\t}\n\t\t}\n\t}\n\tget areaLightsEnabled() {\n\t\treturn this._areaLightsEnabled;\n\t}\n\tset shadowsEnabled(value) {\n\t\tif (this._shadowsEnabled !== value) {\n\t\t\tthis._shadowsEnabled = value;\n\t\t\tthis._dirtyLightsFnc();\n\t\t}\n\t}\n\tget shadowsEnabled() {\n\t\treturn this._shadowsEnabled;\n\t}\n}\n\nexport { LightingParams };\n","import '../core/tracing.js';\nimport { BLENDEQUATION_ADD, BLENDMODE_ONE } from '../platform/graphics/constants.js';\nimport { drawQuadWithShader } from './graphics/quad-render-utils.js';\nimport { RenderTarget } from '../platform/graphics/render-target.js';\nimport { createShaderFromCode } from './shader-lib/utils.js';\nimport { BlendState } from '../platform/graphics/blend-state.js';\n\nconst textureMorphVertexShader = `\n\tattribute vec2 vertex_position;\n\tvarying vec2 uv0;\n\tvoid main(void) {\n\t\tgl_Position = vec4(vertex_position, 0.5, 1.0);\n\t\tuv0 = vertex_position.xy * 0.5 + 0.5;\n\t}\n\t`;\nconst blendStateAdditive = new BlendState(true, BLENDEQUATION_ADD, BLENDMODE_ONE, BLENDMODE_ONE);\nclass MorphInstance {\n\tconstructor(morph) {\n\t\tthis.morph = morph;\n\t\tmorph.incRefCount();\n\t\tthis.device = morph.device;\n\t\tthis._weights = [];\n\t\tthis._weightMap = new Map();\n\t\tfor (let v = 0; v < morph._targets.length; v++) {\n\t\t\tconst target = morph._targets[v];\n\t\t\tif (target.name) {\n\t\t\t\tthis._weightMap.set(target.name, v);\n\t\t\t}\n\t\t\tthis.setWeight(v, target.defaultWeight);\n\t\t}\n\t\tthis._activeTargets = [];\n\t\tif (morph.useTextureMorph) {\n\t\t\tthis.shaderCache = {};\n\t\t\tthis.maxSubmitCount = this.device.maxTextures;\n\t\t\tthis._shaderMorphWeights = new Float32Array(this.maxSubmitCount);\n\t\t\tconst createRT = (name, textureVar) => {\n\t\t\t\tthis[textureVar] = morph._createTexture(name, morph._renderTextureFormat);\n\t\t\t\treturn new RenderTarget({\n\t\t\t\t\tcolorBuffer: this[textureVar],\n\t\t\t\t\tdepth: false\n\t\t\t\t});\n\t\t\t};\n\t\t\tif (morph.morphPositions) {\n\t\t\t\tthis.rtPositions = createRT('MorphRTPos', 'texturePositions');\n\t\t\t}\n\t\t\tif (morph.morphNormals) {\n\t\t\t\tthis.rtNormals = createRT('MorphRTNrm', 'textureNormals');\n\t\t\t}\n\t\t\tthis._textureParams = new Float32Array([morph.morphTextureWidth, morph.morphTextureHeight, 1 / morph.morphTextureWidth, 1 / morph.morphTextureHeight]);\n\t\t\tfor (let i = 0; i < this.maxSubmitCount; i++) {\n\t\t\t\tthis['morphBlendTex' + i] = this.device.scope.resolve('morphBlendTex' + i);\n\t\t\t}\n\t\t\tthis.morphFactor = this.device.scope.resolve('morphFactor[0]');\n\t\t\tthis.zeroTextures = false;\n\t\t} else {\n\t\t\tthis.maxSubmitCount = 8;\n\t\t\tthis._shaderMorphWeights = new Float32Array(this.maxSubmitCount);\n\t\t\tthis._shaderMorphWeightsA = new Float32Array(this._shaderMorphWeights.buffer, 0, 4);\n\t\t\tthis._shaderMorphWeightsB = new Float32Array(this._shaderMorphWeights.buffer, 4 * 4, 4);\n\t\t\tthis._activeVertexBuffers = new Array(this.maxSubmitCount);\n\t\t}\n\t}\n\tdestroy() {\n\t\tthis.shader = null;\n\t\tconst morph = this.morph;\n\t\tif (morph) {\n\t\t\tthis.morph = null;\n\t\t\tmorph.decRefCount();\n\t\t\tif (morph.refCount < 1) {\n\t\t\t\tmorph.destroy();\n\t\t\t}\n\t\t}\n\t\tif (this.rtPositions) {\n\t\t\tthis.rtPositions.destroy();\n\t\t\tthis.rtPositions = null;\n\t\t}\n\t\tif (this.texturePositions) {\n\t\t\tthis.texturePositions.destroy();\n\t\t\tthis.texturePositions = null;\n\t\t}\n\t\tif (this.rtNormals) {\n\t\t\tthis.rtNormals.destroy();\n\t\t\tthis.rtNormals = null;\n\t\t}\n\t\tif (this.textureNormals) {\n\t\t\tthis.textureNormals.destroy();\n\t\t\tthis.textureNormals = null;\n\t\t}\n\t}\n\tclone() {\n\t\treturn new MorphInstance(this.morph);\n\t}\n\t_getWeightIndex(key) {\n\t\tif (typeof key === 'string') {\n\t\t\tconst index = this._weightMap.get(key);\n\t\t\treturn index;\n\t\t}\n\t\treturn key;\n\t}\n\tgetWeight(key) {\n\t\tconst index = this._getWeightIndex(key);\n\t\treturn this._weights[index];\n\t}\n\tsetWeight(key, weight) {\n\t\tconst index = this._getWeightIndex(key);\n\t\tthis._weights[index] = weight;\n\t\tthis._dirty = true;\n\t}\n\t_getFragmentShader(numTextures) {\n\t\tlet fragmentShader = '';\n\t\tif (numTextures > 0) {\n\t\t\tfragmentShader += 'varying vec2 uv0;\\n' + 'uniform highp float morphFactor[' + numTextures + '];\\n';\n\t\t}\n\t\tfor (let i = 0; i < numTextures; i++) {\n\t\t\tfragmentShader += 'uniform highp sampler2D morphBlendTex' + i + ';\\n';\n\t\t}\n\t\tfragmentShader += 'void main (void) {\\n' + '    highp vec4 color = vec4(0, 0, 0, 1);\\n';\n\t\tfor (let i = 0; i < numTextures; i++) {\n\t\t\tfragmentShader += '    color.xyz += morphFactor[' + i + '] * texture2D(morphBlendTex' + i + ', uv0).xyz;\\n';\n\t\t}\n\t\tfragmentShader += '    gl_FragColor = color;\\n' + '}\\n';\n\t\treturn fragmentShader;\n\t}\n\t_getShader(count) {\n\t\tlet shader = this.shaderCache[count];\n\t\tif (!shader) {\n\t\t\tconst fs = this._getFragmentShader(count);\n\t\t\tshader = createShaderFromCode(this.device, textureMorphVertexShader, fs, 'textureMorph' + count);\n\t\t\tthis.shaderCache[count] = shader;\n\t\t}\n\t\treturn shader;\n\t}\n\t_updateTextureRenderTarget(renderTarget, srcTextureName) {\n\t\tconst device = this.device;\n\t\tconst submitBatch = (usedCount, blending) => {\n\t\t\tthis.morphFactor.setValue(this._shaderMorphWeights);\n\t\t\tdevice.setBlendState(blending ? blendStateAdditive : BlendState.NOBLEND);\n\t\t\tconst shader = this._getShader(usedCount);\n\t\t\tdrawQuadWithShader(device, renderTarget, shader);\n\t\t};\n\t\tlet usedCount = 0;\n\t\tlet blending = false;\n\t\tconst count = this._activeTargets.length;\n\t\tfor (let i = 0; i < count; i++) {\n\t\t\tconst activeTarget = this._activeTargets[i];\n\t\t\tconst tex = activeTarget.target[srcTextureName];\n\t\t\tif (tex) {\n\t\t\t\tthis['morphBlendTex' + usedCount].setValue(tex);\n\t\t\t\tthis._shaderMorphWeights[usedCount] = activeTarget.weight;\n\t\t\t\tusedCount++;\n\t\t\t\tif (usedCount >= this.maxSubmitCount) {\n\t\t\t\t\tsubmitBatch(usedCount, blending);\n\t\t\t\t\tusedCount = 0;\n\t\t\t\t\tblending = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (usedCount > 0 || count === 0 && !this.zeroTextures) {\n\t\t\tsubmitBatch(usedCount, blending);\n\t\t}\n\t}\n\t_updateTextureMorph() {\n\t\tthis.device;\n\t\tif (this._activeTargets.length > 0 || !this.zeroTextures) {\n\t\t\tif (this.rtPositions) this._updateTextureRenderTarget(this.rtPositions, 'texturePositions');\n\t\t\tif (this.rtNormals) this._updateTextureRenderTarget(this.rtNormals, 'textureNormals');\n\t\t\tthis.zeroTextures = this._activeTargets.length === 0;\n\t\t}\n\t}\n\t_updateVertexMorph() {\n\t\tconst count = this.maxSubmitCount;\n\t\tfor (let i = 0; i < count; i++) {\n\t\t\tthis._shaderMorphWeights[i] = 0;\n\t\t\tthis._activeVertexBuffers[i] = null;\n\t\t}\n\t\tlet posIndex = 0;\n\t\tlet nrmIndex = this.morph.morphPositions ? 4 : 0;\n\t\tfor (let i = 0; i < this._activeTargets.length; i++) {\n\t\t\tconst target = this._activeTargets[i].target;\n\t\t\tif (target._vertexBufferPositions) {\n\t\t\t\tthis._activeVertexBuffers[posIndex] = target._vertexBufferPositions;\n\t\t\t\tthis._shaderMorphWeights[posIndex] = this._activeTargets[i].weight;\n\t\t\t\tposIndex++;\n\t\t\t}\n\t\t\tif (target._vertexBufferNormals) {\n\t\t\t\tthis._activeVertexBuffers[nrmIndex] = target._vertexBufferNormals;\n\t\t\t\tthis._shaderMorphWeights[nrmIndex] = this._activeTargets[i].weight;\n\t\t\t\tnrmIndex++;\n\t\t\t}\n\t\t}\n\t}\n\tupdate() {\n\t\tthis._dirty = false;\n\t\tconst targets = this.morph._targets;\n\t\tlet activeCount = 0;\n\t\tconst epsilon = 0.00001;\n\t\tfor (let i = 0; i < targets.length; i++) {\n\t\t\tconst absWeight = Math.abs(this.getWeight(i));\n\t\t\tif (absWeight > epsilon) {\n\t\t\t\tif (this._activeTargets.length <= activeCount) {\n\t\t\t\t\tthis._activeTargets[activeCount] = {};\n\t\t\t\t}\n\t\t\t\tconst activeTarget = this._activeTargets[activeCount++];\n\t\t\t\tactiveTarget.absWeight = absWeight;\n\t\t\t\tactiveTarget.weight = this.getWeight(i);\n\t\t\t\tactiveTarget.target = targets[i];\n\t\t\t}\n\t\t}\n\t\tthis._activeTargets.length = activeCount;\n\t\tconst maxActiveTargets = this.morph.maxActiveTargets;\n\t\tif (this._activeTargets.length > maxActiveTargets) {\n\t\t\tthis._activeTargets.sort(function (l, r) {\n\t\t\t\treturn l.absWeight < r.absWeight ? 1 : r.absWeight < l.absWeight ? -1 : 0;\n\t\t\t});\n\t\t\tthis._activeTargets.length = maxActiveTargets;\n\t\t}\n\t\tif (this.morph.useTextureMorph) {\n\t\t\tthis._updateTextureMorph();\n\t\t} else {\n\t\t\tthis._updateVertexMorph();\n\t\t}\n\t}\n}\n\nexport { MorphInstance };\n","import { RENDERSTYLE_WIREFRAME } from './constants.js';\nimport { MeshInstance } from './mesh-instance.js';\nimport { MorphInstance } from './morph-instance.js';\nimport { SkinInstance } from './skin-instance.js';\n\nclass Model {\n\tconstructor() {\n\t\tthis.graph = null;\n\t\tthis.meshInstances = [];\n\t\tthis.skinInstances = [];\n\t\tthis.morphInstances = [];\n\t\tthis.cameras = [];\n\t\tthis.lights = [];\n\t\tthis._shadersVersion = 0;\n\t\tthis._immutable = false;\n\t}\n\tgetGraph() {\n\t\treturn this.graph;\n\t}\n\tsetGraph(graph) {\n\t\tthis.graph = graph;\n\t}\n\tgetCameras() {\n\t\treturn this.cameras;\n\t}\n\tsetCameras(cameras) {\n\t\tthis.cameras = cameras;\n\t}\n\tgetLights() {\n\t\treturn this.lights;\n\t}\n\tsetLights(lights) {\n\t\tthis.lights = lights;\n\t}\n\tgetMaterials() {\n\t\tconst materials = [];\n\t\tfor (let i = 0; i < this.meshInstances.length; i++) {\n\t\t\tconst meshInstance = this.meshInstances[i];\n\t\t\tif (materials.indexOf(meshInstance.material) === -1) {\n\t\t\t\tmaterials.push(meshInstance.material);\n\t\t\t}\n\t\t}\n\t\treturn materials;\n\t}\n\tclone() {\n\t\tconst srcNodes = [];\n\t\tconst cloneNodes = [];\n\t\tconst _duplicate = function _duplicate(node) {\n\t\t\tconst newNode = node.clone();\n\t\t\tsrcNodes.push(node);\n\t\t\tcloneNodes.push(newNode);\n\t\t\tfor (let idx = 0; idx < node._children.length; idx++) {\n\t\t\t\tnewNode.addChild(_duplicate(node._children[idx]));\n\t\t\t}\n\t\t\treturn newNode;\n\t\t};\n\t\tconst cloneGraph = _duplicate(this.graph);\n\t\tconst cloneMeshInstances = [];\n\t\tconst cloneSkinInstances = [];\n\t\tconst cloneMorphInstances = [];\n\t\tfor (let i = 0; i < this.skinInstances.length; i++) {\n\t\t\tconst skin = this.skinInstances[i].skin;\n\t\t\tconst cloneSkinInstance = new SkinInstance(skin);\n\t\t\tconst bones = [];\n\t\t\tfor (let j = 0; j < skin.boneNames.length; j++) {\n\t\t\t\tconst boneName = skin.boneNames[j];\n\t\t\t\tconst bone = cloneGraph.findByName(boneName);\n\t\t\t\tbones.push(bone);\n\t\t\t}\n\t\t\tcloneSkinInstance.bones = bones;\n\t\t\tcloneSkinInstances.push(cloneSkinInstance);\n\t\t}\n\t\tfor (let i = 0; i < this.morphInstances.length; i++) {\n\t\t\tconst morph = this.morphInstances[i].morph;\n\t\t\tconst cloneMorphInstance = new MorphInstance(morph);\n\t\t\tcloneMorphInstances.push(cloneMorphInstance);\n\t\t}\n\t\tfor (let i = 0; i < this.meshInstances.length; i++) {\n\t\t\tconst meshInstance = this.meshInstances[i];\n\t\t\tconst nodeIndex = srcNodes.indexOf(meshInstance.node);\n\t\t\tconst cloneMeshInstance = new MeshInstance(meshInstance.mesh, meshInstance.material, cloneNodes[nodeIndex]);\n\t\t\tif (meshInstance.skinInstance) {\n\t\t\t\tconst skinInstanceIndex = this.skinInstances.indexOf(meshInstance.skinInstance);\n\t\t\t\tcloneMeshInstance.skinInstance = cloneSkinInstances[skinInstanceIndex];\n\t\t\t}\n\t\t\tif (meshInstance.morphInstance) {\n\t\t\t\tconst morphInstanceIndex = this.morphInstances.indexOf(meshInstance.morphInstance);\n\t\t\t\tcloneMeshInstance.morphInstance = cloneMorphInstances[morphInstanceIndex];\n\t\t\t}\n\t\t\tcloneMeshInstances.push(cloneMeshInstance);\n\t\t}\n\t\tconst clone = new Model();\n\t\tclone.graph = cloneGraph;\n\t\tclone.meshInstances = cloneMeshInstances;\n\t\tclone.skinInstances = cloneSkinInstances;\n\t\tclone.morphInstances = cloneMorphInstances;\n\t\tclone.getGraph().syncHierarchy();\n\t\treturn clone;\n\t}\n\tdestroy() {\n\t\tconst meshInstances = this.meshInstances;\n\t\tfor (let i = 0; i < meshInstances.length; i++) {\n\t\t\tmeshInstances[i].destroy();\n\t\t}\n\t\tthis.meshInstances.length = 0;\n\t}\n\tgenerateWireframe() {\n\t\tMeshInstance._prepareRenderStyleForArray(this.meshInstances, RENDERSTYLE_WIREFRAME);\n\t}\n}\n\nexport { Model };\n","import '../core/tracing.js';\nimport { RefCountedObject } from '../core/ref-counted-object.js';\nimport { Vec3 } from '../core/math/vec3.js';\nimport { FloatPacking } from '../core/math/float-packing.js';\nimport { BoundingBox } from '../core/shape/bounding-box.js';\nimport { Texture } from '../platform/graphics/texture.js';\nimport { VertexBuffer } from '../platform/graphics/vertex-buffer.js';\nimport { VertexFormat } from '../platform/graphics/vertex-format.js';\nimport { PIXELFORMAT_RGBA16F, PIXELFORMAT_RGBA32F, PIXELFORMAT_RGB32F, BUFFER_STATIC, FILTER_NEAREST, ADDRESS_CLAMP_TO_EDGE, SEMANTIC_ATTR15, TYPE_UINT32, TYPE_FLOAT32 } from '../platform/graphics/constants.js';\nimport { GraphicsDeviceAccess } from '../platform/graphics/graphics-device-access.js';\n\nclass Morph extends RefCountedObject {\n\tconstructor(targets, graphicsDevice, {\n\t\tpreferHighPrecision = false\n\t} = {}) {\n\t\tsuper();\n\t\tthis._aabb = void 0;\n\t\tthis.preferHighPrecision = void 0;\n\t\tthis.device = graphicsDevice || GraphicsDeviceAccess.get();\n\t\tthis.preferHighPrecision = preferHighPrecision;\n\t\tthis._targets = targets.slice();\n\t\tconst device = this.device;\n\t\tif (device.supportsMorphTargetTexturesCore) {\n\t\t\tconst renderableHalf = device.extTextureHalfFloat && device.textureHalfFloatRenderable ? PIXELFORMAT_RGBA16F : undefined;\n\t\t\tconst renderableFloat = device.extTextureFloat && device.textureFloatRenderable ? PIXELFORMAT_RGBA32F : undefined;\n\t\t\tthis._renderTextureFormat = this.preferHighPrecision ? renderableFloat != null ? renderableFloat : renderableHalf : renderableHalf != null ? renderableHalf : renderableFloat;\n\t\t\tconst textureHalf = device.extTextureHalfFloat && device.textureHalfFloatUpdatable ? PIXELFORMAT_RGBA16F : undefined;\n\t\t\tconst textureFloat = device.extTextureFloat ? PIXELFORMAT_RGB32F : undefined;\n\t\t\tthis._textureFormat = this.preferHighPrecision ? textureFloat != null ? textureFloat : textureHalf : textureHalf != null ? textureHalf : textureFloat;\n\t\t\tif (this._renderTextureFormat !== undefined && this._textureFormat !== undefined) {\n\t\t\t\tthis._useTextureMorph = true;\n\t\t\t}\n\t\t}\n\t\tthis._init();\n\t\tthis._updateMorphFlags();\n\t}\n\tget aabb() {\n\t\tif (!this._aabb) {\n\t\t\tconst min = new Vec3();\n\t\t\tconst max = new Vec3();\n\t\t\tfor (let i = 0; i < this._targets.length; i++) {\n\t\t\t\tconst targetAabb = this._targets[i].aabb;\n\t\t\t\tmin.min(targetAabb.getMin());\n\t\t\t\tmax.max(targetAabb.getMax());\n\t\t\t}\n\t\t\tthis._aabb = new BoundingBox();\n\t\t\tthis._aabb.setMinMax(min, max);\n\t\t}\n\t\treturn this._aabb;\n\t}\n\tget morphPositions() {\n\t\treturn this._morphPositions;\n\t}\n\tget morphNormals() {\n\t\treturn this._morphNormals;\n\t}\n\tget maxActiveTargets() {\n\t\tif (this._useTextureMorph) return this._targets.length;\n\t\treturn this._morphPositions && this._morphNormals ? 4 : 8;\n\t}\n\tget useTextureMorph() {\n\t\treturn this._useTextureMorph;\n\t}\n\t_init() {\n\t\tif (this._useTextureMorph) {\n\t\t\tthis._useTextureMorph = this._initTextureBased();\n\t\t}\n\t\tif (!this._useTextureMorph) {\n\t\t\tfor (let i = 0; i < this._targets.length; i++) {\n\t\t\t\tthis._targets[i]._initVertexBuffers(this.device);\n\t\t\t}\n\t\t}\n\t\tfor (let i = 0; i < this._targets.length; i++) {\n\t\t\tthis._targets[i]._postInit();\n\t\t}\n\t}\n\t_findSparseSet(deltaArrays, ids, usedDataIndices, floatRounding) {\n\t\tlet freeIndex = 1;\n\t\tconst dataCount = deltaArrays[0].length;\n\t\tfor (let v = 0; v < dataCount; v += 3) {\n\t\t\tlet vertexUsed = false;\n\t\t\tfor (let i = 0; i < deltaArrays.length; i++) {\n\t\t\t\tconst data = deltaArrays[i];\n\t\t\t\tif (data[v] !== 0 || data[v + 1] !== 0 || data[v + 2] !== 0) {\n\t\t\t\t\tvertexUsed = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (vertexUsed) {\n\t\t\t\tids.push(freeIndex + floatRounding);\n\t\t\t\tusedDataIndices.push(v / 3);\n\t\t\t\tfreeIndex++;\n\t\t\t} else {\n\t\t\t\tids.push(0 + floatRounding);\n\t\t\t}\n\t\t}\n\t\treturn freeIndex;\n\t}\n\t_initTextureBased() {\n\t\tconst useUintIds = this.device.isWebGPU;\n\t\tconst floatRounding = useUintIds ? 0 : 0.2;\n\t\tconst deltaArrays = [],\n\t\t\tdeltaInfos = [];\n\t\tfor (let i = 0; i < this._targets.length; i++) {\n\t\t\tconst target = this._targets[i];\n\t\t\tif (target.options.deltaPositions) {\n\t\t\t\tdeltaArrays.push(target.options.deltaPositions);\n\t\t\t\tdeltaInfos.push({\n\t\t\t\t\ttarget: target,\n\t\t\t\t\tname: 'texturePositions'\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (target.options.deltaNormals) {\n\t\t\t\tdeltaArrays.push(target.options.deltaNormals);\n\t\t\t\tdeltaInfos.push({\n\t\t\t\t\ttarget: target,\n\t\t\t\t\tname: 'textureNormals'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tconst ids = [],\n\t\t\tusedDataIndices = [];\n\t\tconst freeIndex = this._findSparseSet(deltaArrays, ids, usedDataIndices, floatRounding);\n\t\tconst maxTextureSize = Math.min(this.device.maxTextureSize, 4096);\n\t\tlet morphTextureWidth = Math.ceil(Math.sqrt(freeIndex));\n\t\tmorphTextureWidth = Math.min(morphTextureWidth, maxTextureSize);\n\t\tconst morphTextureHeight = Math.ceil(freeIndex / morphTextureWidth);\n\t\tif (morphTextureHeight > maxTextureSize) {\n\t\t\treturn false;\n\t\t}\n\t\tthis.morphTextureWidth = morphTextureWidth;\n\t\tthis.morphTextureHeight = morphTextureHeight;\n\t\tlet halfFloat = false;\n\t\tlet numComponents = 3;\n\t\tconst float2Half = FloatPacking.float2Half;\n\t\tif (this._textureFormat === PIXELFORMAT_RGBA16F) {\n\t\t\thalfFloat = true;\n\t\t\tnumComponents = 4;\n\t\t}\n\t\tconst textures = [];\n\t\tfor (let i = 0; i < deltaArrays.length; i++) {\n\t\t\ttextures.push(this._createTexture('MorphTarget', this._textureFormat));\n\t\t}\n\t\tfor (let i = 0; i < deltaArrays.length; i++) {\n\t\t\tconst data = deltaArrays[i];\n\t\t\tconst texture = textures[i];\n\t\t\tconst textureData = texture.lock();\n\t\t\tif (halfFloat) {\n\t\t\t\tfor (let v = 0; v < usedDataIndices.length; v++) {\n\t\t\t\t\tconst index = usedDataIndices[v] * 3;\n\t\t\t\t\tconst dstIndex = v * numComponents + numComponents;\n\t\t\t\t\ttextureData[dstIndex] = float2Half(data[index]);\n\t\t\t\t\ttextureData[dstIndex + 1] = float2Half(data[index + 1]);\n\t\t\t\t\ttextureData[dstIndex + 2] = float2Half(data[index + 2]);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (let v = 0; v < usedDataIndices.length; v++) {\n\t\t\t\t\tconst index = usedDataIndices[v] * 3;\n\t\t\t\t\tconst dstIndex = v * numComponents + numComponents;\n\t\t\t\t\ttextureData[dstIndex] = data[index];\n\t\t\t\t\ttextureData[dstIndex + 1] = data[index + 1];\n\t\t\t\t\ttextureData[dstIndex + 2] = data[index + 2];\n\t\t\t\t}\n\t\t\t}\n\t\t\ttexture.unlock();\n\t\t\tconst target = deltaInfos[i].target;\n\t\t\ttarget._setTexture(deltaInfos[i].name, texture);\n\t\t}\n\t\tconst formatDesc = [{\n\t\t\tsemantic: SEMANTIC_ATTR15,\n\t\t\tcomponents: 1,\n\t\t\ttype: useUintIds ? TYPE_UINT32 : TYPE_FLOAT32\n\t\t}];\n\t\tthis.vertexBufferIds = new VertexBuffer(this.device, new VertexFormat(this.device, formatDesc, ids.length), ids.length, BUFFER_STATIC, useUintIds ? new Uint32Array(ids) : new Float32Array(ids));\n\t\treturn true;\n\t}\n\tdestroy() {\n\t\tvar _this$vertexBufferIds;\n\t\t(_this$vertexBufferIds = this.vertexBufferIds) == null || _this$vertexBufferIds.destroy();\n\t\tthis.vertexBufferIds = null;\n\t\tfor (let i = 0; i < this._targets.length; i++) {\n\t\t\tthis._targets[i].destroy();\n\t\t}\n\t\tthis._targets.length = 0;\n\t}\n\tget targets() {\n\t\treturn this._targets;\n\t}\n\t_updateMorphFlags() {\n\t\tthis._morphPositions = false;\n\t\tthis._morphNormals = false;\n\t\tfor (let i = 0; i < this._targets.length; i++) {\n\t\t\tconst target = this._targets[i];\n\t\t\tif (target.morphPositions) {\n\t\t\t\tthis._morphPositions = true;\n\t\t\t}\n\t\t\tif (target.morphNormals) {\n\t\t\t\tthis._morphNormals = true;\n\t\t\t}\n\t\t}\n\t}\n\t_createTexture(name, format) {\n\t\treturn new Texture(this.device, {\n\t\t\twidth: this.morphTextureWidth,\n\t\t\theight: this.morphTextureHeight,\n\t\t\tformat: format,\n\t\t\tcubemap: false,\n\t\t\tmipmaps: false,\n\t\t\tminFilter: FILTER_NEAREST,\n\t\t\tmagFilter: FILTER_NEAREST,\n\t\t\taddressU: ADDRESS_CLAMP_TO_EDGE,\n\t\t\taddressV: ADDRESS_CLAMP_TO_EDGE,\n\t\t\tname: name\n\t\t});\n\t}\n}\n\nexport { Morph };\n","import '../core/tracing.js';\nimport { BoundingBox } from '../core/shape/bounding-box.js';\nimport { BUFFER_STATIC, TYPE_FLOAT32, SEMANTIC_ATTR0 } from '../platform/graphics/constants.js';\nimport { VertexBuffer } from '../platform/graphics/vertex-buffer.js';\nimport { VertexFormat } from '../platform/graphics/vertex-format.js';\n\nclass MorphTarget {\n\tconstructor(options) {\n\t\tthis.used = false;\n\t\tif (arguments.length === 2) {\n\t\t\toptions = arguments[1];\n\t\t}\n\t\tthis.options = options;\n\t\tthis._name = options.name;\n\t\tthis._defaultWeight = options.defaultWeight || 0;\n\t\tthis._aabb = options.aabb;\n\t\tthis.deltaPositions = options.deltaPositions;\n\t}\n\tdestroy() {\n\t\tvar _this$_vertexBufferPo, _this$_vertexBufferNo, _this$texturePosition, _this$textureNormals;\n\t\t(_this$_vertexBufferPo = this._vertexBufferPositions) == null || _this$_vertexBufferPo.destroy();\n\t\tthis._vertexBufferPositions = null;\n\t\t(_this$_vertexBufferNo = this._vertexBufferNormals) == null || _this$_vertexBufferNo.destroy();\n\t\tthis._vertexBufferNormals = null;\n\t\t(_this$texturePosition = this.texturePositions) == null || _this$texturePosition.destroy();\n\t\tthis.texturePositions = null;\n\t\t(_this$textureNormals = this.textureNormals) == null || _this$textureNormals.destroy();\n\t\tthis.textureNormals = null;\n\t}\n\tget name() {\n\t\treturn this._name;\n\t}\n\tget defaultWeight() {\n\t\treturn this._defaultWeight;\n\t}\n\tget aabb() {\n\t\tif (!this._aabb) {\n\t\t\tthis._aabb = new BoundingBox();\n\t\t\tif (this.deltaPositions) this._aabb.compute(this.deltaPositions);\n\t\t}\n\t\treturn this._aabb;\n\t}\n\tget morphPositions() {\n\t\treturn !!this._vertexBufferPositions || !!this.texturePositions;\n\t}\n\tget morphNormals() {\n\t\treturn !!this._vertexBufferNormals || !!this.textureNormals;\n\t}\n\tclone() {\n\t\treturn new MorphTarget(this.options);\n\t}\n\t_postInit() {\n\t\tif (!this.options.preserveData) {\n\t\t\tthis.options = null;\n\t\t}\n\t\tthis.used = true;\n\t}\n\t_initVertexBuffers(graphicsDevice) {\n\t\tconst options = this.options;\n\t\tthis._vertexBufferPositions = this._createVertexBuffer(graphicsDevice, options.deltaPositions, options.deltaPositionsType);\n\t\tthis._vertexBufferNormals = this._createVertexBuffer(graphicsDevice, options.deltaNormals, options.deltaNormalsType);\n\t\tif (this._vertexBufferPositions) {\n\t\t\tthis.deltaPositions = this._vertexBufferPositions.lock();\n\t\t}\n\t}\n\t_createVertexBuffer(device, data, dataType = TYPE_FLOAT32) {\n\t\tif (data) {\n\t\t\tconst formatDesc = [{\n\t\t\t\tsemantic: SEMANTIC_ATTR0,\n\t\t\t\tcomponents: 3,\n\t\t\t\ttype: dataType\n\t\t\t}];\n\t\t\treturn new VertexBuffer(device, new VertexFormat(device, formatDesc), data.length / 3, BUFFER_STATIC, data);\n\t\t}\n\t\treturn null;\n\t}\n\t_setTexture(name, texture) {\n\t\tthis[name] = texture;\n\t}\n}\n\nexport { MorphTarget };\n","import { ShaderUtils } from '../../../platform/graphics/shader-utils.js';\nimport { BLEND_NORMAL, BLEND_ADDITIVE, BLEND_MULTIPLICATIVE } from '../../constants.js';\nimport { shaderChunks } from '../chunks/chunks.js';\nimport { ShaderGenerator } from './shader-generator.js';\n\nclass ShaderGeneratorParticle extends ShaderGenerator {\n\tgenerateKey(options) {\n\t\tlet key = \"particle\";\n\t\tfor (const prop in options) {\n\t\t\tif (options.hasOwnProperty(prop)) {\n\t\t\t\tkey += options[prop];\n\t\t\t}\n\t\t}\n\t\treturn key;\n\t}\n\t_animTex(options) {\n\t\tlet vshader = \"\";\n\t\tvshader += options.animTexLoop ? shaderChunks.particleAnimFrameLoopVS : shaderChunks.particleAnimFrameClampVS;\n\t\tvshader += shaderChunks.particleAnimTexVS;\n\t\treturn vshader;\n\t}\n\tcreateShaderDefinition(device, options) {\n\t\tconst executionDefine = `#define PARTICLE_${options.useCpu ? 'CPU' : 'GPU'}\\n`;\n\t\tlet fshader = '#define PARTICLE\\n' + executionDefine;\n\t\tlet vshader = \"#define VERTEXSHADER\\n\" + executionDefine;\n\t\tif (options.mesh) vshader += \"#define USE_MESH\\n\";\n\t\tif (options.localSpace) vshader += \"#define LOCAL_SPACE\\n\";\n\t\tif (options.screenSpace) vshader += \"#define SCREEN_SPACE\\n\";\n\t\tif (options.animTex) vshader += \"\\nuniform vec2 animTexTilesParams;\\n\";\n\t\tif (options.animTex) vshader += \"\\nuniform vec4 animTexParams;\\n\";\n\t\tif (options.animTex) vshader += \"\\nuniform vec2 animTexIndexParams;\\n\";\n\t\tif (options.normal === 2) vshader += \"\\nvarying mat3 ParticleMat;\\n\";\n\t\tif (options.normal === 1) vshader += \"\\nvarying vec3 Normal;\\n\";\n\t\tif (options.soft) vshader += \"\\nvarying float vDepth;\\n\";\n\t\tconst faceVS = options.customFace ? shaderChunks.particle_customFaceVS : shaderChunks.particle_billboardVS;\n\t\tif (!options.useCpu) {\n\t\t\tvshader += shaderChunks.particle_initVS;\n\t\t\tvshader += options.pack8 ? shaderChunks.particleInputRgba8PS : shaderChunks.particleInputFloatPS;\n\t\t\tif (options.soft > 0) vshader += shaderChunks.screenDepthPS;\n\t\t\tvshader += shaderChunks.particleVS;\n\t\t\tif (options.localSpace) vshader += shaderChunks.particle_localShiftVS;\n\t\t\tif (options.animTex) vshader += this._animTex(options);\n\t\t\tif (options.wrap) vshader += shaderChunks.particle_wrapVS;\n\t\t\tif (options.alignToMotion) vshader += shaderChunks.particle_pointAlongVS;\n\t\t\tvshader += options.mesh ? shaderChunks.particle_meshVS : faceVS;\n\t\t\tif (options.normal === 1) vshader += shaderChunks.particle_normalVS;\n\t\t\tif (options.normal === 2) vshader += shaderChunks.particle_TBNVS;\n\t\t\tif (options.stretch > 0.0) vshader += shaderChunks.particle_stretchVS;\n\t\t\tvshader += shaderChunks.particle_endVS;\n\t\t\tif (options.soft > 0) vshader += shaderChunks.particle_softVS;\n\t\t} else {\n\t\t\tif (options.soft > 0) vshader += shaderChunks.screenDepthPS;\n\t\t\tvshader += shaderChunks.particle_cpuVS;\n\t\t\tif (options.localSpace) vshader += shaderChunks.particle_localShiftVS;\n\t\t\tif (options.animTex) vshader += this._animTex(options);\n\t\t\tif (options.alignToMotion) vshader += shaderChunks.particle_pointAlongVS;\n\t\t\tvshader += options.mesh ? shaderChunks.particle_meshVS : faceVS;\n\t\t\tif (options.normal === 1) vshader += shaderChunks.particle_normalVS;\n\t\t\tif (options.normal === 2) vshader += shaderChunks.particle_TBNVS;\n\t\t\tif (options.stretch > 0.0) vshader += shaderChunks.particle_stretchVS;\n\t\t\tvshader += shaderChunks.particle_cpu_endVS;\n\t\t\tif (options.soft > 0) vshader += shaderChunks.particle_softVS;\n\t\t}\n\t\tvshader += \"}\\n\";\n\t\tif (options.normal > 0) {\n\t\t\tif (options.normal === 1) {\n\t\t\t\tfshader += \"\\nvarying vec3 Normal;\\n\";\n\t\t\t} else if (options.normal === 2) {\n\t\t\t\tfshader += \"\\nvarying mat3 ParticleMat;\\n\";\n\t\t\t}\n\t\t\tfshader += \"\\nuniform vec3 lightCube[6];\\n\";\n\t\t}\n\t\tif (options.soft) fshader += \"\\nvarying float vDepth;\\n\";\n\t\tif (options.normal === 0 && options.fog === \"none\") options.srgb = false;\n\t\tfshader += shaderChunks.decodePS;\n\t\tfshader += ShaderGenerator.gammaCode(options.gamma);\n\t\tfshader += ShaderGenerator.tonemapCode(options.toneMap);\n\t\tif (options.fog === 'linear') {\n\t\t\tfshader += shaderChunks.fogLinearPS;\n\t\t} else if (options.fog === 'exp') {\n\t\t\tfshader += shaderChunks.fogExpPS;\n\t\t} else if (options.fog === 'exp2') {\n\t\t\tfshader += shaderChunks.fogExp2PS;\n\t\t} else {\n\t\t\tfshader += shaderChunks.fogNonePS;\n\t\t}\n\t\tif (options.normal === 2) fshader += \"\\nuniform sampler2D normalMap;\\n\";\n\t\tif (options.soft > 0) fshader += shaderChunks.screenDepthPS;\n\t\tfshader += shaderChunks.particlePS;\n\t\tif (options.soft > 0) fshader += shaderChunks.particle_softPS;\n\t\tif (options.normal === 1) fshader += \"\\nvec3 normal = Normal;\\n\";\n\t\tif (options.normal === 2) fshader += shaderChunks.particle_normalMapPS;\n\t\tif (options.normal > 0) fshader += options.halflambert ? shaderChunks.particle_halflambertPS : shaderChunks.particle_lambertPS;\n\t\tif (options.normal > 0) fshader += shaderChunks.particle_lightingPS;\n\t\tif (options.blend === BLEND_NORMAL) {\n\t\t\tfshader += shaderChunks.particle_blendNormalPS;\n\t\t} else if (options.blend === BLEND_ADDITIVE) {\n\t\t\tfshader += shaderChunks.particle_blendAddPS;\n\t\t} else if (options.blend === BLEND_MULTIPLICATIVE) {\n\t\t\tfshader += shaderChunks.particle_blendMultiplyPS;\n\t\t}\n\t\tfshader += shaderChunks.particle_endPS;\n\t\treturn ShaderUtils.createDefinition(device, {\n\t\t\tname: 'ParticleShader',\n\t\t\tvertexCode: vshader,\n\t\t\tfragmentCode: fshader\n\t\t});\n\t}\n}\nconst particle = new ShaderGeneratorParticle();\n\nexport { particle };\n","import { math } from '../../core/math/math.js';\nimport { Mat4 } from '../../core/math/mat4.js';\nimport { Vec3 } from '../../core/math/vec3.js';\nimport { EMITTERSHAPE_BOX, EMITTERSHAPE_SPHERE, PARTICLESORT_NONE } from '../constants.js';\n\nlet nonUniformScale;\nlet uniformScale = 1;\nconst particleTexChannels = 4;\nconst rotMat = new Mat4();\nconst rotMatInv = new Mat4();\nconst randomPosTformed = new Vec3();\nconst randomPos = new Vec3();\nconst rndFactor3Vec = new Vec3();\nconst particlePosPrev = new Vec3();\nconst velocityVec = new Vec3();\nconst localVelocityVec = new Vec3();\nconst velocityVec2 = new Vec3();\nconst localVelocityVec2 = new Vec3();\nconst radialVelocityVec = new Vec3();\nconst particlePos = new Vec3();\nconst particleFinalPos = new Vec3();\nconst moveDirVec = new Vec3();\nconst tmpVec3 = new Vec3();\nfunction frac(f) {\n\treturn f - Math.floor(f);\n}\nfunction saturate(x) {\n\treturn Math.max(Math.min(x, 1), 0);\n}\nfunction glMod(x, y) {\n\treturn x - y * Math.floor(x / y);\n}\nfunction encodeFloatRGBA(v) {\n\tlet encX = frac(v);\n\tlet encY = frac(255.0 * v);\n\tlet encZ = frac(65025.0 * v);\n\tlet encW = frac(160581375.0 * v);\n\tencX -= encY / 255.0;\n\tencY -= encZ / 255.0;\n\tencZ -= encW / 255.0;\n\tencW -= encW / 255.0;\n\treturn [encX, encY, encZ, encW];\n}\nfunction encodeFloatRG(v) {\n\tlet encX = frac(v);\n\tlet encY = frac(255.0 * v);\n\tencX -= encY / 255.0;\n\tencY -= encY / 255.0;\n\treturn [encX, encY];\n}\nclass ParticleCPUUpdater {\n\tconstructor(emitter) {\n\t\tthis._emitter = emitter;\n\t}\n\tcalcSpawnPosition(particleTex, spawnMatrix, extentsInnerRatioUniform, emitterPos, i) {\n\t\tconst emitter = this._emitter;\n\t\tconst rX = Math.random();\n\t\tconst rY = Math.random();\n\t\tconst rZ = Math.random();\n\t\tconst rW = Math.random();\n\t\tif (emitter.useCpu) {\n\t\t\tparticleTex[i * particleTexChannels + 0 + emitter.numParticlesPot * 2 * particleTexChannels] = rX;\n\t\t\tparticleTex[i * particleTexChannels + 1 + emitter.numParticlesPot * 2 * particleTexChannels] = rY;\n\t\t\tparticleTex[i * particleTexChannels + 2 + emitter.numParticlesPot * 2 * particleTexChannels] = rZ;\n\t\t}\n\t\trandomPos.x = rX - 0.5;\n\t\trandomPos.y = rY - 0.5;\n\t\trandomPos.z = rZ - 0.5;\n\t\tif (emitter.emitterShape === EMITTERSHAPE_BOX) {\n\t\t\tconst max = Math.max(Math.abs(randomPos.x), Math.max(Math.abs(randomPos.y), Math.abs(randomPos.z)));\n\t\t\tconst edgeX = max + (0.5 - max) * extentsInnerRatioUniform[0];\n\t\t\tconst edgeY = max + (0.5 - max) * extentsInnerRatioUniform[1];\n\t\t\tconst edgeZ = max + (0.5 - max) * extentsInnerRatioUniform[2];\n\t\t\trandomPos.x = edgeX * (max === Math.abs(randomPos.x) ? Math.sign(randomPos.x) : 2 * randomPos.x);\n\t\t\trandomPos.y = edgeY * (max === Math.abs(randomPos.y) ? Math.sign(randomPos.y) : 2 * randomPos.y);\n\t\t\trandomPos.z = edgeZ * (max === Math.abs(randomPos.z) ? Math.sign(randomPos.z) : 2 * randomPos.z);\n\t\t\tif (!emitter.localSpace) randomPosTformed.copy(emitterPos).add(spawnMatrix.transformPoint(randomPos));else randomPosTformed.copy(spawnMatrix.transformPoint(randomPos));\n\t\t} else {\n\t\t\trandomPos.normalize();\n\t\t\tconst spawnBoundsSphereInnerRatio = emitter.emitterRadius === 0 ? 0 : emitter.emitterRadiusInner / emitter.emitterRadius;\n\t\t\tconst r = rW * (1.0 - spawnBoundsSphereInnerRatio) + spawnBoundsSphereInnerRatio;\n\t\t\tif (!emitter.localSpace) randomPosTformed.copy(emitterPos).add(randomPos.mulScalar(r * emitter.emitterRadius));else randomPosTformed.copy(randomPos.mulScalar(r * emitter.emitterRadius));\n\t\t}\n\t\tconst particleRate = math.lerp(emitter.rate, emitter.rate2, rX);\n\t\tlet startSpawnTime = -particleRate * i;\n\t\tif (emitter.pack8) {\n\t\t\tconst packX = (randomPosTformed.x - emitter.worldBounds.center.x) / emitter.worldBoundsSize.x + 0.5;\n\t\t\tconst packY = (randomPosTformed.y - emitter.worldBounds.center.y) / emitter.worldBoundsSize.y + 0.5;\n\t\t\tconst packZ = (randomPosTformed.z - emitter.worldBounds.center.z) / emitter.worldBoundsSize.z + 0.5;\n\t\t\tlet packA = math.lerp(emitter.startAngle * math.DEG_TO_RAD, emitter.startAngle2 * math.DEG_TO_RAD, rX);\n\t\t\tpackA = packA % (Math.PI * 2) / (Math.PI * 2);\n\t\t\tconst rg0 = encodeFloatRG(packX);\n\t\t\tparticleTex[i * particleTexChannels] = rg0[0];\n\t\t\tparticleTex[i * particleTexChannels + 1] = rg0[1];\n\t\t\tconst ba0 = encodeFloatRG(packY);\n\t\t\tparticleTex[i * particleTexChannels + 2] = ba0[0];\n\t\t\tparticleTex[i * particleTexChannels + 3] = ba0[1];\n\t\t\tconst rg1 = encodeFloatRG(packZ);\n\t\t\tparticleTex[i * particleTexChannels + 0 + emitter.numParticlesPot * particleTexChannels] = rg1[0];\n\t\t\tparticleTex[i * particleTexChannels + 1 + emitter.numParticlesPot * particleTexChannels] = rg1[1];\n\t\t\tconst ba1 = encodeFloatRG(packA);\n\t\t\tparticleTex[i * particleTexChannels + 2 + emitter.numParticlesPot * particleTexChannels] = ba1[0];\n\t\t\tparticleTex[i * particleTexChannels + 3 + emitter.numParticlesPot * particleTexChannels] = ba1[1];\n\t\t\tconst a2 = 1.0;\n\t\t\tparticleTex[i * particleTexChannels + 3 + emitter.numParticlesPot * particleTexChannels * 2] = a2;\n\t\t\tconst maxNegLife = Math.max(emitter.lifetime, (emitter.numParticles - 1.0) * Math.max(emitter.rate, emitter.rate2));\n\t\t\tconst maxPosLife = emitter.lifetime + 1.0;\n\t\t\tstartSpawnTime = (startSpawnTime + maxNegLife) / (maxNegLife + maxPosLife);\n\t\t\tconst rgba3 = encodeFloatRGBA(startSpawnTime);\n\t\t\tparticleTex[i * particleTexChannels + 0 + emitter.numParticlesPot * particleTexChannels * 3] = rgba3[0];\n\t\t\tparticleTex[i * particleTexChannels + 1 + emitter.numParticlesPot * particleTexChannels * 3] = rgba3[1];\n\t\t\tparticleTex[i * particleTexChannels + 2 + emitter.numParticlesPot * particleTexChannels * 3] = rgba3[2];\n\t\t\tparticleTex[i * particleTexChannels + 3 + emitter.numParticlesPot * particleTexChannels * 3] = rgba3[3];\n\t\t} else {\n\t\t\tparticleTex[i * particleTexChannels] = randomPosTformed.x;\n\t\t\tparticleTex[i * particleTexChannels + 1] = randomPosTformed.y;\n\t\t\tparticleTex[i * particleTexChannels + 2] = randomPosTformed.z;\n\t\t\tparticleTex[i * particleTexChannels + 3] = math.lerp(emitter.startAngle * math.DEG_TO_RAD, emitter.startAngle2 * math.DEG_TO_RAD, rX);\n\t\t\tparticleTex[i * particleTexChannels + 3 + emitter.numParticlesPot * particleTexChannels] = startSpawnTime;\n\t\t}\n\t}\n\tupdate(data, vbToSort, particleTex, spawnMatrix, extentsInnerRatioUniform, emitterPos, delta, isOnStop) {\n\t\tlet a, b, c;\n\t\tconst emitter = this._emitter;\n\t\tif (emitter.meshInstance.node) {\n\t\t\tconst fullMat = emitter.meshInstance.node.worldTransform;\n\t\t\tfor (let j = 0; j < 12; j++) {\n\t\t\t\trotMat.data[j] = fullMat.data[j];\n\t\t\t}\n\t\t\trotMatInv.copy(rotMat);\n\t\t\trotMatInv.invert();\n\t\t\tnonUniformScale = emitter.meshInstance.node.localScale;\n\t\t\tuniformScale = Math.max(Math.max(nonUniformScale.x, nonUniformScale.y), nonUniformScale.z);\n\t\t}\n\t\temitterPos = emitter.meshInstance.node === null || emitter.localSpace ? Vec3.ZERO : emitter.meshInstance.node.getPosition();\n\t\tconst posCam = emitter.camera ? emitter.camera._node.getPosition() : Vec3.ZERO;\n\t\tconst vertSize = !emitter.useMesh ? 15 : 17;\n\t\tlet cf, cc;\n\t\tlet rotSpeed, rotSpeed2, scale2, alpha, alpha2, radialSpeed, radialSpeed2;\n\t\tconst precision1 = emitter.precision - 1;\n\t\tfor (let i = 0; i < emitter.numParticles; i++) {\n\t\t\tconst id = Math.floor(emitter.vbCPU[i * emitter.numParticleVerts * (emitter.useMesh ? 6 : 4) + 3]);\n\t\t\tconst rndFactor = particleTex[id * particleTexChannels + 0 + emitter.numParticlesPot * 2 * particleTexChannels];\n\t\t\trndFactor3Vec.x = rndFactor;\n\t\t\trndFactor3Vec.y = particleTex[id * particleTexChannels + 1 + emitter.numParticlesPot * 2 * particleTexChannels];\n\t\t\trndFactor3Vec.z = particleTex[id * particleTexChannels + 2 + emitter.numParticlesPot * 2 * particleTexChannels];\n\t\t\tconst particleRate = emitter.rate + (emitter.rate2 - emitter.rate) * rndFactor;\n\t\t\tconst particleLifetime = emitter.lifetime;\n\t\t\tlet life = particleTex[id * particleTexChannels + 3 + emitter.numParticlesPot * particleTexChannels] + delta;\n\t\t\tconst nlife = saturate(life / particleLifetime);\n\t\t\tlet scale = 0;\n\t\t\tlet alphaDiv = 0;\n\t\t\tconst angle = 0;\n\t\t\tconst respawn = life - delta <= 0.0 || life >= particleLifetime;\n\t\t\tif (respawn) {\n\t\t\t\tthis.calcSpawnPosition(particleTex, spawnMatrix, extentsInnerRatioUniform, emitterPos, id);\n\t\t\t}\n\t\t\tlet particleEnabled = life > 0.0 && life < particleLifetime;\n\t\t\tif (particleEnabled) {\n\t\t\t\tc = nlife * precision1;\n\t\t\t\tcf = Math.floor(c);\n\t\t\t\tcc = Math.ceil(c);\n\t\t\t\tc %= 1;\n\t\t\t\ta = emitter.qRotSpeed[cf];\n\t\t\t\tb = emitter.qRotSpeed[cc];\n\t\t\t\trotSpeed = a + (b - a) * c;\n\t\t\t\ta = emitter.qRotSpeed2[cf];\n\t\t\t\tb = emitter.qRotSpeed2[cc];\n\t\t\t\trotSpeed2 = a + (b - a) * c;\n\t\t\t\ta = emitter.qScale[cf];\n\t\t\t\tb = emitter.qScale[cc];\n\t\t\t\tscale = a + (b - a) * c;\n\t\t\t\ta = emitter.qScale2[cf];\n\t\t\t\tb = emitter.qScale2[cc];\n\t\t\t\tscale2 = a + (b - a) * c;\n\t\t\t\ta = emitter.qAlpha[cf];\n\t\t\t\tb = emitter.qAlpha[cc];\n\t\t\t\talpha = a + (b - a) * c;\n\t\t\t\ta = emitter.qAlpha2[cf];\n\t\t\t\tb = emitter.qAlpha2[cc];\n\t\t\t\talpha2 = a + (b - a) * c;\n\t\t\t\ta = emitter.qRadialSpeed[cf];\n\t\t\t\tb = emitter.qRadialSpeed[cc];\n\t\t\t\tradialSpeed = a + (b - a) * c;\n\t\t\t\ta = emitter.qRadialSpeed2[cf];\n\t\t\t\tb = emitter.qRadialSpeed2[cc];\n\t\t\t\tradialSpeed2 = a + (b - a) * c;\n\t\t\t\tradialSpeed += (radialSpeed2 - radialSpeed) * (rndFactor * 100.0 % 1.0);\n\t\t\t\tparticlePosPrev.x = particleTex[id * particleTexChannels];\n\t\t\t\tparticlePosPrev.y = particleTex[id * particleTexChannels + 1];\n\t\t\t\tparticlePosPrev.z = particleTex[id * particleTexChannels + 2];\n\t\t\t\tif (!emitter.localSpace) radialVelocityVec.copy(particlePosPrev).sub(emitterPos);else radialVelocityVec.copy(particlePosPrev);\n\t\t\t\tradialVelocityVec.normalize().mulScalar(radialSpeed);\n\t\t\t\tcf *= 3;\n\t\t\t\tcc *= 3;\n\t\t\t\ta = emitter.qLocalVelocity[cf];\n\t\t\t\tb = emitter.qLocalVelocity[cc];\n\t\t\t\tlocalVelocityVec.x = a + (b - a) * c;\n\t\t\t\ta = emitter.qLocalVelocity[cf + 1];\n\t\t\t\tb = emitter.qLocalVelocity[cc + 1];\n\t\t\t\tlocalVelocityVec.y = a + (b - a) * c;\n\t\t\t\ta = emitter.qLocalVelocity[cf + 2];\n\t\t\t\tb = emitter.qLocalVelocity[cc + 2];\n\t\t\t\tlocalVelocityVec.z = a + (b - a) * c;\n\t\t\t\ta = emitter.qLocalVelocity2[cf];\n\t\t\t\tb = emitter.qLocalVelocity2[cc];\n\t\t\t\tlocalVelocityVec2.x = a + (b - a) * c;\n\t\t\t\ta = emitter.qLocalVelocity2[cf + 1];\n\t\t\t\tb = emitter.qLocalVelocity2[cc + 1];\n\t\t\t\tlocalVelocityVec2.y = a + (b - a) * c;\n\t\t\t\ta = emitter.qLocalVelocity2[cf + 2];\n\t\t\t\tb = emitter.qLocalVelocity2[cc + 2];\n\t\t\t\tlocalVelocityVec2.z = a + (b - a) * c;\n\t\t\t\ta = emitter.qVelocity[cf];\n\t\t\t\tb = emitter.qVelocity[cc];\n\t\t\t\tvelocityVec.x = a + (b - a) * c;\n\t\t\t\ta = emitter.qVelocity[cf + 1];\n\t\t\t\tb = emitter.qVelocity[cc + 1];\n\t\t\t\tvelocityVec.y = a + (b - a) * c;\n\t\t\t\ta = emitter.qVelocity[cf + 2];\n\t\t\t\tb = emitter.qVelocity[cc + 2];\n\t\t\t\tvelocityVec.z = a + (b - a) * c;\n\t\t\t\ta = emitter.qVelocity2[cf];\n\t\t\t\tb = emitter.qVelocity2[cc];\n\t\t\t\tvelocityVec2.x = a + (b - a) * c;\n\t\t\t\ta = emitter.qVelocity2[cf + 1];\n\t\t\t\tb = emitter.qVelocity2[cc + 1];\n\t\t\t\tvelocityVec2.y = a + (b - a) * c;\n\t\t\t\ta = emitter.qVelocity2[cf + 2];\n\t\t\t\tb = emitter.qVelocity2[cc + 2];\n\t\t\t\tvelocityVec2.z = a + (b - a) * c;\n\t\t\t\tlocalVelocityVec.x += (localVelocityVec2.x - localVelocityVec.x) * rndFactor3Vec.x;\n\t\t\t\tlocalVelocityVec.y += (localVelocityVec2.y - localVelocityVec.y) * rndFactor3Vec.y;\n\t\t\t\tlocalVelocityVec.z += (localVelocityVec2.z - localVelocityVec.z) * rndFactor3Vec.z;\n\t\t\t\tif (emitter.initialVelocity > 0) {\n\t\t\t\t\tif (emitter.emitterShape === EMITTERSHAPE_SPHERE) {\n\t\t\t\t\t\trandomPos.copy(rndFactor3Vec).mulScalar(2).sub(Vec3.ONE).normalize();\n\t\t\t\t\t\tlocalVelocityVec.add(randomPos.mulScalar(emitter.initialVelocity));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlocalVelocityVec.add(Vec3.FORWARD.mulScalar(emitter.initialVelocity));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tvelocityVec.x += (velocityVec2.x - velocityVec.x) * rndFactor3Vec.x;\n\t\t\t\tvelocityVec.y += (velocityVec2.y - velocityVec.y) * rndFactor3Vec.y;\n\t\t\t\tvelocityVec.z += (velocityVec2.z - velocityVec.z) * rndFactor3Vec.z;\n\t\t\t\trotSpeed += (rotSpeed2 - rotSpeed) * rndFactor3Vec.y;\n\t\t\t\tscale = (scale + (scale2 - scale) * (rndFactor * 10000.0 % 1.0)) * uniformScale;\n\t\t\t\talphaDiv = (alpha2 - alpha) * (rndFactor * 1000.0 % 1.0);\n\t\t\t\tif (emitter.meshInstance.node) {\n\t\t\t\t\tif (!emitter.localSpace) {\n\t\t\t\t\t\trotMat.transformPoint(localVelocityVec, localVelocityVec);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlocalVelocityVec.x /= nonUniformScale.x;\n\t\t\t\t\t\tlocalVelocityVec.y /= nonUniformScale.y;\n\t\t\t\t\t\tlocalVelocityVec.z /= nonUniformScale.z;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!emitter.localSpace) {\n\t\t\t\t\tlocalVelocityVec.add(velocityVec.mul(nonUniformScale));\n\t\t\t\t\tlocalVelocityVec.add(radialVelocityVec.mul(nonUniformScale));\n\t\t\t\t} else {\n\t\t\t\t\trotMatInv.transformPoint(velocityVec, velocityVec);\n\t\t\t\t\tlocalVelocityVec.add(velocityVec).add(radialVelocityVec);\n\t\t\t\t}\n\t\t\t\tmoveDirVec.copy(localVelocityVec);\n\t\t\t\tparticlePos.copy(particlePosPrev).add(localVelocityVec.mulScalar(delta));\n\t\t\t\tparticleFinalPos.copy(particlePos);\n\t\t\t\tparticleTex[id * particleTexChannels] = particleFinalPos.x;\n\t\t\t\tparticleTex[id * particleTexChannels + 1] = particleFinalPos.y;\n\t\t\t\tparticleTex[id * particleTexChannels + 2] = particleFinalPos.z;\n\t\t\t\tparticleTex[id * particleTexChannels + 3] += rotSpeed * delta;\n\t\t\t\tif (emitter.wrap && emitter.wrapBounds) {\n\t\t\t\t\tif (!emitter.localSpace) particleFinalPos.sub(emitterPos);\n\t\t\t\t\tparticleFinalPos.x = glMod(particleFinalPos.x, emitter.wrapBounds.x) - emitter.wrapBounds.x * 0.5;\n\t\t\t\t\tparticleFinalPos.y = glMod(particleFinalPos.y, emitter.wrapBounds.y) - emitter.wrapBounds.y * 0.5;\n\t\t\t\t\tparticleFinalPos.z = glMod(particleFinalPos.z, emitter.wrapBounds.z) - emitter.wrapBounds.z * 0.5;\n\t\t\t\t\tif (!emitter.localSpace) particleFinalPos.add(emitterPos);\n\t\t\t\t}\n\t\t\t\tif (emitter.sort > 0) {\n\t\t\t\t\tif (emitter.sort === 1) {\n\t\t\t\t\t\ttmpVec3.copy(particleFinalPos).sub(posCam);\n\t\t\t\t\t\temitter.particleDistance[id] = -(tmpVec3.x * tmpVec3.x + tmpVec3.y * tmpVec3.y + tmpVec3.z * tmpVec3.z);\n\t\t\t\t\t} else if (emitter.sort === 2) {\n\t\t\t\t\t\temitter.particleDistance[id] = life;\n\t\t\t\t\t} else if (emitter.sort === 3) {\n\t\t\t\t\t\temitter.particleDistance[id] = -life;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (isOnStop) {\n\t\t\t\tif (life < 0) {\n\t\t\t\t\tparticleTex[id * particleTexChannels + 3 + emitter.numParticlesPot * 2 * particleTexChannels] = -1;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (life >= particleLifetime) {\n\t\t\t\t\tlife -= Math.max(particleLifetime, (emitter.numParticles - 1) * particleRate);\n\t\t\t\t\tparticleTex[id * particleTexChannels + 3 + emitter.numParticlesPot * 2 * particleTexChannels] = emitter.loop ? 1 : -1;\n\t\t\t\t}\n\t\t\t\tif (life < 0 && emitter.loop) {\n\t\t\t\t\tparticleTex[id * particleTexChannels + 3 + emitter.numParticlesPot * 2 * particleTexChannels] = 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (particleTex[id * particleTexChannels + 3 + emitter.numParticlesPot * 2 * particleTexChannels] < 0) particleEnabled = false;\n\t\t\tparticleTex[id * particleTexChannels + 3 + emitter.numParticlesPot * particleTexChannels] = life;\n\t\t\tfor (let v = 0; v < emitter.numParticleVerts; v++) {\n\t\t\t\tconst vbOffset = (i * emitter.numParticleVerts + v) * (emitter.useMesh ? 6 : 4);\n\t\t\t\tlet quadX = emitter.vbCPU[vbOffset];\n\t\t\t\tlet quadY = emitter.vbCPU[vbOffset + 1];\n\t\t\t\tlet quadZ = emitter.vbCPU[vbOffset + 2];\n\t\t\t\tif (!particleEnabled) {\n\t\t\t\t\tquadX = quadY = quadZ = 0;\n\t\t\t\t}\n\t\t\t\tconst w = i * emitter.numParticleVerts * vertSize + v * vertSize;\n\t\t\t\tdata[w] = particleFinalPos.x;\n\t\t\t\tdata[w + 1] = particleFinalPos.y;\n\t\t\t\tdata[w + 2] = particleFinalPos.z;\n\t\t\t\tdata[w + 3] = nlife;\n\t\t\t\tdata[w + 4] = emitter.alignToMotion ? angle : particleTex[id * particleTexChannels + 3];\n\t\t\t\tdata[w + 5] = scale;\n\t\t\t\tdata[w + 6] = alphaDiv;\n\t\t\t\tdata[w + 7] = moveDirVec.x;\n\t\t\t\tdata[w + 8] = quadX;\n\t\t\t\tdata[w + 9] = quadY;\n\t\t\t\tdata[w + 10] = quadZ;\n\t\t\t\tdata[w + 11] = moveDirVec.y;\n\t\t\t\tdata[w + 12] = id;\n\t\t\t\tdata[w + 13] = moveDirVec.z;\n\t\t\t\tdata[w + 14] = emitter.vbCPU[vbOffset + 3];\n\t\t\t\tif (emitter.useMesh) {\n\t\t\t\t\tdata[w + 15] = emitter.vbCPU[vbOffset + 4];\n\t\t\t\t\tdata[w + 16] = emitter.vbCPU[vbOffset + 5];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (emitter.sort > PARTICLESORT_NONE && emitter.camera) {\n\t\t\tconst vbStride = emitter.useMesh ? 6 : 4;\n\t\t\tconst particleDistance = emitter.particleDistance;\n\t\t\tfor (let i = 0; i < emitter.numParticles; i++) {\n\t\t\t\tvbToSort[i][0] = i;\n\t\t\t\tvbToSort[i][1] = particleDistance[Math.floor(emitter.vbCPU[i * emitter.numParticleVerts * vbStride + 3])];\n\t\t\t}\n\t\t\temitter.vbOld.set(emitter.vbCPU);\n\t\t\tvbToSort.sort(function (p1, p2) {\n\t\t\t\treturn p1[1] - p2[1];\n\t\t\t});\n\t\t\tfor (let i = 0; i < emitter.numParticles; i++) {\n\t\t\t\tconst src = vbToSort[i][0] * emitter.numParticleVerts * vbStride;\n\t\t\t\tconst dest = i * emitter.numParticleVerts * vbStride;\n\t\t\t\tfor (let j = 0; j < emitter.numParticleVerts * vbStride; j++) {\n\t\t\t\t\temitter.vbCPU[dest + j] = emitter.vbOld[src + j];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport { ParticleCPUUpdater };\n","import { math } from '../../core/math/math.js';\nimport { Mat3 } from '../../core/math/mat3.js';\nimport { Mat4 } from '../../core/math/mat4.js';\nimport { Vec3 } from '../../core/math/vec3.js';\nimport { CULLFACE_NONE } from '../../platform/graphics/constants.js';\nimport { BlendState } from '../../platform/graphics/blend-state.js';\nimport { DepthState } from '../../platform/graphics/depth-state.js';\nimport { drawQuadWithShader } from '../graphics/quad-render-utils.js';\nimport { EMITTERSHAPE_BOX } from '../constants.js';\n\nconst spawnMatrix3 = new Mat3();\nconst emitterMatrix3 = new Mat3();\nconst emitterMatrix3Inv = new Mat3();\nclass ParticleGPUUpdater {\n\tconstructor(emitter, gd) {\n\t\tthis._emitter = emitter;\n\t\tthis.frameRandomUniform = new Float32Array(3);\n\t\tthis.emitterPosUniform = new Float32Array(3);\n\t\tthis.emitterScaleUniform = new Float32Array([1, 1, 1]);\n\t\tthis.worldBoundsMulUniform = new Float32Array(3);\n\t\tthis.worldBoundsAddUniform = new Float32Array(3);\n\t\tthis.inBoundsSizeUniform = new Float32Array(3);\n\t\tthis.inBoundsCenterUniform = new Float32Array(3);\n\t\tthis.constantParticleTexIN = gd.scope.resolve('particleTexIN');\n\t\tthis.constantParticleTexOUT = gd.scope.resolve('particleTexOUT');\n\t\tthis.constantEmitterPos = gd.scope.resolve('emitterPos');\n\t\tthis.constantEmitterScale = gd.scope.resolve('emitterScale');\n\t\tthis.constantSpawnBounds = gd.scope.resolve('spawnBounds');\n\t\tthis.constantSpawnPosInnerRatio = gd.scope.resolve('spawnPosInnerRatio');\n\t\tthis.constantSpawnBoundsSphere = gd.scope.resolve('spawnBoundsSphere');\n\t\tthis.constantSpawnBoundsSphereInnerRatio = gd.scope.resolve('spawnBoundsSphereInnerRatio');\n\t\tthis.constantInitialVelocity = gd.scope.resolve('initialVelocity');\n\t\tthis.constantFrameRandom = gd.scope.resolve('frameRandom');\n\t\tthis.constantDelta = gd.scope.resolve('delta');\n\t\tthis.constantRate = gd.scope.resolve('rate');\n\t\tthis.constantRateDiv = gd.scope.resolve('rateDiv');\n\t\tthis.constantLifetime = gd.scope.resolve('lifetime');\n\t\tthis.constantGraphSampleSize = gd.scope.resolve('graphSampleSize');\n\t\tthis.constantGraphNumSamples = gd.scope.resolve('graphNumSamples');\n\t\tthis.constantInternalTex0 = gd.scope.resolve('internalTex0');\n\t\tthis.constantInternalTex1 = gd.scope.resolve('internalTex1');\n\t\tthis.constantInternalTex2 = gd.scope.resolve('internalTex2');\n\t\tthis.constantInternalTex3 = gd.scope.resolve('internalTex3');\n\t\tthis.constantEmitterMatrix = gd.scope.resolve('emitterMatrix');\n\t\tthis.constantEmitterMatrixInv = gd.scope.resolve('emitterMatrixInv');\n\t\tthis.constantNumParticles = gd.scope.resolve('numParticles');\n\t\tthis.constantNumParticlesPot = gd.scope.resolve('numParticlesPot');\n\t\tthis.constantLocalVelocityDivMult = gd.scope.resolve('localVelocityDivMult');\n\t\tthis.constantVelocityDivMult = gd.scope.resolve('velocityDivMult');\n\t\tthis.constantRotSpeedDivMult = gd.scope.resolve('rotSpeedDivMult');\n\t\tthis.constantSeed = gd.scope.resolve('seed');\n\t\tthis.constantStartAngle = gd.scope.resolve('startAngle');\n\t\tthis.constantStartAngle2 = gd.scope.resolve('startAngle2');\n\t\tthis.constantOutBoundsMul = gd.scope.resolve('outBoundsMul');\n\t\tthis.constantOutBoundsAdd = gd.scope.resolve('outBoundsAdd');\n\t\tthis.constantInBoundsSize = gd.scope.resolve('inBoundsSize');\n\t\tthis.constantInBoundsCenter = gd.scope.resolve('inBoundsCenter');\n\t\tthis.constantMaxVel = gd.scope.resolve('maxVel');\n\t\tthis.constantFaceTangent = gd.scope.resolve('faceTangent');\n\t\tthis.constantFaceBinorm = gd.scope.resolve('faceBinorm');\n\t}\n\t_setInputBounds() {\n\t\tthis.inBoundsSizeUniform[0] = this._emitter.prevWorldBoundsSize.x;\n\t\tthis.inBoundsSizeUniform[1] = this._emitter.prevWorldBoundsSize.y;\n\t\tthis.inBoundsSizeUniform[2] = this._emitter.prevWorldBoundsSize.z;\n\t\tthis.constantInBoundsSize.setValue(this.inBoundsSizeUniform);\n\t\tthis.inBoundsCenterUniform[0] = this._emitter.prevWorldBoundsCenter.x;\n\t\tthis.inBoundsCenterUniform[1] = this._emitter.prevWorldBoundsCenter.y;\n\t\tthis.inBoundsCenterUniform[2] = this._emitter.prevWorldBoundsCenter.z;\n\t\tthis.constantInBoundsCenter.setValue(this.inBoundsCenterUniform);\n\t}\n\trandomize() {\n\t\tthis.frameRandomUniform[0] = Math.random();\n\t\tthis.frameRandomUniform[1] = Math.random();\n\t\tthis.frameRandomUniform[2] = Math.random();\n\t}\n\tupdate(device, spawnMatrix, extentsInnerRatioUniform, delta, isOnStop) {\n\t\tconst emitter = this._emitter;\n\t\tdevice.setBlendState(BlendState.NOBLEND);\n\t\tdevice.setDepthState(DepthState.NODEPTH);\n\t\tdevice.setCullMode(CULLFACE_NONE);\n\t\tthis.randomize();\n\t\tthis.constantGraphSampleSize.setValue(1.0 / emitter.precision);\n\t\tthis.constantGraphNumSamples.setValue(emitter.precision);\n\t\tthis.constantNumParticles.setValue(emitter.numParticles);\n\t\tthis.constantNumParticlesPot.setValue(emitter.numParticlesPot);\n\t\tthis.constantInternalTex0.setValue(emitter.internalTex0);\n\t\tthis.constantInternalTex1.setValue(emitter.internalTex1);\n\t\tthis.constantInternalTex2.setValue(emitter.internalTex2);\n\t\tthis.constantInternalTex3.setValue(emitter.internalTex3);\n\t\tconst node = emitter.meshInstance.node;\n\t\tconst emitterScale = node === null ? Vec3.ONE : node.localScale;\n\t\tif (emitter.pack8) {\n\t\t\tthis.worldBoundsMulUniform[0] = emitter.worldBoundsMul.x;\n\t\t\tthis.worldBoundsMulUniform[1] = emitter.worldBoundsMul.y;\n\t\t\tthis.worldBoundsMulUniform[2] = emitter.worldBoundsMul.z;\n\t\t\tthis.constantOutBoundsMul.setValue(this.worldBoundsMulUniform);\n\t\t\tthis.worldBoundsAddUniform[0] = emitter.worldBoundsAdd.x;\n\t\t\tthis.worldBoundsAddUniform[1] = emitter.worldBoundsAdd.y;\n\t\t\tthis.worldBoundsAddUniform[2] = emitter.worldBoundsAdd.z;\n\t\t\tthis.constantOutBoundsAdd.setValue(this.worldBoundsAddUniform);\n\t\t\tthis._setInputBounds();\n\t\t\tlet maxVel = emitter.maxVel * Math.max(Math.max(emitterScale.x, emitterScale.y), emitterScale.z);\n\t\t\tmaxVel = Math.max(maxVel, 1);\n\t\t\tthis.constantMaxVel.setValue(maxVel);\n\t\t}\n\t\tconst emitterPos = node === null || emitter.localSpace ? Vec3.ZERO : node.getPosition();\n\t\tconst emitterMatrix = node === null ? Mat4.IDENTITY : node.getWorldTransform();\n\t\tif (emitter.emitterShape === EMITTERSHAPE_BOX) {\n\t\t\tspawnMatrix3.setFromMat4(spawnMatrix);\n\t\t\tthis.constantSpawnBounds.setValue(spawnMatrix3.data);\n\t\t\tthis.constantSpawnPosInnerRatio.setValue(extentsInnerRatioUniform);\n\t\t} else {\n\t\t\tthis.constantSpawnBoundsSphere.setValue(emitter.emitterRadius);\n\t\t\tthis.constantSpawnBoundsSphereInnerRatio.setValue(emitter.emitterRadius === 0 ? 0 : emitter.emitterRadiusInner / emitter.emitterRadius);\n\t\t}\n\t\tthis.constantInitialVelocity.setValue(emitter.initialVelocity);\n\t\temitterMatrix3.setFromMat4(emitterMatrix);\n\t\temitterMatrix3Inv.invertMat4(emitterMatrix);\n\t\tthis.emitterPosUniform[0] = emitterPos.x;\n\t\tthis.emitterPosUniform[1] = emitterPos.y;\n\t\tthis.emitterPosUniform[2] = emitterPos.z;\n\t\tthis.constantEmitterPos.setValue(this.emitterPosUniform);\n\t\tthis.constantFrameRandom.setValue(this.frameRandomUniform);\n\t\tthis.constantDelta.setValue(delta);\n\t\tthis.constantRate.setValue(emitter.rate);\n\t\tthis.constantRateDiv.setValue(emitter.rate2 - emitter.rate);\n\t\tthis.constantStartAngle.setValue(emitter.startAngle * math.DEG_TO_RAD);\n\t\tthis.constantStartAngle2.setValue(emitter.startAngle2 * math.DEG_TO_RAD);\n\t\tthis.constantSeed.setValue(emitter.seed);\n\t\tthis.constantLifetime.setValue(emitter.lifetime);\n\t\tthis.emitterScaleUniform[0] = emitterScale.x;\n\t\tthis.emitterScaleUniform[1] = emitterScale.y;\n\t\tthis.emitterScaleUniform[2] = emitterScale.z;\n\t\tthis.constantEmitterScale.setValue(this.emitterScaleUniform);\n\t\tthis.constantEmitterMatrix.setValue(emitterMatrix3.data);\n\t\tthis.constantEmitterMatrixInv.setValue(emitterMatrix3Inv.data);\n\t\tthis.constantLocalVelocityDivMult.setValue(emitter.localVelocityUMax);\n\t\tthis.constantVelocityDivMult.setValue(emitter.velocityUMax);\n\t\tthis.constantRotSpeedDivMult.setValue(emitter.rotSpeedUMax[0]);\n\t\tlet texIN = emitter.swapTex ? emitter.particleTexOUT : emitter.particleTexIN;\n\t\ttexIN = emitter.beenReset ? emitter.particleTexStart : texIN;\n\t\tconst texOUT = emitter.swapTex ? emitter.particleTexIN : emitter.particleTexOUT;\n\t\tthis.constantParticleTexIN.setValue(texIN);\n\t\tdrawQuadWithShader(device, emitter.swapTex ? emitter.rtParticleTexIN : emitter.rtParticleTexOUT, !isOnStop ? emitter.loop ? emitter.shaderParticleUpdateRespawn : emitter.shaderParticleUpdateNoRespawn : emitter.shaderParticleUpdateOnStop);\n\t\temitter.material.setParameter('particleTexOUT', texIN);\n\t\temitter.material.setParameter('particleTexIN', texOUT);\n\t\temitter.beenReset = false;\n\t\temitter.swapTex = !emitter.swapTex;\n\t\temitter.prevWorldBoundsSize.copy(emitter.worldBoundsSize);\n\t\temitter.prevWorldBoundsCenter.copy(emitter.worldBounds.center);\n\t\tif (emitter.pack8) this._setInputBounds();\n\t}\n}\n\nexport { ParticleGPUUpdater };\n","import '../../core/tracing.js';\nimport '../../core/time.js';\nimport { Curve } from '../../core/math/curve.js';\nimport { CurveSet } from '../../core/math/curve-set.js';\nimport { Mat4 } from '../../core/math/mat4.js';\nimport { math } from '../../core/math/math.js';\nimport { Quat } from '../../core/math/quat.js';\nimport { Vec3 } from '../../core/math/vec3.js';\nimport { BoundingBox } from '../../core/shape/bounding-box.js';\nimport { FILTER_LINEAR, PRIMITIVE_TRIANGLES, CULLFACE_NONE, BUFFER_DYNAMIC, INDEXFORMAT_UINT16, SEMANTIC_ATTR0, TYPE_FLOAT32, SEMANTIC_ATTR1, SEMANTIC_ATTR2, SEMANTIC_ATTR3, SEMANTIC_ATTR4, SEMANTIC_TEXCOORD0, ADDRESS_CLAMP_TO_EDGE, PIXELFORMAT_RGBA8, PIXELFORMAT_RGBA32F, FILTER_NEAREST } from '../../platform/graphics/constants.js';\nimport { DeviceCache } from '../../platform/graphics/device-cache.js';\nimport { IndexBuffer } from '../../platform/graphics/index-buffer.js';\nimport { RenderTarget } from '../../platform/graphics/render-target.js';\nimport { Texture } from '../../platform/graphics/texture.js';\nimport { VertexBuffer } from '../../platform/graphics/vertex-buffer.js';\nimport { VertexFormat } from '../../platform/graphics/vertex-format.js';\nimport { ShaderProcessorOptions } from '../../platform/graphics/shader-processor-options.js';\nimport { EMITTERSHAPE_BOX, PARTICLESORT_NONE, SHADER_FORWARD, PARTICLEORIENTATION_SCREEN, PARTICLEORIENTATION_WORLD, PARTICLEMODE_GPU, BLEND_NORMAL } from '../constants.js';\nimport { Mesh } from '../mesh.js';\nimport { MeshInstance } from '../mesh-instance.js';\nimport { Material } from '../materials/material.js';\nimport { getProgramLibrary } from '../shader-lib/get-program-library.js';\nimport { createShaderFromCode } from '../shader-lib/utils.js';\nimport { shaderChunks } from '../shader-lib/chunks/chunks.js';\nimport { particle } from '../shader-lib/programs/particle.js';\nimport { ParticleCPUUpdater } from './cpu-updater.js';\nimport { ParticleGPUUpdater } from './gpu-updater.js';\n\nconst particleVerts = [[-1, -1], [1, -1], [1, 1], [-1, 1]];\nfunction _createTexture(device, width, height, pixelData, format = PIXELFORMAT_RGBA32F, mult8Bit, filter) {\n\tlet mipFilter = FILTER_NEAREST;\n\tif (filter && format === PIXELFORMAT_RGBA8) mipFilter = FILTER_LINEAR;\n\tconst texture = new Texture(device, {\n\t\twidth: width,\n\t\theight: height,\n\t\tformat: format,\n\t\tcubemap: false,\n\t\tmipmaps: false,\n\t\tminFilter: mipFilter,\n\t\tmagFilter: mipFilter,\n\t\taddressU: ADDRESS_CLAMP_TO_EDGE,\n\t\taddressV: ADDRESS_CLAMP_TO_EDGE,\n\t\tname: 'ParticleSystemTexture'\n\t});\n\tconst pixels = texture.lock();\n\tif (format === PIXELFORMAT_RGBA8) {\n\t\tconst temp = new Uint8Array(pixelData.length);\n\t\tfor (let i = 0; i < pixelData.length; i++) {\n\t\t\ttemp[i] = pixelData[i] * mult8Bit * 255;\n\t\t}\n\t\tpixelData = temp;\n\t}\n\tpixels.set(pixelData);\n\ttexture.unlock();\n\treturn texture;\n}\nfunction saturate(x) {\n\treturn Math.max(Math.min(x, 1), 0);\n}\nconst default0Curve = new Curve([0, 0, 1, 0]);\nconst default1Curve = new Curve([0, 1, 1, 1]);\nconst default0Curve3 = new CurveSet([0, 0, 1, 0], [0, 0, 1, 0], [0, 0, 1, 0]);\nconst default1Curve3 = new CurveSet([0, 1, 1, 1], [0, 1, 1, 1], [0, 1, 1, 1]);\nlet particleTexHeight = 2;\nconst particleTexChannels = 4;\nconst extentsInnerRatioUniform = new Float32Array(3);\nconst spawnMatrix = new Mat4();\nconst tmpVec3 = new Vec3();\nconst bMin = new Vec3();\nconst bMax = new Vec3();\nlet setPropertyTarget;\nlet setPropertyOptions;\nfunction setProperty(pName, defaultVal) {\n\tif (setPropertyOptions[pName] !== undefined && setPropertyOptions[pName] !== null) {\n\t\tsetPropertyTarget[pName] = setPropertyOptions[pName];\n\t} else {\n\t\tsetPropertyTarget[pName] = defaultVal;\n\t}\n}\nfunction pack3NFloats(a, b, c) {\n\tconst packed = a * 255 << 16 | b * 255 << 8 | c * 255;\n\treturn packed / (1 << 24);\n}\nfunction packTextureXYZ_NXYZ(qXYZ, qXYZ2) {\n\tconst num = qXYZ.length / 3;\n\tconst colors = new Array(num * 4);\n\tfor (let i = 0; i < num; i++) {\n\t\tcolors[i * 4] = qXYZ[i * 3];\n\t\tcolors[i * 4 + 1] = qXYZ[i * 3 + 1];\n\t\tcolors[i * 4 + 2] = qXYZ[i * 3 + 2];\n\t\tcolors[i * 4 + 3] = pack3NFloats(qXYZ2[i * 3], qXYZ2[i * 3 + 1], qXYZ2[i * 3 + 2]);\n\t}\n\treturn colors;\n}\nfunction packTextureRGBA(qRGB, qA) {\n\tconst colors = new Array(qA.length * 4);\n\tfor (let i = 0; i < qA.length; i++) {\n\t\tcolors[i * 4] = qRGB[i * 3];\n\t\tcolors[i * 4 + 1] = qRGB[i * 3 + 1];\n\t\tcolors[i * 4 + 2] = qRGB[i * 3 + 2];\n\t\tcolors[i * 4 + 3] = qA[i];\n\t}\n\treturn colors;\n}\nfunction packTexture5Floats(qA, qB, qC, qD, qE) {\n\tconst colors = new Array(qA.length * 4);\n\tfor (let i = 0; i < qA.length; i++) {\n\t\tcolors[i * 4] = qA[i];\n\t\tcolors[i * 4 + 1] = qB[i];\n\t\tcolors[i * 4 + 2] = 0;\n\t\tcolors[i * 4 + 3] = pack3NFloats(qC[i], qD[i], qE[i]);\n\t}\n\treturn colors;\n}\nfunction packTexture2Floats(qA, qB) {\n\tconst colors = new Array(qA.length * 4);\n\tfor (let i = 0; i < qA.length; i++) {\n\t\tcolors[i * 4] = qA[i];\n\t\tcolors[i * 4 + 1] = qB[i];\n\t\tcolors[i * 4 + 2] = 0;\n\t\tcolors[i * 4 + 3] = 0;\n\t}\n\treturn colors;\n}\nfunction calcEndTime(emitter) {\n\tconst interval = Math.max(emitter.rate, emitter.rate2) * emitter.numParticles + emitter.lifetime;\n\treturn Date.now() + interval * 1000;\n}\nfunction subGraph(A, B) {\n\tconst r = new Float32Array(A.length);\n\tfor (let i = 0; i < A.length; i++) {\n\t\tr[i] = A[i] - B[i];\n\t}\n\treturn r;\n}\nfunction maxUnsignedGraphValue(A, outUMax) {\n\tconst chans = outUMax.length;\n\tconst values = A.length / chans;\n\tfor (let i = 0; i < values; i++) {\n\t\tfor (let j = 0; j < chans; j++) {\n\t\t\tconst a = Math.abs(A[i * chans + j]);\n\t\t\toutUMax[j] = Math.max(outUMax[j], a);\n\t\t}\n\t}\n}\nfunction normalizeGraph(A, uMax) {\n\tconst chans = uMax.length;\n\tconst values = A.length / chans;\n\tfor (let i = 0; i < values; i++) {\n\t\tfor (let j = 0; j < chans; j++) {\n\t\t\tA[i * chans + j] /= uMax[j] === 0 ? 1 : uMax[j];\n\t\t\tA[i * chans + j] *= 0.5;\n\t\t\tA[i * chans + j] += 0.5;\n\t\t}\n\t}\n}\nfunction divGraphFrom2Curves(curve1, curve2, outUMax) {\n\tconst sub = subGraph(curve2, curve1);\n\tmaxUnsignedGraphValue(sub, outUMax);\n\tnormalizeGraph(sub, outUMax);\n\treturn sub;\n}\nconst particleEmitterDeviceCache = new DeviceCache();\nclass ParticleEmitter {\n\tconstructor(graphicsDevice, options) {\n\t\tthis.graphicsDevice = graphicsDevice;\n\t\tconst gd = graphicsDevice;\n\t\tconst precision = 32;\n\t\tthis.precision = precision;\n\t\tthis._addTimeTime = 0;\n\t\tsetPropertyTarget = this;\n\t\tsetPropertyOptions = options;\n\t\tsetProperty('numParticles', 1);\n\t\tif (this.numParticles > graphicsDevice.maxTextureSize) {\n\t\t\tthis.numParticles = graphicsDevice.maxTextureSize;\n\t\t}\n\t\tsetProperty('rate', 1);\n\t\tsetProperty('rate2', this.rate);\n\t\tsetProperty('lifetime', 50);\n\t\tsetProperty('emitterExtents', new Vec3(0, 0, 0));\n\t\tsetProperty('emitterExtentsInner', new Vec3(0, 0, 0));\n\t\tsetProperty('emitterRadius', 0);\n\t\tsetProperty('emitterRadiusInner', 0);\n\t\tsetProperty('emitterShape', EMITTERSHAPE_BOX);\n\t\tsetProperty('initialVelocity', 1);\n\t\tsetProperty('wrap', false);\n\t\tsetProperty('localSpace', false);\n\t\tsetProperty('screenSpace', false);\n\t\tsetProperty('wrapBounds', null);\n\t\tsetProperty('colorMap', this.defaultParamTexture);\n\t\tsetProperty('normalMap', null);\n\t\tsetProperty('loop', true);\n\t\tsetProperty('preWarm', false);\n\t\tsetProperty('sort', PARTICLESORT_NONE);\n\t\tsetProperty('mode', PARTICLEMODE_GPU);\n\t\tsetProperty('scene', null);\n\t\tsetProperty('lighting', false);\n\t\tsetProperty('halfLambert', false);\n\t\tsetProperty('intensity', 1.0);\n\t\tsetProperty('stretch', 0.0);\n\t\tsetProperty('alignToMotion', false);\n\t\tsetProperty('depthSoftening', 0);\n\t\tsetProperty('mesh', null);\n\t\tsetProperty('particleNormal', new Vec3(0, 1, 0));\n\t\tsetProperty('orientation', PARTICLEORIENTATION_SCREEN);\n\t\tsetProperty('depthWrite', false);\n\t\tsetProperty('noFog', false);\n\t\tsetProperty('blendType', BLEND_NORMAL);\n\t\tsetProperty('node', null);\n\t\tsetProperty('startAngle', 0);\n\t\tsetProperty('startAngle2', this.startAngle);\n\t\tsetProperty('animTilesX', 1);\n\t\tsetProperty('animTilesY', 1);\n\t\tsetProperty('animStartFrame', 0);\n\t\tsetProperty('animNumFrames', 1);\n\t\tsetProperty('animNumAnimations', 1);\n\t\tsetProperty('animIndex', 0);\n\t\tsetProperty('randomizeAnimIndex', false);\n\t\tsetProperty('animSpeed', 1);\n\t\tsetProperty('animLoop', true);\n\t\tthis._gpuUpdater = new ParticleGPUUpdater(this, gd);\n\t\tthis._cpuUpdater = new ParticleCPUUpdater(this);\n\t\tthis.emitterPosUniform = new Float32Array(3);\n\t\tthis.wrapBoundsUniform = new Float32Array(3);\n\t\tthis.emitterScaleUniform = new Float32Array([1, 1, 1]);\n\t\tsetProperty('colorGraph', default1Curve3);\n\t\tsetProperty('colorGraph2', this.colorGraph);\n\t\tsetProperty('scaleGraph', default1Curve);\n\t\tsetProperty('scaleGraph2', this.scaleGraph);\n\t\tsetProperty('alphaGraph', default1Curve);\n\t\tsetProperty('alphaGraph2', this.alphaGraph);\n\t\tsetProperty('localVelocityGraph', default0Curve3);\n\t\tsetProperty('localVelocityGraph2', this.localVelocityGraph);\n\t\tsetProperty('velocityGraph', default0Curve3);\n\t\tsetProperty('velocityGraph2', this.velocityGraph);\n\t\tsetProperty('rotationSpeedGraph', default0Curve);\n\t\tsetProperty('rotationSpeedGraph2', this.rotationSpeedGraph);\n\t\tsetProperty('radialSpeedGraph', default0Curve);\n\t\tsetProperty('radialSpeedGraph2', this.radialSpeedGraph);\n\t\tthis.animTilesParams = new Float32Array(2);\n\t\tthis.animParams = new Float32Array(4);\n\t\tthis.animIndexParams = new Float32Array(2);\n\t\tthis.internalTex0 = null;\n\t\tthis.internalTex1 = null;\n\t\tthis.internalTex2 = null;\n\t\tthis.colorParam = null;\n\t\tthis.vbToSort = null;\n\t\tthis.vbOld = null;\n\t\tthis.particleDistance = null;\n\t\tthis.camera = null;\n\t\tthis.swapTex = false;\n\t\tthis.useMesh = true;\n\t\tthis.useCpu = !graphicsDevice.supportsGpuParticles;\n\t\tthis.pack8 = true;\n\t\tthis.localBounds = new BoundingBox();\n\t\tthis.worldBoundsNoTrail = new BoundingBox();\n\t\tthis.worldBoundsTrail = [new BoundingBox(), new BoundingBox()];\n\t\tthis.worldBounds = new BoundingBox();\n\t\tthis.worldBoundsSize = new Vec3();\n\t\tthis.prevWorldBoundsSize = new Vec3();\n\t\tthis.prevWorldBoundsCenter = new Vec3();\n\t\tthis.prevEmitterExtents = this.emitterExtents;\n\t\tthis.prevEmitterRadius = this.emitterRadius;\n\t\tthis.worldBoundsMul = new Vec3();\n\t\tthis.worldBoundsAdd = new Vec3();\n\t\tthis.timeToSwitchBounds = 0;\n\t\tthis.shaderParticleUpdateRespawn = null;\n\t\tthis.shaderParticleUpdateNoRespawn = null;\n\t\tthis.shaderParticleUpdateOnStop = null;\n\t\tthis.numParticleVerts = 0;\n\t\tthis.numParticleIndices = 0;\n\t\tthis.material = null;\n\t\tthis.meshInstance = null;\n\t\tthis.drawOrder = 0;\n\t\tthis.seed = Math.random();\n\t\tthis.fixedTimeStep = 1.0 / 60;\n\t\tthis.maxSubSteps = 10;\n\t\tthis.simTime = 0;\n\t\tthis.simTimeTotal = 0;\n\t\tthis.beenReset = false;\n\t\tthis._layer = null;\n\t\tthis.rebuild();\n\t}\n\tget defaultParamTexture() {\n\t\treturn particleEmitterDeviceCache.get(this.graphicsDevice, () => {\n\t\t\tconst resolution = 16;\n\t\t\tconst centerPoint = resolution * 0.5 + 0.5;\n\t\t\tconst dtex = new Float32Array(resolution * resolution * 4);\n\t\t\tfor (let y = 0; y < resolution; y++) {\n\t\t\t\tfor (let x = 0; x < resolution; x++) {\n\t\t\t\t\tconst xgrad = x + 1 - centerPoint;\n\t\t\t\t\tconst ygrad = y + 1 - centerPoint;\n\t\t\t\t\tconst c = saturate(1 - saturate(Math.sqrt(xgrad * xgrad + ygrad * ygrad) / resolution) - 0.5);\n\t\t\t\t\tconst p = y * resolution + x;\n\t\t\t\t\tdtex[p * 4] = 1;\n\t\t\t\t\tdtex[p * 4 + 1] = 1;\n\t\t\t\t\tdtex[p * 4 + 2] = 1;\n\t\t\t\t\tdtex[p * 4 + 3] = c;\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst texture = _createTexture(this.graphicsDevice, resolution, resolution, dtex, PIXELFORMAT_RGBA8, 1.0, true);\n\t\t\ttexture.minFilter = FILTER_LINEAR;\n\t\t\ttexture.magFilter = FILTER_LINEAR;\n\t\t\treturn texture;\n\t\t});\n\t}\n\tonChangeCamera() {\n\t\tthis.regenShader();\n\t\tthis.resetMaterial();\n\t}\n\tcalculateBoundsMad() {\n\t\tthis.worldBoundsMul.x = 1.0 / this.worldBoundsSize.x;\n\t\tthis.worldBoundsMul.y = 1.0 / this.worldBoundsSize.y;\n\t\tthis.worldBoundsMul.z = 1.0 / this.worldBoundsSize.z;\n\t\tthis.worldBoundsAdd.copy(this.worldBounds.center).mul(this.worldBoundsMul).mulScalar(-1);\n\t\tthis.worldBoundsAdd.x += 0.5;\n\t\tthis.worldBoundsAdd.y += 0.5;\n\t\tthis.worldBoundsAdd.z += 0.5;\n\t}\n\tcalculateWorldBounds() {\n\t\tif (!this.node) return;\n\t\tthis.prevWorldBoundsSize.copy(this.worldBoundsSize);\n\t\tthis.prevWorldBoundsCenter.copy(this.worldBounds.center);\n\t\tif (!this.useCpu) {\n\t\t\tlet recalculateLocalBounds = false;\n\t\t\tif (this.emitterShape === EMITTERSHAPE_BOX) {\n\t\t\t\trecalculateLocalBounds = !this.emitterExtents.equals(this.prevEmitterExtents);\n\t\t\t} else {\n\t\t\t\trecalculateLocalBounds = !(this.emitterRadius === this.prevEmitterRadius);\n\t\t\t}\n\t\t\tif (recalculateLocalBounds) {\n\t\t\t\tthis.calculateLocalBounds();\n\t\t\t}\n\t\t}\n\t\tconst nodeWT = this.node.getWorldTransform();\n\t\tif (this.localSpace) {\n\t\t\tthis.worldBoundsNoTrail.copy(this.localBounds);\n\t\t} else {\n\t\t\tthis.worldBoundsNoTrail.setFromTransformedAabb(this.localBounds, nodeWT);\n\t\t}\n\t\tthis.worldBoundsTrail[0].add(this.worldBoundsNoTrail);\n\t\tthis.worldBoundsTrail[1].add(this.worldBoundsNoTrail);\n\t\tconst now = this.simTimeTotal;\n\t\tif (now >= this.timeToSwitchBounds) {\n\t\t\tthis.worldBoundsTrail[0].copy(this.worldBoundsTrail[1]);\n\t\t\tthis.worldBoundsTrail[1].copy(this.worldBoundsNoTrail);\n\t\t\tthis.timeToSwitchBounds = now + this.lifetime;\n\t\t}\n\t\tthis.worldBounds.copy(this.worldBoundsTrail[0]);\n\t\tthis.worldBoundsSize.copy(this.worldBounds.halfExtents).mulScalar(2);\n\t\tif (this.localSpace) {\n\t\t\tthis.meshInstance.aabb.setFromTransformedAabb(this.worldBounds, nodeWT);\n\t\t\tthis.meshInstance.mesh.aabb.setFromTransformedAabb(this.worldBounds, nodeWT);\n\t\t} else {\n\t\t\tthis.meshInstance.aabb.copy(this.worldBounds);\n\t\t\tthis.meshInstance.mesh.aabb.copy(this.worldBounds);\n\t\t}\n\t\tthis.meshInstance._aabbVer = 1 - this.meshInstance._aabbVer;\n\t\tif (this.pack8) this.calculateBoundsMad();\n\t}\n\tresetWorldBounds() {\n\t\tif (!this.node) return;\n\t\tthis.worldBoundsNoTrail.setFromTransformedAabb(this.localBounds, this.localSpace ? Mat4.IDENTITY : this.node.getWorldTransform());\n\t\tthis.worldBoundsTrail[0].copy(this.worldBoundsNoTrail);\n\t\tthis.worldBoundsTrail[1].copy(this.worldBoundsNoTrail);\n\t\tthis.worldBounds.copy(this.worldBoundsTrail[0]);\n\t\tthis.worldBoundsSize.copy(this.worldBounds.halfExtents).mulScalar(2);\n\t\tthis.prevWorldBoundsSize.copy(this.worldBoundsSize);\n\t\tthis.prevWorldBoundsCenter.copy(this.worldBounds.center);\n\t\tthis.simTimeTotal = 0;\n\t\tthis.timeToSwitchBounds = 0;\n\t}\n\tcalculateLocalBounds() {\n\t\tlet minx = Number.MAX_VALUE;\n\t\tlet miny = Number.MAX_VALUE;\n\t\tlet minz = Number.MAX_VALUE;\n\t\tlet maxx = -Number.MAX_VALUE;\n\t\tlet maxy = -Number.MAX_VALUE;\n\t\tlet maxz = -Number.MAX_VALUE;\n\t\tlet maxR = 0;\n\t\tlet maxScale = 0;\n\t\tconst stepWeight = this.lifetime / this.precision;\n\t\tconst wVels = [this.qVelocity, this.qVelocity2];\n\t\tconst lVels = [this.qLocalVelocity, this.qLocalVelocity2];\n\t\tconst accumX = [0, 0];\n\t\tconst accumY = [0, 0];\n\t\tconst accumZ = [0, 0];\n\t\tconst accumR = [0, 0];\n\t\tconst accumW = [0, 0];\n\t\tlet x, y, z;\n\t\tfor (let i = 0; i < this.precision + 1; i++) {\n\t\t\tconst index = Math.min(i, this.precision - 1);\n\t\t\tfor (let j = 0; j < 2; j++) {\n\t\t\t\tx = lVels[j][index * 3 + 0] * stepWeight + accumX[j];\n\t\t\t\ty = lVels[j][index * 3 + 1] * stepWeight + accumY[j];\n\t\t\t\tz = lVels[j][index * 3 + 2] * stepWeight + accumZ[j];\n\t\t\t\tminx = Math.min(x, minx);\n\t\t\t\tminy = Math.min(y, miny);\n\t\t\t\tminz = Math.min(z, minz);\n\t\t\t\tmaxx = Math.max(x, maxx);\n\t\t\t\tmaxy = Math.max(y, maxy);\n\t\t\t\tmaxz = Math.max(z, maxz);\n\t\t\t\taccumX[j] = x;\n\t\t\t\taccumY[j] = y;\n\t\t\t\taccumZ[j] = z;\n\t\t\t}\n\t\t\tfor (let j = 0; j < 2; j++) {\n\t\t\t\taccumW[j] += stepWeight * Math.sqrt(wVels[j][index * 3 + 0] * wVels[j][index * 3 + 0] + wVels[j][index * 3 + 1] * wVels[j][index * 3 + 1] + wVels[j][index * 3 + 2] * wVels[j][index * 3 + 2]);\n\t\t\t}\n\t\t\taccumR[0] += this.qRadialSpeed[index] * stepWeight;\n\t\t\taccumR[1] += this.qRadialSpeed2[index] * stepWeight;\n\t\t\tmaxR = Math.max(maxR, Math.max(Math.abs(accumR[0]), Math.abs(accumR[1])));\n\t\t\tmaxScale = Math.max(maxScale, this.qScale[index]);\n\t\t}\n\t\tif (this.emitterShape === EMITTERSHAPE_BOX) {\n\t\t\tx = this.emitterExtents.x * 0.5;\n\t\t\ty = this.emitterExtents.y * 0.5;\n\t\t\tz = this.emitterExtents.z * 0.5;\n\t\t} else {\n\t\t\tx = this.emitterRadius;\n\t\t\ty = this.emitterRadius;\n\t\t\tz = this.emitterRadius;\n\t\t}\n\t\tconst w = Math.max(accumW[0], accumW[1]);\n\t\tbMin.x = minx - maxScale - x - maxR - w;\n\t\tbMin.y = miny - maxScale - y - maxR - w;\n\t\tbMin.z = minz - maxScale - z - maxR - w;\n\t\tbMax.x = maxx + maxScale + x + maxR + w;\n\t\tbMax.y = maxy + maxScale + y + maxR + w;\n\t\tbMax.z = maxz + maxScale + z + maxR + w;\n\t\tthis.localBounds.setMinMax(bMin, bMax);\n\t}\n\trebuild() {\n\t\tconst gd = this.graphicsDevice;\n\t\tif (this.colorMap === null) this.colorMap = this.defaultParamTexture;\n\t\tthis.spawnBounds = this.emitterShape === EMITTERSHAPE_BOX ? this.emitterExtents : this.emitterRadius;\n\t\tthis.useCpu = this.useCpu || this.sort > PARTICLESORT_NONE || gd.maxVertexTextures <= 1 || gd.fragmentUniformsCount < 64 || gd.forceCpuParticles || !gd.extTextureFloat;\n\t\tthis._destroyResources();\n\t\tthis.pack8 = (this.pack8 || !gd.textureFloatRenderable) && !this.useCpu;\n\t\tparticleTexHeight = this.useCpu || this.pack8 ? 4 : 2;\n\t\tthis.useMesh = false;\n\t\tif (this.mesh) {\n\t\t\tconst totalVertCount = this.numParticles * this.mesh.vertexBuffer.numVertices;\n\t\t\tif (totalVertCount > 65535) ; else {\n\t\t\t\tthis.useMesh = true;\n\t\t\t}\n\t\t}\n\t\tthis.numParticlesPot = math.nextPowerOfTwo(this.numParticles);\n\t\tthis.rebuildGraphs();\n\t\tthis.calculateLocalBounds();\n\t\tthis.resetWorldBounds();\n\t\tif (this.node) {\n\t\t\tthis.worldBounds.setFromTransformedAabb(this.localBounds, this.localSpace ? Mat4.IDENTITY : this.node.getWorldTransform());\n\t\t\tthis.worldBoundsTrail[0].copy(this.worldBounds);\n\t\t\tthis.worldBoundsTrail[1].copy(this.worldBounds);\n\t\t\tthis.worldBoundsSize.copy(this.worldBounds.halfExtents).mulScalar(2);\n\t\t\tthis.prevWorldBoundsSize.copy(this.worldBoundsSize);\n\t\t\tthis.prevWorldBoundsCenter.copy(this.worldBounds.center);\n\t\t\tif (this.pack8) this.calculateBoundsMad();\n\t\t}\n\t\tthis.vbToSort = new Array(this.numParticles);\n\t\tfor (let iSort = 0; iSort < this.numParticles; iSort++) this.vbToSort[iSort] = [0, 0];\n\t\tthis.particleDistance = new Float32Array(this.numParticles);\n\t\tthis._gpuUpdater.randomize();\n\t\tthis.particleTex = new Float32Array(this.numParticlesPot * particleTexHeight * particleTexChannels);\n\t\tconst emitterPos = this.node === null || this.localSpace ? Vec3.ZERO : this.node.getPosition();\n\t\tif (this.emitterShape === EMITTERSHAPE_BOX) {\n\t\t\tif (this.node === null || this.localSpace) {\n\t\t\t\tspawnMatrix.setTRS(Vec3.ZERO, Quat.IDENTITY, this.spawnBounds);\n\t\t\t} else {\n\t\t\t\tspawnMatrix.setTRS(Vec3.ZERO, this.node.getRotation(), tmpVec3.copy(this.spawnBounds).mul(this.node.localScale));\n\t\t\t}\n\t\t\textentsInnerRatioUniform[0] = this.emitterExtents.x !== 0 ? this.emitterExtentsInner.x / this.emitterExtents.x : 0;\n\t\t\textentsInnerRatioUniform[1] = this.emitterExtents.y !== 0 ? this.emitterExtentsInner.y / this.emitterExtents.y : 0;\n\t\t\textentsInnerRatioUniform[2] = this.emitterExtents.z !== 0 ? this.emitterExtentsInner.z / this.emitterExtents.z : 0;\n\t\t}\n\t\tfor (let i = 0; i < this.numParticles; i++) {\n\t\t\tthis._cpuUpdater.calcSpawnPosition(this.particleTex, spawnMatrix, extentsInnerRatioUniform, emitterPos, i);\n\t\t\tif (this.useCpu) this.particleTex[i * particleTexChannels + 3 + this.numParticlesPot * 2 * particleTexChannels] = 1;\n\t\t}\n\t\tthis.particleTexStart = new Float32Array(this.numParticlesPot * particleTexHeight * particleTexChannels);\n\t\tfor (let i = 0; i < this.particleTexStart.length; i++) {\n\t\t\tthis.particleTexStart[i] = this.particleTex[i];\n\t\t}\n\t\tif (!this.useCpu) {\n\t\t\tif (this.pack8) {\n\t\t\t\tthis.particleTexIN = _createTexture(gd, this.numParticlesPot, particleTexHeight, this.particleTex, PIXELFORMAT_RGBA8, 1, false);\n\t\t\t\tthis.particleTexOUT = _createTexture(gd, this.numParticlesPot, particleTexHeight, this.particleTex, PIXELFORMAT_RGBA8, 1, false);\n\t\t\t\tthis.particleTexStart = _createTexture(gd, this.numParticlesPot, particleTexHeight, this.particleTexStart, PIXELFORMAT_RGBA8, 1, false);\n\t\t\t} else {\n\t\t\t\tthis.particleTexIN = _createTexture(gd, this.numParticlesPot, particleTexHeight, this.particleTex);\n\t\t\t\tthis.particleTexOUT = _createTexture(gd, this.numParticlesPot, particleTexHeight, this.particleTex);\n\t\t\t\tthis.particleTexStart = _createTexture(gd, this.numParticlesPot, particleTexHeight, this.particleTexStart);\n\t\t\t}\n\t\t\tthis.rtParticleTexIN = new RenderTarget({\n\t\t\t\tcolorBuffer: this.particleTexIN,\n\t\t\t\tdepth: false\n\t\t\t});\n\t\t\tthis.rtParticleTexOUT = new RenderTarget({\n\t\t\t\tcolorBuffer: this.particleTexOUT,\n\t\t\t\tdepth: false\n\t\t\t});\n\t\t\tthis.swapTex = false;\n\t\t}\n\t\tconst shaderCodeStart = (this.localSpace ? '#define LOCAL_SPACE\\n' : '') + shaderChunks.particleUpdaterInitPS + (this.pack8 ? shaderChunks.particleInputRgba8PS + shaderChunks.particleOutputRgba8PS : shaderChunks.particleInputFloatPS + shaderChunks.particleOutputFloatPS) + (this.emitterShape === EMITTERSHAPE_BOX ? shaderChunks.particleUpdaterAABBPS : shaderChunks.particleUpdaterSpherePS) + shaderChunks.particleUpdaterStartPS;\n\t\tconst shaderCodeRespawn = shaderCodeStart + shaderChunks.particleUpdaterRespawnPS + shaderChunks.particleUpdaterEndPS;\n\t\tconst shaderCodeNoRespawn = shaderCodeStart + shaderChunks.particleUpdaterNoRespawnPS + shaderChunks.particleUpdaterEndPS;\n\t\tconst shaderCodeOnStop = shaderCodeStart + shaderChunks.particleUpdaterOnStopPS + shaderChunks.particleUpdaterEndPS;\n\t\tconst params = this.emitterShape + '' + this.pack8 + '' + this.localSpace;\n\t\tthis.shaderParticleUpdateRespawn = createShaderFromCode(gd, shaderChunks.fullscreenQuadVS, shaderCodeRespawn, 'fsQuad0' + params);\n\t\tthis.shaderParticleUpdateNoRespawn = createShaderFromCode(gd, shaderChunks.fullscreenQuadVS, shaderCodeNoRespawn, 'fsQuad1' + params);\n\t\tthis.shaderParticleUpdateOnStop = createShaderFromCode(gd, shaderChunks.fullscreenQuadVS, shaderCodeOnStop, 'fsQuad2' + params);\n\t\tthis.numParticleVerts = this.useMesh ? this.mesh.vertexBuffer.numVertices : 4;\n\t\tthis.numParticleIndices = this.useMesh ? this.mesh.indexBuffer[0].numIndices : 6;\n\t\tthis._allocate(this.numParticles);\n\t\tconst mesh = new Mesh(gd);\n\t\tmesh.vertexBuffer = this.vertexBuffer;\n\t\tmesh.indexBuffer[0] = this.indexBuffer;\n\t\tmesh.primitive[0].type = PRIMITIVE_TRIANGLES;\n\t\tmesh.primitive[0].base = 0;\n\t\tmesh.primitive[0].count = this.numParticles * this.numParticleIndices;\n\t\tmesh.primitive[0].indexed = true;\n\t\tthis.material = new Material();\n\t\tthis.material.name = this.node.name;\n\t\tthis.material.cull = CULLFACE_NONE;\n\t\tthis.material.alphaWrite = false;\n\t\tthis.material.blendType = this.blendType;\n\t\tthis.material.depthWrite = this.depthWrite;\n\t\tthis.material.emitter = this;\n\t\tthis.regenShader();\n\t\tthis.resetMaterial();\n\t\tconst wasVisible = this.meshInstance ? this.meshInstance.visible : true;\n\t\tthis.meshInstance = new MeshInstance(mesh, this.material, this.node);\n\t\tthis.meshInstance.pick = false;\n\t\tthis.meshInstance.updateKey();\n\t\tthis.meshInstance.cull = true;\n\t\tthis.meshInstance._noDepthDrawGl1 = true;\n\t\tif (this.localSpace) {\n\t\t\tthis.meshInstance.aabb.setFromTransformedAabb(this.worldBounds, this.node.getWorldTransform());\n\t\t} else {\n\t\t\tthis.meshInstance.aabb.copy(this.worldBounds);\n\t\t}\n\t\tthis.meshInstance._updateAabb = false;\n\t\tthis.meshInstance.visible = wasVisible;\n\t\tthis._initializeTextures();\n\t\tthis.resetTime();\n\t\tthis.addTime(0, false);\n\t\tif (this.preWarm) this.prewarm(this.lifetime);\n\t}\n\t_isAnimated() {\n\t\treturn this.animNumFrames >= 1 && (this.animTilesX > 1 || this.animTilesY > 1) && (this.colorMap && this.colorMap !== this.defaultParamTexture || this.normalMap);\n\t}\n\trebuildGraphs() {\n\t\tconst precision = this.precision;\n\t\tconst gd = this.graphicsDevice;\n\t\tthis.qLocalVelocity = this.localVelocityGraph.quantize(precision);\n\t\tthis.qVelocity = this.velocityGraph.quantize(precision);\n\t\tthis.qColor = this.colorGraph.quantizeClamped(precision, 0, 1);\n\t\tthis.qRotSpeed = this.rotationSpeedGraph.quantize(precision);\n\t\tthis.qScale = this.scaleGraph.quantize(precision);\n\t\tthis.qAlpha = this.alphaGraph.quantize(precision);\n\t\tthis.qRadialSpeed = this.radialSpeedGraph.quantize(precision);\n\t\tthis.qLocalVelocity2 = this.localVelocityGraph2.quantize(precision);\n\t\tthis.qVelocity2 = this.velocityGraph2.quantize(precision);\n\t\tthis.qColor2 = this.colorGraph2.quantizeClamped(precision, 0, 1);\n\t\tthis.qRotSpeed2 = this.rotationSpeedGraph2.quantize(precision);\n\t\tthis.qScale2 = this.scaleGraph2.quantize(precision);\n\t\tthis.qAlpha2 = this.alphaGraph2.quantize(precision);\n\t\tthis.qRadialSpeed2 = this.radialSpeedGraph2.quantize(precision);\n\t\tfor (let i = 0; i < precision; i++) {\n\t\t\tthis.qRotSpeed[i] *= math.DEG_TO_RAD;\n\t\t\tthis.qRotSpeed2[i] *= math.DEG_TO_RAD;\n\t\t}\n\t\tthis.localVelocityUMax = new Float32Array(3);\n\t\tthis.velocityUMax = new Float32Array(3);\n\t\tthis.colorUMax = new Float32Array(3);\n\t\tthis.rotSpeedUMax = [0];\n\t\tthis.scaleUMax = [0];\n\t\tthis.alphaUMax = [0];\n\t\tthis.radialSpeedUMax = [0];\n\t\tthis.qLocalVelocityDiv = divGraphFrom2Curves(this.qLocalVelocity, this.qLocalVelocity2, this.localVelocityUMax);\n\t\tthis.qVelocityDiv = divGraphFrom2Curves(this.qVelocity, this.qVelocity2, this.velocityUMax);\n\t\tthis.qColorDiv = divGraphFrom2Curves(this.qColor, this.qColor2, this.colorUMax);\n\t\tthis.qRotSpeedDiv = divGraphFrom2Curves(this.qRotSpeed, this.qRotSpeed2, this.rotSpeedUMax);\n\t\tthis.qScaleDiv = divGraphFrom2Curves(this.qScale, this.qScale2, this.scaleUMax);\n\t\tthis.qAlphaDiv = divGraphFrom2Curves(this.qAlpha, this.qAlpha2, this.alphaUMax);\n\t\tthis.qRadialSpeedDiv = divGraphFrom2Curves(this.qRadialSpeed, this.qRadialSpeed2, this.radialSpeedUMax);\n\t\tif (this.pack8) {\n\t\t\tconst umax = [0, 0, 0];\n\t\t\tmaxUnsignedGraphValue(this.qVelocity, umax);\n\t\t\tconst umax2 = [0, 0, 0];\n\t\t\tmaxUnsignedGraphValue(this.qVelocity2, umax2);\n\t\t\tconst lumax = [0, 0, 0];\n\t\t\tmaxUnsignedGraphValue(this.qLocalVelocity, lumax);\n\t\t\tconst lumax2 = [0, 0, 0];\n\t\t\tmaxUnsignedGraphValue(this.qLocalVelocity2, lumax2);\n\t\t\tconst rumax = [0];\n\t\t\tmaxUnsignedGraphValue(this.qRadialSpeed, rumax);\n\t\t\tconst rumax2 = [0];\n\t\t\tmaxUnsignedGraphValue(this.qRadialSpeed2, rumax2);\n\t\t\tlet maxVel = Math.max(umax[0], umax2[0]);\n\t\t\tmaxVel = Math.max(maxVel, umax[1]);\n\t\t\tmaxVel = Math.max(maxVel, umax2[1]);\n\t\t\tmaxVel = Math.max(maxVel, umax[2]);\n\t\t\tmaxVel = Math.max(maxVel, umax2[2]);\n\t\t\tlet lmaxVel = Math.max(lumax[0], lumax2[0]);\n\t\t\tlmaxVel = Math.max(lmaxVel, lumax[1]);\n\t\t\tlmaxVel = Math.max(lmaxVel, lumax2[1]);\n\t\t\tlmaxVel = Math.max(lmaxVel, lumax[2]);\n\t\t\tlmaxVel = Math.max(lmaxVel, lumax2[2]);\n\t\t\tconst maxRad = Math.max(rumax[0], rumax2[0]);\n\t\t\tthis.maxVel = maxVel + lmaxVel + maxRad;\n\t\t}\n\t\tif (!this.useCpu) {\n\t\t\tthis.internalTex0 = _createTexture(gd, precision, 1, packTextureXYZ_NXYZ(this.qLocalVelocity, this.qLocalVelocityDiv));\n\t\t\tthis.internalTex1 = _createTexture(gd, precision, 1, packTextureXYZ_NXYZ(this.qVelocity, this.qVelocityDiv));\n\t\t\tthis.internalTex2 = _createTexture(gd, precision, 1, packTexture5Floats(this.qRotSpeed, this.qScale, this.qScaleDiv, this.qRotSpeedDiv, this.qAlphaDiv));\n\t\t\tthis.internalTex3 = _createTexture(gd, precision, 1, packTexture2Floats(this.qRadialSpeed, this.qRadialSpeedDiv));\n\t\t}\n\t\tthis.colorParam = _createTexture(gd, precision, 1, packTextureRGBA(this.qColor, this.qAlpha), PIXELFORMAT_RGBA8, 1.0, true);\n\t}\n\t_initializeTextures() {\n\t\tif (this.colorMap) {\n\t\t\tthis.material.setParameter('colorMap', this.colorMap);\n\t\t\tif (this.lighting && this.normalMap) {\n\t\t\t\tthis.material.setParameter('normalMap', this.normalMap);\n\t\t\t}\n\t\t}\n\t}\n\tregenShader() {\n\t\tconst programLib = getProgramLibrary(this.graphicsDevice);\n\t\tprogramLib.register('particle', particle);\n\t\tconst hasNormal = this.normalMap !== null;\n\t\tthis.normalOption = 0;\n\t\tif (this.lighting) {\n\t\t\tthis.normalOption = hasNormal ? 2 : 1;\n\t\t}\n\t\tthis.material.getShaderVariant = function (dev, sc, defs, unused, pass, sortedLights, viewUniformFormat, viewBindGroupFormat) {\n\t\t\tif (this.emitter.scene) {\n\t\t\t\tif (this.emitter.camera !== this.emitter.scene._activeCamera) {\n\t\t\t\t\tthis.emitter.camera = this.emitter.scene._activeCamera;\n\t\t\t\t\tthis.emitter.onChangeCamera();\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst inTools = this.emitter.inTools;\n\t\t\tconst processingOptions = new ShaderProcessorOptions(viewUniformFormat, viewBindGroupFormat);\n\t\t\tconst shader = programLib.getProgram('particle', {\n\t\t\t\tpass: SHADER_FORWARD,\n\t\t\t\tuseCpu: this.emitter.useCpu,\n\t\t\t\tnormal: this.emitter.normalOption,\n\t\t\t\thalflambert: this.emitter.halfLambert,\n\t\t\t\tstretch: this.emitter.stretch,\n\t\t\t\talignToMotion: this.emitter.alignToMotion,\n\t\t\t\tsoft: this.emitter.depthSoftening,\n\t\t\t\tmesh: this.emitter.useMesh,\n\t\t\t\tgamma: this.emitter.scene ? this.emitter.scene.gammaCorrection : 0,\n\t\t\t\ttoneMap: this.emitter.scene ? this.emitter.scene.toneMapping : 0,\n\t\t\t\tfog: this.emitter.scene && !this.emitter.noFog ? this.emitter.scene.fog : 'none',\n\t\t\t\twrap: this.emitter.wrap && this.emitter.wrapBounds,\n\t\t\t\tlocalSpace: this.emitter.localSpace,\n\t\t\t\tscreenSpace: inTools ? false : this.emitter.screenSpace,\n\t\t\t\tblend: this.blendType,\n\t\t\t\tanimTex: this.emitter._isAnimated(),\n\t\t\t\tanimTexLoop: this.emitter.animLoop,\n\t\t\t\tpack8: this.emitter.pack8,\n\t\t\t\tcustomFace: this.emitter.orientation !== PARTICLEORIENTATION_SCREEN\n\t\t\t}, processingOptions);\n\t\t\treturn shader;\n\t\t};\n\t\tthis.material.shader = this.material.getShaderVariant();\n\t}\n\tresetMaterial() {\n\t\tconst material = this.material;\n\t\tmaterial.setParameter('stretch', this.stretch);\n\t\tif (this._isAnimated()) {\n\t\t\tmaterial.setParameter('animTexTilesParams', this.animTilesParams);\n\t\t\tmaterial.setParameter('animTexParams', this.animParams);\n\t\t\tmaterial.setParameter('animTexIndexParams', this.animIndexParams);\n\t\t}\n\t\tmaterial.setParameter('colorMult', this.intensity);\n\t\tif (!this.useCpu) {\n\t\t\tmaterial.setParameter('internalTex0', this.internalTex0);\n\t\t\tmaterial.setParameter('internalTex1', this.internalTex1);\n\t\t\tmaterial.setParameter('internalTex2', this.internalTex2);\n\t\t\tmaterial.setParameter('internalTex3', this.internalTex3);\n\t\t}\n\t\tmaterial.setParameter('colorParam', this.colorParam);\n\t\tmaterial.setParameter('numParticles', this.numParticles);\n\t\tmaterial.setParameter('numParticlesPot', this.numParticlesPot);\n\t\tmaterial.setParameter('lifetime', this.lifetime);\n\t\tmaterial.setParameter('rate', this.rate);\n\t\tmaterial.setParameter('rateDiv', this.rate2 - this.rate);\n\t\tmaterial.setParameter('seed', this.seed);\n\t\tmaterial.setParameter('scaleDivMult', this.scaleUMax[0]);\n\t\tmaterial.setParameter('alphaDivMult', this.alphaUMax[0]);\n\t\tmaterial.setParameter('radialSpeedDivMult', this.radialSpeedUMax[0]);\n\t\tmaterial.setParameter('graphNumSamples', this.precision);\n\t\tmaterial.setParameter('graphSampleSize', 1.0 / this.precision);\n\t\tmaterial.setParameter('emitterScale', new Float32Array([1, 1, 1]));\n\t\tif (this.pack8) {\n\t\t\tthis._gpuUpdater._setInputBounds();\n\t\t\tmaterial.setParameter('inBoundsSize', this._gpuUpdater.inBoundsSizeUniform);\n\t\t\tmaterial.setParameter('inBoundsCenter', this._gpuUpdater.inBoundsCenterUniform);\n\t\t\tmaterial.setParameter('maxVel', this.maxVel);\n\t\t}\n\t\tif (this.wrap && this.wrapBounds) {\n\t\t\tthis.wrapBoundsUniform[0] = this.wrapBounds.x;\n\t\t\tthis.wrapBoundsUniform[1] = this.wrapBounds.y;\n\t\t\tthis.wrapBoundsUniform[2] = this.wrapBounds.z;\n\t\t\tmaterial.setParameter('wrapBounds', this.wrapBoundsUniform);\n\t\t}\n\t\tif (this.colorMap) {\n\t\t\tmaterial.setParameter('colorMap', this.colorMap);\n\t\t}\n\t\tif (this.lighting) {\n\t\t\tif (this.normalMap) {\n\t\t\t\tmaterial.setParameter('normalMap', this.normalMap);\n\t\t\t}\n\t\t}\n\t\tif (this.depthSoftening > 0) {\n\t\t\tmaterial.setParameter('softening', 1.0 / (this.depthSoftening * this.depthSoftening * 100));\n\t\t}\n\t\tif (this.stretch > 0.0) material.cull = CULLFACE_NONE;\n\t\tthis._compParticleFaceParams();\n\t}\n\t_compParticleFaceParams() {\n\t\tlet tangent, binormal;\n\t\tif (this.orientation === PARTICLEORIENTATION_SCREEN) {\n\t\t\ttangent = new Float32Array([1, 0, 0]);\n\t\t\tbinormal = new Float32Array([0, 0, 1]);\n\t\t} else {\n\t\t\tlet n;\n\t\t\tif (this.orientation === PARTICLEORIENTATION_WORLD) {\n\t\t\t\tn = this.particleNormal.normalize();\n\t\t\t} else {\n\t\t\t\tconst emitterMat = this.node === null ? Mat4.IDENTITY : this.node.getWorldTransform();\n\t\t\t\tn = emitterMat.transformVector(this.particleNormal).normalize();\n\t\t\t}\n\t\t\tconst t = new Vec3(1, 0, 0);\n\t\t\tif (Math.abs(t.dot(n)) === 1) t.set(0, 0, 1);\n\t\t\tconst b = new Vec3().cross(n, t).normalize();\n\t\t\tt.cross(b, n).normalize();\n\t\t\ttangent = new Float32Array([t.x, t.y, t.z]);\n\t\t\tbinormal = new Float32Array([b.x, b.y, b.z]);\n\t\t}\n\t\tthis.material.setParameter('faceTangent', tangent);\n\t\tthis.material.setParameter('faceBinorm', binormal);\n\t}\n\t_allocate(numParticles) {\n\t\tconst psysVertCount = numParticles * this.numParticleVerts;\n\t\tconst psysIndexCount = numParticles * this.numParticleIndices;\n\t\tif (this.vertexBuffer === undefined || this.vertexBuffer.getNumVertices() !== psysVertCount) {\n\t\t\tif (!this.useCpu) {\n\t\t\t\tconst elements = [{\n\t\t\t\t\tsemantic: SEMANTIC_ATTR0,\n\t\t\t\t\tcomponents: 4,\n\t\t\t\t\ttype: TYPE_FLOAT32\n\t\t\t\t}];\n\t\t\t\tif (this.useMesh) {\n\t\t\t\t\telements.push({\n\t\t\t\t\t\tsemantic: SEMANTIC_ATTR1,\n\t\t\t\t\t\tcomponents: 2,\n\t\t\t\t\t\ttype: TYPE_FLOAT32\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst particleFormat = new VertexFormat(this.graphicsDevice, elements);\n\t\t\t\tthis.vertexBuffer = new VertexBuffer(this.graphicsDevice, particleFormat, psysVertCount, BUFFER_DYNAMIC);\n\t\t\t\tthis.indexBuffer = new IndexBuffer(this.graphicsDevice, INDEXFORMAT_UINT16, psysIndexCount);\n\t\t\t} else {\n\t\t\t\tconst elements = [{\n\t\t\t\t\tsemantic: SEMANTIC_ATTR0,\n\t\t\t\t\tcomponents: 4,\n\t\t\t\t\ttype: TYPE_FLOAT32\n\t\t\t\t}, {\n\t\t\t\t\tsemantic: SEMANTIC_ATTR1,\n\t\t\t\t\tcomponents: 4,\n\t\t\t\t\ttype: TYPE_FLOAT32\n\t\t\t\t}, {\n\t\t\t\t\tsemantic: SEMANTIC_ATTR2,\n\t\t\t\t\tcomponents: 4,\n\t\t\t\t\ttype: TYPE_FLOAT32\n\t\t\t\t}, {\n\t\t\t\t\tsemantic: SEMANTIC_ATTR3,\n\t\t\t\t\tcomponents: 1,\n\t\t\t\t\ttype: TYPE_FLOAT32\n\t\t\t\t}, {\n\t\t\t\t\tsemantic: SEMANTIC_ATTR4,\n\t\t\t\t\tcomponents: this.useMesh ? 4 : 2,\n\t\t\t\t\ttype: TYPE_FLOAT32\n\t\t\t\t}];\n\t\t\t\tconst particleFormat = new VertexFormat(this.graphicsDevice, elements);\n\t\t\t\tthis.vertexBuffer = new VertexBuffer(this.graphicsDevice, particleFormat, psysVertCount, BUFFER_DYNAMIC);\n\t\t\t\tthis.indexBuffer = new IndexBuffer(this.graphicsDevice, INDEXFORMAT_UINT16, psysIndexCount);\n\t\t\t}\n\t\t\tconst data = new Float32Array(this.vertexBuffer.lock());\n\t\t\tlet meshData, stride, texCoordOffset;\n\t\t\tif (this.useMesh) {\n\t\t\t\tmeshData = new Float32Array(this.mesh.vertexBuffer.lock());\n\t\t\t\tstride = meshData.length / this.mesh.vertexBuffer.numVertices;\n\t\t\t\tfor (let elem = 0; elem < this.mesh.vertexBuffer.format.elements.length; elem++) {\n\t\t\t\t\tif (this.mesh.vertexBuffer.format.elements[elem].name === SEMANTIC_TEXCOORD0) {\n\t\t\t\t\t\ttexCoordOffset = this.mesh.vertexBuffer.format.elements[elem].offset / 4;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (let i = 0; i < psysVertCount; i++) {\n\t\t\t\tconst id = Math.floor(i / this.numParticleVerts);\n\t\t\t\tif (!this.useMesh) {\n\t\t\t\t\tconst vertID = i % 4;\n\t\t\t\t\tdata[i * 4] = particleVerts[vertID][0];\n\t\t\t\t\tdata[i * 4 + 1] = particleVerts[vertID][1];\n\t\t\t\t\tdata[i * 4 + 2] = 0;\n\t\t\t\t\tdata[i * 4 + 3] = id;\n\t\t\t\t} else {\n\t\t\t\t\tconst vert = i % this.numParticleVerts;\n\t\t\t\t\tdata[i * 6] = meshData[vert * stride];\n\t\t\t\t\tdata[i * 6 + 1] = meshData[vert * stride + 1];\n\t\t\t\t\tdata[i * 6 + 2] = meshData[vert * stride + 2];\n\t\t\t\t\tdata[i * 6 + 3] = id;\n\t\t\t\t\tdata[i * 6 + 4] = meshData[vert * stride + texCoordOffset + 0];\n\t\t\t\t\tdata[i * 6 + 5] = 1.0 - meshData[vert * stride + texCoordOffset + 1];\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.useCpu) {\n\t\t\t\tthis.vbCPU = new Float32Array(data);\n\t\t\t\tthis.vbOld = new Float32Array(this.vbCPU.length);\n\t\t\t}\n\t\t\tthis.vertexBuffer.unlock();\n\t\t\tif (this.useMesh) {\n\t\t\t\tthis.mesh.vertexBuffer.unlock();\n\t\t\t}\n\t\t\tlet dst = 0;\n\t\t\tconst indices = new Uint16Array(this.indexBuffer.lock());\n\t\t\tif (this.useMesh) meshData = new Uint16Array(this.mesh.indexBuffer[0].lock());\n\t\t\tfor (let i = 0; i < numParticles; i++) {\n\t\t\t\tif (!this.useMesh) {\n\t\t\t\t\tconst baseIndex = i * 4;\n\t\t\t\t\tindices[dst++] = baseIndex;\n\t\t\t\t\tindices[dst++] = baseIndex + 1;\n\t\t\t\t\tindices[dst++] = baseIndex + 2;\n\t\t\t\t\tindices[dst++] = baseIndex;\n\t\t\t\t\tindices[dst++] = baseIndex + 2;\n\t\t\t\t\tindices[dst++] = baseIndex + 3;\n\t\t\t\t} else {\n\t\t\t\t\tfor (let j = 0; j < this.numParticleIndices; j++) {\n\t\t\t\t\t\tindices[i * this.numParticleIndices + j] = meshData[j] + i * this.numParticleVerts;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.indexBuffer.unlock();\n\t\t\tif (this.useMesh) this.mesh.indexBuffer[0].unlock();\n\t\t}\n\t}\n\treset() {\n\t\tthis.beenReset = true;\n\t\tthis.seed = Math.random();\n\t\tthis.material.setParameter('seed', this.seed);\n\t\tif (this.useCpu) {\n\t\t\tfor (let i = 0; i < this.particleTexStart.length; i++) {\n\t\t\t\tthis.particleTex[i] = this.particleTexStart[i];\n\t\t\t}\n\t\t} else {\n\t\t\tthis._initializeTextures();\n\t\t}\n\t\tthis.resetWorldBounds();\n\t\tthis.resetTime();\n\t\tconst origLoop = this.loop;\n\t\tthis.loop = true;\n\t\tthis.addTime(0, false);\n\t\tthis.loop = origLoop;\n\t\tif (this.preWarm) {\n\t\t\tthis.prewarm(this.lifetime);\n\t\t}\n\t}\n\tprewarm(time) {\n\t\tconst lifetimeFraction = time / this.lifetime;\n\t\tconst iterations = Math.min(Math.floor(lifetimeFraction * this.precision), this.precision);\n\t\tconst stepDelta = time / iterations;\n\t\tfor (let i = 0; i < iterations; i++) {\n\t\t\tthis.addTime(stepDelta, false);\n\t\t}\n\t}\n\tresetTime() {\n\t\tthis.endTime = calcEndTime(this);\n\t}\n\tfinishFrame() {\n\t\tif (this.useCpu) this.vertexBuffer.unlock();\n\t}\n\taddTime(delta, isOnStop) {\n\t\tconst device = this.graphicsDevice;\n\t\tthis.simTimeTotal += delta;\n\t\tthis.calculateWorldBounds();\n\t\tif (this._isAnimated()) {\n\t\t\tconst tilesParams = this.animTilesParams;\n\t\t\ttilesParams[0] = 1.0 / this.animTilesX;\n\t\t\ttilesParams[1] = 1.0 / this.animTilesY;\n\t\t\tconst params = this.animParams;\n\t\t\tparams[0] = this.animStartFrame;\n\t\t\tparams[1] = this.animNumFrames * this.animSpeed;\n\t\t\tparams[2] = this.animNumFrames - 1;\n\t\t\tparams[3] = this.animNumAnimations - 1;\n\t\t\tconst animIndexParams = this.animIndexParams;\n\t\t\tanimIndexParams[0] = this.animIndex;\n\t\t\tanimIndexParams[1] = this.randomizeAnimIndex;\n\t\t}\n\t\tif (this.scene) {\n\t\t\tif (this.camera !== this.scene._activeCamera) {\n\t\t\t\tthis.camera = this.scene._activeCamera;\n\t\t\t\tthis.onChangeCamera();\n\t\t\t}\n\t\t}\n\t\tif (this.emitterShape === EMITTERSHAPE_BOX) {\n\t\t\textentsInnerRatioUniform[0] = this.emitterExtents.x !== 0 ? this.emitterExtentsInner.x / this.emitterExtents.x : 0;\n\t\t\textentsInnerRatioUniform[1] = this.emitterExtents.y !== 0 ? this.emitterExtentsInner.y / this.emitterExtents.y : 0;\n\t\t\textentsInnerRatioUniform[2] = this.emitterExtents.z !== 0 ? this.emitterExtentsInner.z / this.emitterExtents.z : 0;\n\t\t\tif (this.meshInstance.node === null) {\n\t\t\t\tspawnMatrix.setTRS(Vec3.ZERO, Quat.IDENTITY, this.emitterExtents);\n\t\t\t} else {\n\t\t\t\tspawnMatrix.setTRS(Vec3.ZERO, this.meshInstance.node.getRotation(), tmpVec3.copy(this.emitterExtents).mul(this.meshInstance.node.localScale));\n\t\t\t}\n\t\t}\n\t\tlet emitterPos;\n\t\tconst emitterScale = this.meshInstance.node === null ? Vec3.ONE : this.meshInstance.node.localScale;\n\t\tthis.emitterScaleUniform[0] = emitterScale.x;\n\t\tthis.emitterScaleUniform[1] = emitterScale.y;\n\t\tthis.emitterScaleUniform[2] = emitterScale.z;\n\t\tthis.material.setParameter('emitterScale', this.emitterScaleUniform);\n\t\tif (this.localSpace && this.meshInstance.node) {\n\t\t\temitterPos = this.meshInstance.node.getPosition();\n\t\t\tthis.emitterPosUniform[0] = emitterPos.x;\n\t\t\tthis.emitterPosUniform[1] = emitterPos.y;\n\t\t\tthis.emitterPosUniform[2] = emitterPos.z;\n\t\t\tthis.material.setParameter('emitterPos', this.emitterPosUniform);\n\t\t}\n\t\tthis._compParticleFaceParams();\n\t\tif (!this.useCpu) {\n\t\t\tthis._gpuUpdater.update(device, spawnMatrix, extentsInnerRatioUniform, delta, isOnStop);\n\t\t} else {\n\t\t\tconst data = new Float32Array(this.vertexBuffer.lock());\n\t\t\tthis._cpuUpdater.update(data, this.vbToSort, this.particleTex, spawnMatrix, extentsInnerRatioUniform, emitterPos, delta, isOnStop);\n\t\t}\n\t\tif (!this.loop) {\n\t\t\tif (Date.now() > this.endTime) {\n\t\t\t\tif (this.onFinished) this.onFinished();\n\t\t\t\tthis.meshInstance.visible = false;\n\t\t\t}\n\t\t}\n\t\tif (this.meshInstance) {\n\t\t\tthis.meshInstance.drawOrder = this.drawOrder;\n\t\t}\n\t}\n\t_destroyResources() {\n\t\tif (this.particleTexIN) {\n\t\t\tthis.particleTexIN.destroy();\n\t\t\tthis.particleTexIN = null;\n\t\t}\n\t\tif (this.particleTexOUT) {\n\t\t\tthis.particleTexOUT.destroy();\n\t\t\tthis.particleTexOUT = null;\n\t\t}\n\t\tif (this.particleTexStart && this.particleTexStart.destroy) {\n\t\t\tthis.particleTexStart.destroy();\n\t\t\tthis.particleTexStart = null;\n\t\t}\n\t\tif (this.rtParticleTexIN) {\n\t\t\tthis.rtParticleTexIN.destroy();\n\t\t\tthis.rtParticleTexIN = null;\n\t\t}\n\t\tif (this.rtParticleTexOUT) {\n\t\t\tthis.rtParticleTexOUT.destroy();\n\t\t\tthis.rtParticleTexOUT = null;\n\t\t}\n\t\tif (this.internalTex0) {\n\t\t\tthis.internalTex0.destroy();\n\t\t\tthis.internalTex0 = null;\n\t\t}\n\t\tif (this.internalTex1) {\n\t\t\tthis.internalTex1.destroy();\n\t\t\tthis.internalTex1 = null;\n\t\t}\n\t\tif (this.internalTex2) {\n\t\t\tthis.internalTex2.destroy();\n\t\t\tthis.internalTex2 = null;\n\t\t}\n\t\tif (this.internalTex3) {\n\t\t\tthis.internalTex3.destroy();\n\t\t\tthis.internalTex3 = null;\n\t\t}\n\t\tif (this.colorParam) {\n\t\t\tthis.colorParam.destroy();\n\t\t\tthis.colorParam = null;\n\t\t}\n\t\tif (this.vertexBuffer) {\n\t\t\tthis.vertexBuffer.destroy();\n\t\t\tthis.vertexBuffer = undefined;\n\t\t}\n\t\tif (this.indexBuffer) {\n\t\t\tthis.indexBuffer.destroy();\n\t\t\tthis.indexBuffer = undefined;\n\t\t}\n\t\tif (this.material) {\n\t\t\tthis.material.destroy();\n\t\t\tthis.material = null;\n\t\t}\n\t}\n\tdestroy() {\n\t\tthis.camera = null;\n\t\tthis._destroyResources();\n\t}\n}\n\nexport { ParticleEmitter };\n","import { SEMANTIC_POSITION } from '../../../platform/graphics/constants.js';\nimport { shaderChunks } from '../chunks/chunks.js';\nimport { ChunkUtils } from '../chunk-utils.js';\nimport { ShaderUtils } from '../../../platform/graphics/shader-utils.js';\nimport { ShaderGenerator } from './shader-generator.js';\n\nclass ShaderGeneratorSkybox extends ShaderGenerator {\n\tgenerateKey(options) {\n\t\treturn options.type === 'cubemap' ? `skybox-${options.type}-${options.encoding}-${options.useIntensity}-${options.gamma}-${options.toneMapping}-${options.fixSeams}-${options.mip}` : `skybox-${options.type}-${options.encoding}-${options.useIntensity}-${options.gamma}-${options.toneMapping}`;\n\t}\n\tcreateShaderDefinition(device, options) {\n\t\tlet fshader = '';\n\t\tif (options.type === 'cubemap') {\n\t\t\tconst mip2size = [128, 64, 16, 8, 4, 2];\n\t\t\tfshader += options.mip ? shaderChunks.fixCubemapSeamsStretchPS : shaderChunks.fixCubemapSeamsNonePS;\n\t\t\tfshader += options.useIntensity ? shaderChunks.envMultiplyPS : shaderChunks.envConstPS;\n\t\t\tfshader += shaderChunks.decodePS;\n\t\t\tfshader += ShaderGenerator.gammaCode(options.gamma);\n\t\t\tfshader += ShaderGenerator.tonemapCode(options.toneMapping);\n\t\t\tfshader += shaderChunks.skyboxHDRPS.replace(/\\$DECODE/g, ChunkUtils.decodeFunc(options.encoding)).replace(/\\$FIXCONST/g, 1 - 1 / mip2size[options.mip] + \"\");\n\t\t} else {\n\t\t\tfshader += options.useIntensity ? shaderChunks.envMultiplyPS : shaderChunks.envConstPS;\n\t\t\tfshader += shaderChunks.decodePS;\n\t\t\tfshader += ShaderGenerator.gammaCode(options.gamma);\n\t\t\tfshader += ShaderGenerator.tonemapCode(options.toneMapping);\n\t\t\tfshader += shaderChunks.sphericalPS;\n\t\t\tfshader += shaderChunks.envAtlasPS;\n\t\t\tfshader += shaderChunks.skyboxEnvPS.replace(/\\$DECODE/g, ChunkUtils.decodeFunc(options.encoding));\n\t\t}\n\t\treturn ShaderUtils.createDefinition(device, {\n\t\t\tname: 'SkyboxShader',\n\t\t\tattributes: {\n\t\t\t\taPosition: SEMANTIC_POSITION\n\t\t\t},\n\t\t\tvertexCode: shaderChunks.skyboxVS,\n\t\t\tfragmentCode: fshader\n\t\t});\n\t}\n}\nconst skybox = new ShaderGeneratorSkybox();\n\nexport { skybox };\n","import { CULLFACE_FRONT } from '../platform/graphics/constants.js';\nimport { ShaderProcessorOptions } from '../platform/graphics/shader-processor-options.js';\nimport { SHADER_FORWARDHDR, GAMMA_SRGBHDR, GAMMA_NONE, TONEMAP_LINEAR, LAYERID_SKYBOX } from './constants.js';\nimport { createBox } from './procedural.js';\nimport { GraphNode } from './graph-node.js';\nimport { Material } from './materials/material.js';\nimport { MeshInstance } from './mesh-instance.js';\nimport { getProgramLibrary } from './shader-lib/get-program-library.js';\nimport { skybox } from './shader-lib/programs/skybox.js';\n\nclass Sky {\n\tconstructor(device, scene, texture) {\n\t\tthis.meshInstance = void 0;\n\t\tconst material = new Material();\n\t\tmaterial.getShaderVariant = function (dev, sc, defs, unused, pass, sortedLights, viewUniformFormat, viewBindGroupFormat) {\n\t\t\tconst options = {\n\t\t\t\tpass: pass,\n\t\t\t\tencoding: texture.encoding,\n\t\t\t\tuseIntensity: scene.skyboxIntensity !== 1 || scene.physicalUnits,\n\t\t\t\tgamma: pass === SHADER_FORWARDHDR ? scene.gammaCorrection ? GAMMA_SRGBHDR : GAMMA_NONE : scene.gammaCorrection,\n\t\t\t\ttoneMapping: pass === SHADER_FORWARDHDR ? TONEMAP_LINEAR : scene.toneMapping\n\t\t\t};\n\t\t\tif (texture.cubemap) {\n\t\t\t\toptions.type = 'cubemap';\n\t\t\t\toptions.mip = texture.fixCubemapSeams ? scene.skyboxMip : 0;\n\t\t\t\toptions.fixSeams = texture.fixCubemapSeams;\n\t\t\t} else {\n\t\t\t\toptions.type = 'envAtlas';\n\t\t\t}\n\t\t\tconst processingOptions = new ShaderProcessorOptions(viewUniformFormat, viewBindGroupFormat);\n\t\t\tconst library = getProgramLibrary(device);\n\t\t\tlibrary.register('skybox', skybox);\n\t\t\treturn library.getProgram('skybox', options, processingOptions);\n\t\t};\n\t\tif (texture.cubemap) {\n\t\t\tmaterial.setParameter('texture_cubeMap', texture);\n\t\t} else {\n\t\t\tmaterial.setParameter('texture_envAtlas', texture);\n\t\t\tmaterial.setParameter('mipLevel', scene._skyboxMip);\n\t\t}\n\t\tmaterial.cull = CULLFACE_FRONT;\n\t\tmaterial.depthWrite = false;\n\t\tconst skyLayer = scene.layers.getLayerById(LAYERID_SKYBOX);\n\t\tif (skyLayer) {\n\t\t\tconst node = new GraphNode('Skybox');\n\t\t\tconst mesh = createBox(device);\n\t\t\tconst meshInstance = new MeshInstance(mesh, material, node);\n\t\t\tthis.meshInstance = meshInstance;\n\t\t\tmeshInstance.cull = false;\n\t\t\tmeshInstance._noDepthDrawGl1 = true;\n\t\t\tmeshInstance.pick = false;\n\t\t\tskyLayer.addMeshInstances([meshInstance]);\n\t\t\tthis.skyLayer = skyLayer;\n\t\t}\n\t}\n\tdestroy() {\n\t\tif (this.meshInstance) {\n\t\t\tif (this.skyLayer) {\n\t\t\t\tthis.skyLayer.removeMeshInstances([this.meshInstance]);\n\t\t\t}\n\t\t\tthis.meshInstance.destroy();\n\t\t\tthis.meshInstance = null;\n\t\t}\n\t}\n}\n\nexport { Sky };\n","import { Mat4 } from '../../core/math/mat4.js';\nimport { PRIMITIVE_LINES } from '../../platform/graphics/constants.js';\nimport { Mesh } from '../mesh.js';\nimport { MeshInstance } from '../mesh-instance.js';\nimport { GraphNode } from '../graph-node.js';\n\nconst identityGraphNode = new GraphNode();\nidentityGraphNode.worldTransform = Mat4.IDENTITY;\nidentityGraphNode._dirtyWorld = identityGraphNode._dirtyNormal = false;\nclass ImmediateBatch {\n\tconstructor(device, material, layer) {\n\t\tthis.material = material;\n\t\tthis.layer = layer;\n\t\tthis.positions = [];\n\t\tthis.colors = [];\n\t\tthis.mesh = new Mesh(device);\n\t\tthis.meshInstance = null;\n\t}\n\taddLines(positions, color) {\n\t\tconst destPos = this.positions;\n\t\tconst count = positions.length;\n\t\tfor (let i = 0; i < count; i++) {\n\t\t\tconst pos = positions[i];\n\t\t\tdestPos.push(pos.x, pos.y, pos.z);\n\t\t}\n\t\tconst destCol = this.colors;\n\t\tif (color.length) {\n\t\t\tfor (let i = 0; i < count; i++) {\n\t\t\t\tconst col = color[i];\n\t\t\t\tdestCol.push(col.r, col.g, col.b, col.a);\n\t\t\t}\n\t\t} else {\n\t\t\tfor (let i = 0; i < count; i++) {\n\t\t\t\tdestCol.push(color.r, color.g, color.b, color.a);\n\t\t\t}\n\t\t}\n\t}\n\taddLinesArrays(positions, color) {\n\t\tconst destPos = this.positions;\n\t\tfor (let i = 0; i < positions.length; i += 3) {\n\t\t\tdestPos.push(positions[i], positions[i + 1], positions[i + 2]);\n\t\t}\n\t\tconst destCol = this.colors;\n\t\tif (color.length) {\n\t\t\tfor (let i = 0; i < color.length; i += 4) {\n\t\t\t\tdestCol.push(color[i], color[i + 1], color[i + 2], color[i + 3]);\n\t\t\t}\n\t\t} else {\n\t\t\tconst count = positions.length / 3;\n\t\t\tfor (let i = 0; i < count; i++) {\n\t\t\t\tdestCol.push(color.r, color.g, color.b, color.a);\n\t\t\t}\n\t\t}\n\t}\n\tonPreRender(visibleList, transparent) {\n\t\tif (this.positions.length > 0 && this.material.transparent === transparent) {\n\t\t\tthis.mesh.setPositions(this.positions);\n\t\t\tthis.mesh.setColors(this.colors);\n\t\t\tthis.mesh.update(PRIMITIVE_LINES, false);\n\t\t\tif (!this.meshInstance) {\n\t\t\t\tthis.meshInstance = new MeshInstance(this.mesh, this.material, identityGraphNode);\n\t\t\t}\n\t\t\tthis.positions.length = 0;\n\t\t\tthis.colors.length = 0;\n\t\t\tvisibleList.push(this.meshInstance);\n\t\t}\n\t}\n}\n\nexport { ImmediateBatch };\n","import { ImmediateBatch } from './immediate-batch.js';\n\nclass ImmediateBatches {\n\tconstructor(device) {\n\t\tthis.device = device;\n\t\tthis.map = new Map();\n\t}\n\tgetBatch(material, layer) {\n\t\tlet batch = this.map.get(material);\n\t\tif (!batch) {\n\t\t\tbatch = new ImmediateBatch(this.device, material, layer);\n\t\t\tthis.map.set(material, batch);\n\t\t}\n\t\treturn batch;\n\t}\n\tonPreRender(visibleList, transparent) {\n\t\tthis.map.forEach(batch => {\n\t\t\tbatch.onPreRender(visibleList, transparent);\n\t\t});\n\t}\n}\n\nexport { ImmediateBatches };\n","import { PRIMITIVE_TRISTRIP } from '../../platform/graphics/constants.js';\nimport { BLEND_NORMAL } from '../constants.js';\nimport { GraphNode } from '../graph-node.js';\nimport { Mesh } from '../mesh.js';\nimport { MeshInstance } from '../mesh-instance.js';\nimport { BasicMaterial } from '../materials/basic-material.js';\nimport { createShaderFromCode } from '../shader-lib/utils.js';\nimport { shaderChunks } from '../shader-lib/chunks/chunks.js';\nimport { ImmediateBatches } from './immediate-batches.js';\n\nconst tempPoints = [];\nclass Immediate {\n\tconstructor(device) {\n\t\tthis.device = device;\n\t\tthis.quadMesh = null;\n\t\tthis.textureShader = null;\n\t\tthis.depthTextureShader = null;\n\t\tthis.cubeLocalPos = null;\n\t\tthis.cubeWorldPos = null;\n\t\tthis.batchesMap = new Map();\n\t\tthis.allBatches = new Set();\n\t\tthis.updatedLayers = new Set();\n\t\tthis._materialDepth = null;\n\t\tthis._materialNoDepth = null;\n\t\tthis.layerMeshInstances = new Map();\n\t}\n\tcreateMaterial(depthTest) {\n\t\tconst material = new BasicMaterial();\n\t\tmaterial.vertexColors = true;\n\t\tmaterial.blendType = BLEND_NORMAL;\n\t\tmaterial.depthTest = depthTest;\n\t\tmaterial.update();\n\t\treturn material;\n\t}\n\tget materialDepth() {\n\t\tif (!this._materialDepth) {\n\t\t\tthis._materialDepth = this.createMaterial(true);\n\t\t}\n\t\treturn this._materialDepth;\n\t}\n\tget materialNoDepth() {\n\t\tif (!this._materialNoDepth) {\n\t\t\tthis._materialNoDepth = this.createMaterial(false);\n\t\t}\n\t\treturn this._materialNoDepth;\n\t}\n\tgetBatch(layer, depthTest) {\n\t\tlet batches = this.batchesMap.get(layer);\n\t\tif (!batches) {\n\t\t\tbatches = new ImmediateBatches(this.device);\n\t\t\tthis.batchesMap.set(layer, batches);\n\t\t}\n\t\tthis.allBatches.add(batches);\n\t\tconst material = depthTest ? this.materialDepth : this.materialNoDepth;\n\t\treturn batches.getBatch(material, layer);\n\t}\n\tgetShader(id, fragment) {\n\t\tif (!this[id]) {\n\t\t\tconst vertex = `\n\t\t\t\tattribute vec2 vertex_position;\n\t\t\t\tuniform mat4 matrix_model;\n\t\t\t\tvarying vec2 uv0;\n\t\t\t\tvoid main(void) {\n\t\t\t\t\tgl_Position = matrix_model * vec4(vertex_position, 0, 1);\n\t\t\t\t\tuv0 = vertex_position.xy + 0.5;\n\t\t\t\t}\n\t\t\t`;\n\t\t\tthis[id] = createShaderFromCode(this.device, vertex, fragment, `DebugShader:${id}`);\n\t\t}\n\t\treturn this[id];\n\t}\n\tgetTextureShader() {\n\t\treturn this.getShader('textureShader', `\n\t\t\tvarying vec2 uv0;\n\t\t\tuniform sampler2D colorMap;\n\t\t\tvoid main (void) {\n\t\t\t\tgl_FragColor = vec4(texture2D(colorMap, uv0).xyz, 1);\n\t\t\t}\n\t\t`);\n\t}\n\tgetUnfilterableTextureShader() {\n\t\treturn this.getShader('textureShaderUnfilterable', `\n\t\t\tvarying vec2 uv0;\n\t\t\tuniform highp sampler2D colorMap;\n\t\t\tvoid main (void) {\n\t\t\t\tivec2 uv = ivec2(uv0 * textureSize(colorMap, 0));\n\t\t\t\tgl_FragColor = vec4(texelFetch(colorMap, uv, 0).xyz, 1);\n\t\t\t}\n\t\t`);\n\t}\n\tgetDepthTextureShader() {\n\t\treturn this.getShader('depthTextureShader', `\n\t\t\t${shaderChunks.screenDepthPS}\n\t\t\tvarying vec2 uv0;\n\t\t\tvoid main() {\n\t\t\t\tfloat depth = getLinearScreenDepth(uv0) * camera_params.x;\n\t\t\t\tgl_FragColor = vec4(vec3(depth), 1.0);\n\t\t\t}\n\t\t`);\n\t}\n\tgetQuadMesh() {\n\t\tif (!this.quadMesh) {\n\t\t\tthis.quadMesh = new Mesh(this.device);\n\t\t\tthis.quadMesh.setPositions([-0.5, -0.5, 0, 0.5, -0.5, 0, -0.5, 0.5, 0, 0.5, 0.5, 0]);\n\t\t\tthis.quadMesh.update(PRIMITIVE_TRISTRIP);\n\t\t}\n\t\treturn this.quadMesh;\n\t}\n\tdrawMesh(material, matrix, mesh, meshInstance, layer) {\n\t\tif (!meshInstance) {\n\t\t\tconst graphNode = this.getGraphNode(matrix);\n\t\t\tmeshInstance = new MeshInstance(mesh, material, graphNode);\n\t\t}\n\t\tlet layerMeshInstances = this.layerMeshInstances.get(layer);\n\t\tif (!layerMeshInstances) {\n\t\t\tlayerMeshInstances = [];\n\t\t\tthis.layerMeshInstances.set(layer, layerMeshInstances);\n\t\t}\n\t\tlayerMeshInstances.push(meshInstance);\n\t}\n\tdrawWireAlignedBox(min, max, color, depthTest, layer) {\n\t\ttempPoints.push(min.x, min.y, min.z, min.x, max.y, min.z, min.x, max.y, min.z, max.x, max.y, min.z, max.x, max.y, min.z, max.x, min.y, min.z, max.x, min.y, min.z, min.x, min.y, min.z, min.x, min.y, max.z, min.x, max.y, max.z, min.x, max.y, max.z, max.x, max.y, max.z, max.x, max.y, max.z, max.x, min.y, max.z, max.x, min.y, max.z, min.x, min.y, max.z, min.x, min.y, min.z, min.x, min.y, max.z, min.x, max.y, min.z, min.x, max.y, max.z, max.x, max.y, min.z, max.x, max.y, max.z, max.x, min.y, min.z, max.x, min.y, max.z);\n\t\tconst batch = this.getBatch(layer, depthTest);\n\t\tbatch.addLinesArrays(tempPoints, color);\n\t\ttempPoints.length = 0;\n\t}\n\tdrawWireSphere(center, radius, color, numSegments, depthTest, layer) {\n\t\tconst step = 2 * Math.PI / numSegments;\n\t\tlet angle = 0;\n\t\tfor (let i = 0; i < numSegments; i++) {\n\t\t\tconst sin0 = Math.sin(angle);\n\t\t\tconst cos0 = Math.cos(angle);\n\t\t\tangle += step;\n\t\t\tconst sin1 = Math.sin(angle);\n\t\t\tconst cos1 = Math.cos(angle);\n\t\t\ttempPoints.push(center.x + radius * sin0, center.y, center.z + radius * cos0);\n\t\t\ttempPoints.push(center.x + radius * sin1, center.y, center.z + radius * cos1);\n\t\t\ttempPoints.push(center.x + radius * sin0, center.y + radius * cos0, center.z);\n\t\t\ttempPoints.push(center.x + radius * sin1, center.y + radius * cos1, center.z);\n\t\t\ttempPoints.push(center.x, center.y + radius * sin0, center.z + radius * cos0);\n\t\t\ttempPoints.push(center.x, center.y + radius * sin1, center.z + radius * cos1);\n\t\t}\n\t\tconst batch = this.getBatch(layer, depthTest);\n\t\tbatch.addLinesArrays(tempPoints, color);\n\t\ttempPoints.length = 0;\n\t}\n\tgetGraphNode(matrix) {\n\t\tconst graphNode = new GraphNode('ImmediateDebug');\n\t\tgraphNode.worldTransform = matrix;\n\t\tgraphNode._dirtyWorld = graphNode._dirtyNormal = false;\n\t\treturn graphNode;\n\t}\n\tonPreRenderLayer(layer, visibleList, transparent) {\n\t\tthis.batchesMap.forEach((batches, batchLayer) => {\n\t\t\tif (batchLayer === layer) {\n\t\t\t\tbatches.onPreRender(visibleList, transparent);\n\t\t\t}\n\t\t});\n\t\tif (!this.updatedLayers.has(layer)) {\n\t\t\tthis.updatedLayers.add(layer);\n\t\t\tconst meshInstances = this.layerMeshInstances.get(layer);\n\t\t\tif (meshInstances) {\n\t\t\t\tfor (let i = 0; i < meshInstances.length; i++) {\n\t\t\t\t\tvisibleList.push(meshInstances[i]);\n\t\t\t\t}\n\t\t\t\tmeshInstances.length = 0;\n\t\t\t}\n\t\t}\n\t}\n\tonPostRender() {\n\t\tthis.allBatches.clear();\n\t\tthis.updatedLayers.clear();\n\t}\n}\n\nexport { Immediate };\n","import '../core/tracing.js';\nimport { EventHandler } from '../core/event-handler.js';\nimport { Color } from '../core/math/color.js';\nimport { Vec3 } from '../core/math/vec3.js';\nimport { Quat } from '../core/math/quat.js';\nimport { math } from '../core/math/math.js';\nimport { Mat3 } from '../core/math/mat3.js';\nimport { Mat4 } from '../core/math/mat4.js';\nimport { GraphicsDeviceAccess } from '../platform/graphics/graphics-device-access.js';\nimport { ADDRESS_CLAMP_TO_EDGE, FILTER_LINEAR, PIXELFORMAT_RGBA8 } from '../platform/graphics/constants.js';\nimport { BAKE_COLORDIR, FOG_NONE, GAMMA_SRGB, LAYERID_IMMEDIATE } from './constants.js';\nimport { Sky } from './sky.js';\nimport { LightingParams } from './lighting/lighting-params.js';\nimport { Immediate } from './immediate/immediate.js';\nimport { EnvLighting } from './graphics/env-lighting.js';\n\nclass Scene extends EventHandler {\n\tconstructor(graphicsDevice) {\n\t\tsuper();\n\t\tthis.ambientBake = false;\n\t\tthis.ambientBakeOcclusionBrightness = 0;\n\t\tthis.ambientBakeOcclusionContrast = 0;\n\t\tthis.ambientLight = new Color(0, 0, 0);\n\t\tthis.ambientLuminance = 0;\n\t\tthis.exposure = 1;\n\t\tthis.fogColor = new Color(0, 0, 0);\n\t\tthis.fogDensity = 0;\n\t\tthis.fogEnd = 1000;\n\t\tthis.fogStart = 1;\n\t\tthis.lightmapSizeMultiplier = 1;\n\t\tthis.lightmapMaxResolution = 2048;\n\t\tthis.lightmapMode = BAKE_COLORDIR;\n\t\tthis.lightmapFilterEnabled = false;\n\t\tthis.lightmapHDR = false;\n\t\tthis.root = null;\n\t\tthis.sky = null;\n\t\tthis.physicalUnits = false;\n\t\tthis.device = graphicsDevice || GraphicsDeviceAccess.get();\n\t\tthis._gravity = new Vec3(0, -9.8, 0);\n\t\tthis._layers = null;\n\t\tthis._fog = FOG_NONE;\n\t\tthis._gammaCorrection = GAMMA_SRGB;\n\t\tthis._toneMapping = 0;\n\t\tthis._skyboxCubeMap = null;\n\t\tthis._prefilteredCubemaps = [];\n\t\tthis._envAtlas = null;\n\t\tthis._internalEnvAtlas = null;\n\t\tthis._skyboxIntensity = 1;\n\t\tthis._skyboxLuminance = 0;\n\t\tthis._skyboxMip = 0;\n\t\tthis._skyboxRotationShaderInclude = false;\n\t\tthis._skyboxRotation = new Quat();\n\t\tthis._skyboxRotationMat3 = new Mat3();\n\t\tthis._skyboxRotationMat4 = new Mat4();\n\t\tthis._ambientBakeNumSamples = 1;\n\t\tthis._ambientBakeSpherePart = 0.4;\n\t\tthis._lightmapFilterRange = 10;\n\t\tthis._lightmapFilterSmoothness = 0.2;\n\t\tthis._clusteredLightingEnabled = true;\n\t\tthis._lightingParams = new LightingParams(this.device.supportsAreaLights, this.device.maxTextureSize, () => {\n\t\t\tthis.updateShaders = true;\n\t\t});\n\t\tthis._stats = {\n\t\t\tmeshInstances: 0,\n\t\t\tlights: 0,\n\t\t\tdynamicLights: 0,\n\t\t\tbakedLights: 0,\n\t\t\tupdateShadersTime: 0\n\t\t};\n\t\tthis.updateShaders = true;\n\t\tthis._shaderVersion = 0;\n\t\tthis.immediate = new Immediate(this.device);\n\t}\n\tget defaultDrawLayer() {\n\t\treturn this.layers.getLayerById(LAYERID_IMMEDIATE);\n\t}\n\tset ambientBakeNumSamples(value) {\n\t\tthis._ambientBakeNumSamples = math.clamp(Math.floor(value), 1, 255);\n\t}\n\tget ambientBakeNumSamples() {\n\t\treturn this._ambientBakeNumSamples;\n\t}\n\tset ambientBakeSpherePart(value) {\n\t\tthis._ambientBakeSpherePart = math.clamp(value, 0.001, 1);\n\t}\n\tget ambientBakeSpherePart() {\n\t\treturn this._ambientBakeSpherePart;\n\t}\n\tset clusteredLightingEnabled(value) {\n\t\tif (this.device.isWebGPU && !value) {\n\t\t\treturn;\n\t\t}\n\t\tif (!this._clusteredLightingEnabled && value) {\n\t\t\tconsole.error('Turning on disabled clustered lighting is not currently supported');\n\t\t\treturn;\n\t\t}\n\t\tthis._clusteredLightingEnabled = value;\n\t}\n\tget clusteredLightingEnabled() {\n\t\treturn this._clusteredLightingEnabled;\n\t}\n\tset envAtlas(value) {\n\t\tif (value !== this._envAtlas) {\n\t\t\tthis._envAtlas = value;\n\t\t\tif (value) {\n\t\t\t\tvalue.addressU = ADDRESS_CLAMP_TO_EDGE;\n\t\t\t\tvalue.addressV = ADDRESS_CLAMP_TO_EDGE;\n\t\t\t\tvalue.minFilter = FILTER_LINEAR;\n\t\t\t\tvalue.magFilter = FILTER_LINEAR;\n\t\t\t\tvalue.mipmaps = false;\n\t\t\t}\n\t\t\tthis._prefilteredCubemaps = [];\n\t\t\tif (this._internalEnvAtlas) {\n\t\t\t\tthis._internalEnvAtlas.destroy();\n\t\t\t\tthis._internalEnvAtlas = null;\n\t\t\t}\n\t\t\tthis._resetSky();\n\t\t}\n\t}\n\tget envAtlas() {\n\t\treturn this._envAtlas;\n\t}\n\tset fog(type) {\n\t\tif (type !== this._fog) {\n\t\t\tthis._fog = type;\n\t\t\tthis.updateShaders = true;\n\t\t}\n\t}\n\tget fog() {\n\t\treturn this._fog;\n\t}\n\tset gammaCorrection(value) {\n\t\tif (value !== this._gammaCorrection) {\n\t\t\tthis._gammaCorrection = value;\n\t\t\tthis.updateShaders = true;\n\t\t}\n\t}\n\tget gammaCorrection() {\n\t\treturn this._gammaCorrection;\n\t}\n\tset layers(layers) {\n\t\tconst prev = this._layers;\n\t\tthis._layers = layers;\n\t\tthis.fire('set:layers', prev, layers);\n\t}\n\tget layers() {\n\t\treturn this._layers;\n\t}\n\tget lighting() {\n\t\treturn this._lightingParams;\n\t}\n\tset lightmapFilterRange(value) {\n\t\tthis._lightmapFilterRange = Math.max(value, 0.001);\n\t}\n\tget lightmapFilterRange() {\n\t\treturn this._lightmapFilterRange;\n\t}\n\tset lightmapFilterSmoothness(value) {\n\t\tthis._lightmapFilterSmoothness = Math.max(value, 0.001);\n\t}\n\tget lightmapFilterSmoothness() {\n\t\treturn this._lightmapFilterSmoothness;\n\t}\n\tset prefilteredCubemaps(value) {\n\t\tvalue = value || [];\n\t\tconst cubemaps = this._prefilteredCubemaps;\n\t\tconst changed = cubemaps.length !== value.length || cubemaps.some((c, i) => c !== value[i]);\n\t\tif (changed) {\n\t\t\tconst complete = value.length === 6 && value.every(c => !!c);\n\t\t\tif (complete) {\n\t\t\t\tthis._internalEnvAtlas = EnvLighting.generatePrefilteredAtlas(value, {\n\t\t\t\t\ttarget: this._internalEnvAtlas\n\t\t\t\t});\n\t\t\t\tthis._envAtlas = this._internalEnvAtlas;\n\t\t\t} else {\n\t\t\t\tif (this._internalEnvAtlas) {\n\t\t\t\t\tthis._internalEnvAtlas.destroy();\n\t\t\t\t\tthis._internalEnvAtlas = null;\n\t\t\t\t}\n\t\t\t\tthis._envAtlas = null;\n\t\t\t}\n\t\t\tthis._prefilteredCubemaps = value.slice();\n\t\t\tthis._resetSky();\n\t\t}\n\t}\n\tget prefilteredCubemaps() {\n\t\treturn this._prefilteredCubemaps;\n\t}\n\tset skybox(value) {\n\t\tif (value !== this._skyboxCubeMap) {\n\t\t\tthis._skyboxCubeMap = value;\n\t\t\tthis._resetSky();\n\t\t}\n\t}\n\tget skybox() {\n\t\treturn this._skyboxCubeMap;\n\t}\n\tset skyboxIntensity(value) {\n\t\tif (value !== this._skyboxIntensity) {\n\t\t\tthis._skyboxIntensity = value;\n\t\t\tthis._resetSky();\n\t\t}\n\t}\n\tget skyboxIntensity() {\n\t\treturn this._skyboxIntensity;\n\t}\n\tset skyboxLuminance(value) {\n\t\tif (value !== this._skyboxLuminance) {\n\t\t\tthis._skyboxLuminance = value;\n\t\t\tthis._resetSky();\n\t\t}\n\t}\n\tget skyboxLuminance() {\n\t\treturn this._skyboxLuminance;\n\t}\n\tset skyboxMip(value) {\n\t\tif (value !== this._skyboxMip) {\n\t\t\tthis._skyboxMip = value;\n\t\t\tthis._resetSky();\n\t\t}\n\t}\n\tget skyboxMip() {\n\t\treturn this._skyboxMip;\n\t}\n\tset skyboxRotation(value) {\n\t\tif (!this._skyboxRotation.equals(value)) {\n\t\t\tconst isIdentity = value.equals(Quat.IDENTITY);\n\t\t\tthis._skyboxRotation.copy(value);\n\t\t\tif (isIdentity) {\n\t\t\t\tthis._skyboxRotationMat3.setIdentity();\n\t\t\t} else {\n\t\t\t\tthis._skyboxRotationMat4.setTRS(Vec3.ZERO, value, Vec3.ONE);\n\t\t\t\tthis._skyboxRotationMat3.invertMat4(this._skyboxRotationMat4);\n\t\t\t}\n\t\t\tif (!this._skyboxRotationShaderInclude && !isIdentity) {\n\t\t\t\tthis._skyboxRotationShaderInclude = true;\n\t\t\t\tthis._resetSky();\n\t\t\t}\n\t\t}\n\t}\n\tget skyboxRotation() {\n\t\treturn this._skyboxRotation;\n\t}\n\tset toneMapping(value) {\n\t\tif (value !== this._toneMapping) {\n\t\t\tthis._toneMapping = value;\n\t\t\tthis.updateShaders = true;\n\t\t}\n\t}\n\tget toneMapping() {\n\t\treturn this._toneMapping;\n\t}\n\tdestroy() {\n\t\tthis._resetSky();\n\t\tthis.root = null;\n\t\tthis.off();\n\t}\n\tdrawLine(start, end, color = Color.WHITE, depthTest = true, layer = this.defaultDrawLayer) {\n\t\tconst batch = this.immediate.getBatch(layer, depthTest);\n\t\tbatch.addLines([start, end], [color, color]);\n\t}\n\tdrawLines(positions, colors, depthTest = true, layer = this.defaultDrawLayer) {\n\t\tconst batch = this.immediate.getBatch(layer, depthTest);\n\t\tbatch.addLines(positions, colors);\n\t}\n\tdrawLineArrays(positions, colors, depthTest = true, layer = this.defaultDrawLayer) {\n\t\tconst batch = this.immediate.getBatch(layer, depthTest);\n\t\tbatch.addLinesArrays(positions, colors);\n\t}\n\tapplySettings(settings) {\n\t\tvar _render$skyboxIntensi, _render$skyboxLuminan, _render$skyboxMip, _render$clusteredLigh;\n\t\tconst physics = settings.physics;\n\t\tconst render = settings.render;\n\t\tthis._gravity.set(physics.gravity[0], physics.gravity[1], physics.gravity[2]);\n\t\tthis.ambientLight.set(render.global_ambient[0], render.global_ambient[1], render.global_ambient[2]);\n\t\tthis.ambientLuminance = render.ambientLuminance;\n\t\tthis._fog = render.fog;\n\t\tthis.fogColor.set(render.fog_color[0], render.fog_color[1], render.fog_color[2]);\n\t\tthis.fogStart = render.fog_start;\n\t\tthis.fogEnd = render.fog_end;\n\t\tthis.fogDensity = render.fog_density;\n\t\tthis._gammaCorrection = render.gamma_correction;\n\t\tthis._toneMapping = render.tonemapping;\n\t\tthis.lightmapSizeMultiplier = render.lightmapSizeMultiplier;\n\t\tthis.lightmapMaxResolution = render.lightmapMaxResolution;\n\t\tthis.lightmapMode = render.lightmapMode;\n\t\tthis.exposure = render.exposure;\n\t\tthis._skyboxIntensity = (_render$skyboxIntensi = render.skyboxIntensity) != null ? _render$skyboxIntensi : 1;\n\t\tthis._skyboxLuminance = (_render$skyboxLuminan = render.skyboxLuminance) != null ? _render$skyboxLuminan : 20000;\n\t\tthis._skyboxMip = (_render$skyboxMip = render.skyboxMip) != null ? _render$skyboxMip : 0;\n\t\tif (render.skyboxRotation) {\n\t\t\tthis.skyboxRotation = new Quat().setFromEulerAngles(render.skyboxRotation[0], render.skyboxRotation[1], render.skyboxRotation[2]);\n\t\t}\n\t\tthis.clusteredLightingEnabled = (_render$clusteredLigh = render.clusteredLightingEnabled) != null ? _render$clusteredLigh : false;\n\t\tthis.lighting.applySettings(render);\n\t\t['lightmapFilterEnabled', 'lightmapFilterRange', 'lightmapFilterSmoothness', 'ambientBake', 'ambientBakeNumSamples', 'ambientBakeSpherePart', 'ambientBakeOcclusionBrightness', 'ambientBakeOcclusionContrast'].forEach(setting => {\n\t\t\tif (render.hasOwnProperty(setting)) {\n\t\t\t\tthis[setting] = render[setting];\n\t\t\t}\n\t\t});\n\t\tthis._resetSky();\n\t}\n\t_getSkyboxTex() {\n\t\tconst cubemaps = this._prefilteredCubemaps;\n\t\tif (this._skyboxMip) {\n\t\t\tconst skyboxMapping = [0, 1, 3, 4, 5, 6];\n\t\t\treturn cubemaps[skyboxMapping[this._skyboxMip]] || this._envAtlas || cubemaps[0] || this._skyboxCubeMap;\n\t\t}\n\t\treturn this._skyboxCubeMap || cubemaps[0] || this._envAtlas;\n\t}\n\t_updateSky(device) {\n\t\tif (!this.sky) {\n\t\t\tconst texture = this._getSkyboxTex();\n\t\t\tif (texture) {\n\t\t\t\tthis.sky = new Sky(device, this, texture);\n\t\t\t\tthis.fire('set:skybox', texture);\n\t\t\t}\n\t\t}\n\t}\n\t_resetSky() {\n\t\tvar _this$sky;\n\t\t(_this$sky = this.sky) == null || _this$sky.destroy();\n\t\tthis.sky = null;\n\t\tthis.updateShaders = true;\n\t}\n\tsetSkybox(cubemaps) {\n\t\tif (!cubemaps) {\n\t\t\tthis.skybox = null;\n\t\t\tthis.envAtlas = null;\n\t\t} else {\n\t\t\tthis.skybox = cubemaps[0] || null;\n\t\t\tif (cubemaps[1] && !cubemaps[1].cubemap) {\n\t\t\t\tthis.envAtlas = cubemaps[1];\n\t\t\t} else {\n\t\t\t\tthis.prefilteredCubemaps = cubemaps.slice(1);\n\t\t\t}\n\t\t}\n\t}\n\tget lightmapPixelFormat() {\n\t\treturn this.lightmapHDR && this.device.getRenderableHdrFormat() || PIXELFORMAT_RGBA8;\n\t}\n}\n\nexport { Scene };\n","class Skin {\n\tconstructor(graphicsDevice, ibp, boneNames) {\n\t\tthis.device = graphicsDevice;\n\t\tthis.inverseBindPose = ibp;\n\t\tthis.boneNames = boneNames;\n\t}\n}\n\nexport { Skin };\n","import { EventHandler } from '../core/event-handler.js';\nimport { Vec2 } from '../core/math/vec2.js';\nimport { SPRITE_RENDERMODE_SIMPLE, SPRITE_RENDERMODE_SLICED, SPRITE_RENDERMODE_TILED } from './constants.js';\nimport { createMesh } from './procedural.js';\n\nconst spriteNormals = [0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1];\nconst spriteIndices = [0, 1, 3, 2, 3, 1];\nclass Sprite extends EventHandler {\n\tconstructor(device, options) {\n\t\tsuper();\n\t\tthis._device = device;\n\t\tthis._pixelsPerUnit = options && options.pixelsPerUnit !== undefined ? options.pixelsPerUnit : 1;\n\t\tthis._renderMode = options && options.renderMode !== undefined ? options.renderMode : SPRITE_RENDERMODE_SIMPLE;\n\t\tthis._atlas = options && options.atlas !== undefined ? options.atlas : null;\n\t\tthis._frameKeys = options && options.frameKeys !== undefined ? options.frameKeys : null;\n\t\tthis._meshes = [];\n\t\tthis._updatingProperties = false;\n\t\tthis._meshesDirty = false;\n\t\tif (this._atlas && this._frameKeys) {\n\t\t\tthis._createMeshes();\n\t\t}\n\t}\n\tset frameKeys(value) {\n\t\tthis._frameKeys = value;\n\t\tif (this._atlas && this._frameKeys) {\n\t\t\tif (this._updatingProperties) {\n\t\t\t\tthis._meshesDirty = true;\n\t\t\t} else {\n\t\t\t\tthis._createMeshes();\n\t\t\t}\n\t\t}\n\t\tthis.fire('set:frameKeys', value);\n\t}\n\tget frameKeys() {\n\t\treturn this._frameKeys;\n\t}\n\tset atlas(value) {\n\t\tif (value === this._atlas) return;\n\t\tif (this._atlas) {\n\t\t\tthis._atlas.off('set:frames', this._onSetFrames, this);\n\t\t\tthis._atlas.off('set:frame', this._onFrameChanged, this);\n\t\t\tthis._atlas.off('remove:frame', this._onFrameRemoved, this);\n\t\t}\n\t\tthis._atlas = value;\n\t\tif (this._atlas && this._frameKeys) {\n\t\t\tthis._atlas.on('set:frames', this._onSetFrames, this);\n\t\t\tthis._atlas.on('set:frame', this._onFrameChanged, this);\n\t\t\tthis._atlas.on('remove:frame', this._onFrameRemoved, this);\n\t\t\tif (this._updatingProperties) {\n\t\t\t\tthis._meshesDirty = true;\n\t\t\t} else {\n\t\t\t\tthis._createMeshes();\n\t\t\t}\n\t\t}\n\t\tthis.fire('set:atlas', value);\n\t}\n\tget atlas() {\n\t\treturn this._atlas;\n\t}\n\tset pixelsPerUnit(value) {\n\t\tif (this._pixelsPerUnit === value) return;\n\t\tthis._pixelsPerUnit = value;\n\t\tthis.fire('set:pixelsPerUnit', value);\n\t\tif (this._atlas && this._frameKeys && this.renderMode === SPRITE_RENDERMODE_SIMPLE) {\n\t\t\tif (this._updatingProperties) {\n\t\t\t\tthis._meshesDirty = true;\n\t\t\t} else {\n\t\t\t\tthis._createMeshes();\n\t\t\t}\n\t\t}\n\t}\n\tget pixelsPerUnit() {\n\t\treturn this._pixelsPerUnit;\n\t}\n\tset renderMode(value) {\n\t\tif (this._renderMode === value) return;\n\t\tconst prev = this._renderMode;\n\t\tthis._renderMode = value;\n\t\tthis.fire('set:renderMode', value);\n\t\tif (prev === SPRITE_RENDERMODE_SIMPLE || value === SPRITE_RENDERMODE_SIMPLE) {\n\t\t\tif (this._atlas && this._frameKeys) {\n\t\t\t\tif (this._updatingProperties) {\n\t\t\t\t\tthis._meshesDirty = true;\n\t\t\t\t} else {\n\t\t\t\t\tthis._createMeshes();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tget renderMode() {\n\t\treturn this._renderMode;\n\t}\n\tget meshes() {\n\t\treturn this._meshes;\n\t}\n\t_createMeshes() {\n\t\tconst len = this._meshes.length;\n\t\tfor (let i = 0; i < len; i++) {\n\t\t\tconst mesh = this._meshes[i];\n\t\t\tif (mesh) {\n\t\t\t\tmesh.destroy();\n\t\t\t}\n\t\t}\n\t\tconst count = this._frameKeys.length;\n\t\tthis._meshes = new Array(count);\n\t\tconst createMeshFunc = this.renderMode === SPRITE_RENDERMODE_SLICED || this._renderMode === SPRITE_RENDERMODE_TILED ? this._create9SliceMesh : this._createSimpleMesh;\n\t\tfor (let i = 0; i < count; i++) {\n\t\t\tconst frame = this._atlas.frames[this._frameKeys[i]];\n\t\t\tthis._meshes[i] = frame ? createMeshFunc.call(this, frame) : null;\n\t\t}\n\t\tthis.fire('set:meshes');\n\t}\n\t_createSimpleMesh(frame) {\n\t\tconst rect = frame.rect;\n\t\tconst texWidth = this._atlas.texture.width;\n\t\tconst texHeight = this._atlas.texture.height;\n\t\tconst w = rect.z / this._pixelsPerUnit;\n\t\tconst h = rect.w / this._pixelsPerUnit;\n\t\tconst hp = frame.pivot.x;\n\t\tconst vp = frame.pivot.y;\n\t\tconst positions = [-hp * w, -vp * h, 0, (1 - hp) * w, -vp * h, 0, (1 - hp) * w, (1 - vp) * h, 0, -hp * w, (1 - vp) * h, 0];\n\t\tconst lu = rect.x / texWidth;\n\t\tconst bv = 1.0 - rect.y / texHeight;\n\t\tconst ru = (rect.x + rect.z) / texWidth;\n\t\tconst tv = 1.0 - (rect.y + rect.w) / texHeight;\n\t\tconst uvs = [lu, bv, ru, bv, ru, tv, lu, tv];\n\t\tconst mesh = createMesh(this._device, positions, {\n\t\t\tuvs: uvs,\n\t\t\tnormals: spriteNormals,\n\t\t\tindices: spriteIndices\n\t\t});\n\t\treturn mesh;\n\t}\n\t_create9SliceMesh() {\n\t\tconst he = Vec2.ONE;\n\t\tconst ws = 3;\n\t\tconst ls = 3;\n\t\tconst positions = [];\n\t\tconst normals = [];\n\t\tconst uvs = [];\n\t\tconst indices = [];\n\t\tlet vcounter = 0;\n\t\tfor (let i = 0; i <= ws; i++) {\n\t\t\tconst u = i === 0 || i === ws ? 0 : 1;\n\t\t\tfor (let j = 0; j <= ls; j++) {\n\t\t\t\tconst x = -he.x + 2.0 * he.x * (i <= 1 ? 0 : 3) / ws;\n\t\t\t\tconst y = 0.0;\n\t\t\t\tconst z = -(-he.y + 2.0 * he.y * (j <= 1 ? 0 : 3) / ls);\n\t\t\t\tconst v = j === 0 || j === ls ? 0 : 1;\n\t\t\t\tpositions.push(-x, y, z);\n\t\t\t\tnormals.push(0.0, 1.0, 0.0);\n\t\t\t\tuvs.push(u, v);\n\t\t\t\tif (i < ws && j < ls) {\n\t\t\t\t\tindices.push(vcounter + ls + 1, vcounter + 1, vcounter);\n\t\t\t\t\tindices.push(vcounter + ls + 1, vcounter + ls + 2, vcounter + 1);\n\t\t\t\t}\n\t\t\t\tvcounter++;\n\t\t\t}\n\t\t}\n\t\tconst options = {\n\t\t\tnormals: normals,\n\t\t\tuvs: uvs,\n\t\t\tindices: indices\n\t\t};\n\t\treturn createMesh(this._device, positions, options);\n\t}\n\t_onSetFrames(frames) {\n\t\tif (this._updatingProperties) {\n\t\t\tthis._meshesDirty = true;\n\t\t} else {\n\t\t\tthis._createMeshes();\n\t\t}\n\t}\n\t_onFrameChanged(frameKey, frame) {\n\t\tconst idx = this._frameKeys.indexOf(frameKey);\n\t\tif (idx < 0) return;\n\t\tif (frame) {\n\t\t\tif (this.renderMode === SPRITE_RENDERMODE_SIMPLE) {\n\t\t\t\tthis._meshes[idx] = this._createSimpleMesh(frame);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._meshes[idx] = null;\n\t\t}\n\t\tthis.fire('set:meshes');\n\t}\n\t_onFrameRemoved(frameKey) {\n\t\tconst idx = this._frameKeys.indexOf(frameKey);\n\t\tif (idx < 0) return;\n\t\tthis._meshes[idx] = null;\n\t\tthis.fire('set:meshes');\n\t}\n\tstartUpdate() {\n\t\tthis._updatingProperties = true;\n\t\tthis._meshesDirty = false;\n\t}\n\tendUpdate() {\n\t\tthis._updatingProperties = false;\n\t\tif (this._meshesDirty && this._atlas && this._frameKeys) {\n\t\t\tthis._createMeshes();\n\t\t}\n\t\tthis._meshesDirty = false;\n\t}\n\tdestroy() {\n\t\tfor (const mesh of this._meshes) {\n\t\t\tif (mesh) mesh.destroy();\n\t\t}\n\t\tthis._meshes.length = 0;\n\t}\n}\n\nexport { Sprite };\n","import { EventHandler } from '../core/event-handler.js';\n\nclass TextureAtlas extends EventHandler {\n\tconstructor() {\n\t\tsuper();\n\t\tthis._texture = null;\n\t\tthis._frames = null;\n\t}\n\tset texture(value) {\n\t\tthis._texture = value;\n\t\tthis.fire('set:texture', value);\n\t}\n\tget texture() {\n\t\treturn this._texture;\n\t}\n\tset frames(value) {\n\t\tthis._frames = value;\n\t\tthis.fire('set:frames', value);\n\t}\n\tget frames() {\n\t\treturn this._frames;\n\t}\n\tsetFrame(key, data) {\n\t\tlet frame = this._frames[key];\n\t\tif (!frame) {\n\t\t\tframe = {\n\t\t\t\trect: data.rect.clone(),\n\t\t\t\tpivot: data.pivot.clone(),\n\t\t\t\tborder: data.border.clone()\n\t\t\t};\n\t\t\tthis._frames[key] = frame;\n\t\t} else {\n\t\t\tframe.rect.copy(data.rect);\n\t\t\tframe.pivot.copy(data.pivot);\n\t\t\tframe.border.copy(data.border);\n\t\t}\n\t\tthis.fire('set:frame', key.toString(), frame);\n\t}\n\tremoveFrame(key) {\n\t\tconst frame = this._frames[key];\n\t\tif (frame) {\n\t\t\tdelete this._frames[key];\n\t\t\tthis.fire('remove:frame', key.toString(), frame);\n\t\t}\n\t}\n\tdestroy() {\n\t\tif (this._texture) {\n\t\t\tthis._texture.destroy();\n\t\t}\n\t}\n}\n\nexport { TextureAtlas };\n","class Key {\n\tconstructor(time, position, rotation, scale) {\n\t\tthis.time = time;\n\t\tthis.position = position;\n\t\tthis.rotation = rotation;\n\t\tthis.scale = scale;\n\t}\n}\nclass Node {\n\tconstructor() {\n\t\tthis._name = '';\n\t\tthis._keys = [];\n\t}\n}\nclass Animation {\n\tconstructor() {\n\t\tthis.name = '';\n\t\tthis.duration = 0;\n\t\tthis._nodes = [];\n\t\tthis._nodeDict = {};\n\t}\n\tgetNode(name) {\n\t\treturn this._nodeDict[name];\n\t}\n\taddNode(node) {\n\t\tthis._nodes.push(node);\n\t\tthis._nodeDict[node._name] = node;\n\t}\n\tget nodes() {\n\t\treturn this._nodes;\n\t}\n}\n\nexport { Animation, Key, Node };\n","import '../../core/tracing.js';\nimport { Quat } from '../../core/math/quat.js';\nimport { Vec3 } from '../../core/math/vec3.js';\n\nclass InterpolatedKey {\n\tconstructor() {\n\t\tthis._written = false;\n\t\tthis._name = '';\n\t\tthis._keyFrames = [];\n\t\tthis._quat = new Quat();\n\t\tthis._pos = new Vec3();\n\t\tthis._scale = new Vec3();\n\t\tthis._targetNode = null;\n\t}\n\tgetTarget() {\n\t\treturn this._targetNode;\n\t}\n\tsetTarget(node) {\n\t\tthis._targetNode = node;\n\t}\n}\nclass Skeleton {\n\tconstructor(graph) {\n\t\tthis.looping = true;\n\t\tthis._animation = null;\n\t\tthis._time = 0;\n\t\tthis._interpolatedKeys = [];\n\t\tthis._interpolatedKeyDict = {};\n\t\tthis._currKeyIndices = {};\n\t\tthis.graph = null;\n\t\tconst addInterpolatedKeys = node => {\n\t\t\tconst interpKey = new InterpolatedKey();\n\t\t\tinterpKey._name = node.name;\n\t\t\tthis._interpolatedKeys.push(interpKey);\n\t\t\tthis._interpolatedKeyDict[node.name] = interpKey;\n\t\t\tthis._currKeyIndices[node.name] = 0;\n\t\t\tfor (let i = 0; i < node._children.length; i++) addInterpolatedKeys(node._children[i]);\n\t\t};\n\t\taddInterpolatedKeys(graph);\n\t}\n\tset animation(value) {\n\t\tthis._animation = value;\n\t\tthis.currentTime = 0;\n\t}\n\tget animation() {\n\t\treturn this._animation;\n\t}\n\tset currentTime(value) {\n\t\tthis._time = value;\n\t\tconst numNodes = this._interpolatedKeys.length;\n\t\tfor (let i = 0; i < numNodes; i++) {\n\t\t\tconst node = this._interpolatedKeys[i];\n\t\t\tconst nodeName = node._name;\n\t\t\tthis._currKeyIndices[nodeName] = 0;\n\t\t}\n\t\tthis.addTime(0);\n\t\tthis.updateGraph();\n\t}\n\tget currentTime() {\n\t\treturn this._time;\n\t}\n\tget numNodes() {\n\t\treturn this._interpolatedKeys.length;\n\t}\n\taddTime(delta) {\n\t\tif (this._animation !== null) {\n\t\t\tconst nodes = this._animation._nodes;\n\t\t\tconst duration = this._animation.duration;\n\t\t\tif (this._time === duration && !this.looping) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._time += delta;\n\t\t\tif (this._time > duration) {\n\t\t\t\tthis._time = this.looping ? 0.0 : duration;\n\t\t\t\tfor (let i = 0; i < nodes.length; i++) {\n\t\t\t\t\tconst node = nodes[i];\n\t\t\t\t\tconst nodeName = node._name;\n\t\t\t\t\tthis._currKeyIndices[nodeName] = 0;\n\t\t\t\t}\n\t\t\t} else if (this._time < 0) {\n\t\t\t\tthis._time = this.looping ? duration : 0.0;\n\t\t\t\tfor (let i = 0; i < nodes.length; i++) {\n\t\t\t\t\tconst node = nodes[i];\n\t\t\t\t\tconst nodeName = node._name;\n\t\t\t\t\tthis._currKeyIndices[nodeName] = node._keys.length - 2;\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst offset = delta >= 0 ? 1 : -1;\n\t\t\tfor (let i = 0; i < nodes.length; i++) {\n\t\t\t\tconst node = nodes[i];\n\t\t\t\tconst nodeName = node._name;\n\t\t\t\tconst keys = node._keys;\n\t\t\t\tconst interpKey = this._interpolatedKeyDict[nodeName];\n\t\t\t\tif (interpKey === undefined) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tlet foundKey = false;\n\t\t\t\tif (keys.length !== 1) {\n\t\t\t\t\tfor (let currKeyIndex = this._currKeyIndices[nodeName]; currKeyIndex < keys.length - 1 && currKeyIndex >= 0; currKeyIndex += offset) {\n\t\t\t\t\t\tconst k1 = keys[currKeyIndex];\n\t\t\t\t\t\tconst k2 = keys[currKeyIndex + 1];\n\t\t\t\t\t\tif (k1.time <= this._time && k2.time >= this._time) {\n\t\t\t\t\t\t\tconst alpha = (this._time - k1.time) / (k2.time - k1.time);\n\t\t\t\t\t\t\tinterpKey._pos.lerp(k1.position, k2.position, alpha);\n\t\t\t\t\t\t\tinterpKey._quat.slerp(k1.rotation, k2.rotation, alpha);\n\t\t\t\t\t\t\tinterpKey._scale.lerp(k1.scale, k2.scale, alpha);\n\t\t\t\t\t\t\tinterpKey._written = true;\n\t\t\t\t\t\t\tthis._currKeyIndices[nodeName] = currKeyIndex;\n\t\t\t\t\t\t\tfoundKey = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (keys.length === 1 || !foundKey && this._time === 0.0 && this.looping) {\n\t\t\t\t\tinterpKey._pos.copy(keys[0].position);\n\t\t\t\t\tinterpKey._quat.copy(keys[0].rotation);\n\t\t\t\t\tinterpKey._scale.copy(keys[0].scale);\n\t\t\t\t\tinterpKey._written = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tblend(skel1, skel2, alpha) {\n\t\tconst numNodes = this._interpolatedKeys.length;\n\t\tfor (let i = 0; i < numNodes; i++) {\n\t\t\tconst key1 = skel1._interpolatedKeys[i];\n\t\t\tconst key2 = skel2._interpolatedKeys[i];\n\t\t\tconst dstKey = this._interpolatedKeys[i];\n\t\t\tif (key1._written && key2._written) {\n\t\t\t\tdstKey._quat.slerp(key1._quat, skel2._interpolatedKeys[i]._quat, alpha);\n\t\t\t\tdstKey._pos.lerp(key1._pos, skel2._interpolatedKeys[i]._pos, alpha);\n\t\t\t\tdstKey._scale.lerp(key1._scale, key2._scale, alpha);\n\t\t\t\tdstKey._written = true;\n\t\t\t} else if (key1._written) {\n\t\t\t\tdstKey._quat.copy(key1._quat);\n\t\t\t\tdstKey._pos.copy(key1._pos);\n\t\t\t\tdstKey._scale.copy(key1._scale);\n\t\t\t\tdstKey._written = true;\n\t\t\t} else if (key2._written) {\n\t\t\t\tdstKey._quat.copy(key2._quat);\n\t\t\t\tdstKey._pos.copy(key2._pos);\n\t\t\t\tdstKey._scale.copy(key2._scale);\n\t\t\t\tdstKey._written = true;\n\t\t\t}\n\t\t}\n\t}\n\tsetGraph(graph) {\n\t\tthis.graph = graph;\n\t\tif (graph) {\n\t\t\tfor (let i = 0; i < this._interpolatedKeys.length; i++) {\n\t\t\t\tconst interpKey = this._interpolatedKeys[i];\n\t\t\t\tconst graphNode = graph.findByName(interpKey._name);\n\t\t\t\tthis._interpolatedKeys[i].setTarget(graphNode);\n\t\t\t}\n\t\t} else {\n\t\t\tfor (let i = 0; i < this._interpolatedKeys.length; i++) {\n\t\t\t\tthis._interpolatedKeys[i].setTarget(null);\n\t\t\t}\n\t\t}\n\t}\n\tupdateGraph() {\n\t\tif (this.graph) {\n\t\t\tfor (let i = 0; i < this._interpolatedKeys.length; i++) {\n\t\t\t\tconst interpKey = this._interpolatedKeys[i];\n\t\t\t\tif (interpKey._written) {\n\t\t\t\t\tconst transform = interpKey.getTarget();\n\t\t\t\t\ttransform.localPosition.copy(interpKey._pos);\n\t\t\t\t\ttransform.localRotation.copy(interpKey._quat);\n\t\t\t\t\ttransform.localScale.copy(interpKey._scale);\n\t\t\t\t\tif (!transform._dirtyLocal) transform._dirtifyLocal();\n\t\t\t\t\tinterpKey._written = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport { Skeleton };\n","import '../../core/tracing.js';\nimport { hashCode } from '../../core/hash.js';\nimport { version, revision } from '../../core/core.js';\nimport { Shader } from '../../platform/graphics/shader.js';\nimport { SHADER_FORWARD, SHADER_SHADOW, SHADER_DEPTH, SHADER_PICK } from '../constants.js';\nimport { ShaderPass } from '../shader-pass.js';\nimport { StandardMaterialOptions } from '../materials/standard-material-options.js';\n\nclass ProgramLibrary {\n\tconstructor(device, standardMaterial) {\n\t\tthis.processedCache = new Map();\n\t\tthis.definitionsCache = new Map();\n\t\tthis._generators = new Map();\n\t\tthis._device = device;\n\t\tthis._isClearingCache = false;\n\t\tthis._precached = false;\n\t\tthis._programsCollection = [];\n\t\tthis._defaultStdMatOption = new StandardMaterialOptions();\n\t\tthis._defaultStdMatOptionMin = new StandardMaterialOptions();\n\t\tstandardMaterial.shaderOptBuilder.updateRef(this._defaultStdMatOption, {}, standardMaterial, null, [], SHADER_FORWARD, null);\n\t\tstandardMaterial.shaderOptBuilder.updateMinRef(this._defaultStdMatOptionMin, {}, standardMaterial, null, SHADER_SHADOW, null);\n\t\tdevice.on('destroy:shader', shader => {\n\t\t\tthis.removeFromCache(shader);\n\t\t});\n\t}\n\tdestroy() {\n\t\tthis.clearCache();\n\t}\n\tregister(name, generator) {\n\t\tif (!this._generators.has(name)) {\n\t\t\tthis._generators.set(name, generator);\n\t\t}\n\t}\n\tunregister(name) {\n\t\tif (this._generators.has(name)) {\n\t\t\tthis._generators.delete(name);\n\t\t}\n\t}\n\tisRegistered(name) {\n\t\treturn this._generators.has(name);\n\t}\n\tgenerateShaderDefinition(generator, name, key, options) {\n\t\tlet def = this.definitionsCache.get(key);\n\t\tif (!def) {\n\t\t\tvar _options$litOptions, _options$litOptions2, _def$name;\n\t\t\tlet lights;\n\t\t\tif ((_options$litOptions = options.litOptions) != null && _options$litOptions.lights) {\n\t\t\t\tlights = options.litOptions.lights;\n\t\t\t\toptions.litOptions.lights = lights.map(function (l) {\n\t\t\t\t\tconst lcopy = l.clone ? l.clone() : l;\n\t\t\t\t\tlcopy.key = l.key;\n\t\t\t\t\treturn lcopy;\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.storeNewProgram(name, options);\n\t\t\tif ((_options$litOptions2 = options.litOptions) != null && _options$litOptions2.lights) options.litOptions.lights = lights;\n\t\t\tif (this._precached) ;\n\t\t\tconst device = this._device;\n\t\t\tdef = generator.createShaderDefinition(device, options);\n\t\t\tdef.name = (_def$name = def.name) != null ? _def$name : options.pass ? `${name}-pass:${options.pass}` : name;\n\t\t\tthis.definitionsCache.set(key, def);\n\t\t}\n\t\treturn def;\n\t}\n\tgetCachedShader(key) {\n\t\treturn this.processedCache.get(key);\n\t}\n\tsetCachedShader(key, shader) {\n\t\tthis.processedCache.set(key, shader);\n\t}\n\tgetProgram(name, options, processingOptions, userMaterialId) {\n\t\tconst generator = this._generators.get(name);\n\t\tif (!generator) {\n\t\t\treturn null;\n\t\t}\n\t\tconst generationKeyString = generator.generateKey(options);\n\t\tconst generationKey = hashCode(generationKeyString);\n\t\tconst processingKeyString = processingOptions.generateKey(this._device);\n\t\tconst processingKey = hashCode(processingKeyString);\n\t\tconst totalKey = `${generationKey}#${processingKey}`;\n\t\tlet processedShader = this.getCachedShader(totalKey);\n\t\tif (!processedShader) {\n\t\t\tconst generatedShaderDef = this.generateShaderDefinition(generator, name, generationKey, options);\n\t\t\tlet passName = '';\n\t\t\tlet shaderPassInfo;\n\t\t\tif (options.pass !== undefined) {\n\t\t\t\tshaderPassInfo = ShaderPass.get(this._device).getByIndex(options.pass);\n\t\t\t\tpassName = `-${shaderPassInfo.name}`;\n\t\t\t}\n\t\t\tthis._device.fire('shader:generate', {\n\t\t\t\tuserMaterialId,\n\t\t\t\tshaderPassInfo,\n\t\t\t\tdefinition: generatedShaderDef\n\t\t\t});\n\t\t\tconst shaderDefinition = {\n\t\t\t\tname: `${generatedShaderDef.name}${passName}-proc`,\n\t\t\t\tattributes: generatedShaderDef.attributes,\n\t\t\t\tvshader: generatedShaderDef.vshader,\n\t\t\t\tfshader: generatedShaderDef.fshader,\n\t\t\t\tprocessingOptions: processingOptions\n\t\t\t};\n\t\t\tprocessedShader = new Shader(this._device, shaderDefinition);\n\t\t\tthis.setCachedShader(totalKey, processedShader);\n\t\t}\n\t\treturn processedShader;\n\t}\n\tstoreNewProgram(name, options) {\n\t\tlet opt = {};\n\t\tif (name === \"standard\") {\n\t\t\tconst defaultMat = this._getDefaultStdMatOptions(options.pass);\n\t\t\tfor (const p in options) {\n\t\t\t\tif (options.hasOwnProperty(p) && defaultMat[p] !== options[p] || p === \"pass\") opt[p] = options[p];\n\t\t\t}\n\t\t\tfor (const p in options.litOptions) {\n\t\t\t\topt[p] = options.litOptions[p];\n\t\t\t}\n\t\t} else {\n\t\t\topt = options;\n\t\t}\n\t\tthis._programsCollection.push(JSON.stringify({\n\t\t\tname: name,\n\t\t\toptions: opt\n\t\t}));\n\t}\n\tdumpPrograms() {\n\t\tlet text = 'let device = pc.app ? pc.app.graphicsDevice : pc.Application.getApplication().graphicsDevice;\\n';\n\t\ttext += 'let shaders = [';\n\t\tif (this._programsCollection[0]) text += '\\n\\t' + this._programsCollection[0];\n\t\tfor (let i = 1; i < this._programsCollection.length; ++i) {\n\t\t\ttext += ',\\n\\t' + this._programsCollection[i];\n\t\t}\n\t\ttext += '\\n];\\n';\n\t\ttext += 'device.getProgramLibrary().precompile(shaders);\\n';\n\t\ttext += 'if (pc.version != \\\"' + version + '\\\" || pc.revision != \\\"' + revision + '\\\")\\n';\n\t\ttext += '\\tconsole.warn(\\\"precompile-shaders.js: engine version mismatch, rebuild shaders lib with current engine\\\");';\n\t\tconst element = document.createElement('a');\n\t\telement.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));\n\t\telement.setAttribute('download', 'precompile-shaders.js');\n\t\telement.style.display = 'none';\n\t\tdocument.body.appendChild(element);\n\t\telement.click();\n\t\tdocument.body.removeChild(element);\n\t}\n\tclearCache() {\n\t\tthis._isClearingCache = true;\n\t\tthis.processedCache.forEach(shader => {\n\t\t\tshader.destroy();\n\t\t});\n\t\tthis.processedCache.clear();\n\t\tthis._isClearingCache = false;\n\t}\n\tremoveFromCache(shader) {\n\t\tif (this._isClearingCache) return;\n\t\tthis.processedCache.forEach((cachedShader, key) => {\n\t\t\tif (shader === cachedShader) {\n\t\t\t\tthis.processedCache.delete(key);\n\t\t\t}\n\t\t});\n\t}\n\t_getDefaultStdMatOptions(pass) {\n\t\tconst shaderPassInfo = ShaderPass.get(this._device).getByIndex(pass);\n\t\treturn pass === SHADER_DEPTH || pass === SHADER_PICK || shaderPassInfo.isShadow ? this._defaultStdMatOptionMin : this._defaultStdMatOption;\n\t}\n\tprecompile(cache) {\n\t\tif (cache) {\n\t\t\tconst shaders = new Array(cache.length);\n\t\t\tfor (let i = 0; i < cache.length; i++) {\n\t\t\t\tif (cache[i].name === \"standard\") {\n\t\t\t\t\tconst opt = cache[i].options;\n\t\t\t\t\tconst defaultMat = this._getDefaultStdMatOptions(opt.pass);\n\t\t\t\t\tfor (const p in defaultMat) {\n\t\t\t\t\t\tif (defaultMat.hasOwnProperty(p) && opt[p] === undefined) opt[p] = defaultMat[p];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tshaders[i] = this.getProgram(cache[i].name, cache[i].options);\n\t\t\t}\n\t\t}\n\t\tthis._precached = true;\n\t}\n}\n\nexport { ProgramLibrary };\n","var bakeDirLmEndPS = `\n\tvec4 dirLm = texture2D(texture_dirLightMap, vUv1);\n\tif (bakeDir > 0.5) {\n\t\tif (dAtten > 0.00001) {\n\t\t\tdirLm.xyz = dirLm.xyz * 2.0 - vec3(1.0);\n\t\t\tdAtten = saturate(dAtten);\n\t\t\tgl_FragColor.rgb = normalize(dLightDirNormW.xyz*dAtten + dirLm.xyz*dirLm.w) * 0.5 + vec3(0.5);\n\t\t\tgl_FragColor.a = dirLm.w + dAtten;\n\t\t\tgl_FragColor.a = max(gl_FragColor.a, 1.0 / 255.0);\n\t\t} else {\n\t\t\tgl_FragColor = dirLm;\n\t\t}\n\t} else {\n\t\tgl_FragColor.rgb = dirLm.xyz;\n\t\tgl_FragColor.a = max(dirLm.w, dAtten > 0.00001? (1.0/255.0) : 0.0);\n\t}\n`;\n\nexport { bakeDirLmEndPS as default };\n","var bakeLmEndPS = `\n#ifdef LIGHTMAP_RGBM\n\tgl_FragColor.rgb = dDiffuseLight;\n\tgl_FragColor.rgb = pow(gl_FragColor.rgb, vec3(0.5));\n\tgl_FragColor.rgb /= 8.0;\n\tgl_FragColor.a = clamp( max( max( gl_FragColor.r, gl_FragColor.g ), max( gl_FragColor.b, 1.0 / 255.0 ) ), 0.0,1.0 );\n\tgl_FragColor.a = ceil(gl_FragColor.a * 255.0) / 255.0;\n\tgl_FragColor.rgb /= gl_FragColor.a;\n#else\n\tgl_FragColor = vec4(dDiffuseLight, 1.0);\n#endif\n`;\n\nexport { bakeLmEndPS as default };\n","var dilatePS = `\nvarying vec2 vUv0;\nuniform sampler2D source;\nuniform vec2 pixelOffset;\nvoid main(void) {\n\tvec4 c = texture2D(source, vUv0);\n\tc = c.a>0.0? c : texture2D(source, vUv0 - pixelOffset);\n\tc = c.a>0.0? c : texture2D(source, vUv0 + vec2(0, -pixelOffset.y));\n\tc = c.a>0.0? c : texture2D(source, vUv0 + vec2(pixelOffset.x, -pixelOffset.y));\n\tc = c.a>0.0? c : texture2D(source, vUv0 + vec2(-pixelOffset.x, 0));\n\tc = c.a>0.0? c : texture2D(source, vUv0 + vec2(pixelOffset.x, 0));\n\tc = c.a>0.0? c : texture2D(source, vUv0 + vec2(-pixelOffset.x, pixelOffset.y));\n\tc = c.a>0.0? c : texture2D(source, vUv0 + vec2(0, pixelOffset.y));\n\tc = c.a>0.0? c : texture2D(source, vUv0 + pixelOffset);\n\tgl_FragColor = c;\n}\n`;\n\nexport { dilatePS as default };\n","var bilateralDeNoisePS = `\nfloat normpdf3(in vec3 v, in float sigma) {\n\treturn 0.39894 * exp(-0.5 * dot(v, v) / (sigma * sigma)) / sigma;\n}\nvec3 decodeRGBM(vec4 rgbm) {\n\tvec3 color = (8.0 * rgbm.a) * rgbm.rgb;\n\treturn color * color;\n}\nfloat saturate(float x) {\n\treturn clamp(x, 0.0, 1.0);\n}\nvec4 encodeRGBM(vec3 color) {\n\tvec4 encoded;\n\tencoded.rgb = pow(color.rgb, vec3(0.5));\n\tencoded.rgb *= 1.0 / 8.0;\n\tencoded.a = saturate( max( max( encoded.r, encoded.g ), max( encoded.b, 1.0 / 255.0 ) ) );\n\tencoded.a = ceil(encoded.a * 255.0) / 255.0;\n\tencoded.rgb /= encoded.a;\n\treturn encoded;\n}\n#define MSIZE 15\nvarying vec2 vUv0;\nuniform sampler2D source;\nuniform vec2 pixelOffset;\nuniform vec2 sigmas;\nuniform float bZnorm;\nuniform float kernel[MSIZE];\nvoid main(void) {\n\t\n\tvec4 pixelRgbm = texture2D(source, vUv0);\n\tif (pixelRgbm.a <= 0.0) {\n\t\tgl_FragColor = pixelRgbm;\n\t\treturn ;\n\t}\n\tfloat sigma = sigmas.x;\n\tfloat bSigma = sigmas.y;\n\tvec3 pixelHdr = decodeRGBM(pixelRgbm);\n\tvec3 accumulatedHdr = vec3(0.0);\n\tfloat accumulatedFactor = 0.0;\n\tconst int kSize = (MSIZE-1)/2;\n\tfor (int i = -kSize; i <= kSize; ++i) {\n\t\tfor (int j = -kSize; j <= kSize; ++j) {\n\t\t\t\n\t\t\tvec2 coord = vUv0 + vec2(float(i), float(j)) * pixelOffset;\n\t\t\tvec4 rgbm = texture2D(source, coord);\n\t\t\tif (rgbm.a > 0.0) {\n\t\t\t\tvec3 hdr = decodeRGBM(rgbm);\n\t\t\t\tfloat factor = kernel[kSize + j] * kernel[kSize + i];\n\t\t\t\tfactor *= normpdf3(hdr - pixelHdr, bSigma) * bZnorm;\n\t\t\t\taccumulatedHdr += factor * hdr;\n\t\t\t\taccumulatedFactor += factor;\n\t\t\t}\n\t\t}\n\t}\n\tgl_FragColor = encodeRGBM(accumulatedHdr / accumulatedFactor);\n}\n`;\n\nexport { bilateralDeNoisePS as default };\n","import bakeDirLmEndPS from './lightmapper/frag/bakeDirLmEnd.js';\nimport bakeLmEndPS from './lightmapper/frag/bakeLmEnd.js';\nimport dilatePS from './lightmapper/frag/dilate.js';\nimport bilateralDeNoisePS from './lightmapper/frag/bilateralDeNoise.js';\n\nconst shaderChunksLightmapper = {\n\tbakeDirLmEndPS,\n\tbakeLmEndPS,\n\tdilatePS,\n\tbilateralDeNoisePS\n};\n\nexport { shaderChunksLightmapper };\n","const FILLMODE_NONE = 'NONE';\nconst FILLMODE_FILL_WINDOW = 'FILL_WINDOW';\nconst FILLMODE_KEEP_ASPECT = 'KEEP_ASPECT';\nconst RESOLUTION_AUTO = 'AUTO';\nconst RESOLUTION_FIXED = 'FIXED';\n\nexport { FILLMODE_FILL_WINDOW, FILLMODE_KEEP_ASPECT, FILLMODE_NONE, RESOLUTION_AUTO, RESOLUTION_FIXED };\n","import { GraphicsDeviceAccess } from '../platform/graphics/graphics-device-access.js';\n\nlet currentApplication;\nfunction getApplication() {\n\treturn currentApplication;\n}\nfunction setApplication(app) {\n\tcurrentApplication = app;\n\tGraphicsDeviceAccess.set(app == null ? void 0 : app.graphicsDevice);\n}\n\nexport { getApplication, setApplication };\n","class ScriptTypes {\n\tstatic push(Type, isLegacy) {\n\t\tif (isLegacy && ScriptTypes._types.length > 0) {\n\t\t\tconsole.assert('Script Ordering Error. Contact support@playcanvas.com');\n\t\t} else {\n\t\t\tScriptTypes._types.push(Type);\n\t\t}\n\t}\n}\nScriptTypes._types = [];\n\nexport { ScriptTypes };\n","import { events } from '../core/events.js';\nimport { getApplication } from './globals.js';\nimport { ScriptTypes } from './script/script-types.js';\n\nlet _legacy = false;\nlet _createdLoadingScreen = false;\nconst script = {\n\tapp: null,\n\tcreate: function (name, callback) {\n\t\tif (!_legacy) return;\n\t\tconst ScriptType = callback(script.app);\n\t\tScriptType._pcScriptName = name;\n\t\tScriptTypes.push(ScriptType, _legacy);\n\t\tthis.fire(\"created\", name, callback);\n\t},\n\tattribute: function (name, type, defaultValue, options) {},\n\tcreateLoadingScreen: function (callback) {\n\t\tif (_createdLoadingScreen) return;\n\t\t_createdLoadingScreen = true;\n\t\tconst app = getApplication();\n\t\tcallback(app);\n\t}\n};\nObject.defineProperty(script, 'legacy', {\n\tget: function () {\n\t\treturn _legacy;\n\t},\n\tset: function (value) {\n\t\t_legacy = value;\n\t}\n});\nevents.attach(script);\n\nexport { script };\n","import '../core/tracing.js';\n\nclass FrameGraph {\n\tconstructor() {\n\t\tthis.renderPasses = [];\n\t\tthis.renderTargetMap = new Map();\n\t}\n\taddRenderPass(renderPass) {\n\t\trenderPass.frameUpdate();\n\t\tconst passes = this.renderPasses;\n\t\tconst beforePasses = renderPass.beforePasses;\n\t\tfor (let i = 0; i < beforePasses.length; i++) {\n\t\t\tconst pass = beforePasses[i];\n\t\t\tif (pass.enabled) {\n\t\t\t\tpass.frameUpdate();\n\t\t\t\tpasses.push(pass);\n\t\t\t}\n\t\t}\n\t\tif (renderPass.enabled) {\n\t\t\trenderPass.frameUpdate();\n\t\t\tpasses.push(renderPass);\n\t\t}\n\t\tconst afterPasses = renderPass.afterPasses;\n\t\tfor (let i = 0; i < afterPasses.length; i++) {\n\t\t\tconst pass = afterPasses[i];\n\t\t\tif (pass.enabled) {\n\t\t\t\tpass.frameUpdate();\n\t\t\t\tpasses.push(pass);\n\t\t\t}\n\t\t}\n\t}\n\treset() {\n\t\tthis.renderPasses.length = 0;\n\t}\n\tcompile() {\n\t\tconst renderTargetMap = this.renderTargetMap;\n\t\tconst renderPasses = this.renderPasses;\n\t\tfor (let i = 0; i < renderPasses.length; i++) {\n\t\t\tconst renderPass = renderPasses[i];\n\t\t\tconst renderTarget = renderPass.renderTarget;\n\t\t\tif (renderTarget !== undefined) {\n\t\t\t\tconst prevPass = renderTargetMap.get(renderTarget);\n\t\t\t\tif (prevPass) {\n\t\t\t\t\tconst count = renderPass.colorArrayOps.length;\n\t\t\t\t\tfor (let j = 0; j < count; j++) {\n\t\t\t\t\t\tconst colorOps = renderPass.colorArrayOps[j];\n\t\t\t\t\t\tif (!colorOps.clear) {\n\t\t\t\t\t\t\tprevPass.colorArrayOps[j].store = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (!renderPass.depthStencilOps.clearDepth) {\n\t\t\t\t\t\tprevPass.depthStencilOps.storeDepth = true;\n\t\t\t\t\t}\n\t\t\t\t\tif (!renderPass.depthStencilOps.clearStencil) {\n\t\t\t\t\t\tprevPass.depthStencilOps.storeStencil = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\trenderTargetMap.set(renderTarget, renderPass);\n\t\t\t}\n\t\t}\n\t\tlet lastCubeTexture = null;\n\t\tlet lastCubeRenderPass = null;\n\t\tfor (let i = 0; i < renderPasses.length; i++) {\n\t\t\tconst renderPass = renderPasses[i];\n\t\t\tconst renderTarget = renderPass.renderTarget;\n\t\t\tconst thisTexture = renderTarget == null ? void 0 : renderTarget.colorBuffer;\n\t\t\tif (thisTexture != null && thisTexture.cubemap) {\n\t\t\t\tif (lastCubeTexture === thisTexture) {\n\t\t\t\t\tconst count = lastCubeRenderPass.colorArrayOps.length;\n\t\t\t\t\tfor (let j = 0; j < count; j++) {\n\t\t\t\t\t\tlastCubeRenderPass.colorArrayOps[j].mipmaps = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlastCubeTexture = renderTarget.colorBuffer;\n\t\t\t\tlastCubeRenderPass = renderPass;\n\t\t\t} else if (renderPass.requiresCubemaps) {\n\t\t\t\tlastCubeTexture = null;\n\t\t\t\tlastCubeRenderPass = null;\n\t\t\t}\n\t\t}\n\t\trenderTargetMap.clear();\n\t}\n\trender(device) {\n\t\tthis.compile();\n\t\tconst renderPasses = this.renderPasses;\n\t\tfor (let i = 0; i < renderPasses.length; i++) {\n\t\t\trenderPasses[i].render();\n\t\t}\n\t}\n}\n\nexport { FrameGraph };\n","import { FloatPacking } from '../core/math/float-packing.js';\nimport { Texture } from '../platform/graphics/texture.js';\nimport { DeviceCache } from '../platform/graphics/device-cache.js';\nimport { ADDRESS_CLAMP_TO_EDGE, TEXTURETYPE_DEFAULT, FILTER_LINEAR, FILTER_NEAREST, PIXELFORMAT_RGBA32F, PIXELFORMAT_RGBA16F } from '../platform/graphics/constants.js';\n\nclass AreaLightCacheEntry {\n\tconstructor(texture0, texture1) {\n\t\tthis.texture0 = texture0;\n\t\tthis.texture1 = texture1;\n\t}\n\tdestroy() {\n\t\tvar _this$texture, _this$texture2;\n\t\t(_this$texture = this.texture0) == null || _this$texture.destroy();\n\t\t(_this$texture2 = this.texture1) == null || _this$texture2.destroy();\n\t}\n}\nconst deviceCache = new DeviceCache();\nclass AreaLightLuts {\n\tstatic createTexture(device, format, size, postfix = '') {\n\t\tconst tex = new Texture(device, {\n\t\t\tname: `AreaLightLUT${postfix}`,\n\t\t\twidth: size,\n\t\t\theight: size,\n\t\t\tformat: format,\n\t\t\taddressU: ADDRESS_CLAMP_TO_EDGE,\n\t\t\taddressV: ADDRESS_CLAMP_TO_EDGE,\n\t\t\ttype: TEXTURETYPE_DEFAULT,\n\t\t\tmagFilter: FILTER_LINEAR,\n\t\t\tminFilter: FILTER_NEAREST,\n\t\t\tanisotropy: 1,\n\t\t\tmipmaps: false\n\t\t});\n\t\treturn tex;\n\t}\n\tstatic applyTextures(device, texture1, texture2) {\n\t\tdeviceCache.remove(device);\n\t\tdeviceCache.get(device, () => {\n\t\t\treturn new AreaLightCacheEntry(texture1, texture1 === texture2 ? null : texture2);\n\t\t});\n\t\tdevice.scope.resolve('areaLightsLutTex1').setValue(texture1);\n\t\tdevice.scope.resolve('areaLightsLutTex2').setValue(texture2);\n\t}\n\tstatic createPlaceholder(device) {\n\t\tconst texture = AreaLightLuts.createTexture(device, device.areaLightLutFormat, 2, 'placeholder');\n\t\tconst pixels = texture.lock();\n\t\tpixels.fill(0);\n\t\ttexture.unlock();\n\t\tAreaLightLuts.applyTextures(device, texture, texture);\n\t}\n\tstatic set(device, ltcMat1, ltcMat2) {\n\t\tfunction buildTexture(device, data, format) {\n\t\t\tconst texture = AreaLightLuts.createTexture(device, format, 64);\n\t\t\ttexture.lock().set(data);\n\t\t\ttexture.unlock();\n\t\t\treturn texture;\n\t\t}\n\t\tfunction offsetScale(data, offset, scale) {\n\t\t\tconst count = data.length;\n\t\t\tconst ret = new Float32Array(count);\n\t\t\tfor (let i = 0; i < count; i++) {\n\t\t\t\tconst n = i % 4;\n\t\t\t\tret[i] = (data[i] + offset[n]) * scale[n];\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\t\tfunction convertToHalfFloat(data) {\n\t\t\tconst count = data.length;\n\t\t\tconst ret = new Uint16Array(count);\n\t\t\tconst float2Half = FloatPacking.float2Half;\n\t\t\tfor (let i = 0; i < count; i++) {\n\t\t\t\tret[i] = float2Half(data[i]);\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\t\tfunction convertToUint(data) {\n\t\t\tconst count = data.length;\n\t\t\tconst ret = new Uint8ClampedArray(count);\n\t\t\tfor (let i = 0; i < count; i++) {\n\t\t\t\tret[i] = data[i] * 255;\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\t\tconst srcData1 = ltcMat1;\n\t\tconst srcData2 = ltcMat2;\n\t\tlet data1, data2;\n\t\tconst format = device.areaLightLutFormat;\n\t\tif (format === PIXELFORMAT_RGBA32F) {\n\t\t\tdata1 = srcData1;\n\t\t\tdata2 = srcData2;\n\t\t} else if (format === PIXELFORMAT_RGBA16F) {\n\t\t\tdata1 = convertToHalfFloat(srcData1);\n\t\t\tdata2 = convertToHalfFloat(srcData2);\n\t\t} else {\n\t\t\tconst o1 = [0.0, 0.2976, 0.01381, 0.0];\n\t\t\tconst s1 = [0.999, 3.08737, 1.6546, 0.603249];\n\t\t\tconst o2 = [-0.306897, 0.0, 0.0, 0.0];\n\t\t\tconst s2 = [1.442787, 1.0, 1.0, 1.0];\n\t\t\tdata1 = convertToUint(offsetScale(srcData1, o1, s1));\n\t\t\tdata2 = convertToUint(offsetScale(srcData2, o2, s2));\n\t\t}\n\t\tconst tex1 = buildTexture(device, data1, format);\n\t\tconst tex2 = buildTexture(device, data2, format);\n\t\tAreaLightLuts.applyTextures(device, tex1, tex2);\n\t}\n}\n\nexport { AreaLightLuts };\n","const DEFAULT_LOCALE = 'en-US';\nconst DEFAULT_LOCALE_FALLBACKS = {\n\t'en': 'en-US',\n\t'es': 'en-ES',\n\t'zh': 'zh-CN',\n\t'zh-HK': 'zh-TW',\n\t'zh-TW': 'zh-HK',\n\t'zh-MO': 'zh-HK',\n\t'fr': 'fr-FR',\n\t'de': 'de-DE',\n\t'it': 'it-IT',\n\t'ru': 'ru-RU',\n\t'ja': 'ja-JP'\n};\n\nexport { DEFAULT_LOCALE, DEFAULT_LOCALE_FALLBACKS };\n","import { DEFAULT_LOCALE, DEFAULT_LOCALE_FALLBACKS } from './constants.js';\n\nconst PLURALS = {};\nfunction definePluralFn(locales, fn) {\n\tfor (let i = 0, len = locales.length; i < len; i++) {\n\t\tPLURALS[locales[i]] = fn;\n\t}\n}\nfunction getLang(locale) {\n\tconst idx = locale.indexOf('-');\n\tif (idx !== -1) {\n\t\treturn locale.substring(0, idx);\n\t}\n\treturn locale;\n}\nfunction replaceLang(locale, desiredLang) {\n\tconst idx = locale.indexOf('-');\n\tif (idx !== -1) {\n\t\treturn desiredLang + locale.substring(idx);\n\t}\n\treturn desiredLang;\n}\nfunction findAvailableLocale(desiredLocale, availableLocales) {\n\tif (availableLocales[desiredLocale]) {\n\t\treturn desiredLocale;\n\t}\n\tlet fallback = DEFAULT_LOCALE_FALLBACKS[desiredLocale];\n\tif (fallback && availableLocales[fallback]) {\n\t\treturn fallback;\n\t}\n\tconst lang = getLang(desiredLocale);\n\tfallback = DEFAULT_LOCALE_FALLBACKS[lang];\n\tif (availableLocales[fallback]) {\n\t\treturn fallback;\n\t}\n\tif (availableLocales[lang]) {\n\t\treturn lang;\n\t}\n\treturn DEFAULT_LOCALE;\n}\ndefinePluralFn(['ja', 'ko', 'th', 'vi', 'zh', 'id'], function (n) {\n\treturn 0;\n});\ndefinePluralFn(['fa', 'hi'], function (n) {\n\tif (n >= 0 && n <= 1) {\n\t\treturn 0;\n\t}\n\treturn 1;\n});\ndefinePluralFn(['fr', 'pt'], function (n) {\n\tif (n >= 0 && n < 2) {\n\t\treturn 0;\n\t}\n\treturn 1;\n});\ndefinePluralFn(['da'], function (n) {\n\tif (n === 1 || !Number.isInteger(n) && n >= 0 && n <= 1) {\n\t\treturn 0;\n\t}\n\treturn 1;\n});\ndefinePluralFn(['de', 'en', 'it', 'el', 'es', 'tr', 'fi', 'sv', 'nb', 'no', 'ur'], function (n) {\n\tif (n === 1) {\n\t\treturn 0;\n\t}\n\treturn 1;\n});\ndefinePluralFn(['ru', 'uk'], function (n) {\n\tif (Number.isInteger(n)) {\n\t\tconst mod10 = n % 10;\n\t\tconst mod100 = n % 100;\n\t\tif (mod10 === 1 && mod100 !== 11) {\n\t\t\treturn 0;\n\t\t} else if (mod10 >= 2 && mod10 <= 4 && (mod100 < 12 || mod100 > 14)) {\n\t\t\treturn 1;\n\t\t} else if (mod10 === 0 || mod10 >= 5 && mod10 <= 9 || mod100 >= 11 && mod100 <= 14) {\n\t\t\treturn 2;\n\t\t}\n\t}\n\treturn 3;\n});\ndefinePluralFn(['pl'], function (n) {\n\tif (Number.isInteger(n)) {\n\t\tif (n === 1) {\n\t\t\treturn 0;\n\t\t}\n\t\tconst mod10 = n % 10;\n\t\tconst mod100 = n % 100;\n\t\tif (mod10 >= 2 && mod10 <= 4 && (mod100 < 12 || mod100 > 14)) {\n\t\t\treturn 1;\n\t\t} else if (mod10 >= 0 && mod10 <= 1 || mod10 >= 5 && mod10 <= 9 || mod100 >= 12 && mod100 <= 14) {\n\t\t\treturn 2;\n\t\t}\n\t}\n\treturn 3;\n});\ndefinePluralFn(['ar'], function (n) {\n\tif (n === 0) {\n\t\treturn 0;\n\t} else if (n === 1) {\n\t\treturn 1;\n\t} else if (n === 2) {\n\t\treturn 2;\n\t}\n\tif (Number.isInteger(n)) {\n\t\tconst mod100 = n % 100;\n\t\tif (mod100 >= 3 && mod100 <= 10) {\n\t\t\treturn 3;\n\t\t} else if (mod100 >= 11 && mod100 <= 99) {\n\t\t\treturn 4;\n\t\t}\n\t}\n\treturn 5;\n});\nconst DEFAULT_PLURAL_FN = PLURALS[getLang(DEFAULT_LOCALE)];\nfunction getPluralFn(lang) {\n\treturn PLURALS[lang] || DEFAULT_PLURAL_FN;\n}\n\nexport { findAvailableLocale, getLang, getPluralFn, replaceLang };\n","const ABSOLUTE_URL = new RegExp('^' + '\\\\s*' + '(?:' + '(?:' + '[a-z]+[a-z0-9\\\\-\\\\+\\\\.]*' + ':' + ')?' + '//' + '|' + 'data:' + '|blob:' + ')', 'i');\nconst ASSET_ANIMATION = 'animation';\nconst ASSET_AUDIO = 'audio';\nconst ASSET_IMAGE = 'image';\nconst ASSET_JSON = 'json';\nconst ASSET_MODEL = 'model';\nconst ASSET_MATERIAL = 'material';\nconst ASSET_TEXT = 'text';\nconst ASSET_TEXTURE = 'texture';\nconst ASSET_TEXTUREATLAS = 'textureatlas';\nconst ASSET_CUBEMAP = 'cubemap';\nconst ASSET_SHADER = 'shader';\nconst ASSET_CSS = 'css';\nconst ASSET_HTML = 'html';\nconst ASSET_SCRIPT = 'script';\nconst ASSET_CONTAINER = 'container';\n\nexport { ABSOLUTE_URL, ASSET_ANIMATION, ASSET_AUDIO, ASSET_CONTAINER, ASSET_CSS, ASSET_CUBEMAP, ASSET_HTML, ASSET_IMAGE, ASSET_JSON, ASSET_MATERIAL, ASSET_MODEL, ASSET_SCRIPT, ASSET_SHADER, ASSET_TEXT, ASSET_TEXTURE, ASSET_TEXTUREATLAS };\n","class AssetFile {\n\tconstructor(url = '', filename = '', hash = null, size = null, opt = null, contents = null) {\n\t\tthis.url = url;\n\t\tthis.filename = filename;\n\t\tthis.hash = hash;\n\t\tthis.size = size;\n\t\tthis.opt = opt;\n\t\tthis.contents = contents;\n\t}\n\tequals(other) {\n\t\treturn this.url === other.url && this.filename === other.filename && this.hash === other.hash && this.size === other.size && this.opt === other.opt && this.contents === other.contents;\n\t}\n}\n\nexport { AssetFile };\n","import { path } from '../../core/path.js';\nimport { Tags } from '../../core/tags.js';\nimport { EventHandler } from '../../core/event-handler.js';\nimport { findAvailableLocale } from '../i18n/utils.js';\nimport { ABSOLUTE_URL } from './constants.js';\nimport { AssetFile } from './asset-file.js';\nimport { getApplication } from '../globals.js';\nimport { http } from '../../platform/net/http.js';\n\nlet assetIdCounter = -1;\nconst VARIANT_SUPPORT = {\n\tpvr: 'extCompressedTexturePVRTC',\n\tdxt: 'extCompressedTextureS3TC',\n\tetc2: 'extCompressedTextureETC',\n\tetc1: 'extCompressedTextureETC1',\n\tbasis: 'canvas'\n};\nconst VARIANT_DEFAULT_PRIORITY = ['pvr', 'dxt', 'etc2', 'etc1', 'basis'];\nclass Asset extends EventHandler {\n\tconstructor(name, type, file, data, options) {\n\t\tsuper();\n\t\tthis._id = assetIdCounter--;\n\t\tthis._name = name || '';\n\t\tthis.type = type;\n\t\tthis.tags = new Tags(this);\n\t\tthis._preload = false;\n\t\tthis._file = null;\n\t\tthis._data = data || {};\n\t\tthis.options = options || {};\n\t\tthis._resources = [];\n\t\tthis._i18n = {};\n\t\tthis.loaded = false;\n\t\tthis.loading = false;\n\t\tthis.registry = null;\n\t\tif (file) this.file = file;\n\t}\n\tset id(value) {\n\t\tthis._id = value;\n\t}\n\tget id() {\n\t\treturn this._id;\n\t}\n\tset name(value) {\n\t\tif (this._name === value) return;\n\t\tconst old = this._name;\n\t\tthis._name = value;\n\t\tthis.fire('name', this, this._name, old);\n\t}\n\tget name() {\n\t\treturn this._name;\n\t}\n\tset file(value) {\n\t\tif (value && value.variants && ['texture', 'textureatlas', 'bundle'].indexOf(this.type) !== -1) {\n\t\t\tvar _this$registry;\n\t\t\tconst app = ((_this$registry = this.registry) == null || (_this$registry = _this$registry._loader) == null ? void 0 : _this$registry._app) || getApplication();\n\t\t\tconst device = app == null ? void 0 : app.graphicsDevice;\n\t\t\tif (device) {\n\t\t\t\tfor (let i = 0, len = VARIANT_DEFAULT_PRIORITY.length; i < len; i++) {\n\t\t\t\t\tconst variant = VARIANT_DEFAULT_PRIORITY[i];\n\t\t\t\t\tif (value.variants[variant] && device[VARIANT_SUPPORT[variant]]) {\n\t\t\t\t\t\tvalue = value.variants[variant];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tif (app.enableBundles) {\n\t\t\t\t\t\tconst bundles = app.bundles.listBundlesForAsset(this);\n\t\t\t\t\t\tif (bundles && bundles.find(b => {\n\t\t\t\t\t\t\tvar _b$file;\n\t\t\t\t\t\t\treturn b == null || (_b$file = b.file) == null ? void 0 : _b$file.variants[variant];\n\t\t\t\t\t\t})) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst oldFile = this._file;\n\t\tconst newFile = value ? new AssetFile(value.url, value.filename, value.hash, value.size, value.opt, value.contents) : null;\n\t\tif (!!newFile !== !!oldFile || newFile && !newFile.equals(oldFile)) {\n\t\t\tthis._file = newFile;\n\t\t\tthis.fire('change', this, 'file', newFile, oldFile);\n\t\t\tthis.reload();\n\t\t}\n\t}\n\tget file() {\n\t\treturn this._file;\n\t}\n\tset data(value) {\n\t\tconst old = this._data;\n\t\tthis._data = value;\n\t\tif (value !== old) {\n\t\t\tthis.fire('change', this, 'data', value, old);\n\t\t\tif (this.loaded) this.registry._loader.patch(this, this.registry);\n\t\t}\n\t}\n\tget data() {\n\t\treturn this._data;\n\t}\n\tset resource(value) {\n\t\tconst _old = this._resources[0];\n\t\tthis._resources[0] = value;\n\t\tthis.fire('change', this, 'resource', value, _old);\n\t}\n\tget resource() {\n\t\treturn this._resources[0];\n\t}\n\tset resources(value) {\n\t\tconst _old = this._resources;\n\t\tthis._resources = value;\n\t\tthis.fire('change', this, 'resources', value, _old);\n\t}\n\tget resources() {\n\t\treturn this._resources;\n\t}\n\tset preload(value) {\n\t\tvalue = !!value;\n\t\tif (this._preload === value) return;\n\t\tthis._preload = value;\n\t\tif (this._preload && !this.loaded && !this.loading && this.registry) this.registry.load(this);\n\t}\n\tget preload() {\n\t\treturn this._preload;\n\t}\n\tset loadFaces(value) {\n\t\tvalue = !!value;\n\t\tif (!this.hasOwnProperty('_loadFaces') || value !== this._loadFaces) {\n\t\t\tthis._loadFaces = value;\n\t\t\tif (this.loaded) this.registry._loader.patch(this, this.registry);\n\t\t}\n\t}\n\tget loadFaces() {\n\t\treturn this._loadFaces;\n\t}\n\tgetFileUrl() {\n\t\tconst file = this.file;\n\t\tif (!file || !file.url) return null;\n\t\tlet url = file.url;\n\t\tif (this.registry && this.registry.prefix && !ABSOLUTE_URL.test(url)) url = this.registry.prefix + url;\n\t\tif (this.type !== 'script' && file.hash) {\n\t\t\tconst separator = url.indexOf('?') !== -1 ? '&' : '?';\n\t\t\turl += separator + 't=' + file.hash;\n\t\t}\n\t\treturn url;\n\t}\n\tgetAbsoluteUrl(relativePath) {\n\t\tif (relativePath.startsWith('blob:') || relativePath.startsWith('data:')) {\n\t\t\treturn relativePath;\n\t\t}\n\t\tconst base = path.getDirectory(this.file.url);\n\t\treturn path.join(base, relativePath);\n\t}\n\tgetLocalizedAssetId(locale) {\n\t\tlocale = findAvailableLocale(locale, this._i18n);\n\t\treturn this._i18n[locale] || null;\n\t}\n\taddLocalizedAssetId(locale, assetId) {\n\t\tthis._i18n[locale] = assetId;\n\t\tthis.fire('add:localized', locale, assetId);\n\t}\n\tremoveLocalizedAssetId(locale) {\n\t\tconst assetId = this._i18n[locale];\n\t\tif (assetId) {\n\t\t\tdelete this._i18n[locale];\n\t\t\tthis.fire('remove:localized', locale, assetId);\n\t\t}\n\t}\n\tready(callback, scope) {\n\t\tscope = scope || this;\n\t\tif (this.loaded) {\n\t\t\tcallback.call(scope, this);\n\t\t} else {\n\t\t\tthis.once('load', function (asset) {\n\t\t\t\tcallback.call(scope, asset);\n\t\t\t});\n\t\t}\n\t}\n\treload() {\n\t\tif (this.loaded) {\n\t\t\tthis.loaded = false;\n\t\t\tthis.registry.load(this);\n\t\t}\n\t}\n\tunload() {\n\t\tif (!this.loaded && this._resources.length === 0) return;\n\t\tthis.fire('unload', this);\n\t\tthis.registry.fire('unload:' + this.id, this);\n\t\tconst old = this._resources;\n\t\tthis.resources = [];\n\t\tthis.loaded = false;\n\t\tif (this.file) {\n\t\t\tthis.registry._loader.clearCache(this.getFileUrl(), this.type);\n\t\t}\n\t\tfor (let i = 0; i < old.length; ++i) {\n\t\t\tconst resource = old[i];\n\t\t\tif (resource && resource.destroy) {\n\t\t\t\tresource.destroy();\n\t\t\t}\n\t\t}\n\t}\n\tstatic fetchArrayBuffer(loadUrl, callback, asset, maxRetries = 0) {\n\t\tvar _asset$file;\n\t\tif (asset != null && (_asset$file = asset.file) != null && _asset$file.contents) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tcallback(null, asset.file.contents);\n\t\t\t});\n\t\t} else {\n\t\t\thttp.get(loadUrl, {\n\t\t\t\tcache: true,\n\t\t\t\tresponseType: 'arraybuffer',\n\t\t\t\tretry: maxRetries > 0,\n\t\t\t\tmaxRetries: maxRetries\n\t\t\t}, callback);\n\t\t}\n\t}\n}\n\nexport { Asset };\n","class TagsCache {\n\tconstructor(key = null) {\n\t\tthis._index = {};\n\t\tthis._key = void 0;\n\t\tthis._key = key;\n\t}\n\taddItem(item) {\n\t\tconst tags = item.tags._list;\n\t\tfor (const tag of tags) this.add(tag, item);\n\t}\n\tremoveItem(item) {\n\t\tconst tags = item.tags._list;\n\t\tfor (const tag of tags) this.remove(tag, item);\n\t}\n\tadd(tag, item) {\n\t\tif (this._index[tag] && this._index[tag].list.indexOf(item) !== -1) return;\n\t\tif (!this._index[tag]) {\n\t\t\tthis._index[tag] = {\n\t\t\t\tlist: []\n\t\t\t};\n\t\t\tif (this._key) this._index[tag].keys = {};\n\t\t}\n\t\tthis._index[tag].list.push(item);\n\t\tif (this._key) this._index[tag].keys[item[this._key]] = item;\n\t}\n\tremove(tag, item) {\n\t\tif (!this._index[tag]) return;\n\t\tif (this._key) {\n\t\t\tif (!this._index[tag].keys[item[this._key]]) return;\n\t\t}\n\t\tconst ind = this._index[tag].list.indexOf(item);\n\t\tif (ind === -1) return;\n\t\tthis._index[tag].list.splice(ind, 1);\n\t\tif (this._key) delete this._index[tag].keys[item[this._key]];\n\t\tif (this._index[tag].list.length === 0) delete this._index[tag];\n\t}\n\tfind(args) {\n\t\tconst index = {};\n\t\tconst items = [];\n\t\tlet item, tag, tags, tagsRest, missingIndex;\n\t\tconst sort = (a, b) => {\n\t\t\treturn this._index[a].list.length - this._index[b].list.length;\n\t\t};\n\t\tfor (let i = 0; i < args.length; i++) {\n\t\t\ttag = args[i];\n\t\t\tif (tag instanceof Array) {\n\t\t\t\tif (tag.length === 0) continue;\n\t\t\t\tif (tag.length === 1) {\n\t\t\t\t\ttag = tag[0];\n\t\t\t\t} else {\n\t\t\t\t\tmissingIndex = false;\n\t\t\t\t\tfor (let t = 0; t < tag.length; t++) {\n\t\t\t\t\t\tif (!this._index[tag[t]]) {\n\t\t\t\t\t\t\tmissingIndex = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (missingIndex) continue;\n\t\t\t\t\ttags = tag.slice(0).sort(sort);\n\t\t\t\t\ttagsRest = tags.slice(1);\n\t\t\t\t\tif (tagsRest.length === 1) tagsRest = tagsRest[0];\n\t\t\t\t\tfor (let n = 0; n < this._index[tags[0]].list.length; n++) {\n\t\t\t\t\t\titem = this._index[tags[0]].list[n];\n\t\t\t\t\t\tif ((this._key ? !index[item[this._key]] : items.indexOf(item) === -1) && item.tags.has(tagsRest)) {\n\t\t\t\t\t\t\tif (this._key) index[item[this._key]] = true;\n\t\t\t\t\t\t\titems.push(item);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (tag && typeof tag === 'string' && this._index[tag]) {\n\t\t\t\tfor (let n = 0; n < this._index[tag].list.length; n++) {\n\t\t\t\t\titem = this._index[tag].list[n];\n\t\t\t\t\tif (this._key) {\n\t\t\t\t\t\tif (!index[item[this._key]]) {\n\t\t\t\t\t\t\tindex[item[this._key]] = true;\n\t\t\t\t\t\t\titems.push(item);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (items.indexOf(item) === -1) {\n\t\t\t\t\t\titems.push(item);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn items;\n\t}\n}\n\nexport { TagsCache };\n","import { path } from '../../core/path.js';\nimport '../../core/tracing.js';\nimport { EventHandler } from '../../core/event-handler.js';\nimport { TagsCache } from '../../core/tags-cache.js';\nimport { standardMaterialTextureParameters } from '../../scene/materials/standard-material-parameters.js';\nimport { script } from '../script.js';\nimport { Asset } from './asset.js';\n\nclass AssetRegistry extends EventHandler {\n\tconstructor(loader) {\n\t\tsuper();\n\t\tthis._assets = new Set();\n\t\tthis._idToAsset = new Map();\n\t\tthis._urlToAsset = new Map();\n\t\tthis._nameToAsset = new Map();\n\t\tthis._tags = new TagsCache('_id');\n\t\tthis.prefix = null;\n\t\tthis._loader = loader;\n\t}\n\tlist(filters = {}) {\n\t\tconst assets = Array.from(this._assets);\n\t\tif (filters.preload !== undefined) {\n\t\t\treturn assets.filter(asset => asset.preload === filters.preload);\n\t\t}\n\t\treturn assets;\n\t}\n\tadd(asset) {\n\t\tvar _asset$file, _asset$file2;\n\t\tif (this._assets.has(asset)) return;\n\t\tthis._assets.add(asset);\n\t\tthis._idToAsset.set(asset.id, asset);\n\t\tif ((_asset$file = asset.file) != null && _asset$file.url) {\n\t\t\tthis._urlToAsset.set(asset.file.url, asset);\n\t\t}\n\t\tif (!this._nameToAsset.has(asset.name)) this._nameToAsset.set(asset.name, new Set());\n\t\tthis._nameToAsset.get(asset.name).add(asset);\n\t\tasset.on('name', this._onNameChange, this);\n\t\tasset.registry = this;\n\t\tthis._tags.addItem(asset);\n\t\tasset.tags.on('add', this._onTagAdd, this);\n\t\tasset.tags.on('remove', this._onTagRemove, this);\n\t\tthis.fire('add', asset);\n\t\tthis.fire('add:' + asset.id, asset);\n\t\tif ((_asset$file2 = asset.file) != null && _asset$file2.url) {\n\t\t\tthis.fire('add:url:' + asset.file.url, asset);\n\t\t}\n\t\tif (asset.preload) this.load(asset);\n\t}\n\tremove(asset) {\n\t\tvar _asset$file3, _asset$file4;\n\t\tif (!this._assets.has(asset)) return false;\n\t\tthis._assets.delete(asset);\n\t\tthis._idToAsset.delete(asset.id);\n\t\tif ((_asset$file3 = asset.file) != null && _asset$file3.url) {\n\t\t\tthis._urlToAsset.delete(asset.file.url);\n\t\t}\n\t\tasset.off('name', this._onNameChange, this);\n\t\tif (this._nameToAsset.has(asset.name)) {\n\t\t\tconst items = this._nameToAsset.get(asset.name);\n\t\t\titems.delete(asset);\n\t\t\tif (items.size === 0) {\n\t\t\t\tthis._nameToAsset.delete(asset.name);\n\t\t\t}\n\t\t}\n\t\tthis._tags.removeItem(asset);\n\t\tasset.tags.off('add', this._onTagAdd, this);\n\t\tasset.tags.off('remove', this._onTagRemove, this);\n\t\tasset.fire('remove', asset);\n\t\tthis.fire('remove', asset);\n\t\tthis.fire('remove:' + asset.id, asset);\n\t\tif ((_asset$file4 = asset.file) != null && _asset$file4.url) {\n\t\t\tthis.fire('remove:url:' + asset.file.url, asset);\n\t\t}\n\t\treturn true;\n\t}\n\tget(id) {\n\t\treturn this._idToAsset.get(Number(id));\n\t}\n\tgetByUrl(url) {\n\t\treturn this._urlToAsset.get(url);\n\t}\n\tload(asset) {\n\t\tif (asset.loading || asset.loaded) {\n\t\t\treturn;\n\t\t}\n\t\tconst file = asset.file;\n\t\tconst _opened = resource => {\n\t\t\tif (resource instanceof Array) {\n\t\t\t\tasset.resources = resource;\n\t\t\t} else {\n\t\t\t\tasset.resource = resource;\n\t\t\t}\n\t\t\tthis._loader.patch(asset, this);\n\t\t\tthis.fire('load', asset);\n\t\t\tthis.fire('load:' + asset.id, asset);\n\t\t\tif (file && file.url) this.fire('load:url:' + file.url, asset);\n\t\t\tasset.fire('load', asset);\n\t\t};\n\t\tconst _loaded = (err, resource, extra) => {\n\t\t\tasset.loaded = true;\n\t\t\tasset.loading = false;\n\t\t\tif (err) {\n\t\t\t\tthis.fire('error', err, asset);\n\t\t\t\tthis.fire('error:' + asset.id, err, asset);\n\t\t\t\tasset.fire('error', err, asset);\n\t\t\t} else {\n\t\t\t\tif (!script.legacy && asset.type === 'script') {\n\t\t\t\t\tconst handler = this._loader.getHandler('script');\n\t\t\t\t\tif (handler._cache[asset.id] && handler._cache[asset.id].parentNode === document.head) {\n\t\t\t\t\t\tdocument.head.removeChild(handler._cache[asset.id]);\n\t\t\t\t\t}\n\t\t\t\t\thandler._cache[asset.id] = extra;\n\t\t\t\t}\n\t\t\t\t_opened(resource);\n\t\t\t}\n\t\t};\n\t\tif (file || asset.type === 'cubemap') {\n\t\t\tthis.fire('load:start', asset);\n\t\t\tthis.fire('load:' + asset.id + ':start', asset);\n\t\t\tasset.loading = true;\n\t\t\tthis._loader.load(asset.getFileUrl(), asset.type, _loaded, asset);\n\t\t} else {\n\t\t\tconst resource = this._loader.open(asset.type, asset.data);\n\t\t\tasset.loaded = true;\n\t\t\t_opened(resource);\n\t\t}\n\t}\n\tloadFromUrl(url, type, callback) {\n\t\tthis.loadFromUrlAndFilename(url, null, type, callback);\n\t}\n\tloadFromUrlAndFilename(url, filename, type, callback) {\n\t\tconst name = path.getBasename(filename || url);\n\t\tconst file = {\n\t\t\tfilename: filename || name,\n\t\t\turl: url\n\t\t};\n\t\tlet asset = this.getByUrl(url);\n\t\tif (!asset) {\n\t\t\tasset = new Asset(name, type, file);\n\t\t\tthis.add(asset);\n\t\t} else if (asset.loaded) {\n\t\t\tcallback(asset.loadFromUrlError || null, asset);\n\t\t\treturn;\n\t\t}\n\t\tconst startLoad = asset => {\n\t\t\tasset.once('load', loadedAsset => {\n\t\t\t\tif (type === 'material') {\n\t\t\t\t\tthis._loadTextures(loadedAsset, (err, textures) => {\n\t\t\t\t\t\tcallback(err, loadedAsset);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tcallback(null, loadedAsset);\n\t\t\t\t}\n\t\t\t});\n\t\t\tasset.once('error', err => {\n\t\t\t\tif (err) {\n\t\t\t\t\tthis.loadFromUrlError = err;\n\t\t\t\t}\n\t\t\t\tcallback(err, asset);\n\t\t\t});\n\t\t\tthis.load(asset);\n\t\t};\n\t\tif (asset.resource) {\n\t\t\tcallback(null, asset);\n\t\t} else if (type === 'model') {\n\t\t\tthis._loadModel(asset, startLoad);\n\t\t} else {\n\t\t\tstartLoad(asset);\n\t\t}\n\t}\n\t_loadModel(modelAsset, continuation) {\n\t\tconst url = modelAsset.getFileUrl();\n\t\tconst ext = path.getExtension(url);\n\t\tif (ext === '.json' || ext === '.glb') {\n\t\t\tconst dir = path.getDirectory(url);\n\t\t\tconst basename = path.getBasename(url);\n\t\t\tconst mappingUrl = path.join(dir, basename.replace(ext, '.mapping.json'));\n\t\t\tthis._loader.load(mappingUrl, 'json', (err, data) => {\n\t\t\t\tif (err) {\n\t\t\t\t\tmodelAsset.data = {\n\t\t\t\t\t\tmapping: []\n\t\t\t\t\t};\n\t\t\t\t\tcontinuation(modelAsset);\n\t\t\t\t} else {\n\t\t\t\t\tthis._loadMaterials(modelAsset, data, (e, materials) => {\n\t\t\t\t\t\tmodelAsset.data = data;\n\t\t\t\t\t\tcontinuation(modelAsset);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tcontinuation(modelAsset);\n\t\t}\n\t}\n\t_loadMaterials(modelAsset, mapping, callback) {\n\t\tconst materials = [];\n\t\tlet count = 0;\n\t\tconst onMaterialLoaded = (err, materialAsset) => {\n\t\t\tthis._loadTextures(materialAsset, (err, textures) => {\n\t\t\t\tmaterials.push(materialAsset);\n\t\t\t\tif (materials.length === count) {\n\t\t\t\t\tcallback(null, materials);\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\t\tfor (let i = 0; i < mapping.mapping.length; i++) {\n\t\t\tconst path = mapping.mapping[i].path;\n\t\t\tif (path) {\n\t\t\t\tcount++;\n\t\t\t\tconst url = modelAsset.getAbsoluteUrl(path);\n\t\t\t\tthis.loadFromUrl(url, 'material', onMaterialLoaded);\n\t\t\t}\n\t\t}\n\t\tif (count === 0) {\n\t\t\tcallback(null, materials);\n\t\t}\n\t}\n\t_loadTextures(materialAsset, callback) {\n\t\tconst textures = [];\n\t\tlet count = 0;\n\t\tconst data = materialAsset.data;\n\t\tif (data.mappingFormat !== 'path') {\n\t\t\tcallback(null, textures);\n\t\t\treturn;\n\t\t}\n\t\tconst onTextureLoaded = (err, texture) => {\n\t\t\tif (err) console.error(err);\n\t\t\ttextures.push(texture);\n\t\t\tif (textures.length === count) {\n\t\t\t\tcallback(null, textures);\n\t\t\t}\n\t\t};\n\t\tconst texParams = standardMaterialTextureParameters;\n\t\tfor (let i = 0; i < texParams.length; i++) {\n\t\t\tconst path = data[texParams[i]];\n\t\t\tif (path && typeof path === 'string') {\n\t\t\t\tcount++;\n\t\t\t\tconst url = materialAsset.getAbsoluteUrl(path);\n\t\t\t\tthis.loadFromUrl(url, 'texture', onTextureLoaded);\n\t\t\t}\n\t\t}\n\t\tif (count === 0) {\n\t\t\tcallback(null, textures);\n\t\t}\n\t}\n\t_onTagAdd(tag, asset) {\n\t\tthis._tags.add(tag, asset);\n\t}\n\t_onTagRemove(tag, asset) {\n\t\tthis._tags.remove(tag, asset);\n\t}\n\t_onNameChange(asset, name, nameOld) {\n\t\tif (this._nameToAsset.has(nameOld)) {\n\t\t\tconst items = this._nameToAsset.get(nameOld);\n\t\t\titems.delete(asset);\n\t\t\tif (items.size === 0) {\n\t\t\t\tthis._nameToAsset.delete(nameOld);\n\t\t\t}\n\t\t}\n\t\tif (!this._nameToAsset.has(asset.name)) this._nameToAsset.set(asset.name, new Set());\n\t\tthis._nameToAsset.get(asset.name).add(asset);\n\t}\n\tfindByTag() {\n\t\treturn this._tags.find(arguments);\n\t}\n\tfilter(callback) {\n\t\treturn Array.from(this._assets).filter(asset => callback(asset));\n\t}\n\tfind(name, type) {\n\t\tconst items = this._nameToAsset.get(name);\n\t\tif (!items) return null;\n\t\tfor (const asset of items) {\n\t\t\tif (!type || asset.type === type) {\n\t\t\t\treturn asset;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\tfindAll(name, type) {\n\t\tconst items = this._nameToAsset.get(name);\n\t\tif (!items) return [];\n\t\tconst results = Array.from(items);\n\t\tif (!type) return results;\n\t\treturn results.filter(asset => asset.type === type);\n\t}\n}\n\nexport { AssetRegistry };\n","class BundleRegistry {\n\tconstructor(assets) {\n\t\tthis._assets = assets;\n\t\tthis._bundleAssets = {};\n\t\tthis._assetsInBundles = {};\n\t\tthis._urlsInBundles = {};\n\t\tthis._fileRequests = {};\n\t\tthis._assets.on('add', this._onAssetAdded, this);\n\t\tthis._assets.on('remove', this._onAssetRemoved, this);\n\t}\n\t_onAssetAdded(asset) {\n\t\tif (asset.type === 'bundle') {\n\t\t\tthis._bundleAssets[asset.id] = asset;\n\t\t\tthis._registerBundleEventListeners(asset.id);\n\t\t\tfor (let i = 0, len = asset.data.assets.length; i < len; i++) {\n\t\t\t\tthis._indexAssetInBundle(asset.data.assets[i], asset);\n\t\t\t}\n\t\t} else {\n\t\t\tif (this._assetsInBundles[asset.id]) {\n\t\t\t\tthis._indexAssetFileUrls(asset);\n\t\t\t}\n\t\t}\n\t}\n\t_registerBundleEventListeners(bundleAssetId) {\n\t\tthis._assets.on('load:' + bundleAssetId, this._onBundleLoaded, this);\n\t\tthis._assets.on('error:' + bundleAssetId, this._onBundleError, this);\n\t}\n\t_unregisterBundleEventListeners(bundleAssetId) {\n\t\tthis._assets.off('load:' + bundleAssetId, this._onBundleLoaded, this);\n\t\tthis._assets.off('error:' + bundleAssetId, this._onBundleError, this);\n\t}\n\t_indexAssetInBundle(assetId, bundleAsset) {\n\t\tif (!this._assetsInBundles[assetId]) {\n\t\t\tthis._assetsInBundles[assetId] = [bundleAsset];\n\t\t} else {\n\t\t\tconst bundles = this._assetsInBundles[assetId];\n\t\t\tconst idx = bundles.indexOf(bundleAsset);\n\t\t\tif (idx === -1) {\n\t\t\t\tbundles.push(bundleAsset);\n\t\t\t}\n\t\t}\n\t\tconst asset = this._assets.get(assetId);\n\t\tif (asset) {\n\t\t\tthis._indexAssetFileUrls(asset);\n\t\t}\n\t}\n\t_indexAssetFileUrls(asset) {\n\t\tconst urls = this._getAssetFileUrls(asset);\n\t\tif (!urls) return;\n\t\tfor (let i = 0, len = urls.length; i < len; i++) {\n\t\t\tconst url = urls[i];\n\t\t\tthis._urlsInBundles[url] = this._assetsInBundles[asset.id];\n\t\t}\n\t}\n\t_getAssetFileUrls(asset) {\n\t\tlet url = asset.getFileUrl();\n\t\tif (!url) return null;\n\t\turl = this._normalizeUrl(url);\n\t\tconst urls = [url];\n\t\tif (asset.type === 'font') {\n\t\t\tconst numFiles = asset.data.info.maps.length;\n\t\t\tfor (let i = 1; i < numFiles; i++) {\n\t\t\t\turls.push(url.replace('.png', i + '.png'));\n\t\t\t}\n\t\t}\n\t\treturn urls;\n\t}\n\t_normalizeUrl(url) {\n\t\treturn url && url.split('?')[0];\n\t}\n\t_onAssetRemoved(asset) {\n\t\tif (asset.type === 'bundle') {\n\t\t\tdelete this._bundleAssets[asset.id];\n\t\t\tthis._unregisterBundleEventListeners(asset.id);\n\t\t\tfor (const id in this._assetsInBundles) {\n\t\t\t\tconst array = this._assetsInBundles[id];\n\t\t\t\tconst idx = array.indexOf(asset);\n\t\t\t\tif (idx !== -1) {\n\t\t\t\t\tarray.splice(idx, 1);\n\t\t\t\t\tif (!array.length) {\n\t\t\t\t\t\tdelete this._assetsInBundles[id];\n\t\t\t\t\t\tfor (const url in this._urlsInBundles) {\n\t\t\t\t\t\t\tif (this._urlsInBundles[url] === array) {\n\t\t\t\t\t\t\t\tdelete this._urlsInBundles[url];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._onBundleError(`Bundle ${asset.id} was removed`, asset);\n\t\t} else if (this._assetsInBundles[asset.id]) {\n\t\t\tdelete this._assetsInBundles[asset.id];\n\t\t\tconst urls = this._getAssetFileUrls(asset);\n\t\t\tfor (let i = 0, len = urls.length; i < len; i++) {\n\t\t\t\tdelete this._urlsInBundles[urls[i]];\n\t\t\t}\n\t\t}\n\t}\n\t_onBundleLoaded(bundleAsset) {\n\t\tif (!bundleAsset.resource) {\n\t\t\tthis._onBundleError(`Bundle ${bundleAsset.id} failed to load`, bundleAsset);\n\t\t\treturn;\n\t\t}\n\t\trequestAnimationFrame(() => {\n\t\t\tif (!this._fileRequests) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfor (const url in this._fileRequests) {\n\t\t\t\tconst bundles = this._urlsInBundles[url];\n\t\t\t\tif (!bundles || bundles.indexOf(bundleAsset) === -1) continue;\n\t\t\t\tconst decodedUrl = decodeURIComponent(url);\n\t\t\t\tlet err = null;\n\t\t\t\tif (!bundleAsset.resource.hasBlobUrl(decodedUrl)) {\n\t\t\t\t\terr = `Bundle ${bundleAsset.id} does not contain URL ${url}`;\n\t\t\t\t}\n\t\t\t\tconst requests = this._fileRequests[url];\n\t\t\t\tfor (let i = 0, len = requests.length; i < len; i++) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\trequests[i](err);\n\t\t\t\t\t} else {\n\t\t\t\t\t\trequests[i](null, bundleAsset.resource.getBlobUrl(decodedUrl));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tdelete this._fileRequests[url];\n\t\t\t}\n\t\t});\n\t}\n\t_onBundleError(err, bundleAsset) {\n\t\tfor (const url in this._fileRequests) {\n\t\t\tconst bundle = this._findLoadedOrLoadingBundleForUrl(url);\n\t\t\tif (!bundle) {\n\t\t\t\tconst requests = this._fileRequests[url];\n\t\t\t\tfor (let i = 0, len = requests.length; i < len; i++) {\n\t\t\t\t\trequests[i](err);\n\t\t\t\t}\n\t\t\t\tdelete this._fileRequests[url];\n\t\t\t}\n\t\t}\n\t}\n\t_findLoadedOrLoadingBundleForUrl(url) {\n\t\tconst bundles = this._urlsInBundles[url];\n\t\tif (!bundles) return null;\n\t\tconst len = bundles.length;\n\t\tfor (let i = 0; i < len; i++) {\n\t\t\tif (bundles[i].loaded && bundles[i].resource) {\n\t\t\t\treturn bundles[i];\n\t\t\t}\n\t\t}\n\t\tfor (let i = 0; i < len; i++) {\n\t\t\tif (bundles[i].loading) {\n\t\t\t\treturn bundles[i];\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\tlistBundlesForAsset(asset) {\n\t\treturn this._assetsInBundles[asset.id] || null;\n\t}\n\tlist() {\n\t\tconst result = [];\n\t\tfor (const id in this._bundleAssets) {\n\t\t\tresult.push(this._bundleAssets[id]);\n\t\t}\n\t\treturn result;\n\t}\n\thasUrl(url) {\n\t\treturn !!this._urlsInBundles[url];\n\t}\n\tcanLoadUrl(url) {\n\t\treturn !!this._findLoadedOrLoadingBundleForUrl(url);\n\t}\n\tloadUrl(url, callback) {\n\t\tconst bundle = this._findLoadedOrLoadingBundleForUrl(url);\n\t\tif (!bundle) {\n\t\t\tcallback(`URL ${url} not found in any bundles`);\n\t\t\treturn;\n\t\t}\n\t\tif (bundle.loaded) {\n\t\t\tconst decodedUrl = decodeURIComponent(url);\n\t\t\tif (!bundle.resource.hasBlobUrl(decodedUrl)) {\n\t\t\t\tcallback(`Bundle ${bundle.id} does not contain URL ${url}`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcallback(null, bundle.resource.getBlobUrl(decodedUrl));\n\t\t} else if (this._fileRequests.hasOwnProperty(url)) {\n\t\t\tthis._fileRequests[url].push(callback);\n\t\t} else {\n\t\t\tthis._fileRequests[url] = [callback];\n\t\t}\n\t}\n\tdestroy() {\n\t\tthis._assets.off('add', this._onAssetAdded, this);\n\t\tthis._assets.off('remove', this._onAssetRemoved, this);\n\t\tfor (const id in this._bundleAssets) {\n\t\t\tthis._unregisterBundleEventListeners(id);\n\t\t}\n\t\tthis._assets = null;\n\t\tthis._bundleAssets = null;\n\t\tthis._assetsInBundles = null;\n\t\tthis._urlsInBundles = null;\n\t\tthis._fileRequests = null;\n\t}\n}\n\nexport { BundleRegistry };\n","import { EventHandler } from '../../core/event-handler.js';\n\nclass ComponentSystemRegistry extends EventHandler {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.anim = void 0;\n\t\tthis.animation = void 0;\n\t\tthis.audiolistener = void 0;\n\t\tthis.audiosource = void 0;\n\t\tthis.button = void 0;\n\t\tthis.camera = void 0;\n\t\tthis.collision = void 0;\n\t\tthis.element = void 0;\n\t\tthis.joint = void 0;\n\t\tthis.layoutchild = void 0;\n\t\tthis.layoutgroup = void 0;\n\t\tthis.light = void 0;\n\t\tthis.model = void 0;\n\t\tthis.particlesystem = void 0;\n\t\tthis.render = void 0;\n\t\tthis.rigidbody = void 0;\n\t\tthis.screen = void 0;\n\t\tthis.script = void 0;\n\t\tthis.scrollbar = void 0;\n\t\tthis.scrollview = void 0;\n\t\tthis.sound = void 0;\n\t\tthis.sprite = void 0;\n\t\tthis.zone = void 0;\n\t\tthis.list = [];\n\t}\n\tadd(system) {\n\t\tconst id = system.id;\n\t\tif (this[id]) {\n\t\t\tthrow new Error(`ComponentSystem name '${id}' already registered or not allowed`);\n\t\t}\n\t\tthis[id] = system;\n\t\tthis.list.push(system);\n\t}\n\tremove(system) {\n\t\tconst id = system.id;\n\t\tif (!this[id]) {\n\t\t\tthrow new Error(`No ComponentSystem named '${id}' registered`);\n\t\t}\n\t\tdelete this[id];\n\t\tconst index = this.list.indexOf(this[id]);\n\t\tif (index !== -1) {\n\t\t\tthis.list.splice(index, 1);\n\t\t}\n\t}\n\tdestroy() {\n\t\tthis.off();\n\t\tfor (let i = 0; i < this.list.length; i++) {\n\t\t\tthis.list[i].destroy();\n\t\t}\n\t}\n}\n\nexport { ComponentSystemRegistry };\n","class Bundle {\n\tconstructor(files) {\n\t\tthis._blobUrls = {};\n\t\tfor (let i = 0, len = files.length; i < len; i++) {\n\t\t\tif (files[i].url) {\n\t\t\t\tthis._blobUrls[files[i].name] = files[i].url;\n\t\t\t}\n\t\t}\n\t}\n\thasBlobUrl(url) {\n\t\treturn !!this._blobUrls[url];\n\t}\n\tgetBlobUrl(url) {\n\t\treturn this._blobUrls[url];\n\t}\n\tdestroy() {\n\t\tfor (const key in this._blobUrls) {\n\t\t\tURL.revokeObjectURL(this._blobUrls[key]);\n\t\t}\n\t\tthis._blobUrls = null;\n\t}\n}\n\nexport { Bundle };\n","let Untar;\nfunction UntarScope(isWorker) {\n\tlet utfDecoder;\n\tlet asciiDecoder;\n\tif (typeof TextDecoder !== 'undefined') {\n\t\ttry {\n\t\t\tutfDecoder = new TextDecoder('utf-8');\n\t\t\tasciiDecoder = new TextDecoder('windows-1252');\n\t\t} catch (e) {\n\t\t\tconsole.warn('TextDecoder not supported - pc.Untar module will not work');\n\t\t}\n\t} else {\n\t\tconsole.warn('TextDecoder not supported - pc.Untar module will not work');\n\t}\n\tfunction PaxHeader(fields) {\n\t\tthis._fields = fields;\n\t}\n\tPaxHeader.parse = function (buffer, start, length) {\n\t\tconst paxArray = new Uint8Array(buffer, start, length);\n\t\tlet bytesRead = 0;\n\t\tconst fields = [];\n\t\twhile (bytesRead < length) {\n\t\t\tlet spaceIndex;\n\t\t\tfor (spaceIndex = bytesRead; spaceIndex < length; spaceIndex++) {\n\t\t\t\tif (paxArray[spaceIndex] === 0x20) break;\n\t\t\t}\n\t\t\tif (spaceIndex >= length) {\n\t\t\t\tthrow new Error('Invalid PAX header data format.');\n\t\t\t}\n\t\t\tconst fieldLength = parseInt(utfDecoder.decode(new Uint8Array(buffer, start + bytesRead, spaceIndex - bytesRead)), 10);\n\t\t\tconst fieldText = utfDecoder.decode(new Uint8Array(buffer, start + spaceIndex + 1, fieldLength - (spaceIndex - bytesRead) - 2));\n\t\t\tconst field = fieldText.split('=');\n\t\t\tif (field.length !== 2) {\n\t\t\t\tthrow new Error('Invalid PAX header data format.');\n\t\t\t}\n\t\t\tif (field[1].length === 0) {\n\t\t\t\tfield[1] = null;\n\t\t\t}\n\t\t\tfields.push({\n\t\t\t\tname: field[0],\n\t\t\t\tvalue: field[1]\n\t\t\t});\n\t\t\tbytesRead += fieldLength;\n\t\t}\n\t\treturn new PaxHeader(fields);\n\t};\n\tPaxHeader.prototype.applyHeader = function (file) {\n\t\tfor (let i = 0; i < this._fields.length; i++) {\n\t\t\tlet fieldName = this._fields[i].name;\n\t\t\tconst fieldValue = this._fields[i].value;\n\t\t\tif (fieldName === 'path') {\n\t\t\t\tfieldName = 'name';\n\t\t\t}\n\t\t\tif (fieldValue === null) {\n\t\t\t\tdelete file[fieldName];\n\t\t\t} else {\n\t\t\t\tfile[fieldName] = fieldValue;\n\t\t\t}\n\t\t}\n\t};\n\tfunction UntarInternal(arrayBuffer) {\n\t\tthis._arrayBuffer = arrayBuffer || new ArrayBuffer(0);\n\t\tthis._bufferView = new DataView(this._arrayBuffer);\n\t\tthis._globalPaxHeader = null;\n\t\tthis._paxHeader = null;\n\t\tthis._bytesRead = 0;\n\t}\n\tif (!isWorker) {\n\t\tUntar = UntarInternal;\n\t}\n\tUntarInternal.prototype._hasNext = function () {\n\t\treturn this._bytesRead + 4 < this._arrayBuffer.byteLength && this._bufferView.getUint32(this._bytesRead) !== 0;\n\t};\n\tUntarInternal.prototype._readNextFile = function () {\n\t\tconst headersDataView = new DataView(this._arrayBuffer, this._bytesRead, 512);\n\t\tconst headers = asciiDecoder.decode(headersDataView);\n\t\tthis._bytesRead += 512;\n\t\tlet name = headers.substring(0, 100).replace(/\\0/g, '');\n\t\tconst ustarFormat = headers.substring(257, 263);\n\t\tconst size = parseInt(headers.substring(124, 136), 8);\n\t\tconst type = headers.substring(156, 157);\n\t\tconst start = this._bytesRead;\n\t\tlet url = null;\n\t\tlet normalFile = false;\n\t\tswitch (type) {\n\t\t\tcase '0':\n\t\t\tcase '':\n\t\t\t\tnormalFile = true;\n\t\t\t\tif (!isWorker) {\n\t\t\t\t\tconst blob = new Blob([this._arrayBuffer.slice(this._bytesRead, this._bytesRead + size)]);\n\t\t\t\t\turl = URL.createObjectURL(blob);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'g':\n\t\t\t\tthis._globalPaxHeader = PaxHeader.parse(this._arrayBuffer, this._bytesRead, size);\n\t\t\t\tbreak;\n\t\t\tcase 'x':\n\t\t\t\tthis._paxHeader = PaxHeader.parse(this._arrayBuffer, this._bytesRead, size);\n\t\t\t\tbreak;\n\t\t}\n\t\tthis._bytesRead += size;\n\t\tconst remainder = size % 512;\n\t\tif (remainder !== 0) {\n\t\t\tthis._bytesRead += 512 - remainder;\n\t\t}\n\t\tif (!normalFile) {\n\t\t\treturn null;\n\t\t}\n\t\tif (ustarFormat.indexOf('ustar') !== -1) {\n\t\t\tconst namePrefix = headers.substring(345, 500).replace(/\\0/g, '');\n\t\t\tif (namePrefix.length > 0) {\n\t\t\t\tname = namePrefix.trim() + name.trim();\n\t\t\t}\n\t\t}\n\t\tconst file = {\n\t\t\tname: name,\n\t\t\tstart: start,\n\t\t\tsize: size,\n\t\t\turl: url\n\t\t};\n\t\tif (this._globalPaxHeader) {\n\t\t\tthis._globalPaxHeader.applyHeader(file);\n\t\t}\n\t\tif (this._paxHeader) {\n\t\t\tthis._paxHeader.applyHeader(file);\n\t\t\tthis._paxHeader = null;\n\t\t}\n\t\treturn file;\n\t};\n\tUntarInternal.prototype.untar = function (filenamePrefix) {\n\t\tif (!utfDecoder) {\n\t\t\tconsole.error('Cannot untar because TextDecoder interface is not available for this platform.');\n\t\t\treturn [];\n\t\t}\n\t\tconst files = [];\n\t\twhile (this._hasNext()) {\n\t\t\tconst file = this._readNextFile();\n\t\t\tif (!file) continue;\n\t\t\tif (filenamePrefix && file.name) {\n\t\t\t\tfile.name = filenamePrefix + file.name;\n\t\t\t}\n\t\t\tfiles.push(file);\n\t\t}\n\t\treturn files;\n\t};\n\tif (isWorker) {\n\t\tself.onmessage = function (e) {\n\t\t\tconst id = e.data.id;\n\t\t\ttry {\n\t\t\t\tconst archive = new UntarInternal(e.data.arrayBuffer);\n\t\t\t\tconst files = archive.untar(e.data.prefix);\n\t\t\t\tpostMessage({\n\t\t\t\t\tid: id,\n\t\t\t\t\tfiles: files,\n\t\t\t\t\tarrayBuffer: e.data.arrayBuffer\n\t\t\t\t}, [e.data.arrayBuffer]);\n\t\t\t} catch (err) {\n\t\t\t\tpostMessage({\n\t\t\t\t\tid: id,\n\t\t\t\t\terror: err.toString()\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t}\n}\nlet workerUrl = null;\nfunction getWorkerUrl() {\n\tif (!workerUrl) {\n\t\tconst code = '(' + UntarScope.toString() + ')(true)\\n\\n';\n\t\tconst blob = new Blob([code], {\n\t\t\ttype: 'application/javascript'\n\t\t});\n\t\tworkerUrl = URL.createObjectURL(blob);\n\t}\n\treturn workerUrl;\n}\nclass UntarWorker {\n\tconstructor(filenamePrefix) {\n\t\tthis._requestId = 0;\n\t\tthis._pendingRequests = {};\n\t\tthis._filenamePrefix = filenamePrefix;\n\t\tthis._worker = new Worker(getWorkerUrl());\n\t\tthis._worker.addEventListener('message', this._onMessage.bind(this));\n\t}\n\t_onMessage(e) {\n\t\tconst id = e.data.id;\n\t\tif (!this._pendingRequests[id]) return;\n\t\tconst callback = this._pendingRequests[id];\n\t\tdelete this._pendingRequests[id];\n\t\tif (e.data.error) {\n\t\t\tcallback(e.data.error);\n\t\t} else {\n\t\t\tconst arrayBuffer = e.data.arrayBuffer;\n\t\t\tfor (let i = 0, len = e.data.files.length; i < len; i++) {\n\t\t\t\tconst file = e.data.files[i];\n\t\t\t\tconst blob = new Blob([arrayBuffer.slice(file.start, file.start + file.size)]);\n\t\t\t\tfile.url = URL.createObjectURL(blob);\n\t\t\t}\n\t\t\tcallback(null, e.data.files);\n\t\t}\n\t}\n\tuntar(arrayBuffer, callback) {\n\t\tconst id = this._requestId++;\n\t\tthis._pendingRequests[id] = callback;\n\t\tthis._worker.postMessage({\n\t\t\tid: id,\n\t\t\tprefix: this._filenamePrefix,\n\t\t\tarrayBuffer: arrayBuffer\n\t\t}, [arrayBuffer]);\n\t}\n\thasPendingRequests() {\n\t\treturn Object.keys(this._pendingRequests).length > 0;\n\t}\n\tdestroy() {\n\t\tif (this._worker) {\n\t\t\tthis._worker.terminate();\n\t\t\tthis._worker = null;\n\t\t\tthis._pendingRequests = null;\n\t\t}\n\t}\n}\nUntarScope();\n\nexport { Untar, UntarWorker };\n","import { platform } from '../../core/platform.js';\nimport { http, Http } from '../../platform/net/http.js';\nimport { Bundle } from '../bundle/bundle.js';\nimport { UntarWorker, Untar } from './untar.js';\n\nclass BundleHandler {\n\tconstructor(app) {\n\t\tthis.handlerType = \"bundle\";\n\t\tthis._assets = app.assets;\n\t\tthis._worker = null;\n\t\tthis.maxRetries = 0;\n\t}\n\tload(url, callback) {\n\t\tif (typeof url === 'string') {\n\t\t\turl = {\n\t\t\t\tload: url,\n\t\t\t\toriginal: url\n\t\t\t};\n\t\t}\n\t\tconst self = this;\n\t\thttp.get(url.load, {\n\t\t\tresponseType: Http.ResponseType.ARRAY_BUFFER,\n\t\t\tretry: this.maxRetries > 0,\n\t\t\tmaxRetries: this.maxRetries\n\t\t}, function (err, response) {\n\t\t\tif (!err) {\n\t\t\t\ttry {\n\t\t\t\t\tself._untar(response, callback);\n\t\t\t\t} catch (ex) {\n\t\t\t\t\tcallback('Error loading bundle resource ' + url.original + ': ' + ex);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tcallback('Error loading bundle resource ' + url.original + ': ' + err);\n\t\t\t}\n\t\t});\n\t}\n\t_untar(response, callback) {\n\t\tconst self = this;\n\t\tif (platform.workers) {\n\t\t\tif (!self._worker) {\n\t\t\t\tself._worker = new UntarWorker(self._assets.prefix);\n\t\t\t}\n\t\t\tself._worker.untar(response, function (err, files) {\n\t\t\t\tcallback(err, files);\n\t\t\t\tif (!self._worker.hasPendingRequests()) {\n\t\t\t\t\tself._worker.destroy();\n\t\t\t\t\tself._worker = null;\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tconst archive = new Untar(response);\n\t\t\tconst files = archive.untar(self._assets.prefix);\n\t\t\tcallback(null, files);\n\t\t}\n\t}\n\topen(url, data) {\n\t\treturn new Bundle(data);\n\t}\n\tpatch(asset, assets) {}\n}\n\nexport { BundleHandler };\n","import '../../core/tracing.js';\n\nclass ResourceLoader {\n\tconstructor(app) {\n\t\tthis._handlers = {};\n\t\tthis._requests = {};\n\t\tthis._cache = {};\n\t\tthis._app = app;\n\t}\n\taddHandler(type, handler) {\n\t\tthis._handlers[type] = handler;\n\t\thandler._loader = this;\n\t}\n\tremoveHandler(type) {\n\t\tdelete this._handlers[type];\n\t}\n\tgetHandler(type) {\n\t\treturn this._handlers[type];\n\t}\n\tstatic makeKey(url, type) {\n\t\treturn `${url}-${type}`;\n\t}\n\tload(url, type, callback, asset) {\n\t\tconst handler = this._handlers[type];\n\t\tif (!handler) {\n\t\t\tconst err = `No resource handler for asset type: '${type}' when loading [${url}]`;\n\t\t\tcallback(err);\n\t\t\treturn;\n\t\t}\n\t\tif (!url) {\n\t\t\tthis._loadNull(handler, callback, asset);\n\t\t\treturn;\n\t\t}\n\t\tconst key = ResourceLoader.makeKey(url, type);\n\t\tif (this._cache[key] !== undefined) {\n\t\t\tcallback(null, this._cache[key]);\n\t\t} else if (this._requests[key]) {\n\t\t\tthis._requests[key].push(callback);\n\t\t} else {\n\t\t\tthis._requests[key] = [callback];\n\t\t\tconst self = this;\n\t\t\tconst handleLoad = function handleLoad(err, urlObj) {\n\t\t\t\tif (err) {\n\t\t\t\t\tself._onFailure(key, err);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\thandler.load(urlObj, function (err, data, extra) {\n\t\t\t\t\tif (!self._requests[key]) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tself._onFailure(key, err);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\ttry {\n\t\t\t\t\t\tself._onSuccess(key, handler.open(urlObj.original, data, asset), extra);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tself._onFailure(key, e);\n\t\t\t\t\t}\n\t\t\t\t}, asset);\n\t\t\t};\n\t\t\tconst normalizedUrl = url.split('?')[0];\n\t\t\tif (this._app.enableBundles && this._app.bundles.hasUrl(normalizedUrl)) {\n\t\t\t\tif (!this._app.bundles.canLoadUrl(normalizedUrl)) {\n\t\t\t\t\thandleLoad(`Bundle for ${url} not loaded yet`);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis._app.bundles.loadUrl(normalizedUrl, function (err, fileUrlFromBundle) {\n\t\t\t\t\thandleLoad(err, {\n\t\t\t\t\t\tload: fileUrlFromBundle,\n\t\t\t\t\t\toriginal: normalizedUrl\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\thandleLoad(null, {\n\t\t\t\t\tload: url,\n\t\t\t\t\toriginal: asset && asset.file.filename || url\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\t_loadNull(handler, callback, asset) {\n\t\tconst onLoad = function onLoad(err, data, extra) {\n\t\t\tif (err) {\n\t\t\t\tcallback(err);\n\t\t\t} else {\n\t\t\t\ttry {\n\t\t\t\t\tcallback(null, handler.open(null, data, asset), extra);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tcallback(e);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\thandler.load(null, onLoad, asset);\n\t}\n\t_onSuccess(key, result, extra) {\n\t\tif (result !== null) {\n\t\t\tthis._cache[key] = result;\n\t\t} else {\n\t\t\tdelete this._cache[key];\n\t\t}\n\t\tfor (let i = 0; i < this._requests[key].length; i++) {\n\t\t\tthis._requests[key][i](null, result, extra);\n\t\t}\n\t\tdelete this._requests[key];\n\t}\n\t_onFailure(key, err) {\n\t\tconsole.error(err);\n\t\tif (this._requests[key]) {\n\t\t\tfor (let i = 0; i < this._requests[key].length; i++) {\n\t\t\t\tthis._requests[key][i](err);\n\t\t\t}\n\t\t\tdelete this._requests[key];\n\t\t}\n\t}\n\topen(type, data) {\n\t\tconst handler = this._handlers[type];\n\t\tif (!handler) {\n\t\t\tconsole.warn('No resource handler found for: ' + type);\n\t\t\treturn data;\n\t\t}\n\t\treturn handler.open(null, data);\n\t}\n\tpatch(asset, assets) {\n\t\tconst handler = this._handlers[asset.type];\n\t\tif (!handler) {\n\t\t\tconsole.warn('No resource handler found for: ' + asset.type);\n\t\t\treturn;\n\t\t}\n\t\tif (handler.patch) {\n\t\t\thandler.patch(asset, assets);\n\t\t}\n\t}\n\tclearCache(url, type) {\n\t\tconst key = ResourceLoader.makeKey(url, type);\n\t\tdelete this._cache[key];\n\t}\n\tgetFromCache(url, type) {\n\t\tconst key = ResourceLoader.makeKey(url, type);\n\t\tif (this._cache[key]) {\n\t\t\treturn this._cache[key];\n\t\t}\n\t\treturn undefined;\n\t}\n\tenableRetry(maxRetries = 5) {\n\t\tmaxRetries = Math.max(0, maxRetries) || 0;\n\t\tfor (const key in this._handlers) {\n\t\t\tthis._handlers[key].maxRetries = maxRetries;\n\t\t}\n\t}\n\tdisableRetry() {\n\t\tfor (const key in this._handlers) {\n\t\t\tthis._handlers[key].maxRetries = 0;\n\t\t}\n\t}\n\tdestroy() {\n\t\tthis._handlers = {};\n\t\tthis._requests = {};\n\t\tthis._cache = {};\n\t}\n}\n\nexport { ResourceLoader };\n","class I18nParser {\n\t_validate(data) {\n\t\tif (!data.header) {\n\t\t\tthrow new Error('pc.I18n#addData: Missing \"header\" field');\n\t\t}\n\t\tif (!data.header.version) {\n\t\t\tthrow new Error('pc.I18n#addData: Missing \"header.version\" field');\n\t\t}\n\t\tif (data.header.version !== 1) {\n\t\t\tthrow new Error('pc.I18n#addData: Invalid \"header.version\" field');\n\t\t}\n\t\tif (!data.data) {\n\t\t\tthrow new Error('pc.I18n#addData: Missing \"data\" field');\n\t\t} else if (!Array.isArray(data.data)) {\n\t\t\tthrow new Error('pc.I18n#addData: \"data\" field must be an array');\n\t\t}\n\t\tfor (let i = 0, len = data.data.length; i < len; i++) {\n\t\t\tconst entry = data.data[i];\n\t\t\tif (!entry.info) {\n\t\t\t\tthrow new Error(`pc.I18n#addData: missing \"data[${i}].info\" field`);\n\t\t\t}\n\t\t\tif (!entry.info.locale) {\n\t\t\t\tthrow new Error(`pc.I18n#addData: missing \"data[${i}].info.locale\" field`);\n\t\t\t}\n\t\t\tif (typeof entry.info.locale !== 'string') {\n\t\t\t\tthrow new Error(`pc.I18n#addData: \"data[${i}].info.locale\" must be a string`);\n\t\t\t}\n\t\t\tif (!entry.messages) {\n\t\t\t\tthrow new Error(`pc.I18n#addData: missing \"data[${i}].messages\" field`);\n\t\t\t}\n\t\t}\n\t}\n\tparse(data) {\n\t\treturn data.data;\n\t}\n}\n\nexport { I18nParser };\n","import { EventHandler } from '../../core/event-handler.js';\nimport { Asset } from '../asset/asset.js';\nimport { I18nParser } from './i18n-parser.js';\nimport { DEFAULT_LOCALE, DEFAULT_LOCALE_FALLBACKS } from './constants.js';\nimport { getLang, replaceLang, getPluralFn, findAvailableLocale } from './utils.js';\n\nclass I18n extends EventHandler {\n\tconstructor(app) {\n\t\tsuper();\n\t\tthis.locale = DEFAULT_LOCALE;\n\t\tthis._translations = {};\n\t\tthis._availableLangs = {};\n\t\tthis._app = app;\n\t\tthis._assets = [];\n\t\tthis._parser = new I18nParser();\n\t}\n\tset assets(value) {\n\t\tconst index = {};\n\t\tfor (let _i = 0, len = value.length; _i < len; _i++) {\n\t\t\tconst id = value[_i] instanceof Asset ? value[_i].id : value[_i];\n\t\t\tindex[id] = true;\n\t\t}\n\t\tlet i = this._assets.length;\n\t\twhile (i--) {\n\t\t\tconst id = this._assets[i];\n\t\t\tif (!index[id]) {\n\t\t\t\tthis._app.assets.off('add:' + id, this._onAssetAdd, this);\n\t\t\t\tconst asset = this._app.assets.get(id);\n\t\t\t\tif (asset) {\n\t\t\t\t\tthis._onAssetRemove(asset);\n\t\t\t\t}\n\t\t\t\tthis._assets.splice(i, 1);\n\t\t\t}\n\t\t}\n\t\tfor (const id in index) {\n\t\t\tconst idNum = parseInt(id, 10);\n\t\t\tif (this._assets.indexOf(idNum) !== -1) continue;\n\t\t\tthis._assets.push(idNum);\n\t\t\tconst asset = this._app.assets.get(idNum);\n\t\t\tif (!asset) {\n\t\t\t\tthis._app.assets.once('add:' + idNum, this._onAssetAdd, this);\n\t\t\t} else {\n\t\t\t\tthis._onAssetAdd(asset);\n\t\t\t}\n\t\t}\n\t}\n\tget assets() {\n\t\treturn this._assets;\n\t}\n\tset locale(value) {\n\t\tif (this._locale === value) {\n\t\t\treturn;\n\t\t}\n\t\tlet lang = getLang(value);\n\t\tif (lang === 'in') {\n\t\t\tlang = 'id';\n\t\t\tvalue = replaceLang(value, lang);\n\t\t\tif (this._locale === value) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tconst old = this._locale;\n\t\tthis._locale = value;\n\t\tthis._lang = lang;\n\t\tthis._pluralFn = getPluralFn(this._lang);\n\t\tthis.fire('set:locale', value, old);\n\t}\n\tget locale() {\n\t\treturn this._locale;\n\t}\n\tstatic findAvailableLocale(desiredLocale, availableLocales) {\n\t\treturn findAvailableLocale(desiredLocale, availableLocales);\n\t}\n\tfindAvailableLocale(desiredLocale) {\n\t\tif (this._translations[desiredLocale]) {\n\t\t\treturn desiredLocale;\n\t\t}\n\t\tconst lang = getLang(desiredLocale);\n\t\treturn this._findFallbackLocale(desiredLocale, lang);\n\t}\n\tgetText(key, locale) {\n\t\tlet result = key;\n\t\tlet lang;\n\t\tif (!locale) {\n\t\t\tlocale = this._locale;\n\t\t\tlang = this._lang;\n\t\t}\n\t\tlet translations = this._translations[locale];\n\t\tif (!translations) {\n\t\t\tif (!lang) {\n\t\t\t\tlang = getLang(locale);\n\t\t\t}\n\t\t\tlocale = this._findFallbackLocale(locale, lang);\n\t\t\ttranslations = this._translations[locale];\n\t\t}\n\t\tif (translations && translations.hasOwnProperty(key)) {\n\t\t\tresult = translations[key];\n\t\t\tif (Array.isArray(result)) {\n\t\t\t\tresult = result[0];\n\t\t\t}\n\t\t\tif (result === null || result === undefined) {\n\t\t\t\tresult = key;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\tgetPluralText(key, n, locale) {\n\t\tlet result = key;\n\t\tlet lang;\n\t\tlet pluralFn;\n\t\tif (!locale) {\n\t\t\tlocale = this._locale;\n\t\t\tlang = this._lang;\n\t\t\tpluralFn = this._pluralFn;\n\t\t} else {\n\t\t\tlang = getLang(locale);\n\t\t\tpluralFn = getPluralFn(lang);\n\t\t}\n\t\tlet translations = this._translations[locale];\n\t\tif (!translations) {\n\t\t\tlocale = this._findFallbackLocale(locale, lang);\n\t\t\tlang = getLang(locale);\n\t\t\tpluralFn = getPluralFn(lang);\n\t\t\ttranslations = this._translations[locale];\n\t\t}\n\t\tif (translations && translations[key] && pluralFn) {\n\t\t\tconst index = pluralFn(n);\n\t\t\tresult = translations[key][index];\n\t\t\tif (result === null || result === undefined) {\n\t\t\t\tresult = key;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\taddData(data) {\n\t\tlet parsed;\n\t\ttry {\n\t\t\tparsed = this._parser.parse(data);\n\t\t} catch (err) {\n\t\t\tconsole.error(err);\n\t\t\treturn;\n\t\t}\n\t\tfor (let i = 0, len = parsed.length; i < len; i++) {\n\t\t\tconst entry = parsed[i];\n\t\t\tconst locale = entry.info.locale;\n\t\t\tconst messages = entry.messages;\n\t\t\tif (!this._translations[locale]) {\n\t\t\t\tthis._translations[locale] = {};\n\t\t\t\tconst lang = getLang(locale);\n\t\t\t\tif (!this._availableLangs[lang]) {\n\t\t\t\t\tthis._availableLangs[lang] = locale;\n\t\t\t\t}\n\t\t\t}\n\t\t\tObject.assign(this._translations[locale], messages);\n\t\t\tthis.fire('data:add', locale, messages);\n\t\t}\n\t}\n\tremoveData(data) {\n\t\tlet parsed;\n\t\ttry {\n\t\t\tparsed = this._parser.parse(data);\n\t\t} catch (err) {\n\t\t\tconsole.error(err);\n\t\t\treturn;\n\t\t}\n\t\tfor (let i = 0, len = parsed.length; i < len; i++) {\n\t\t\tconst entry = parsed[i];\n\t\t\tconst locale = entry.info.locale;\n\t\t\tconst translations = this._translations[locale];\n\t\t\tif (!translations) continue;\n\t\t\tconst messages = entry.messages;\n\t\t\tfor (const key in messages) {\n\t\t\t\tdelete translations[key];\n\t\t\t}\n\t\t\tif (Object.keys(translations).length === 0) {\n\t\t\t\tdelete this._translations[locale];\n\t\t\t\tdelete this._availableLangs[getLang(locale)];\n\t\t\t}\n\t\t\tthis.fire('data:remove', locale, messages);\n\t\t}\n\t}\n\tdestroy() {\n\t\tthis._translations = null;\n\t\tthis._availableLangs = null;\n\t\tthis._assets = null;\n\t\tthis._parser = null;\n\t\tthis.off();\n\t}\n\t_findFallbackLocale(locale, lang) {\n\t\tlet result = DEFAULT_LOCALE_FALLBACKS[locale];\n\t\tif (result && this._translations[result]) {\n\t\t\treturn result;\n\t\t}\n\t\tresult = DEFAULT_LOCALE_FALLBACKS[lang];\n\t\tif (result && this._translations[result]) {\n\t\t\treturn result;\n\t\t}\n\t\tresult = this._availableLangs[lang];\n\t\tif (result && this._translations[result]) {\n\t\t\treturn result;\n\t\t}\n\t\treturn DEFAULT_LOCALE;\n\t}\n\t_onAssetAdd(asset) {\n\t\tasset.on('load', this._onAssetLoad, this);\n\t\tasset.on('change', this._onAssetChange, this);\n\t\tasset.on('remove', this._onAssetRemove, this);\n\t\tasset.on('unload', this._onAssetUnload, this);\n\t\tif (asset.resource) {\n\t\t\tthis._onAssetLoad(asset);\n\t\t}\n\t}\n\t_onAssetLoad(asset) {\n\t\tthis.addData(asset.resource);\n\t}\n\t_onAssetChange(asset) {\n\t\tif (asset.resource) {\n\t\t\tthis.addData(asset.resource);\n\t\t}\n\t}\n\t_onAssetRemove(asset) {\n\t\tasset.off('load', this._onAssetLoad, this);\n\t\tasset.off('change', this._onAssetChange, this);\n\t\tasset.off('remove', this._onAssetRemove, this);\n\t\tasset.off('unload', this._onAssetUnload, this);\n\t\tif (asset.resource) {\n\t\t\tthis.removeData(asset.resource);\n\t\t}\n\t\tthis._app.assets.once('add:' + asset.id, this._onAssetAdd, this);\n\t}\n\t_onAssetUnload(asset) {\n\t\tif (asset.resource) {\n\t\t\tthis.removeData(asset.resource);\n\t\t}\n\t}\n}\n\nexport { I18n };\n","import { EventHandler } from '../../core/event-handler.js';\n\nclass ScriptRegistry extends EventHandler {\n\tconstructor(app) {\n\t\tsuper();\n\t\tthis.app = app;\n\t\tthis._scripts = {};\n\t\tthis._list = [];\n\t}\n\tdestroy() {\n\t\tthis.app = null;\n\t\tthis.off();\n\t}\n\tadd(script) {\n\t\tconst scriptName = script.__name;\n\t\tif (this._scripts.hasOwnProperty(scriptName)) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (script.prototype.swap) {\n\t\t\t\t\tconst old = this._scripts[scriptName];\n\t\t\t\t\tconst ind = this._list.indexOf(old);\n\t\t\t\t\tthis._list[ind] = script;\n\t\t\t\t\tthis._scripts[scriptName] = script;\n\t\t\t\t\tthis.fire('swap', scriptName, script);\n\t\t\t\t\tthis.fire('swap:' + scriptName, script);\n\t\t\t\t} else {\n\t\t\t\t\tconsole.warn(`script registry already has '${scriptName}' script, define 'swap' method for new script type to enable code hot swapping`);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn false;\n\t\t}\n\t\tthis._scripts[scriptName] = script;\n\t\tthis._list.push(script);\n\t\tthis.fire('add', scriptName, script);\n\t\tthis.fire('add:' + scriptName, script);\n\t\tsetTimeout(() => {\n\t\t\tif (!this._scripts.hasOwnProperty(scriptName)) return;\n\t\t\tif (!this.app || !this.app.systems || !this.app.systems.script) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst components = this.app.systems.script._components;\n\t\t\tlet attributes;\n\t\t\tconst scriptInstances = [];\n\t\t\tconst scriptInstancesInitialized = [];\n\t\t\tfor (components.loopIndex = 0; components.loopIndex < components.length; components.loopIndex++) {\n\t\t\t\tconst component = components.items[components.loopIndex];\n\t\t\t\tif (component._scriptsIndex[scriptName] && component._scriptsIndex[scriptName].awaiting) {\n\t\t\t\t\tif (component._scriptsData && component._scriptsData[scriptName]) attributes = component._scriptsData[scriptName].attributes;\n\t\t\t\t\tconst scriptInstance = component.create(scriptName, {\n\t\t\t\t\t\tpreloading: true,\n\t\t\t\t\t\tind: component._scriptsIndex[scriptName].ind,\n\t\t\t\t\t\tattributes: attributes\n\t\t\t\t\t});\n\t\t\t\t\tif (scriptInstance) scriptInstances.push(scriptInstance);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (let i = 0; i < scriptInstances.length; i++) scriptInstances[i].__initializeAttributes();\n\t\t\tfor (let i = 0; i < scriptInstances.length; i++) {\n\t\t\t\tif (scriptInstances[i].enabled) {\n\t\t\t\t\tscriptInstances[i]._initialized = true;\n\t\t\t\t\tscriptInstancesInitialized.push(scriptInstances[i]);\n\t\t\t\t\tif (scriptInstances[i].initialize) scriptInstances[i].initialize();\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (let i = 0; i < scriptInstancesInitialized.length; i++) {\n\t\t\t\tif (!scriptInstancesInitialized[i].enabled || scriptInstancesInitialized[i]._postInitialized) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tscriptInstancesInitialized[i]._postInitialized = true;\n\t\t\t\tif (scriptInstancesInitialized[i].postInitialize) scriptInstancesInitialized[i].postInitialize();\n\t\t\t}\n\t\t});\n\t\treturn true;\n\t}\n\tremove(nameOrType) {\n\t\tlet scriptType = nameOrType;\n\t\tlet scriptName = nameOrType;\n\t\tif (typeof scriptName !== 'string') {\n\t\t\tscriptName = scriptType.__name;\n\t\t} else {\n\t\t\tscriptType = this.get(scriptName);\n\t\t}\n\t\tif (this.get(scriptName) !== scriptType) return false;\n\t\tdelete this._scripts[scriptName];\n\t\tconst ind = this._list.indexOf(scriptType);\n\t\tthis._list.splice(ind, 1);\n\t\tthis.fire('remove', scriptName, scriptType);\n\t\tthis.fire('remove:' + scriptName, scriptType);\n\t\treturn true;\n\t}\n\tget(name) {\n\t\treturn this._scripts[name] || null;\n\t}\n\thas(nameOrType) {\n\t\tif (typeof nameOrType === 'string') {\n\t\t\treturn this._scripts.hasOwnProperty(nameOrType);\n\t\t}\n\t\tif (!nameOrType) return false;\n\t\tconst scriptName = nameOrType.__name;\n\t\treturn this._scripts[scriptName] === nameOrType;\n\t}\n\tlist() {\n\t\treturn this._list;\n\t}\n}\n\nexport { ScriptRegistry };\n","import '../core/tracing.js';\nimport { guid } from '../core/guid.js';\nimport { GraphNode } from '../scene/graph-node.js';\nimport { getApplication } from './globals.js';\n\nconst _enableList = [];\nclass Entity extends GraphNode {\n\tconstructor(name, app = getApplication()) {\n\t\tsuper(name);\n\t\tthis.anim = void 0;\n\t\tthis.animation = void 0;\n\t\tthis.audiolistener = void 0;\n\t\tthis.button = void 0;\n\t\tthis.camera = void 0;\n\t\tthis.collision = void 0;\n\t\tthis.element = void 0;\n\t\tthis.layoutchild = void 0;\n\t\tthis.layoutgroup = void 0;\n\t\tthis.light = void 0;\n\t\tthis.model = void 0;\n\t\tthis.particlesystem = void 0;\n\t\tthis.render = void 0;\n\t\tthis.rigidbody = void 0;\n\t\tthis.screen = void 0;\n\t\tthis.script = void 0;\n\t\tthis.scrollbar = void 0;\n\t\tthis.scrollview = void 0;\n\t\tthis.sound = void 0;\n\t\tthis.sprite = void 0;\n\t\tthis.c = {};\n\t\tthis._app = void 0;\n\t\tthis._destroying = false;\n\t\tthis._guid = null;\n\t\tthis._template = false;\n\t\tthis._app = app;\n\t}\n\taddComponent(type, data) {\n\t\tconst system = this._app.systems[type];\n\t\tif (!system) {\n\t\t\treturn null;\n\t\t}\n\t\tif (this.c[type]) {\n\t\t\treturn null;\n\t\t}\n\t\treturn system.addComponent(this, data);\n\t}\n\tremoveComponent(type) {\n\t\tconst system = this._app.systems[type];\n\t\tif (!system) {\n\t\t\treturn;\n\t\t}\n\t\tif (!this.c[type]) {\n\t\t\treturn;\n\t\t}\n\t\tsystem.removeComponent(this);\n\t}\n\tfindComponent(type) {\n\t\tconst entity = this.findOne(function (node) {\n\t\t\treturn node.c && node.c[type];\n\t\t});\n\t\treturn entity && entity.c[type];\n\t}\n\tfindComponents(type) {\n\t\tconst entities = this.find(function (node) {\n\t\t\treturn node.c && node.c[type];\n\t\t});\n\t\treturn entities.map(function (entity) {\n\t\t\treturn entity.c[type];\n\t\t});\n\t}\n\tgetGuid() {\n\t\tif (!this._guid) {\n\t\t\tthis.setGuid(guid.create());\n\t\t}\n\t\treturn this._guid;\n\t}\n\tsetGuid(guid) {\n\t\tconst index = this._app._entityIndex;\n\t\tif (this._guid) {\n\t\t\tdelete index[this._guid];\n\t\t}\n\t\tthis._guid = guid;\n\t\tindex[this._guid] = this;\n\t}\n\t_notifyHierarchyStateChanged(node, enabled) {\n\t\tlet enableFirst = false;\n\t\tif (node === this && _enableList.length === 0) enableFirst = true;\n\t\tnode._beingEnabled = true;\n\t\tnode._onHierarchyStateChanged(enabled);\n\t\tif (node._onHierarchyStatePostChanged) _enableList.push(node);\n\t\tconst c = node._children;\n\t\tfor (let i = 0, len = c.length; i < len; i++) {\n\t\t\tif (c[i]._enabled) this._notifyHierarchyStateChanged(c[i], enabled);\n\t\t}\n\t\tnode._beingEnabled = false;\n\t\tif (enableFirst) {\n\t\t\tfor (let i = 0; i < _enableList.length; i++) {\n\t\t\t\t_enableList[i]._onHierarchyStatePostChanged();\n\t\t\t}\n\t\t\t_enableList.length = 0;\n\t\t}\n\t}\n\t_onHierarchyStateChanged(enabled) {\n\t\tsuper._onHierarchyStateChanged(enabled);\n\t\tconst components = this.c;\n\t\tfor (const type in components) {\n\t\t\tif (components.hasOwnProperty(type)) {\n\t\t\t\tconst component = components[type];\n\t\t\t\tif (component.enabled) {\n\t\t\t\t\tif (enabled) {\n\t\t\t\t\t\tcomponent.onEnable();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcomponent.onDisable();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t_onHierarchyStatePostChanged() {\n\t\tconst components = this.c;\n\t\tfor (const type in components) {\n\t\t\tif (components.hasOwnProperty(type)) components[type].onPostStateChange();\n\t\t}\n\t}\n\tfindByGuid(guid) {\n\t\tif (this._guid === guid) return this;\n\t\tconst e = this._app._entityIndex[guid];\n\t\tif (e && (e === this || e.isDescendantOf(this))) {\n\t\t\treturn e;\n\t\t}\n\t\treturn null;\n\t}\n\tdestroy() {\n\t\tthis._destroying = true;\n\t\tfor (const name in this.c) {\n\t\t\tthis.c[name].enabled = false;\n\t\t}\n\t\tfor (const name in this.c) {\n\t\t\tthis.c[name].system.removeComponent(this);\n\t\t}\n\t\tsuper.destroy();\n\t\tif (this._guid) {\n\t\t\tdelete this._app._entityIndex[this._guid];\n\t\t}\n\t\tthis._destroying = false;\n\t}\n\tclone() {\n\t\tconst duplicatedIdsMap = {};\n\t\tconst clone = this._cloneRecursively(duplicatedIdsMap);\n\t\tduplicatedIdsMap[this.getGuid()] = clone;\n\t\tresolveDuplicatedEntityReferenceProperties(this, this, clone, duplicatedIdsMap);\n\t\treturn clone;\n\t}\n\t_cloneRecursively(duplicatedIdsMap) {\n\t\tconst clone = new this.constructor(undefined, this._app);\n\t\tsuper._cloneInternal(clone);\n\t\tfor (const type in this.c) {\n\t\t\tconst component = this.c[type];\n\t\t\tcomponent.system.cloneComponent(this, clone);\n\t\t}\n\t\tfor (let i = 0; i < this._children.length; i++) {\n\t\t\tconst oldChild = this._children[i];\n\t\t\tif (oldChild instanceof Entity) {\n\t\t\t\tconst newChild = oldChild._cloneRecursively(duplicatedIdsMap);\n\t\t\t\tclone.addChild(newChild);\n\t\t\t\tduplicatedIdsMap[oldChild.getGuid()] = newChild;\n\t\t\t}\n\t\t}\n\t\treturn clone;\n\t}\n}\nfunction resolveDuplicatedEntityReferenceProperties(oldSubtreeRoot, oldEntity, newEntity, duplicatedIdsMap) {\n\tif (oldEntity instanceof Entity) {\n\t\tconst components = oldEntity.c;\n\t\tfor (const componentName in components) {\n\t\t\tconst component = components[componentName];\n\t\t\tconst entityProperties = component.system.getPropertiesOfType('entity');\n\t\t\tfor (let i = 0, len = entityProperties.length; i < len; i++) {\n\t\t\t\tconst propertyDescriptor = entityProperties[i];\n\t\t\t\tconst propertyName = propertyDescriptor.name;\n\t\t\t\tconst oldEntityReferenceId = component[propertyName];\n\t\t\t\tconst entityIsWithinOldSubtree = !!oldSubtreeRoot.findByGuid(oldEntityReferenceId);\n\t\t\t\tif (entityIsWithinOldSubtree) {\n\t\t\t\t\tconst newEntityReferenceId = duplicatedIdsMap[oldEntityReferenceId].getGuid();\n\t\t\t\t\tif (newEntityReferenceId) {\n\t\t\t\t\t\tnewEntity.c[componentName][propertyName] = newEntityReferenceId;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (components.script && !newEntity._app.useLegacyScriptAttributeCloning) {\n\t\t\tnewEntity.script.resolveDuplicatedEntityReferenceProperties(components.script, duplicatedIdsMap);\n\t\t}\n\t\tif (components.render) {\n\t\t\tnewEntity.render.resolveDuplicatedEntityReferenceProperties(components.render, duplicatedIdsMap);\n\t\t}\n\t\tif (components.anim) {\n\t\t\tnewEntity.anim.resolveDuplicatedEntityReferenceProperties(components.anim, duplicatedIdsMap);\n\t\t}\n\t\tconst _old = oldEntity.children.filter(function (e) {\n\t\t\treturn e instanceof Entity;\n\t\t});\n\t\tconst _new = newEntity.children.filter(function (e) {\n\t\t\treturn e instanceof Entity;\n\t\t});\n\t\tfor (let i = 0, len = _old.length; i < len; i++) {\n\t\t\tresolveDuplicatedEntityReferenceProperties(oldSubtreeRoot, _old[i], _new[i], duplicatedIdsMap);\n\t\t}\n\t}\n}\n\nexport { Entity };\n","class SceneRegistryItem {\n\tconstructor(name, url) {\n\t\tthis.name = void 0;\n\t\tthis.url = void 0;\n\t\tthis.data = null;\n\t\tthis._loading = false;\n\t\tthis._onLoadedCallbacks = [];\n\t\tthis.name = name;\n\t\tthis.url = url;\n\t}\n\tget loaded() {\n\t\treturn !!this.data;\n\t}\n\tget loading() {\n\t\treturn this._loading;\n\t}\n}\n\nexport { SceneRegistryItem };\n","import { path } from '../core/path.js';\nimport '../core/tracing.js';\nimport { ABSOLUTE_URL } from './asset/constants.js';\nimport { SceneRegistryItem } from './scene-registry-item.js';\n\nclass SceneRegistry {\n\tconstructor(app) {\n\t\tthis._app = void 0;\n\t\tthis._list = [];\n\t\tthis._index = {};\n\t\tthis._urlIndex = {};\n\t\tthis._app = app;\n\t}\n\tdestroy() {\n\t\tthis._app = null;\n\t}\n\tlist() {\n\t\treturn this._list;\n\t}\n\tadd(name, url) {\n\t\tif (this._index.hasOwnProperty(name)) {\n\t\t\treturn false;\n\t\t}\n\t\tconst item = new SceneRegistryItem(name, url);\n\t\tconst i = this._list.push(item);\n\t\tthis._index[item.name] = i - 1;\n\t\tthis._urlIndex[item.url] = i - 1;\n\t\treturn true;\n\t}\n\tfind(name) {\n\t\tif (this._index.hasOwnProperty(name)) {\n\t\t\treturn this._list[this._index[name]];\n\t\t}\n\t\treturn null;\n\t}\n\tfindByUrl(url) {\n\t\tif (this._urlIndex.hasOwnProperty(url)) {\n\t\t\treturn this._list[this._urlIndex[url]];\n\t\t}\n\t\treturn null;\n\t}\n\tremove(name) {\n\t\tif (this._index.hasOwnProperty(name)) {\n\t\t\tconst idx = this._index[name];\n\t\t\tlet item = this._list[idx];\n\t\t\tdelete this._urlIndex[item.url];\n\t\t\tdelete this._index[name];\n\t\t\tthis._list.splice(idx, 1);\n\t\t\tfor (let i = 0; i < this._list.length; i++) {\n\t\t\t\titem = this._list[i];\n\t\t\t\tthis._index[item.name] = i;\n\t\t\t\tthis._urlIndex[item.url] = i;\n\t\t\t}\n\t\t}\n\t}\n\t_loadSceneData(sceneItem, storeInCache, callback) {\n\t\tconst app = this._app;\n\t\tlet url = sceneItem;\n\t\tif (typeof sceneItem === 'string') {\n\t\t\tsceneItem = this.findByUrl(url) || this.find(url) || new SceneRegistryItem('Untitled', url);\n\t\t}\n\t\turl = sceneItem.url;\n\t\tif (!url) {\n\t\t\tcallback(\"Cannot find scene to load\");\n\t\t\treturn;\n\t\t}\n\t\tif (sceneItem.loaded) {\n\t\t\tcallback(null, sceneItem);\n\t\t\treturn;\n\t\t}\n\t\tif (app.assets && app.assets.prefix && !ABSOLUTE_URL.test(url)) {\n\t\t\turl = path.join(app.assets.prefix, url);\n\t\t}\n\t\tsceneItem._onLoadedCallbacks.push(callback);\n\t\tif (!sceneItem._loading) {\n\t\t\tconst handler = app.loader.getHandler(\"hierarchy\");\n\t\t\thandler.load(url, (err, data) => {\n\t\t\t\tsceneItem.data = data;\n\t\t\t\tsceneItem._loading = false;\n\t\t\t\tfor (let i = 0; i < sceneItem._onLoadedCallbacks.length; i++) {\n\t\t\t\t\tsceneItem._onLoadedCallbacks[i](err, sceneItem);\n\t\t\t\t}\n\t\t\t\tif (!storeInCache) {\n\t\t\t\t\tsceneItem.data = null;\n\t\t\t\t}\n\t\t\t\tsceneItem._onLoadedCallbacks.length = 0;\n\t\t\t});\n\t\t}\n\t\tsceneItem._loading = true;\n\t}\n\tloadSceneData(sceneItem, callback) {\n\t\tthis._loadSceneData(sceneItem, true, callback);\n\t}\n\tunloadSceneData(sceneItem) {\n\t\tif (typeof sceneItem === 'string') {\n\t\t\tsceneItem = this.findByUrl(sceneItem);\n\t\t}\n\t\tif (sceneItem) {\n\t\t\tsceneItem.data = null;\n\t\t}\n\t}\n\t_loadSceneHierarchy(sceneItem, onBeforeAddHierarchy, callback) {\n\t\tthis._loadSceneData(sceneItem, false, (err, sceneItem) => {\n\t\t\tif (err) {\n\t\t\t\tif (callback) {\n\t\t\t\t\tcallback(err);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (onBeforeAddHierarchy) {\n\t\t\t\tonBeforeAddHierarchy(sceneItem);\n\t\t\t}\n\t\t\tconst app = this._app;\n\t\t\tconst _loaded = () => {\n\t\t\t\tconst handler = app.loader.getHandler(\"hierarchy\");\n\t\t\t\tapp.systems.script.preloading = true;\n\t\t\t\tconst entity = handler.open(sceneItem.url, sceneItem.data);\n\t\t\t\tapp.systems.script.preloading = false;\n\t\t\t\tapp.loader.clearCache(sceneItem.url, \"hierarchy\");\n\t\t\t\tapp.root.addChild(entity);\n\t\t\t\tapp.systems.fire('initialize', entity);\n\t\t\t\tapp.systems.fire('postInitialize', entity);\n\t\t\t\tapp.systems.fire('postPostInitialize', entity);\n\t\t\t\tif (callback) callback(null, entity);\n\t\t\t};\n\t\t\tapp._preloadScripts(sceneItem.data, _loaded);\n\t\t});\n\t}\n\tloadSceneHierarchy(sceneItem, callback) {\n\t\tthis._loadSceneHierarchy(sceneItem, null, callback);\n\t}\n\tloadSceneSettings(sceneItem, callback) {\n\t\tthis._loadSceneData(sceneItem, false, (err, sceneItem) => {\n\t\t\tif (!err) {\n\t\t\t\tthis._app.applySceneSettings(sceneItem.data.settings);\n\t\t\t\tif (callback) {\n\t\t\t\t\tcallback(null);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (callback) {\n\t\t\t\t\tcallback(err);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\tchangeScene(sceneItem, callback) {\n\t\tconst app = this._app;\n\t\tconst onBeforeAddHierarchy = sceneItem => {\n\t\t\tconst {\n\t\t\t\tchildren\n\t\t\t} = app.root;\n\t\t\twhile (children.length) {\n\t\t\t\tchildren[0].destroy();\n\t\t\t}\n\t\t\tapp.applySceneSettings(sceneItem.data.settings);\n\t\t};\n\t\tthis._loadSceneHierarchy(sceneItem, onBeforeAddHierarchy, callback);\n\t}\n\tloadScene(url, callback) {\n\t\tconst app = this._app;\n\t\tconst handler = app.loader.getHandler(\"scene\");\n\t\tif (app.assets && app.assets.prefix && !ABSOLUTE_URL.test(url)) {\n\t\t\turl = path.join(app.assets.prefix, url);\n\t\t}\n\t\thandler.load(url, (err, data) => {\n\t\t\tif (!err) {\n\t\t\t\tconst _loaded = () => {\n\t\t\t\t\tapp.systems.script.preloading = true;\n\t\t\t\t\tconst scene = handler.open(url, data);\n\t\t\t\t\tconst sceneItem = this.findByUrl(url);\n\t\t\t\t\tif (sceneItem && !sceneItem.loaded) {\n\t\t\t\t\t\tsceneItem.data = data;\n\t\t\t\t\t}\n\t\t\t\t\tapp.systems.script.preloading = false;\n\t\t\t\t\tapp.loader.clearCache(url, \"scene\");\n\t\t\t\t\tapp.loader.patch({\n\t\t\t\t\t\tresource: scene,\n\t\t\t\t\t\ttype: \"scene\"\n\t\t\t\t\t}, app.assets);\n\t\t\t\t\tapp.root.addChild(scene.root);\n\t\t\t\t\tif (app.systems.rigidbody && typeof Ammo !== 'undefined') {\n\t\t\t\t\t\tapp.systems.rigidbody.gravity.set(scene._gravity.x, scene._gravity.y, scene._gravity.z);\n\t\t\t\t\t}\n\t\t\t\t\tif (callback) {\n\t\t\t\t\t\tcallback(null, scene);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tapp._preloadScripts(data, _loaded);\n\t\t\t} else {\n\t\t\t\tif (callback) {\n\t\t\t\t\tcallback(err);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n\nexport { SceneRegistry };\n","import { getApplication } from './globals.js';\n\nclass ApplicationStats {\n\tconstructor(device) {\n\t\tthis.frame = {\n\t\t\tfps: 0,\n\t\t\tms: 0,\n\t\t\tdt: 0,\n\t\t\tupdateStart: 0,\n\t\t\tupdateTime: 0,\n\t\t\trenderStart: 0,\n\t\t\trenderTime: 0,\n\t\t\tphysicsStart: 0,\n\t\t\tphysicsTime: 0,\n\t\t\tcullTime: 0,\n\t\t\tsortTime: 0,\n\t\t\tskinTime: 0,\n\t\t\tmorphTime: 0,\n\t\t\tinstancingTime: 0,\n\t\t\ttriangles: 0,\n\t\t\totherPrimitives: 0,\n\t\t\tshaders: 0,\n\t\t\tmaterials: 0,\n\t\t\tcameras: 0,\n\t\t\tshadowMapUpdates: 0,\n\t\t\tshadowMapTime: 0,\n\t\t\tdepthMapTime: 0,\n\t\t\tforwardTime: 0,\n\t\t\tlightClustersTime: 0,\n\t\t\tlightClusters: 0,\n\t\t\t_timeToCountFrames: 0,\n\t\t\t_fpsAccum: 0\n\t\t};\n\t\tthis.drawCalls = {\n\t\t\tforward: 0,\n\t\t\tdepth: 0,\n\t\t\tshadow: 0,\n\t\t\timmediate: 0,\n\t\t\tmisc: 0,\n\t\t\ttotal: 0,\n\t\t\tskinned: 0,\n\t\t\tinstanced: 0,\n\t\t\tremovedByInstancing: 0\n\t\t};\n\t\tthis.misc = {\n\t\t\trenderTargetCreationTime: 0\n\t\t};\n\t\tthis.particles = {\n\t\t\tupdatesPerFrame: 0,\n\t\t\t_updatesPerFrame: 0,\n\t\t\tframeTime: 0,\n\t\t\t_frameTime: 0\n\t\t};\n\t\tthis.shaders = device._shaderStats;\n\t\tthis.vram = device._vram;\n\t\tObject.defineProperty(this.vram, 'totalUsed', {\n\t\t\tget: function () {\n\t\t\t\treturn this.tex + this.vb + this.ib;\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(this.vram, 'geom', {\n\t\t\tget: function () {\n\t\t\t\treturn this.vb + this.ib;\n\t\t\t}\n\t\t});\n\t}\n\tget scene() {\n\t\treturn getApplication().scene._stats;\n\t}\n\tget lightmapper() {\n\t\tvar _getApplication$light;\n\t\treturn (_getApplication$light = getApplication().lightmapper) == null ? void 0 : _getApplication$light.stats;\n\t}\n\tget batcher() {\n\t\tconst batcher = getApplication()._batcher;\n\t\treturn batcher ? batcher._stats : null;\n\t}\n}\n\nexport { ApplicationStats };\n","import { platform } from '../core/platform.js';\nimport { now } from '../core/time.js';\nimport { path } from '../core/path.js';\nimport '../core/tracing.js';\nimport { EventHandler } from '../core/event-handler.js';\nimport { Color } from '../core/math/color.js';\nimport { Mat4 } from '../core/math/mat4.js';\nimport { math } from '../core/math/math.js';\nimport { Quat } from '../core/math/quat.js';\nimport { Vec3 } from '../core/math/vec3.js';\nimport { PRIMITIVE_TRIANGLES, PRIMITIVE_TRISTRIP, PRIMITIVE_TRIFAN, CULLFACE_NONE } from '../platform/graphics/constants.js';\nimport { GraphicsDeviceAccess } from '../platform/graphics/graphics-device-access.js';\nimport { http } from '../platform/net/http.js';\nimport { LAYERID_WORLD, LAYERID_DEPTH, SORTMODE_NONE, LAYERID_SKYBOX, LAYERID_UI, SORTMODE_MANUAL, LAYERID_IMMEDIATE, SPECULAR_BLINN } from '../scene/constants.js';\nimport { setProgramLibrary } from '../scene/shader-lib/get-program-library.js';\nimport { ProgramLibrary } from '../scene/shader-lib/program-library.js';\nimport { ForwardRenderer } from '../scene/renderer/forward-renderer.js';\nimport { FrameGraph } from '../scene/frame-graph.js';\nimport { AreaLightLuts } from '../scene/area-light-luts.js';\nimport { Layer } from '../scene/layer.js';\nimport { LayerComposition } from '../scene/composition/layer-composition.js';\nimport { Scene } from '../scene/scene.js';\nimport { Material } from '../scene/materials/material.js';\nimport { LightsBuffer } from '../scene/lighting/lights-buffer.js';\nimport { StandardMaterial } from '../scene/materials/standard-material.js';\nimport { setDefaultMaterial } from '../scene/materials/default-material.js';\nimport { Asset } from './asset/asset.js';\nimport { AssetRegistry } from './asset/asset-registry.js';\nimport { BundleRegistry } from './bundle/bundle-registry.js';\nimport { ComponentSystemRegistry } from './components/registry.js';\nimport { BundleHandler } from './handlers/bundle.js';\nimport { ResourceLoader } from './handlers/loader.js';\nimport { I18n } from './i18n/i18n.js';\nimport { ScriptRegistry } from './script/script-registry.js';\nimport { Entity } from './entity.js';\nimport { SceneRegistry } from './scene-registry.js';\nimport { script } from './script.js';\nimport { ApplicationStats } from './stats.js';\nimport { FILLMODE_KEEP_ASPECT, RESOLUTION_FIXED, RESOLUTION_AUTO, FILLMODE_FILL_WINDOW } from './constants.js';\nimport { setApplication, getApplication } from './globals.js';\n\nclass Progress {\n\tconstructor(length) {\n\t\tthis.length = length;\n\t\tthis.count = 0;\n\t}\n\tinc() {\n\t\tthis.count++;\n\t}\n\tdone() {\n\t\treturn this.count === this.length;\n\t}\n}\nlet app = null;\nclass AppBase extends EventHandler {\n\tconstructor(canvas) {\n\t\tsuper();\n\t\tthis.frameRequestId = void 0;\n\t\tAppBase._applications[canvas.id] = this;\n\t\tsetApplication(this);\n\t\tapp = this;\n\t\tthis._destroyRequested = false;\n\t\tthis._inFrameUpdate = false;\n\t\tthis._time = 0;\n\t\tthis.timeScale = 1;\n\t\tthis.maxDeltaTime = 0.1;\n\t\tthis.frame = 0;\n\t\tthis.autoRender = true;\n\t\tthis.renderNextFrame = false;\n\t\tthis.useLegacyScriptAttributeCloning = script.legacy;\n\t\tthis._librariesLoaded = false;\n\t\tthis._fillMode = FILLMODE_KEEP_ASPECT;\n\t\tthis._resolutionMode = RESOLUTION_FIXED;\n\t\tthis._allowResize = true;\n\t\tthis.context = this;\n\t}\n\tinit(appOptions) {\n\t\tconst device = appOptions.graphicsDevice;\n\t\tthis.graphicsDevice = device;\n\t\tGraphicsDeviceAccess.set(device);\n\t\tthis._initDefaultMaterial();\n\t\tthis._initProgramLibrary();\n\t\tthis.stats = new ApplicationStats(device);\n\t\tthis._soundManager = appOptions.soundManager;\n\t\tthis.loader = new ResourceLoader(this);\n\t\tLightsBuffer.init(device);\n\t\tthis._entityIndex = {};\n\t\tthis.scene = new Scene(device);\n\t\tthis._registerSceneImmediate(this.scene);\n\t\tthis.root = new Entity();\n\t\tthis.root._enabledInHierarchy = true;\n\t\tthis.assets = new AssetRegistry(this.loader);\n\t\tif (appOptions.assetPrefix) this.assets.prefix = appOptions.assetPrefix;\n\t\tthis.bundles = new BundleRegistry(this.assets);\n\t\tthis.enableBundles = typeof TextDecoder !== 'undefined';\n\t\tthis.scriptsOrder = appOptions.scriptsOrder || [];\n\t\tthis.scripts = new ScriptRegistry(this);\n\t\tthis.i18n = new I18n(this);\n\t\tthis.scenes = new SceneRegistry(this);\n\t\tthis.defaultLayerWorld = new Layer({\n\t\t\tname: \"World\",\n\t\t\tid: LAYERID_WORLD\n\t\t});\n\t\tthis.defaultLayerDepth = new Layer({\n\t\t\tname: \"Depth\",\n\t\t\tid: LAYERID_DEPTH,\n\t\t\tenabled: false,\n\t\t\topaqueSortMode: SORTMODE_NONE\n\t\t});\n\t\tthis.defaultLayerSkybox = new Layer({\n\t\t\tname: \"Skybox\",\n\t\t\tid: LAYERID_SKYBOX,\n\t\t\topaqueSortMode: SORTMODE_NONE\n\t\t});\n\t\tthis.defaultLayerUi = new Layer({\n\t\t\tname: \"UI\",\n\t\t\tid: LAYERID_UI,\n\t\t\ttransparentSortMode: SORTMODE_MANUAL\n\t\t});\n\t\tthis.defaultLayerImmediate = new Layer({\n\t\t\tname: \"Immediate\",\n\t\t\tid: LAYERID_IMMEDIATE,\n\t\t\topaqueSortMode: SORTMODE_NONE\n\t\t});\n\t\tconst defaultLayerComposition = new LayerComposition(\"default\");\n\t\tdefaultLayerComposition.pushOpaque(this.defaultLayerWorld);\n\t\tdefaultLayerComposition.pushOpaque(this.defaultLayerDepth);\n\t\tdefaultLayerComposition.pushOpaque(this.defaultLayerSkybox);\n\t\tdefaultLayerComposition.pushTransparent(this.defaultLayerWorld);\n\t\tdefaultLayerComposition.pushOpaque(this.defaultLayerImmediate);\n\t\tdefaultLayerComposition.pushTransparent(this.defaultLayerImmediate);\n\t\tdefaultLayerComposition.pushTransparent(this.defaultLayerUi);\n\t\tthis.scene.layers = defaultLayerComposition;\n\t\tAreaLightLuts.createPlaceholder(device);\n\t\tthis.renderer = new ForwardRenderer(device);\n\t\tthis.renderer.scene = this.scene;\n\t\tthis.frameGraph = new FrameGraph();\n\t\tthis.lightmapper = null;\n\t\tif (appOptions.lightmapper) {\n\t\t\tthis.lightmapper = new appOptions.lightmapper(device, this.root, this.scene, this.renderer, this.assets);\n\t\t\tthis.once('prerender', this._firstBake, this);\n\t\t}\n\t\tthis._batcher = null;\n\t\tif (appOptions.batchManager) {\n\t\t\tthis._batcher = new appOptions.batchManager(device, this.root, this.scene);\n\t\t\tthis.once('prerender', this._firstBatch, this);\n\t\t}\n\t\tthis.keyboard = appOptions.keyboard || null;\n\t\tthis.mouse = appOptions.mouse || null;\n\t\tthis.touch = appOptions.touch || null;\n\t\tthis.gamepads = appOptions.gamepads || null;\n\t\tthis.elementInput = appOptions.elementInput || null;\n\t\tif (this.elementInput) this.elementInput.app = this;\n\t\tthis.xr = appOptions.xr ? new appOptions.xr(this) : null;\n\t\tif (this.elementInput) this.elementInput.attachSelectEvents();\n\t\tthis._inTools = false;\n\t\tthis._skyboxAsset = null;\n\t\tthis._scriptPrefix = appOptions.scriptPrefix || '';\n\t\tif (this.enableBundles) {\n\t\t\tthis.loader.addHandler(\"bundle\", new BundleHandler(this));\n\t\t}\n\t\tappOptions.resourceHandlers.forEach(resourceHandler => {\n\t\t\tconst handler = new resourceHandler(this);\n\t\t\tthis.loader.addHandler(handler.handlerType, handler);\n\t\t});\n\t\tthis.systems = new ComponentSystemRegistry();\n\t\tappOptions.componentSystems.forEach(componentSystem => {\n\t\t\tthis.systems.add(new componentSystem(this));\n\t\t});\n\t\tthis._visibilityChangeHandler = this.onVisibilityChange.bind(this);\n\t\tif (typeof document !== 'undefined') {\n\t\t\tif (document.hidden !== undefined) {\n\t\t\t\tthis._hiddenAttr = 'hidden';\n\t\t\t\tdocument.addEventListener('visibilitychange', this._visibilityChangeHandler, false);\n\t\t\t} else if (document.mozHidden !== undefined) {\n\t\t\t\tthis._hiddenAttr = 'mozHidden';\n\t\t\t\tdocument.addEventListener('mozvisibilitychange', this._visibilityChangeHandler, false);\n\t\t\t} else if (document.msHidden !== undefined) {\n\t\t\t\tthis._hiddenAttr = 'msHidden';\n\t\t\t\tdocument.addEventListener('msvisibilitychange', this._visibilityChangeHandler, false);\n\t\t\t} else if (document.webkitHidden !== undefined) {\n\t\t\t\tthis._hiddenAttr = 'webkitHidden';\n\t\t\t\tdocument.addEventListener('webkitvisibilitychange', this._visibilityChangeHandler, false);\n\t\t\t}\n\t\t}\n\t\tthis.tick = makeTick(this);\n\t}\n\tstatic getApplication(id) {\n\t\treturn id ? AppBase._applications[id] : getApplication();\n\t}\n\t_initDefaultMaterial() {\n\t\tconst material = new StandardMaterial();\n\t\tmaterial.name = \"Default Material\";\n\t\tmaterial.shadingModel = SPECULAR_BLINN;\n\t\tsetDefaultMaterial(this.graphicsDevice, material);\n\t}\n\t_initProgramLibrary() {\n\t\tconst library = new ProgramLibrary(this.graphicsDevice, new StandardMaterial());\n\t\tsetProgramLibrary(this.graphicsDevice, library);\n\t}\n\tget soundManager() {\n\t\treturn this._soundManager;\n\t}\n\tget batcher() {\n\t\treturn this._batcher;\n\t}\n\tget fillMode() {\n\t\treturn this._fillMode;\n\t}\n\tget resolutionMode() {\n\t\treturn this._resolutionMode;\n\t}\n\tconfigure(url, callback) {\n\t\thttp.get(url, (err, response) => {\n\t\t\tif (err) {\n\t\t\t\tcallback(err);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst props = response.application_properties;\n\t\t\tconst scenes = response.scenes;\n\t\t\tconst assets = response.assets;\n\t\t\tthis._parseApplicationProperties(props, err => {\n\t\t\t\tthis._parseScenes(scenes);\n\t\t\t\tthis._parseAssets(assets);\n\t\t\t\tif (!err) {\n\t\t\t\t\tcallback(null);\n\t\t\t\t} else {\n\t\t\t\t\tcallback(err);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\tpreload(callback) {\n\t\tthis.fire(\"preload:start\");\n\t\tconst assets = this.assets.list({\n\t\t\tpreload: true\n\t\t});\n\t\tconst progress = new Progress(assets.length);\n\t\tlet _done = false;\n\t\tconst done = () => {\n\t\t\tif (!this.graphicsDevice) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!_done && progress.done()) {\n\t\t\t\t_done = true;\n\t\t\t\tthis.fire(\"preload:end\");\n\t\t\t\tcallback();\n\t\t\t}\n\t\t};\n\t\tconst total = assets.length;\n\t\tif (progress.length) {\n\t\t\tconst onAssetLoad = asset => {\n\t\t\t\tprogress.inc();\n\t\t\t\tthis.fire('preload:progress', progress.count / total);\n\t\t\t\tif (progress.done()) done();\n\t\t\t};\n\t\t\tconst onAssetError = (err, asset) => {\n\t\t\t\tprogress.inc();\n\t\t\t\tthis.fire('preload:progress', progress.count / total);\n\t\t\t\tif (progress.done()) done();\n\t\t\t};\n\t\t\tfor (let i = 0; i < assets.length; i++) {\n\t\t\t\tif (!assets[i].loaded) {\n\t\t\t\t\tassets[i].once('load', onAssetLoad);\n\t\t\t\t\tassets[i].once('error', onAssetError);\n\t\t\t\t\tthis.assets.load(assets[i]);\n\t\t\t\t} else {\n\t\t\t\t\tprogress.inc();\n\t\t\t\t\tthis.fire(\"preload:progress\", progress.count / total);\n\t\t\t\t\tif (progress.done()) done();\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tdone();\n\t\t}\n\t}\n\t_preloadScripts(sceneData, callback) {\n\t\tif (!script.legacy) {\n\t\t\tcallback();\n\t\t\treturn;\n\t\t}\n\t\tthis.systems.script.preloading = true;\n\t\tconst scripts = this._getScriptReferences(sceneData);\n\t\tconst l = scripts.length;\n\t\tconst progress = new Progress(l);\n\t\tconst regex = /^http(s)?:\\/\\//;\n\t\tif (l) {\n\t\t\tconst onLoad = (err, ScriptType) => {\n\t\t\t\tif (err) console.error(err);\n\t\t\t\tprogress.inc();\n\t\t\t\tif (progress.done()) {\n\t\t\t\t\tthis.systems.script.preloading = false;\n\t\t\t\t\tcallback();\n\t\t\t\t}\n\t\t\t};\n\t\t\tfor (let i = 0; i < l; i++) {\n\t\t\t\tlet scriptUrl = scripts[i];\n\t\t\t\tif (!regex.test(scriptUrl.toLowerCase()) && this._scriptPrefix) scriptUrl = path.join(this._scriptPrefix, scripts[i]);\n\t\t\t\tthis.loader.load(scriptUrl, 'script', onLoad);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.systems.script.preloading = false;\n\t\t\tcallback();\n\t\t}\n\t}\n\t_parseApplicationProperties(props, callback) {\n\t\tif (typeof props.maxAssetRetries === 'number' && props.maxAssetRetries > 0) {\n\t\t\tthis.loader.enableRetry(props.maxAssetRetries);\n\t\t}\n\t\tif (!props.useDevicePixelRatio) props.useDevicePixelRatio = props.use_device_pixel_ratio;\n\t\tif (!props.resolutionMode) props.resolutionMode = props.resolution_mode;\n\t\tif (!props.fillMode) props.fillMode = props.fill_mode;\n\t\tthis._width = props.width;\n\t\tthis._height = props.height;\n\t\tif (props.useDevicePixelRatio) {\n\t\t\tthis.graphicsDevice.maxPixelRatio = window.devicePixelRatio;\n\t\t}\n\t\tthis.setCanvasResolution(props.resolutionMode, this._width, this._height);\n\t\tthis.setCanvasFillMode(props.fillMode, this._width, this._height);\n\t\tif (props.layers && props.layerOrder) {\n\t\t\tconst composition = new LayerComposition(\"application\");\n\t\t\tconst layers = {};\n\t\t\tfor (const key in props.layers) {\n\t\t\t\tconst data = props.layers[key];\n\t\t\t\tdata.id = parseInt(key, 10);\n\t\t\t\tdata.enabled = data.id !== LAYERID_DEPTH;\n\t\t\t\tlayers[key] = new Layer(data);\n\t\t\t}\n\t\t\tfor (let i = 0, len = props.layerOrder.length; i < len; i++) {\n\t\t\t\tconst sublayer = props.layerOrder[i];\n\t\t\t\tconst layer = layers[sublayer.layer];\n\t\t\t\tif (!layer) continue;\n\t\t\t\tif (sublayer.transparent) {\n\t\t\t\t\tcomposition.pushTransparent(layer);\n\t\t\t\t} else {\n\t\t\t\t\tcomposition.pushOpaque(layer);\n\t\t\t\t}\n\t\t\t\tcomposition.subLayerEnabled[i] = sublayer.enabled;\n\t\t\t}\n\t\t\tthis.scene.layers = composition;\n\t\t}\n\t\tif (props.batchGroups) {\n\t\t\tconst batcher = this.batcher;\n\t\t\tif (batcher) {\n\t\t\t\tfor (let i = 0, len = props.batchGroups.length; i < len; i++) {\n\t\t\t\t\tconst grp = props.batchGroups[i];\n\t\t\t\t\tbatcher.addGroup(grp.name, grp.dynamic, grp.maxAabbSize, grp.id, grp.layers);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (props.i18nAssets) {\n\t\t\tthis.i18n.assets = props.i18nAssets;\n\t\t}\n\t\tthis._loadLibraries(props.libraries, callback);\n\t}\n\t_loadLibraries(urls, callback) {\n\t\tconst len = urls.length;\n\t\tlet count = len;\n\t\tconst regex = /^http(s)?:\\/\\//;\n\t\tif (len) {\n\t\t\tconst onLoad = (err, script) => {\n\t\t\t\tcount--;\n\t\t\t\tif (err) {\n\t\t\t\t\tcallback(err);\n\t\t\t\t} else if (count === 0) {\n\t\t\t\t\tthis.onLibrariesLoaded();\n\t\t\t\t\tcallback(null);\n\t\t\t\t}\n\t\t\t};\n\t\t\tfor (let i = 0; i < len; ++i) {\n\t\t\t\tlet url = urls[i];\n\t\t\t\tif (!regex.test(url.toLowerCase()) && this._scriptPrefix) url = path.join(this._scriptPrefix, url);\n\t\t\t\tthis.loader.load(url, 'script', onLoad);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.onLibrariesLoaded();\n\t\t\tcallback(null);\n\t\t}\n\t}\n\t_parseScenes(scenes) {\n\t\tif (!scenes) return;\n\t\tfor (let i = 0; i < scenes.length; i++) {\n\t\t\tthis.scenes.add(scenes[i].name, scenes[i].url);\n\t\t}\n\t}\n\t_parseAssets(assets) {\n\t\tconst list = [];\n\t\tconst scriptsIndex = {};\n\t\tconst bundlesIndex = {};\n\t\tif (!script.legacy) {\n\t\t\tfor (let i = 0; i < this.scriptsOrder.length; i++) {\n\t\t\t\tconst id = this.scriptsOrder[i];\n\t\t\t\tif (!assets[id]) continue;\n\t\t\t\tscriptsIndex[id] = true;\n\t\t\t\tlist.push(assets[id]);\n\t\t\t}\n\t\t\tif (this.enableBundles) {\n\t\t\t\tfor (const id in assets) {\n\t\t\t\t\tif (assets[id].type === 'bundle') {\n\t\t\t\t\t\tbundlesIndex[id] = true;\n\t\t\t\t\t\tlist.push(assets[id]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (const id in assets) {\n\t\t\t\tif (scriptsIndex[id] || bundlesIndex[id]) continue;\n\t\t\t\tlist.push(assets[id]);\n\t\t\t}\n\t\t} else {\n\t\t\tif (this.enableBundles) {\n\t\t\t\tfor (const id in assets) {\n\t\t\t\t\tif (assets[id].type === 'bundle') {\n\t\t\t\t\t\tbundlesIndex[id] = true;\n\t\t\t\t\t\tlist.push(assets[id]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (const id in assets) {\n\t\t\t\tif (bundlesIndex[id]) continue;\n\t\t\t\tlist.push(assets[id]);\n\t\t\t}\n\t\t}\n\t\tfor (let i = 0; i < list.length; i++) {\n\t\t\tconst data = list[i];\n\t\t\tconst asset = new Asset(data.name, data.type, data.file, data.data);\n\t\t\tasset.id = parseInt(data.id, 10);\n\t\t\tasset.preload = data.preload ? data.preload : false;\n\t\t\tasset.loaded = data.type === 'script' && data.data && data.data.loadingType > 0;\n\t\t\tasset.tags.add(data.tags);\n\t\t\tif (data.i18n) {\n\t\t\t\tfor (const locale in data.i18n) {\n\t\t\t\t\tasset.addLocalizedAssetId(locale, data.i18n[locale]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.assets.add(asset);\n\t\t}\n\t}\n\t_getScriptReferences(scene) {\n\t\tlet priorityScripts = [];\n\t\tif (scene.settings.priority_scripts) {\n\t\t\tpriorityScripts = scene.settings.priority_scripts;\n\t\t}\n\t\tconst _scripts = [];\n\t\tconst _index = {};\n\t\tfor (let i = 0; i < priorityScripts.length; i++) {\n\t\t\t_scripts.push(priorityScripts[i]);\n\t\t\t_index[priorityScripts[i]] = true;\n\t\t}\n\t\tconst entities = scene.entities;\n\t\tfor (const key in entities) {\n\t\t\tif (!entities[key].components.script) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst scripts = entities[key].components.script.scripts;\n\t\t\tfor (let i = 0; i < scripts.length; i++) {\n\t\t\t\tif (_index[scripts[i].url]) continue;\n\t\t\t\t_scripts.push(scripts[i].url);\n\t\t\t\t_index[scripts[i].url] = true;\n\t\t\t}\n\t\t}\n\t\treturn _scripts;\n\t}\n\tstart() {\n\t\tthis.frame = 0;\n\t\tthis.fire(\"start\", {\n\t\t\ttimestamp: now(),\n\t\t\ttarget: this\n\t\t});\n\t\tif (!this._librariesLoaded) {\n\t\t\tthis.onLibrariesLoaded();\n\t\t}\n\t\tthis.systems.fire('initialize', this.root);\n\t\tthis.fire('initialize');\n\t\tthis.systems.fire('postInitialize', this.root);\n\t\tthis.systems.fire('postPostInitialize', this.root);\n\t\tthis.fire('postinitialize');\n\t\tthis.tick();\n\t}\n\tinputUpdate(dt) {\n\t\tif (this.controller) {\n\t\t\tthis.controller.update(dt);\n\t\t}\n\t\tif (this.mouse) {\n\t\t\tthis.mouse.update();\n\t\t}\n\t\tif (this.keyboard) {\n\t\t\tthis.keyboard.update();\n\t\t}\n\t\tif (this.gamepads) {\n\t\t\tthis.gamepads.update();\n\t\t}\n\t}\n\tupdate(dt) {\n\t\tthis.frame++;\n\t\tthis.graphicsDevice.updateClientRect();\n\t\tif (script.legacy) this.systems.fire('fixedUpdate', 1.0 / 60.0);\n\t\tthis.systems.fire(this._inTools ? 'toolsUpdate' : 'update', dt);\n\t\tthis.systems.fire('animationUpdate', dt);\n\t\tthis.systems.fire('postUpdate', dt);\n\t\tthis.fire(\"update\", dt);\n\t\tthis.inputUpdate(dt);\n\t}\n\tframeStart() {\n\t\tthis.graphicsDevice.frameStart();\n\t}\n\tframeEnd() {\n\t\tthis.graphicsDevice.frameEnd();\n\t}\n\trender() {\n\t\tthis.fire('prerender');\n\t\tthis.root.syncHierarchy();\n\t\tif (this._batcher) {\n\t\t\tthis._batcher.updateAll();\n\t\t}\n\t\tthis.renderComposition(this.scene.layers);\n\t\tthis.fire('postrender');\n\t}\n\trenderComposition(layerComposition) {\n\t\tthis.renderer.buildFrameGraph(this.frameGraph, layerComposition);\n\t\tthis.frameGraph.render(this.graphicsDevice);\n\t}\n\t_fillFrameStatsBasic(now, dt, ms) {\n\t\tconst stats = this.stats.frame;\n\t\tstats.dt = dt;\n\t\tstats.ms = ms;\n\t\tif (now > stats._timeToCountFrames) {\n\t\t\tstats.fps = stats._fpsAccum;\n\t\t\tstats._fpsAccum = 0;\n\t\t\tstats._timeToCountFrames = now + 1000;\n\t\t} else {\n\t\t\tstats._fpsAccum++;\n\t\t}\n\t\tthis.stats.drawCalls.total = this.graphicsDevice._drawCallsPerFrame;\n\t\tthis.graphicsDevice._drawCallsPerFrame = 0;\n\t}\n\t_fillFrameStats() {\n\t\tlet stats = this.stats.frame;\n\t\tstats.cameras = this.renderer._camerasRendered;\n\t\tstats.materials = this.renderer._materialSwitches;\n\t\tstats.shaders = this.graphicsDevice._shaderSwitchesPerFrame;\n\t\tstats.shadowMapUpdates = this.renderer._shadowMapUpdates;\n\t\tstats.shadowMapTime = this.renderer._shadowMapTime;\n\t\tstats.depthMapTime = this.renderer._depthMapTime;\n\t\tstats.forwardTime = this.renderer._forwardTime;\n\t\tconst prims = this.graphicsDevice._primsPerFrame;\n\t\tstats.triangles = prims[PRIMITIVE_TRIANGLES] / 3 + Math.max(prims[PRIMITIVE_TRISTRIP] - 2, 0) + Math.max(prims[PRIMITIVE_TRIFAN] - 2, 0);\n\t\tstats.cullTime = this.renderer._cullTime;\n\t\tstats.sortTime = this.renderer._sortTime;\n\t\tstats.skinTime = this.renderer._skinTime;\n\t\tstats.morphTime = this.renderer._morphTime;\n\t\tstats.lightClusters = this.renderer._lightClusters;\n\t\tstats.lightClustersTime = this.renderer._lightClustersTime;\n\t\tstats.otherPrimitives = 0;\n\t\tfor (let i = 0; i < prims.length; i++) {\n\t\t\tif (i < PRIMITIVE_TRIANGLES) {\n\t\t\t\tstats.otherPrimitives += prims[i];\n\t\t\t}\n\t\t\tprims[i] = 0;\n\t\t}\n\t\tthis.renderer._camerasRendered = 0;\n\t\tthis.renderer._materialSwitches = 0;\n\t\tthis.renderer._shadowMapUpdates = 0;\n\t\tthis.graphicsDevice._shaderSwitchesPerFrame = 0;\n\t\tthis.renderer._cullTime = 0;\n\t\tthis.renderer._layerCompositionUpdateTime = 0;\n\t\tthis.renderer._lightClustersTime = 0;\n\t\tthis.renderer._sortTime = 0;\n\t\tthis.renderer._skinTime = 0;\n\t\tthis.renderer._morphTime = 0;\n\t\tthis.renderer._shadowMapTime = 0;\n\t\tthis.renderer._depthMapTime = 0;\n\t\tthis.renderer._forwardTime = 0;\n\t\tstats = this.stats.drawCalls;\n\t\tstats.forward = this.renderer._forwardDrawCalls;\n\t\tstats.culled = this.renderer._numDrawCallsCulled;\n\t\tstats.depth = 0;\n\t\tstats.shadow = this.renderer._shadowDrawCalls;\n\t\tstats.skinned = this.renderer._skinDrawCalls;\n\t\tstats.immediate = 0;\n\t\tstats.instanced = 0;\n\t\tstats.removedByInstancing = 0;\n\t\tstats.misc = stats.total - (stats.forward + stats.shadow);\n\t\tthis.renderer._depthDrawCalls = 0;\n\t\tthis.renderer._shadowDrawCalls = 0;\n\t\tthis.renderer._forwardDrawCalls = 0;\n\t\tthis.renderer._numDrawCallsCulled = 0;\n\t\tthis.renderer._skinDrawCalls = 0;\n\t\tthis.renderer._immediateRendered = 0;\n\t\tthis.renderer._instancedDrawCalls = 0;\n\t\tthis.stats.misc.renderTargetCreationTime = this.graphicsDevice.renderTargetCreationTime;\n\t\tstats = this.stats.particles;\n\t\tstats.updatesPerFrame = stats._updatesPerFrame;\n\t\tstats.frameTime = stats._frameTime;\n\t\tstats._updatesPerFrame = 0;\n\t\tstats._frameTime = 0;\n\t}\n\tsetCanvasFillMode(mode, width, height) {\n\t\tthis._fillMode = mode;\n\t\tthis.resizeCanvas(width, height);\n\t}\n\tsetCanvasResolution(mode, width, height) {\n\t\tthis._resolutionMode = mode;\n\t\tif (mode === RESOLUTION_AUTO && width === undefined) {\n\t\t\twidth = this.graphicsDevice.canvas.clientWidth;\n\t\t\theight = this.graphicsDevice.canvas.clientHeight;\n\t\t}\n\t\tthis.graphicsDevice.resizeCanvas(width, height);\n\t}\n\tisHidden() {\n\t\treturn document[this._hiddenAttr];\n\t}\n\tonVisibilityChange() {\n\t\tif (this.isHidden()) {\n\t\t\tif (this._soundManager) {\n\t\t\t\tthis._soundManager.suspend();\n\t\t\t}\n\t\t} else {\n\t\t\tif (this._soundManager) {\n\t\t\t\tthis._soundManager.resume();\n\t\t\t}\n\t\t}\n\t}\n\tresizeCanvas(width, height) {\n\t\tif (!this._allowResize) return undefined;\n\t\tif (this.xr && this.xr.session) return undefined;\n\t\tconst windowWidth = window.innerWidth;\n\t\tconst windowHeight = window.innerHeight;\n\t\tif (this._fillMode === FILLMODE_KEEP_ASPECT) {\n\t\t\tconst r = this.graphicsDevice.canvas.width / this.graphicsDevice.canvas.height;\n\t\t\tconst winR = windowWidth / windowHeight;\n\t\t\tif (r > winR) {\n\t\t\t\twidth = windowWidth;\n\t\t\t\theight = width / r;\n\t\t\t} else {\n\t\t\t\theight = windowHeight;\n\t\t\t\twidth = height * r;\n\t\t\t}\n\t\t} else if (this._fillMode === FILLMODE_FILL_WINDOW) {\n\t\t\twidth = windowWidth;\n\t\t\theight = windowHeight;\n\t\t}\n\t\tthis.graphicsDevice.canvas.style.width = width + 'px';\n\t\tthis.graphicsDevice.canvas.style.height = height + 'px';\n\t\tthis.updateCanvasSize();\n\t\treturn {\n\t\t\twidth: width,\n\t\t\theight: height\n\t\t};\n\t}\n\tupdateCanvasSize() {\n\t\tvar _this$xr;\n\t\tif (!this._allowResize || (_this$xr = this.xr) != null && _this$xr.active) {\n\t\t\treturn;\n\t\t}\n\t\tif (this._resolutionMode === RESOLUTION_AUTO) {\n\t\t\tconst canvas = this.graphicsDevice.canvas;\n\t\t\tthis.graphicsDevice.resizeCanvas(canvas.clientWidth, canvas.clientHeight);\n\t\t}\n\t}\n\tonLibrariesLoaded() {\n\t\tthis._librariesLoaded = true;\n\t\tif (this.systems.rigidbody) {\n\t\t\tthis.systems.rigidbody.onLibraryLoaded();\n\t\t}\n\t}\n\tapplySceneSettings(settings) {\n\t\tlet asset;\n\t\tif (this.systems.rigidbody && typeof Ammo !== 'undefined') {\n\t\t\tconst gravity = settings.physics.gravity;\n\t\t\tthis.systems.rigidbody.gravity.set(gravity[0], gravity[1], gravity[2]);\n\t\t}\n\t\tthis.scene.applySettings(settings);\n\t\tif (settings.render.hasOwnProperty('skybox')) {\n\t\t\tif (settings.render.skybox) {\n\t\t\t\tasset = this.assets.get(settings.render.skybox);\n\t\t\t\tif (asset) {\n\t\t\t\t\tthis.setSkybox(asset);\n\t\t\t\t} else {\n\t\t\t\t\tthis.assets.once('add:' + settings.render.skybox, this.setSkybox, this);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.setSkybox(null);\n\t\t\t}\n\t\t}\n\t}\n\tsetAreaLightLuts(ltcMat1, ltcMat2) {\n\t\tif (ltcMat1 && ltcMat2) {\n\t\t\tAreaLightLuts.set(this.graphicsDevice, ltcMat1, ltcMat2);\n\t\t}\n\t}\n\tsetSkybox(asset) {\n\t\tif (asset !== this._skyboxAsset) {\n\t\t\tconst onSkyboxRemoved = () => {\n\t\t\t\tthis.setSkybox(null);\n\t\t\t};\n\t\t\tconst onSkyboxChanged = () => {\n\t\t\t\tthis.scene.setSkybox(this._skyboxAsset ? this._skyboxAsset.resources : null);\n\t\t\t};\n\t\t\tif (this._skyboxAsset) {\n\t\t\t\tthis.assets.off('load:' + this._skyboxAsset.id, onSkyboxChanged, this);\n\t\t\t\tthis.assets.off('remove:' + this._skyboxAsset.id, onSkyboxRemoved, this);\n\t\t\t\tthis._skyboxAsset.off('change', onSkyboxChanged, this);\n\t\t\t}\n\t\t\tthis._skyboxAsset = asset;\n\t\t\tif (this._skyboxAsset) {\n\t\t\t\tthis.assets.on('load:' + this._skyboxAsset.id, onSkyboxChanged, this);\n\t\t\t\tthis.assets.once('remove:' + this._skyboxAsset.id, onSkyboxRemoved, this);\n\t\t\t\tthis._skyboxAsset.on('change', onSkyboxChanged, this);\n\t\t\t\tif (this.scene.skyboxMip === 0 && !this._skyboxAsset.loadFaces) {\n\t\t\t\t\tthis._skyboxAsset.loadFaces = true;\n\t\t\t\t}\n\t\t\t\tthis.assets.load(this._skyboxAsset);\n\t\t\t}\n\t\t\tonSkyboxChanged();\n\t\t}\n\t}\n\t_firstBake() {\n\t\tvar _this$lightmapper;\n\t\t(_this$lightmapper = this.lightmapper) == null || _this$lightmapper.bake(null, this.scene.lightmapMode);\n\t}\n\t_firstBatch() {\n\t\tvar _this$batcher;\n\t\t(_this$batcher = this.batcher) == null || _this$batcher.generate();\n\t}\n\t_processTimestamp(timestamp) {\n\t\treturn timestamp;\n\t}\n\tdrawLine(start, end, color, depthTest, layer) {\n\t\tthis.scene.drawLine(start, end, color, depthTest, layer);\n\t}\n\tdrawLines(positions, colors, depthTest = true, layer = this.scene.defaultDrawLayer) {\n\t\tthis.scene.drawLines(positions, colors, depthTest, layer);\n\t}\n\tdrawLineArrays(positions, colors, depthTest = true, layer = this.scene.defaultDrawLayer) {\n\t\tthis.scene.drawLineArrays(positions, colors, depthTest, layer);\n\t}\n\tdrawWireSphere(center, radius, color = Color.WHITE, segments = 20, depthTest = true, layer = this.scene.defaultDrawLayer) {\n\t\tthis.scene.immediate.drawWireSphere(center, radius, color, segments, depthTest, layer);\n\t}\n\tdrawWireAlignedBox(minPoint, maxPoint, color = Color.WHITE, depthTest = true, layer = this.scene.defaultDrawLayer) {\n\t\tthis.scene.immediate.drawWireAlignedBox(minPoint, maxPoint, color, depthTest, layer);\n\t}\n\tdrawMeshInstance(meshInstance, layer = this.scene.defaultDrawLayer) {\n\t\tthis.scene.immediate.drawMesh(null, null, null, meshInstance, layer);\n\t}\n\tdrawMesh(mesh, material, matrix, layer = this.scene.defaultDrawLayer) {\n\t\tthis.scene.immediate.drawMesh(material, matrix, mesh, null, layer);\n\t}\n\tdrawQuad(matrix, material, layer = this.scene.defaultDrawLayer) {\n\t\tthis.scene.immediate.drawMesh(material, matrix, this.scene.immediate.getQuadMesh(), null, layer);\n\t}\n\tdrawTexture(x, y, width, height, texture, material, layer = this.scene.defaultDrawLayer, filterable = true) {\n\t\tif (filterable === false && !this.graphicsDevice.isWebGPU) return;\n\t\tconst matrix = new Mat4();\n\t\tmatrix.setTRS(new Vec3(x, y, 0.0), Quat.IDENTITY, new Vec3(width, -height, 0.0));\n\t\tif (!material) {\n\t\t\tmaterial = new Material();\n\t\t\tmaterial.cull = CULLFACE_NONE;\n\t\t\tmaterial.setParameter(\"colorMap\", texture);\n\t\t\tmaterial.shader = filterable ? this.scene.immediate.getTextureShader() : this.scene.immediate.getUnfilterableTextureShader();\n\t\t\tmaterial.update();\n\t\t}\n\t\tthis.drawQuad(matrix, material, layer);\n\t}\n\tdrawDepthTexture(x, y, width, height, layer = this.scene.defaultDrawLayer) {\n\t\tconst material = new Material();\n\t\tmaterial.cull = CULLFACE_NONE;\n\t\tmaterial.shader = this.scene.immediate.getDepthTextureShader();\n\t\tmaterial.update();\n\t\tthis.drawTexture(x, y, width, height, null, material, layer);\n\t}\n\tdestroy() {\n\t\tvar _this$lightmapper2, _this$xr2, _this$xr3, _this$_soundManager;\n\t\tif (this._inFrameUpdate) {\n\t\t\tthis._destroyRequested = true;\n\t\t\treturn;\n\t\t}\n\t\tconst canvasId = this.graphicsDevice.canvas.id;\n\t\tthis.fire('destroy', this);\n\t\tthis.off('librariesloaded');\n\t\tif (typeof document !== 'undefined') {\n\t\t\tdocument.removeEventListener('visibilitychange', this._visibilityChangeHandler, false);\n\t\t\tdocument.removeEventListener('mozvisibilitychange', this._visibilityChangeHandler, false);\n\t\t\tdocument.removeEventListener('msvisibilitychange', this._visibilityChangeHandler, false);\n\t\t\tdocument.removeEventListener('webkitvisibilitychange', this._visibilityChangeHandler, false);\n\t\t}\n\t\tthis._visibilityChangeHandler = null;\n\t\tthis.root.destroy();\n\t\tthis.root = null;\n\t\tif (this.mouse) {\n\t\t\tthis.mouse.off();\n\t\t\tthis.mouse.detach();\n\t\t\tthis.mouse = null;\n\t\t}\n\t\tif (this.keyboard) {\n\t\t\tthis.keyboard.off();\n\t\t\tthis.keyboard.detach();\n\t\t\tthis.keyboard = null;\n\t\t}\n\t\tif (this.touch) {\n\t\t\tthis.touch.off();\n\t\t\tthis.touch.detach();\n\t\t\tthis.touch = null;\n\t\t}\n\t\tif (this.elementInput) {\n\t\t\tthis.elementInput.detach();\n\t\t\tthis.elementInput = null;\n\t\t}\n\t\tif (this.gamepads) {\n\t\t\tthis.gamepads.destroy();\n\t\t\tthis.gamepads = null;\n\t\t}\n\t\tif (this.controller) {\n\t\t\tthis.controller = null;\n\t\t}\n\t\tthis.systems.destroy();\n\t\tif (this.scene.layers) {\n\t\t\tthis.scene.layers.destroy();\n\t\t}\n\t\tconst assets = this.assets.list();\n\t\tfor (let i = 0; i < assets.length; i++) {\n\t\t\tassets[i].unload();\n\t\t\tassets[i].off();\n\t\t}\n\t\tthis.assets.off();\n\t\tthis.bundles.destroy();\n\t\tthis.bundles = null;\n\t\tthis.i18n.destroy();\n\t\tthis.i18n = null;\n\t\tconst scriptHandler = this.loader.getHandler('script');\n\t\tscriptHandler == null || scriptHandler.clearCache();\n\t\tthis.loader.destroy();\n\t\tthis.loader = null;\n\t\tthis.scene.destroy();\n\t\tthis.scene = null;\n\t\tthis.systems = null;\n\t\tthis.context = null;\n\t\tthis.scripts.destroy();\n\t\tthis.scripts = null;\n\t\tthis.scenes.destroy();\n\t\tthis.scenes = null;\n\t\t(_this$lightmapper2 = this.lightmapper) == null || _this$lightmapper2.destroy();\n\t\tthis.lightmapper = null;\n\t\tif (this._batcher) {\n\t\t\tthis._batcher.destroy();\n\t\t\tthis._batcher = null;\n\t\t}\n\t\tthis._entityIndex = {};\n\t\tthis.defaultLayerDepth.onPreRenderOpaque = null;\n\t\tthis.defaultLayerDepth.onPostRenderOpaque = null;\n\t\tthis.defaultLayerDepth.onDisable = null;\n\t\tthis.defaultLayerDepth.onEnable = null;\n\t\tthis.defaultLayerDepth = null;\n\t\tthis.defaultLayerWorld = null;\n\t\t(_this$xr2 = this.xr) == null || _this$xr2.end();\n\t\t(_this$xr3 = this.xr) == null || _this$xr3.destroy();\n\t\tthis.renderer.destroy();\n\t\tthis.renderer = null;\n\t\tthis.graphicsDevice.destroy();\n\t\tthis.graphicsDevice = null;\n\t\tthis.tick = null;\n\t\tthis.off();\n\t\t(_this$_soundManager = this._soundManager) == null || _this$_soundManager.destroy();\n\t\tthis._soundManager = null;\n\t\tscript.app = null;\n\t\tAppBase._applications[canvasId] = null;\n\t\tif (getApplication() === this) {\n\t\t\tsetApplication(null);\n\t\t}\n\t\tAppBase.cancelTick(this);\n\t}\n\tstatic cancelTick(app) {\n\t\tif (app.frameRequestId) {\n\t\t\twindow.cancelAnimationFrame(app.frameRequestId);\n\t\t\tapp.frameRequestId = undefined;\n\t\t}\n\t}\n\tgetEntityFromIndex(guid) {\n\t\treturn this._entityIndex[guid];\n\t}\n\t_registerSceneImmediate(scene) {\n\t\tthis.on('postrender', scene.immediate.onPostRender, scene.immediate);\n\t}\n}\nAppBase._applications = {};\nconst _frameEndData = {};\nconst makeTick = function makeTick(_app) {\n\tconst application = _app;\n\treturn function (timestamp, frame) {\n\t\tvar _application$xr;\n\t\tif (!application.graphicsDevice) return;\n\t\tapplication.frameRequestId = null;\n\t\tapplication._inFrameUpdate = true;\n\t\tsetApplication(application);\n\t\tapp = application;\n\t\tconst currentTime = application._processTimestamp(timestamp) || now();\n\t\tconst ms = currentTime - (application._time || currentTime);\n\t\tlet dt = ms / 1000.0;\n\t\tdt = math.clamp(dt, 0, application.maxDeltaTime);\n\t\tdt *= application.timeScale;\n\t\tapplication._time = currentTime;\n\t\tif ((_application$xr = application.xr) != null && _application$xr.session) {\n\t\t\tapplication.frameRequestId = application.xr.session.requestAnimationFrame(application.tick);\n\t\t} else {\n\t\t\tapplication.frameRequestId = platform.browser ? window.requestAnimationFrame(application.tick) : null;\n\t\t}\n\t\tif (application.graphicsDevice.contextLost) return;\n\t\tapplication._fillFrameStatsBasic(currentTime, dt, ms);\n\t\tapplication.fire(\"frameupdate\", ms);\n\t\tlet shouldRenderFrame = true;\n\t\tif (frame) {\n\t\t\tvar _application$xr2;\n\t\t\tshouldRenderFrame = (_application$xr2 = application.xr) == null ? void 0 : _application$xr2.update(frame);\n\t\t\tapplication.graphicsDevice.defaultFramebuffer = frame.session.renderState.baseLayer.framebuffer;\n\t\t} else {\n\t\t\tapplication.graphicsDevice.defaultFramebuffer = null;\n\t\t}\n\t\tif (shouldRenderFrame) {\n\t\t\tapplication.update(dt);\n\t\t\tapplication.fire(\"framerender\");\n\t\t\tif (application.autoRender || application.renderNextFrame) {\n\t\t\t\tapplication.updateCanvasSize();\n\t\t\t\tapplication.frameStart();\n\t\t\t\tapplication.render();\n\t\t\t\tapplication.frameEnd();\n\t\t\t\tapplication.renderNextFrame = false;\n\t\t\t}\n\t\t\t_frameEndData.timestamp = now();\n\t\t\t_frameEndData.target = application;\n\t\t\tapplication.fire(\"frameend\", _frameEndData);\n\t\t}\n\t\tapplication._inFrameUpdate = false;\n\t\tif (application._destroyRequested) {\n\t\t\tapplication.destroy();\n\t\t}\n\t};\n};\n\nexport { AppBase, app };\n","class AppOptions {\n\tconstructor() {\n\t\tthis.elementInput = void 0;\n\t\tthis.keyboard = void 0;\n\t\tthis.mouse = void 0;\n\t\tthis.touch = void 0;\n\t\tthis.gamepads = void 0;\n\t\tthis.scriptPrefix = void 0;\n\t\tthis.assetPrefix = void 0;\n\t\tthis.scriptsOrder = void 0;\n\t\tthis.soundManager = void 0;\n\t\tthis.graphicsDevice = void 0;\n\t\tthis.lightmapper = void 0;\n\t\tthis.batchManager = void 0;\n\t\tthis.xr = void 0;\n\t\tthis.componentSystems = [];\n\t\tthis.resourceHandlers = [];\n\t}\n}\n\nexport { AppOptions };\n","import { BoundingBox } from '../../core/shape/bounding-box.js';\nimport { BoundingSphere } from '../../core/shape/bounding-sphere.js';\nimport { LIGHTTYPE_DIRECTIONAL } from '../../scene/constants.js';\n\nconst tempSphere = new BoundingSphere();\nclass BakeLight {\n\tconstructor(scene, light) {\n\t\tthis.scene = scene;\n\t\tthis.light = light;\n\t\tthis.store();\n\t\tlight.numCascades = 1;\n\t\tif (light.type !== LIGHTTYPE_DIRECTIONAL) {\n\t\t\tlight._node.getWorldTransform();\n\t\t\tlight.getBoundingSphere(tempSphere);\n\t\t\tthis.lightBounds = new BoundingBox();\n\t\t\tthis.lightBounds.center.copy(tempSphere.center);\n\t\t\tthis.lightBounds.halfExtents.set(tempSphere.radius, tempSphere.radius, tempSphere.radius);\n\t\t}\n\t}\n\tstore() {\n\t\tthis.mask = this.light.mask;\n\t\tthis.shadowUpdateMode = this.light.shadowUpdateMode;\n\t\tthis.enabled = this.light.enabled;\n\t\tthis.intensity = this.light.intensity;\n\t\tthis.rotation = this.light._node.getLocalRotation().clone();\n\t\tthis.numCascades = this.light.numCascades;\n\t}\n\trestore() {\n\t\tconst light = this.light;\n\t\tlight.mask = this.mask;\n\t\tlight.shadowUpdateMode = this.shadowUpdateMode;\n\t\tlight.enabled = this.enabled;\n\t\tlight.intensity = this.intensity;\n\t\tlight._node.setLocalRotation(this.rotation);\n\t\tlight.numCascades = this.numCascades;\n\t}\n\tstartBake() {\n\t\tthis.light.enabled = true;\n\t\tthis.light._destroyShadowMap();\n\t\tthis.light.beginFrame();\n\t}\n\tendBake(shadowMapCache) {\n\t\tconst light = this.light;\n\t\tlight.enabled = false;\n\t\tif (light.shadowMap) {\n\t\t\tif (light.shadowMap.cached) shadowMapCache.add(light, light.shadowMap);\n\t\t\tlight.shadowMap = null;\n\t\t}\n\t}\n}\n\nexport { BakeLight };\n","import { Vec2 } from '../../core/math/vec2.js';\nimport { random } from '../../core/math/random.js';\nimport { LIGHTTYPE_DIRECTIONAL } from '../../scene/constants.js';\nimport { BakeLight } from './bake-light.js';\n\nconst _tempPoint = new Vec2();\nclass BakeLightSimple extends BakeLight {\n\tget numVirtualLights() {\n\t\tif (this.light.type === LIGHTTYPE_DIRECTIONAL) {\n\t\t\treturn this.light.bakeNumSamples;\n\t\t}\n\t\treturn 1;\n\t}\n\tprepareVirtualLight(index, numVirtualLights) {\n\t\tconst light = this.light;\n\t\tlight._node.setLocalRotation(this.rotation);\n\t\tif (index > 0) {\n\t\t\tconst directionalSpreadAngle = light.bakeArea;\n\t\t\trandom.circlePointDeterministic(_tempPoint, index, numVirtualLights);\n\t\t\t_tempPoint.mulScalar(directionalSpreadAngle * 0.5);\n\t\t\tlight._node.rotateLocal(_tempPoint.x, 0, _tempPoint.y);\n\t\t}\n\t\tlight._node.getWorldTransform();\n\t\tconst gamma = this.scene.gammaCorrection ? 2.2 : 1;\n\t\tconst linearIntensity = Math.pow(this.intensity, gamma);\n\t\tlight.intensity = Math.pow(linearIntensity / numVirtualLights, 1 / gamma);\n\t}\n}\n\nexport { BakeLightSimple };\n","import { Vec3 } from '../../core/math/vec3.js';\nimport { random } from '../../core/math/random.js';\nimport { Color } from '../../core/math/color.js';\nimport { Entity } from '../entity.js';\nimport { SHADOW_PCF3 } from '../../scene/constants.js';\nimport { BakeLight } from './bake-light.js';\n\nconst _tempPoint = new Vec3();\nclass BakeLightAmbient extends BakeLight {\n\tconstructor(scene) {\n\t\tconst lightEntity = new Entity('AmbientLight');\n\t\tlightEntity.addComponent('light', {\n\t\t\ttype: 'directional',\n\t\t\taffectDynamic: true,\n\t\t\taffectLightmapped: false,\n\t\t\tbake: true,\n\t\t\tbakeNumSamples: scene.ambientBakeNumSamples,\n\t\t\tcastShadows: true,\n\t\t\tnormalOffsetBias: 0.05,\n\t\t\tshadowBias: 0.2,\n\t\t\tshadowDistance: 1,\n\t\t\tshadowResolution: 2048,\n\t\t\tshadowType: SHADOW_PCF3,\n\t\t\tcolor: Color.WHITE,\n\t\t\tintensity: 1,\n\t\t\tbakeDir: false\n\t\t});\n\t\tsuper(scene, lightEntity.light.light);\n\t}\n\tget numVirtualLights() {\n\t\treturn this.light.bakeNumSamples;\n\t}\n\tprepareVirtualLight(index, numVirtualLights) {\n\t\trandom.spherePointDeterministic(_tempPoint, index, numVirtualLights, 0, this.scene.ambientBakeSpherePart);\n\t\tthis.light._node.lookAt(_tempPoint.mulScalar(-1));\n\t\tthis.light._node.rotateLocal(90, 0, 0);\n\t\tconst gamma = this.scene.gammaCorrection ? 2.2 : 1;\n\t\tconst fullIntensity = 2 * Math.PI * this.scene.ambientBakeSpherePart;\n\t\tconst linearIntensity = Math.pow(fullIntensity, gamma);\n\t\tthis.light.intensity = Math.pow(linearIntensity / numVirtualLights, 1 / gamma);\n\t}\n}\n\nexport { BakeLightAmbient };\n","class BakeMeshNode {\n\tconstructor(node, meshInstances = null) {\n\t\tthis.node = node;\n\t\tthis.component = node.render || node.model;\n\t\tmeshInstances = meshInstances || this.component.meshInstances;\n\t\tthis.store();\n\t\tthis.meshInstances = meshInstances;\n\t\tthis.bounds = null;\n\t\tthis.renderTargets = [];\n\t}\n\tstore() {\n\t\tthis.castShadows = this.component.castShadows;\n\t}\n\trestore() {\n\t\tthis.component.castShadows = this.castShadows;\n\t}\n}\n\nexport { BakeMeshNode };\n","import { createShaderFromCode } from '../../scene/shader-lib/utils.js';\nimport { shaderChunks } from '../../scene/shader-lib/chunks/chunks.js';\nimport { shaderChunksLightmapper } from '../../scene/shader-lib/chunks/chunks-lightmapper.js';\n\nconst DENOISE_FILTER_SIZE = 15;\nclass LightmapFilters {\n\tconstructor(device) {\n\t\tthis.device = device;\n\t\tthis.shaderDilate = createShaderFromCode(device, shaderChunks.fullscreenQuadVS, shaderChunksLightmapper.dilatePS, 'lmDilate');\n\t\tthis.constantTexSource = device.scope.resolve('source');\n\t\tthis.constantPixelOffset = device.scope.resolve('pixelOffset');\n\t\tthis.pixelOffset = new Float32Array(2);\n\t\tthis.shaderDenoise = null;\n\t\tthis.sigmas = null;\n\t\tthis.constantSigmas = null;\n\t\tthis.kernel = null;\n\t}\n\tsetSourceTexture(texture) {\n\t\tthis.constantTexSource.setValue(texture);\n\t}\n\tprepare(textureWidth, textureHeight) {\n\t\tthis.pixelOffset[0] = 1 / textureWidth;\n\t\tthis.pixelOffset[1] = 1 / textureHeight;\n\t\tthis.constantPixelOffset.setValue(this.pixelOffset);\n\t}\n\tprepareDenoise(filterRange, filterSmoothness) {\n\t\tif (!this.shaderDenoise) {\n\t\t\tthis.shaderDenoise = createShaderFromCode(this.device, shaderChunks.fullscreenQuadVS, shaderChunksLightmapper.bilateralDeNoisePS, 'lmBilateralDeNoise');\n\t\t\tthis.sigmas = new Float32Array(2);\n\t\t\tthis.constantSigmas = this.device.scope.resolve('sigmas');\n\t\t\tthis.constantKernel = this.device.scope.resolve('kernel[0]');\n\t\t\tthis.bZnorm = this.device.scope.resolve('bZnorm');\n\t\t}\n\t\tthis.sigmas[0] = filterRange;\n\t\tthis.sigmas[1] = filterSmoothness;\n\t\tthis.constantSigmas.setValue(this.sigmas);\n\t\tthis.evaluateDenoiseUniforms(filterRange, filterSmoothness);\n\t}\n\tevaluateDenoiseUniforms(filterRange, filterSmoothness) {\n\t\tfunction normpdf(x, sigma) {\n\t\t\treturn 0.39894 * Math.exp(-0.5 * x * x / (sigma * sigma)) / sigma;\n\t\t}\n\t\tthis.kernel = this.kernel || new Float32Array(DENOISE_FILTER_SIZE);\n\t\tconst kernel = this.kernel;\n\t\tconst kSize = Math.floor((DENOISE_FILTER_SIZE - 1) / 2);\n\t\tfor (let j = 0; j <= kSize; ++j) {\n\t\t\tconst value = normpdf(j, filterRange);\n\t\t\tkernel[kSize + j] = value;\n\t\t\tkernel[kSize - j] = value;\n\t\t}\n\t\tthis.constantKernel.setValue(this.kernel);\n\t\tconst bZnorm = 1 / normpdf(0.0, filterSmoothness);\n\t\tthis.bZnorm.setValue(bZnorm);\n\t}\n}\n\nexport { LightmapFilters };\n","import '../../core/tracing.js';\nimport { now } from '../../core/time.js';\nimport { Color } from '../../core/math/color.js';\nimport { math } from '../../core/math/math.js';\nimport { Vec3 } from '../../core/math/vec3.js';\nimport { BoundingBox } from '../../core/shape/bounding-box.js';\nimport { PIXELFORMAT_RGBA8, TEXTURETYPE_RGBM, CHUNKAPI_1_65, CULLFACE_NONE, TEXTURETYPE_DEFAULT, FILTER_NEAREST, ADDRESS_CLAMP_TO_EDGE, FILTER_LINEAR } from '../../platform/graphics/constants.js';\nimport { RenderTarget } from '../../platform/graphics/render-target.js';\nimport { drawQuadWithShader } from '../../scene/graphics/quad-render-utils.js';\nimport { Texture } from '../../platform/graphics/texture.js';\nimport { MeshInstance } from '../../scene/mesh-instance.js';\nimport { LightingParams } from '../../scene/lighting/lighting-params.js';\nimport { WorldClusters } from '../../scene/lighting/world-clusters.js';\nimport { shaderChunks } from '../../scene/shader-lib/chunks/chunks.js';\nimport { shaderChunksLightmapper } from '../../scene/shader-lib/chunks/chunks-lightmapper.js';\nimport { PROJECTION_ORTHOGRAPHIC, MASK_AFFECT_LIGHTMAPPED, BAKE_COLORDIR, MASK_BAKE, MASK_AFFECT_DYNAMIC, LIGHTTYPE_DIRECTIONAL, SHADOWUPDATE_REALTIME, SHADOWUPDATE_THISFRAME, FOG_NONE, LIGHTTYPE_SPOT, PROJECTION_PERSPECTIVE, LIGHTTYPE_OMNI, SHADER_FORWARDHDR, SHADERDEF_LM, SHADERDEF_DIRLM, SHADERDEF_LMAMBIENT } from '../../scene/constants.js';\nimport { Camera } from '../../scene/camera.js';\nimport { GraphNode } from '../../scene/graph-node.js';\nimport { StandardMaterial } from '../../scene/materials/standard-material.js';\nimport { BakeLightSimple } from './bake-light-simple.js';\nimport { BakeLightAmbient } from './bake-light-ambient.js';\nimport { BakeMeshNode } from './bake-mesh-node.js';\nimport { LightmapCache } from '../../scene/graphics/lightmap-cache.js';\nimport { LightmapFilters } from './lightmap-filters.js';\nimport { BlendState } from '../../platform/graphics/blend-state.js';\nimport { DepthState } from '../../platform/graphics/depth-state.js';\n\nconst MAX_LIGHTMAP_SIZE = 2048;\nconst PASS_COLOR = 0;\nconst PASS_DIR = 1;\nconst tempVec = new Vec3();\nclass Lightmapper {\n\tconstructor(device, root, scene, renderer, assets) {\n\t\tthis.device = device;\n\t\tthis.root = root;\n\t\tthis.scene = scene;\n\t\tthis.renderer = renderer;\n\t\tthis.assets = assets;\n\t\tthis.shadowMapCache = renderer.shadowMapCache;\n\t\tthis._tempSet = new Set();\n\t\tthis._initCalled = false;\n\t\tthis.passMaterials = [];\n\t\tthis.ambientAOMaterial = null;\n\t\tthis.fog = '';\n\t\tthis.ambientLight = new Color();\n\t\tthis.renderTargets = new Map();\n\t\tthis.stats = {\n\t\t\trenderPasses: 0,\n\t\t\tlightmapCount: 0,\n\t\t\ttotalRenderTime: 0,\n\t\t\tforwardTime: 0,\n\t\t\tfboTime: 0,\n\t\t\tshadowMapTime: 0,\n\t\t\tcompileTime: 0,\n\t\t\tshadersLinked: 0\n\t\t};\n\t}\n\tdestroy() {\n\t\tvar _this$camera;\n\t\tLightmapCache.decRef(this.blackTex);\n\t\tthis.blackTex = null;\n\t\tLightmapCache.destroy();\n\t\tthis.device = null;\n\t\tthis.root = null;\n\t\tthis.scene = null;\n\t\tthis.renderer = null;\n\t\tthis.assets = null;\n\t\t(_this$camera = this.camera) == null || _this$camera.destroy();\n\t\tthis.camera = null;\n\t}\n\tinitBake(device) {\n\t\tif (!this._initCalled) {\n\t\t\tthis._initCalled = true;\n\t\t\tthis.lightmapFilters = new LightmapFilters(device);\n\t\t\tthis.constantBakeDir = device.scope.resolve('bakeDir');\n\t\t\tthis.materials = [];\n\t\t\tthis.blackTex = new Texture(this.device, {\n\t\t\t\twidth: 4,\n\t\t\t\theight: 4,\n\t\t\t\tformat: PIXELFORMAT_RGBA8,\n\t\t\t\ttype: TEXTURETYPE_RGBM,\n\t\t\t\tname: 'lightmapBlack'\n\t\t\t});\n\t\t\tLightmapCache.incRef(this.blackTex);\n\t\t\tconst camera = new Camera();\n\t\t\tcamera.clearColor.set(0, 0, 0, 0);\n\t\t\tcamera.clearColorBuffer = true;\n\t\t\tcamera.clearDepthBuffer = false;\n\t\t\tcamera.clearStencilBuffer = false;\n\t\t\tcamera.frustumCulling = false;\n\t\t\tcamera.projection = PROJECTION_ORTHOGRAPHIC;\n\t\t\tcamera.aspectRatio = 1;\n\t\t\tcamera.node = new GraphNode();\n\t\t\tthis.camera = camera;\n\t\t}\n\t\tif (this.scene.clusteredLightingEnabled) {\n\t\t\tconst lightingParams = new LightingParams(device.supportsAreaLights, device.maxTextureSize, () => {});\n\t\t\tthis.lightingParams = lightingParams;\n\t\t\tconst srcParams = this.scene.lighting;\n\t\t\tlightingParams.shadowsEnabled = srcParams.shadowsEnabled;\n\t\t\tlightingParams.shadowAtlasResolution = srcParams.shadowAtlasResolution;\n\t\t\tlightingParams.cookiesEnabled = srcParams.cookiesEnabled;\n\t\t\tlightingParams.cookieAtlasResolution = srcParams.cookieAtlasResolution;\n\t\t\tlightingParams.areaLightsEnabled = srcParams.areaLightsEnabled;\n\t\t\tlightingParams.cells = new Vec3(3, 3, 3);\n\t\t\tlightingParams.maxLightsPerCell = 4;\n\t\t\tthis.worldClusters = new WorldClusters(device);\n\t\t\tthis.worldClusters.name = 'ClusterLightmapper';\n\t\t}\n\t}\n\tfinishBake(bakeNodes) {\n\t\tthis.materials = [];\n\t\tfunction destroyRT(rt) {\n\t\t\tLightmapCache.decRef(rt.colorBuffer);\n\t\t\trt.destroy();\n\t\t}\n\t\tthis.renderTargets.forEach(rt => {\n\t\t\tdestroyRT(rt);\n\t\t});\n\t\tthis.renderTargets.clear();\n\t\tbakeNodes.forEach(node => {\n\t\t\tnode.renderTargets.forEach(rt => {\n\t\t\t\tdestroyRT(rt);\n\t\t\t});\n\t\t\tnode.renderTargets.length = 0;\n\t\t});\n\t\tthis.ambientAOMaterial = null;\n\t\tif (this.worldClusters) {\n\t\t\tthis.worldClusters.destroy();\n\t\t\tthis.worldClusters = null;\n\t\t}\n\t}\n\tcreateMaterialForPass(device, scene, pass, addAmbient) {\n\t\tconst material = new StandardMaterial();\n\t\tmaterial.name = `lmMaterial-pass:${pass}-ambient:${addAmbient}`;\n\t\tmaterial.chunks.APIVersion = CHUNKAPI_1_65;\n\t\tmaterial.chunks.transformVS = '#define UV1LAYOUT\\n' + shaderChunks.transformVS;\n\t\tif (pass === PASS_COLOR) {\n\t\t\tlet bakeLmEndChunk = shaderChunksLightmapper.bakeLmEndPS;\n\t\t\tif (addAmbient) {\n\t\t\t\tbakeLmEndChunk = `\n\t\t\t\t\t\t\t\t\t\tdDiffuseLight = ((dDiffuseLight - 0.5) * max(${scene.ambientBakeOcclusionContrast.toFixed(1)} + 1.0, 0.0)) + 0.5;\n\t\t\t\t\t\t\t\t\t\tdDiffuseLight += vec3(${scene.ambientBakeOcclusionBrightness.toFixed(1)});\n\t\t\t\t\t\t\t\t\t\tdDiffuseLight = saturate(dDiffuseLight);\n\t\t\t\t\t\t\t\t\t\tdDiffuseLight *= dAmbientLight;\n\t\t\t\t\t\t\t\t` + bakeLmEndChunk;\n\t\t\t} else {\n\t\t\t\tmaterial.ambient = new Color(0, 0, 0);\n\t\t\t\tmaterial.ambientTint = true;\n\t\t\t}\n\t\t\tmaterial.chunks.basePS = shaderChunks.basePS + (scene.lightmapPixelFormat === PIXELFORMAT_RGBA8 ? '\\n#define LIGHTMAP_RGBM\\n' : '');\n\t\t\tmaterial.chunks.endPS = bakeLmEndChunk;\n\t\t\tmaterial.lightMap = this.blackTex;\n\t\t} else {\n\t\t\tmaterial.chunks.basePS = shaderChunks.basePS + '\\nuniform sampler2D texture_dirLightMap;\\nuniform float bakeDir;\\n';\n\t\t\tmaterial.chunks.endPS = shaderChunksLightmapper.bakeDirLmEndPS;\n\t\t}\n\t\tmaterial.chunks.outputAlphaPS = '\\n';\n\t\tmaterial.chunks.outputAlphaOpaquePS = '\\n';\n\t\tmaterial.chunks.outputAlphaPremulPS = '\\n';\n\t\tmaterial.cull = CULLFACE_NONE;\n\t\tmaterial.forceUv1 = true;\n\t\tmaterial.update();\n\t\treturn material;\n\t}\n\tcreateMaterials(device, scene, passCount) {\n\t\tfor (let pass = 0; pass < passCount; pass++) {\n\t\t\tif (!this.passMaterials[pass]) {\n\t\t\t\tthis.passMaterials[pass] = this.createMaterialForPass(device, scene, pass, false);\n\t\t\t}\n\t\t}\n\t\tif (!this.ambientAOMaterial) {\n\t\t\tthis.ambientAOMaterial = this.createMaterialForPass(device, scene, 0, true);\n\t\t\tthis.ambientAOMaterial.onUpdateShader = function (options) {\n\t\t\t\toptions.litOptions.lightMapWithoutAmbient = true;\n\t\t\t\toptions.litOptions.separateAmbient = true;\n\t\t\t\treturn options;\n\t\t\t};\n\t\t}\n\t}\n\tcreateTexture(size, name) {\n\t\treturn new Texture(this.device, {\n\t\t\twidth: size,\n\t\t\theight: size,\n\t\t\tformat: this.scene.lightmapPixelFormat,\n\t\t\tmipmaps: false,\n\t\t\ttype: this.scene.lightmapPixelFormat === PIXELFORMAT_RGBA8 ? TEXTURETYPE_RGBM : TEXTURETYPE_DEFAULT,\n\t\t\tminFilter: FILTER_NEAREST,\n\t\t\tmagFilter: FILTER_NEAREST,\n\t\t\taddressU: ADDRESS_CLAMP_TO_EDGE,\n\t\t\taddressV: ADDRESS_CLAMP_TO_EDGE,\n\t\t\tname: name\n\t\t});\n\t}\n\tcollectModels(node, bakeNodes, allNodes) {\n\t\tvar _node$model, _node$model2, _node$render;\n\t\tif (!node.enabled) return;\n\t\tlet meshInstances;\n\t\tif ((_node$model = node.model) != null && _node$model.model && (_node$model2 = node.model) != null && _node$model2.enabled) {\n\t\t\tif (allNodes) allNodes.push(new BakeMeshNode(node));\n\t\t\tif (node.model.lightmapped) {\n\t\t\t\tif (bakeNodes) {\n\t\t\t\t\tmeshInstances = node.model.model.meshInstances;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif ((_node$render = node.render) != null && _node$render.enabled) {\n\t\t\tif (allNodes) allNodes.push(new BakeMeshNode(node));\n\t\t\tif (node.render.lightmapped) {\n\t\t\t\tif (bakeNodes) {\n\t\t\t\t\tmeshInstances = node.render.meshInstances;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (meshInstances) {\n\t\t\tlet hasUv1 = true;\n\t\t\tfor (let i = 0; i < meshInstances.length; i++) {\n\t\t\t\tif (!meshInstances[i].mesh.vertexBuffer.format.hasUv1) {\n\t\t\t\t\thasUv1 = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (hasUv1) {\n\t\t\t\tconst notInstancedMeshInstances = [];\n\t\t\t\tfor (let i = 0; i < meshInstances.length; i++) {\n\t\t\t\t\tconst mesh = meshInstances[i].mesh;\n\t\t\t\t\tif (this._tempSet.has(mesh)) {\n\t\t\t\t\t\tbakeNodes.push(new BakeMeshNode(node, [meshInstances[i]]));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnotInstancedMeshInstances.push(meshInstances[i]);\n\t\t\t\t\t}\n\t\t\t\t\tthis._tempSet.add(mesh);\n\t\t\t\t}\n\t\t\t\tthis._tempSet.clear();\n\t\t\t\tif (notInstancedMeshInstances.length > 0) {\n\t\t\t\t\tbakeNodes.push(new BakeMeshNode(node, notInstancedMeshInstances));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor (let i = 0; i < node._children.length; i++) {\n\t\t\tthis.collectModels(node._children[i], bakeNodes, allNodes);\n\t\t}\n\t}\n\tprepareShadowCasters(nodes) {\n\t\tconst casters = [];\n\t\tfor (let n = 0; n < nodes.length; n++) {\n\t\t\tconst component = nodes[n].component;\n\t\t\tcomponent.castShadows = component.castShadowsLightmap;\n\t\t\tif (component.castShadowsLightmap) {\n\t\t\t\tconst meshes = nodes[n].meshInstances;\n\t\t\t\tfor (let i = 0; i < meshes.length; i++) {\n\t\t\t\t\tmeshes[i].visibleThisFrame = true;\n\t\t\t\t\tcasters.push(meshes[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn casters;\n\t}\n\tupdateTransforms(nodes) {\n\t\tfor (let i = 0; i < nodes.length; i++) {\n\t\t\tconst meshInstances = nodes[i].meshInstances;\n\t\t\tfor (let j = 0; j < meshInstances.length; j++) {\n\t\t\t\tmeshInstances[j].node.getWorldTransform();\n\t\t\t}\n\t\t}\n\t}\n\tcalculateLightmapSize(node) {\n\t\tlet data;\n\t\tconst sizeMult = this.scene.lightmapSizeMultiplier || 16;\n\t\tconst scale = tempVec;\n\t\tlet srcArea, lightmapSizeMultiplier;\n\t\tif (node.model) {\n\t\t\tlightmapSizeMultiplier = node.model.lightmapSizeMultiplier;\n\t\t\tif (node.model.asset) {\n\t\t\t\tdata = this.assets.get(node.model.asset).data;\n\t\t\t\tif (data.area) {\n\t\t\t\t\tsrcArea = data.area;\n\t\t\t\t}\n\t\t\t} else if (node.model._area) {\n\t\t\t\tdata = node.model;\n\t\t\t\tif (data._area) {\n\t\t\t\t\tsrcArea = data._area;\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (node.render) {\n\t\t\tlightmapSizeMultiplier = node.render.lightmapSizeMultiplier;\n\t\t\tif (node.render.type !== 'asset') {\n\t\t\t\tif (node.render._area) {\n\t\t\t\t\tdata = node.render;\n\t\t\t\t\tif (data._area) {\n\t\t\t\t\t\tsrcArea = data._area;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst area = {\n\t\t\tx: 1,\n\t\t\ty: 1,\n\t\t\tz: 1,\n\t\t\tuv: 1\n\t\t};\n\t\tif (srcArea) {\n\t\t\tarea.x = srcArea.x;\n\t\t\tarea.y = srcArea.y;\n\t\t\tarea.z = srcArea.z;\n\t\t\tarea.uv = srcArea.uv;\n\t\t}\n\t\tconst areaMult = lightmapSizeMultiplier || 1;\n\t\tarea.x *= areaMult;\n\t\tarea.y *= areaMult;\n\t\tarea.z *= areaMult;\n\t\tconst component = node.render || node.model;\n\t\tconst bounds = this.computeNodeBounds(component.meshInstances);\n\t\tscale.copy(bounds.halfExtents);\n\t\tlet totalArea = area.x * scale.y * scale.z + area.y * scale.x * scale.z + area.z * scale.x * scale.y;\n\t\ttotalArea /= area.uv;\n\t\ttotalArea = Math.sqrt(totalArea);\n\t\tconst lightmapSize = Math.min(math.nextPowerOfTwo(totalArea * sizeMult), this.scene.lightmapMaxResolution || MAX_LIGHTMAP_SIZE);\n\t\treturn lightmapSize;\n\t}\n\tsetLightmapping(nodes, value, passCount, shaderDefs) {\n\t\tfor (let i = 0; i < nodes.length; i++) {\n\t\t\tconst node = nodes[i];\n\t\t\tconst meshInstances = node.meshInstances;\n\t\t\tfor (let j = 0; j < meshInstances.length; j++) {\n\t\t\t\tconst meshInstance = meshInstances[j];\n\t\t\t\tmeshInstance.setLightmapped(value);\n\t\t\t\tif (value) {\n\t\t\t\t\tif (shaderDefs) {\n\t\t\t\t\t\tmeshInstance._shaderDefs |= shaderDefs;\n\t\t\t\t\t}\n\t\t\t\t\tmeshInstance.mask = MASK_AFFECT_LIGHTMAPPED;\n\t\t\t\t\tfor (let pass = 0; pass < passCount; pass++) {\n\t\t\t\t\t\tconst tex = node.renderTargets[pass].colorBuffer;\n\t\t\t\t\t\ttex.minFilter = FILTER_LINEAR;\n\t\t\t\t\t\ttex.magFilter = FILTER_LINEAR;\n\t\t\t\t\t\tmeshInstance.setRealtimeLightmap(MeshInstance.lightmapParamNames[pass], tex);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tbake(nodes, mode = BAKE_COLORDIR) {\n\t\tconst device = this.device;\n\t\tif (device.isWebGPU) {\n\t\t\treturn;\n\t\t}\n\t\tconst startTime = now();\n\t\tthis.scene._updateSky(device);\n\t\tthis.stats.renderPasses = 0;\n\t\tthis.stats.shadowMapTime = 0;\n\t\tthis.stats.forwardTime = 0;\n\t\tconst startShaders = device._shaderStats.linked;\n\t\tconst startFboTime = device._renderTargetCreationTime;\n\t\tconst startCompileTime = device._shaderStats.compileTime;\n\t\tconst bakeNodes = [];\n\t\tconst allNodes = [];\n\t\tif (nodes) {\n\t\t\tfor (let i = 0; i < nodes.length; i++) {\n\t\t\t\tthis.collectModels(nodes[i], bakeNodes, null);\n\t\t\t}\n\t\t\tthis.collectModels(this.root, null, allNodes);\n\t\t} else {\n\t\t\tthis.collectModels(this.root, bakeNodes, allNodes);\n\t\t}\n\t\tif (bakeNodes.length > 0) {\n\t\t\tthis.renderer.shadowRenderer.frameUpdate();\n\t\t\tconst passCount = mode === BAKE_COLORDIR ? 2 : 1;\n\t\t\tthis.setLightmapping(bakeNodes, false, passCount);\n\t\t\tthis.initBake(device);\n\t\t\tthis.bakeInternal(passCount, bakeNodes, allNodes);\n\t\t\tlet shaderDefs = SHADERDEF_LM;\n\t\t\tif (mode === BAKE_COLORDIR) {\n\t\t\t\tshaderDefs |= SHADERDEF_DIRLM;\n\t\t\t}\n\t\t\tif (this.scene.ambientBake) {\n\t\t\t\tshaderDefs |= SHADERDEF_LMAMBIENT;\n\t\t\t}\n\t\t\tthis.setLightmapping(bakeNodes, true, passCount, shaderDefs);\n\t\t\tthis.finishBake(bakeNodes);\n\t\t}\n\t\tconst nowTime = now();\n\t\tthis.stats.totalRenderTime = nowTime - startTime;\n\t\tthis.stats.shadersLinked = device._shaderStats.linked - startShaders;\n\t\tthis.stats.compileTime = device._shaderStats.compileTime - startCompileTime;\n\t\tthis.stats.fboTime = device._renderTargetCreationTime - startFboTime;\n\t\tthis.stats.lightmapCount = bakeNodes.length;\n\t}\n\tallocateTextures(bakeNodes, passCount) {\n\t\tfor (let i = 0; i < bakeNodes.length; i++) {\n\t\t\tconst bakeNode = bakeNodes[i];\n\t\t\tconst size = this.calculateLightmapSize(bakeNode.node);\n\t\t\tfor (let pass = 0; pass < passCount; pass++) {\n\t\t\t\tconst tex = this.createTexture(size, 'lightmapper_lightmap_' + i);\n\t\t\t\tLightmapCache.incRef(tex);\n\t\t\t\tbakeNode.renderTargets[pass] = new RenderTarget({\n\t\t\t\t\tcolorBuffer: tex,\n\t\t\t\t\tdepth: false\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (!this.renderTargets.has(size)) {\n\t\t\t\tconst tex = this.createTexture(size, 'lightmapper_temp_lightmap_' + size);\n\t\t\t\tLightmapCache.incRef(tex);\n\t\t\t\tthis.renderTargets.set(size, new RenderTarget({\n\t\t\t\t\tcolorBuffer: tex,\n\t\t\t\t\tdepth: false\n\t\t\t\t}));\n\t\t\t}\n\t\t}\n\t}\n\tprepareLightsToBake(layerComposition, allLights, bakeLights) {\n\t\tif (this.scene.ambientBake) {\n\t\t\tconst ambientLight = new BakeLightAmbient(this.scene);\n\t\t\tbakeLights.push(ambientLight);\n\t\t}\n\t\tconst sceneLights = this.renderer.lights;\n\t\tfor (let i = 0; i < sceneLights.length; i++) {\n\t\t\tconst light = sceneLights[i];\n\t\t\tconst bakeLight = new BakeLightSimple(this.scene, light);\n\t\t\tallLights.push(bakeLight);\n\t\t\tif (light.enabled && (light.mask & MASK_BAKE) !== 0) {\n\t\t\t\tlight.mask = MASK_BAKE | MASK_AFFECT_LIGHTMAPPED | MASK_AFFECT_DYNAMIC;\n\t\t\t\tlight.shadowUpdateMode = light.type === LIGHTTYPE_DIRECTIONAL ? SHADOWUPDATE_REALTIME : SHADOWUPDATE_THISFRAME;\n\t\t\t\tbakeLights.push(bakeLight);\n\t\t\t}\n\t\t}\n\t\tbakeLights.sort();\n\t}\n\trestoreLights(allLights) {\n\t\tfor (let i = 0; i < allLights.length; i++) {\n\t\t\tallLights[i].restore();\n\t\t}\n\t}\n\tsetupScene() {\n\t\tthis.fog = this.scene.fog;\n\t\tthis.ambientLight.copy(this.scene.ambientLight);\n\t\tthis.scene.fog = FOG_NONE;\n\t\tif (!this.scene.ambientBake) {\n\t\t\tthis.scene.ambientLight.set(0, 0, 0);\n\t\t}\n\t\tthis.renderer.setSceneConstants();\n\t}\n\trestoreScene() {\n\t\tthis.scene.fog = this.fog;\n\t\tthis.scene.ambientLight.copy(this.ambientLight);\n\t}\n\tcomputeNodeBounds(meshInstances) {\n\t\tconst bounds = new BoundingBox();\n\t\tif (meshInstances.length > 0) {\n\t\t\tbounds.copy(meshInstances[0].aabb);\n\t\t\tfor (let m = 1; m < meshInstances.length; m++) {\n\t\t\t\tbounds.add(meshInstances[m].aabb);\n\t\t\t}\n\t\t}\n\t\treturn bounds;\n\t}\n\tcomputeNodesBounds(nodes) {\n\t\tfor (let i = 0; i < nodes.length; i++) {\n\t\t\tconst meshInstances = nodes[i].meshInstances;\n\t\t\tnodes[i].bounds = this.computeNodeBounds(meshInstances);\n\t\t}\n\t}\n\tcomputeBounds(meshInstances) {\n\t\tconst bounds = new BoundingBox();\n\t\tfor (let i = 0; i < meshInstances.length; i++) {\n\t\t\tbounds.copy(meshInstances[0].aabb);\n\t\t\tfor (let m = 1; m < meshInstances.length; m++) {\n\t\t\t\tbounds.add(meshInstances[m].aabb);\n\t\t\t}\n\t\t}\n\t\treturn bounds;\n\t}\n\tbackupMaterials(meshInstances) {\n\t\tfor (let i = 0; i < meshInstances.length; i++) {\n\t\t\tthis.materials[i] = meshInstances[i].material;\n\t\t}\n\t}\n\trestoreMaterials(meshInstances) {\n\t\tfor (let i = 0; i < meshInstances.length; i++) {\n\t\t\tmeshInstances[i].material = this.materials[i];\n\t\t}\n\t}\n\tlightCameraPrepare(device, bakeLight) {\n\t\tconst light = bakeLight.light;\n\t\tlet shadowCam;\n\t\tif (light.type === LIGHTTYPE_SPOT) {\n\t\t\tconst lightRenderData = light.getRenderData(null, 0);\n\t\t\tshadowCam = lightRenderData.shadowCamera;\n\t\t\tshadowCam._node.setPosition(light._node.getPosition());\n\t\t\tshadowCam._node.setRotation(light._node.getRotation());\n\t\t\tshadowCam._node.rotateLocal(-90, 0, 0);\n\t\t\tshadowCam.projection = PROJECTION_PERSPECTIVE;\n\t\t\tshadowCam.nearClip = light.attenuationEnd / 1000;\n\t\t\tshadowCam.farClip = light.attenuationEnd;\n\t\t\tshadowCam.aspectRatio = 1;\n\t\t\tshadowCam.fov = light._outerConeAngle * 2;\n\t\t\tthis.renderer.updateCameraFrustum(shadowCam);\n\t\t}\n\t\treturn shadowCam;\n\t}\n\tlightCameraPrepareAndCull(bakeLight, bakeNode, shadowCam, casterBounds) {\n\t\tconst light = bakeLight.light;\n\t\tlet lightAffectsNode = true;\n\t\tif (light.type === LIGHTTYPE_DIRECTIONAL) {\n\t\t\ttempVec.copy(casterBounds.center);\n\t\t\ttempVec.y += casterBounds.halfExtents.y;\n\t\t\tthis.camera.node.setPosition(tempVec);\n\t\t\tthis.camera.node.setEulerAngles(-90, 0, 0);\n\t\t\tthis.camera.nearClip = 0;\n\t\t\tthis.camera.farClip = casterBounds.halfExtents.y * 2;\n\t\t\tconst frustumSize = Math.max(casterBounds.halfExtents.x, casterBounds.halfExtents.z);\n\t\t\tthis.camera.orthoHeight = frustumSize;\n\t\t} else {\n\t\t\tif (!bakeLight.lightBounds.intersects(bakeNode.bounds)) {\n\t\t\t\tlightAffectsNode = false;\n\t\t\t}\n\t\t}\n\t\tif (light.type === LIGHTTYPE_SPOT) {\n\t\t\tlet nodeVisible = false;\n\t\t\tconst meshInstances = bakeNode.meshInstances;\n\t\t\tfor (let i = 0; i < meshInstances.length; i++) {\n\t\t\t\tif (meshInstances[i]._isVisible(shadowCam)) {\n\t\t\t\t\tnodeVisible = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!nodeVisible) {\n\t\t\t\tlightAffectsNode = false;\n\t\t\t}\n\t\t}\n\t\treturn lightAffectsNode;\n\t}\n\tsetupLightArray(lightArray, light) {\n\t\tlightArray[LIGHTTYPE_DIRECTIONAL].length = 0;\n\t\tlightArray[LIGHTTYPE_OMNI].length = 0;\n\t\tlightArray[LIGHTTYPE_SPOT].length = 0;\n\t\tlightArray[light.type][0] = light;\n\t\tlight.visibleThisFrame = true;\n\t}\n\trenderShadowMap(comp, shadowMapRendered, casters, bakeLight) {\n\t\tconst light = bakeLight.light;\n\t\tconst isClustered = this.scene.clusteredLightingEnabled;\n\t\tconst castShadow = light.castShadows && (!isClustered || this.scene.lighting.shadowsEnabled);\n\t\tif (!shadowMapRendered && castShadow) {\n\t\t\tif (!light.shadowMap && !isClustered) {\n\t\t\t\tlight.shadowMap = this.shadowMapCache.get(this.device, light);\n\t\t\t}\n\t\t\tif (light.type === LIGHTTYPE_DIRECTIONAL) {\n\t\t\t\tthis.renderer._shadowRendererDirectional.cull(light, comp, this.camera, casters);\n\t\t\t} else {\n\t\t\t\tthis.renderer._shadowRendererLocal.cull(light, comp, casters);\n\t\t\t}\n\t\t\tconst insideRenderPass = false;\n\t\t\tthis.renderer.shadowRenderer.render(light, this.camera, insideRenderPass);\n\t\t}\n\t\treturn true;\n\t}\n\tpostprocessTextures(device, bakeNodes, passCount) {\n\t\tconst numDilates2x = 1;\n\t\tconst dilateShader = this.lightmapFilters.shaderDilate;\n\t\tconst filterLightmap = this.scene.lightmapFilterEnabled;\n\t\tif (filterLightmap) {\n\t\t\tthis.lightmapFilters.prepareDenoise(this.scene.lightmapFilterRange, this.scene.lightmapFilterSmoothness);\n\t\t}\n\t\tdevice.setBlendState(BlendState.NOBLEND);\n\t\tdevice.setDepthState(DepthState.NODEPTH);\n\t\tdevice.setStencilState(null, null);\n\t\tfor (let node = 0; node < bakeNodes.length; node++) {\n\t\t\tconst bakeNode = bakeNodes[node];\n\t\t\tfor (let pass = 0; pass < passCount; pass++) {\n\t\t\t\tconst nodeRT = bakeNode.renderTargets[pass];\n\t\t\t\tconst lightmap = nodeRT.colorBuffer;\n\t\t\t\tconst tempRT = this.renderTargets.get(lightmap.width);\n\t\t\t\tconst tempTex = tempRT.colorBuffer;\n\t\t\t\tthis.lightmapFilters.prepare(lightmap.width, lightmap.height);\n\t\t\t\tfor (let i = 0; i < numDilates2x; i++) {\n\t\t\t\t\tthis.lightmapFilters.setSourceTexture(lightmap);\n\t\t\t\t\tconst bilateralFilterEnabled = filterLightmap && pass === 0 && i === 0;\n\t\t\t\t\tdrawQuadWithShader(device, tempRT, bilateralFilterEnabled ? this.lightmapFilters.shaderDenoise : dilateShader);\n\t\t\t\t\tthis.lightmapFilters.setSourceTexture(tempTex);\n\t\t\t\t\tdrawQuadWithShader(device, nodeRT, dilateShader);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tbakeInternal(passCount, bakeNodes, allNodes) {\n\t\tconst scene = this.scene;\n\t\tconst comp = scene.layers;\n\t\tconst device = this.device;\n\t\tconst clusteredLightingEnabled = scene.clusteredLightingEnabled;\n\t\tthis.createMaterials(device, scene, passCount);\n\t\tthis.setupScene();\n\t\tcomp._update();\n\t\tthis.computeNodesBounds(bakeNodes);\n\t\tthis.allocateTextures(bakeNodes, passCount);\n\t\tthis.renderer.collectLights(comp);\n\t\tconst allLights = [],\n\t\t\tbakeLights = [];\n\t\tthis.prepareLightsToBake(comp, allLights, bakeLights);\n\t\tthis.updateTransforms(allNodes);\n\t\tconst casters = this.prepareShadowCasters(allNodes);\n\t\tthis.renderer.updateCpuSkinMatrices(casters);\n\t\tthis.renderer.gpuUpdate(casters);\n\t\tconst casterBounds = this.computeBounds(casters);\n\t\tlet i, j, rcv, m;\n\t\tfor (i = 0; i < bakeNodes.length; i++) {\n\t\t\tconst bakeNode = bakeNodes[i];\n\t\t\trcv = bakeNode.meshInstances;\n\t\t\tfor (j = 0; j < rcv.length; j++) {\n\t\t\t\tm = rcv[j];\n\t\t\t\tm.setLightmapped(false);\n\t\t\t\tm.mask = MASK_BAKE;\n\t\t\t\tm.setRealtimeLightmap(MeshInstance.lightmapParamNames[0], m.material.lightMap ? m.material.lightMap : this.blackTex);\n\t\t\t\tm.setRealtimeLightmap(MeshInstance.lightmapParamNames[1], this.blackTex);\n\t\t\t}\n\t\t}\n\t\tfor (j = 0; j < bakeLights.length; j++) {\n\t\t\tbakeLights[j].light.enabled = false;\n\t\t}\n\t\tconst lightArray = [[], [], []];\n\t\tlet pass, node;\n\t\tlet shadersUpdatedOn1stPass = false;\n\t\tfor (i = 0; i < bakeLights.length; i++) {\n\t\t\tconst bakeLight = bakeLights[i];\n\t\t\tconst isAmbientLight = bakeLight instanceof BakeLightAmbient;\n\t\t\tconst isDirectional = bakeLight.light.type === LIGHTTYPE_DIRECTIONAL;\n\t\t\tlet numVirtualLights = bakeLight.numVirtualLights;\n\t\t\tif (passCount > 1 && numVirtualLights > 1 && bakeLight.light.bakeDir) {\n\t\t\t\tnumVirtualLights = 1;\n\t\t\t}\n\t\t\tfor (let virtualLightIndex = 0; virtualLightIndex < numVirtualLights; virtualLightIndex++) {\n\t\t\t\tif (numVirtualLights > 1) {\n\t\t\t\t\tbakeLight.prepareVirtualLight(virtualLightIndex, numVirtualLights);\n\t\t\t\t}\n\t\t\t\tbakeLight.startBake();\n\t\t\t\tlet shadowMapRendered = false;\n\t\t\t\tconst shadowCam = this.lightCameraPrepare(device, bakeLight);\n\t\t\t\tfor (node = 0; node < bakeNodes.length; node++) {\n\t\t\t\t\tconst bakeNode = bakeNodes[node];\n\t\t\t\t\trcv = bakeNode.meshInstances;\n\t\t\t\t\tconst lightAffectsNode = this.lightCameraPrepareAndCull(bakeLight, bakeNode, shadowCam, casterBounds);\n\t\t\t\t\tif (!lightAffectsNode) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tthis.setupLightArray(lightArray, bakeLight.light);\n\t\t\t\t\tconst clusterLights = isDirectional ? [] : [bakeLight.light];\n\t\t\t\t\tif (clusteredLightingEnabled) {\n\t\t\t\t\t\tthis.renderer.lightTextureAtlas.update(clusterLights, this.lightingParams);\n\t\t\t\t\t}\n\t\t\t\t\tshadowMapRendered = this.renderShadowMap(comp, shadowMapRendered, casters, bakeLight);\n\t\t\t\t\tif (clusteredLightingEnabled) {\n\t\t\t\t\t\tthis.worldClusters.update(clusterLights, this.scene.gammaCorrection, this.lightingParams);\n\t\t\t\t\t}\n\t\t\t\t\tthis.backupMaterials(rcv);\n\t\t\t\t\tfor (pass = 0; pass < passCount; pass++) {\n\t\t\t\t\t\tif (pass > 0 && virtualLightIndex > 0) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (isAmbientLight && pass > 0) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst nodeRT = bakeNode.renderTargets[pass];\n\t\t\t\t\t\tconst lightmapSize = bakeNode.renderTargets[pass].colorBuffer.width;\n\t\t\t\t\t\tconst tempRT = this.renderTargets.get(lightmapSize);\n\t\t\t\t\t\tconst tempTex = tempRT.colorBuffer;\n\t\t\t\t\t\tif (pass === 0) {\n\t\t\t\t\t\t\tshadersUpdatedOn1stPass = scene.updateShaders;\n\t\t\t\t\t\t} else if (shadersUpdatedOn1stPass) {\n\t\t\t\t\t\t\tscene.updateShaders = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet passMaterial = this.passMaterials[pass];\n\t\t\t\t\t\tif (isAmbientLight) {\n\t\t\t\t\t\t\tconst lastVirtualLightForPass = virtualLightIndex + 1 === numVirtualLights;\n\t\t\t\t\t\t\tif (lastVirtualLightForPass && pass === 0) {\n\t\t\t\t\t\t\t\tpassMaterial = this.ambientAOMaterial;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfor (j = 0; j < rcv.length; j++) {\n\t\t\t\t\t\t\trcv[j].material = passMaterial;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.renderer.updateShaders(rcv);\n\t\t\t\t\t\tthis.renderer.setCamera(this.camera, tempRT, true);\n\t\t\t\t\t\tif (pass === PASS_DIR) {\n\t\t\t\t\t\t\tthis.constantBakeDir.setValue(bakeLight.light.bakeDir ? 1 : 0);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (clusteredLightingEnabled) {\n\t\t\t\t\t\t\tthis.worldClusters.activate();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.renderer._forwardTime = 0;\n\t\t\t\t\t\tthis.renderer._shadowMapTime = 0;\n\t\t\t\t\t\tthis.renderer.renderForward(this.camera, rcv, lightArray, SHADER_FORWARDHDR);\n\t\t\t\t\t\tdevice.updateEnd();\n\t\t\t\t\t\tbakeNode.renderTargets[pass] = tempRT;\n\t\t\t\t\t\tthis.renderTargets.set(lightmapSize, nodeRT);\n\t\t\t\t\t\tfor (j = 0; j < rcv.length; j++) {\n\t\t\t\t\t\t\tm = rcv[j];\n\t\t\t\t\t\t\tm.setRealtimeLightmap(MeshInstance.lightmapParamNames[pass], tempTex);\n\t\t\t\t\t\t\tm._shaderDefs |= SHADERDEF_LM;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.restoreMaterials(rcv);\n\t\t\t\t}\n\t\t\t\tbakeLight.endBake(this.shadowMapCache);\n\t\t\t}\n\t\t}\n\t\tthis.postprocessTextures(device, bakeNodes, passCount);\n\t\tfor (node = 0; node < allNodes.length; node++) {\n\t\t\tallNodes[node].restore();\n\t\t}\n\t\tthis.restoreLights(allLights);\n\t\tthis.restoreScene();\n\t\tif (!clusteredLightingEnabled) {\n\t\t\tthis.shadowMapCache.clear();\n\t\t}\n\t}\n}\n\nexport { Lightmapper };\n","import { EventHandler } from '../../core/event-handler.js';\n\nclass Component extends EventHandler {\n\tconstructor(system, entity) {\n\t\tsuper();\n\t\tthis.system = void 0;\n\t\tthis.entity = void 0;\n\t\tthis.system = system;\n\t\tthis.entity = entity;\n\t\tif (this.system.schema && !this._accessorsBuilt) {\n\t\t\tthis.buildAccessors(this.system.schema);\n\t\t}\n\t\tthis.on('set', function (name, oldValue, newValue) {\n\t\t\tthis.fire('set_' + name, name, oldValue, newValue);\n\t\t});\n\t\tthis.on('set_enabled', this.onSetEnabled, this);\n\t}\n\tstatic _buildAccessors(obj, schema) {\n\t\tschema.forEach(function (descriptor) {\n\t\t\tconst name = typeof descriptor === 'object' ? descriptor.name : descriptor;\n\t\t\tObject.defineProperty(obj, name, {\n\t\t\t\tget: function () {\n\t\t\t\t\treturn this.data[name];\n\t\t\t\t},\n\t\t\t\tset: function (value) {\n\t\t\t\t\tconst data = this.data;\n\t\t\t\t\tconst oldValue = data[name];\n\t\t\t\t\tdata[name] = value;\n\t\t\t\t\tthis.fire('set', name, oldValue, value);\n\t\t\t\t},\n\t\t\t\tconfigurable: true\n\t\t\t});\n\t\t});\n\t\tobj._accessorsBuilt = true;\n\t}\n\tbuildAccessors(schema) {\n\t\tComponent._buildAccessors(this, schema);\n\t}\n\tonSetEnabled(name, oldValue, newValue) {\n\t\tif (oldValue !== newValue) {\n\t\t\tif (this.entity.enabled) {\n\t\t\t\tif (newValue) {\n\t\t\t\t\tthis.onEnable();\n\t\t\t\t} else {\n\t\t\t\t\tthis.onDisable();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tonEnable() {}\n\tonDisable() {}\n\tonPostStateChange() {}\n\tget data() {\n\t\tconst record = this.system.store[this.entity.getGuid()];\n\t\treturn record ? record.data : null;\n\t}\n}\n\nexport { Component };\n","import { EventHandler } from '../../core/event-handler.js';\nimport { Color } from '../../core/math/color.js';\nimport { Vec2 } from '../../core/math/vec2.js';\nimport { Vec3 } from '../../core/math/vec3.js';\nimport { Vec4 } from '../../core/math/vec4.js';\n\nclass ComponentSystem extends EventHandler {\n\tconstructor(app) {\n\t\tsuper();\n\t\tthis.app = app;\n\t\tthis.store = {};\n\t\tthis.schema = [];\n\t}\n\taddComponent(entity, data = {}) {\n\t\tconst component = new this.ComponentType(this, entity);\n\t\tconst componentData = new this.DataType();\n\t\tthis.store[entity.getGuid()] = {\n\t\t\tentity: entity,\n\t\t\tdata: componentData\n\t\t};\n\t\tentity[this.id] = component;\n\t\tentity.c[this.id] = component;\n\t\tthis.initializeComponentData(component, data, []);\n\t\tthis.fire('add', entity, component);\n\t\treturn component;\n\t}\n\tremoveComponent(entity) {\n\t\tconst record = this.store[entity.getGuid()];\n\t\tconst component = entity.c[this.id];\n\t\tthis.fire('beforeremove', entity, component);\n\t\tdelete this.store[entity.getGuid()];\n\t\tentity[this.id] = undefined;\n\t\tdelete entity.c[this.id];\n\t\tthis.fire('remove', entity, record.data);\n\t}\n\tcloneComponent(entity, clone) {\n\t\tconst src = this.store[entity.getGuid()];\n\t\treturn this.addComponent(clone, src.data);\n\t}\n\tinitializeComponentData(component, data = {}, properties) {\n\t\tfor (let i = 0, len = properties.length; i < len; i++) {\n\t\t\tconst descriptor = properties[i];\n\t\t\tlet name, type;\n\t\t\tif (typeof descriptor === 'object') {\n\t\t\t\tname = descriptor.name;\n\t\t\t\ttype = descriptor.type;\n\t\t\t} else {\n\t\t\t\tname = descriptor;\n\t\t\t\ttype = undefined;\n\t\t\t}\n\t\t\tlet value = data[name];\n\t\t\tif (value !== undefined) {\n\t\t\t\tif (type !== undefined) {\n\t\t\t\t\tvalue = convertValue(value, type);\n\t\t\t\t}\n\t\t\t\tcomponent[name] = value;\n\t\t\t} else {\n\t\t\t\tcomponent[name] = component.data[name];\n\t\t\t}\n\t\t}\n\t\tif (component.enabled && component.entity.enabled) {\n\t\t\tcomponent.onEnable();\n\t\t}\n\t}\n\tgetPropertiesOfType(type) {\n\t\tconst matchingProperties = [];\n\t\tconst schema = this.schema || [];\n\t\tschema.forEach(function (descriptor) {\n\t\t\tif (descriptor && typeof descriptor === 'object' && descriptor.type === type) {\n\t\t\t\tmatchingProperties.push(descriptor);\n\t\t\t}\n\t\t});\n\t\treturn matchingProperties;\n\t}\n\tdestroy() {\n\t\tthis.off();\n\t}\n}\nfunction convertValue(value, type) {\n\tif (!value) {\n\t\treturn value;\n\t}\n\tswitch (type) {\n\t\tcase 'rgb':\n\t\t\tif (value instanceof Color) {\n\t\t\t\treturn value.clone();\n\t\t\t}\n\t\t\treturn new Color(value[0], value[1], value[2]);\n\t\tcase 'rgba':\n\t\t\tif (value instanceof Color) {\n\t\t\t\treturn value.clone();\n\t\t\t}\n\t\t\treturn new Color(value[0], value[1], value[2], value[3]);\n\t\tcase 'vec2':\n\t\t\tif (value instanceof Vec2) {\n\t\t\t\treturn value.clone();\n\t\t\t}\n\t\t\treturn new Vec2(value[0], value[1]);\n\t\tcase 'vec3':\n\t\t\tif (value instanceof Vec3) {\n\t\t\t\treturn value.clone();\n\t\t\t}\n\t\t\treturn new Vec3(value[0], value[1], value[2]);\n\t\tcase 'vec4':\n\t\t\tif (value instanceof Vec4) {\n\t\t\t\treturn value.clone();\n\t\t\t}\n\t\t\treturn new Vec4(value[0], value[1], value[2], value[3]);\n\t\tcase 'boolean':\n\t\tcase 'number':\n\t\tcase 'string':\n\t\t\treturn value;\n\t\tcase 'entity':\n\t\t\treturn value;\n\t\tdefault:\n\t\t\tthrow new Error('Could not convert unhandled type: ' + type);\n\t}\n}\n\nexport { ComponentSystem };\n","const INTERPOLATION_STEP = 0;\nconst INTERPOLATION_LINEAR = 1;\nconst INTERPOLATION_CUBIC = 2;\n\nexport { INTERPOLATION_CUBIC, INTERPOLATION_LINEAR, INTERPOLATION_STEP };\n","import { math } from '../../../core/math/math.js';\nimport { INTERPOLATION_STEP, INTERPOLATION_CUBIC, INTERPOLATION_LINEAR } from '../constants.js';\n\nclass AnimCache {\n\tconstructor() {\n\t\tthis._left = Infinity;\n\t\tthis._right = -Infinity;\n\t\tthis._len = 0;\n\t\tthis._recip = 0;\n\t\tthis._p0 = 0;\n\t\tthis._p1 = 0;\n\t\tthis._t = 0;\n\t\tthis._hermite = {\n\t\t\tvalid: false,\n\t\t\tp0: 0,\n\t\t\tm0: 0,\n\t\t\tp1: 0,\n\t\t\tm1: 0\n\t\t};\n\t}\n\tupdate(time, input) {\n\t\tif (time < this._left || time >= this._right) {\n\t\t\tconst len = input.length;\n\t\t\tif (!len) {\n\t\t\t\tthis._left = -Infinity;\n\t\t\t\tthis._right = Infinity;\n\t\t\t\tthis._len = 0;\n\t\t\t\tthis._recip = 0;\n\t\t\t\tthis._p0 = this._p1 = 0;\n\t\t\t} else {\n\t\t\t\tif (time < input[0]) {\n\t\t\t\t\tthis._left = -Infinity;\n\t\t\t\t\tthis._right = input[0];\n\t\t\t\t\tthis._len = 0;\n\t\t\t\t\tthis._recip = 0;\n\t\t\t\t\tthis._p0 = this._p1 = 0;\n\t\t\t\t} else if (time >= input[len - 1]) {\n\t\t\t\t\tthis._left = input[len - 1];\n\t\t\t\t\tthis._right = Infinity;\n\t\t\t\t\tthis._len = 0;\n\t\t\t\t\tthis._recip = 0;\n\t\t\t\t\tthis._p0 = this._p1 = len - 1;\n\t\t\t\t} else {\n\t\t\t\t\tconst index = this._findKey(time, input);\n\t\t\t\t\tthis._left = input[index];\n\t\t\t\t\tthis._right = input[index + 1];\n\t\t\t\t\tthis._len = this._right - this._left;\n\t\t\t\t\tconst diff = 1.0 / this._len;\n\t\t\t\t\tthis._recip = isFinite(diff) ? diff : 0;\n\t\t\t\t\tthis._p0 = index;\n\t\t\t\t\tthis._p1 = index + 1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis._t = this._recip === 0 ? 0 : (time - this._left) * this._recip;\n\t\tthis._hermite.valid = false;\n\t}\n\t_findKey(time, input) {\n\t\tlet index = 0;\n\t\twhile (time >= input[index + 1]) {\n\t\t\tindex++;\n\t\t}\n\t\treturn index;\n\t}\n\teval(result, interpolation, output) {\n\t\tconst data = output._data;\n\t\tconst comp = output._components;\n\t\tconst idx0 = this._p0 * comp;\n\t\tif (interpolation === INTERPOLATION_STEP) {\n\t\t\tfor (let i = 0; i < comp; ++i) {\n\t\t\t\tresult[i] = data[idx0 + i];\n\t\t\t}\n\t\t} else {\n\t\t\tconst t = this._t;\n\t\t\tconst idx1 = this._p1 * comp;\n\t\t\tswitch (interpolation) {\n\t\t\t\tcase INTERPOLATION_LINEAR:\n\t\t\t\t\tfor (let i = 0; i < comp; ++i) {\n\t\t\t\t\t\tresult[i] = math.lerp(data[idx0 + i], data[idx1 + i], t);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase INTERPOLATION_CUBIC:\n\t\t\t\t\t{\n\t\t\t\t\t\tconst hermite = this._hermite;\n\t\t\t\t\t\tif (!hermite.valid) {\n\t\t\t\t\t\t\tconst t2 = t * t;\n\t\t\t\t\t\t\tconst twot = t + t;\n\t\t\t\t\t\t\tconst omt = 1 - t;\n\t\t\t\t\t\t\tconst omt2 = omt * omt;\n\t\t\t\t\t\t\thermite.valid = true;\n\t\t\t\t\t\t\thermite.p0 = (1 + twot) * omt2;\n\t\t\t\t\t\t\thermite.m0 = t * omt2;\n\t\t\t\t\t\t\thermite.p1 = t2 * (3 - twot);\n\t\t\t\t\t\t\thermite.m1 = t2 * (t - 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst p0 = (this._p0 * 3 + 1) * comp;\n\t\t\t\t\t\tconst m0 = (this._p0 * 3 + 2) * comp;\n\t\t\t\t\t\tconst p1 = (this._p1 * 3 + 1) * comp;\n\t\t\t\t\t\tconst m1 = (this._p1 * 3 + 0) * comp;\n\t\t\t\t\t\tfor (let i = 0; i < comp; ++i) {\n\t\t\t\t\t\t\tresult[i] = hermite.p0 * data[p0 + i] + hermite.m0 * data[m0 + i] * this._len + hermite.p1 * data[p1 + i] + hermite.m1 * data[m1 + i] * this._len;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport { AnimCache };\n","import { AnimCache } from './anim-cache.js';\n\nclass AnimSnapshot {\n\tconstructor(animTrack) {\n\t\tthis._name = animTrack.name + 'Snapshot';\n\t\tthis._time = -1;\n\t\tthis._cache = [];\n\t\tthis._results = [];\n\t\tfor (let i = 0; i < animTrack._inputs.length; ++i) {\n\t\t\tthis._cache[i] = new AnimCache();\n\t\t}\n\t\tconst curves = animTrack._curves;\n\t\tconst outputs = animTrack._outputs;\n\t\tfor (let i = 0; i < curves.length; ++i) {\n\t\t\tconst curve = curves[i];\n\t\t\tconst output = outputs[curve._output];\n\t\t\tconst storage = [];\n\t\t\tfor (let j = 0; j < output._components; ++j) {\n\t\t\t\tstorage[j] = 0;\n\t\t\t}\n\t\t\tthis._results[i] = storage;\n\t\t}\n\t}\n}\n\nexport { AnimSnapshot };\n","import { extends as _extends } from '../../../_virtual/_rollupPluginBabelHelpers.js';\nimport { AnimSnapshot } from './anim-snapshot.js';\n\nclass AnimClip {\n\tconstructor(track, time, speed, playing, loop, eventHandler) {\n\t\tthis._name = track.name;\n\t\tthis._track = track;\n\t\tthis._snapshot = new AnimSnapshot(track);\n\t\tthis._playing = playing;\n\t\tthis._time = time;\n\t\tthis._speed = speed;\n\t\tthis._loop = loop;\n\t\tthis._blendWeight = 1.0;\n\t\tthis._blendOrder = 0.0;\n\t\tthis._eventHandler = eventHandler;\n\t\tthis.alignCursorToCurrentTime();\n\t}\n\tset name(name) {\n\t\tthis._name = name;\n\t}\n\tget name() {\n\t\treturn this._name;\n\t}\n\tset track(track) {\n\t\tthis._track = track;\n\t\tthis._snapshot = new AnimSnapshot(track);\n\t}\n\tget track() {\n\t\treturn this._track;\n\t}\n\tget snapshot() {\n\t\treturn this._snapshot;\n\t}\n\tset time(time) {\n\t\tthis._time = time;\n\t\tthis.alignCursorToCurrentTime();\n\t}\n\tget time() {\n\t\treturn this._time;\n\t}\n\tset speed(speed) {\n\t\tconst signChanged = Math.sign(speed) !== Math.sign(this._speed);\n\t\tthis._speed = speed;\n\t\tif (signChanged) {\n\t\t\tthis.alignCursorToCurrentTime();\n\t\t}\n\t}\n\tget speed() {\n\t\treturn this._speed;\n\t}\n\tset loop(loop) {\n\t\tthis._loop = loop;\n\t}\n\tget loop() {\n\t\treturn this._loop;\n\t}\n\tset blendWeight(blendWeight) {\n\t\tthis._blendWeight = blendWeight;\n\t}\n\tget blendWeight() {\n\t\treturn this._blendWeight;\n\t}\n\tset blendOrder(blendOrder) {\n\t\tthis._blendOrder = blendOrder;\n\t}\n\tget blendOrder() {\n\t\treturn this._blendOrder;\n\t}\n\tset eventCursor(value) {\n\t\tthis._eventCursor = value;\n\t}\n\tget eventCursor() {\n\t\treturn this._eventCursor;\n\t}\n\tget eventCursorEnd() {\n\t\treturn this.isReverse ? 0 : this._track.events.length - 1;\n\t}\n\tget nextEvent() {\n\t\treturn this._track.events[this._eventCursor];\n\t}\n\tget isReverse() {\n\t\treturn this._speed < 0;\n\t}\n\tnextEventAheadOfTime(time) {\n\t\tif (!this.nextEvent) return false;\n\t\treturn this.isReverse ? this.nextEvent.time <= time : this.nextEvent.time >= time;\n\t}\n\tnextEventBehindTime(time) {\n\t\tif (!this.nextEvent) return false;\n\t\tif (time === this.track.duration) {\n\t\t\treturn this.isReverse ? this.nextEvent.time >= time : this.nextEvent.time <= time;\n\t\t}\n\t\treturn this.isReverse ? this.nextEvent.time > time : this.nextEvent.time < time;\n\t}\n\tresetEventCursor() {\n\t\tthis._eventCursor = this.isReverse ? this._track.events.length - 1 : 0;\n\t}\n\tmoveEventCursor() {\n\t\tthis._eventCursor += this.isReverse ? -1 : 1;\n\t\tif (this._eventCursor >= this.track.events.length) {\n\t\t\tthis._eventCursor = 0;\n\t\t} else if (this._eventCursor < 0) {\n\t\t\tthis._eventCursor = this.track.events.length - 1;\n\t\t}\n\t}\n\tclipFrameTime(frameEndTime) {\n\t\tconst eventFrame = AnimClip.eventFrame;\n\t\teventFrame.start = 0;\n\t\teventFrame.end = frameEndTime;\n\t\teventFrame.residual = 0;\n\t\tif (this.isReverse) {\n\t\t\tif (frameEndTime < 0) {\n\t\t\t\teventFrame.start = this.track.duration;\n\t\t\t\teventFrame.end = 0;\n\t\t\t\teventFrame.residual = frameEndTime + this.track.duration;\n\t\t\t}\n\t\t} else {\n\t\t\tif (frameEndTime > this.track.duration) {\n\t\t\t\teventFrame.start = 0;\n\t\t\t\teventFrame.end = this.track.duration;\n\t\t\t\teventFrame.residual = frameEndTime - this.track.duration;\n\t\t\t}\n\t\t}\n\t}\n\talignCursorToCurrentTime() {\n\t\tthis.resetEventCursor();\n\t\twhile (this.nextEventBehindTime(this._time) && this._eventCursor !== this.eventCursorEnd) {\n\t\t\tthis.moveEventCursor();\n\t\t}\n\t}\n\tfireNextEvent() {\n\t\tthis._eventHandler.fire(this.nextEvent.name, _extends({\n\t\t\ttrack: this.track\n\t\t}, this.nextEvent));\n\t\tthis.moveEventCursor();\n\t}\n\tfireNextEventInFrame(frameStartTime, frameEndTime) {\n\t\tif (this.nextEventAheadOfTime(frameStartTime) && this.nextEventBehindTime(frameEndTime)) {\n\t\t\tthis.fireNextEvent();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\tactiveEventsForFrame(frameStartTime, frameEndTime) {\n\t\tconst eventFrame = AnimClip.eventFrame;\n\t\tthis.clipFrameTime(frameEndTime);\n\t\tconst initialCursor = this.eventCursor;\n\t\twhile (this.fireNextEventInFrame(frameStartTime, eventFrame.end)) {\n\t\t\tif (initialCursor === this.eventCursor) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (this.loop && Math.abs(eventFrame.residual) > 0) {\n\t\t\tthis.activeEventsForFrame(eventFrame.start, eventFrame.residual);\n\t\t}\n\t}\n\tprogressForTime(time) {\n\t\treturn time * this._speed / this._track.duration;\n\t}\n\t_update(deltaTime) {\n\t\tif (this._playing) {\n\t\t\tlet time = this._time;\n\t\t\tconst duration = this._track.duration;\n\t\t\tconst speed = this._speed;\n\t\t\tconst loop = this._loop;\n\t\t\tif (this._track.events.length > 0 && duration > 0) {\n\t\t\t\tthis.activeEventsForFrame(time, time + speed * deltaTime);\n\t\t\t}\n\t\t\ttime += speed * deltaTime;\n\t\t\tif (speed >= 0) {\n\t\t\t\tif (time > duration) {\n\t\t\t\t\tif (loop) {\n\t\t\t\t\t\ttime = time % duration || 0;\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttime = this._track.duration;\n\t\t\t\t\t\tthis.pause();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (time < 0) {\n\t\t\t\t\tif (loop) {\n\t\t\t\t\t\ttime = duration + (time % duration || 0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttime = 0;\n\t\t\t\t\t\tthis.pause();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._time = time;\n\t\t}\n\t\tif (this._time !== this._snapshot._time) {\n\t\t\tthis._track.eval(this._time, this._snapshot);\n\t\t}\n\t}\n\tplay() {\n\t\tthis._playing = true;\n\t\tthis._time = 0;\n\t}\n\tstop() {\n\t\tthis._playing = false;\n\t\tthis._time = 0;\n\t}\n\tpause() {\n\t\tthis._playing = false;\n\t}\n\tresume() {\n\t\tthis._playing = true;\n\t}\n\treset() {\n\t\tthis._time = 0;\n\t}\n}\nAnimClip.eventFrame = {\n\tstart: 0,\n\tend: 0,\n\tresidual: 0\n};\n\nexport { AnimClip };\n","const ANIM_INTERRUPTION_NONE = 'NONE';\nconst ANIM_INTERRUPTION_PREV = 'PREV_STATE';\nconst ANIM_INTERRUPTION_NEXT = 'NEXT_STATE';\nconst ANIM_INTERRUPTION_PREV_NEXT = 'PREV_STATE_NEXT_STATE';\nconst ANIM_INTERRUPTION_NEXT_PREV = 'NEXT_STATE_PREV_STATE';\nconst ANIM_GREATER_THAN = 'GREATER_THAN';\nconst ANIM_LESS_THAN = 'LESS_THAN';\nconst ANIM_GREATER_THAN_EQUAL_TO = 'GREATER_THAN_EQUAL_TO';\nconst ANIM_LESS_THAN_EQUAL_TO = 'LESS_THAN_EQUAL_TO';\nconst ANIM_EQUAL_TO = 'EQUAL_TO';\nconst ANIM_NOT_EQUAL_TO = 'NOT_EQUAL_TO';\nconst ANIM_PARAMETER_INTEGER = 'INTEGER';\nconst ANIM_PARAMETER_FLOAT = 'FLOAT';\nconst ANIM_PARAMETER_BOOLEAN = 'BOOLEAN';\nconst ANIM_PARAMETER_TRIGGER = 'TRIGGER';\nconst ANIM_BLEND_1D = '1D';\nconst ANIM_BLEND_2D_DIRECTIONAL = '2D_DIRECTIONAL';\nconst ANIM_BLEND_2D_CARTESIAN = '2D_CARTESIAN';\nconst ANIM_BLEND_DIRECT = 'DIRECT';\nconst ANIM_STATE_START = 'START';\nconst ANIM_STATE_END = 'END';\nconst ANIM_STATE_ANY = 'ANY';\nconst ANIM_CONTROL_STATES = [ANIM_STATE_START, ANIM_STATE_END, ANIM_STATE_ANY];\nconst ANIM_LAYER_OVERWRITE = 'OVERWRITE';\nconst ANIM_LAYER_ADDITIVE = 'ADDITIVE';\n\nexport { ANIM_BLEND_1D, ANIM_BLEND_2D_CARTESIAN, ANIM_BLEND_2D_DIRECTIONAL, ANIM_BLEND_DIRECT, ANIM_CONTROL_STATES, ANIM_EQUAL_TO, ANIM_GREATER_THAN, ANIM_GREATER_THAN_EQUAL_TO, ANIM_INTERRUPTION_NEXT, ANIM_INTERRUPTION_NEXT_PREV, ANIM_INTERRUPTION_NONE, ANIM_INTERRUPTION_PREV, ANIM_INTERRUPTION_PREV_NEXT, ANIM_LAYER_ADDITIVE, ANIM_LAYER_OVERWRITE, ANIM_LESS_THAN, ANIM_LESS_THAN_EQUAL_TO, ANIM_NOT_EQUAL_TO, ANIM_PARAMETER_BOOLEAN, ANIM_PARAMETER_FLOAT, ANIM_PARAMETER_INTEGER, ANIM_PARAMETER_TRIGGER, ANIM_STATE_ANY, ANIM_STATE_END, ANIM_STATE_START };\n","class AnimBlend {\n\tstatic dot(a, b) {\n\t\tconst len = a.length;\n\t\tlet result = 0;\n\t\tfor (let i = 0; i < len; ++i) {\n\t\t\tresult += a[i] * b[i];\n\t\t}\n\t\treturn result;\n\t}\n\tstatic normalize(a) {\n\t\tlet l = AnimBlend.dot(a, a);\n\t\tif (l > 0) {\n\t\t\tl = 1.0 / Math.sqrt(l);\n\t\t\tconst len = a.length;\n\t\t\tfor (let i = 0; i < len; ++i) {\n\t\t\t\ta[i] *= l;\n\t\t\t}\n\t\t}\n\t}\n\tstatic set(a, b, type) {\n\t\tconst len = a.length;\n\t\tif (type === 'quaternion') {\n\t\t\tlet l = AnimBlend.dot(b, b);\n\t\t\tif (l > 0) {\n\t\t\t\tl = 1.0 / Math.sqrt(l);\n\t\t\t}\n\t\t\tfor (let i = 0; i < len; ++i) {\n\t\t\t\ta[i] = b[i] * l;\n\t\t\t}\n\t\t} else {\n\t\t\tfor (let i = 0; i < len; ++i) {\n\t\t\t\ta[i] = b[i];\n\t\t\t}\n\t\t}\n\t}\n\tstatic blendVec(a, b, t, additive) {\n\t\tconst it = additive ? 1.0 : 1.0 - t;\n\t\tconst len = a.length;\n\t\tfor (let i = 0; i < len; ++i) {\n\t\t\ta[i] = a[i] * it + b[i] * t;\n\t\t}\n\t}\n\tstatic blendQuat(a, b, t, additive) {\n\t\tconst len = a.length;\n\t\tconst it = additive ? 1.0 : 1.0 - t;\n\t\tif (AnimBlend.dot(a, b) < 0) {\n\t\t\tt = -t;\n\t\t}\n\t\tfor (let i = 0; i < len; ++i) {\n\t\t\ta[i] = a[i] * it + b[i] * t;\n\t\t}\n\t\tif (!additive) {\n\t\t\tAnimBlend.normalize(a);\n\t\t}\n\t}\n\tstatic blend(a, b, t, type, additive) {\n\t\tif (type === 'quaternion') {\n\t\t\tAnimBlend.blendQuat(a, b, t, additive);\n\t\t} else {\n\t\t\tAnimBlend.blendVec(a, b, t, additive);\n\t\t}\n\t}\n\tstatic stableSort(a, lessFunc) {\n\t\tconst len = a.length;\n\t\tfor (let i = 0; i < len - 1; ++i) {\n\t\t\tfor (let j = i + 1; j < len; ++j) {\n\t\t\t\tif (lessFunc(a[j], a[i])) {\n\t\t\t\t\tconst tmp = a[i];\n\t\t\t\t\ta[i] = a[j];\n\t\t\t\t\ta[j] = tmp;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport { AnimBlend };\n","import { Quat } from '../../../core/math/quat.js';\nimport { ANIM_LAYER_OVERWRITE, ANIM_LAYER_ADDITIVE } from '../controller/constants.js';\nimport { AnimBlend } from './anim-blend.js';\nimport { math } from '../../../core/math/math.js';\n\nclass AnimTargetValue {\n\tconstructor(component, type) {\n\t\tthis._component = component;\n\t\tthis.mask = new Int8Array(component.layers.length);\n\t\tthis.weights = new Float32Array(component.layers.length);\n\t\tthis.totalWeight = 0;\n\t\tthis.counter = 0;\n\t\tthis.layerCounter = 0;\n\t\tthis.valueType = type;\n\t\tthis.dirty = true;\n\t\tthis.value = type === AnimTargetValue.TYPE_QUAT ? [0, 0, 0, 1] : [0, 0, 0];\n\t\tthis.baseValue = null;\n\t\tthis.setter = null;\n\t}\n\tget _normalizeWeights() {\n\t\treturn this._component.normalizeWeights;\n\t}\n\tgetWeight(index) {\n\t\tif (this.dirty) this.updateWeights();\n\t\tif (this._normalizeWeights && this.totalWeight === 0 || !this.mask[index]) {\n\t\t\treturn 0;\n\t\t} else if (this._normalizeWeights) {\n\t\t\treturn this.weights[index] / this.totalWeight;\n\t\t}\n\t\treturn math.clamp(this.weights[index], 0, 1);\n\t}\n\t_layerBlendType(index) {\n\t\treturn this._component.layers[index].blendType;\n\t}\n\tsetMask(index, value) {\n\t\tthis.mask[index] = value;\n\t\tif (this._normalizeWeights) {\n\t\t\tif (this._component.layers[index].blendType === ANIM_LAYER_OVERWRITE) {\n\t\t\t\tthis.mask = this.mask.fill(0, 0, index);\n\t\t\t}\n\t\t\tthis.dirty = true;\n\t\t}\n\t}\n\tupdateWeights() {\n\t\tthis.totalWeight = 0;\n\t\tfor (let i = 0; i < this.weights.length; i++) {\n\t\t\tthis.weights[i] = this._component.layers[i].weight;\n\t\t\tthis.totalWeight += this.mask[i] * this.weights[i];\n\t\t}\n\t\tthis.dirty = false;\n\t}\n\tupdateValue(index, value) {\n\t\tif (this.counter === 0) {\n\t\t\tAnimBlend.set(this.value, AnimTargetValue.IDENTITY_QUAT_ARR, this.valueType);\n\t\t\tif (!this._normalizeWeights) {\n\t\t\t\tAnimBlend.blend(this.value, this.baseValue, 1, this.valueType);\n\t\t\t}\n\t\t}\n\t\tif (!this.mask[index] || this.getWeight(index) === 0) return;\n\t\tif (this._layerBlendType(index) === ANIM_LAYER_ADDITIVE && !this._normalizeWeights) {\n\t\t\tif (this.valueType === AnimTargetValue.TYPE_QUAT) {\n\t\t\t\tconst v = AnimTargetValue.q1.set(this.value[0], this.value[1], this.value[2], this.value[3]);\n\t\t\t\tconst aV1 = AnimTargetValue.q2.set(this.baseValue[0], this.baseValue[1], this.baseValue[2], this.baseValue[3]);\n\t\t\t\tconst aV2 = AnimTargetValue.q3.set(value[0], value[1], value[2], value[3]);\n\t\t\t\tconst aV = aV1.invert().mul(aV2);\n\t\t\t\taV.slerp(Quat.IDENTITY, aV, this.getWeight(index));\n\t\t\t\tv.mul(aV);\n\t\t\t\tAnimTargetValue.quatArr[0] = v.x;\n\t\t\t\tAnimTargetValue.quatArr[1] = v.y;\n\t\t\t\tAnimTargetValue.quatArr[2] = v.z;\n\t\t\t\tAnimTargetValue.quatArr[3] = v.w;\n\t\t\t\tAnimBlend.set(this.value, AnimTargetValue.quatArr, this.valueType);\n\t\t\t} else {\n\t\t\t\tAnimTargetValue.vecArr[0] = value[0] - this.baseValue[0];\n\t\t\t\tAnimTargetValue.vecArr[1] = value[1] - this.baseValue[1];\n\t\t\t\tAnimTargetValue.vecArr[2] = value[2] - this.baseValue[2];\n\t\t\t\tAnimBlend.blend(this.value, AnimTargetValue.vecArr, this.getWeight(index), this.valueType, true);\n\t\t\t}\n\t\t} else {\n\t\t\tAnimBlend.blend(this.value, value, this.getWeight(index), this.valueType);\n\t\t}\n\t\tif (this.setter) this.setter(this.value);\n\t}\n\tunbind() {\n\t\tif (this.setter) {\n\t\t\tthis.setter(this.baseValue);\n\t\t}\n\t}\n}\nAnimTargetValue.TYPE_QUAT = 'quaternion';\nAnimTargetValue.TYPE_VEC3 = 'vector3';\nAnimTargetValue.q1 = new Quat();\nAnimTargetValue.q2 = new Quat();\nAnimTargetValue.q3 = new Quat();\nAnimTargetValue.quatArr = [0, 0, 0, 1];\nAnimTargetValue.vecArr = [0, 0, 0];\nAnimTargetValue.IDENTITY_QUAT_ARR = [0, 0, 0, 1];\n\nexport { AnimTargetValue };\n","import { AnimTargetValue } from './anim-target-value.js';\nimport { AnimBlend } from './anim-blend.js';\n\nclass AnimEvaluator {\n\tconstructor(binder) {\n\t\tthis._binder = binder;\n\t\tthis._clips = [];\n\t\tthis._inputs = [];\n\t\tthis._outputs = [];\n\t\tthis._targets = {};\n\t}\n\tget clips() {\n\t\treturn this._clips;\n\t}\n\taddClip(clip) {\n\t\tconst targets = this._targets;\n\t\tconst binder = this._binder;\n\t\tconst curves = clip.track.curves;\n\t\tconst snapshot = clip.snapshot;\n\t\tconst inputs = [];\n\t\tconst outputs = [];\n\t\tfor (let i = 0; i < curves.length; ++i) {\n\t\t\tconst curve = curves[i];\n\t\t\tconst paths = curve.paths;\n\t\t\tfor (let j = 0; j < paths.length; ++j) {\n\t\t\t\tconst path = paths[j];\n\t\t\t\tconst resolved = binder.resolve(path);\n\t\t\t\tlet target = targets[resolved && resolved.targetPath || null];\n\t\t\t\tif (!target && resolved) {\n\t\t\t\t\ttarget = {\n\t\t\t\t\t\ttarget: resolved,\n\t\t\t\t\t\tvalue: [],\n\t\t\t\t\t\tcurves: 0,\n\t\t\t\t\t\tblendCounter: 0\n\t\t\t\t\t};\n\t\t\t\t\tfor (let k = 0; k < target.target.components; ++k) {\n\t\t\t\t\t\ttarget.value.push(0);\n\t\t\t\t\t}\n\t\t\t\t\ttargets[resolved.targetPath] = target;\n\t\t\t\t\tif (binder.animComponent) {\n\t\t\t\t\t\tif (!binder.animComponent.targets[resolved.targetPath]) {\n\t\t\t\t\t\t\tlet type;\n\t\t\t\t\t\t\tif (resolved.targetPath.substring(resolved.targetPath.length - 13) === 'localRotation') {\n\t\t\t\t\t\t\t\ttype = AnimTargetValue.TYPE_QUAT;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\ttype = AnimTargetValue.TYPE_VEC3;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbinder.animComponent.targets[resolved.targetPath] = new AnimTargetValue(binder.animComponent, type);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbinder.animComponent.targets[resolved.targetPath].layerCounter++;\n\t\t\t\t\t\tbinder.animComponent.targets[resolved.targetPath].setMask(binder.layerIndex, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (target) {\n\t\t\t\t\ttarget.curves++;\n\t\t\t\t\tinputs.push(snapshot._results[i]);\n\t\t\t\t\toutputs.push(target);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis._clips.push(clip);\n\t\tthis._inputs.push(inputs);\n\t\tthis._outputs.push(outputs);\n\t}\n\tremoveClip(index) {\n\t\tconst targets = this._targets;\n\t\tconst binder = this._binder;\n\t\tconst clips = this._clips;\n\t\tconst clip = clips[index];\n\t\tconst curves = clip.track.curves;\n\t\tfor (let i = 0; i < curves.length; ++i) {\n\t\t\tconst curve = curves[i];\n\t\t\tconst paths = curve.paths;\n\t\t\tfor (let j = 0; j < paths.length; ++j) {\n\t\t\t\tconst path = paths[j];\n\t\t\t\tconst target = this._binder.resolve(path);\n\t\t\t\tif (target) {\n\t\t\t\t\ttarget.curves--;\n\t\t\t\t\tif (target.curves === 0) {\n\t\t\t\t\t\tbinder.unresolve(path);\n\t\t\t\t\t\tdelete targets[target.targetPath];\n\t\t\t\t\t\tif (binder.animComponent) {\n\t\t\t\t\t\t\tbinder.animComponent.targets[target.targetPath].layerCounter--;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tclips.splice(index, 1);\n\t\tthis._inputs.splice(index, 1);\n\t\tthis._outputs.splice(index, 1);\n\t}\n\tremoveClips() {\n\t\twhile (this._clips.length > 0) {\n\t\t\tthis.removeClip(0);\n\t\t}\n\t}\n\tupdateClipTrack(name, animTrack) {\n\t\tthis._clips.forEach(clip => {\n\t\t\tif (clip.name.includes(name)) {\n\t\t\t\tclip.track = animTrack;\n\t\t\t}\n\t\t});\n\t\tthis.rebind();\n\t}\n\tfindClip(name) {\n\t\tconst clips = this._clips;\n\t\tfor (let i = 0; i < clips.length; ++i) {\n\t\t\tconst clip = clips[i];\n\t\t\tif (clip.name === name) {\n\t\t\t\treturn clip;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\trebind() {\n\t\tthis._binder.rebind();\n\t\tthis._targets = {};\n\t\tconst clips = [...this.clips];\n\t\tthis.removeClips();\n\t\tclips.forEach(clip => {\n\t\t\tthis.addClip(clip);\n\t\t});\n\t}\n\tassignMask(mask) {\n\t\treturn this._binder.assignMask(mask);\n\t}\n\tupdate(deltaTime, outputAnimation = true) {\n\t\tconst clips = this._clips;\n\t\tconst order = clips.map(function (c, i) {\n\t\t\treturn i;\n\t\t});\n\t\tAnimBlend.stableSort(order, function (a, b) {\n\t\t\treturn clips[a].blendOrder < clips[b].blendOrder;\n\t\t});\n\t\tfor (let i = 0; i < order.length; ++i) {\n\t\t\tconst index = order[i];\n\t\t\tconst clip = clips[index];\n\t\t\tconst inputs = this._inputs[index];\n\t\t\tconst outputs = this._outputs[index];\n\t\t\tconst blendWeight = clip.blendWeight;\n\t\t\tif (blendWeight > 0.0) {\n\t\t\t\tclip._update(deltaTime);\n\t\t\t}\n\t\t\tif (!outputAnimation) break;\n\t\t\tlet input;\n\t\t\tlet output;\n\t\t\tlet value;\n\t\t\tif (blendWeight >= 1.0) {\n\t\t\t\tfor (let j = 0; j < inputs.length; ++j) {\n\t\t\t\t\tinput = inputs[j];\n\t\t\t\t\toutput = outputs[j];\n\t\t\t\t\tvalue = output.value;\n\t\t\t\t\tAnimBlend.set(value, input, output.target.type);\n\t\t\t\t\toutput.blendCounter++;\n\t\t\t\t}\n\t\t\t} else if (blendWeight > 0.0) {\n\t\t\t\tfor (let j = 0; j < inputs.length; ++j) {\n\t\t\t\t\tinput = inputs[j];\n\t\t\t\t\toutput = outputs[j];\n\t\t\t\t\tvalue = output.value;\n\t\t\t\t\tif (output.blendCounter === 0) {\n\t\t\t\t\t\tAnimBlend.set(value, input, output.target.type);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tAnimBlend.blend(value, input, blendWeight, output.target.type);\n\t\t\t\t\t}\n\t\t\t\t\toutput.blendCounter++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst targets = this._targets;\n\t\tconst binder = this._binder;\n\t\tfor (const path in targets) {\n\t\t\tif (targets.hasOwnProperty(path)) {\n\t\t\t\tconst target = targets[path];\n\t\t\t\tif (binder.animComponent && target.target.isTransform) {\n\t\t\t\t\tconst animTarget = binder.animComponent.targets[path];\n\t\t\t\t\tif (animTarget.counter === animTarget.layerCounter) {\n\t\t\t\t\t\tanimTarget.counter = 0;\n\t\t\t\t\t}\n\t\t\t\t\tif (!animTarget.path) {\n\t\t\t\t\t\tanimTarget.path = path;\n\t\t\t\t\t\tanimTarget.baseValue = target.target.get();\n\t\t\t\t\t\tanimTarget.setter = target.target.set;\n\t\t\t\t\t}\n\t\t\t\t\tanimTarget.updateValue(binder.layerIndex, target.value);\n\t\t\t\t\tanimTarget.counter++;\n\t\t\t\t} else {\n\t\t\t\t\ttarget.target.set(target.value);\n\t\t\t\t}\n\t\t\t\ttarget.blendCounter = 0;\n\t\t\t}\n\t\t}\n\t\tthis._binder.update(deltaTime);\n\t}\n}\n\nexport { AnimEvaluator };\n","class AnimEvents {\n\tconstructor(events) {\n\t\tthis._events = [...events];\n\t\tthis._events.sort((a, b) => a.time - b.time);\n\t}\n\tget events() {\n\t\treturn this._events;\n\t}\n}\n\nexport { AnimEvents };\n","import { AnimEvents } from './anim-events.js';\n\nvar _class;\nclass AnimTrack {\n\tconstructor(name, duration, inputs, outputs, curves, animEvents = new AnimEvents([])) {\n\t\tthis._name = name;\n\t\tthis._duration = duration;\n\t\tthis._inputs = inputs;\n\t\tthis._outputs = outputs;\n\t\tthis._curves = curves;\n\t\tthis._animEvents = animEvents;\n\t}\n\tget name() {\n\t\treturn this._name;\n\t}\n\tget duration() {\n\t\treturn this._duration;\n\t}\n\tget inputs() {\n\t\treturn this._inputs;\n\t}\n\tget outputs() {\n\t\treturn this._outputs;\n\t}\n\tget curves() {\n\t\treturn this._curves;\n\t}\n\tset events(animEvents) {\n\t\tthis._animEvents = animEvents;\n\t}\n\tget events() {\n\t\treturn this._animEvents.events;\n\t}\n\teval(time, snapshot) {\n\t\tsnapshot._time = time;\n\t\tconst inputs = this._inputs;\n\t\tconst outputs = this._outputs;\n\t\tconst curves = this._curves;\n\t\tconst cache = snapshot._cache;\n\t\tconst results = snapshot._results;\n\t\tfor (let i = 0; i < inputs.length; ++i) {\n\t\t\tcache[i].update(time, inputs[i]._data);\n\t\t}\n\t\tfor (let i = 0; i < curves.length; ++i) {\n\t\t\tconst curve = curves[i];\n\t\t\tconst output = outputs[curve._output];\n\t\t\tconst result = results[i];\n\t\t\tcache[curve._input].eval(result, curve._interpolation, output);\n\t\t}\n\t}\n}\n_class = AnimTrack;\nAnimTrack.EMPTY = Object.freeze(new _class('empty', Number.MAX_VALUE, [], [], []));\n\nexport { AnimTrack };\n","class AnimBinder {\n\tstatic joinPath(pathSegments, character) {\n\t\tcharacter = character || '.';\n\t\tconst escape = function escape(string) {\n\t\t\treturn string.replace(/\\\\/g, '\\\\\\\\').replace(new RegExp('\\\\' + character, 'g'), '\\\\' + character);\n\t\t};\n\t\treturn pathSegments.map(escape).join(character);\n\t}\n\tstatic splitPath(path, character) {\n\t\tcharacter = character || '.';\n\t\tconst result = [];\n\t\tlet curr = \"\";\n\t\tlet i = 0;\n\t\twhile (i < path.length) {\n\t\t\tlet c = path[i++];\n\t\t\tif (c === '\\\\' && i < path.length) {\n\t\t\t\tc = path[i++];\n\t\t\t\tif (c === '\\\\' || c === character) {\n\t\t\t\t\tcurr += c;\n\t\t\t\t} else {\n\t\t\t\t\tcurr += '\\\\' + c;\n\t\t\t\t}\n\t\t\t} else if (c === character) {\n\t\t\t\tresult.push(curr);\n\t\t\t\tcurr = '';\n\t\t\t} else {\n\t\t\t\tcurr += c;\n\t\t\t}\n\t\t}\n\t\tif (curr.length > 0) {\n\t\t\tresult.push(curr);\n\t\t}\n\t\treturn result;\n\t}\n\tstatic encode(entityPath, component, propertyPath) {\n\t\treturn `${Array.isArray(entityPath) ? entityPath.join('/') : entityPath}/${component}/${Array.isArray(propertyPath) ? propertyPath.join('/') : propertyPath}`;\n\t}\n\tresolve(path) {\n\t\treturn null;\n\t}\n\tunresolve(path) {}\n\tupdate(deltaTime) {}\n}\n\nexport { AnimBinder };\n","class AnimTarget {\n\tconstructor(func, type, components, targetPath) {\n\t\tif (func.set) {\n\t\t\tthis._set = func.set;\n\t\t\tthis._get = func.get;\n\t\t} else {\n\t\t\tthis._set = func;\n\t\t}\n\t\tthis._type = type;\n\t\tthis._components = components;\n\t\tthis._targetPath = targetPath;\n\t\tthis._isTransform = this._targetPath.substring(this._targetPath.length - 13) === 'localRotation' || this._targetPath.substring(this._targetPath.length - 13) === 'localPosition' || this._targetPath.substring(this._targetPath.length - 10) === 'localScale';\n\t}\n\tget set() {\n\t\treturn this._set;\n\t}\n\tget get() {\n\t\treturn this._get;\n\t}\n\tget type() {\n\t\treturn this._type;\n\t}\n\tget components() {\n\t\treturn this._components;\n\t}\n\tget targetPath() {\n\t\treturn this._targetPath;\n\t}\n\tget isTransform() {\n\t\treturn this._isTransform;\n\t}\n}\n\nexport { AnimTarget };\n","import '../../../core/tracing.js';\nimport { AnimBinder } from './anim-binder.js';\nimport { AnimTarget } from '../evaluator/anim-target.js';\nimport { Entity } from '../../entity.js';\n\nclass DefaultAnimBinder {\n\tconstructor(graph) {\n\t\tthis._isPathInMask = (path, checkMaskValue) => {\n\t\t\tconst maskItem = this._mask[path];\n\t\t\tif (!maskItem) return false;else if (maskItem.children || checkMaskValue && maskItem.value !== false) return true;\n\t\t\treturn false;\n\t\t};\n\t\tthis.graph = graph;\n\t\tif (!graph) return;\n\t\tthis._mask = null;\n\t\tconst nodes = {};\n\t\tconst flatten = function flatten(node) {\n\t\t\tnodes[node.name] = node;\n\t\t\tfor (let i = 0; i < node.children.length; ++i) {\n\t\t\t\tflatten(node.children[i]);\n\t\t\t}\n\t\t};\n\t\tflatten(graph);\n\t\tthis.nodes = nodes;\n\t\tthis.targetCache = {};\n\t\tconst findMeshInstances = function findMeshInstances(node) {\n\t\t\tlet object = node;\n\t\t\twhile (object && !(object instanceof Entity)) {\n\t\t\t\tobject = object.parent;\n\t\t\t}\n\t\t\tlet meshInstances;\n\t\t\tif (object) {\n\t\t\t\tif (object.render) {\n\t\t\t\t\tmeshInstances = object.render.meshInstances;\n\t\t\t\t} else if (object.model) {\n\t\t\t\t\tmeshInstances = object.model.meshInstances;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn meshInstances;\n\t\t};\n\t\tthis.nodeCounts = {};\n\t\tthis.activeNodes = [];\n\t\tthis.handlers = {\n\t\t\t'localPosition': function (node) {\n\t\t\t\tconst object = node.localPosition;\n\t\t\t\tconst func = function func(value) {\n\t\t\t\t\tobject.set(...value);\n\t\t\t\t};\n\t\t\t\treturn DefaultAnimBinder.createAnimTarget(func, 'vector', 3, node, 'localPosition');\n\t\t\t},\n\t\t\t'localRotation': function (node) {\n\t\t\t\tconst object = node.localRotation;\n\t\t\t\tconst func = function func(value) {\n\t\t\t\t\tobject.set(...value);\n\t\t\t\t};\n\t\t\t\treturn DefaultAnimBinder.createAnimTarget(func, 'quaternion', 4, node, 'localRotation');\n\t\t\t},\n\t\t\t'localScale': function (node) {\n\t\t\t\tconst object = node.localScale;\n\t\t\t\tconst func = function func(value) {\n\t\t\t\t\tobject.set(...value);\n\t\t\t\t};\n\t\t\t\treturn DefaultAnimBinder.createAnimTarget(func, 'vector', 3, node, 'localScale');\n\t\t\t},\n\t\t\t'weight': function (node, weightName) {\n\t\t\t\tif (weightName.indexOf('name.') === 0) {\n\t\t\t\t\tweightName = weightName.replace('name.', '');\n\t\t\t\t} else {\n\t\t\t\t\tweightName = Number(weightName);\n\t\t\t\t}\n\t\t\t\tconst meshInstances = findMeshInstances(node);\n\t\t\t\tlet setters;\n\t\t\t\tif (meshInstances) {\n\t\t\t\t\tfor (let i = 0; i < meshInstances.length; ++i) {\n\t\t\t\t\t\tif (meshInstances[i].node.name === node.name && meshInstances[i].morphInstance) {\n\t\t\t\t\t\t\tconst morphInstance = meshInstances[i].morphInstance;\n\t\t\t\t\t\t\tconst func = value => {\n\t\t\t\t\t\t\t\tmorphInstance.setWeight(weightName, value[0]);\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tif (!setters) setters = [];\n\t\t\t\t\t\t\tsetters.push(func);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (setters) {\n\t\t\t\t\tconst callSetters = value => {\n\t\t\t\t\t\tfor (let i = 0; i < setters.length; ++i) {\n\t\t\t\t\t\t\tsetters[i](value);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\treturn DefaultAnimBinder.createAnimTarget(callSetters, 'number', 1, node, `weight.${weightName}`);\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t},\n\t\t\t'materialTexture': (node, textureName) => {\n\t\t\t\tconst meshInstances = findMeshInstances(node);\n\t\t\t\tif (meshInstances) {\n\t\t\t\t\tlet meshInstance;\n\t\t\t\t\tfor (let i = 0; i < meshInstances.length; ++i) {\n\t\t\t\t\t\tif (meshInstances[i].node.name === node.name) {\n\t\t\t\t\t\t\tmeshInstance = meshInstances[i];\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (meshInstance) {\n\t\t\t\t\t\tconst func = value => {\n\t\t\t\t\t\t\tconst textureAsset = this.animComponent.system.app.assets.get(value[0]);\n\t\t\t\t\t\t\tif (textureAsset && textureAsset.resource && textureAsset.type === 'texture') {\n\t\t\t\t\t\t\t\tmeshInstance.material[textureName] = textureAsset.resource;\n\t\t\t\t\t\t\t\tmeshInstance.material.update();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\treturn DefaultAnimBinder.createAnimTarget(func, 'vector', 1, node, 'materialTexture', 'material');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t};\n\t}\n\t_isPathActive(path) {\n\t\tif (!this._mask) return true;\n\t\tconst rootNodeNames = [path.entityPath[0], this.graph.name];\n\t\tfor (let j = 0; j < rootNodeNames.length; ++j) {\n\t\t\tlet currEntityPath = rootNodeNames[j];\n\t\t\tif (this._isPathInMask(currEntityPath, path.entityPath.length === 1)) return true;\n\t\t\tfor (let i = 1; i < path.entityPath.length; i++) {\n\t\t\t\tcurrEntityPath += '/' + path.entityPath[i];\n\t\t\t\tif (this._isPathInMask(currEntityPath, i === path.entityPath.length - 1)) return true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\tfindNode(path) {\n\t\tif (!this._isPathActive(path)) {\n\t\t\treturn null;\n\t\t}\n\t\tlet node;\n\t\tif (this.graph) {\n\t\t\tnode = this.graph.findByPath(path.entityPath);\n\t\t\tif (!node) {\n\t\t\t\tnode = this.graph.findByPath(path.entityPath.slice(1));\n\t\t\t}\n\t\t}\n\t\tif (!node) {\n\t\t\tnode = this.nodes[path.entityPath[path.entityPath.length - 1] || \"\"];\n\t\t}\n\t\treturn node;\n\t}\n\tstatic createAnimTarget(func, type, valueCount, node, propertyPath, componentType) {\n\t\tconst targetPath = AnimBinder.encode(node.path, componentType ? componentType : 'entity', propertyPath);\n\t\treturn new AnimTarget(func, type, valueCount, targetPath);\n\t}\n\tresolve(path) {\n\t\tconst encodedPath = AnimBinder.encode(path.entityPath, path.component, path.propertyPath);\n\t\tlet target = this.targetCache[encodedPath];\n\t\tif (target) return target;\n\t\tconst node = this.findNode(path);\n\t\tif (!node) {\n\t\t\treturn null;\n\t\t}\n\t\tconst handler = this.handlers[path.propertyPath];\n\t\tif (!handler) {\n\t\t\treturn null;\n\t\t}\n\t\ttarget = handler(node);\n\t\tif (!target) {\n\t\t\treturn null;\n\t\t}\n\t\tthis.targetCache[encodedPath] = target;\n\t\tif (!this.nodeCounts[node.path]) {\n\t\t\tthis.activeNodes.push(node);\n\t\t\tthis.nodeCounts[node.path] = 1;\n\t\t} else {\n\t\t\tthis.nodeCounts[node.path]++;\n\t\t}\n\t\treturn target;\n\t}\n\tunresolve(path) {\n\t\tif (path.component !== 'graph') return;\n\t\tconst node = this.nodes[path.entityPath[path.entityPath.length - 1] || \"\"];\n\t\tthis.nodeCounts[node.path]--;\n\t\tif (this.nodeCounts[node.path] === 0) {\n\t\t\tconst activeNodes = this.activeNodes;\n\t\t\tconst i = activeNodes.indexOf(node.node);\n\t\t\tconst len = activeNodes.length;\n\t\t\tif (i < len - 1) {\n\t\t\t\tactiveNodes[i] = activeNodes[len - 1];\n\t\t\t}\n\t\t\tactiveNodes.pop();\n\t\t}\n\t}\n\tupdate(deltaTime) {\n\t\tconst activeNodes = this.activeNodes;\n\t\tfor (let i = 0; i < activeNodes.length; ++i) {\n\t\t\tactiveNodes[i]._dirtifyLocal();\n\t\t}\n\t}\n\tassignMask(mask) {\n\t\tif (mask !== this._mask) {\n\t\t\tthis._mask = mask;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n}\n\nexport { DefaultAnimBinder };\n","import '../../../core/tracing.js';\nimport { AnimClip } from '../../anim/evaluator/anim-clip.js';\nimport { AnimEvaluator } from '../../anim/evaluator/anim-evaluator.js';\nimport { AnimTrack } from '../../anim/evaluator/anim-track.js';\nimport { DefaultAnimBinder } from '../../anim/binder/default-anim-binder.js';\nimport { Skeleton } from '../../../scene/animation/skeleton.js';\nimport { Asset } from '../../asset/asset.js';\nimport { Component } from '../component.js';\n\nclass AnimationComponent extends Component {\n\tconstructor(system, entity) {\n\t\tsuper(system, entity);\n\t\tthis._animations = {};\n\t\tthis._assets = [];\n\t\tthis._loop = true;\n\t\tthis.animEvaluator = null;\n\t\tthis.model = null;\n\t\tthis.skeleton = null;\n\t\tthis.fromSkel = null;\n\t\tthis.toSkel = null;\n\t\tthis.animationsIndex = {};\n\t\tthis.prevAnim = null;\n\t\tthis.currAnim = null;\n\t\tthis.blend = 0;\n\t\tthis.blending = false;\n\t\tthis.blendSpeed = 0;\n\t\tthis.activate = true;\n\t\tthis.speed = 1;\n\t}\n\tset animations(value) {\n\t\tthis._animations = value;\n\t\tthis.onSetAnimations();\n\t}\n\tget animations() {\n\t\treturn this._animations;\n\t}\n\tset assets(value) {\n\t\tconst assets = this._assets;\n\t\tif (assets && assets.length) {\n\t\t\tfor (let i = 0; i < assets.length; i++) {\n\t\t\t\tif (assets[i]) {\n\t\t\t\t\tconst asset = this.system.app.assets.get(assets[i]);\n\t\t\t\t\tif (asset) {\n\t\t\t\t\t\tasset.off('change', this.onAssetChanged, this);\n\t\t\t\t\t\tasset.off('remove', this.onAssetRemoved, this);\n\t\t\t\t\t\tconst animName = this.animationsIndex[asset.id];\n\t\t\t\t\t\tif (this.currAnim === animName) this._stopCurrentAnimation();\n\t\t\t\t\t\tdelete this.animations[animName];\n\t\t\t\t\t\tdelete this.animationsIndex[asset.id];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis._assets = value;\n\t\tconst assetIds = value.map(value => {\n\t\t\treturn value instanceof Asset ? value.id : value;\n\t\t});\n\t\tthis.loadAnimationAssets(assetIds);\n\t}\n\tget assets() {\n\t\treturn this._assets;\n\t}\n\tset currentTime(currentTime) {\n\t\tif (this.skeleton) {\n\t\t\tthis.skeleton.currentTime = currentTime;\n\t\t\tthis.skeleton.addTime(0);\n\t\t\tthis.skeleton.updateGraph();\n\t\t}\n\t\tif (this.animEvaluator) {\n\t\t\tconst clips = this.animEvaluator.clips;\n\t\t\tfor (let i = 0; i < clips.length; ++i) {\n\t\t\t\tclips[i].time = currentTime;\n\t\t\t}\n\t\t}\n\t}\n\tget currentTime() {\n\t\tif (this.skeleton) {\n\t\t\treturn this.skeleton._time;\n\t\t}\n\t\tif (this.animEvaluator) {\n\t\t\tconst clips = this.animEvaluator.clips;\n\t\t\tif (clips.length > 0) {\n\t\t\t\treturn clips[clips.length - 1].time;\n\t\t\t}\n\t\t}\n\t\treturn 0;\n\t}\n\tget duration() {\n\t\tif (this.currAnim) {\n\t\t\treturn this.animations[this.currAnim].duration;\n\t\t}\n\t\treturn 0;\n\t}\n\tset loop(value) {\n\t\tthis._loop = value;\n\t\tif (this.skeleton) {\n\t\t\tthis.skeleton.looping = value;\n\t\t}\n\t\tif (this.animEvaluator) {\n\t\t\tfor (let i = 0; i < this.animEvaluator.clips.length; ++i) {\n\t\t\t\tthis.animEvaluator.clips[i].loop = value;\n\t\t\t}\n\t\t}\n\t}\n\tget loop() {\n\t\treturn this._loop;\n\t}\n\tplay(name, blendTime = 0) {\n\t\tif (!this.enabled || !this.entity.enabled) {\n\t\t\treturn;\n\t\t}\n\t\tif (!this.animations[name]) {\n\t\t\treturn;\n\t\t}\n\t\tthis.prevAnim = this.currAnim;\n\t\tthis.currAnim = name;\n\t\tif (this.model) {\n\t\t\tif (!this.skeleton && !this.animEvaluator) {\n\t\t\t\tthis._createAnimationController();\n\t\t\t}\n\t\t\tconst prevAnim = this.animations[this.prevAnim];\n\t\t\tconst currAnim = this.animations[this.currAnim];\n\t\t\tthis.blending = blendTime > 0 && !!this.prevAnim;\n\t\t\tif (this.blending) {\n\t\t\t\tthis.blend = 0;\n\t\t\t\tthis.blendSpeed = 1 / blendTime;\n\t\t\t}\n\t\t\tif (this.skeleton) {\n\t\t\t\tif (this.blending) {\n\t\t\t\t\tthis.fromSkel.animation = prevAnim;\n\t\t\t\t\tthis.fromSkel.addTime(this.skeleton._time);\n\t\t\t\t\tthis.toSkel.animation = currAnim;\n\t\t\t\t} else {\n\t\t\t\t\tthis.skeleton.animation = currAnim;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.animEvaluator) {\n\t\t\t\tconst animEvaluator = this.animEvaluator;\n\t\t\t\tif (this.blending) {\n\t\t\t\t\twhile (animEvaluator.clips.length > 1) {\n\t\t\t\t\t\tanimEvaluator.removeClip(0);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.animEvaluator.removeClips();\n\t\t\t\t}\n\t\t\t\tconst clip = new AnimClip(this.animations[this.currAnim], 0, 1.0, true, this.loop);\n\t\t\t\tclip.name = this.currAnim;\n\t\t\t\tclip.blendWeight = this.blending ? 0 : 1;\n\t\t\t\tclip.reset();\n\t\t\t\tthis.animEvaluator.addClip(clip);\n\t\t\t}\n\t\t}\n\t\tthis.playing = true;\n\t}\n\tgetAnimation(name) {\n\t\treturn this.animations[name];\n\t}\n\tsetModel(model) {\n\t\tif (model !== this.model) {\n\t\t\tthis._resetAnimationController();\n\t\t\tthis.model = model;\n\t\t\tif (this.animations && this.currAnim && this.animations[this.currAnim]) {\n\t\t\t\tthis.play(this.currAnim);\n\t\t\t}\n\t\t}\n\t}\n\tonSetAnimations() {\n\t\tconst modelComponent = this.entity.model;\n\t\tif (modelComponent) {\n\t\t\tconst m = modelComponent.model;\n\t\t\tif (m && m !== this.model) {\n\t\t\t\tthis.setModel(m);\n\t\t\t}\n\t\t}\n\t\tif (!this.currAnim && this.activate && this.enabled && this.entity.enabled) {\n\t\t\tconst animationNames = Object.keys(this._animations);\n\t\t\tif (animationNames.length > 0) {\n\t\t\t\tthis.play(animationNames[0]);\n\t\t\t}\n\t\t}\n\t}\n\t_resetAnimationController() {\n\t\tthis.skeleton = null;\n\t\tthis.fromSkel = null;\n\t\tthis.toSkel = null;\n\t\tthis.animEvaluator = null;\n\t}\n\t_createAnimationController() {\n\t\tconst model = this.model;\n\t\tconst animations = this.animations;\n\t\tlet hasJson = false;\n\t\tlet hasGlb = false;\n\t\tfor (const animation in animations) {\n\t\t\tif (animations.hasOwnProperty(animation)) {\n\t\t\t\tconst anim = animations[animation];\n\t\t\t\tif (anim.constructor === AnimTrack) {\n\t\t\t\t\thasGlb = true;\n\t\t\t\t} else {\n\t\t\t\t\thasJson = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst graph = model.getGraph();\n\t\tif (hasJson) {\n\t\t\tthis.fromSkel = new Skeleton(graph);\n\t\t\tthis.toSkel = new Skeleton(graph);\n\t\t\tthis.skeleton = new Skeleton(graph);\n\t\t\tthis.skeleton.looping = this.loop;\n\t\t\tthis.skeleton.setGraph(graph);\n\t\t} else if (hasGlb) {\n\t\t\tthis.animEvaluator = new AnimEvaluator(new DefaultAnimBinder(this.entity));\n\t\t}\n\t}\n\tloadAnimationAssets(ids) {\n\t\tif (!ids || !ids.length) return;\n\t\tconst assets = this.system.app.assets;\n\t\tconst onAssetReady = asset => {\n\t\t\tif (asset.resources.length > 1) {\n\t\t\t\tfor (let i = 0; i < asset.resources.length; i++) {\n\t\t\t\t\tthis.animations[asset.resources[i].name] = asset.resources[i];\n\t\t\t\t\tthis.animationsIndex[asset.id] = asset.resources[i].name;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.animations[asset.name] = asset.resource;\n\t\t\t\tthis.animationsIndex[asset.id] = asset.name;\n\t\t\t}\n\t\t\tthis.animations = this.animations;\n\t\t};\n\t\tconst onAssetAdd = asset => {\n\t\t\tasset.off('change', this.onAssetChanged, this);\n\t\t\tasset.on('change', this.onAssetChanged, this);\n\t\t\tasset.off('remove', this.onAssetRemoved, this);\n\t\t\tasset.on('remove', this.onAssetRemoved, this);\n\t\t\tif (asset.resource) {\n\t\t\t\tonAssetReady(asset);\n\t\t\t} else {\n\t\t\t\tasset.once('load', onAssetReady, this);\n\t\t\t\tif (this.enabled && this.entity.enabled) assets.load(asset);\n\t\t\t}\n\t\t};\n\t\tfor (let i = 0, l = ids.length; i < l; i++) {\n\t\t\tconst asset = assets.get(ids[i]);\n\t\t\tif (asset) {\n\t\t\t\tonAssetAdd(asset);\n\t\t\t} else {\n\t\t\t\tassets.on('add:' + ids[i], onAssetAdd);\n\t\t\t}\n\t\t}\n\t}\n\tonAssetChanged(asset, attribute, newValue, oldValue) {\n\t\tif (attribute === 'resource' || attribute === 'resources') {\n\t\t\tif (attribute === 'resources' && newValue && newValue.length === 0) {\n\t\t\t\tnewValue = null;\n\t\t\t}\n\t\t\tif (newValue) {\n\t\t\t\tlet restarted = false;\n\t\t\t\tif (newValue.length > 1) {\n\t\t\t\t\tif (oldValue && oldValue.length > 1) {\n\t\t\t\t\t\tfor (let i = 0; i < oldValue.length; i++) {\n\t\t\t\t\t\t\tdelete this.animations[oldValue[i].name];\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdelete this.animations[asset.name];\n\t\t\t\t\t}\n\t\t\t\t\trestarted = false;\n\t\t\t\t\tfor (let i = 0; i < newValue.length; i++) {\n\t\t\t\t\t\tthis.animations[newValue[i].name] = newValue[i];\n\t\t\t\t\t\tif (!restarted && this.currAnim === newValue[i].name) {\n\t\t\t\t\t\t\tif (this.playing && this.enabled && this.entity.enabled) {\n\t\t\t\t\t\t\t\trestarted = true;\n\t\t\t\t\t\t\t\tthis.play(newValue[i].name);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (!restarted) {\n\t\t\t\t\t\tthis._stopCurrentAnimation();\n\t\t\t\t\t\tthis.onSetAnimations();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (oldValue && oldValue.length > 1) {\n\t\t\t\t\t\tfor (let i = 0; i < oldValue.length; i++) {\n\t\t\t\t\t\t\tdelete this.animations[oldValue[i].name];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.animations[asset.name] = newValue[0] || newValue;\n\t\t\t\t\trestarted = false;\n\t\t\t\t\tif (this.currAnim === asset.name) {\n\t\t\t\t\t\tif (this.playing && this.enabled && this.entity.enabled) {\n\t\t\t\t\t\t\trestarted = true;\n\t\t\t\t\t\t\tthis.play(asset.name);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (!restarted) {\n\t\t\t\t\t\tthis._stopCurrentAnimation();\n\t\t\t\t\t\tthis.onSetAnimations();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.animationsIndex[asset.id] = asset.name;\n\t\t\t} else {\n\t\t\t\tif (oldValue.length > 1) {\n\t\t\t\t\tfor (let i = 0; i < oldValue.length; i++) {\n\t\t\t\t\t\tdelete this.animations[oldValue[i].name];\n\t\t\t\t\t\tif (this.currAnim === oldValue[i].name) {\n\t\t\t\t\t\t\tthis._stopCurrentAnimation();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tdelete this.animations[asset.name];\n\t\t\t\t\tif (this.currAnim === asset.name) {\n\t\t\t\t\t\tthis._stopCurrentAnimation();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tdelete this.animationsIndex[asset.id];\n\t\t\t}\n\t\t}\n\t}\n\tonAssetRemoved(asset) {\n\t\tasset.off('remove', this.onAssetRemoved, this);\n\t\tif (this.animations) {\n\t\t\tif (asset.resources.length > 1) {\n\t\t\t\tfor (let i = 0; i < asset.resources.length; i++) {\n\t\t\t\t\tdelete this.animations[asset.resources[i].name];\n\t\t\t\t\tif (this.currAnim === asset.resources[i].name) this._stopCurrentAnimation();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tdelete this.animations[asset.name];\n\t\t\t\tif (this.currAnim === asset.name) this._stopCurrentAnimation();\n\t\t\t}\n\t\t\tdelete this.animationsIndex[asset.id];\n\t\t}\n\t}\n\t_stopCurrentAnimation() {\n\t\tthis.currAnim = null;\n\t\tthis.playing = false;\n\t\tif (this.skeleton) {\n\t\t\tthis.skeleton.currentTime = 0;\n\t\t\tthis.skeleton.animation = null;\n\t\t}\n\t\tif (this.animEvaluator) {\n\t\t\tfor (let i = 0; i < this.animEvaluator.clips.length; ++i) {\n\t\t\t\tthis.animEvaluator.clips[i].stop();\n\t\t\t}\n\t\t\tthis.animEvaluator.update(0);\n\t\t\tthis.animEvaluator.removeClips();\n\t\t}\n\t}\n\tonEnable() {\n\t\tsuper.onEnable();\n\t\tconst assets = this.assets;\n\t\tconst registry = this.system.app.assets;\n\t\tif (assets) {\n\t\t\tfor (let i = 0, len = assets.length; i < len; i++) {\n\t\t\t\tlet asset = assets[i];\n\t\t\t\tif (!(asset instanceof Asset)) asset = registry.get(asset);\n\t\t\t\tif (asset && !asset.resource) registry.load(asset);\n\t\t\t}\n\t\t}\n\t\tif (this.activate && !this.currAnim) {\n\t\t\tconst animationNames = Object.keys(this.animations);\n\t\t\tif (animationNames.length > 0) {\n\t\t\t\tthis.play(animationNames[0]);\n\t\t\t}\n\t\t}\n\t}\n\tonBeforeRemove() {\n\t\tfor (let i = 0; i < this.assets.length; i++) {\n\t\t\tlet asset = this.assets[i];\n\t\t\tif (typeof asset === 'number') {\n\t\t\t\tasset = this.system.app.assets.get(asset);\n\t\t\t}\n\t\t\tif (!asset) continue;\n\t\t\tasset.off('change', this.onAssetChanged, this);\n\t\t\tasset.off('remove', this.onAssetRemoved, this);\n\t\t}\n\t\tthis.skeleton = null;\n\t\tthis.fromSkel = null;\n\t\tthis.toSkel = null;\n\t\tthis.animEvaluator = null;\n\t}\n\tupdate(dt) {\n\t\tif (this.blending) {\n\t\t\tthis.blend += dt * this.blendSpeed;\n\t\t\tif (this.blend >= 1) {\n\t\t\t\tthis.blend = 1;\n\t\t\t}\n\t\t}\n\t\tif (this.playing) {\n\t\t\tconst skeleton = this.skeleton;\n\t\t\tif (skeleton !== null && this.model !== null) {\n\t\t\t\tif (this.blending) {\n\t\t\t\t\tskeleton.blend(this.fromSkel, this.toSkel, this.blend);\n\t\t\t\t} else {\n\t\t\t\t\tconst delta = dt * this.speed;\n\t\t\t\t\tskeleton.addTime(delta);\n\t\t\t\t\tif (this.speed > 0 && skeleton._time === skeleton.animation.duration && !this.loop) {\n\t\t\t\t\t\tthis.playing = false;\n\t\t\t\t\t} else if (this.speed < 0 && skeleton._time === 0 && !this.loop) {\n\t\t\t\t\t\tthis.playing = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (this.blending && this.blend === 1) {\n\t\t\t\t\tskeleton.animation = this.toSkel.animation;\n\t\t\t\t}\n\t\t\t\tskeleton.updateGraph();\n\t\t\t}\n\t\t}\n\t\tconst animEvaluator = this.animEvaluator;\n\t\tif (animEvaluator) {\n\t\t\tfor (let i = 0; i < animEvaluator.clips.length; ++i) {\n\t\t\t\tconst clip = animEvaluator.clips[i];\n\t\t\t\tclip.speed = this.speed;\n\t\t\t\tif (!this.playing) {\n\t\t\t\t\tclip.pause();\n\t\t\t\t} else {\n\t\t\t\t\tclip.resume();\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.blending && animEvaluator.clips.length > 1) {\n\t\t\t\tanimEvaluator.clips[1].blendWeight = this.blend;\n\t\t\t}\n\t\t\tanimEvaluator.update(dt);\n\t\t}\n\t\tif (this.blending && this.blend === 1) {\n\t\t\tthis.blending = false;\n\t\t}\n\t}\n}\n\nexport { AnimationComponent };\n","class AnimationComponentData {\n\tconstructor() {\n\t\tthis.enabled = true;\n\t}\n}\n\nexport { AnimationComponentData };\n","import { Component } from '../component.js';\nimport { ComponentSystem } from '../system.js';\nimport { AnimationComponent } from './component.js';\nimport { AnimationComponentData } from './data.js';\n\nconst _schema = ['enabled'];\nclass AnimationComponentSystem extends ComponentSystem {\n\tconstructor(app) {\n\t\tsuper(app);\n\t\tthis.id = 'animation';\n\t\tthis.ComponentType = AnimationComponent;\n\t\tthis.DataType = AnimationComponentData;\n\t\tthis.schema = _schema;\n\t\tthis.on('beforeremove', this.onBeforeRemove, this);\n\t\tthis.app.systems.on('update', this.onUpdate, this);\n\t}\n\tinitializeComponentData(component, data, properties) {\n\t\tproperties = ['activate', 'enabled', 'loop', 'speed', 'assets'];\n\t\tfor (const property of properties) {\n\t\t\tif (data.hasOwnProperty(property)) {\n\t\t\t\tcomponent[property] = data[property];\n\t\t\t}\n\t\t}\n\t\tsuper.initializeComponentData(component, data, _schema);\n\t}\n\tcloneComponent(entity, clone) {\n\t\tthis.addComponent(clone, {});\n\t\tclone.animation.assets = entity.animation.assets.slice();\n\t\tclone.animation.speed = entity.animation.speed;\n\t\tclone.animation.loop = entity.animation.loop;\n\t\tclone.animation.activate = entity.animation.activate;\n\t\tclone.animation.enabled = entity.animation.enabled;\n\t\tconst clonedAnimations = {};\n\t\tconst animations = entity.animation.animations;\n\t\tfor (const key in animations) {\n\t\t\tif (animations.hasOwnProperty(key)) {\n\t\t\t\tclonedAnimations[key] = animations[key];\n\t\t\t}\n\t\t}\n\t\tclone.animation.animations = clonedAnimations;\n\t\tconst clonedAnimationsIndex = {};\n\t\tconst animationsIndex = entity.animation.animationsIndex;\n\t\tfor (const key in animationsIndex) {\n\t\t\tif (animationsIndex.hasOwnProperty(key)) {\n\t\t\t\tclonedAnimationsIndex[key] = animationsIndex[key];\n\t\t\t}\n\t\t}\n\t\tclone.animation.animationsIndex = clonedAnimationsIndex;\n\t\treturn clone.animation;\n\t}\n\tonBeforeRemove(entity, component) {\n\t\tcomponent.onBeforeRemove();\n\t}\n\tonUpdate(dt) {\n\t\tconst components = this.store;\n\t\tfor (const id in components) {\n\t\t\tif (components.hasOwnProperty(id)) {\n\t\t\t\tconst component = components[id];\n\t\t\t\tif (component.data.enabled && component.entity.enabled) {\n\t\t\t\t\tcomponent.entity.animation.update(dt);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tdestroy() {\n\t\tsuper.destroy();\n\t\tthis.app.systems.off('update', this.onUpdate, this);\n\t}\n}\nComponent._buildAccessors(AnimationComponent.prototype, _schema);\n\nexport { AnimationComponentSystem };\n","import { Vec2 } from '../../../core/math/vec2.js';\n\nclass AnimNode {\n\tconstructor(state, parent, name, point, speed = 1) {\n\t\tthis._state = state;\n\t\tthis._parent = parent;\n\t\tthis._name = name;\n\t\tif (Array.isArray(point)) {\n\t\t\tthis._point = new Vec2(point[0], point[1]);\n\t\t\tthis._pointLength = this._point.length();\n\t\t} else {\n\t\t\tthis._point = point;\n\t\t\tthis._pointLength = point;\n\t\t}\n\t\tthis._speed = speed;\n\t\tthis._weightedSpeed = 1.0;\n\t\tthis._weight = 1.0;\n\t\tthis._animTrack = null;\n\t}\n\tget parent() {\n\t\treturn this._parent;\n\t}\n\tget name() {\n\t\treturn this._name;\n\t}\n\tget path() {\n\t\treturn this._parent ? this._parent.path + '.' + this._name : this._name;\n\t}\n\tget point() {\n\t\treturn this._point;\n\t}\n\tget pointLength() {\n\t\treturn this._pointLength;\n\t}\n\tset weight(value) {\n\t\tthis._weight = value;\n\t}\n\tget weight() {\n\t\treturn this._parent ? this._parent.weight * this._weight : this._weight;\n\t}\n\tget normalizedWeight() {\n\t\tconst totalWeight = this._state.totalWeight;\n\t\tif (totalWeight === 0.0) return 0.0;\n\t\treturn this.weight / totalWeight;\n\t}\n\tget speed() {\n\t\treturn this._weightedSpeed * this._speed;\n\t}\n\tget absoluteSpeed() {\n\t\treturn Math.abs(this._speed);\n\t}\n\tset weightedSpeed(weightedSpeed) {\n\t\tthis._weightedSpeed = weightedSpeed;\n\t}\n\tget weightedSpeed() {\n\t\treturn this._weightedSpeed;\n\t}\n\tset animTrack(value) {\n\t\tthis._animTrack = value;\n\t}\n\tget animTrack() {\n\t\treturn this._animTrack;\n\t}\n}\n\nexport { AnimNode };\n","import { AnimNode } from './anim-node.js';\n\nclass AnimBlendTree extends AnimNode {\n\tconstructor(state, parent, name, point, parameters, children, syncAnimations, createTree, findParameter) {\n\t\tsuper(state, parent, name, point);\n\t\tthis._parameters = parameters;\n\t\tthis._parameterValues = new Array(parameters.length);\n\t\tthis._children = [];\n\t\tthis._findParameter = findParameter;\n\t\tthis._syncAnimations = syncAnimations !== false;\n\t\tthis._pointCache = {};\n\t\tfor (let i = 0; i < children.length; i++) {\n\t\t\tconst child = children[i];\n\t\t\tif (child.children) {\n\t\t\t\tthis._children.push(createTree(child.type, this, null, name, 1.0, child.parameter ? [child.parameter] : child.parameters, child.children, createTree, findParameter));\n\t\t\t} else {\n\t\t\t\tthis._children.push(new AnimNode(state, this, child.name, child.point, child.speed));\n\t\t\t}\n\t\t}\n\t}\n\tget weight() {\n\t\tthis.calculateWeights();\n\t\treturn this._parent ? this._parent.weight * this._weight : this._weight;\n\t}\n\tget syncAnimations() {\n\t\treturn this._syncAnimations;\n\t}\n\tgetChild(name) {\n\t\tfor (let i = 0; i < this._children.length; i++) {\n\t\t\tif (this._children[i].name === name) return this._children[i];\n\t\t}\n\t\treturn null;\n\t}\n\tupdateParameterValues() {\n\t\tlet paramsEqual = true;\n\t\tfor (let i = 0; i < this._parameterValues.length; i++) {\n\t\t\tconst updatedParameter = this._findParameter(this._parameters[i]).value;\n\t\t\tif (this._parameterValues[i] !== updatedParameter) {\n\t\t\t\tthis._parameterValues[i] = updatedParameter;\n\t\t\t\tparamsEqual = false;\n\t\t\t}\n\t\t}\n\t\treturn paramsEqual;\n\t}\n\tgetNodeWeightedDuration(i) {\n\t\treturn this._children[i].animTrack.duration / this._children[i].speedMultiplier * this._children[i].weight;\n\t}\n\tgetNodeCount() {\n\t\tlet count = 0;\n\t\tfor (let i = 0; i < this._children.length; i++) {\n\t\t\tconst child = this._children[i];\n\t\t\tif (child.constructor === AnimBlendTree) {\n\t\t\t\tcount += this._children[i].getNodeCount();\n\t\t\t} else {\n\t\t\t\tcount++;\n\t\t\t}\n\t\t}\n\t\treturn count;\n\t}\n}\n\nexport { AnimBlendTree };\n","import { math } from '../../../core/math/math.js';\nimport { AnimBlendTree } from './anim-blend-tree.js';\n\nclass AnimBlendTree1D extends AnimBlendTree {\n\tconstructor(state, parent, name, point, parameters, children, syncAnimations, createTree, findParameter) {\n\t\tchildren.sort((a, b) => a.point - b.point);\n\t\tsuper(state, parent, name, point, parameters, children, syncAnimations, createTree, findParameter);\n\t}\n\tcalculateWeights() {\n\t\tif (this.updateParameterValues()) return;\n\t\tlet weightedDurationSum = 0.0;\n\t\tthis._children[0].weight = 0.0;\n\t\tfor (let i = 0; i < this._children.length; i++) {\n\t\t\tconst c1 = this._children[i];\n\t\t\tif (i !== this._children.length - 1) {\n\t\t\t\tconst c2 = this._children[i + 1];\n\t\t\t\tif (c1.point === c2.point) {\n\t\t\t\t\tc1.weight = 0.5;\n\t\t\t\t\tc2.weight = 0.5;\n\t\t\t\t} else if (math.between(this._parameterValues[0], c1.point, c2.point, true)) {\n\t\t\t\t\tconst child2Distance = Math.abs(c1.point - c2.point);\n\t\t\t\t\tconst parameterDistance = Math.abs(c1.point - this._parameterValues[0]);\n\t\t\t\t\tconst weight = (child2Distance - parameterDistance) / child2Distance;\n\t\t\t\t\tc1.weight = weight;\n\t\t\t\t\tc2.weight = 1.0 - weight;\n\t\t\t\t} else {\n\t\t\t\t\tc2.weight = 0.0;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this._syncAnimations) {\n\t\t\t\tweightedDurationSum += c1.animTrack.duration / c1.absoluteSpeed * c1.weight;\n\t\t\t}\n\t\t}\n\t\tif (this._syncAnimations) {\n\t\t\tfor (let i = 0; i < this._children.length; i++) {\n\t\t\t\tconst child = this._children[i];\n\t\t\t\tchild.weightedSpeed = child.animTrack.duration / child.absoluteSpeed / weightedDurationSum;\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport { AnimBlendTree1D };\n","import { Vec2 } from '../../../core/math/vec2.js';\nimport { math } from '../../../core/math/math.js';\nimport { AnimBlendTree } from './anim-blend-tree.js';\n\nclass AnimBlendTreeCartesian2D extends AnimBlendTree {\n\tpointDistanceCache(i, j) {\n\t\tconst pointKey = `${i}${j}`;\n\t\tif (!this._pointCache[pointKey]) {\n\t\t\tthis._pointCache[pointKey] = this._children[j].point.clone().sub(this._children[i].point);\n\t\t}\n\t\treturn this._pointCache[pointKey];\n\t}\n\tcalculateWeights() {\n\t\tif (this.updateParameterValues()) return;\n\t\tlet weightSum, weightedDurationSum;\n\t\tAnimBlendTreeCartesian2D._p.set(...this._parameterValues);\n\t\tweightSum = 0.0;\n\t\tweightedDurationSum = 0.0;\n\t\tfor (let i = 0; i < this._children.length; i++) {\n\t\t\tconst child = this._children[i];\n\t\t\tconst pi = child.point;\n\t\t\tAnimBlendTreeCartesian2D._pip.set(AnimBlendTreeCartesian2D._p.x, AnimBlendTreeCartesian2D._p.y).sub(pi);\n\t\t\tlet minj = Number.MAX_VALUE;\n\t\t\tfor (let j = 0; j < this._children.length; j++) {\n\t\t\t\tif (i === j) continue;\n\t\t\t\tconst pipj = this.pointDistanceCache(i, j);\n\t\t\t\tconst result = math.clamp(1.0 - AnimBlendTreeCartesian2D._pip.dot(pipj) / pipj.lengthSq(), 0.0, 1.0);\n\t\t\t\tif (result < minj) minj = result;\n\t\t\t}\n\t\t\tchild.weight = minj;\n\t\t\tweightSum += minj;\n\t\t\tif (this._syncAnimations) {\n\t\t\t\tweightedDurationSum += child.animTrack.duration / child.absoluteSpeed * child.weight;\n\t\t\t}\n\t\t}\n\t\tfor (let i = 0; i < this._children.length; i++) {\n\t\t\tconst child = this._children[i];\n\t\t\tchild.weight = child._weight / weightSum;\n\t\t\tif (this._syncAnimations) {\n\t\t\t\tchild.weightedSpeed = child.animTrack.duration / child.absoluteSpeed / weightedDurationSum;\n\t\t\t}\n\t\t}\n\t}\n}\nAnimBlendTreeCartesian2D._p = new Vec2();\nAnimBlendTreeCartesian2D._pip = new Vec2();\n\nexport { AnimBlendTreeCartesian2D };\n","import { Vec2 } from '../../../core/math/vec2.js';\nimport { math } from '../../../core/math/math.js';\nimport { AnimBlendTree } from './anim-blend-tree.js';\n\nclass AnimBlendTreeDirectional2D extends AnimBlendTree {\n\tpointCache(i, j) {\n\t\tconst pointKey = `${i}${j}`;\n\t\tif (!this._pointCache[pointKey]) {\n\t\t\tthis._pointCache[pointKey] = new Vec2((this._children[j].pointLength - this._children[i].pointLength) / ((this._children[j].pointLength + this._children[i].pointLength) / 2), Vec2.angleRad(this._children[i].point, this._children[j].point) * 2.0);\n\t\t}\n\t\treturn this._pointCache[pointKey];\n\t}\n\tcalculateWeights() {\n\t\tif (this.updateParameterValues()) return;\n\t\tlet weightSum, weightedDurationSum;\n\t\tAnimBlendTreeDirectional2D._p.set(...this._parameterValues);\n\t\tconst pLength = AnimBlendTreeDirectional2D._p.length();\n\t\tweightSum = 0.0;\n\t\tweightedDurationSum = 0.0;\n\t\tfor (let i = 0; i < this._children.length; i++) {\n\t\t\tconst child = this._children[i];\n\t\t\tconst pi = child.point;\n\t\t\tconst piLength = child.pointLength;\n\t\t\tlet minj = Number.MAX_VALUE;\n\t\t\tfor (let j = 0; j < this._children.length; j++) {\n\t\t\t\tif (i === j) continue;\n\t\t\t\tconst pipj = this.pointCache(i, j);\n\t\t\t\tconst pjLength = this._children[j].pointLength;\n\t\t\t\tAnimBlendTreeDirectional2D._pip.set((pLength - piLength) / ((pjLength + piLength) / 2), Vec2.angleRad(pi, AnimBlendTreeDirectional2D._p) * 2.0);\n\t\t\t\tconst result = math.clamp(1.0 - Math.abs(AnimBlendTreeDirectional2D._pip.dot(pipj) / pipj.lengthSq()), 0.0, 1.0);\n\t\t\t\tif (result < minj) minj = result;\n\t\t\t}\n\t\t\tchild.weight = minj;\n\t\t\tweightSum += minj;\n\t\t\tif (this._syncAnimations) {\n\t\t\t\tweightedDurationSum += child.animTrack.duration / child.absoluteSpeed * child.weight;\n\t\t\t}\n\t\t}\n\t\tfor (let i = 0; i < this._children.length; i++) {\n\t\t\tconst child = this._children[i];\n\t\t\tchild.weight = child._weight / weightSum;\n\t\t\tif (this._syncAnimations) {\n\t\t\t\tconst weightedChildDuration = child.animTrack.duration / weightedDurationSum * weightSum;\n\t\t\t\tchild.weightedSpeed = child.absoluteSpeed * weightedChildDuration;\n\t\t\t}\n\t\t}\n\t}\n}\nAnimBlendTreeDirectional2D._p = new Vec2();\nAnimBlendTreeDirectional2D._pip = new Vec2();\n\nexport { AnimBlendTreeDirectional2D };\n","import { AnimBlendTree } from './anim-blend-tree.js';\n\nclass AnimBlendTreeDirect extends AnimBlendTree {\n\tcalculateWeights() {\n\t\tif (this.updateParameterValues()) return;\n\t\tlet weightSum = 0.0;\n\t\tlet weightedDurationSum = 0.0;\n\t\tfor (let i = 0; i < this._children.length; i++) {\n\t\t\tweightSum += Math.max(this._parameterValues[i], 0.0);\n\t\t\tif (this._syncAnimations) {\n\t\t\t\tconst child = this._children[i];\n\t\t\t\tweightedDurationSum += child.animTrack.duration / child.absoluteSpeed * child.weight;\n\t\t\t}\n\t\t}\n\t\tfor (let i = 0; i < this._children.length; i++) {\n\t\t\tconst child = this._children[i];\n\t\t\tconst weight = Math.max(this._parameterValues[i], 0.0);\n\t\t\tif (weightSum) {\n\t\t\t\tchild.weight = weight / weightSum;\n\t\t\t\tif (this._syncAnimations) {\n\t\t\t\t\tchild.weightedSpeed = child.animTrack.duration / child.absoluteSpeed / weightedDurationSum;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tchild.weight = 0.0;\n\t\t\t\tif (this._syncAnimations) {\n\t\t\t\t\tchild.weightedSpeed = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport { AnimBlendTreeDirect };\n","import '../../../core/tracing.js';\nimport { AnimTrack } from '../evaluator/anim-track.js';\nimport { AnimBlendTree1D } from './anim-blend-tree-1d.js';\nimport { AnimBlendTreeCartesian2D } from './anim-blend-tree-2d-cartesian.js';\nimport { AnimBlendTreeDirectional2D } from './anim-blend-tree-2d-directional.js';\nimport { AnimBlendTreeDirect } from './anim-blend-tree-direct.js';\nimport { AnimNode } from './anim-node.js';\nimport { ANIM_BLEND_DIRECT, ANIM_BLEND_2D_DIRECTIONAL, ANIM_BLEND_2D_CARTESIAN, ANIM_BLEND_1D, ANIM_CONTROL_STATES } from './constants.js';\n\nclass AnimState {\n\tconstructor(controller, name, speed = 1, loop = true, blendTree) {\n\t\tthis._animations = {};\n\t\tthis._animationList = [];\n\t\tthis._controller = controller;\n\t\tthis._name = name;\n\t\tthis._speed = speed;\n\t\tthis._loop = loop;\n\t\tthis._hasAnimations = false;\n\t\tif (blendTree) {\n\t\t\tthis._blendTree = this._createTree(blendTree.type, this, null, name, 1.0, blendTree.parameter ? [blendTree.parameter] : blendTree.parameters, blendTree.children, blendTree.syncAnimations, this._createTree, this._controller.findParameter);\n\t\t} else {\n\t\t\tthis._blendTree = new AnimNode(this, null, name, 1.0, speed);\n\t\t}\n\t}\n\t_createTree(type, state, parent, name, point, parameters, children, syncAnimations, createTree, findParameter) {\n\t\tswitch (type) {\n\t\t\tcase ANIM_BLEND_1D:\n\t\t\t\treturn new AnimBlendTree1D(state, parent, name, point, parameters, children, syncAnimations, createTree, findParameter);\n\t\t\tcase ANIM_BLEND_2D_CARTESIAN:\n\t\t\t\treturn new AnimBlendTreeCartesian2D(state, parent, name, point, parameters, children, syncAnimations, createTree, findParameter);\n\t\t\tcase ANIM_BLEND_2D_DIRECTIONAL:\n\t\t\t\treturn new AnimBlendTreeDirectional2D(state, parent, name, point, parameters, children, syncAnimations, createTree, findParameter);\n\t\t\tcase ANIM_BLEND_DIRECT:\n\t\t\t\treturn new AnimBlendTreeDirect(state, parent, name, point, parameters, children, syncAnimations, createTree, findParameter);\n\t\t}\n\t\treturn undefined;\n\t}\n\t_getNodeFromPath(path) {\n\t\tlet currNode = this._blendTree;\n\t\tfor (let i = 1; i < path.length; i++) {\n\t\t\tcurrNode = currNode.getChild(path[i]);\n\t\t}\n\t\treturn currNode;\n\t}\n\taddAnimation(path, animTrack) {\n\t\tconst pathString = path.join('.');\n\t\tconst indexOfAnimation = this._animationList.findIndex(function (animation) {\n\t\t\treturn animation.path === pathString;\n\t\t});\n\t\tif (indexOfAnimation >= 0) {\n\t\t\tthis._animationList[indexOfAnimation].animTrack = animTrack;\n\t\t} else {\n\t\t\tconst node = this._getNodeFromPath(path);\n\t\t\tnode.animTrack = animTrack;\n\t\t\tthis._animationList.push(node);\n\t\t}\n\t\tthis._updateHasAnimations();\n\t}\n\t_updateHasAnimations() {\n\t\tthis._hasAnimations = this._animationList.length > 0 && this._animationList.every(animation => animation.animTrack && animation.animTrack !== AnimTrack.EMPTY);\n\t}\n\tget name() {\n\t\treturn this._name;\n\t}\n\tset animations(value) {\n\t\tthis._animationList = value;\n\t\tthis._updateHasAnimations();\n\t}\n\tget animations() {\n\t\treturn this._animationList;\n\t}\n\tget hasAnimations() {\n\t\treturn this._hasAnimations;\n\t}\n\tset speed(value) {\n\t\tthis._speed = value;\n\t}\n\tget speed() {\n\t\treturn this._speed;\n\t}\n\tset loop(value) {\n\t\tthis._loop = value;\n\t}\n\tget loop() {\n\t\treturn this._loop;\n\t}\n\tget nodeCount() {\n\t\tif (!this._blendTree || this._blendTree.constructor === AnimNode) return 1;\n\t\treturn this._blendTree.getNodeCount();\n\t}\n\tget playable() {\n\t\treturn ANIM_CONTROL_STATES.indexOf(this.name) !== -1 || this.animations.length === this.nodeCount;\n\t}\n\tget looping() {\n\t\tif (this.animations.length > 0) {\n\t\t\tconst trackClipName = this.name + '.' + this.animations[0].animTrack.name;\n\t\t\tconst trackClip = this._controller.animEvaluator.findClip(trackClipName);\n\t\t\tif (trackClip) {\n\t\t\t\treturn trackClip.loop;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\tget totalWeight() {\n\t\tlet sum = 0;\n\t\tfor (let i = 0; i < this.animations.length; i++) {\n\t\t\tsum += this.animations[i].weight;\n\t\t}\n\t\treturn sum;\n\t}\n\tget timelineDuration() {\n\t\tlet duration = 0;\n\t\tfor (let i = 0; i < this.animations.length; i++) {\n\t\t\tconst animation = this.animations[i];\n\t\t\tif (animation.animTrack.duration > duration) {\n\t\t\t\tduration = animation.animTrack.duration;\n\t\t\t}\n\t\t}\n\t\treturn duration;\n\t}\n}\n\nexport { AnimState };\n","import { ANIM_INTERRUPTION_NONE } from './constants.js';\n\nclass AnimTransition {\n\tconstructor({\n\t\tfrom,\n\t\tto,\n\t\ttime = 0,\n\t\tpriority = 0,\n\t\tconditions = [],\n\t\texitTime = null,\n\t\ttransitionOffset = null,\n\t\tinterruptionSource = ANIM_INTERRUPTION_NONE\n\t}) {\n\t\tthis._from = from;\n\t\tthis._to = to;\n\t\tthis._time = time;\n\t\tthis._priority = priority;\n\t\tthis._conditions = conditions;\n\t\tthis._exitTime = exitTime;\n\t\tthis._transitionOffset = transitionOffset;\n\t\tthis._interruptionSource = interruptionSource;\n\t}\n\tget from() {\n\t\treturn this._from;\n\t}\n\tset to(value) {\n\t\tthis._to = value;\n\t}\n\tget to() {\n\t\treturn this._to;\n\t}\n\tget time() {\n\t\treturn this._time;\n\t}\n\tget priority() {\n\t\treturn this._priority;\n\t}\n\tget conditions() {\n\t\treturn this._conditions;\n\t}\n\tget exitTime() {\n\t\treturn this._exitTime;\n\t}\n\tget transitionOffset() {\n\t\treturn this._transitionOffset;\n\t}\n\tget interruptionSource() {\n\t\treturn this._interruptionSource;\n\t}\n\tget hasExitTime() {\n\t\treturn !!this.exitTime;\n\t}\n}\n\nexport { AnimTransition };\n","import { extends as _extends } from '../../../_virtual/_rollupPluginBabelHelpers.js';\nimport '../../../core/tracing.js';\nimport { sortPriority } from '../../../core/sort.js';\nimport { AnimClip } from '../evaluator/anim-clip.js';\nimport { AnimState } from './anim-state.js';\nimport { AnimNode } from './anim-node.js';\nimport { AnimTransition } from './anim-transition.js';\nimport { ANIM_STATE_START, ANIM_INTERRUPTION_NONE, ANIM_STATE_END, ANIM_STATE_ANY, ANIM_NOT_EQUAL_TO, ANIM_EQUAL_TO, ANIM_LESS_THAN_EQUAL_TO, ANIM_GREATER_THAN_EQUAL_TO, ANIM_LESS_THAN, ANIM_GREATER_THAN, ANIM_INTERRUPTION_NEXT_PREV, ANIM_INTERRUPTION_PREV_NEXT, ANIM_INTERRUPTION_NEXT, ANIM_INTERRUPTION_PREV, ANIM_PARAMETER_TRIGGER, ANIM_CONTROL_STATES } from './constants.js';\n\nclass AnimController {\n\tconstructor(animEvaluator, states, transitions, activate, eventHandler, findParameter, consumeTrigger) {\n\t\tthis.findParameter = name => {\n\t\t\treturn this._findParameter(name);\n\t\t};\n\t\tthis._animEvaluator = animEvaluator;\n\t\tthis._states = {};\n\t\tthis._stateNames = [];\n\t\tthis._eventHandler = eventHandler;\n\t\tthis._findParameter = findParameter;\n\t\tthis._consumeTrigger = consumeTrigger;\n\t\tfor (let i = 0; i < states.length; i++) {\n\t\t\tthis._states[states[i].name] = new AnimState(this, states[i].name, states[i].speed, states[i].loop, states[i].blendTree);\n\t\t\tthis._stateNames.push(states[i].name);\n\t\t}\n\t\tthis._transitions = transitions.map(transition => {\n\t\t\treturn new AnimTransition(_extends({}, transition));\n\t\t});\n\t\tthis._findTransitionsFromStateCache = {};\n\t\tthis._findTransitionsBetweenStatesCache = {};\n\t\tthis._previousStateName = null;\n\t\tthis._activeStateName = ANIM_STATE_START;\n\t\tthis._activeStateDuration = 0.0;\n\t\tthis._activeStateDurationDirty = true;\n\t\tthis._playing = false;\n\t\tthis._activate = activate;\n\t\tthis._currTransitionTime = 1.0;\n\t\tthis._totalTransitionTime = 1.0;\n\t\tthis._isTransitioning = false;\n\t\tthis._transitionInterruptionSource = ANIM_INTERRUPTION_NONE;\n\t\tthis._transitionPreviousStates = [];\n\t\tthis._timeInState = 0;\n\t\tthis._timeInStateBefore = 0;\n\t}\n\tget animEvaluator() {\n\t\treturn this._animEvaluator;\n\t}\n\tset activeState(stateName) {\n\t\tthis._activeStateName = stateName;\n\t}\n\tget activeState() {\n\t\treturn this._findState(this._activeStateName);\n\t}\n\tget activeStateName() {\n\t\treturn this._activeStateName;\n\t}\n\tget activeStateAnimations() {\n\t\treturn this.activeState.animations;\n\t}\n\tset previousState(stateName) {\n\t\tthis._previousStateName = stateName;\n\t}\n\tget previousState() {\n\t\treturn this._findState(this._previousStateName);\n\t}\n\tget previousStateName() {\n\t\treturn this._previousStateName;\n\t}\n\tget playable() {\n\t\tlet playable = true;\n\t\tfor (let i = 0; i < this._stateNames.length; i++) {\n\t\t\tif (!this._states[this._stateNames[i]].playable) {\n\t\t\t\tplayable = false;\n\t\t\t}\n\t\t}\n\t\treturn playable;\n\t}\n\tset playing(value) {\n\t\tthis._playing = value;\n\t}\n\tget playing() {\n\t\treturn this._playing;\n\t}\n\tget activeStateProgress() {\n\t\treturn this._getActiveStateProgressForTime(this._timeInState);\n\t}\n\tget activeStateDuration() {\n\t\tif (this._activeStateDurationDirty) {\n\t\t\tlet maxDuration = 0.0;\n\t\t\tfor (let i = 0; i < this.activeStateAnimations.length; i++) {\n\t\t\t\tconst activeClip = this._animEvaluator.findClip(this.activeStateAnimations[i].name);\n\t\t\t\tif (activeClip) {\n\t\t\t\t\tmaxDuration = Math.max(maxDuration, activeClip.track.duration);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._activeStateDuration = maxDuration;\n\t\t\tthis._activeStateDurationDirty = false;\n\t\t}\n\t\treturn this._activeStateDuration;\n\t}\n\tset activeStateCurrentTime(time) {\n\t\tthis._timeInStateBefore = time;\n\t\tthis._timeInState = time;\n\t\tfor (let i = 0; i < this.activeStateAnimations.length; i++) {\n\t\t\tconst clip = this.animEvaluator.findClip(this.activeStateAnimations[i].name);\n\t\t\tif (clip) {\n\t\t\t\tclip.time = time;\n\t\t\t}\n\t\t}\n\t}\n\tget activeStateCurrentTime() {\n\t\treturn this._timeInState;\n\t}\n\tget transitioning() {\n\t\treturn this._isTransitioning;\n\t}\n\tget transitionProgress() {\n\t\treturn this._currTransitionTime / this._totalTransitionTime;\n\t}\n\tget states() {\n\t\treturn this._stateNames;\n\t}\n\tassignMask(mask) {\n\t\treturn this._animEvaluator.assignMask(mask);\n\t}\n\t_findState(stateName) {\n\t\treturn this._states[stateName];\n\t}\n\t_getActiveStateProgressForTime(time) {\n\t\tif (this.activeStateName === ANIM_STATE_START || this.activeStateName === ANIM_STATE_END || this.activeStateName === ANIM_STATE_ANY) return 1.0;\n\t\tconst activeClip = this._animEvaluator.findClip(this.activeStateAnimations[0].name);\n\t\tif (activeClip) {\n\t\t\treturn activeClip.progressForTime(time);\n\t\t}\n\t\treturn null;\n\t}\n\t_findTransitionsFromState(stateName) {\n\t\tlet transitions = this._findTransitionsFromStateCache[stateName];\n\t\tif (!transitions) {\n\t\t\ttransitions = this._transitions.filter(function (transition) {\n\t\t\t\treturn transition.from === stateName;\n\t\t\t});\n\t\t\tsortPriority(transitions);\n\t\t\tthis._findTransitionsFromStateCache[stateName] = transitions;\n\t\t}\n\t\treturn transitions;\n\t}\n\t_findTransitionsBetweenStates(sourceStateName, destinationStateName) {\n\t\tlet transitions = this._findTransitionsBetweenStatesCache[sourceStateName + '->' + destinationStateName];\n\t\tif (!transitions) {\n\t\t\ttransitions = this._transitions.filter(function (transition) {\n\t\t\t\treturn transition.from === sourceStateName && transition.to === destinationStateName;\n\t\t\t});\n\t\t\tsortPriority(transitions);\n\t\t\tthis._findTransitionsBetweenStatesCache[sourceStateName + '->' + destinationStateName] = transitions;\n\t\t}\n\t\treturn transitions;\n\t}\n\t_transitionHasConditionsMet(transition) {\n\t\tconst conditions = transition.conditions;\n\t\tfor (let i = 0; i < conditions.length; i++) {\n\t\t\tconst condition = conditions[i];\n\t\t\tconst parameter = this._findParameter(condition.parameterName);\n\t\t\tswitch (condition.predicate) {\n\t\t\t\tcase ANIM_GREATER_THAN:\n\t\t\t\t\tif (!(parameter.value > condition.value)) return false;\n\t\t\t\t\tbreak;\n\t\t\t\tcase ANIM_LESS_THAN:\n\t\t\t\t\tif (!(parameter.value < condition.value)) return false;\n\t\t\t\t\tbreak;\n\t\t\t\tcase ANIM_GREATER_THAN_EQUAL_TO:\n\t\t\t\t\tif (!(parameter.value >= condition.value)) return false;\n\t\t\t\t\tbreak;\n\t\t\t\tcase ANIM_LESS_THAN_EQUAL_TO:\n\t\t\t\t\tif (!(parameter.value <= condition.value)) return false;\n\t\t\t\t\tbreak;\n\t\t\t\tcase ANIM_EQUAL_TO:\n\t\t\t\t\tif (!(parameter.value === condition.value)) return false;\n\t\t\t\t\tbreak;\n\t\t\t\tcase ANIM_NOT_EQUAL_TO:\n\t\t\t\t\tif (!(parameter.value !== condition.value)) return false;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\t_findTransition(from, to) {\n\t\tlet transitions = [];\n\t\tif (from && to) {\n\t\t\ttransitions = transitions.concat(this._findTransitionsBetweenStates(from, to));\n\t\t} else {\n\t\t\tif (!this._isTransitioning) {\n\t\t\t\ttransitions = transitions.concat(this._findTransitionsFromState(this._activeStateName));\n\t\t\t\ttransitions = transitions.concat(this._findTransitionsFromState(ANIM_STATE_ANY));\n\t\t\t} else {\n\t\t\t\tswitch (this._transitionInterruptionSource) {\n\t\t\t\t\tcase ANIM_INTERRUPTION_PREV:\n\t\t\t\t\t\ttransitions = transitions.concat(this._findTransitionsFromState(this._previousStateName));\n\t\t\t\t\t\ttransitions = transitions.concat(this._findTransitionsFromState(ANIM_STATE_ANY));\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase ANIM_INTERRUPTION_NEXT:\n\t\t\t\t\t\ttransitions = transitions.concat(this._findTransitionsFromState(this._activeStateName));\n\t\t\t\t\t\ttransitions = transitions.concat(this._findTransitionsFromState(ANIM_STATE_ANY));\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase ANIM_INTERRUPTION_PREV_NEXT:\n\t\t\t\t\t\ttransitions = transitions.concat(this._findTransitionsFromState(this._previousStateName));\n\t\t\t\t\t\ttransitions = transitions.concat(this._findTransitionsFromState(this._activeStateName));\n\t\t\t\t\t\ttransitions = transitions.concat(this._findTransitionsFromState(ANIM_STATE_ANY));\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase ANIM_INTERRUPTION_NEXT_PREV:\n\t\t\t\t\t\ttransitions = transitions.concat(this._findTransitionsFromState(this._activeStateName));\n\t\t\t\t\t\ttransitions = transitions.concat(this._findTransitionsFromState(this._previousStateName));\n\t\t\t\t\t\ttransitions = transitions.concat(this._findTransitionsFromState(ANIM_STATE_ANY));\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\ttransitions = transitions.filter(transition => {\n\t\t\tif (transition.to === this.activeStateName) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (transition.hasExitTime) {\n\t\t\t\tlet progressBefore = this._getActiveStateProgressForTime(this._timeInStateBefore);\n\t\t\t\tlet progress = this._getActiveStateProgressForTime(this._timeInState);\n\t\t\t\tif (transition.exitTime < 1.0 && this.activeState.loop) {\n\t\t\t\t\tprogressBefore -= Math.floor(progressBefore);\n\t\t\t\t\tprogress -= Math.floor(progress);\n\t\t\t\t}\n\t\t\t\tif (progress === progressBefore) {\n\t\t\t\t\tif (progress !== transition.exitTime) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t} else if (!(transition.exitTime > progressBefore && transition.exitTime <= progress)) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn this._transitionHasConditionsMet(transition);\n\t\t});\n\t\tif (transitions.length > 0) {\n\t\t\tconst transition = transitions[0];\n\t\t\tif (transition.to === ANIM_STATE_END) {\n\t\t\t\tconst startTransition = this._findTransitionsFromState(ANIM_STATE_START)[0];\n\t\t\t\ttransition.to = startTransition.to;\n\t\t\t}\n\t\t\treturn transition;\n\t\t}\n\t\treturn null;\n\t}\n\tupdateStateFromTransition(transition) {\n\t\tlet state;\n\t\tlet animation;\n\t\tlet clip;\n\t\tthis.previousState = transition.from ? this.activeStateName : null;\n\t\tthis.activeState = transition.to;\n\t\tthis._activeStateDurationDirty = true;\n\t\tfor (let i = 0; i < transition.conditions.length; i++) {\n\t\t\tconst condition = transition.conditions[i];\n\t\t\tconst parameter = this._findParameter(condition.parameterName);\n\t\t\tif (parameter.type === ANIM_PARAMETER_TRIGGER) {\n\t\t\t\tthis._consumeTrigger(condition.parameterName);\n\t\t\t}\n\t\t}\n\t\tif (this.previousState) {\n\t\t\tif (!this._isTransitioning) {\n\t\t\t\tthis._transitionPreviousStates = [];\n\t\t\t}\n\t\t\tthis._transitionPreviousStates.push({\n\t\t\t\tname: this._previousStateName,\n\t\t\t\tweight: 1\n\t\t\t});\n\t\t\tconst interpolatedTime = Math.min(this._totalTransitionTime !== 0 ? this._currTransitionTime / this._totalTransitionTime : 1, 1.0);\n\t\t\tfor (let i = 0; i < this._transitionPreviousStates.length; i++) {\n\t\t\t\tif (!this._isTransitioning) {\n\t\t\t\t\tthis._transitionPreviousStates[i].weight = 1.0;\n\t\t\t\t} else if (i !== this._transitionPreviousStates.length - 1) {\n\t\t\t\t\tthis._transitionPreviousStates[i].weight *= 1.0 - interpolatedTime;\n\t\t\t\t} else {\n\t\t\t\t\tthis._transitionPreviousStates[i].weight = interpolatedTime;\n\t\t\t\t}\n\t\t\t\tstate = this._findState(this._transitionPreviousStates[i].name);\n\t\t\t\tfor (let j = 0; j < state.animations.length; j++) {\n\t\t\t\t\tanimation = state.animations[j];\n\t\t\t\t\tclip = this._animEvaluator.findClip(animation.name + '.previous.' + i);\n\t\t\t\t\tif (!clip) {\n\t\t\t\t\t\tclip = this._animEvaluator.findClip(animation.name);\n\t\t\t\t\t\tclip.name = animation.name + '.previous.' + i;\n\t\t\t\t\t}\n\t\t\t\t\tif (i !== this._transitionPreviousStates.length - 1) {\n\t\t\t\t\t\tclip.pause();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis._isTransitioning = true;\n\t\tthis._totalTransitionTime = transition.time;\n\t\tthis._currTransitionTime = 0;\n\t\tthis._transitionInterruptionSource = transition.interruptionSource;\n\t\tconst activeState = this.activeState;\n\t\tconst hasTransitionOffset = transition.transitionOffset && transition.transitionOffset > 0.0 && transition.transitionOffset < 1.0;\n\t\tlet timeInState = 0;\n\t\tlet timeInStateBefore = 0;\n\t\tif (hasTransitionOffset) {\n\t\t\tconst offsetTime = activeState.timelineDuration * transition.transitionOffset;\n\t\t\ttimeInState = offsetTime;\n\t\t\ttimeInStateBefore = offsetTime;\n\t\t}\n\t\tthis._timeInState = timeInState;\n\t\tthis._timeInStateBefore = timeInStateBefore;\n\t\tfor (let i = 0; i < activeState.animations.length; i++) {\n\t\t\tclip = this._animEvaluator.findClip(activeState.animations[i].name);\n\t\t\tif (!clip) {\n\t\t\t\tconst speed = Number.isFinite(activeState.animations[i].speed) ? activeState.animations[i].speed : activeState.speed;\n\t\t\t\tclip = new AnimClip(activeState.animations[i].animTrack, this._timeInState, speed, true, activeState.loop, this._eventHandler);\n\t\t\t\tclip.name = activeState.animations[i].name;\n\t\t\t\tthis._animEvaluator.addClip(clip);\n\t\t\t} else {\n\t\t\t\tclip.reset();\n\t\t\t}\n\t\t\tif (transition.time > 0) {\n\t\t\t\tclip.blendWeight = 0.0;\n\t\t\t} else {\n\t\t\t\tclip.blendWeight = activeState.animations[i].normalizedWeight;\n\t\t\t}\n\t\t\tclip.play();\n\t\t\tif (hasTransitionOffset) {\n\t\t\t\tclip.time = activeState.timelineDuration * transition.transitionOffset;\n\t\t\t} else {\n\t\t\t\tconst startTime = activeState.speed >= 0 ? 0 : this.activeStateDuration;\n\t\t\t\tclip.time = startTime;\n\t\t\t}\n\t\t}\n\t}\n\t_transitionToState(newStateName) {\n\t\tif (!this._findState(newStateName)) {\n\t\t\treturn;\n\t\t}\n\t\tlet transition = this._findTransition(this._activeStateName, newStateName);\n\t\tif (!transition) {\n\t\t\tthis._animEvaluator.removeClips();\n\t\t\ttransition = new AnimTransition({\n\t\t\t\tfrom: null,\n\t\t\t\tto: newStateName\n\t\t\t});\n\t\t}\n\t\tthis.updateStateFromTransition(transition);\n\t}\n\tassignAnimation(pathString, animTrack, speed, loop) {\n\t\tconst path = pathString.split('.');\n\t\tlet state = this._findState(path[0]);\n\t\tif (!state) {\n\t\t\tstate = new AnimState(this, path[0], speed);\n\t\t\tthis._states[path[0]] = state;\n\t\t\tthis._stateNames.push(path[0]);\n\t\t}\n\t\tstate.addAnimation(path, animTrack);\n\t\tthis._animEvaluator.updateClipTrack(state.name, animTrack);\n\t\tif (speed !== undefined) {\n\t\t\tstate.speed = speed;\n\t\t}\n\t\tif (loop !== undefined) {\n\t\t\tstate.loop = loop;\n\t\t}\n\t\tif (!this._playing && this._activate && this.playable) {\n\t\t\tthis.play();\n\t\t}\n\t\tthis._activeStateDurationDirty = true;\n\t}\n\tremoveNodeAnimations(nodeName) {\n\t\tif (ANIM_CONTROL_STATES.indexOf(nodeName) !== -1) {\n\t\t\treturn false;\n\t\t}\n\t\tconst state = this._findState(nodeName);\n\t\tif (!state) {\n\t\t\treturn false;\n\t\t}\n\t\tstate.animations = [];\n\t\treturn true;\n\t}\n\tplay(stateName) {\n\t\tif (stateName) {\n\t\t\tthis._transitionToState(stateName);\n\t\t}\n\t\tthis._playing = true;\n\t}\n\tpause() {\n\t\tthis._playing = false;\n\t}\n\treset() {\n\t\tthis._previousStateName = null;\n\t\tthis._activeStateName = ANIM_STATE_START;\n\t\tthis._playing = false;\n\t\tthis._currTransitionTime = 1.0;\n\t\tthis._totalTransitionTime = 1.0;\n\t\tthis._isTransitioning = false;\n\t\tthis._timeInState = 0;\n\t\tthis._timeInStateBefore = 0;\n\t\tthis._animEvaluator.removeClips();\n\t}\n\trebind() {\n\t\tthis._animEvaluator.rebind();\n\t}\n\tupdate(dt) {\n\t\tif (!this._playing) {\n\t\t\treturn;\n\t\t}\n\t\tlet state;\n\t\tlet animation;\n\t\tlet clip;\n\t\tif (this.activeState.loop || this._timeInState < this.activeStateDuration) {\n\t\t\tthis._timeInStateBefore = this._timeInState;\n\t\t\tthis._timeInState += dt * this.activeState.speed;\n\t\t\tif (!this.activeState.loop && this._timeInState > this.activeStateDuration) {\n\t\t\t\tthis._timeInState = this.activeStateDuration;\n\t\t\t\tdt = this.activeStateDuration - this._timeInStateBefore;\n\t\t\t}\n\t\t}\n\t\tconst transition = this._findTransition(this._activeStateName);\n\t\tif (transition) this.updateStateFromTransition(transition);\n\t\tif (this._isTransitioning) {\n\t\t\tthis._currTransitionTime += dt;\n\t\t\tif (this._currTransitionTime <= this._totalTransitionTime) {\n\t\t\t\tconst interpolatedTime = this._totalTransitionTime !== 0 ? this._currTransitionTime / this._totalTransitionTime : 1;\n\t\t\t\tfor (let i = 0; i < this._transitionPreviousStates.length; i++) {\n\t\t\t\t\tstate = this._findState(this._transitionPreviousStates[i].name);\n\t\t\t\t\tconst stateWeight = this._transitionPreviousStates[i].weight;\n\t\t\t\t\tfor (let j = 0; j < state.animations.length; j++) {\n\t\t\t\t\t\tanimation = state.animations[j];\n\t\t\t\t\t\tclip = this._animEvaluator.findClip(animation.name + '.previous.' + i);\n\t\t\t\t\t\tif (clip) {\n\t\t\t\t\t\t\tclip.blendWeight = (1.0 - interpolatedTime) * animation.normalizedWeight * stateWeight;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tstate = this.activeState;\n\t\t\t\tfor (let i = 0; i < state.animations.length; i++) {\n\t\t\t\t\tanimation = state.animations[i];\n\t\t\t\t\tthis._animEvaluator.findClip(animation.name).blendWeight = interpolatedTime * animation.normalizedWeight;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._isTransitioning = false;\n\t\t\t\tconst activeClips = this.activeStateAnimations.length;\n\t\t\t\tconst totalClips = this._animEvaluator.clips.length;\n\t\t\t\tfor (let i = 0; i < totalClips - activeClips; i++) {\n\t\t\t\t\tthis._animEvaluator.removeClip(0);\n\t\t\t\t}\n\t\t\t\tthis._transitionPreviousStates = [];\n\t\t\t\tstate = this.activeState;\n\t\t\t\tfor (let i = 0; i < state.animations.length; i++) {\n\t\t\t\t\tanimation = state.animations[i];\n\t\t\t\t\tclip = this._animEvaluator.findClip(animation.name);\n\t\t\t\t\tif (clip) {\n\t\t\t\t\t\tclip.blendWeight = animation.normalizedWeight;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (this.activeState._blendTree.constructor !== AnimNode) {\n\t\t\t\tstate = this.activeState;\n\t\t\t\tfor (let i = 0; i < state.animations.length; i++) {\n\t\t\t\t\tanimation = state.animations[i];\n\t\t\t\t\tclip = this._animEvaluator.findClip(animation.name);\n\t\t\t\t\tif (clip) {\n\t\t\t\t\t\tclip.blendWeight = animation.normalizedWeight;\n\t\t\t\t\t\tif (animation.parent.syncAnimations) {\n\t\t\t\t\t\t\tclip.speed = animation.speed;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis._animEvaluator.update(dt, this.activeState.hasAnimations);\n\t}\n}\n\nexport { AnimController };\n","import { AnimTarget } from '../../anim/evaluator/anim-target.js';\nimport { DefaultAnimBinder } from '../../anim/binder/default-anim-binder.js';\nimport { AnimBinder } from '../../anim/binder/anim-binder.js';\nimport { Color } from '../../../core/math/color.js';\nimport { Quat } from '../../../core/math/quat.js';\nimport { Vec2 } from '../../../core/math/vec2.js';\nimport { Vec3 } from '../../../core/math/vec3.js';\nimport { Vec4 } from '../../../core/math/vec4.js';\n\nconst v2 = new Vec2();\nconst v3 = new Vec3();\nconst v4 = new Vec4();\nconst c = new Color();\nconst q = new Quat();\nclass AnimComponentBinder extends DefaultAnimBinder {\n\tconstructor(animComponent, graph, layerName, mask, layerIndex) {\n\t\tsuper(graph);\n\t\tthis.animComponent = animComponent;\n\t\tthis._mask = mask;\n\t\tthis.layerName = layerName;\n\t\tthis.layerIndex = layerIndex;\n\t}\n\tstatic _packFloat(values) {\n\t\treturn values[0];\n\t}\n\tstatic _packBoolean(values) {\n\t\treturn !!values[0];\n\t}\n\tstatic _packVec2(values) {\n\t\tv2.x = values[0];\n\t\tv2.y = values[1];\n\t\treturn v2;\n\t}\n\tstatic _packVec3(values) {\n\t\tv3.x = values[0];\n\t\tv3.y = values[1];\n\t\tv3.z = values[2];\n\t\treturn v3;\n\t}\n\tstatic _packVec4(values) {\n\t\tv4.x = values[0];\n\t\tv4.y = values[1];\n\t\tv4.z = values[2];\n\t\tv4.w = values[3];\n\t\treturn v4;\n\t}\n\tstatic _packColor(values) {\n\t\tc.r = values[0];\n\t\tc.g = values[1];\n\t\tc.b = values[2];\n\t\tc.a = values[3];\n\t\treturn c;\n\t}\n\tstatic _packQuat(values) {\n\t\tq.x = values[0];\n\t\tq.y = values[1];\n\t\tq.z = values[2];\n\t\tq.w = values[3];\n\t\treturn q;\n\t}\n\tresolve(path) {\n\t\tconst encodedPath = AnimBinder.encode(path.entityPath, path.component, path.propertyPath);\n\t\tlet target = this.targetCache[encodedPath];\n\t\tif (target) return target;\n\t\tlet entity;\n\t\tlet propertyComponent;\n\t\tlet targetPath;\n\t\tswitch (path.component) {\n\t\t\tcase 'entity':\n\t\t\t\tentity = this._getEntityFromHierarchy(path.entityPath);\n\t\t\t\ttargetPath = AnimBinder.encode(entity.path, 'entity', path.propertyPath);\n\t\t\t\tpropertyComponent = entity;\n\t\t\t\tbreak;\n\t\t\tcase 'graph':\n\t\t\t\tpropertyComponent = this.findNode(path);\n\t\t\t\tif (!propertyComponent) return null;\n\t\t\t\ttargetPath = AnimBinder.encode(propertyComponent.path, 'graph', path.propertyPath);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tentity = this._getEntityFromHierarchy(path.entityPath);\n\t\t\t\tpropertyComponent = entity.findComponent(path.component);\n\t\t\t\tif (!propertyComponent) return null;\n\t\t\t\ttargetPath = AnimBinder.encode(entity.path, path.component, path.propertyPath);\n\t\t\t\tbreak;\n\t\t}\n\t\ttarget = this._createAnimTargetForProperty(propertyComponent, path.propertyPath, targetPath);\n\t\tthis.targetCache[encodedPath] = target;\n\t\treturn target;\n\t}\n\tupdate(deltaTime) {\n\t\tconst activeNodes = this.activeNodes;\n\t\tif (activeNodes) {\n\t\t\tfor (let i = 0; i < activeNodes.length; i++) {\n\t\t\t\tactiveNodes[i]._dirtifyLocal();\n\t\t\t}\n\t\t}\n\t}\n\t_getEntityFromHierarchy(entityHierarchy) {\n\t\tif (!this.animComponent.entity.name === entityHierarchy[0]) {\n\t\t\treturn null;\n\t\t}\n\t\tconst currEntity = this.animComponent.entity;\n\t\tif (entityHierarchy.length === 1) {\n\t\t\treturn currEntity;\n\t\t}\n\t\treturn currEntity._parent.findByPath(entityHierarchy);\n\t}\n\t_resolvePath(object, path, resolveLeaf) {\n\t\tconst steps = path.length - (resolveLeaf ? 0 : 1);\n\t\tfor (let i = 0; i < steps; i++) {\n\t\t\tobject = object[path[i]];\n\t\t}\n\t\treturn object;\n\t}\n\t_setter(object, path, packFunc) {\n\t\tconst obj = this._resolvePath(object, path);\n\t\tconst key = path[path.length - 1];\n\t\tconst setterFuncName = 'set' + key.substring(0, 1).toUpperCase() + key.substring(1);\n\t\tif (obj[setterFuncName]) {\n\t\t\tconst getterFunc = obj['get' + key.substring(0, 1).toUpperCase() + key.substring(1)].bind(obj);\n\t\t\tlet baseValues = getterFunc();\n\t\t\tbaseValues = [baseValues.x, baseValues.y, baseValues.z, baseValues.w];\n\t\t\tconst setterFunc = obj[setterFuncName].bind(obj);\n\t\t\treturn {\n\t\t\t\tset: values => {\n\t\t\t\t\tsetterFunc(packFunc(values));\n\t\t\t\t},\n\t\t\t\tget: () => baseValues\n\t\t\t};\n\t\t}\n\t\tconst prop = obj[key];\n\t\tif (typeof prop === 'object' && prop.hasOwnProperty('copy')) {\n\t\t\treturn function (values) {\n\t\t\t\tprop.copy(packFunc(values));\n\t\t\t};\n\t\t}\n\t\tif ([Vec2, Vec3, Vec4, Color, Quat].indexOf(obj.constructor) !== -1 && path.length > 1) {\n\t\t\tconst parent = path.length > 2 ? this._resolvePath(object, path.slice(0, -1)) : object;\n\t\t\tconst objKey = path[path.length - 2];\n\t\t\treturn function (values) {\n\t\t\t\tobj[key] = packFunc(values);\n\t\t\t\tparent[objKey] = obj;\n\t\t\t};\n\t\t}\n\t\treturn function (values) {\n\t\t\tobj[key] = packFunc(values);\n\t\t};\n\t}\n\t_createAnimTargetForProperty(propertyComponent, propertyHierarchy, targetPath) {\n\t\tif (this.handlers && propertyHierarchy[0].startsWith('weight.')) {\n\t\t\treturn this.handlers.weight(propertyComponent, propertyHierarchy[0].replace('weight.', ''));\n\t\t} else if (this.handlers && propertyHierarchy[0] === 'material' && propertyHierarchy.length === 2) {\n\t\t\tconst materialPropertyName = propertyHierarchy[1];\n\t\t\tif (materialPropertyName.endsWith('Map')) {\n\t\t\t\treturn this.handlers.materialTexture(propertyComponent, materialPropertyName);\n\t\t\t}\n\t\t}\n\t\tconst property = this._resolvePath(propertyComponent, propertyHierarchy, true);\n\t\tif (typeof property === 'undefined') return null;\n\t\tlet setter;\n\t\tlet animDataType;\n\t\tlet animDataComponents;\n\t\tif (typeof property === 'number') {\n\t\t\tsetter = this._setter(propertyComponent, propertyHierarchy, AnimComponentBinder._packFloat);\n\t\t\tanimDataType = 'vector';\n\t\t\tanimDataComponents = 1;\n\t\t} else if (typeof property === 'boolean') {\n\t\t\tsetter = this._setter(propertyComponent, propertyHierarchy, AnimComponentBinder._packBoolean);\n\t\t\tanimDataType = 'vector';\n\t\t\tanimDataComponents = 1;\n\t\t} else if (typeof property === 'object') {\n\t\t\tswitch (property.constructor) {\n\t\t\t\tcase Vec2:\n\t\t\t\t\tsetter = this._setter(propertyComponent, propertyHierarchy, AnimComponentBinder._packVec2);\n\t\t\t\t\tanimDataType = 'vector';\n\t\t\t\t\tanimDataComponents = 2;\n\t\t\t\t\tbreak;\n\t\t\t\tcase Vec3:\n\t\t\t\t\tsetter = this._setter(propertyComponent, propertyHierarchy, AnimComponentBinder._packVec3);\n\t\t\t\t\tanimDataType = 'vector';\n\t\t\t\t\tanimDataComponents = 3;\n\t\t\t\t\tbreak;\n\t\t\t\tcase Vec4:\n\t\t\t\t\tsetter = this._setter(propertyComponent, propertyHierarchy, AnimComponentBinder._packVec4);\n\t\t\t\t\tanimDataType = 'vector';\n\t\t\t\t\tanimDataComponents = 4;\n\t\t\t\t\tbreak;\n\t\t\t\tcase Color:\n\t\t\t\t\tsetter = this._setter(propertyComponent, propertyHierarchy, AnimComponentBinder._packColor);\n\t\t\t\t\tanimDataType = 'vector';\n\t\t\t\t\tanimDataComponents = 4;\n\t\t\t\t\tbreak;\n\t\t\t\tcase Quat:\n\t\t\t\t\tsetter = this._setter(propertyComponent, propertyHierarchy, AnimComponentBinder._packQuat);\n\t\t\t\t\tanimDataType = 'quaternion';\n\t\t\t\t\tanimDataComponents = 4;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t\tif (propertyHierarchy.indexOf('material') !== -1) {\n\t\t\treturn new AnimTarget(function (values) {\n\t\t\t\tsetter(values);\n\t\t\t\tpropertyComponent.material.update();\n\t\t\t}, animDataType, animDataComponents, targetPath);\n\t\t}\n\t\treturn new AnimTarget(setter, animDataType, animDataComponents, targetPath);\n\t}\n\trebind() {\n\t\tthis.targetCache = {};\n\t\tif (this.animComponent.rootBone) {\n\t\t\tthis.graph = this.animComponent.rootBone;\n\t\t} else {\n\t\t\tthis.graph = this.animComponent.entity;\n\t\t}\n\t\tconst nodes = {};\n\t\tconst flatten = function flatten(node) {\n\t\t\tnodes[node.name] = node;\n\t\t\tfor (let i = 0; i < node.children.length; ++i) {\n\t\t\t\tflatten(node.children[i]);\n\t\t\t}\n\t\t};\n\t\tflatten(this.graph);\n\t\tthis.nodes = nodes;\n\t}\n}\n\nexport { AnimComponentBinder };\n","import '../../../core/tracing.js';\nimport { math } from '../../../core/math/math.js';\nimport { AnimTrack } from '../../anim/evaluator/anim-track.js';\nimport { AnimTransition } from '../../anim/controller/anim-transition.js';\nimport { ANIM_LAYER_OVERWRITE } from '../../anim/controller/constants.js';\n\nclass AnimComponentLayer {\n\tconstructor(name, controller, component, weight = 1, blendType = ANIM_LAYER_OVERWRITE, normalizedWeight = true) {\n\t\tthis._name = name;\n\t\tthis._controller = controller;\n\t\tthis._component = component;\n\t\tthis._weight = weight;\n\t\tthis._blendType = blendType;\n\t\tthis._normalizedWeight = normalizedWeight;\n\t\tthis._mask = null;\n\t\tthis._blendTime = 0;\n\t\tthis._blendTimeElapsed = 0;\n\t\tthis._startingWeight = 0;\n\t\tthis._targetWeight = 0;\n\t}\n\tget name() {\n\t\treturn this._name;\n\t}\n\tset playing(value) {\n\t\tthis._controller.playing = value;\n\t}\n\tget playing() {\n\t\treturn this._controller.playing;\n\t}\n\tget playable() {\n\t\treturn this._controller.playable;\n\t}\n\tget activeState() {\n\t\treturn this._controller.activeStateName;\n\t}\n\tget previousState() {\n\t\treturn this._controller.previousStateName;\n\t}\n\tget activeStateProgress() {\n\t\treturn this._controller.activeStateProgress;\n\t}\n\tget activeStateDuration() {\n\t\treturn this._controller.activeStateDuration;\n\t}\n\tset activeStateCurrentTime(time) {\n\t\tconst controller = this._controller;\n\t\tconst layerPlaying = controller.playing;\n\t\tcontroller.playing = true;\n\t\tcontroller.activeStateCurrentTime = time;\n\t\tif (!layerPlaying) {\n\t\t\tcontroller.update(0);\n\t\t}\n\t\tcontroller.playing = layerPlaying;\n\t}\n\tget activeStateCurrentTime() {\n\t\treturn this._controller.activeStateCurrentTime;\n\t}\n\tget transitioning() {\n\t\treturn this._controller.transitioning;\n\t}\n\tget transitionProgress() {\n\t\tif (this.transitioning) {\n\t\t\treturn this._controller.transitionProgress;\n\t\t}\n\t\treturn null;\n\t}\n\tget states() {\n\t\treturn this._controller.states;\n\t}\n\tset weight(value) {\n\t\tthis._weight = value;\n\t\tthis._component.dirtifyTargets();\n\t}\n\tget weight() {\n\t\treturn this._weight;\n\t}\n\tset blendType(value) {\n\t\tif (value !== this._blendType) {\n\t\t\tthis._blendType = value;\n\t\t\tif (this._controller.normalizeWeights) {\n\t\t\t\tthis._component.rebind();\n\t\t\t}\n\t\t}\n\t}\n\tget blendType() {\n\t\treturn this._blendType;\n\t}\n\tset mask(value) {\n\t\tif (this._controller.assignMask(value)) {\n\t\t\tthis._component.rebind();\n\t\t}\n\t\tthis._mask = value;\n\t}\n\tget mask() {\n\t\treturn this._mask;\n\t}\n\tplay(name) {\n\t\tthis._controller.play(name);\n\t}\n\tpause() {\n\t\tthis._controller.pause();\n\t}\n\treset() {\n\t\tthis._controller.reset();\n\t}\n\trebind() {\n\t\tthis._controller.rebind();\n\t}\n\tupdate(dt) {\n\t\tif (this._blendTime) {\n\t\t\tif (this._blendTimeElapsed < this._blendTime) {\n\t\t\t\tthis.weight = math.lerp(this._startingWeight, this._targetWeight, this._blendTimeElapsed / this._blendTime);\n\t\t\t\tthis._blendTimeElapsed += dt;\n\t\t\t} else {\n\t\t\t\tthis.weight = this._targetWeight;\n\t\t\t\tthis._blendTime = 0;\n\t\t\t\tthis._blendTimeElapsed = 0;\n\t\t\t\tthis._startingWeight = 0;\n\t\t\t\tthis._targetWeight = 0;\n\t\t\t}\n\t\t}\n\t\tthis._controller.update(dt);\n\t}\n\tblendToWeight(weight, time) {\n\t\tthis._startingWeight = this.weight;\n\t\tthis._targetWeight = weight;\n\t\tthis._blendTime = Math.max(0, time);\n\t\tthis._blendTimeElapsed = 0;\n\t}\n\tassignMask(mask) {\n\t\tif (this._controller.assignMask(mask)) {\n\t\t\tthis._component.rebind();\n\t\t}\n\t\tthis._mask = mask;\n\t}\n\tassignAnimation(nodePath, animTrack, speed, loop) {\n\t\tif (!(animTrack instanceof AnimTrack)) {\n\t\t\treturn;\n\t\t}\n\t\tthis._controller.assignAnimation(nodePath, animTrack, speed, loop);\n\t\tif (this._controller._transitions.length === 0) {\n\t\t\tthis._controller._transitions.push(new AnimTransition({\n\t\t\t\tfrom: 'START',\n\t\t\t\tto: nodePath\n\t\t\t}));\n\t\t}\n\t\tif (this._component.activate && this._component.playable) {\n\t\t\tthis._component.playing = true;\n\t\t}\n\t}\n\tremoveNodeAnimations(nodeName) {\n\t\tif (this._controller.removeNodeAnimations(nodeName)) {\n\t\t\tthis._component.playing = false;\n\t\t}\n\t}\n\tgetAnimationAsset(stateName) {\n\t\treturn this._component.animationAssets[`${this.name}:${stateName}`];\n\t}\n\ttransition(to, time = 0, transitionOffset = null) {\n\t\tthis._controller.updateStateFromTransition(new AnimTransition({\n\t\t\tfrom: this._controller.activeStateName,\n\t\t\tto,\n\t\t\ttime,\n\t\t\ttransitionOffset\n\t\t}));\n\t}\n}\n\nexport { AnimComponentLayer };\n","class AnimStateGraph {\n\tconstructor(data) {\n\t\tthis._layers = [];\n\t\tthis._parameters = {};\n\t\tif (!Array.isArray(data.layers)) {\n\t\t\tfor (const layerId in data.layers) {\n\t\t\t\tconst dataLayer = data.layers[layerId];\n\t\t\t\tconst layer = {\n\t\t\t\t\tname: dataLayer.name,\n\t\t\t\t\tblendType: dataLayer.blendType,\n\t\t\t\t\tweight: dataLayer.weight,\n\t\t\t\t\tstates: [],\n\t\t\t\t\ttransitions: []\n\t\t\t\t};\n\t\t\t\tfor (let i = 0; i < dataLayer.states.length; i++) {\n\t\t\t\t\tlayer.states.push(data.states[dataLayer.states[i]]);\n\t\t\t\t}\n\t\t\t\tfor (let i = 0; i < dataLayer.transitions.length; i++) {\n\t\t\t\t\tconst dataLayerTransition = data.transitions[dataLayer.transitions[i]];\n\t\t\t\t\tif (dataLayerTransition.conditions && !Array.isArray(dataLayerTransition.conditions)) {\n\t\t\t\t\t\tconst conditionKeys = Object.keys(dataLayerTransition.conditions);\n\t\t\t\t\t\tconst conditions = [];\n\t\t\t\t\t\tfor (let j = 0; j < conditionKeys.length; j++) {\n\t\t\t\t\t\t\tconst condition = dataLayerTransition.conditions[conditionKeys[j]];\n\t\t\t\t\t\t\tif (condition.parameterName) {\n\t\t\t\t\t\t\t\tconditions.push(condition);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdataLayerTransition.conditions = conditions;\n\t\t\t\t\t}\n\t\t\t\t\tif (Number.isInteger(dataLayerTransition.from)) {\n\t\t\t\t\t\tdataLayerTransition.from = data.states[dataLayerTransition.from].name;\n\t\t\t\t\t}\n\t\t\t\t\tif (Number.isInteger(dataLayerTransition.to)) {\n\t\t\t\t\t\tdataLayerTransition.to = data.states[dataLayerTransition.to].name;\n\t\t\t\t\t}\n\t\t\t\t\tlayer.transitions.push(dataLayerTransition);\n\t\t\t\t}\n\t\t\t\tthis._layers.push(layer);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._layers = data.layers;\n\t\t}\n\t\tfor (const paramId in data.parameters) {\n\t\t\tconst param = data.parameters[paramId];\n\t\t\tthis._parameters[param.name] = {\n\t\t\t\ttype: param.type,\n\t\t\t\tvalue: param.value\n\t\t\t};\n\t\t}\n\t}\n\tget parameters() {\n\t\treturn Object.assign({}, this._parameters);\n\t}\n\tget layers() {\n\t\treturn this._layers;\n\t}\n}\n\nexport { AnimStateGraph };\n","import { extends as _extends } from '../../../_virtual/_rollupPluginBabelHelpers.js';\nimport '../../../core/tracing.js';\nimport { Asset } from '../../asset/asset.js';\nimport { AnimEvaluator } from '../../anim/evaluator/anim-evaluator.js';\nimport { AnimController } from '../../anim/controller/anim-controller.js';\nimport { Component } from '../component.js';\nimport { ANIM_CONTROL_STATES, ANIM_PARAMETER_FLOAT, ANIM_PARAMETER_INTEGER, ANIM_PARAMETER_BOOLEAN, ANIM_PARAMETER_TRIGGER } from '../../anim/controller/constants.js';\nimport { AnimComponentBinder } from './component-binder.js';\nimport { AnimComponentLayer } from './component-layer.js';\nimport { AnimStateGraph } from '../../anim/state-graph/anim-state-graph.js';\nimport { Entity } from '../../entity.js';\nimport { AnimTrack } from '../../anim/evaluator/anim-track.js';\n\nclass AnimComponent extends Component {\n\tconstructor(system, entity) {\n\t\tsuper(system, entity);\n\t\tthis.findParameter = name => {\n\t\t\treturn this._parameters[name];\n\t\t};\n\t\tthis.consumeTrigger = name => {\n\t\t\tthis._consumedTriggers.add(name);\n\t\t};\n\t\tthis._stateGraphAsset = null;\n\t\tthis._animationAssets = {};\n\t\tthis._speed = 1.0;\n\t\tthis._activate = true;\n\t\tthis._playing = false;\n\t\tthis._rootBone = null;\n\t\tthis._stateGraph = null;\n\t\tthis._layers = [];\n\t\tthis._layerIndices = {};\n\t\tthis._parameters = {};\n\t\tthis._targets = {};\n\t\tthis._consumedTriggers = new Set();\n\t\tthis._normalizeWeights = false;\n\t}\n\tset stateGraphAsset(value) {\n\t\tif (value === null) {\n\t\t\tthis.removeStateGraph();\n\t\t\treturn;\n\t\t}\n\t\tif (this._stateGraphAsset) {\n\t\t\tconst stateGraphAsset = this.system.app.assets.get(this._stateGraphAsset);\n\t\t\tstateGraphAsset.off('change', this._onStateGraphAssetChangeEvent, this);\n\t\t}\n\t\tlet _id;\n\t\tlet _asset;\n\t\tif (value instanceof Asset) {\n\t\t\t_id = value.id;\n\t\t\t_asset = this.system.app.assets.get(_id);\n\t\t\tif (!_asset) {\n\t\t\t\tthis.system.app.assets.add(value);\n\t\t\t\t_asset = this.system.app.assets.get(_id);\n\t\t\t}\n\t\t} else {\n\t\t\t_id = value;\n\t\t\t_asset = this.system.app.assets.get(_id);\n\t\t}\n\t\tif (!_asset || this._stateGraphAsset === _id) {\n\t\t\treturn;\n\t\t}\n\t\tif (_asset.resource) {\n\t\t\tthis._stateGraph = _asset.resource;\n\t\t\tthis.loadStateGraph(this._stateGraph);\n\t\t\t_asset.on('change', this._onStateGraphAssetChangeEvent, this);\n\t\t} else {\n\t\t\t_asset.once('load', asset => {\n\t\t\t\tthis._stateGraph = asset.resource;\n\t\t\t\tthis.loadStateGraph(this._stateGraph);\n\t\t\t});\n\t\t\t_asset.on('change', this._onStateGraphAssetChangeEvent, this);\n\t\t\tthis.system.app.assets.load(_asset);\n\t\t}\n\t\tthis._stateGraphAsset = _id;\n\t}\n\tget stateGraphAsset() {\n\t\treturn this._stateGraphAsset;\n\t}\n\tset normalizeWeights(value) {\n\t\tthis._normalizeWeights = value;\n\t\tthis.unbind();\n\t}\n\tget normalizeWeights() {\n\t\treturn this._normalizeWeights;\n\t}\n\tset animationAssets(value) {\n\t\tthis._animationAssets = value;\n\t\tthis.loadAnimationAssets();\n\t}\n\tget animationAssets() {\n\t\treturn this._animationAssets;\n\t}\n\tset speed(value) {\n\t\tthis._speed = value;\n\t}\n\tget speed() {\n\t\treturn this._speed;\n\t}\n\tset activate(value) {\n\t\tthis._activate = value;\n\t}\n\tget activate() {\n\t\treturn this._activate;\n\t}\n\tset playing(value) {\n\t\tthis._playing = value;\n\t}\n\tget playing() {\n\t\treturn this._playing;\n\t}\n\tset rootBone(value) {\n\t\tif (typeof value === 'string') {\n\t\t\tconst entity = this.entity.root.findByGuid(value);\n\t\t\tthis._rootBone = entity;\n\t\t} else if (value instanceof Entity) {\n\t\t\tthis._rootBone = value;\n\t\t} else {\n\t\t\tthis._rootBone = null;\n\t\t}\n\t\tthis.rebind();\n\t}\n\tget rootBone() {\n\t\treturn this._rootBone;\n\t}\n\tset stateGraph(value) {\n\t\tthis._stateGraph = value;\n\t}\n\tget stateGraph() {\n\t\treturn this._stateGraph;\n\t}\n\tget layers() {\n\t\treturn this._layers;\n\t}\n\tset layerIndices(value) {\n\t\tthis._layerIndices = value;\n\t}\n\tget layerIndices() {\n\t\treturn this._layerIndices;\n\t}\n\tset parameters(value) {\n\t\tthis._parameters = value;\n\t}\n\tget parameters() {\n\t\treturn this._parameters;\n\t}\n\tset targets(value) {\n\t\tthis._targets = value;\n\t}\n\tget targets() {\n\t\treturn this._targets;\n\t}\n\tget playable() {\n\t\tfor (let i = 0; i < this._layers.length; i++) {\n\t\t\tif (!this._layers[i].playable) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\tget baseLayer() {\n\t\tif (this._layers.length > 0) {\n\t\t\treturn this._layers[0];\n\t\t}\n\t\treturn null;\n\t}\n\t_onStateGraphAssetChangeEvent(asset) {\n\t\tconst prevAnimationAssets = this.animationAssets;\n\t\tconst prevMasks = this.layers.map(layer => layer.mask);\n\t\tthis.removeStateGraph();\n\t\tthis._stateGraph = new AnimStateGraph(asset._data);\n\t\tthis.loadStateGraph(this._stateGraph);\n\t\tthis.animationAssets = prevAnimationAssets;\n\t\tthis.loadAnimationAssets();\n\t\tthis.layers.forEach((layer, i) => {\n\t\t\tlayer.mask = prevMasks[i];\n\t\t});\n\t\tthis.rebind();\n\t}\n\tdirtifyTargets() {\n\t\tconst targets = Object.values(this._targets);\n\t\tfor (let i = 0; i < targets.length; i++) {\n\t\t\ttargets[i].dirty = true;\n\t\t}\n\t}\n\t_addLayer({\n\t\tname,\n\t\tstates,\n\t\ttransitions,\n\t\tweight,\n\t\tmask,\n\t\tblendType\n\t}) {\n\t\tlet graph;\n\t\tif (this.rootBone) {\n\t\t\tgraph = this.rootBone;\n\t\t} else {\n\t\t\tgraph = this.entity;\n\t\t}\n\t\tconst layerIndex = this._layers.length;\n\t\tconst animBinder = new AnimComponentBinder(this, graph, name, mask, layerIndex);\n\t\tconst animEvaluator = new AnimEvaluator(animBinder);\n\t\tconst controller = new AnimController(animEvaluator, states, transitions, this._activate, this, this.findParameter, this.consumeTrigger);\n\t\tthis._layers.push(new AnimComponentLayer(name, controller, this, weight, blendType));\n\t\tthis._layerIndices[name] = layerIndex;\n\t\treturn this._layers[layerIndex];\n\t}\n\taddLayer(name, weight, mask, blendType) {\n\t\tconst layer = this.findAnimationLayer(name);\n\t\tif (layer) return layer;\n\t\tconst states = [{\n\t\t\t'name': 'START',\n\t\t\t'speed': 1\n\t\t}];\n\t\tconst transitions = [];\n\t\treturn this._addLayer({\n\t\t\tname,\n\t\t\tstates,\n\t\t\ttransitions,\n\t\t\tweight,\n\t\t\tmask,\n\t\t\tblendType\n\t\t});\n\t}\n\t_assignParameters(stateGraph) {\n\t\tthis._parameters = {};\n\t\tconst paramKeys = Object.keys(stateGraph.parameters);\n\t\tfor (let i = 0; i < paramKeys.length; i++) {\n\t\t\tconst paramKey = paramKeys[i];\n\t\t\tthis._parameters[paramKey] = {\n\t\t\t\ttype: stateGraph.parameters[paramKey].type,\n\t\t\t\tvalue: stateGraph.parameters[paramKey].value\n\t\t\t};\n\t\t}\n\t}\n\tloadStateGraph(stateGraph) {\n\t\tthis._stateGraph = stateGraph;\n\t\tthis._assignParameters(stateGraph);\n\t\tthis._layers = [];\n\t\tlet containsBlendTree = false;\n\t\tfor (let i = 0; i < stateGraph.layers.length; i++) {\n\t\t\tconst layer = stateGraph.layers[i];\n\t\t\tthis._addLayer(_extends({}, layer));\n\t\t\tif (layer.states.some(state => state.blendTree)) {\n\t\t\t\tcontainsBlendTree = true;\n\t\t\t}\n\t\t}\n\t\tif (!containsBlendTree) {\n\t\t\tthis.setupAnimationAssets();\n\t\t}\n\t}\n\tsetupAnimationAssets() {\n\t\tfor (let i = 0; i < this._layers.length; i++) {\n\t\t\tconst layer = this._layers[i];\n\t\t\tconst layerName = layer.name;\n\t\t\tfor (let j = 0; j < layer.states.length; j++) {\n\t\t\t\tconst stateName = layer.states[j];\n\t\t\t\tif (ANIM_CONTROL_STATES.indexOf(stateName) === -1) {\n\t\t\t\t\tconst stateKey = layerName + ':' + stateName;\n\t\t\t\t\tif (!this._animationAssets[stateKey]) {\n\t\t\t\t\t\tthis._animationAssets[stateKey] = {\n\t\t\t\t\t\t\tasset: null\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.loadAnimationAssets();\n\t}\n\tloadAnimationAssets() {\n\t\tfor (let i = 0; i < this._layers.length; i++) {\n\t\t\tconst layer = this._layers[i];\n\t\t\tfor (let j = 0; j < layer.states.length; j++) {\n\t\t\t\tconst stateName = layer.states[j];\n\t\t\t\tif (ANIM_CONTROL_STATES.indexOf(stateName) !== -1) continue;\n\t\t\t\tconst animationAsset = this._animationAssets[layer.name + ':' + stateName];\n\t\t\t\tif (!animationAsset || !animationAsset.asset) {\n\t\t\t\t\tthis.findAnimationLayer(layer.name).assignAnimation(stateName, AnimTrack.EMPTY);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst assetId = animationAsset.asset;\n\t\t\t\tconst asset = this.system.app.assets.get(assetId);\n\t\t\t\tif (asset) {\n\t\t\t\t\tif (asset.resource) {\n\t\t\t\t\t\tthis.onAnimationAssetLoaded(layer.name, stateName, asset);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tasset.once('load', function (layerName, stateName) {\n\t\t\t\t\t\t\treturn function (asset) {\n\t\t\t\t\t\t\t\tthis.onAnimationAssetLoaded(layerName, stateName, asset);\n\t\t\t\t\t\t\t}.bind(this);\n\t\t\t\t\t\t}.bind(this)(layer.name, stateName));\n\t\t\t\t\t\tthis.system.app.assets.load(asset);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tonAnimationAssetLoaded(layerName, stateName, asset) {\n\t\tthis.findAnimationLayer(layerName).assignAnimation(stateName, asset.resource);\n\t}\n\tremoveStateGraph() {\n\t\tthis._stateGraph = null;\n\t\tthis._stateGraphAsset = null;\n\t\tthis._animationAssets = {};\n\t\tthis._layers = [];\n\t\tthis._layerIndices = {};\n\t\tthis._parameters = {};\n\t\tthis._playing = false;\n\t\tthis.unbind();\n\t\tthis._targets = {};\n\t}\n\treset() {\n\t\tthis._assignParameters(this._stateGraph);\n\t\tfor (let i = 0; i < this._layers.length; i++) {\n\t\t\tconst layerPlaying = this._layers[i].playing;\n\t\t\tthis._layers[i].reset();\n\t\t\tthis._layers[i].playing = layerPlaying;\n\t\t}\n\t}\n\tunbind() {\n\t\tif (!this._normalizeWeights) {\n\t\t\tObject.keys(this._targets).forEach(targetKey => {\n\t\t\t\tthis._targets[targetKey].unbind();\n\t\t\t});\n\t\t}\n\t}\n\trebind() {\n\t\tthis._targets = {};\n\t\tfor (let i = 0; i < this._layers.length; i++) {\n\t\t\tthis._layers[i].rebind();\n\t\t}\n\t}\n\tfindAnimationLayer(name) {\n\t\tconst layerIndex = this._layerIndices[name];\n\t\treturn this._layers[layerIndex] || null;\n\t}\n\taddAnimationState(nodeName, animTrack, speed = 1, loop = true, layerName = 'Base') {\n\t\tif (!this._stateGraph) {\n\t\t\tthis.loadStateGraph(new AnimStateGraph({\n\t\t\t\t'layers': [{\n\t\t\t\t\t'name': layerName,\n\t\t\t\t\t'states': [{\n\t\t\t\t\t\t'name': 'START',\n\t\t\t\t\t\t'speed': 1\n\t\t\t\t\t}, {\n\t\t\t\t\t\t'name': nodeName,\n\t\t\t\t\t\t'speed': speed,\n\t\t\t\t\t\t'loop': loop,\n\t\t\t\t\t\t'defaultState': true\n\t\t\t\t\t}],\n\t\t\t\t\t'transitions': [{\n\t\t\t\t\t\t'from': 'START',\n\t\t\t\t\t\t'to': nodeName\n\t\t\t\t\t}]\n\t\t\t\t}],\n\t\t\t\t'parameters': {}\n\t\t\t}));\n\t\t}\n\t\tconst layer = this.findAnimationLayer(layerName);\n\t\tif (layer) {\n\t\t\tlayer.assignAnimation(nodeName, animTrack, speed, loop);\n\t\t} else {\n\t\t\tvar _this$addLayer;\n\t\t\t(_this$addLayer = this.addLayer(layerName)) == null || _this$addLayer.assignAnimation(nodeName, animTrack, speed, loop);\n\t\t}\n\t}\n\tassignAnimation(nodePath, animTrack, layerName, speed = 1, loop = true) {\n\t\tif (!this._stateGraph && nodePath.indexOf('.') === -1) {\n\t\t\tthis.loadStateGraph(new AnimStateGraph({\n\t\t\t\t'layers': [{\n\t\t\t\t\t'name': 'Base',\n\t\t\t\t\t'states': [{\n\t\t\t\t\t\t'name': 'START',\n\t\t\t\t\t\t'speed': 1\n\t\t\t\t\t}, {\n\t\t\t\t\t\t'name': nodePath,\n\t\t\t\t\t\t'speed': speed,\n\t\t\t\t\t\t'loop': loop,\n\t\t\t\t\t\t'defaultState': true\n\t\t\t\t\t}],\n\t\t\t\t\t'transitions': [{\n\t\t\t\t\t\t'from': 'START',\n\t\t\t\t\t\t'to': nodePath\n\t\t\t\t\t}]\n\t\t\t\t}],\n\t\t\t\t'parameters': {}\n\t\t\t}));\n\t\t\tthis.baseLayer.assignAnimation(nodePath, animTrack);\n\t\t\treturn;\n\t\t}\n\t\tconst layer = layerName ? this.findAnimationLayer(layerName) : this.baseLayer;\n\t\tif (!layer) {\n\t\t\treturn;\n\t\t}\n\t\tlayer.assignAnimation(nodePath, animTrack, speed, loop);\n\t}\n\tremoveNodeAnimations(nodeName, layerName) {\n\t\tconst layer = layerName ? this.findAnimationLayer(layerName) : this.baseLayer;\n\t\tif (!layer) {\n\t\t\treturn;\n\t\t}\n\t\tlayer.removeNodeAnimations(nodeName);\n\t}\n\tgetParameterValue(name, type) {\n\t\tconst param = this._parameters[name];\n\t\tif (param && param.type === type) {\n\t\t\treturn param.value;\n\t\t}\n\t\treturn undefined;\n\t}\n\tsetParameterValue(name, type, value) {\n\t\tconst param = this._parameters[name];\n\t\tif (param && param.type === type) {\n\t\t\tparam.value = value;\n\t\t\treturn;\n\t\t}\n\t}\n\tgetFloat(name) {\n\t\treturn this.getParameterValue(name, ANIM_PARAMETER_FLOAT);\n\t}\n\tsetFloat(name, value) {\n\t\tthis.setParameterValue(name, ANIM_PARAMETER_FLOAT, value);\n\t}\n\tgetInteger(name) {\n\t\treturn this.getParameterValue(name, ANIM_PARAMETER_INTEGER);\n\t}\n\tsetInteger(name, value) {\n\t\tif (typeof value === 'number' && value % 1 === 0) {\n\t\t\tthis.setParameterValue(name, ANIM_PARAMETER_INTEGER, value);\n\t\t}\n\t}\n\tgetBoolean(name) {\n\t\treturn this.getParameterValue(name, ANIM_PARAMETER_BOOLEAN);\n\t}\n\tsetBoolean(name, value) {\n\t\tthis.setParameterValue(name, ANIM_PARAMETER_BOOLEAN, !!value);\n\t}\n\tgetTrigger(name) {\n\t\treturn this.getParameterValue(name, ANIM_PARAMETER_TRIGGER);\n\t}\n\tsetTrigger(name, singleFrame = false) {\n\t\tthis.setParameterValue(name, ANIM_PARAMETER_TRIGGER, true);\n\t\tif (singleFrame) {\n\t\t\tthis._consumedTriggers.add(name);\n\t\t}\n\t}\n\tresetTrigger(name) {\n\t\tthis.setParameterValue(name, ANIM_PARAMETER_TRIGGER, false);\n\t}\n\tonBeforeRemove() {\n\t\tif (Number.isFinite(this._stateGraphAsset)) {\n\t\t\tconst stateGraphAsset = this.system.app.assets.get(this._stateGraphAsset);\n\t\t\tstateGraphAsset.off('change', this._onStateGraphAssetChangeEvent, this);\n\t\t}\n\t}\n\tupdate(dt) {\n\t\tfor (let i = 0; i < this.layers.length; i++) {\n\t\t\tthis.layers[i].update(dt * this.speed);\n\t\t}\n\t\tthis._consumedTriggers.forEach(trigger => {\n\t\t\tthis.parameters[trigger].value = false;\n\t\t});\n\t\tthis._consumedTriggers.clear();\n\t}\n\tresolveDuplicatedEntityReferenceProperties(oldAnim, duplicatedIdsMap) {\n\t\tif (oldAnim.rootBone && duplicatedIdsMap[oldAnim.rootBone.getGuid()]) {\n\t\t\tthis.rootBone = duplicatedIdsMap[oldAnim.rootBone.getGuid()];\n\t\t} else {\n\t\t\tthis.rebind();\n\t\t}\n\t}\n}\n\nexport { AnimComponent };\n","class AnimComponentData {\n\tconstructor() {\n\t\tthis.enabled = true;\n\t}\n}\n\nexport { AnimComponentData };\n","import { AnimTrack } from '../../anim/evaluator/anim-track.js';\nimport { Component } from '../component.js';\nimport { ComponentSystem } from '../system.js';\nimport { AnimComponent } from './component.js';\nimport { AnimComponentData } from './data.js';\n\nconst _schema = ['enabled'];\nclass AnimComponentSystem extends ComponentSystem {\n\tconstructor(app) {\n\t\tsuper(app);\n\t\tthis.id = 'anim';\n\t\tthis.ComponentType = AnimComponent;\n\t\tthis.DataType = AnimComponentData;\n\t\tthis.schema = _schema;\n\t\tthis.on('beforeremove', this.onBeforeRemove, this);\n\t\tthis.app.systems.on('animationUpdate', this.onAnimationUpdate, this);\n\t}\n\tinitializeComponentData(component, data, properties) {\n\t\tsuper.initializeComponentData(component, data, _schema);\n\t\tconst complexProperties = ['animationAssets', 'stateGraph', 'layers', 'masks'];\n\t\tObject.keys(data).forEach(key => {\n\t\t\tif (complexProperties.includes(key)) return;\n\t\t\tcomponent[key] = data[key];\n\t\t});\n\t\tif (data.stateGraph) {\n\t\t\tcomponent.stateGraph = data.stateGraph;\n\t\t\tcomponent.loadStateGraph(component.stateGraph);\n\t\t}\n\t\tif (data.layers) {\n\t\t\tdata.layers.forEach((layer, i) => {\n\t\t\t\tlayer._controller.states.forEach(stateKey => {\n\t\t\t\t\tlayer._controller._states[stateKey]._animationList.forEach(node => {\n\t\t\t\t\t\tif (!node.animTrack || node.animTrack === AnimTrack.EMPTY) {\n\t\t\t\t\t\t\tconst animationAsset = this.app.assets.get(layer._component._animationAssets[layer.name + ':' + node.name].asset);\n\t\t\t\t\t\t\tif (animationAsset && !animationAsset.loaded) {\n\t\t\t\t\t\t\t\tanimationAsset.once('load', () => {\n\t\t\t\t\t\t\t\t\tcomponent.layers[i].assignAnimation(node.name, animationAsset.resource);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcomponent.layers[i].assignAnimation(node.name, node.animTrack);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t} else if (data.animationAssets) {\n\t\t\tcomponent.animationAssets = Object.assign(component.animationAssets, data.animationAssets);\n\t\t}\n\t\tif (data.masks) {\n\t\t\tObject.keys(data.masks).forEach(key => {\n\t\t\t\tif (component.layers[key]) {\n\t\t\t\t\tconst maskData = data.masks[key].mask;\n\t\t\t\t\tconst mask = {};\n\t\t\t\t\tObject.keys(maskData).forEach(maskKey => {\n\t\t\t\t\t\tmask[decodeURI(maskKey)] = maskData[maskKey];\n\t\t\t\t\t});\n\t\t\t\t\tcomponent.layers[key].mask = mask;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\tonAnimationUpdate(dt) {\n\t\tconst components = this.store;\n\t\tfor (const id in components) {\n\t\t\tif (components.hasOwnProperty(id)) {\n\t\t\t\tconst component = components[id].entity.anim;\n\t\t\t\tconst componentData = component.data;\n\t\t\t\tif (componentData.enabled && component.entity.enabled && component.playing) {\n\t\t\t\t\tcomponent.update(dt);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tcloneComponent(entity, clone) {\n\t\tlet masks;\n\t\tif (!entity.anim.rootBone || entity.anim.rootBone === entity) {\n\t\t\tmasks = {};\n\t\t\tentity.anim.layers.forEach((layer, i) => {\n\t\t\t\tif (layer.mask) {\n\t\t\t\t\tconst mask = {};\n\t\t\t\t\tObject.keys(layer.mask).forEach(path => {\n\t\t\t\t\t\tconst pathArr = path.split('/');\n\t\t\t\t\t\tpathArr.shift();\n\t\t\t\t\t\tconst clonePath = [clone.name, ...pathArr].join('/');\n\t\t\t\t\t\tmask[clonePath] = layer.mask[path];\n\t\t\t\t\t});\n\t\t\t\t\tmasks[i] = {\n\t\t\t\t\t\tmask\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tconst data = {\n\t\t\tstateGraphAsset: entity.anim.stateGraphAsset,\n\t\t\tanimationAssets: entity.anim.animationAssets,\n\t\t\tspeed: entity.anim.speed,\n\t\t\tactivate: entity.anim.activate,\n\t\t\tplaying: entity.anim.playing,\n\t\t\trootBone: entity.anim.rootBone,\n\t\t\tstateGraph: entity.anim.stateGraph,\n\t\t\tlayers: entity.anim.layers,\n\t\t\tlayerIndices: entity.anim.layerIndices,\n\t\t\tparameters: entity.anim.parameters,\n\t\t\tnormalizeWeights: entity.anim.normalizeWeights,\n\t\t\tmasks\n\t\t};\n\t\treturn this.addComponent(clone, data);\n\t}\n\tonBeforeRemove(entity, component) {\n\t\tcomponent.onBeforeRemove();\n\t}\n\tdestroy() {\n\t\tsuper.destroy();\n\t\tthis.app.systems.off('animationUpdate', this.onAnimationUpdate, this);\n\t}\n}\nComponent._buildAccessors(AnimComponent.prototype, _schema);\n\nexport { AnimComponentSystem };\n","import { Component } from '../component.js';\n\nclass AudioListenerComponent extends Component {\n\tconstructor(system, entity) {\n\t\tsuper(system, entity);\n\t}\n\tsetCurrentListener() {\n\t\tif (this.enabled && this.entity.audiolistener && this.entity.enabled) {\n\t\t\tthis.system.current = this.entity;\n\t\t\tconst position = this.system.current.getPosition();\n\t\t\tthis.system.manager.listener.setPosition(position);\n\t\t}\n\t}\n\tonEnable() {\n\t\tthis.setCurrentListener();\n\t}\n\tonDisable() {\n\t\tif (this.system.current === this.entity) {\n\t\t\tthis.system.current = null;\n\t\t}\n\t}\n}\n\nexport { AudioListenerComponent };\n","class AudioListenerComponentData {\n\tconstructor() {\n\t\tthis.enabled = true;\n\t}\n}\n\nexport { AudioListenerComponentData };\n","import '../../../core/tracing.js';\nimport { Component } from '../component.js';\nimport { ComponentSystem } from '../system.js';\nimport { AudioListenerComponent } from './component.js';\nimport { AudioListenerComponentData } from './data.js';\n\nconst _schema = ['enabled'];\nclass AudioListenerComponentSystem extends ComponentSystem {\n\tconstructor(app) {\n\t\tsuper(app);\n\t\tthis.id = 'audiolistener';\n\t\tthis.ComponentType = AudioListenerComponent;\n\t\tthis.DataType = AudioListenerComponentData;\n\t\tthis.schema = _schema;\n\t\tthis.manager = app.soundManager;\n\t\tthis.current = null;\n\t\tthis.app.systems.on('update', this.onUpdate, this);\n\t}\n\tinitializeComponentData(component, data, properties) {\n\t\tproperties = ['enabled'];\n\t\tsuper.initializeComponentData(component, data, properties);\n\t}\n\tonUpdate(dt) {\n\t\tif (this.current) {\n\t\t\tconst position = this.current.getPosition();\n\t\t\tthis.manager.listener.setPosition(position);\n\t\t\tconst wtm = this.current.getWorldTransform();\n\t\t\tthis.manager.listener.setOrientation(wtm);\n\t\t}\n\t}\n\tdestroy() {\n\t\tsuper.destroy();\n\t\tthis.app.systems.off('update', this.onUpdate, this);\n\t}\n}\nComponent._buildAccessors(AudioListenerComponent.prototype, _schema);\n\nexport { AudioListenerComponentSystem };\n","import { Asset } from '../../asset/asset.js';\nimport { Channel3d } from '../../../platform/audio/channel3d.js';\nimport { Component } from '../component.js';\n\nclass AudioSourceComponent extends Component {\n\tconstructor(system, entity) {\n\t\tsuper(system, entity);\n\t\tthis.on('set_assets', this.onSetAssets, this);\n\t\tthis.on('set_loop', this.onSetLoop, this);\n\t\tthis.on('set_volume', this.onSetVolume, this);\n\t\tthis.on('set_pitch', this.onSetPitch, this);\n\t\tthis.on('set_minDistance', this.onSetMinDistance, this);\n\t\tthis.on('set_maxDistance', this.onSetMaxDistance, this);\n\t\tthis.on('set_rollOffFactor', this.onSetRollOffFactor, this);\n\t\tthis.on('set_distanceModel', this.onSetDistanceModel, this);\n\t\tthis.on('set_3d', this.onSet3d, this);\n\t}\n\tplay(name) {\n\t\tif (!this.enabled || !this.entity.enabled) {\n\t\t\treturn;\n\t\t}\n\t\tif (this.channel) {\n\t\t\tthis.stop();\n\t\t}\n\t\tlet channel;\n\t\tconst componentData = this.data;\n\t\tif (componentData.sources[name]) {\n\t\t\tif (!componentData['3d']) {\n\t\t\t\tchannel = this.system.manager.playSound(componentData.sources[name], componentData);\n\t\t\t\tcomponentData.currentSource = name;\n\t\t\t\tcomponentData.channel = channel;\n\t\t\t} else {\n\t\t\t\tconst pos = this.entity.getPosition();\n\t\t\t\tchannel = this.system.manager.playSound3d(componentData.sources[name], pos, componentData);\n\t\t\t\tcomponentData.currentSource = name;\n\t\t\t\tcomponentData.channel = channel;\n\t\t\t}\n\t\t}\n\t}\n\tpause() {\n\t\tif (this.channel) {\n\t\t\tthis.channel.pause();\n\t\t}\n\t}\n\tunpause() {\n\t\tif (this.channel && this.channel.paused) {\n\t\t\tthis.channel.unpause();\n\t\t}\n\t}\n\tstop() {\n\t\tif (this.channel) {\n\t\t\tthis.channel.stop();\n\t\t\tthis.channel = null;\n\t\t}\n\t}\n\tonSetAssets(name, oldValue, newValue) {\n\t\tconst newAssets = [];\n\t\tconst len = newValue.length;\n\t\tif (oldValue && oldValue.length) {\n\t\t\tfor (let i = 0; i < oldValue.length; i++) {\n\t\t\t\tif (oldValue[i]) {\n\t\t\t\t\tconst asset = this.system.app.assets.get(oldValue[i]);\n\t\t\t\t\tif (asset) {\n\t\t\t\t\t\tasset.off('change', this.onAssetChanged, this);\n\t\t\t\t\t\tasset.off('remove', this.onAssetRemoved, this);\n\t\t\t\t\t\tif (this.currentSource === asset.name) {\n\t\t\t\t\t\t\tthis.stop();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (len) {\n\t\t\tfor (let i = 0; i < len; i++) {\n\t\t\t\tif (oldValue.indexOf(newValue[i]) < 0) {\n\t\t\t\t\tif (newValue[i] instanceof Asset) {\n\t\t\t\t\t\tnewAssets.push(newValue[i].id);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnewAssets.push(newValue[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (!this.system._inTools && newAssets.length) {\n\t\t\tthis.loadAudioSourceAssets(newAssets);\n\t\t}\n\t}\n\tonAssetChanged(asset, attribute, newValue, oldValue) {\n\t\tif (attribute === 'resource') {\n\t\t\tconst sources = this.data.sources;\n\t\t\tif (sources) {\n\t\t\t\tthis.data.sources[asset.name] = newValue;\n\t\t\t\tif (this.data.currentSource === asset.name) {\n\t\t\t\t\tif (this.channel) {\n\t\t\t\t\t\tif (this.channel.paused) {\n\t\t\t\t\t\t\tthis.play(asset.name);\n\t\t\t\t\t\t\tthis.pause();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.play(asset.name);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tonAssetRemoved(asset) {\n\t\tasset.off('remove', this.onAssetRemoved, this);\n\t\tif (this.data.sources[asset.name]) {\n\t\t\tdelete this.data.sources[asset.name];\n\t\t\tif (this.data.currentSource === asset.name) {\n\t\t\t\tthis.stop();\n\t\t\t\tthis.data.currentSource = null;\n\t\t\t}\n\t\t}\n\t}\n\tonSetLoop(name, oldValue, newValue) {\n\t\tif (oldValue !== newValue) {\n\t\t\tif (this.channel) {\n\t\t\t\tthis.channel.setLoop(newValue);\n\t\t\t}\n\t\t}\n\t}\n\tonSetVolume(name, oldValue, newValue) {\n\t\tif (oldValue !== newValue) {\n\t\t\tif (this.channel) {\n\t\t\t\tthis.channel.setVolume(newValue);\n\t\t\t}\n\t\t}\n\t}\n\tonSetPitch(name, oldValue, newValue) {\n\t\tif (oldValue !== newValue) {\n\t\t\tif (this.channel) {\n\t\t\t\tthis.channel.setPitch(newValue);\n\t\t\t}\n\t\t}\n\t}\n\tonSetMaxDistance(name, oldValue, newValue) {\n\t\tif (oldValue !== newValue) {\n\t\t\tif (this.channel instanceof Channel3d) {\n\t\t\t\tthis.channel.setMaxDistance(newValue);\n\t\t\t}\n\t\t}\n\t}\n\tonSetMinDistance(name, oldValue, newValue) {\n\t\tif (oldValue !== newValue) {\n\t\t\tif (this.channel instanceof Channel3d) {\n\t\t\t\tthis.channel.setMinDistance(newValue);\n\t\t\t}\n\t\t}\n\t}\n\tonSetRollOffFactor(name, oldValue, newValue) {\n\t\tif (oldValue !== newValue) {\n\t\t\tif (this.channel instanceof Channel3d) {\n\t\t\t\tthis.channel.setRollOffFactor(newValue);\n\t\t\t}\n\t\t}\n\t}\n\tonSetDistanceModel(name, oldValue, newValue) {\n\t\tif (oldValue !== newValue) {\n\t\t\tif (this.channel instanceof Channel3d) {\n\t\t\t\tthis.channel.setDistanceModel(newValue);\n\t\t\t}\n\t\t}\n\t}\n\tonSet3d(name, oldValue, newValue) {\n\t\tif (oldValue !== newValue) {\n\t\t\tif (this.system.initialized && this.currentSource) {\n\t\t\t\tlet paused = false;\n\t\t\t\tlet suspended = false;\n\t\t\t\tif (this.channel) {\n\t\t\t\t\tpaused = this.channel.paused;\n\t\t\t\t\tsuspended = this.channel.suspended;\n\t\t\t\t}\n\t\t\t\tthis.play(this.currentSource);\n\t\t\t\tif (this.channel) {\n\t\t\t\t\tthis.channel.paused = paused;\n\t\t\t\t\tthis.channel.suspended = suspended;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tonEnable() {\n\t\tconst assets = this.data.assets;\n\t\tif (assets) {\n\t\t\tconst registry = this.system.app.assets;\n\t\t\tfor (let i = 0, len = assets.length; i < len; i++) {\n\t\t\t\tlet asset = assets[i];\n\t\t\t\tif (!(asset instanceof Asset)) asset = registry.get(asset);\n\t\t\t\tif (asset && !asset.resource) {\n\t\t\t\t\tregistry.load(asset);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (this.system.initialized) {\n\t\t\tif (this.data.activate && !this.channel) {\n\t\t\t\tthis.play(this.currentSource);\n\t\t\t} else {\n\t\t\t\tthis.unpause();\n\t\t\t}\n\t\t}\n\t}\n\tonDisable() {\n\t\tthis.pause();\n\t}\n\tloadAudioSourceAssets(ids) {\n\t\tconst assets = ids.map(id => {\n\t\t\treturn this.system.app.assets.get(id);\n\t\t});\n\t\tconst sources = {};\n\t\tlet currentSource = null;\n\t\tlet count = assets.length;\n\t\tconst _error = e => {\n\t\t\tcount--;\n\t\t};\n\t\tconst _done = () => {\n\t\t\tthis.data.sources = sources;\n\t\t\tthis.data.currentSource = currentSource;\n\t\t\tif (this.enabled && this.activate && currentSource) {\n\t\t\t\tthis.onEnable();\n\t\t\t}\n\t\t};\n\t\tassets.forEach((asset, index) => {\n\t\t\tif (asset) {\n\t\t\t\tcurrentSource = currentSource || asset.name;\n\t\t\t\tasset.off('change', this.onAssetChanged, this);\n\t\t\t\tasset.on('change', this.onAssetChanged, this);\n\t\t\t\tasset.off('remove', this.onAssetRemoved, this);\n\t\t\t\tasset.on('remove', this.onAssetRemoved, this);\n\t\t\t\tasset.off('error', _error, this);\n\t\t\t\tasset.on('error', _error, this);\n\t\t\t\tasset.ready(asset => {\n\t\t\t\t\tsources[asset.name] = asset.resource;\n\t\t\t\t\tcount--;\n\t\t\t\t\tif (count === 0) {\n\t\t\t\t\t\t_done();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (!asset.resource && this.enabled && this.entity.enabled) this.system.app.assets.load(asset);\n\t\t\t} else {\n\t\t\t\tcount--;\n\t\t\t\tif (count === 0) {\n\t\t\t\t\t_done();\n\t\t\t\t}\n\t\t\t\tthis.system.app.assets.on('add:' + ids[index], asset => {\n\t\t\t\t\tasset.ready(asset => {\n\t\t\t\t\t\tthis.data.sources[asset.name] = asset.resource;\n\t\t\t\t\t});\n\t\t\t\t\tif (!asset.resource) this.system.app.assets.load(asset);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n}\n\nexport { AudioSourceComponent };\n","import { DISTANCE_INVERSE } from '../../../platform/audio/constants.js';\n\nclass AudioSourceComponentData {\n\tconstructor() {\n\t\tthis.enabled = true;\n\t\tthis.assets = [];\n\t\tthis.activate = true;\n\t\tthis.volume = 1;\n\t\tthis.pitch = 1;\n\t\tthis.loop = false;\n\t\tthis['3d'] = true;\n\t\tthis.minDistance = 1;\n\t\tthis.maxDistance = 10000;\n\t\tthis.rollOffFactor = 1;\n\t\tthis.distanceModel = DISTANCE_INVERSE;\n\t\tthis.paused = true;\n\t\tthis.sources = {};\n\t\tthis.currentSource = null;\n\t\tthis.channel = null;\n\t}\n}\n\nexport { AudioSourceComponentData };\n","import { Channel3d } from '../../../platform/audio/channel3d.js';\nimport '../../../core/tracing.js';\nimport { Entity } from '../../entity.js';\nimport { Component } from '../component.js';\nimport { ComponentSystem } from '../system.js';\nimport { AudioSourceComponent } from './component.js';\nimport { AudioSourceComponentData } from './data.js';\n\nconst _schema = ['enabled', 'assets', 'volume', 'pitch', 'loop', 'activate', '3d', 'minDistance', 'maxDistance', 'rollOffFactor', 'distanceModel', 'sources', 'currentSource', 'channel'];\nclass AudioSourceComponentSystem extends ComponentSystem {\n\tconstructor(app) {\n\t\tsuper(app);\n\t\tthis.id = 'audiosource';\n\t\tthis.ComponentType = AudioSourceComponent;\n\t\tthis.DataType = AudioSourceComponentData;\n\t\tthis.schema = _schema;\n\t\tthis.manager = app.soundManager;\n\t\tthis.initialized = false;\n\t\tthis.app.systems.on('initialize', this.onInitialize, this);\n\t\tthis.app.systems.on('update', this.onUpdate, this);\n\t\tthis.on('remove', this.onRemove, this);\n\t}\n\tinitializeComponentData(component, data, properties) {\n\t\tproperties = ['activate', 'volume', 'pitch', 'loop', '3d', 'minDistance', 'maxDistance', 'rollOffFactor', 'distanceModel', 'enabled', 'assets'];\n\t\tsuper.initializeComponentData(component, data, properties);\n\t\tcomponent.paused = !(component.enabled && component.activate);\n\t}\n\tonInitialize(root) {\n\t\tif (root.audiosource && root.enabled && root.audiosource.enabled && root.audiosource.activate) {\n\t\t\troot.audiosource.play(root.audiosource.currentSource);\n\t\t}\n\t\tconst children = root._children;\n\t\tfor (let i = 0, len = children.length; i < len; i++) {\n\t\t\tif (children[i] instanceof Entity) {\n\t\t\t\tthis.onInitialize(children[i]);\n\t\t\t}\n\t\t}\n\t\tthis.initialized = true;\n\t}\n\tonUpdate(dt) {\n\t\tconst components = this.store;\n\t\tfor (const id in components) {\n\t\t\tif (components.hasOwnProperty(id)) {\n\t\t\t\tconst component = components[id];\n\t\t\t\tconst entity = component.entity;\n\t\t\t\tconst componentData = component.data;\n\t\t\t\tif (componentData.enabled && entity.enabled && componentData.channel instanceof Channel3d) {\n\t\t\t\t\tconst pos = entity.getPosition();\n\t\t\t\t\tcomponentData.channel.setPosition(pos);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tonRemove(entity, data) {\n\t\tif (data.channel) {\n\t\t\tdata.channel.stop();\n\t\t\tdata.channel = null;\n\t\t}\n\t}\n\tsetVolume(volume) {\n\t\tthis.manager.setVolume(volume);\n\t}\n\tdestroy() {\n\t\tsuper.destroy();\n\t\tthis.app.systems.off('initialize', this.onInitialize, this);\n\t\tthis.app.systems.off('update', this.onUpdate, this);\n\t}\n}\nComponent._buildAccessors(AudioSourceComponent.prototype, _schema);\n\nexport { AudioSourceComponentSystem };\n","import { Component } from '../components/component.js';\nimport { Entity } from '../entity.js';\nimport { EventHandler } from '../../core/event-handler.js';\n\nclass EntityReference extends EventHandler {\n\tconstructor(parentComponent, entityPropertyName, eventConfig) {\n\t\tsuper();\n\t\tif (!parentComponent || !(parentComponent instanceof Component)) {\n\t\t\tthrow new Error('The parentComponent argument is required and must be a Component');\n\t\t} else if (!entityPropertyName || typeof entityPropertyName !== 'string') {\n\t\t\tthrow new Error('The propertyName argument is required and must be a string');\n\t\t} else if (eventConfig && typeof eventConfig !== 'object') {\n\t\t\tthrow new Error('If provided, the eventConfig argument must be an object');\n\t\t}\n\t\tthis._parentComponent = parentComponent;\n\t\tthis._entityPropertyName = entityPropertyName;\n\t\tthis._entity = null;\n\t\tthis._app = parentComponent.system.app;\n\t\tthis._configureEventListeners(eventConfig || {}, {\n\t\t\t'entity#destroy': this._onEntityDestroy\n\t\t});\n\t\tthis._toggleLifecycleListeners('on');\n\t}\n\t_configureEventListeners(externalEventConfig, internalEventConfig) {\n\t\tconst externalEventListenerConfigs = this._parseEventListenerConfig(externalEventConfig, 'external', this._parentComponent);\n\t\tconst internalEventListenerConfigs = this._parseEventListenerConfig(internalEventConfig, 'internal', this);\n\t\tthis._eventListenerConfigs = externalEventListenerConfigs.concat(internalEventListenerConfigs);\n\t\tthis._listenerStatusFlags = {};\n\t\tthis._gainListeners = {};\n\t\tthis._loseListeners = {};\n\t}\n\t_parseEventListenerConfig(eventConfig, prefix, scope) {\n\t\treturn Object.keys(eventConfig).map(function (listenerDescription, index) {\n\t\t\tconst listenerDescriptionParts = listenerDescription.split('#');\n\t\t\tconst sourceName = listenerDescriptionParts[0];\n\t\t\tconst eventName = listenerDescriptionParts[1];\n\t\t\tconst callback = eventConfig[listenerDescription];\n\t\t\tif (listenerDescriptionParts.length !== 2 || typeof sourceName !== 'string' || sourceName.length === 0 || typeof eventName !== 'string' || eventName.length === 0) {\n\t\t\t\tthrow new Error('Invalid event listener description: `' + listenerDescription + '`');\n\t\t\t}\n\t\t\tif (typeof callback !== 'function') {\n\t\t\t\tthrow new Error('Invalid or missing callback for event listener `' + listenerDescription + '`');\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tid: prefix + '_' + index + '_' + listenerDescription,\n\t\t\t\tsourceName: sourceName,\n\t\t\t\teventName: eventName,\n\t\t\t\tcallback: callback,\n\t\t\t\tscope: scope\n\t\t\t};\n\t\t}, this);\n\t}\n\t_toggleLifecycleListeners(onOrOff) {\n\t\tthis._parentComponent[onOrOff]('set_' + this._entityPropertyName, this._onSetEntity, this);\n\t\tthis._parentComponent.system[onOrOff]('beforeremove', this._onParentComponentRemove, this);\n\t\tthis._app.systems[onOrOff]('postPostInitialize', this._updateEntityReference, this);\n\t\tthis._app[onOrOff]('tools:sceneloaded', this._onSceneLoaded, this);\n\t\tconst allComponentSystems = [];\n\t\tfor (let i = 0; i < this._eventListenerConfigs.length; ++i) {\n\t\t\tconst config = this._eventListenerConfigs[i];\n\t\t\tconst componentSystem = this._app.systems[config.sourceName];\n\t\t\tif (componentSystem) {\n\t\t\t\tif (allComponentSystems.indexOf(componentSystem) === -1) {\n\t\t\t\t\tallComponentSystems.push(componentSystem);\n\t\t\t\t}\n\t\t\t\tif (componentSystem && config.eventName === 'gain') {\n\t\t\t\t\tthis._gainListeners[config.sourceName] = config;\n\t\t\t\t}\n\t\t\t\tif (componentSystem && config.eventName === 'lose') {\n\t\t\t\t\tthis._loseListeners[config.sourceName] = config;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor (let i = 0; i < allComponentSystems.length; ++i) {\n\t\t\tallComponentSystems[i][onOrOff]('add', this._onComponentAdd, this);\n\t\t\tallComponentSystems[i][onOrOff]('beforeremove', this._onComponentRemove, this);\n\t\t}\n\t}\n\t_onSetEntity(name, oldValue, newValue) {\n\t\tif (newValue instanceof Entity) {\n\t\t\tthis._updateEntityReference();\n\t\t} else {\n\t\t\tif (newValue !== null && newValue !== undefined && typeof newValue !== 'string') {\n\t\t\t\tconsole.warn(\"Entity field `\" + this._entityPropertyName + \"` was set to unexpected type '\" + typeof newValue + \"'\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (oldValue !== newValue) {\n\t\t\t\tthis._updateEntityReference();\n\t\t\t}\n\t\t}\n\t}\n\tonParentComponentEnable() {\n\t\tif (!this._entity) {\n\t\t\tthis._updateEntityReference();\n\t\t}\n\t}\n\t_onSceneLoaded() {\n\t\tthis._updateEntityReference();\n\t}\n\t_updateEntityReference() {\n\t\tlet nextEntityGuid = this._parentComponent.data[this._entityPropertyName];\n\t\tlet nextEntity;\n\t\tif (nextEntityGuid instanceof Entity) {\n\t\t\tnextEntity = nextEntityGuid;\n\t\t\tnextEntityGuid = nextEntity.getGuid();\n\t\t\tthis._parentComponent.data[this._entityPropertyName] = nextEntityGuid;\n\t\t} else {\n\t\t\tconst root = this._parentComponent.system.app.root;\n\t\t\tconst isOnSceneGraph = this._parentComponent.entity.isDescendantOf(root);\n\t\t\tnextEntity = isOnSceneGraph && nextEntityGuid ? root.findByGuid(nextEntityGuid) : null;\n\t\t}\n\t\tconst hasChanged = this._entity !== nextEntity;\n\t\tif (hasChanged) {\n\t\t\tif (this._entity) {\n\t\t\t\tthis._onBeforeEntityChange();\n\t\t\t}\n\t\t\tthis._entity = nextEntity;\n\t\t\tif (this._entity) {\n\t\t\t\tthis._onAfterEntityChange();\n\t\t\t}\n\t\t\tthis.fire('set:entity', this._entity);\n\t\t}\n\t}\n\t_onBeforeEntityChange() {\n\t\tthis._toggleEntityListeners('off');\n\t\tthis._callAllGainOrLoseListeners(this._loseListeners);\n\t}\n\t_onAfterEntityChange() {\n\t\tthis._toggleEntityListeners('on');\n\t\tthis._callAllGainOrLoseListeners(this._gainListeners);\n\t}\n\t_onComponentAdd(entity, component) {\n\t\tconst componentName = component.system.id;\n\t\tif (entity === this._entity) {\n\t\t\tthis._callGainOrLoseListener(componentName, this._gainListeners);\n\t\t\tthis._toggleComponentListeners('on', componentName);\n\t\t}\n\t}\n\t_onComponentRemove(entity, component) {\n\t\tconst componentName = component.system.id;\n\t\tif (entity === this._entity) {\n\t\t\tthis._callGainOrLoseListener(componentName, this._loseListeners);\n\t\t\tthis._toggleComponentListeners('off', componentName, true);\n\t\t}\n\t}\n\t_callAllGainOrLoseListeners(listenerMap) {\n\t\tfor (const componentName in this._entity.c) {\n\t\t\tthis._callGainOrLoseListener(componentName, listenerMap);\n\t\t}\n\t}\n\t_callGainOrLoseListener(componentName, listenerMap) {\n\t\tif (this._entity.c.hasOwnProperty(componentName) && listenerMap[componentName]) {\n\t\t\tconst config = listenerMap[componentName];\n\t\t\tconfig.callback.call(config.scope);\n\t\t}\n\t}\n\t_toggleEntityListeners(onOrOff, isDestroying) {\n\t\tif (this._entity) {\n\t\t\tfor (let i = 0; i < this._eventListenerConfigs.length; ++i) {\n\t\t\t\tthis._safeToggleListener(onOrOff, this._eventListenerConfigs[i], isDestroying);\n\t\t\t}\n\t\t}\n\t}\n\t_toggleComponentListeners(onOrOff, componentName, isDestroying) {\n\t\tfor (let i = 0; i < this._eventListenerConfigs.length; ++i) {\n\t\t\tconst config = this._eventListenerConfigs[i];\n\t\t\tif (config.sourceName === componentName) {\n\t\t\t\tthis._safeToggleListener(onOrOff, config, isDestroying);\n\t\t\t}\n\t\t}\n\t}\n\t_safeToggleListener(onOrOff, config, isDestroying) {\n\t\tconst isAdding = onOrOff === 'on';\n\t\tif (isAdding && this._listenerStatusFlags[config.id]) {\n\t\t\treturn;\n\t\t}\n\t\tconst source = this._getEventSource(config.sourceName, isDestroying);\n\t\tif (source) {\n\t\t\tsource[onOrOff](config.eventName, config.callback, config.scope);\n\t\t\tthis._listenerStatusFlags[config.id] = isAdding;\n\t\t}\n\t}\n\t_getEventSource(sourceName, isDestroying) {\n\t\tif (sourceName === 'entity') {\n\t\t\treturn this._entity;\n\t\t}\n\t\tconst component = this._entity[sourceName];\n\t\tif (component) {\n\t\t\treturn component;\n\t\t}\n\t\tif (!isDestroying) {\n\t\t\tconsole.warn('Entity has no component with name ' + sourceName);\n\t\t}\n\t\treturn null;\n\t}\n\t_onEntityDestroy(entity) {\n\t\tif (this._entity === entity) {\n\t\t\tthis._toggleEntityListeners('off', true);\n\t\t\tthis._entity = null;\n\t\t}\n\t}\n\t_onParentComponentRemove(entity, component) {\n\t\tif (component === this._parentComponent) {\n\t\t\tthis._toggleLifecycleListeners('off');\n\t\t\tthis._toggleEntityListeners('off', true);\n\t\t}\n\t}\n\thasComponent(componentName) {\n\t\treturn this._entity && this._entity.c ? !!this._entity.c[componentName] : false;\n\t}\n\tget entity() {\n\t\treturn this._entity;\n\t}\n}\n\nexport { EntityReference };\n","const BUTTON_TRANSITION_MODE_TINT = 0;\nconst BUTTON_TRANSITION_MODE_SPRITE_CHANGE = 1;\n\nexport { BUTTON_TRANSITION_MODE_SPRITE_CHANGE, BUTTON_TRANSITION_MODE_TINT };\n","const ELEMENTTYPE_GROUP = 'group';\nconst ELEMENTTYPE_IMAGE = 'image';\nconst ELEMENTTYPE_TEXT = 'text';\nconst FITMODE_STRETCH = 'stretch';\nconst FITMODE_CONTAIN = 'contain';\nconst FITMODE_COVER = 'cover';\n\nexport { ELEMENTTYPE_GROUP, ELEMENTTYPE_IMAGE, ELEMENTTYPE_TEXT, FITMODE_CONTAIN, FITMODE_COVER, FITMODE_STRETCH };\n","import { now } from '../../../core/time.js';\nimport { math } from '../../../core/math/math.js';\nimport { Color } from '../../../core/math/color.js';\nimport { EntityReference } from '../../utils/entity-reference.js';\nimport { Component } from '../component.js';\nimport { BUTTON_TRANSITION_MODE_SPRITE_CHANGE, BUTTON_TRANSITION_MODE_TINT } from './constants.js';\nimport { ELEMENTTYPE_GROUP } from '../element/constants.js';\n\nconst VisualState = {\n\tDEFAULT: 'DEFAULT',\n\tHOVER: 'HOVER',\n\tPRESSED: 'PRESSED',\n\tINACTIVE: 'INACTIVE'\n};\nconst STATES_TO_TINT_NAMES = {};\nSTATES_TO_TINT_NAMES[VisualState.DEFAULT] = '_defaultTint';\nSTATES_TO_TINT_NAMES[VisualState.HOVER] = 'hoverTint';\nSTATES_TO_TINT_NAMES[VisualState.PRESSED] = 'pressedTint';\nSTATES_TO_TINT_NAMES[VisualState.INACTIVE] = 'inactiveTint';\nconst STATES_TO_SPRITE_ASSET_NAMES = {};\nSTATES_TO_SPRITE_ASSET_NAMES[VisualState.DEFAULT] = '_defaultSpriteAsset';\nSTATES_TO_SPRITE_ASSET_NAMES[VisualState.HOVER] = 'hoverSpriteAsset';\nSTATES_TO_SPRITE_ASSET_NAMES[VisualState.PRESSED] = 'pressedSpriteAsset';\nSTATES_TO_SPRITE_ASSET_NAMES[VisualState.INACTIVE] = 'inactiveSpriteAsset';\nconst STATES_TO_SPRITE_FRAME_NAMES = {};\nSTATES_TO_SPRITE_FRAME_NAMES[VisualState.DEFAULT] = '_defaultSpriteFrame';\nSTATES_TO_SPRITE_FRAME_NAMES[VisualState.HOVER] = 'hoverSpriteFrame';\nSTATES_TO_SPRITE_FRAME_NAMES[VisualState.PRESSED] = 'pressedSpriteFrame';\nSTATES_TO_SPRITE_FRAME_NAMES[VisualState.INACTIVE] = 'inactiveSpriteFrame';\nclass ButtonComponent extends Component {\n\tconstructor(system, entity) {\n\t\tsuper(system, entity);\n\t\tthis._visualState = VisualState.DEFAULT;\n\t\tthis._isHovering = false;\n\t\tthis._hoveringCounter = 0;\n\t\tthis._isPressed = false;\n\t\tthis._defaultTint = new Color(1, 1, 1, 1);\n\t\tthis._defaultSpriteAsset = null;\n\t\tthis._defaultSpriteFrame = 0;\n\t\tthis._imageReference = new EntityReference(this, 'imageEntity', {\n\t\t\t'element#gain': this._onImageElementGain,\n\t\t\t'element#lose': this._onImageElementLose,\n\t\t\t'element#set:color': this._onSetColor,\n\t\t\t'element#set:opacity': this._onSetOpacity,\n\t\t\t'element#set:spriteAsset': this._onSetSpriteAsset,\n\t\t\t'element#set:spriteFrame': this._onSetSpriteFrame\n\t\t});\n\t\tthis._toggleLifecycleListeners('on', system);\n\t}\n\t_toggleLifecycleListeners(onOrOff, system) {\n\t\tthis[onOrOff]('set_active', this._onSetActive, this);\n\t\tthis[onOrOff]('set_transitionMode', this._onSetTransitionMode, this);\n\t\tthis[onOrOff]('set_hoverTint', this._onSetTransitionValue, this);\n\t\tthis[onOrOff]('set_pressedTint', this._onSetTransitionValue, this);\n\t\tthis[onOrOff]('set_inactiveTint', this._onSetTransitionValue, this);\n\t\tthis[onOrOff]('set_hoverSpriteAsset', this._onSetTransitionValue, this);\n\t\tthis[onOrOff]('set_hoverSpriteFrame', this._onSetTransitionValue, this);\n\t\tthis[onOrOff]('set_pressedSpriteAsset', this._onSetTransitionValue, this);\n\t\tthis[onOrOff]('set_pressedSpriteFrame', this._onSetTransitionValue, this);\n\t\tthis[onOrOff]('set_inactiveSpriteAsset', this._onSetTransitionValue, this);\n\t\tthis[onOrOff]('set_inactiveSpriteFrame', this._onSetTransitionValue, this);\n\t\tsystem.app.systems.element[onOrOff]('add', this._onElementComponentAdd, this);\n\t\tsystem.app.systems.element[onOrOff]('beforeremove', this._onElementComponentRemove, this);\n\t}\n\t_onSetActive(name, oldValue, newValue) {\n\t\tif (oldValue !== newValue) {\n\t\t\tthis._updateVisualState();\n\t\t}\n\t}\n\t_onSetTransitionMode(name, oldValue, newValue) {\n\t\tif (oldValue !== newValue) {\n\t\t\tthis._cancelTween();\n\t\t\tthis._resetToDefaultVisualState(oldValue);\n\t\t\tthis._forceReapplyVisualState();\n\t\t}\n\t}\n\t_onSetTransitionValue(name, oldValue, newValue) {\n\t\tif (oldValue !== newValue) {\n\t\t\tthis._forceReapplyVisualState();\n\t\t}\n\t}\n\t_onElementComponentRemove(entity) {\n\t\tif (this.entity === entity) {\n\t\t\tthis._toggleHitElementListeners('off');\n\t\t}\n\t}\n\t_onElementComponentAdd(entity) {\n\t\tif (this.entity === entity) {\n\t\t\tthis._toggleHitElementListeners('on');\n\t\t}\n\t}\n\t_onImageElementLose() {\n\t\tthis._cancelTween();\n\t\tthis._resetToDefaultVisualState(this.transitionMode);\n\t}\n\t_onImageElementGain() {\n\t\tthis._storeDefaultVisualState();\n\t\tthis._forceReapplyVisualState();\n\t}\n\t_toggleHitElementListeners(onOrOff) {\n\t\tif (this.entity.element) {\n\t\t\tconst isAdding = onOrOff === 'on';\n\t\t\tif (isAdding && this._hasHitElementListeners) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.entity.element[onOrOff]('mouseenter', this._onMouseEnter, this);\n\t\t\tthis.entity.element[onOrOff]('mouseleave', this._onMouseLeave, this);\n\t\t\tthis.entity.element[onOrOff]('mousedown', this._onMouseDown, this);\n\t\t\tthis.entity.element[onOrOff]('mouseup', this._onMouseUp, this);\n\t\t\tthis.entity.element[onOrOff]('touchstart', this._onTouchStart, this);\n\t\t\tthis.entity.element[onOrOff]('touchend', this._onTouchEnd, this);\n\t\t\tthis.entity.element[onOrOff]('touchleave', this._onTouchLeave, this);\n\t\t\tthis.entity.element[onOrOff]('touchcancel', this._onTouchCancel, this);\n\t\t\tthis.entity.element[onOrOff]('selectstart', this._onSelectStart, this);\n\t\t\tthis.entity.element[onOrOff]('selectend', this._onSelectEnd, this);\n\t\t\tthis.entity.element[onOrOff]('selectenter', this._onSelectEnter, this);\n\t\t\tthis.entity.element[onOrOff]('selectleave', this._onSelectLeave, this);\n\t\t\tthis.entity.element[onOrOff]('click', this._onClick, this);\n\t\t\tthis._hasHitElementListeners = isAdding;\n\t\t}\n\t}\n\t_storeDefaultVisualState() {\n\t\tif (this._imageReference.hasComponent('element')) {\n\t\t\tconst element = this._imageReference.entity.element;\n\t\t\tif (element.type !== ELEMENTTYPE_GROUP) {\n\t\t\t\tthis._storeDefaultColor(element.color);\n\t\t\t\tthis._storeDefaultOpacity(element.opacity);\n\t\t\t\tthis._storeDefaultSpriteAsset(element.spriteAsset);\n\t\t\t\tthis._storeDefaultSpriteFrame(element.spriteFrame);\n\t\t\t}\n\t\t}\n\t}\n\t_storeDefaultColor(color) {\n\t\tthis._defaultTint.r = color.r;\n\t\tthis._defaultTint.g = color.g;\n\t\tthis._defaultTint.b = color.b;\n\t}\n\t_storeDefaultOpacity(opacity) {\n\t\tthis._defaultTint.a = opacity;\n\t}\n\t_storeDefaultSpriteAsset(spriteAsset) {\n\t\tthis._defaultSpriteAsset = spriteAsset;\n\t}\n\t_storeDefaultSpriteFrame(spriteFrame) {\n\t\tthis._defaultSpriteFrame = spriteFrame;\n\t}\n\t_onSetColor(color) {\n\t\tif (!this._isApplyingTint) {\n\t\t\tthis._storeDefaultColor(color);\n\t\t\tthis._forceReapplyVisualState();\n\t\t}\n\t}\n\t_onSetOpacity(opacity) {\n\t\tif (!this._isApplyingTint) {\n\t\t\tthis._storeDefaultOpacity(opacity);\n\t\t\tthis._forceReapplyVisualState();\n\t\t}\n\t}\n\t_onSetSpriteAsset(spriteAsset) {\n\t\tif (!this._isApplyingSprite) {\n\t\t\tthis._storeDefaultSpriteAsset(spriteAsset);\n\t\t\tthis._forceReapplyVisualState();\n\t\t}\n\t}\n\t_onSetSpriteFrame(spriteFrame) {\n\t\tif (!this._isApplyingSprite) {\n\t\t\tthis._storeDefaultSpriteFrame(spriteFrame);\n\t\t\tthis._forceReapplyVisualState();\n\t\t}\n\t}\n\t_onMouseEnter(event) {\n\t\tthis._isHovering = true;\n\t\tthis._updateVisualState();\n\t\tthis._fireIfActive('mouseenter', event);\n\t}\n\t_onMouseLeave(event) {\n\t\tthis._isHovering = false;\n\t\tthis._isPressed = false;\n\t\tthis._updateVisualState();\n\t\tthis._fireIfActive('mouseleave', event);\n\t}\n\t_onMouseDown(event) {\n\t\tthis._isPressed = true;\n\t\tthis._updateVisualState();\n\t\tthis._fireIfActive('mousedown', event);\n\t}\n\t_onMouseUp(event) {\n\t\tthis._isPressed = false;\n\t\tthis._updateVisualState();\n\t\tthis._fireIfActive('mouseup', event);\n\t}\n\t_onTouchStart(event) {\n\t\tthis._isPressed = true;\n\t\tthis._updateVisualState();\n\t\tthis._fireIfActive('touchstart', event);\n\t}\n\t_onTouchEnd(event) {\n\t\tevent.event.preventDefault();\n\t\tthis._isPressed = false;\n\t\tthis._updateVisualState();\n\t\tthis._fireIfActive('touchend', event);\n\t}\n\t_onTouchLeave(event) {\n\t\tthis._isPressed = false;\n\t\tthis._updateVisualState();\n\t\tthis._fireIfActive('touchleave', event);\n\t}\n\t_onTouchCancel(event) {\n\t\tthis._isPressed = false;\n\t\tthis._updateVisualState();\n\t\tthis._fireIfActive('touchcancel', event);\n\t}\n\t_onSelectStart(event) {\n\t\tthis._isPressed = true;\n\t\tthis._updateVisualState();\n\t\tthis._fireIfActive('selectstart', event);\n\t}\n\t_onSelectEnd(event) {\n\t\tthis._isPressed = false;\n\t\tthis._updateVisualState();\n\t\tthis._fireIfActive('selectend', event);\n\t}\n\t_onSelectEnter(event) {\n\t\tthis._hoveringCounter++;\n\t\tif (this._hoveringCounter === 1) {\n\t\t\tthis._isHovering = true;\n\t\t\tthis._updateVisualState();\n\t\t}\n\t\tthis._fireIfActive('selectenter', event);\n\t}\n\t_onSelectLeave(event) {\n\t\tthis._hoveringCounter--;\n\t\tif (this._hoveringCounter === 0) {\n\t\t\tthis._isHovering = false;\n\t\t\tthis._isPressed = false;\n\t\t\tthis._updateVisualState();\n\t\t}\n\t\tthis._fireIfActive('selectleave', event);\n\t}\n\t_onClick(event) {\n\t\tthis._fireIfActive('click', event);\n\t}\n\t_fireIfActive(name, event) {\n\t\tif (this.data.active) {\n\t\t\tthis.fire(name, event);\n\t\t}\n\t}\n\t_updateVisualState(force) {\n\t\tconst oldVisualState = this._visualState;\n\t\tconst newVisualState = this._determineVisualState();\n\t\tif ((oldVisualState !== newVisualState || force) && this.enabled) {\n\t\t\tthis._visualState = newVisualState;\n\t\t\tif (oldVisualState === VisualState.HOVER) {\n\t\t\t\tthis._fireIfActive('hoverend');\n\t\t\t}\n\t\t\tif (oldVisualState === VisualState.PRESSED) {\n\t\t\t\tthis._fireIfActive('pressedend');\n\t\t\t}\n\t\t\tif (newVisualState === VisualState.HOVER) {\n\t\t\t\tthis._fireIfActive('hoverstart');\n\t\t\t}\n\t\t\tif (newVisualState === VisualState.PRESSED) {\n\t\t\t\tthis._fireIfActive('pressedstart');\n\t\t\t}\n\t\t\tswitch (this.transitionMode) {\n\t\t\t\tcase BUTTON_TRANSITION_MODE_TINT:\n\t\t\t\t\t{\n\t\t\t\t\t\tconst tintName = STATES_TO_TINT_NAMES[this._visualState];\n\t\t\t\t\t\tconst tintColor = this[tintName];\n\t\t\t\t\t\tthis._applyTint(tintColor);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tcase BUTTON_TRANSITION_MODE_SPRITE_CHANGE:\n\t\t\t\t\t{\n\t\t\t\t\t\tconst spriteAssetName = STATES_TO_SPRITE_ASSET_NAMES[this._visualState];\n\t\t\t\t\t\tconst spriteFrameName = STATES_TO_SPRITE_FRAME_NAMES[this._visualState];\n\t\t\t\t\t\tconst spriteAsset = this[spriteAssetName];\n\t\t\t\t\t\tconst spriteFrame = this[spriteFrameName];\n\t\t\t\t\t\tthis._applySprite(spriteAsset, spriteFrame);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t_forceReapplyVisualState() {\n\t\tthis._updateVisualState(true);\n\t}\n\t_resetToDefaultVisualState(transitionMode) {\n\t\tif (this._imageReference.hasComponent('element')) {\n\t\t\tswitch (transitionMode) {\n\t\t\t\tcase BUTTON_TRANSITION_MODE_TINT:\n\t\t\t\t\tthis._cancelTween();\n\t\t\t\t\tthis._applyTintImmediately(this._defaultTint);\n\t\t\t\t\tbreak;\n\t\t\t\tcase BUTTON_TRANSITION_MODE_SPRITE_CHANGE:\n\t\t\t\t\tthis._applySprite(this._defaultSpriteAsset, this._defaultSpriteFrame);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\t_determineVisualState() {\n\t\tif (!this.active) {\n\t\t\treturn VisualState.INACTIVE;\n\t\t} else if (this._isPressed) {\n\t\t\treturn VisualState.PRESSED;\n\t\t} else if (this._isHovering) {\n\t\t\treturn VisualState.HOVER;\n\t\t}\n\t\treturn VisualState.DEFAULT;\n\t}\n\t_applySprite(spriteAsset, spriteFrame) {\n\t\tspriteFrame = spriteFrame || 0;\n\t\tif (this._imageReference.hasComponent('element')) {\n\t\t\tthis._isApplyingSprite = true;\n\t\t\tif (this._imageReference.entity.element.spriteAsset !== spriteAsset) {\n\t\t\t\tthis._imageReference.entity.element.spriteAsset = spriteAsset;\n\t\t\t}\n\t\t\tif (this._imageReference.entity.element.spriteFrame !== spriteFrame) {\n\t\t\t\tthis._imageReference.entity.element.spriteFrame = spriteFrame;\n\t\t\t}\n\t\t\tthis._isApplyingSprite = false;\n\t\t}\n\t}\n\t_applyTint(tintColor) {\n\t\tthis._cancelTween();\n\t\tif (this.fadeDuration === 0) {\n\t\t\tthis._applyTintImmediately(tintColor);\n\t\t} else {\n\t\t\tthis._applyTintWithTween(tintColor);\n\t\t}\n\t}\n\t_applyTintImmediately(tintColor) {\n\t\tif (!tintColor || !this._imageReference.hasComponent('element') || this._imageReference.entity.element.type === ELEMENTTYPE_GROUP) return;\n\t\tconst color3 = toColor3(tintColor);\n\t\tthis._isApplyingTint = true;\n\t\tif (!color3.equals(this._imageReference.entity.element.color)) this._imageReference.entity.element.color = color3;\n\t\tif (this._imageReference.entity.element.opacity !== tintColor.a) this._imageReference.entity.element.opacity = tintColor.a;\n\t\tthis._isApplyingTint = false;\n\t}\n\t_applyTintWithTween(tintColor) {\n\t\tif (!tintColor || !this._imageReference.hasComponent('element') || this._imageReference.entity.element.type === ELEMENTTYPE_GROUP) return;\n\t\tconst color3 = toColor3(tintColor);\n\t\tconst color = this._imageReference.entity.element.color;\n\t\tconst opacity = this._imageReference.entity.element.opacity;\n\t\tif (color3.equals(color) && tintColor.a === opacity) return;\n\t\tthis._tweenInfo = {\n\t\t\tstartTime: now(),\n\t\t\tfrom: new Color(color.r, color.g, color.b, opacity),\n\t\t\tto: tintColor.clone(),\n\t\t\tlerpColor: new Color()\n\t\t};\n\t}\n\t_updateTintTween() {\n\t\tconst elapsedTime = now() - this._tweenInfo.startTime;\n\t\tlet elapsedProportion = this.fadeDuration === 0 ? 1 : elapsedTime / this.fadeDuration;\n\t\telapsedProportion = math.clamp(elapsedProportion, 0, 1);\n\t\tif (Math.abs(elapsedProportion - 1) > 1e-5) {\n\t\t\tconst lerpColor = this._tweenInfo.lerpColor;\n\t\t\tlerpColor.lerp(this._tweenInfo.from, this._tweenInfo.to, elapsedProportion);\n\t\t\tthis._applyTintImmediately(new Color(lerpColor.r, lerpColor.g, lerpColor.b, lerpColor.a));\n\t\t} else {\n\t\t\tthis._applyTintImmediately(this._tweenInfo.to);\n\t\t\tthis._cancelTween();\n\t\t}\n\t}\n\t_cancelTween() {\n\t\tdelete this._tweenInfo;\n\t}\n\tonUpdate() {\n\t\tif (this._tweenInfo) {\n\t\t\tthis._updateTintTween();\n\t\t}\n\t}\n\tonEnable() {\n\t\tthis._isHovering = false;\n\t\tthis._hoveringCounter = 0;\n\t\tthis._isPressed = false;\n\t\tthis._imageReference.onParentComponentEnable();\n\t\tthis._toggleHitElementListeners('on');\n\t\tthis._forceReapplyVisualState();\n\t}\n\tonDisable() {\n\t\tthis._toggleHitElementListeners('off');\n\t\tthis._resetToDefaultVisualState(this.transitionMode);\n\t}\n\tonRemove() {\n\t\tthis._toggleLifecycleListeners('off', this.system);\n\t\tthis.onDisable();\n\t}\n}\nfunction toColor3(color4) {\n\treturn new Color(color4.r, color4.g, color4.b);\n}\n\nexport { ButtonComponent };\n","import { Color } from '../../../core/math/color.js';\nimport { Vec4 } from '../../../core/math/vec4.js';\nimport { BUTTON_TRANSITION_MODE_TINT } from './constants.js';\n\nclass ButtonComponentData {\n\tconstructor() {\n\t\tthis.enabled = true;\n\t\tthis.active = true;\n\t\tthis.imageEntity = null;\n\t\tthis.hitPadding = new Vec4();\n\t\tthis.transitionMode = BUTTON_TRANSITION_MODE_TINT;\n\t\tthis.hoverTint = new Color(0.75, 0.75, 0.75);\n\t\tthis.pressedTint = new Color(0.5, 0.5, 0.5);\n\t\tthis.inactiveTint = new Color(0.25, 0.25, 0.25);\n\t\tthis.fadeDuration = 0;\n\t\tthis.hoverSpriteAsset = null;\n\t\tthis.hoverSpriteFrame = 0;\n\t\tthis.pressedSpriteAsset = null;\n\t\tthis.pressedSpriteFrame = 0;\n\t\tthis.inactiveSpriteAsset = null;\n\t\tthis.inactiveSpriteFrame = 0;\n\t}\n}\n\nexport { ButtonComponentData };\n","import { Component } from '../component.js';\nimport { ComponentSystem } from '../system.js';\nimport { ButtonComponent } from './component.js';\nimport { ButtonComponentData } from './data.js';\n\nconst _schema = ['enabled', 'active', {\n\tname: 'imageEntity',\n\ttype: 'entity'\n}, {\n\tname: 'hitPadding',\n\ttype: 'vec4'\n}, 'transitionMode', {\n\tname: 'hoverTint',\n\ttype: 'rgba'\n}, {\n\tname: 'pressedTint',\n\ttype: 'rgba'\n}, {\n\tname: 'inactiveTint',\n\ttype: 'rgba'\n}, 'fadeDuration', 'hoverSpriteAsset', 'hoverSpriteFrame', 'pressedSpriteAsset', 'pressedSpriteFrame', 'inactiveSpriteAsset', 'inactiveSpriteFrame'];\nclass ButtonComponentSystem extends ComponentSystem {\n\tconstructor(app) {\n\t\tsuper(app);\n\t\tthis.id = 'button';\n\t\tthis.ComponentType = ButtonComponent;\n\t\tthis.DataType = ButtonComponentData;\n\t\tthis.schema = _schema;\n\t\tthis.on('beforeremove', this._onRemoveComponent, this);\n\t\tthis.app.systems.on('update', this.onUpdate, this);\n\t}\n\tinitializeComponentData(component, data, properties) {\n\t\tsuper.initializeComponentData(component, data, _schema);\n\t}\n\tonUpdate(dt) {\n\t\tconst components = this.store;\n\t\tfor (const id in components) {\n\t\t\tconst entity = components[id].entity;\n\t\t\tconst component = entity.button;\n\t\t\tif (component.enabled && entity.enabled) {\n\t\t\t\tcomponent.onUpdate();\n\t\t\t}\n\t\t}\n\t}\n\t_onRemoveComponent(entity, component) {\n\t\tcomponent.onRemove();\n\t}\n\tdestroy() {\n\t\tsuper.destroy();\n\t\tthis.app.systems.off('update', this.onUpdate, this);\n\t}\n}\nComponent._buildAccessors(ButtonComponent.prototype, _schema);\n\nexport { ButtonComponentSystem };\n","import { Quat } from '../../../core/math/quat.js';\nimport { Vec3 } from '../../../core/math/vec3.js';\nimport { Asset } from '../../asset/asset.js';\nimport { Component } from '../component.js';\n\nconst _vec3 = new Vec3();\nconst _quat = new Quat();\nclass CollisionComponent extends Component {\n\tconstructor(system, entity) {\n\t\tsuper(system, entity);\n\t\tthis._compoundParent = null;\n\t\tthis._hasOffset = false;\n\t\tthis.entity.on('insert', this._onInsert, this);\n\t\tthis.on('set_type', this.onSetType, this);\n\t\tthis.on('set_halfExtents', this.onSetHalfExtents, this);\n\t\tthis.on('set_linearOffset', this.onSetOffset, this);\n\t\tthis.on('set_angularOffset', this.onSetOffset, this);\n\t\tthis.on('set_radius', this.onSetRadius, this);\n\t\tthis.on('set_height', this.onSetHeight, this);\n\t\tthis.on('set_axis', this.onSetAxis, this);\n\t\tthis.on('set_asset', this.onSetAsset, this);\n\t\tthis.on('set_renderAsset', this.onSetRenderAsset, this);\n\t\tthis.on('set_model', this.onSetModel, this);\n\t\tthis.on('set_render', this.onSetRender, this);\n\t}\n\tonSetType(name, oldValue, newValue) {\n\t\tif (oldValue !== newValue) {\n\t\t\tthis.system.changeType(this, oldValue, newValue);\n\t\t}\n\t}\n\tonSetHalfExtents(name, oldValue, newValue) {\n\t\tconst t = this.data.type;\n\t\tif (this.data.initialized && t === 'box') {\n\t\t\tthis.system.recreatePhysicalShapes(this);\n\t\t}\n\t}\n\tonSetOffset(name, oldValue, newValue) {\n\t\tthis._hasOffset = !this.data.linearOffset.equals(Vec3.ZERO) || !this.data.angularOffset.equals(Quat.IDENTITY);\n\t\tif (this.data.initialized) {\n\t\t\tthis.system.recreatePhysicalShapes(this);\n\t\t}\n\t}\n\tonSetRadius(name, oldValue, newValue) {\n\t\tconst t = this.data.type;\n\t\tif (this.data.initialized && (t === 'sphere' || t === 'capsule' || t === 'cylinder' || t === 'cone')) {\n\t\t\tthis.system.recreatePhysicalShapes(this);\n\t\t}\n\t}\n\tonSetHeight(name, oldValue, newValue) {\n\t\tconst t = this.data.type;\n\t\tif (this.data.initialized && (t === 'capsule' || t === 'cylinder' || t === 'cone')) {\n\t\t\tthis.system.recreatePhysicalShapes(this);\n\t\t}\n\t}\n\tonSetAxis(name, oldValue, newValue) {\n\t\tconst t = this.data.type;\n\t\tif (this.data.initialized && (t === 'capsule' || t === 'cylinder' || t === 'cone')) {\n\t\t\tthis.system.recreatePhysicalShapes(this);\n\t\t}\n\t}\n\tonSetAsset(name, oldValue, newValue) {\n\t\tconst assets = this.system.app.assets;\n\t\tif (oldValue) {\n\t\t\tconst asset = assets.get(oldValue);\n\t\t\tif (asset) {\n\t\t\t\tasset.off('remove', this.onAssetRemoved, this);\n\t\t\t}\n\t\t}\n\t\tif (newValue) {\n\t\t\tif (newValue instanceof Asset) {\n\t\t\t\tthis.data.asset = newValue.id;\n\t\t\t}\n\t\t\tconst asset = assets.get(this.data.asset);\n\t\t\tif (asset) {\n\t\t\t\tasset.off('remove', this.onAssetRemoved, this);\n\t\t\t\tasset.on('remove', this.onAssetRemoved, this);\n\t\t\t}\n\t\t}\n\t\tif (this.data.initialized && this.data.type === 'mesh') {\n\t\t\tif (!newValue) {\n\t\t\t\tthis.data.model = null;\n\t\t\t}\n\t\t\tthis.system.recreatePhysicalShapes(this);\n\t\t}\n\t}\n\tonSetRenderAsset(name, oldValue, newValue) {\n\t\tconst assets = this.system.app.assets;\n\t\tif (oldValue) {\n\t\t\tconst asset = assets.get(oldValue);\n\t\t\tif (asset) {\n\t\t\t\tasset.off('remove', this.onRenderAssetRemoved, this);\n\t\t\t}\n\t\t}\n\t\tif (newValue) {\n\t\t\tif (newValue instanceof Asset) {\n\t\t\t\tthis.data.renderAsset = newValue.id;\n\t\t\t}\n\t\t\tconst asset = assets.get(this.data.renderAsset);\n\t\t\tif (asset) {\n\t\t\t\tasset.off('remove', this.onRenderAssetRemoved, this);\n\t\t\t\tasset.on('remove', this.onRenderAssetRemoved, this);\n\t\t\t}\n\t\t}\n\t\tif (this.data.initialized && this.data.type === 'mesh') {\n\t\t\tif (!newValue) {\n\t\t\t\tthis.data.render = null;\n\t\t\t}\n\t\t\tthis.system.recreatePhysicalShapes(this);\n\t\t}\n\t}\n\tonSetModel(name, oldValue, newValue) {\n\t\tif (this.data.initialized && this.data.type === 'mesh') {\n\t\t\tthis.system.implementations.mesh.doRecreatePhysicalShape(this);\n\t\t}\n\t}\n\tonSetRender(name, oldValue, newValue) {\n\t\tthis.onSetModel(name, oldValue, newValue);\n\t}\n\tonAssetRemoved(asset) {\n\t\tasset.off('remove', this.onAssetRemoved, this);\n\t\tif (this.data.asset === asset.id) {\n\t\t\tthis.asset = null;\n\t\t}\n\t}\n\tonRenderAssetRemoved(asset) {\n\t\tasset.off('remove', this.onRenderAssetRemoved, this);\n\t\tif (this.data.renderAsset === asset.id) {\n\t\t\tthis.renderAsset = null;\n\t\t}\n\t}\n\t_getCompoundChildShapeIndex(shape) {\n\t\tconst compound = this.data.shape;\n\t\tconst shapes = compound.getNumChildShapes();\n\t\tfor (let i = 0; i < shapes; i++) {\n\t\t\tconst childShape = compound.getChildShape(i);\n\t\t\tif (childShape.ptr === shape.ptr) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\t_onInsert(parent) {\n\t\tif (typeof Ammo === 'undefined') return;\n\t\tif (this._compoundParent) {\n\t\t\tthis.system.recreatePhysicalShapes(this);\n\t\t} else if (!this.entity.rigidbody) {\n\t\t\tlet ancestor = this.entity.parent;\n\t\t\twhile (ancestor) {\n\t\t\t\tif (ancestor.collision && ancestor.collision.type === 'compound') {\n\t\t\t\t\tif (ancestor.collision.shape.getNumChildShapes() === 0) {\n\t\t\t\t\t\tthis.system.recreatePhysicalShapes(ancestor.collision);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.system.recreatePhysicalShapes(this);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tancestor = ancestor.parent;\n\t\t\t}\n\t\t}\n\t}\n\t_updateCompound() {\n\t\tconst entity = this.entity;\n\t\tif (entity._dirtyWorld) {\n\t\t\tlet dirty = entity._dirtyLocal;\n\t\t\tlet parent = entity;\n\t\t\twhile (parent && !dirty) {\n\t\t\t\tif (parent.collision && parent.collision === this._compoundParent) break;\n\t\t\t\tif (parent._dirtyLocal) dirty = true;\n\t\t\t\tparent = parent.parent;\n\t\t\t}\n\t\t\tif (dirty) {\n\t\t\t\tentity.forEach(this.system.implementations.compound._updateEachDescendantTransform, entity);\n\t\t\t\tconst bodyComponent = this._compoundParent.entity.rigidbody;\n\t\t\t\tif (bodyComponent) bodyComponent.activate();\n\t\t\t}\n\t\t}\n\t}\n\tgetShapePosition() {\n\t\tconst pos = this.entity.getPosition();\n\t\tif (this._hasOffset) {\n\t\t\tconst rot = this.entity.getRotation();\n\t\t\tconst lo = this.data.linearOffset;\n\t\t\t_quat.copy(rot).transformVector(lo, _vec3);\n\t\t\treturn _vec3.add(pos);\n\t\t}\n\t\treturn pos;\n\t}\n\tgetShapeRotation() {\n\t\tconst rot = this.entity.getRotation();\n\t\tif (this._hasOffset) {\n\t\t\treturn _quat.copy(rot).mul(this.data.angularOffset);\n\t\t}\n\t\treturn rot;\n\t}\n\tonEnable() {\n\t\tif (this.data.type === 'mesh' && (this.data.asset || this.data.renderAsset) && this.data.initialized) {\n\t\t\tconst asset = this.system.app.assets.get(this.data.asset || this.data.renderAsset);\n\t\t\tif (asset && (!asset.resource || !this.data.shape)) {\n\t\t\t\tthis.system.recreatePhysicalShapes(this);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tif (this.entity.rigidbody) {\n\t\t\tif (this.entity.rigidbody.enabled) {\n\t\t\t\tthis.entity.rigidbody.enableSimulation();\n\t\t\t}\n\t\t} else if (this._compoundParent && this !== this._compoundParent) {\n\t\t\tif (this._compoundParent.shape.getNumChildShapes() === 0) {\n\t\t\t\tthis.system.recreatePhysicalShapes(this._compoundParent);\n\t\t\t} else {\n\t\t\t\tconst transform = this.system._getNodeTransform(this.entity, this._compoundParent.entity);\n\t\t\t\tthis._compoundParent.shape.addChildShape(transform, this.data.shape);\n\t\t\t\tAmmo.destroy(transform);\n\t\t\t\tif (this._compoundParent.entity.rigidbody) this._compoundParent.entity.rigidbody.activate();\n\t\t\t}\n\t\t} else if (this.entity.trigger) {\n\t\t\tthis.entity.trigger.enable();\n\t\t}\n\t}\n\tonDisable() {\n\t\tif (this.entity.rigidbody) {\n\t\t\tthis.entity.rigidbody.disableSimulation();\n\t\t} else if (this._compoundParent && this !== this._compoundParent) {\n\t\t\tif (!this._compoundParent.entity._destroying) {\n\t\t\t\tthis.system._removeCompoundChild(this._compoundParent, this.data.shape);\n\t\t\t\tif (this._compoundParent.entity.rigidbody) this._compoundParent.entity.rigidbody.activate();\n\t\t\t}\n\t\t} else if (this.entity.trigger) {\n\t\t\tthis.entity.trigger.disable();\n\t\t}\n\t}\n\tonBeforeRemove() {\n\t\tif (this.asset) {\n\t\t\tthis.asset = null;\n\t\t}\n\t\tif (this.renderAsset) {\n\t\t\tthis.renderAsset = null;\n\t\t}\n\t\tthis.entity.off('insert', this._onInsert, this);\n\t\tthis.off();\n\t}\n}\n\nexport { CollisionComponent };\n","import { Quat } from '../../../core/math/quat.js';\nimport { Vec3 } from '../../../core/math/vec3.js';\n\nclass CollisionComponentData {\n\tconstructor() {\n\t\tthis.enabled = true;\n\t\tthis.type = 'box';\n\t\tthis.halfExtents = new Vec3(0.5, 0.5, 0.5);\n\t\tthis.linearOffset = new Vec3();\n\t\tthis.angularOffset = new Quat();\n\t\tthis.radius = 0.5;\n\t\tthis.axis = 1;\n\t\tthis.height = 2;\n\t\tthis.asset = null;\n\t\tthis.renderAsset = null;\n\t\tthis.shape = null;\n\t\tthis.model = null;\n\t\tthis.render = null;\n\t\tthis.initialized = false;\n\t}\n}\n\nexport { CollisionComponentData };\n","const BODYTYPE_STATIC = 'static';\nconst BODYTYPE_DYNAMIC = 'dynamic';\nconst BODYTYPE_KINEMATIC = 'kinematic';\nconst BODYFLAG_STATIC_OBJECT = 1;\nconst BODYFLAG_KINEMATIC_OBJECT = 2;\nconst BODYFLAG_NORESPONSE_OBJECT = 4;\nconst BODYSTATE_ACTIVE_TAG = 1;\nconst BODYSTATE_ISLAND_SLEEPING = 2;\nconst BODYSTATE_WANTS_DEACTIVATION = 3;\nconst BODYSTATE_DISABLE_DEACTIVATION = 4;\nconst BODYSTATE_DISABLE_SIMULATION = 5;\nconst BODYGROUP_NONE = 0;\nconst BODYGROUP_DEFAULT = 1;\nconst BODYGROUP_DYNAMIC = 1;\nconst BODYGROUP_STATIC = 2;\nconst BODYGROUP_KINEMATIC = 4;\nconst BODYGROUP_ENGINE_1 = 8;\nconst BODYGROUP_TRIGGER = 16;\nconst BODYGROUP_ENGINE_2 = 32;\nconst BODYGROUP_ENGINE_3 = 64;\nconst BODYGROUP_USER_1 = 128;\nconst BODYGROUP_USER_2 = 256;\nconst BODYGROUP_USER_3 = 512;\nconst BODYGROUP_USER_4 = 1024;\nconst BODYGROUP_USER_5 = 2048;\nconst BODYGROUP_USER_6 = 4096;\nconst BODYGROUP_USER_7 = 8192;\nconst BODYGROUP_USER_8 = 16384;\nconst BODYMASK_NONE = 0;\nconst BODYMASK_ALL = 65535;\nconst BODYMASK_STATIC = 2;\nconst BODYMASK_NOT_STATIC = 65535 ^ 2;\nconst BODYMASK_NOT_STATIC_KINEMATIC = 65535 ^ (2 | 4);\n\nexport { BODYFLAG_KINEMATIC_OBJECT, BODYFLAG_NORESPONSE_OBJECT, BODYFLAG_STATIC_OBJECT, BODYGROUP_DEFAULT, BODYGROUP_DYNAMIC, BODYGROUP_ENGINE_1, BODYGROUP_ENGINE_2, BODYGROUP_ENGINE_3, BODYGROUP_KINEMATIC, BODYGROUP_NONE, BODYGROUP_STATIC, BODYGROUP_TRIGGER, BODYGROUP_USER_1, BODYGROUP_USER_2, BODYGROUP_USER_3, BODYGROUP_USER_4, BODYGROUP_USER_5, BODYGROUP_USER_6, BODYGROUP_USER_7, BODYGROUP_USER_8, BODYMASK_ALL, BODYMASK_NONE, BODYMASK_NOT_STATIC, BODYMASK_NOT_STATIC_KINEMATIC, BODYMASK_STATIC, BODYSTATE_ACTIVE_TAG, BODYSTATE_DISABLE_DEACTIVATION, BODYSTATE_DISABLE_SIMULATION, BODYSTATE_ISLAND_SLEEPING, BODYSTATE_WANTS_DEACTIVATION, BODYTYPE_DYNAMIC, BODYTYPE_KINEMATIC, BODYTYPE_STATIC };\n","import { BODYFLAG_NORESPONSE_OBJECT, BODYGROUP_TRIGGER, BODYMASK_NOT_STATIC, BODYSTATE_ACTIVE_TAG, BODYSTATE_DISABLE_SIMULATION } from '../rigid-body/constants.js';\n\nlet _ammoVec1, _ammoQuat, _ammoTransform;\nclass Trigger {\n\tconstructor(app, component, data) {\n\t\tthis.entity = component.entity;\n\t\tthis.component = component;\n\t\tthis.app = app;\n\t\tif (typeof Ammo !== 'undefined' && !_ammoVec1) {\n\t\t\t_ammoVec1 = new Ammo.btVector3();\n\t\t\t_ammoQuat = new Ammo.btQuaternion();\n\t\t\t_ammoTransform = new Ammo.btTransform();\n\t\t}\n\t\tthis.initialize(data);\n\t}\n\tinitialize(data) {\n\t\tconst entity = this.entity;\n\t\tconst shape = data.shape;\n\t\tif (shape && typeof Ammo !== 'undefined') {\n\t\t\tif (entity.trigger) {\n\t\t\t\tentity.trigger.destroy();\n\t\t\t}\n\t\t\tconst mass = 1;\n\t\t\tconst component = this.component;\n\t\t\tif (component) {\n\t\t\t\tconst bodyPos = component.getShapePosition();\n\t\t\t\tconst bodyRot = component.getShapeRotation();\n\t\t\t\t_ammoVec1.setValue(bodyPos.x, bodyPos.y, bodyPos.z);\n\t\t\t\t_ammoQuat.setValue(bodyRot.x, bodyRot.y, bodyRot.z, bodyRot.w);\n\t\t\t} else {\n\t\t\t\tconst pos = entity.getPosition();\n\t\t\t\tconst rot = entity.getRotation();\n\t\t\t\t_ammoVec1.setValue(pos.x, pos.y, pos.z);\n\t\t\t\t_ammoQuat.setValue(rot.x, rot.y, rot.z, rot.w);\n\t\t\t}\n\t\t\t_ammoTransform.setOrigin(_ammoVec1);\n\t\t\t_ammoTransform.setRotation(_ammoQuat);\n\t\t\tconst body = this.app.systems.rigidbody.createBody(mass, shape, _ammoTransform);\n\t\t\tbody.setRestitution(0);\n\t\t\tbody.setFriction(0);\n\t\t\tbody.setDamping(0, 0);\n\t\t\t_ammoVec1.setValue(0, 0, 0);\n\t\t\tbody.setLinearFactor(_ammoVec1);\n\t\t\tbody.setAngularFactor(_ammoVec1);\n\t\t\tbody.setCollisionFlags(body.getCollisionFlags() | BODYFLAG_NORESPONSE_OBJECT);\n\t\t\tbody.entity = entity;\n\t\t\tthis.body = body;\n\t\t\tif (this.component.enabled && entity.enabled) {\n\t\t\t\tthis.enable();\n\t\t\t}\n\t\t}\n\t}\n\tdestroy() {\n\t\tconst body = this.body;\n\t\tif (!body) return;\n\t\tthis.disable();\n\t\tthis.app.systems.rigidbody.destroyBody(body);\n\t}\n\t_getEntityTransform(transform) {\n\t\tconst component = this.component;\n\t\tif (component) {\n\t\t\tconst bodyPos = component.getShapePosition();\n\t\t\tconst bodyRot = component.getShapeRotation();\n\t\t\t_ammoVec1.setValue(bodyPos.x, bodyPos.y, bodyPos.z);\n\t\t\t_ammoQuat.setValue(bodyRot.x, bodyRot.y, bodyRot.z, bodyRot.w);\n\t\t} else {\n\t\t\tconst pos = this.entity.getPosition();\n\t\t\tconst rot = this.entity.getRotation();\n\t\t\t_ammoVec1.setValue(pos.x, pos.y, pos.z);\n\t\t\t_ammoQuat.setValue(rot.x, rot.y, rot.z, rot.w);\n\t\t}\n\t\ttransform.setOrigin(_ammoVec1);\n\t\ttransform.setRotation(_ammoQuat);\n\t}\n\tupdateTransform() {\n\t\tthis._getEntityTransform(_ammoTransform);\n\t\tconst body = this.body;\n\t\tbody.setWorldTransform(_ammoTransform);\n\t\tbody.activate();\n\t}\n\tenable() {\n\t\tconst body = this.body;\n\t\tif (!body) return;\n\t\tconst systems = this.app.systems;\n\t\tsystems.rigidbody.addBody(body, BODYGROUP_TRIGGER, BODYMASK_NOT_STATIC ^ BODYGROUP_TRIGGER);\n\t\tsystems.rigidbody._triggers.push(this);\n\t\tbody.forceActivationState(BODYSTATE_ACTIVE_TAG);\n\t\tthis.updateTransform();\n\t}\n\tdisable() {\n\t\tconst body = this.body;\n\t\tif (!body) return;\n\t\tconst systems = this.app.systems;\n\t\tconst idx = systems.rigidbody._triggers.indexOf(this);\n\t\tif (idx > -1) {\n\t\t\tsystems.rigidbody._triggers.splice(idx, 1);\n\t\t}\n\t\tsystems.rigidbody.removeBody(body);\n\t\tbody.forceActivationState(BODYSTATE_DISABLE_SIMULATION);\n\t}\n}\n\nexport { Trigger };\n","import '../../../core/tracing.js';\nimport { Mat4 } from '../../../core/math/mat4.js';\nimport { Quat } from '../../../core/math/quat.js';\nimport { Vec3 } from '../../../core/math/vec3.js';\nimport { SEMANTIC_POSITION } from '../../../platform/graphics/constants.js';\nimport { GraphNode } from '../../../scene/graph-node.js';\nimport { Model } from '../../../scene/model.js';\nimport { Component } from '../component.js';\nimport { ComponentSystem } from '../system.js';\nimport { CollisionComponent } from './component.js';\nimport { CollisionComponentData } from './data.js';\nimport { Trigger } from './trigger.js';\n\nconst mat4 = new Mat4();\nconst p1 = new Vec3();\nconst p2 = new Vec3();\nconst quat = new Quat();\nconst tempGraphNode = new GraphNode();\nconst _schema = ['enabled', 'type', 'halfExtents', 'linearOffset', 'angularOffset', 'radius', 'axis', 'height', 'asset', 'renderAsset', 'shape', 'model', 'render'];\nclass CollisionSystemImpl {\n\tconstructor(system) {\n\t\tthis.system = system;\n\t}\n\tbeforeInitialize(component, data) {\n\t\tdata.shape = null;\n\t\tdata.model = new Model();\n\t\tdata.model.graph = new GraphNode();\n\t}\n\tafterInitialize(component, data) {\n\t\tthis.recreatePhysicalShapes(component);\n\t\tcomponent.data.initialized = true;\n\t}\n\treset(component, data) {\n\t\tthis.beforeInitialize(component, data);\n\t\tthis.afterInitialize(component, data);\n\t}\n\trecreatePhysicalShapes(component) {\n\t\tconst entity = component.entity;\n\t\tconst data = component.data;\n\t\tif (typeof Ammo !== 'undefined') {\n\t\t\tif (entity.trigger) {\n\t\t\t\tentity.trigger.destroy();\n\t\t\t\tdelete entity.trigger;\n\t\t\t}\n\t\t\tif (data.shape) {\n\t\t\t\tif (component._compoundParent) {\n\t\t\t\t\tthis.system._removeCompoundChild(component._compoundParent, data.shape);\n\t\t\t\t\tif (component._compoundParent.entity.rigidbody) component._compoundParent.entity.rigidbody.activate();\n\t\t\t\t}\n\t\t\t\tthis.destroyShape(data);\n\t\t\t}\n\t\t\tdata.shape = this.createPhysicalShape(component.entity, data);\n\t\t\tconst firstCompoundChild = !component._compoundParent;\n\t\t\tif (data.type === 'compound' && (!component._compoundParent || component === component._compoundParent)) {\n\t\t\t\tcomponent._compoundParent = component;\n\t\t\t\tentity.forEach(this._addEachDescendant, component);\n\t\t\t} else if (data.type !== 'compound') {\n\t\t\t\tif (component._compoundParent && component === component._compoundParent) {\n\t\t\t\t\tentity.forEach(this.system.implementations.compound._updateEachDescendant, component);\n\t\t\t\t}\n\t\t\t\tif (!component.rigidbody) {\n\t\t\t\t\tcomponent._compoundParent = null;\n\t\t\t\t\tlet parent = entity.parent;\n\t\t\t\t\twhile (parent) {\n\t\t\t\t\t\tif (parent.collision && parent.collision.type === 'compound') {\n\t\t\t\t\t\t\tcomponent._compoundParent = parent.collision;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tparent = parent.parent;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (component._compoundParent) {\n\t\t\t\tif (component !== component._compoundParent) {\n\t\t\t\t\tif (firstCompoundChild && component._compoundParent.shape.getNumChildShapes() === 0) {\n\t\t\t\t\t\tthis.system.recreatePhysicalShapes(component._compoundParent);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.system.updateCompoundChildTransform(entity);\n\t\t\t\t\t\tif (component._compoundParent.entity.rigidbody) component._compoundParent.entity.rigidbody.activate();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (entity.rigidbody) {\n\t\t\t\tentity.rigidbody.disableSimulation();\n\t\t\t\tentity.rigidbody.createBody();\n\t\t\t\tif (entity.enabled && entity.rigidbody.enabled) {\n\t\t\t\t\tentity.rigidbody.enableSimulation();\n\t\t\t\t}\n\t\t\t} else if (!component._compoundParent) {\n\t\t\t\tif (!entity.trigger) {\n\t\t\t\t\tentity.trigger = new Trigger(this.system.app, component, data);\n\t\t\t\t} else {\n\t\t\t\t\tentity.trigger.initialize(data);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tcreatePhysicalShape(entity, data) {\n\t\treturn undefined;\n\t}\n\tupdateTransform(component, position, rotation, scale) {\n\t\tif (component.entity.trigger) {\n\t\t\tcomponent.entity.trigger.updateTransform();\n\t\t}\n\t}\n\tdestroyShape(data) {\n\t\tif (data.shape) {\n\t\t\tAmmo.destroy(data.shape);\n\t\t\tdata.shape = null;\n\t\t}\n\t}\n\tbeforeRemove(entity, component) {\n\t\tif (component.data.shape) {\n\t\t\tif (component._compoundParent && !component._compoundParent.entity._destroying) {\n\t\t\t\tthis.system._removeCompoundChild(component._compoundParent, component.data.shape);\n\t\t\t\tif (component._compoundParent.entity.rigidbody) component._compoundParent.entity.rigidbody.activate();\n\t\t\t}\n\t\t\tcomponent._compoundParent = null;\n\t\t\tthis.destroyShape(component.data);\n\t\t}\n\t}\n\tremove(entity, data) {\n\t\tif (entity.rigidbody && entity.rigidbody.body) {\n\t\t\tentity.rigidbody.disableSimulation();\n\t\t}\n\t\tif (entity.trigger) {\n\t\t\tentity.trigger.destroy();\n\t\t\tdelete entity.trigger;\n\t\t}\n\t}\n\tclone(entity, clone) {\n\t\tconst src = this.system.store[entity.getGuid()];\n\t\tconst data = {\n\t\t\tenabled: src.data.enabled,\n\t\t\ttype: src.data.type,\n\t\t\thalfExtents: [src.data.halfExtents.x, src.data.halfExtents.y, src.data.halfExtents.z],\n\t\t\tlinearOffset: [src.data.linearOffset.x, src.data.linearOffset.y, src.data.linearOffset.z],\n\t\t\tangularOffset: [src.data.angularOffset.x, src.data.angularOffset.y, src.data.angularOffset.z, src.data.angularOffset.w],\n\t\t\tradius: src.data.radius,\n\t\t\taxis: src.data.axis,\n\t\t\theight: src.data.height,\n\t\t\tasset: src.data.asset,\n\t\t\trenderAsset: src.data.renderAsset,\n\t\t\tmodel: src.data.model,\n\t\t\trender: src.data.render\n\t\t};\n\t\treturn this.system.addComponent(clone, data);\n\t}\n}\nclass CollisionBoxSystemImpl extends CollisionSystemImpl {\n\tcreatePhysicalShape(entity, data) {\n\t\tif (typeof Ammo !== 'undefined') {\n\t\t\tconst he = data.halfExtents;\n\t\t\tconst ammoHe = new Ammo.btVector3(he ? he.x : 0.5, he ? he.y : 0.5, he ? he.z : 0.5);\n\t\t\tconst shape = new Ammo.btBoxShape(ammoHe);\n\t\t\tAmmo.destroy(ammoHe);\n\t\t\treturn shape;\n\t\t}\n\t\treturn undefined;\n\t}\n}\nclass CollisionSphereSystemImpl extends CollisionSystemImpl {\n\tcreatePhysicalShape(entity, data) {\n\t\tif (typeof Ammo !== 'undefined') {\n\t\t\treturn new Ammo.btSphereShape(data.radius);\n\t\t}\n\t\treturn undefined;\n\t}\n}\nclass CollisionCapsuleSystemImpl extends CollisionSystemImpl {\n\tcreatePhysicalShape(entity, data) {\n\t\tvar _data$axis, _data$radius, _data$height;\n\t\tconst axis = (_data$axis = data.axis) != null ? _data$axis : 1;\n\t\tconst radius = (_data$radius = data.radius) != null ? _data$radius : 0.5;\n\t\tconst height = Math.max(((_data$height = data.height) != null ? _data$height : 2) - 2 * radius, 0);\n\t\tlet shape = null;\n\t\tif (typeof Ammo !== 'undefined') {\n\t\t\tswitch (axis) {\n\t\t\t\tcase 0:\n\t\t\t\t\tshape = new Ammo.btCapsuleShapeX(radius, height);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 1:\n\t\t\t\t\tshape = new Ammo.btCapsuleShape(radius, height);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\tshape = new Ammo.btCapsuleShapeZ(radius, height);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn shape;\n\t}\n}\nclass CollisionCylinderSystemImpl extends CollisionSystemImpl {\n\tcreatePhysicalShape(entity, data) {\n\t\tvar _data$axis2, _data$radius2, _data$height2;\n\t\tconst axis = (_data$axis2 = data.axis) != null ? _data$axis2 : 1;\n\t\tconst radius = (_data$radius2 = data.radius) != null ? _data$radius2 : 0.5;\n\t\tconst height = (_data$height2 = data.height) != null ? _data$height2 : 1;\n\t\tlet halfExtents = null;\n\t\tlet shape = null;\n\t\tif (typeof Ammo !== 'undefined') {\n\t\t\tswitch (axis) {\n\t\t\t\tcase 0:\n\t\t\t\t\thalfExtents = new Ammo.btVector3(height * 0.5, radius, radius);\n\t\t\t\t\tshape = new Ammo.btCylinderShapeX(halfExtents);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 1:\n\t\t\t\t\thalfExtents = new Ammo.btVector3(radius, height * 0.5, radius);\n\t\t\t\t\tshape = new Ammo.btCylinderShape(halfExtents);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\thalfExtents = new Ammo.btVector3(radius, radius, height * 0.5);\n\t\t\t\t\tshape = new Ammo.btCylinderShapeZ(halfExtents);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (halfExtents) Ammo.destroy(halfExtents);\n\t\treturn shape;\n\t}\n}\nclass CollisionConeSystemImpl extends CollisionSystemImpl {\n\tcreatePhysicalShape(entity, data) {\n\t\tvar _data$axis3, _data$radius3, _data$height3;\n\t\tconst axis = (_data$axis3 = data.axis) != null ? _data$axis3 : 1;\n\t\tconst radius = (_data$radius3 = data.radius) != null ? _data$radius3 : 0.5;\n\t\tconst height = (_data$height3 = data.height) != null ? _data$height3 : 1;\n\t\tlet shape = null;\n\t\tif (typeof Ammo !== 'undefined') {\n\t\t\tswitch (axis) {\n\t\t\t\tcase 0:\n\t\t\t\t\tshape = new Ammo.btConeShapeX(radius, height);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 1:\n\t\t\t\t\tshape = new Ammo.btConeShape(radius, height);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\tshape = new Ammo.btConeShapeZ(radius, height);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn shape;\n\t}\n}\nclass CollisionMeshSystemImpl extends CollisionSystemImpl {\n\tbeforeInitialize(component, data) {}\n\tcreateAmmoMesh(mesh, node, shape) {\n\t\tlet triMesh;\n\t\tif (this.system._triMeshCache[mesh.id]) {\n\t\t\ttriMesh = this.system._triMeshCache[mesh.id];\n\t\t} else {\n\t\t\tconst vb = mesh.vertexBuffer;\n\t\t\tconst format = vb.getFormat();\n\t\t\tlet stride;\n\t\t\tlet positions;\n\t\t\tfor (let i = 0; i < format.elements.length; i++) {\n\t\t\t\tconst element = format.elements[i];\n\t\t\t\tif (element.name === SEMANTIC_POSITION) {\n\t\t\t\t\tpositions = new Float32Array(vb.lock(), element.offset);\n\t\t\t\t\tstride = element.stride / 4;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst indices = [];\n\t\t\tmesh.getIndices(indices);\n\t\t\tconst numTriangles = mesh.primitive[0].count / 3;\n\t\t\tconst v1 = new Ammo.btVector3();\n\t\t\tconst v2 = new Ammo.btVector3();\n\t\t\tconst v3 = new Ammo.btVector3();\n\t\t\tlet i1, i2, i3;\n\t\t\tconst base = mesh.primitive[0].base;\n\t\t\ttriMesh = new Ammo.btTriangleMesh();\n\t\t\tthis.system._triMeshCache[mesh.id] = triMesh;\n\t\t\tfor (let i = 0; i < numTriangles; i++) {\n\t\t\t\ti1 = indices[base + i * 3] * stride;\n\t\t\t\ti2 = indices[base + i * 3 + 1] * stride;\n\t\t\t\ti3 = indices[base + i * 3 + 2] * stride;\n\t\t\t\tv1.setValue(positions[i1], positions[i1 + 1], positions[i1 + 2]);\n\t\t\t\tv2.setValue(positions[i2], positions[i2 + 1], positions[i2 + 2]);\n\t\t\t\tv3.setValue(positions[i3], positions[i3 + 1], positions[i3 + 2]);\n\t\t\t\ttriMesh.addTriangle(v1, v2, v3, true);\n\t\t\t}\n\t\t\tAmmo.destroy(v1);\n\t\t\tAmmo.destroy(v2);\n\t\t\tAmmo.destroy(v3);\n\t\t}\n\t\tconst useQuantizedAabbCompression = true;\n\t\tconst triMeshShape = new Ammo.btBvhTriangleMeshShape(triMesh, useQuantizedAabbCompression);\n\t\tconst scaling = this.system._getNodeScaling(node);\n\t\ttriMeshShape.setLocalScaling(scaling);\n\t\tAmmo.destroy(scaling);\n\t\tconst transform = this.system._getNodeTransform(node);\n\t\tshape.addChildShape(transform, triMeshShape);\n\t\tAmmo.destroy(transform);\n\t}\n\tcreatePhysicalShape(entity, data) {\n\t\tif (typeof Ammo === 'undefined') return undefined;\n\t\tif (data.model || data.render) {\n\t\t\tconst shape = new Ammo.btCompoundShape();\n\t\t\tif (data.model) {\n\t\t\t\tconst meshInstances = data.model.meshInstances;\n\t\t\t\tfor (let i = 0; i < meshInstances.length; i++) {\n\t\t\t\t\tthis.createAmmoMesh(meshInstances[i].mesh, meshInstances[i].node, shape);\n\t\t\t\t}\n\t\t\t} else if (data.render) {\n\t\t\t\tconst meshes = data.render.meshes;\n\t\t\t\tfor (let i = 0; i < meshes.length; i++) {\n\t\t\t\t\tthis.createAmmoMesh(meshes[i], tempGraphNode, shape);\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst entityTransform = entity.getWorldTransform();\n\t\t\tconst scale = entityTransform.getScale();\n\t\t\tconst vec = new Ammo.btVector3(scale.x, scale.y, scale.z);\n\t\t\tshape.setLocalScaling(vec);\n\t\t\tAmmo.destroy(vec);\n\t\t\treturn shape;\n\t\t}\n\t\treturn undefined;\n\t}\n\trecreatePhysicalShapes(component) {\n\t\tconst data = component.data;\n\t\tif (data.renderAsset || data.asset) {\n\t\t\tif (component.enabled && component.entity.enabled) {\n\t\t\t\tthis.loadAsset(component, data.renderAsset || data.asset, data.renderAsset ? 'render' : 'model');\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tthis.doRecreatePhysicalShape(component);\n\t}\n\tloadAsset(component, id, property) {\n\t\tconst data = component.data;\n\t\tconst assets = this.system.app.assets;\n\t\tconst previousPropertyValue = data[property];\n\t\tconst onAssetFullyReady = asset => {\n\t\t\tif (data[property] !== previousPropertyValue) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tdata[property] = asset.resource;\n\t\t\tthis.doRecreatePhysicalShape(component);\n\t\t};\n\t\tconst loadAndHandleAsset = asset => {\n\t\t\tasset.ready(asset => {\n\t\t\t\tif (asset.data.containerAsset) {\n\t\t\t\t\tconst containerAsset = assets.get(asset.data.containerAsset);\n\t\t\t\t\tif (containerAsset.loaded) {\n\t\t\t\t\t\tonAssetFullyReady(asset);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcontainerAsset.ready(() => {\n\t\t\t\t\t\t\tonAssetFullyReady(asset);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tassets.load(containerAsset);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tonAssetFullyReady(asset);\n\t\t\t\t}\n\t\t\t});\n\t\t\tassets.load(asset);\n\t\t};\n\t\tconst asset = assets.get(id);\n\t\tif (asset) {\n\t\t\tloadAndHandleAsset(asset);\n\t\t} else {\n\t\t\tassets.once('add:' + id, loadAndHandleAsset);\n\t\t}\n\t}\n\tdoRecreatePhysicalShape(component) {\n\t\tconst entity = component.entity;\n\t\tconst data = component.data;\n\t\tif (data.model || data.render) {\n\t\t\tthis.destroyShape(data);\n\t\t\tdata.shape = this.createPhysicalShape(entity, data);\n\t\t\tif (entity.rigidbody) {\n\t\t\t\tentity.rigidbody.disableSimulation();\n\t\t\t\tentity.rigidbody.createBody();\n\t\t\t\tif (entity.enabled && entity.rigidbody.enabled) {\n\t\t\t\t\tentity.rigidbody.enableSimulation();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (!entity.trigger) {\n\t\t\t\t\tentity.trigger = new Trigger(this.system.app, component, data);\n\t\t\t\t} else {\n\t\t\t\t\tentity.trigger.initialize(data);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthis.beforeRemove(entity, component);\n\t\t\tthis.remove(entity, data);\n\t\t}\n\t}\n\tupdateTransform(component, position, rotation, scale) {\n\t\tif (component.shape) {\n\t\t\tconst entityTransform = component.entity.getWorldTransform();\n\t\t\tconst worldScale = entityTransform.getScale();\n\t\t\tconst previousScale = component.shape.getLocalScaling();\n\t\t\tif (worldScale.x !== previousScale.x() || worldScale.y !== previousScale.y() || worldScale.z !== previousScale.z()) {\n\t\t\t\tthis.doRecreatePhysicalShape(component);\n\t\t\t}\n\t\t}\n\t\tsuper.updateTransform(component, position, rotation, scale);\n\t}\n\tdestroyShape(data) {\n\t\tif (!data.shape) return;\n\t\tconst numShapes = data.shape.getNumChildShapes();\n\t\tfor (let i = 0; i < numShapes; i++) {\n\t\t\tconst shape = data.shape.getChildShape(i);\n\t\t\tAmmo.destroy(shape);\n\t\t}\n\t\tAmmo.destroy(data.shape);\n\t\tdata.shape = null;\n\t}\n}\nclass CollisionCompoundSystemImpl extends CollisionSystemImpl {\n\tcreatePhysicalShape(entity, data) {\n\t\tif (typeof Ammo !== 'undefined') {\n\t\t\treturn new Ammo.btCompoundShape();\n\t\t}\n\t\treturn undefined;\n\t}\n\t_addEachDescendant(entity) {\n\t\tif (!entity.collision || entity.rigidbody) return;\n\t\tentity.collision._compoundParent = this;\n\t\tif (entity !== this.entity) {\n\t\t\tentity.collision.system.recreatePhysicalShapes(entity.collision);\n\t\t}\n\t}\n\t_updateEachDescendant(entity) {\n\t\tif (!entity.collision) return;\n\t\tif (entity.collision._compoundParent !== this) return;\n\t\tentity.collision._compoundParent = null;\n\t\tif (entity !== this.entity && !entity.rigidbody) {\n\t\t\tentity.collision.system.recreatePhysicalShapes(entity.collision);\n\t\t}\n\t}\n\t_updateEachDescendantTransform(entity) {\n\t\tif (!entity.collision || entity.collision._compoundParent !== this.collision._compoundParent) return;\n\t\tthis.collision.system.updateCompoundChildTransform(entity);\n\t}\n}\nclass CollisionComponentSystem extends ComponentSystem {\n\tconstructor(app) {\n\t\tsuper(app);\n\t\tthis.id = 'collision';\n\t\tthis.ComponentType = CollisionComponent;\n\t\tthis.DataType = CollisionComponentData;\n\t\tthis.schema = _schema;\n\t\tthis.implementations = {};\n\t\tthis._triMeshCache = {};\n\t\tthis.on('beforeremove', this.onBeforeRemove, this);\n\t\tthis.on('remove', this.onRemove, this);\n\t}\n\tinitializeComponentData(component, _data, properties) {\n\t\tproperties = ['type', 'halfExtents', 'radius', 'axis', 'height', 'shape', 'model', 'asset', 'render', 'renderAsset', 'enabled', 'linearOffset', 'angularOffset'];\n\t\tconst data = {};\n\t\tfor (let i = 0, len = properties.length; i < len; i++) {\n\t\t\tconst property = properties[i];\n\t\t\tdata[property] = _data[property];\n\t\t}\n\t\tlet idx;\n\t\tif (_data.hasOwnProperty('asset')) {\n\t\t\tidx = properties.indexOf('model');\n\t\t\tif (idx !== -1) {\n\t\t\t\tproperties.splice(idx, 1);\n\t\t\t}\n\t\t\tidx = properties.indexOf('render');\n\t\t\tif (idx !== -1) {\n\t\t\t\tproperties.splice(idx, 1);\n\t\t\t}\n\t\t} else if (_data.hasOwnProperty('model')) {\n\t\t\tidx = properties.indexOf('asset');\n\t\t\tif (idx !== -1) {\n\t\t\t\tproperties.splice(idx, 1);\n\t\t\t}\n\t\t}\n\t\tif (!data.type) {\n\t\t\tdata.type = component.data.type;\n\t\t}\n\t\tcomponent.data.type = data.type;\n\t\tif (Array.isArray(data.halfExtents)) {\n\t\t\tdata.halfExtents = new Vec3(data.halfExtents);\n\t\t}\n\t\tif (Array.isArray(data.linearOffset)) {\n\t\t\tdata.linearOffset = new Vec3(data.linearOffset);\n\t\t}\n\t\tif (Array.isArray(data.angularOffset)) {\n\t\t\tconst values = data.angularOffset;\n\t\t\tif (values.length === 3) {\n\t\t\t\tdata.angularOffset = new Quat().setFromEulerAngles(values[0], values[1], values[2]);\n\t\t\t} else {\n\t\t\t\tdata.angularOffset = new Quat(data.angularOffset);\n\t\t\t}\n\t\t}\n\t\tconst impl = this._createImplementation(data.type);\n\t\timpl.beforeInitialize(component, data);\n\t\tsuper.initializeComponentData(component, data, properties);\n\t\timpl.afterInitialize(component, data);\n\t}\n\t_createImplementation(type) {\n\t\tif (this.implementations[type] === undefined) {\n\t\t\tlet impl;\n\t\t\tswitch (type) {\n\t\t\t\tcase 'box':\n\t\t\t\t\timpl = new CollisionBoxSystemImpl(this);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'sphere':\n\t\t\t\t\timpl = new CollisionSphereSystemImpl(this);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'capsule':\n\t\t\t\t\timpl = new CollisionCapsuleSystemImpl(this);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'cylinder':\n\t\t\t\t\timpl = new CollisionCylinderSystemImpl(this);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'cone':\n\t\t\t\t\timpl = new CollisionConeSystemImpl(this);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'mesh':\n\t\t\t\t\timpl = new CollisionMeshSystemImpl(this);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'compound':\n\t\t\t\t\timpl = new CollisionCompoundSystemImpl(this);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tthis.implementations[type] = impl;\n\t\t}\n\t\treturn this.implementations[type];\n\t}\n\t_getImplementation(entity) {\n\t\treturn this.implementations[entity.collision.data.type];\n\t}\n\tcloneComponent(entity, clone) {\n\t\treturn this._getImplementation(entity).clone(entity, clone);\n\t}\n\tonBeforeRemove(entity, component) {\n\t\tthis.implementations[component.data.type].beforeRemove(entity, component);\n\t\tcomponent.onBeforeRemove();\n\t}\n\tonRemove(entity, data) {\n\t\tthis.implementations[data.type].remove(entity, data);\n\t}\n\tupdateCompoundChildTransform(entity) {\n\t\tthis._removeCompoundChild(entity.collision._compoundParent, entity.collision.data.shape);\n\t\tif (entity.enabled && entity.collision.enabled) {\n\t\t\tconst transform = this._getNodeTransform(entity, entity.collision._compoundParent.entity);\n\t\t\tentity.collision._compoundParent.shape.addChildShape(transform, entity.collision.data.shape);\n\t\t\tAmmo.destroy(transform);\n\t\t}\n\t}\n\t_removeCompoundChild(collision, shape) {\n\t\tif (collision.shape.removeChildShape) {\n\t\t\tcollision.shape.removeChildShape(shape);\n\t\t} else {\n\t\t\tconst ind = collision._getCompoundChildShapeIndex(shape);\n\t\t\tif (ind !== null) {\n\t\t\t\tcollision.shape.removeChildShapeByIndex(ind);\n\t\t\t}\n\t\t}\n\t}\n\tonTransformChanged(component, position, rotation, scale) {\n\t\tthis.implementations[component.data.type].updateTransform(component, position, rotation, scale);\n\t}\n\tchangeType(component, previousType, newType) {\n\t\tthis.implementations[previousType].beforeRemove(component.entity, component);\n\t\tthis.implementations[previousType].remove(component.entity, component.data);\n\t\tthis._createImplementation(newType).reset(component, component.data);\n\t}\n\trecreatePhysicalShapes(component) {\n\t\tthis.implementations[component.data.type].recreatePhysicalShapes(component);\n\t}\n\t_calculateNodeRelativeTransform(node, relative) {\n\t\tif (node === relative) {\n\t\t\tconst scale = node.getWorldTransform().getScale();\n\t\t\tmat4.setScale(scale.x, scale.y, scale.z);\n\t\t} else {\n\t\t\tthis._calculateNodeRelativeTransform(node.parent, relative);\n\t\t\tmat4.mul(node.getLocalTransform());\n\t\t}\n\t}\n\t_getNodeScaling(node) {\n\t\tconst wtm = node.getWorldTransform();\n\t\tconst scl = wtm.getScale();\n\t\treturn new Ammo.btVector3(scl.x, scl.y, scl.z);\n\t}\n\t_getNodeTransform(node, relative) {\n\t\tlet pos, rot;\n\t\tif (relative) {\n\t\t\tthis._calculateNodeRelativeTransform(node, relative);\n\t\t\tpos = p1;\n\t\t\trot = quat;\n\t\t\tmat4.getTranslation(pos);\n\t\t\trot.setFromMat4(mat4);\n\t\t} else {\n\t\t\tpos = node.getPosition();\n\t\t\trot = node.getRotation();\n\t\t}\n\t\tconst ammoQuat = new Ammo.btQuaternion();\n\t\tconst transform = new Ammo.btTransform();\n\t\ttransform.setIdentity();\n\t\tconst origin = transform.getOrigin();\n\t\tconst component = node.collision;\n\t\tif (component && component._hasOffset) {\n\t\t\tconst lo = component.data.linearOffset;\n\t\t\tconst ao = component.data.angularOffset;\n\t\t\tconst newOrigin = p2;\n\t\t\tquat.copy(rot).transformVector(lo, newOrigin);\n\t\t\tnewOrigin.add(pos);\n\t\t\tquat.copy(rot).mul(ao);\n\t\t\torigin.setValue(newOrigin.x, newOrigin.y, newOrigin.z);\n\t\t\tammoQuat.setValue(quat.x, quat.y, quat.z, quat.w);\n\t\t} else {\n\t\t\torigin.setValue(pos.x, pos.y, pos.z);\n\t\t\tammoQuat.setValue(rot.x, rot.y, rot.z, rot.w);\n\t\t}\n\t\ttransform.setRotation(ammoQuat);\n\t\tAmmo.destroy(ammoQuat);\n\t\tAmmo.destroy(origin);\n\t\treturn transform;\n\t}\n\tdestroy() {\n\t\tfor (const key in this._triMeshCache) {\n\t\t\tAmmo.destroy(this._triMeshCache[key]);\n\t\t}\n\t\tthis._triMeshCache = null;\n\t\tsuper.destroy();\n\t}\n}\nComponent._buildAccessors(CollisionComponent.prototype, _schema);\n\nexport { CollisionComponentSystem };\n","import '../../../core/tracing.js';\nimport { math } from '../../../core/math/math.js';\nimport { Color } from '../../../core/math/color.js';\nimport { Vec2 } from '../../../core/math/vec2.js';\nimport { Vec3 } from '../../../core/math/vec3.js';\nimport { Vec4 } from '../../../core/math/vec4.js';\nimport { SEMANTIC_POSITION, TYPE_FLOAT32, SEMANTIC_NORMAL, SEMANTIC_TEXCOORD0, BUFFER_STATIC, PRIMITIVE_TRISTRIP, FUNC_EQUAL, STENCILOP_DECREMENT } from '../../../platform/graphics/constants.js';\nimport { VertexBuffer } from '../../../platform/graphics/vertex-buffer.js';\nimport { VertexFormat } from '../../../platform/graphics/vertex-format.js';\nimport { DeviceCache } from '../../../platform/graphics/device-cache.js';\nimport { SPRITE_RENDERMODE_SLICED, SPRITE_RENDERMODE_TILED, LAYER_HUD, LAYER_WORLD, SPRITE_RENDERMODE_SIMPLE } from '../../../scene/constants.js';\nimport { GraphNode } from '../../../scene/graph-node.js';\nimport { Mesh } from '../../../scene/mesh.js';\nimport { MeshInstance } from '../../../scene/mesh-instance.js';\nimport { Model } from '../../../scene/model.js';\nimport { StencilParameters } from '../../../platform/graphics/stencil-parameters.js';\nimport { FITMODE_STRETCH, FITMODE_CONTAIN, FITMODE_COVER } from './constants.js';\nimport { Asset } from '../../asset/asset.js';\n\nconst _vertexFormatDeviceCache = new DeviceCache();\nclass ImageRenderable {\n\tconstructor(entity, mesh, material) {\n\t\tthis._entity = entity;\n\t\tthis._element = entity.element;\n\t\tthis.model = new Model();\n\t\tthis.node = new GraphNode();\n\t\tthis.model.graph = this.node;\n\t\tthis.mesh = mesh;\n\t\tthis.meshInstance = new MeshInstance(this.mesh, material, this.node);\n\t\tthis.meshInstance.name = 'ImageElement: ' + entity.name;\n\t\tthis.meshInstance.castShadow = false;\n\t\tthis.meshInstance.receiveShadow = false;\n\t\tthis._meshDirty = false;\n\t\tthis.model.meshInstances.push(this.meshInstance);\n\t\tthis._entity.addChild(this.model.graph);\n\t\tthis.model._entity = this._entity;\n\t\tthis.unmaskMeshInstance = null;\n\t}\n\tdestroy() {\n\t\tthis.setMaterial(null);\n\t\tthis._element.removeModelFromLayers(this.model);\n\t\tthis.model.destroy();\n\t\tthis.model = null;\n\t\tthis.node = null;\n\t\tthis.mesh = null;\n\t\tthis.meshInstance = null;\n\t\tthis._entity = null;\n\t\tthis._element = null;\n\t}\n\tsetMesh(mesh) {\n\t\tif (!this.meshInstance) return;\n\t\tthis.mesh = mesh;\n\t\tthis.meshInstance.mesh = mesh;\n\t\tthis.meshInstance.visible = !!mesh;\n\t\tif (this.unmaskMeshInstance) {\n\t\t\tthis.unmaskMeshInstance.mesh = mesh;\n\t\t}\n\t\tthis.forceUpdateAabb();\n\t}\n\tsetMask(mask) {\n\t\tif (!this.meshInstance) return;\n\t\tif (mask) {\n\t\t\tthis.unmaskMeshInstance = new MeshInstance(this.mesh, this.meshInstance.material, this.node);\n\t\t\tthis.unmaskMeshInstance.name = 'Unmask: ' + this._entity.name;\n\t\t\tthis.unmaskMeshInstance.castShadow = false;\n\t\t\tthis.unmaskMeshInstance.receiveShadow = false;\n\t\t\tthis.unmaskMeshInstance.pick = false;\n\t\t\tthis.model.meshInstances.push(this.unmaskMeshInstance);\n\t\t\tfor (const name in this.meshInstance.parameters) {\n\t\t\t\tthis.unmaskMeshInstance.setParameter(name, this.meshInstance.parameters[name].data);\n\t\t\t}\n\t\t} else {\n\t\t\tconst idx = this.model.meshInstances.indexOf(this.unmaskMeshInstance);\n\t\t\tif (idx >= 0) {\n\t\t\t\tthis.model.meshInstances.splice(idx, 1);\n\t\t\t}\n\t\t\tthis.unmaskMeshInstance = null;\n\t\t}\n\t\tif (this._entity.enabled && this._element.enabled) {\n\t\t\tthis._element.removeModelFromLayers(this.model);\n\t\t\tthis._element.addModelToLayers(this.model);\n\t\t}\n\t}\n\tsetMaterial(material) {\n\t\tif (!this.meshInstance) return;\n\t\tthis.meshInstance.material = material;\n\t\tif (this.unmaskMeshInstance) {\n\t\t\tthis.unmaskMeshInstance.material = material;\n\t\t}\n\t}\n\tsetParameter(name, value) {\n\t\tif (!this.meshInstance) return;\n\t\tthis.meshInstance.setParameter(name, value);\n\t\tif (this.unmaskMeshInstance) {\n\t\t\tthis.unmaskMeshInstance.setParameter(name, value);\n\t\t}\n\t}\n\tdeleteParameter(name) {\n\t\tif (!this.meshInstance) return;\n\t\tthis.meshInstance.deleteParameter(name);\n\t\tif (this.unmaskMeshInstance) {\n\t\t\tthis.unmaskMeshInstance.deleteParameter(name);\n\t\t}\n\t}\n\tsetUnmaskDrawOrder() {\n\t\tif (!this.meshInstance) return;\n\t\tconst getLastChild = function getLastChild(e) {\n\t\t\tlet last;\n\t\t\tconst c = e.children;\n\t\t\tconst l = c.length;\n\t\t\tif (l) {\n\t\t\t\tfor (let i = 0; i < l; i++) {\n\t\t\t\t\tif (c[i].element) {\n\t\t\t\t\t\tlast = c[i];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!last) return null;\n\t\t\t\tconst child = getLastChild(last);\n\t\t\t\tif (child) {\n\t\t\t\t\treturn child;\n\t\t\t\t}\n\t\t\t\treturn last;\n\t\t\t}\n\t\t\treturn null;\n\t\t};\n\t\tif (this.unmaskMeshInstance) {\n\t\t\tconst lastChild = getLastChild(this._entity);\n\t\t\tif (lastChild && lastChild.element) {\n\t\t\t\tthis.unmaskMeshInstance.drawOrder = lastChild.element.drawOrder + lastChild.element.getMaskOffset();\n\t\t\t} else {\n\t\t\t\tthis.unmaskMeshInstance.drawOrder = this.meshInstance.drawOrder + this._element.getMaskOffset();\n\t\t\t}\n\t\t}\n\t}\n\tsetDrawOrder(drawOrder) {\n\t\tif (!this.meshInstance) return;\n\t\tthis.meshInstance.drawOrder = drawOrder;\n\t}\n\tsetCull(cull) {\n\t\tif (!this.meshInstance) return;\n\t\tconst element = this._element;\n\t\tlet visibleFn = null;\n\t\tif (cull && element._isScreenSpace()) {\n\t\t\tvisibleFn = function (camera) {\n\t\t\t\treturn element.isVisibleForCamera(camera);\n\t\t\t};\n\t\t}\n\t\tthis.meshInstance.cull = cull;\n\t\tthis.meshInstance.isVisibleFunc = visibleFn;\n\t\tif (this.unmaskMeshInstance) {\n\t\t\tthis.unmaskMeshInstance.cull = cull;\n\t\t\tthis.unmaskMeshInstance.isVisibleFunc = visibleFn;\n\t\t}\n\t}\n\tsetScreenSpace(screenSpace) {\n\t\tif (!this.meshInstance) return;\n\t\tthis.meshInstance.screenSpace = screenSpace;\n\t\tif (this.unmaskMeshInstance) {\n\t\t\tthis.unmaskMeshInstance.screenSpace = screenSpace;\n\t\t}\n\t}\n\tsetLayer(layer) {\n\t\tif (!this.meshInstance) return;\n\t\tthis.meshInstance.layer = layer;\n\t\tif (this.unmaskMeshInstance) {\n\t\t\tthis.unmaskMeshInstance.layer = layer;\n\t\t}\n\t}\n\tforceUpdateAabb(mask) {\n\t\tif (!this.meshInstance) return;\n\t\tthis.meshInstance._aabbVer = -1;\n\t\tif (this.unmaskMeshInstance) {\n\t\t\tthis.unmaskMeshInstance._aabbVer = -1;\n\t\t}\n\t}\n\tsetAabbFunc(fn) {\n\t\tif (!this.meshInstance) return;\n\t\tthis.meshInstance._updateAabbFunc = fn;\n\t\tif (this.unmaskMeshInstance) {\n\t\t\tthis.unmaskMeshInstance._updateAabbFunc = fn;\n\t\t}\n\t}\n}\nclass ImageElement {\n\tconstructor(element) {\n\t\tthis._element = element;\n\t\tthis._entity = element.entity;\n\t\tthis._system = element.system;\n\t\tthis._textureAsset = null;\n\t\tthis._texture = null;\n\t\tthis._materialAsset = null;\n\t\tthis._material = null;\n\t\tthis._spriteAsset = null;\n\t\tthis._sprite = null;\n\t\tthis._spriteFrame = 0;\n\t\tthis._pixelsPerUnit = null;\n\t\tthis._targetAspectRatio = -1;\n\t\tthis._rect = new Vec4(0, 0, 1, 1);\n\t\tthis._mask = false;\n\t\tthis._maskRef = 0;\n\t\tthis._outerScale = new Vec2();\n\t\tthis._outerScaleUniform = new Float32Array(2);\n\t\tthis._innerOffset = new Vec4();\n\t\tthis._innerOffsetUniform = new Float32Array(4);\n\t\tthis._atlasRect = new Vec4();\n\t\tthis._atlasRectUniform = new Float32Array(4);\n\t\tthis._defaultMesh = this._createMesh();\n\t\tthis._renderable = new ImageRenderable(this._entity, this._defaultMesh, this._material);\n\t\tthis._color = new Color(1, 1, 1, 1);\n\t\tthis._colorUniform = new Float32Array([1, 1, 1]);\n\t\tthis._renderable.setParameter('material_emissive', this._colorUniform);\n\t\tthis._renderable.setParameter('material_opacity', 1);\n\t\tthis._updateAabbFunc = this._updateAabb.bind(this);\n\t\tthis._onScreenChange(this._element.screen);\n\t\tthis._element.on('resize', this._onParentResizeOrPivotChange, this);\n\t\tthis._element.on('set:pivot', this._onParentResizeOrPivotChange, this);\n\t\tthis._element.on('screen:set:screenspace', this._onScreenSpaceChange, this);\n\t\tthis._element.on('set:screen', this._onScreenChange, this);\n\t\tthis._element.on('set:draworder', this._onDrawOrderChange, this);\n\t\tthis._element.on('screen:set:resolution', this._onResolutionChange, this);\n\t}\n\tdestroy() {\n\t\tthis.textureAsset = null;\n\t\tthis.spriteAsset = null;\n\t\tthis.materialAsset = null;\n\t\tthis._renderable.setMesh(this._defaultMesh);\n\t\tthis._renderable.destroy();\n\t\tthis._defaultMesh = null;\n\t\tthis._element.off('resize', this._onParentResizeOrPivotChange, this);\n\t\tthis._element.off('set:pivot', this._onParentResizeOrPivotChange, this);\n\t\tthis._element.off('screen:set:screenspace', this._onScreenSpaceChange, this);\n\t\tthis._element.off('set:screen', this._onScreenChange, this);\n\t\tthis._element.off('set:draworder', this._onDrawOrderChange, this);\n\t\tthis._element.off('screen:set:resolution', this._onResolutionChange, this);\n\t}\n\t_onResolutionChange(res) {}\n\t_onParentResizeOrPivotChange() {\n\t\tif (this._renderable.mesh) {\n\t\t\tthis._updateMesh(this._renderable.mesh);\n\t\t}\n\t}\n\t_onScreenSpaceChange(value) {\n\t\tthis._updateMaterial(value);\n\t}\n\t_onScreenChange(screen, previous) {\n\t\tif (screen) {\n\t\t\tthis._updateMaterial(screen.screen.screenSpace);\n\t\t} else {\n\t\t\tthis._updateMaterial(false);\n\t\t}\n\t}\n\t_onDrawOrderChange(order) {\n\t\tthis._renderable.setDrawOrder(order);\n\t\tif (this.mask && this._element.screen) {\n\t\t\tthis._element.screen.screen.once('syncdraworder', function () {\n\t\t\t\tthis._renderable.setUnmaskDrawOrder();\n\t\t\t}, this);\n\t\t}\n\t}\n\t_hasUserMaterial() {\n\t\treturn !!this._materialAsset || !!this._material && this._system.defaultImageMaterials.indexOf(this._material) === -1;\n\t}\n\t_use9Slicing() {\n\t\treturn this.sprite && (this.sprite.renderMode === SPRITE_RENDERMODE_SLICED || this.sprite.renderMode === SPRITE_RENDERMODE_TILED);\n\t}\n\t_updateMaterial(screenSpace) {\n\t\tconst mask = !!this._mask;\n\t\tconst nineSliced = !!(this.sprite && this.sprite.renderMode === SPRITE_RENDERMODE_SLICED);\n\t\tconst nineTiled = !!(this.sprite && this.sprite.renderMode === SPRITE_RENDERMODE_TILED);\n\t\tif (!this._hasUserMaterial()) {\n\t\t\tthis._material = this._system.getImageElementMaterial(screenSpace, mask, nineSliced, nineTiled);\n\t\t}\n\t\tif (this._renderable) {\n\t\t\tthis._renderable.setCull(!this._element._isScreenSpace() || this._element._isScreenCulled());\n\t\t\tthis._renderable.setMaterial(this._material);\n\t\t\tthis._renderable.setScreenSpace(screenSpace);\n\t\t\tthis._renderable.setLayer(screenSpace ? LAYER_HUD : LAYER_WORLD);\n\t\t}\n\t}\n\t_createMesh() {\n\t\tconst element = this._element;\n\t\tconst w = element.calculatedWidth;\n\t\tconst h = element.calculatedHeight;\n\t\tconst r = this._rect;\n\t\tconst device = this._system.app.graphicsDevice;\n\t\tconst vertexData = new Float32Array([w, 0, 0, 0, 0, 1, r.x + r.z, 1.0 - r.y, w, h, 0, 0, 0, 1, r.x + r.z, 1.0 - (r.y + r.w), 0, 0, 0, 0, 0, 1, r.x, 1.0 - r.y, 0, h, 0, 0, 0, 1, r.x, 1.0 - (r.y + r.w)]);\n\t\tconst vertexFormat = _vertexFormatDeviceCache.get(device, () => {\n\t\t\treturn new VertexFormat(device, [{\n\t\t\t\tsemantic: SEMANTIC_POSITION,\n\t\t\t\tcomponents: 3,\n\t\t\t\ttype: TYPE_FLOAT32\n\t\t\t}, {\n\t\t\t\tsemantic: SEMANTIC_NORMAL,\n\t\t\t\tcomponents: 3,\n\t\t\t\ttype: TYPE_FLOAT32\n\t\t\t}, {\n\t\t\t\tsemantic: SEMANTIC_TEXCOORD0,\n\t\t\t\tcomponents: 2,\n\t\t\t\ttype: TYPE_FLOAT32\n\t\t\t}]);\n\t\t});\n\t\tconst vertexBuffer = new VertexBuffer(device, vertexFormat, 4, BUFFER_STATIC, vertexData.buffer);\n\t\tconst mesh = new Mesh(device);\n\t\tmesh.vertexBuffer = vertexBuffer;\n\t\tmesh.primitive[0].type = PRIMITIVE_TRISTRIP;\n\t\tmesh.primitive[0].base = 0;\n\t\tmesh.primitive[0].count = 4;\n\t\tmesh.primitive[0].indexed = false;\n\t\tmesh.aabb.setMinMax(Vec3.ZERO, new Vec3(w, h, 0));\n\t\tthis._updateMesh(mesh);\n\t\treturn mesh;\n\t}\n\t_updateMesh(mesh) {\n\t\tconst element = this._element;\n\t\tlet w = element.calculatedWidth;\n\t\tlet h = element.calculatedHeight;\n\t\tif (element.fitMode !== FITMODE_STRETCH && this._targetAspectRatio > 0) {\n\t\t\tconst actualRatio = element.calculatedWidth / element.calculatedHeight;\n\t\t\tif (element.fitMode === FITMODE_CONTAIN && actualRatio > this._targetAspectRatio || element.fitMode === FITMODE_COVER && actualRatio < this._targetAspectRatio) {\n\t\t\t\tw = element.calculatedHeight * this._targetAspectRatio;\n\t\t\t} else {\n\t\t\t\th = element.calculatedWidth / this._targetAspectRatio;\n\t\t\t}\n\t\t}\n\t\tconst screenSpace = element._isScreenSpace();\n\t\tthis._updateMaterial(screenSpace);\n\t\tif (this._renderable) this._renderable.forceUpdateAabb();\n\t\tif (this.sprite && (this.sprite.renderMode === SPRITE_RENDERMODE_SLICED || this.sprite.renderMode === SPRITE_RENDERMODE_TILED)) {\n\t\t\tconst frameData = this._sprite.atlas.frames[this._sprite.frameKeys[this._spriteFrame]];\n\t\t\tconst borderWidthScale = 2 / frameData.rect.z;\n\t\t\tconst borderHeightScale = 2 / frameData.rect.w;\n\t\t\tthis._innerOffset.set(frameData.border.x * borderWidthScale, frameData.border.y * borderHeightScale, frameData.border.z * borderWidthScale, frameData.border.w * borderHeightScale);\n\t\t\tconst tex = this.sprite.atlas.texture;\n\t\t\tthis._atlasRect.set(frameData.rect.x / tex.width, frameData.rect.y / tex.height, frameData.rect.z / tex.width, frameData.rect.w / tex.height);\n\t\t\tconst ppu = this._pixelsPerUnit !== null ? this._pixelsPerUnit : this.sprite.pixelsPerUnit;\n\t\t\tconst scaleMulX = frameData.rect.z / ppu;\n\t\t\tconst scaleMulY = frameData.rect.w / ppu;\n\t\t\tthis._outerScale.set(Math.max(w, this._innerOffset.x * scaleMulX), Math.max(h, this._innerOffset.y * scaleMulY));\n\t\t\tlet scaleX = scaleMulX;\n\t\t\tlet scaleY = scaleMulY;\n\t\t\tthis._outerScale.x /= scaleMulX;\n\t\t\tthis._outerScale.y /= scaleMulY;\n\t\t\tscaleX *= math.clamp(w / (this._innerOffset.x * scaleMulX), 0.0001, 1);\n\t\t\tscaleY *= math.clamp(h / (this._innerOffset.y * scaleMulY), 0.0001, 1);\n\t\t\tif (this._renderable) {\n\t\t\t\tthis._innerOffsetUniform[0] = this._innerOffset.x;\n\t\t\t\tthis._innerOffsetUniform[1] = this._innerOffset.y;\n\t\t\t\tthis._innerOffsetUniform[2] = this._innerOffset.z;\n\t\t\t\tthis._innerOffsetUniform[3] = this._innerOffset.w;\n\t\t\t\tthis._renderable.setParameter('innerOffset', this._innerOffsetUniform);\n\t\t\t\tthis._atlasRectUniform[0] = this._atlasRect.x;\n\t\t\t\tthis._atlasRectUniform[1] = this._atlasRect.y;\n\t\t\t\tthis._atlasRectUniform[2] = this._atlasRect.z;\n\t\t\t\tthis._atlasRectUniform[3] = this._atlasRect.w;\n\t\t\t\tthis._renderable.setParameter('atlasRect', this._atlasRectUniform);\n\t\t\t\tthis._outerScaleUniform[0] = this._outerScale.x;\n\t\t\t\tthis._outerScaleUniform[1] = this._outerScale.y;\n\t\t\t\tthis._renderable.setParameter('outerScale', this._outerScaleUniform);\n\t\t\t\tthis._renderable.setAabbFunc(this._updateAabbFunc);\n\t\t\t\tthis._renderable.node.setLocalScale(scaleX, scaleY, 1);\n\t\t\t\tthis._renderable.node.setLocalPosition((0.5 - element.pivot.x) * w, (0.5 - element.pivot.y) * h, 0);\n\t\t\t}\n\t\t} else {\n\t\t\tconst vb = mesh.vertexBuffer;\n\t\t\tconst vertexDataF32 = new Float32Array(vb.lock());\n\t\t\tconst hp = element.pivot.x;\n\t\t\tconst vp = element.pivot.y;\n\t\t\tvertexDataF32[0] = w - hp * w;\n\t\t\tvertexDataF32[1] = 0 - vp * h;\n\t\t\tvertexDataF32[8] = w - hp * w;\n\t\t\tvertexDataF32[9] = h - vp * h;\n\t\t\tvertexDataF32[16] = 0 - hp * w;\n\t\t\tvertexDataF32[17] = 0 - vp * h;\n\t\t\tvertexDataF32[24] = 0 - hp * w;\n\t\t\tvertexDataF32[25] = h - vp * h;\n\t\t\tlet atlasTextureWidth = 1;\n\t\t\tlet atlasTextureHeight = 1;\n\t\t\tlet rect = this._rect;\n\t\t\tif (this._sprite && this._sprite.frameKeys[this._spriteFrame] && this._sprite.atlas) {\n\t\t\t\tconst frame = this._sprite.atlas.frames[this._sprite.frameKeys[this._spriteFrame]];\n\t\t\t\tif (frame) {\n\t\t\t\t\trect = frame.rect;\n\t\t\t\t\tatlasTextureWidth = this._sprite.atlas.texture.width;\n\t\t\t\t\tatlasTextureHeight = this._sprite.atlas.texture.height;\n\t\t\t\t}\n\t\t\t}\n\t\t\tvertexDataF32[6] = (rect.x + rect.z) / atlasTextureWidth;\n\t\t\tvertexDataF32[7] = 1.0 - rect.y / atlasTextureHeight;\n\t\t\tvertexDataF32[14] = (rect.x + rect.z) / atlasTextureWidth;\n\t\t\tvertexDataF32[15] = 1.0 - (rect.y + rect.w) / atlasTextureHeight;\n\t\t\tvertexDataF32[22] = rect.x / atlasTextureWidth;\n\t\t\tvertexDataF32[23] = 1.0 - rect.y / atlasTextureHeight;\n\t\t\tvertexDataF32[30] = rect.x / atlasTextureWidth;\n\t\t\tvertexDataF32[31] = 1.0 - (rect.y + rect.w) / atlasTextureHeight;\n\t\t\tvb.unlock();\n\t\t\tconst min = new Vec3(0 - hp * w, 0 - vp * h, 0);\n\t\t\tconst max = new Vec3(w - hp * w, h - vp * h, 0);\n\t\t\tmesh.aabb.setMinMax(min, max);\n\t\t\tif (this._renderable) {\n\t\t\t\tthis._renderable.node.setLocalScale(1, 1, 1);\n\t\t\t\tthis._renderable.node.setLocalPosition(0, 0, 0);\n\t\t\t\tthis._renderable.setAabbFunc(null);\n\t\t\t}\n\t\t}\n\t\tthis._meshDirty = false;\n\t}\n\t_updateSprite() {\n\t\tlet nineSlice = false;\n\t\tlet mesh = null;\n\t\tthis._targetAspectRatio = -1;\n\t\tif (this._sprite && this._sprite.atlas) {\n\t\t\tmesh = this._sprite.meshes[this.spriteFrame];\n\t\t\tnineSlice = this._sprite.renderMode === SPRITE_RENDERMODE_SLICED || this._sprite.renderMode === SPRITE_RENDERMODE_TILED;\n\t\t\tconst frameData = this._sprite.atlas.frames[this._sprite.frameKeys[this._spriteFrame]];\n\t\t\tif ((frameData == null ? void 0 : frameData.rect.w) > 0) {\n\t\t\t\tthis._targetAspectRatio = frameData.rect.z / frameData.rect.w;\n\t\t\t}\n\t\t}\n\t\tthis.mesh = nineSlice ? mesh : this._defaultMesh;\n\t\tthis.refreshMesh();\n\t}\n\trefreshMesh() {\n\t\tif (this.mesh) {\n\t\t\tif (!this._element._beingInitialized) {\n\t\t\t\tthis._updateMesh(this.mesh);\n\t\t\t} else {\n\t\t\t\tthis._meshDirty = true;\n\t\t\t}\n\t\t}\n\t}\n\t_updateAabb(aabb) {\n\t\taabb.center.set(0, 0, 0);\n\t\taabb.halfExtents.set(this._outerScale.x * 0.5, this._outerScale.y * 0.5, 0.001);\n\t\taabb.setFromTransformedAabb(aabb, this._renderable.node.getWorldTransform());\n\t\treturn aabb;\n\t}\n\t_toggleMask() {\n\t\tthis._element._dirtifyMask();\n\t\tconst screenSpace = this._element._isScreenSpace();\n\t\tthis._updateMaterial(screenSpace);\n\t\tthis._renderable.setMask(!!this._mask);\n\t}\n\t_onMaterialLoad(asset) {\n\t\tthis.material = asset.resource;\n\t}\n\t_onMaterialAdded(asset) {\n\t\tthis._system.app.assets.off('add:' + asset.id, this._onMaterialAdded, this);\n\t\tif (this._materialAsset === asset.id) {\n\t\t\tthis._bindMaterialAsset(asset);\n\t\t}\n\t}\n\t_bindMaterialAsset(asset) {\n\t\tif (!this._entity.enabled) return;\n\t\tasset.on('load', this._onMaterialLoad, this);\n\t\tasset.on('change', this._onMaterialChange, this);\n\t\tasset.on('remove', this._onMaterialRemove, this);\n\t\tif (asset.resource) {\n\t\t\tthis._onMaterialLoad(asset);\n\t\t} else {\n\t\t\tthis._system.app.assets.load(asset);\n\t\t}\n\t}\n\t_unbindMaterialAsset(asset) {\n\t\tasset.off('load', this._onMaterialLoad, this);\n\t\tasset.off('change', this._onMaterialChange, this);\n\t\tasset.off('remove', this._onMaterialRemove, this);\n\t}\n\t_onMaterialChange() {}\n\t_onMaterialRemove() {}\n\t_onTextureAdded(asset) {\n\t\tthis._system.app.assets.off('add:' + asset.id, this._onTextureAdded, this);\n\t\tif (this._textureAsset === asset.id) {\n\t\t\tthis._bindTextureAsset(asset);\n\t\t}\n\t}\n\t_bindTextureAsset(asset) {\n\t\tif (!this._entity.enabled) return;\n\t\tasset.on('load', this._onTextureLoad, this);\n\t\tasset.on('change', this._onTextureChange, this);\n\t\tasset.on('remove', this._onTextureRemove, this);\n\t\tif (asset.resource) {\n\t\t\tthis._onTextureLoad(asset);\n\t\t} else {\n\t\t\tthis._system.app.assets.load(asset);\n\t\t}\n\t}\n\t_unbindTextureAsset(asset) {\n\t\tasset.off('load', this._onTextureLoad, this);\n\t\tasset.off('change', this._onTextureChange, this);\n\t\tasset.off('remove', this._onTextureRemove, this);\n\t}\n\t_onTextureLoad(asset) {\n\t\tthis.texture = asset.resource;\n\t}\n\t_onTextureChange(asset) {}\n\t_onTextureRemove(asset) {}\n\t_onSpriteAssetAdded(asset) {\n\t\tthis._system.app.assets.off('add:' + asset.id, this._onSpriteAssetAdded, this);\n\t\tif (this._spriteAsset === asset.id) {\n\t\t\tthis._bindSpriteAsset(asset);\n\t\t}\n\t}\n\t_bindSpriteAsset(asset) {\n\t\tif (!this._entity.enabled) return;\n\t\tasset.on('load', this._onSpriteAssetLoad, this);\n\t\tasset.on('change', this._onSpriteAssetChange, this);\n\t\tasset.on('remove', this._onSpriteAssetRemove, this);\n\t\tif (asset.resource) {\n\t\t\tthis._onSpriteAssetLoad(asset);\n\t\t} else {\n\t\t\tthis._system.app.assets.load(asset);\n\t\t}\n\t}\n\t_unbindSpriteAsset(asset) {\n\t\tasset.off('load', this._onSpriteAssetLoad, this);\n\t\tasset.off('change', this._onSpriteAssetChange, this);\n\t\tasset.off('remove', this._onSpriteAssetRemove, this);\n\t\tif (asset.data.textureAtlasAsset) {\n\t\t\tthis._system.app.assets.off('load:' + asset.data.textureAtlasAsset, this._onTextureAtlasLoad, this);\n\t\t}\n\t}\n\t_onSpriteAssetLoad(asset) {\n\t\tif (!asset || !asset.resource) {\n\t\t\tthis.sprite = null;\n\t\t} else {\n\t\t\tif (!asset.resource.atlas) {\n\t\t\t\tconst atlasAssetId = asset.data.textureAtlasAsset;\n\t\t\t\tif (atlasAssetId) {\n\t\t\t\t\tconst assets = this._system.app.assets;\n\t\t\t\t\tassets.off('load:' + atlasAssetId, this._onTextureAtlasLoad, this);\n\t\t\t\t\tassets.once('load:' + atlasAssetId, this._onTextureAtlasLoad, this);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.sprite = asset.resource;\n\t\t\t}\n\t\t}\n\t}\n\t_onSpriteAssetChange(asset) {\n\t\tthis._onSpriteAssetLoad(asset);\n\t}\n\t_onSpriteAssetRemove(asset) {}\n\t_bindSprite(sprite) {\n\t\tsprite.on('set:meshes', this._onSpriteMeshesChange, this);\n\t\tsprite.on('set:pixelsPerUnit', this._onSpritePpuChange, this);\n\t\tsprite.on('set:atlas', this._onAtlasTextureChange, this);\n\t\tif (sprite.atlas) {\n\t\t\tsprite.atlas.on('set:texture', this._onAtlasTextureChange, this);\n\t\t}\n\t}\n\t_unbindSprite(sprite) {\n\t\tsprite.off('set:meshes', this._onSpriteMeshesChange, this);\n\t\tsprite.off('set:pixelsPerUnit', this._onSpritePpuChange, this);\n\t\tsprite.off('set:atlas', this._onAtlasTextureChange, this);\n\t\tif (sprite.atlas) {\n\t\t\tsprite.atlas.off('set:texture', this._onAtlasTextureChange, this);\n\t\t}\n\t}\n\t_onSpriteMeshesChange() {\n\t\tif (this._sprite) {\n\t\t\tthis._spriteFrame = math.clamp(this._spriteFrame, 0, this._sprite.frameKeys.length - 1);\n\t\t}\n\t\tthis._updateSprite();\n\t}\n\t_onSpritePpuChange() {\n\t\tif (this.sprite.renderMode !== SPRITE_RENDERMODE_SIMPLE && this._pixelsPerUnit === null) {\n\t\t\tthis._updateSprite();\n\t\t}\n\t}\n\t_onAtlasTextureChange() {\n\t\tif (this.sprite && this.sprite.atlas && this.sprite.atlas.texture) {\n\t\t\tthis._renderable.setParameter('texture_emissiveMap', this._sprite.atlas.texture);\n\t\t\tthis._renderable.setParameter('texture_opacityMap', this._sprite.atlas.texture);\n\t\t} else {\n\t\t\tthis._renderable.deleteParameter('texture_emissiveMap');\n\t\t\tthis._renderable.deleteParameter('texture_opacityMap');\n\t\t}\n\t}\n\t_onTextureAtlasLoad(atlasAsset) {\n\t\tconst spriteAsset = this._spriteAsset;\n\t\tif (spriteAsset instanceof Asset) {\n\t\t\tthis._onSpriteAssetLoad(spriteAsset);\n\t\t} else {\n\t\t\tthis._onSpriteAssetLoad(this._system.app.assets.get(spriteAsset));\n\t\t}\n\t}\n\tonEnable() {\n\t\tif (this._materialAsset) {\n\t\t\tconst asset = this._system.app.assets.get(this._materialAsset);\n\t\t\tif (asset && asset.resource !== this._material) {\n\t\t\t\tthis._bindMaterialAsset(asset);\n\t\t\t}\n\t\t}\n\t\tif (this._textureAsset) {\n\t\t\tconst asset = this._system.app.assets.get(this._textureAsset);\n\t\t\tif (asset && asset.resource !== this._texture) {\n\t\t\t\tthis._bindTextureAsset(asset);\n\t\t\t}\n\t\t}\n\t\tif (this._spriteAsset) {\n\t\t\tconst asset = this._system.app.assets.get(this._spriteAsset);\n\t\t\tif (asset && asset.resource !== this._sprite) {\n\t\t\t\tthis._bindSpriteAsset(asset);\n\t\t\t}\n\t\t}\n\t\tthis._element.addModelToLayers(this._renderable.model);\n\t}\n\tonDisable() {\n\t\tthis._element.removeModelFromLayers(this._renderable.model);\n\t}\n\t_setStencil(stencilParams) {\n\t\tthis._renderable.meshInstance.stencilFront = stencilParams;\n\t\tthis._renderable.meshInstance.stencilBack = stencilParams;\n\t\tlet ref = 0;\n\t\tif (this._element.maskedBy) {\n\t\t\tref = this._element.maskedBy.element._image._maskRef;\n\t\t}\n\t\tif (this._renderable.unmaskMeshInstance) {\n\t\t\tconst sp = new StencilParameters({\n\t\t\t\tref: ref + 1,\n\t\t\t\tfunc: FUNC_EQUAL,\n\t\t\t\tzpass: STENCILOP_DECREMENT\n\t\t\t});\n\t\t\tthis._renderable.unmaskMeshInstance.stencilFront = sp;\n\t\t\tthis._renderable.unmaskMeshInstance.stencilBack = sp;\n\t\t}\n\t}\n\tset color(value) {\n\t\tconst r = value.r;\n\t\tconst g = value.g;\n\t\tconst b = value.b;\n\t\tif (this._color.r !== r || this._color.g !== g || this._color.b !== b) {\n\t\t\tthis._color.r = r;\n\t\t\tthis._color.g = g;\n\t\t\tthis._color.b = b;\n\t\t\tthis._colorUniform[0] = r;\n\t\t\tthis._colorUniform[1] = g;\n\t\t\tthis._colorUniform[2] = b;\n\t\t\tthis._renderable.setParameter('material_emissive', this._colorUniform);\n\t\t}\n\t\tif (this._element) {\n\t\t\tthis._element.fire('set:color', this._color);\n\t\t}\n\t}\n\tget color() {\n\t\treturn this._color;\n\t}\n\tset opacity(value) {\n\t\tif (value !== this._color.a) {\n\t\t\tthis._color.a = value;\n\t\t\tthis._renderable.setParameter('material_opacity', value);\n\t\t}\n\t\tif (this._element) {\n\t\t\tthis._element.fire('set:opacity', value);\n\t\t}\n\t}\n\tget opacity() {\n\t\treturn this._color.a;\n\t}\n\tset rect(value) {\n\t\tlet x, y, z, w;\n\t\tif (value instanceof Vec4) {\n\t\t\tx = value.x;\n\t\t\ty = value.y;\n\t\t\tz = value.z;\n\t\t\tw = value.w;\n\t\t} else {\n\t\t\tx = value[0];\n\t\t\ty = value[1];\n\t\t\tz = value[2];\n\t\t\tw = value[3];\n\t\t}\n\t\tif (x === this._rect.x && y === this._rect.y && z === this._rect.z && w === this._rect.w) {\n\t\t\treturn;\n\t\t}\n\t\tthis._rect.set(x, y, z, w);\n\t\tif (this._renderable.mesh) {\n\t\t\tif (!this._element._beingInitialized) {\n\t\t\t\tthis._updateMesh(this._renderable.mesh);\n\t\t\t} else {\n\t\t\t\tthis._meshDirty = true;\n\t\t\t}\n\t\t}\n\t}\n\tget rect() {\n\t\treturn this._rect;\n\t}\n\t_removeMaterialAssetEvents() {\n\t\tif (this._materialAsset) {\n\t\t\tconst assets = this._system.app.assets;\n\t\t\tassets.off('add:' + this._materialAsset, this._onMaterialAdded, this);\n\t\t\tconst asset = assets.get(this._materialAsset);\n\t\t\tif (asset) {\n\t\t\t\tasset.off('load', this._onMaterialLoad, this);\n\t\t\t\tasset.off('change', this._onMaterialChange, this);\n\t\t\t\tasset.off('remove', this._onMaterialRemove, this);\n\t\t\t}\n\t\t}\n\t}\n\tset material(value) {\n\t\tif (this._material === value) return;\n\t\tif (!value) {\n\t\t\tconst screenSpace = this._element._isScreenSpace();\n\t\t\tif (this.mask) {\n\t\t\t\tvalue = screenSpace ? this._system.defaultScreenSpaceImageMaskMaterial : this._system.defaultImageMaskMaterial;\n\t\t\t} else {\n\t\t\t\tvalue = screenSpace ? this._system.defaultScreenSpaceImageMaterial : this._system.defaultImageMaterial;\n\t\t\t}\n\t\t}\n\t\tthis._material = value;\n\t\tif (this._materialAsset) {\n\t\t\tconst asset = this._system.app.assets.get(this._materialAsset);\n\t\t\tif (!asset || asset.resource !== value) {\n\t\t\t\tthis._removeMaterialAssetEvents();\n\t\t\t\tthis._materialAsset = null;\n\t\t\t}\n\t\t}\n\t\tif (value) {\n\t\t\tthis._renderable.setMaterial(value);\n\t\t\tif (this._hasUserMaterial()) {\n\t\t\t\tthis._renderable.deleteParameter('material_opacity');\n\t\t\t\tthis._renderable.deleteParameter('material_emissive');\n\t\t\t} else {\n\t\t\t\tthis._colorUniform[0] = this._color.r;\n\t\t\t\tthis._colorUniform[1] = this._color.g;\n\t\t\t\tthis._colorUniform[2] = this._color.b;\n\t\t\t\tthis._renderable.setParameter('material_emissive', this._colorUniform);\n\t\t\t\tthis._renderable.setParameter('material_opacity', this._color.a);\n\t\t\t}\n\t\t}\n\t}\n\tget material() {\n\t\treturn this._material;\n\t}\n\tset materialAsset(value) {\n\t\tconst assets = this._system.app.assets;\n\t\tlet _id = value;\n\t\tif (value instanceof Asset) {\n\t\t\t_id = value.id;\n\t\t}\n\t\tif (this._materialAsset !== _id) {\n\t\t\tthis._removeMaterialAssetEvents();\n\t\t\tthis._materialAsset = _id;\n\t\t\tif (this._materialAsset) {\n\t\t\t\tconst asset = assets.get(this._materialAsset);\n\t\t\t\tif (!asset) {\n\t\t\t\t\tthis._materialAsset = null;\n\t\t\t\t\tthis.material = null;\n\t\t\t\t\tthis._materialAsset = _id;\n\t\t\t\t\tassets.on('add:' + this._materialAsset, this._onMaterialAdded, this);\n\t\t\t\t} else {\n\t\t\t\t\tthis._bindMaterialAsset(asset);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._materialAsset = null;\n\t\t\t\tthis.material = null;\n\t\t\t\tthis._materialAsset = _id;\n\t\t\t}\n\t\t}\n\t}\n\tget materialAsset() {\n\t\treturn this._materialAsset;\n\t}\n\tset texture(value) {\n\t\tif (this._texture === value) return;\n\t\tif (this._textureAsset) {\n\t\t\tconst textureAsset = this._system.app.assets.get(this._textureAsset);\n\t\t\tif (textureAsset && textureAsset.resource !== value) {\n\t\t\t\tthis.textureAsset = null;\n\t\t\t}\n\t\t}\n\t\tthis._texture = value;\n\t\tif (value) {\n\t\t\tif (this._spriteAsset) {\n\t\t\t\tthis.spriteAsset = null;\n\t\t\t}\n\t\t\tthis._renderable.setParameter('texture_emissiveMap', this._texture);\n\t\t\tthis._renderable.setParameter('texture_opacityMap', this._texture);\n\t\t\tthis._colorUniform[0] = this._color.r;\n\t\t\tthis._colorUniform[1] = this._color.g;\n\t\t\tthis._colorUniform[2] = this._color.b;\n\t\t\tthis._renderable.setParameter('material_emissive', this._colorUniform);\n\t\t\tthis._renderable.setParameter('material_opacity', this._color.a);\n\t\t\tconst newAspectRatio = this._texture.width / this._texture.height;\n\t\t\tif (newAspectRatio !== this._targetAspectRatio) {\n\t\t\t\tthis._targetAspectRatio = newAspectRatio;\n\t\t\t\tif (this._element.fitMode !== FITMODE_STRETCH) {\n\t\t\t\t\tthis.refreshMesh();\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthis._renderable.deleteParameter('texture_emissiveMap');\n\t\t\tthis._renderable.deleteParameter('texture_opacityMap');\n\t\t\tthis._targetAspectRatio = -1;\n\t\t\tif (this._element.fitMode !== FITMODE_STRETCH) {\n\t\t\t\tthis.refreshMesh();\n\t\t\t}\n\t\t}\n\t}\n\tget texture() {\n\t\treturn this._texture;\n\t}\n\tset textureAsset(value) {\n\t\tconst assets = this._system.app.assets;\n\t\tlet _id = value;\n\t\tif (value instanceof Asset) {\n\t\t\t_id = value.id;\n\t\t}\n\t\tif (this._textureAsset !== _id) {\n\t\t\tif (this._textureAsset) {\n\t\t\t\tassets.off('add:' + this._textureAsset, this._onTextureAdded, this);\n\t\t\t\tconst _prev = assets.get(this._textureAsset);\n\t\t\t\tif (_prev) {\n\t\t\t\t\t_prev.off('load', this._onTextureLoad, this);\n\t\t\t\t\t_prev.off('change', this._onTextureChange, this);\n\t\t\t\t\t_prev.off('remove', this._onTextureRemove, this);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._textureAsset = _id;\n\t\t\tif (this._textureAsset) {\n\t\t\t\tconst asset = assets.get(this._textureAsset);\n\t\t\t\tif (!asset) {\n\t\t\t\t\tthis.texture = null;\n\t\t\t\t\tassets.on('add:' + this._textureAsset, this._onTextureAdded, this);\n\t\t\t\t} else {\n\t\t\t\t\tthis._bindTextureAsset(asset);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.texture = null;\n\t\t\t}\n\t\t}\n\t}\n\tget textureAsset() {\n\t\treturn this._textureAsset;\n\t}\n\tset spriteAsset(value) {\n\t\tconst assets = this._system.app.assets;\n\t\tlet _id = value;\n\t\tif (value instanceof Asset) {\n\t\t\t_id = value.id;\n\t\t}\n\t\tif (this._spriteAsset !== _id) {\n\t\t\tif (this._spriteAsset) {\n\t\t\t\tassets.off('add:' + this._spriteAsset, this._onSpriteAssetAdded, this);\n\t\t\t\tconst _prev = assets.get(this._spriteAsset);\n\t\t\t\tif (_prev) {\n\t\t\t\t\tthis._unbindSpriteAsset(_prev);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._spriteAsset = _id;\n\t\t\tif (this._spriteAsset) {\n\t\t\t\tconst asset = assets.get(this._spriteAsset);\n\t\t\t\tif (!asset) {\n\t\t\t\t\tthis.sprite = null;\n\t\t\t\t\tassets.on('add:' + this._spriteAsset, this._onSpriteAssetAdded, this);\n\t\t\t\t} else {\n\t\t\t\t\tthis._bindSpriteAsset(asset);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.sprite = null;\n\t\t\t}\n\t\t}\n\t\tif (this._element) {\n\t\t\tthis._element.fire('set:spriteAsset', _id);\n\t\t}\n\t}\n\tget spriteAsset() {\n\t\treturn this._spriteAsset;\n\t}\n\tset sprite(value) {\n\t\tif (this._sprite === value) return;\n\t\tif (this._sprite) {\n\t\t\tthis._unbindSprite(this._sprite);\n\t\t}\n\t\tif (this._spriteAsset) {\n\t\t\tconst spriteAsset = this._system.app.assets.get(this._spriteAsset);\n\t\t\tif (spriteAsset && spriteAsset.resource !== value) {\n\t\t\t\tthis.spriteAsset = null;\n\t\t\t}\n\t\t}\n\t\tthis._sprite = value;\n\t\tif (this._sprite) {\n\t\t\tthis._bindSprite(this._sprite);\n\t\t\tif (this._textureAsset) {\n\t\t\t\tthis.textureAsset = null;\n\t\t\t}\n\t\t}\n\t\tif (this._sprite && this._sprite.atlas && this._sprite.atlas.texture) {\n\t\t\tthis._renderable.setParameter('texture_emissiveMap', this._sprite.atlas.texture);\n\t\t\tthis._renderable.setParameter('texture_opacityMap', this._sprite.atlas.texture);\n\t\t} else {\n\t\t\tthis._renderable.deleteParameter('texture_emissiveMap');\n\t\t\tthis._renderable.deleteParameter('texture_opacityMap');\n\t\t}\n\t\tif (this._sprite) {\n\t\t\tthis._spriteFrame = math.clamp(this._spriteFrame, 0, this._sprite.frameKeys.length - 1);\n\t\t}\n\t\tthis._updateSprite();\n\t}\n\tget sprite() {\n\t\treturn this._sprite;\n\t}\n\tset spriteFrame(value) {\n\t\tconst oldValue = this._spriteFrame;\n\t\tif (this._sprite) {\n\t\t\tthis._spriteFrame = math.clamp(value, 0, this._sprite.frameKeys.length - 1);\n\t\t} else {\n\t\t\tthis._spriteFrame = value;\n\t\t}\n\t\tif (this._spriteFrame !== oldValue) {\n\t\t\tthis._updateSprite();\n\t\t}\n\t\tif (this._element) {\n\t\t\tthis._element.fire('set:spriteFrame', value);\n\t\t}\n\t}\n\tget spriteFrame() {\n\t\treturn this._spriteFrame;\n\t}\n\tset mesh(value) {\n\t\tthis._renderable.setMesh(value);\n\t\tif (this._defaultMesh === value) {\n\t\t\tthis._renderable.setAabbFunc(null);\n\t\t} else {\n\t\t\tthis._renderable.setAabbFunc(this._updateAabbFunc);\n\t\t}\n\t}\n\tget mesh() {\n\t\treturn this._renderable.mesh;\n\t}\n\tset mask(value) {\n\t\tif (this._mask !== value) {\n\t\t\tthis._mask = value;\n\t\t\tthis._toggleMask();\n\t\t}\n\t}\n\tget mask() {\n\t\treturn this._mask;\n\t}\n\tset pixelsPerUnit(value) {\n\t\tif (this._pixelsPerUnit === value) return;\n\t\tthis._pixelsPerUnit = value;\n\t\tif (this._sprite && (this._sprite.renderMode === SPRITE_RENDERMODE_SLICED || this._sprite.renderMode === SPRITE_RENDERMODE_TILED)) {\n\t\t\tthis._updateSprite();\n\t\t}\n\t}\n\tget pixelsPerUnit() {\n\t\treturn this._pixelsPerUnit;\n\t}\n\tget aabb() {\n\t\tif (this._renderable.meshInstance) {\n\t\t\treturn this._renderable.meshInstance.aabb;\n\t\t}\n\t\treturn null;\n\t}\n}\n\nexport { ImageElement };\n","import { EventHandler } from '../../core/event-handler.js';\nimport { Asset } from './asset.js';\n\nclass LocalizedAsset extends EventHandler {\n\tconstructor(app) {\n\t\tsuper();\n\t\tthis._app = app;\n\t\tapp.i18n.on('set:locale', this._onSetLocale, this);\n\t\tthis._autoLoad = false;\n\t\tthis._disableLocalization = false;\n\t\tthis._defaultAsset = null;\n\t\tthis._localizedAsset = null;\n\t}\n\tset defaultAsset(value) {\n\t\tconst id = value instanceof Asset ? value.id : value;\n\t\tif (this._defaultAsset === id) return;\n\t\tif (this._defaultAsset) {\n\t\t\tthis._unbindDefaultAsset();\n\t\t}\n\t\tthis._defaultAsset = id;\n\t\tif (this._defaultAsset) {\n\t\t\tthis._bindDefaultAsset();\n\t\t}\n\t\tthis._onSetLocale(this._app.i18n.locale);\n\t}\n\tget defaultAsset() {\n\t\treturn this._defaultAsset;\n\t}\n\tset localizedAsset(value) {\n\t\tconst id = value instanceof Asset ? value.id : value;\n\t\tif (this._localizedAsset === id) {\n\t\t\treturn;\n\t\t}\n\t\tif (this._localizedAsset) {\n\t\t\tthis._app.assets.off('add:' + this._localizedAsset, this._onLocalizedAssetAdd, this);\n\t\t\tthis._unbindLocalizedAsset();\n\t\t\tthis._localizedAsset = null;\n\t\t}\n\t\tthis._localizedAsset = id;\n\t\tif (this._localizedAsset) {\n\t\t\tconst asset = this._app.assets.get(this._localizedAsset);\n\t\t\tif (!asset) {\n\t\t\t\tthis._app.assets.once('add:' + this._localizedAsset, this._onLocalizedAssetAdd, this);\n\t\t\t} else {\n\t\t\t\tthis._bindLocalizedAsset();\n\t\t\t}\n\t\t}\n\t}\n\tget localizedAsset() {\n\t\treturn this._localizedAsset;\n\t}\n\tset autoLoad(value) {\n\t\tif (this._autoLoad === value) return;\n\t\tthis._autoLoad = value;\n\t\tif (this._autoLoad && this._localizedAsset) {\n\t\t\tthis._unbindLocalizedAsset();\n\t\t\tthis._bindLocalizedAsset();\n\t\t}\n\t}\n\tget autoLoad() {\n\t\treturn this._autoLoad;\n\t}\n\tset disableLocalization(value) {\n\t\tif (this._disableLocalization === value) return;\n\t\tthis._disableLocalization = value;\n\t\tthis._onSetLocale(this._app.i18n.locale);\n\t}\n\tget disableLocalization() {\n\t\treturn this._disableLocalization;\n\t}\n\t_bindDefaultAsset() {\n\t\tconst asset = this._app.assets.get(this._defaultAsset);\n\t\tif (!asset) {\n\t\t\tthis._app.assets.once('add:' + this._defaultAsset, this._onDefaultAssetAdd, this);\n\t\t} else {\n\t\t\tthis._onDefaultAssetAdd(asset);\n\t\t}\n\t}\n\t_unbindDefaultAsset() {\n\t\tif (!this._defaultAsset) return;\n\t\tthis._app.assets.off('add:' + this._defaultAsset, this._onDefaultAssetAdd, this);\n\t\tconst asset = this._app.assets.get(this._defaultAsset);\n\t\tif (!asset) return;\n\t\tasset.off('add:localized', this._onLocaleAdd, this);\n\t\tasset.off('remove:localized', this._onLocaleRemove, this);\n\t\tasset.off('remove', this._onDefaultAssetRemove, this);\n\t}\n\t_onDefaultAssetAdd(asset) {\n\t\tif (this._defaultAsset !== asset.id) return;\n\t\tasset.on('add:localized', this._onLocaleAdd, this);\n\t\tasset.on('remove:localized', this._onLocaleRemove, this);\n\t\tasset.once('remove', this._onDefaultAssetRemove, this);\n\t}\n\t_onDefaultAssetRemove(asset) {\n\t\tif (this._defaultAsset !== asset.id) return;\n\t\tasset.off('add:localized', this._onLocaleAdd, this);\n\t\tasset.off('remove:localized', this._onLocaleAdd, this);\n\t\tthis._app.assets.once('add:' + this._defaultAsset, this._onDefaultAssetAdd, this);\n\t}\n\t_bindLocalizedAsset() {\n\t\tif (!this._autoLoad) return;\n\t\tconst asset = this._app.assets.get(this._localizedAsset);\n\t\tif (!asset) return;\n\t\tasset.on('load', this._onLocalizedAssetLoad, this);\n\t\tasset.on('change', this._onLocalizedAssetChange, this);\n\t\tasset.on('remove', this._onLocalizedAssetRemove, this);\n\t\tif (asset.resource) {\n\t\t\tthis._onLocalizedAssetLoad(asset);\n\t\t} else {\n\t\t\tthis._app.assets.load(asset);\n\t\t}\n\t}\n\t_unbindLocalizedAsset() {\n\t\tconst asset = this._app.assets.get(this._localizedAsset);\n\t\tif (!asset) return;\n\t\tasset.off('load', this._onLocalizedAssetLoad, this);\n\t\tasset.off('change', this._onLocalizedAssetChange, this);\n\t\tasset.off('remove', this._onLocalizedAssetRemove, this);\n\t}\n\t_onLocalizedAssetAdd(asset) {\n\t\tif (this._localizedAsset !== asset.id) return;\n\t\tthis._bindLocalizedAsset();\n\t}\n\t_onLocalizedAssetLoad(asset) {\n\t\tthis.fire('load', asset);\n\t}\n\t_onLocalizedAssetChange(asset, name, newValue, oldValue) {\n\t\tthis.fire('change', asset, name, newValue, oldValue);\n\t}\n\t_onLocalizedAssetRemove(asset) {\n\t\tif (this._localizedAsset === asset.id) {\n\t\t\tthis.localizedAsset = this._defaultAsset;\n\t\t}\n\t\tthis.fire('remove', asset);\n\t}\n\t_onLocaleAdd(locale, assetId) {\n\t\tif (this._app.i18n.locale !== locale) return;\n\t\tthis._onSetLocale(locale);\n\t}\n\t_onLocaleRemove(locale, assetId) {\n\t\tif (this._app.i18n.locale !== locale) return;\n\t\tthis._onSetLocale(locale);\n\t}\n\t_onSetLocale(locale) {\n\t\tif (!this._defaultAsset) {\n\t\t\tthis.localizedAsset = null;\n\t\t\treturn;\n\t\t}\n\t\tconst asset = this._app.assets.get(this._defaultAsset);\n\t\tif (!asset || this._disableLocalization) {\n\t\t\tthis.localizedAsset = this._defaultAsset;\n\t\t\treturn;\n\t\t}\n\t\tconst localizedAssetId = asset.getLocalizedAssetId(locale);\n\t\tif (!localizedAssetId) {\n\t\t\tthis.localizedAsset = this._defaultAsset;\n\t\t\treturn;\n\t\t}\n\t\tthis.localizedAsset = localizedAssetId;\n\t}\n\tdestroy() {\n\t\tthis.defaultAsset = null;\n\t\tthis._app.i18n.off('set:locale', this._onSetLocale, this);\n\t\tthis.off();\n\t}\n}\n\nexport { LocalizedAsset };\n","const FONT_MSDF = 'msdf';\nconst FONT_BITMAP = 'bitmap';\n\nexport { FONT_BITMAP, FONT_MSDF };\n","const EOF_TOKEN = 0;\nconst ERROR_TOKEN = 1;\nconst TEXT_TOKEN = 2;\nconst OPEN_BRACKET_TOKEN = 3;\nconst CLOSE_BRACKET_TOKEN = 4;\nconst EQUALS_TOKEN = 5;\nconst STRING_TOKEN = 6;\nconst IDENTIFIER_TOKEN = 7;\nconst WHITESPACE_TOKEN = 8;\nconst WHITESPACE_CHARS = ' \\t\\n\\r\\v\\f';\nconst IDENTIFIER_REGEX = /[A-Z|a-z|0-9|_|-|/]/;\nclass Scanner {\n\tconstructor(symbols) {\n\t\tthis._symbols = symbols;\n\t\tthis._index = 0;\n\t\tthis._last = 0;\n\t\tthis._cur = this._symbols.length > 0 ? this._symbols[0] : null;\n\t\tthis._buf = [];\n\t\tthis._mode = 'text';\n\t\tthis._error = null;\n\t}\n\tread() {\n\t\tlet token = this._read();\n\t\twhile (token === WHITESPACE_TOKEN) {\n\t\t\ttoken = this._read();\n\t\t}\n\t\tif (token !== EOF_TOKEN && token !== ERROR_TOKEN) {\n\t\t\tthis._last = this._index;\n\t\t}\n\t\treturn token;\n\t}\n\tbuf() {\n\t\treturn this._buf;\n\t}\n\tlast() {\n\t\treturn this._last;\n\t}\n\terror() {\n\t\treturn this._error;\n\t}\n\tdebugPrint() {\n\t\tconst tokenStrings = ['EOF', 'ERROR', 'TEXT', 'OPEN_BRACKET', 'CLOSE_BRACKET', 'EQUALS', 'STRING', 'IDENTIFIER', 'WHITESPACE'];\n\t\tlet token = this.read();\n\t\tlet result = '';\n\t\twhile (true) {\n\t\t\tresult += (result.length > 0 ? '\\n' : '') + tokenStrings[token] + ' \\'' + this.buf().join('') + '\\'';\n\t\t\tif (token === EOF_TOKEN || token === ERROR_TOKEN) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\ttoken = this.read();\n\t\t}\n\t\treturn result;\n\t}\n\t_read() {\n\t\tthis._buf = [];\n\t\tif (this._eof()) {\n\t\t\treturn EOF_TOKEN;\n\t\t}\n\t\treturn this._mode === 'text' ? this._text() : this._tag();\n\t}\n\t_text() {\n\t\twhile (true) {\n\t\t\tswitch (this._cur) {\n\t\t\t\tcase null:\n\t\t\t\t\treturn this._buf.length > 0 ? TEXT_TOKEN : EOF_TOKEN;\n\t\t\t\tcase '[':\n\t\t\t\t\tthis._mode = 'tag';\n\t\t\t\t\treturn this._buf.length > 0 ? TEXT_TOKEN : this._tag();\n\t\t\t\tcase '\\\\':\n\t\t\t\t\tthis._next();\n\t\t\t\t\tswitch (this._cur) {\n\t\t\t\t\t\tcase '[':\n\t\t\t\t\t\t\tthis._store();\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tthis._output('\\\\');\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthis._store();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\t_tag() {\n\t\tswitch (this._cur) {\n\t\t\tcase null:\n\t\t\t\tthis._error = 'unexpected end of input reading tag';\n\t\t\t\treturn ERROR_TOKEN;\n\t\t\tcase '[':\n\t\t\t\tthis._store();\n\t\t\t\treturn OPEN_BRACKET_TOKEN;\n\t\t\tcase ']':\n\t\t\t\tthis._store();\n\t\t\t\tthis._mode = 'text';\n\t\t\t\treturn CLOSE_BRACKET_TOKEN;\n\t\t\tcase '=':\n\t\t\t\tthis._store();\n\t\t\t\treturn EQUALS_TOKEN;\n\t\t\tcase ' ':\n\t\t\tcase '\\t':\n\t\t\tcase '\\n':\n\t\t\tcase '\\r':\n\t\t\tcase '\\v':\n\t\t\tcase '\\f':\n\t\t\t\treturn this._whitespace();\n\t\t\tcase '\"':\n\t\t\t\treturn this._string();\n\t\t\tdefault:\n\t\t\t\tif (!this._isIdentifierSymbol(this._cur)) {\n\t\t\t\t\tthis._error = 'unrecognized character';\n\t\t\t\t\treturn ERROR_TOKEN;\n\t\t\t\t}\n\t\t\t\treturn this._identifier();\n\t\t}\n\t}\n\t_whitespace() {\n\t\tthis._store();\n\t\twhile (WHITESPACE_CHARS.indexOf(this._cur) !== -1) {\n\t\t\tthis._store();\n\t\t}\n\t\treturn WHITESPACE_TOKEN;\n\t}\n\t_string() {\n\t\tthis._next();\n\t\twhile (true) {\n\t\t\tswitch (this._cur) {\n\t\t\t\tcase null:\n\t\t\t\t\tthis._error = 'unexpected end of input reading string';\n\t\t\t\t\treturn ERROR_TOKEN;\n\t\t\t\tcase '\"':\n\t\t\t\t\tthis._next();\n\t\t\t\t\treturn STRING_TOKEN;\n\t\t\t\tdefault:\n\t\t\t\t\tthis._store();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\t_identifier() {\n\t\tthis._store();\n\t\twhile (this._cur !== null && this._isIdentifierSymbol(this._cur)) {\n\t\t\tthis._store();\n\t\t}\n\t\treturn IDENTIFIER_TOKEN;\n\t}\n\t_isIdentifierSymbol(s) {\n\t\treturn s.length === 1 && s.match(IDENTIFIER_REGEX) !== null;\n\t}\n\t_eof() {\n\t\treturn this._cur === null;\n\t}\n\t_next() {\n\t\tif (!this._eof()) {\n\t\t\tthis._index++;\n\t\t\tthis._cur = this._index < this._symbols.length ? this._symbols[this._index] : null;\n\t\t}\n\t\treturn this._cur;\n\t}\n\t_store() {\n\t\tthis._buf.push(this._cur);\n\t\treturn this._next();\n\t}\n\t_output(c) {\n\t\tthis._buf.push(c);\n\t}\n}\nclass Parser {\n\tconstructor(symbols) {\n\t\tthis._scanner = new Scanner(symbols);\n\t\tthis._error = null;\n\t}\n\tparse(symbols, tags) {\n\t\twhile (true) {\n\t\t\tconst token = this._scanner.read();\n\t\t\tswitch (token) {\n\t\t\t\tcase EOF_TOKEN:\n\t\t\t\t\treturn true;\n\t\t\t\tcase ERROR_TOKEN:\n\t\t\t\t\treturn false;\n\t\t\t\tcase TEXT_TOKEN:\n\t\t\t\t\tArray.prototype.push.apply(symbols, this._scanner.buf());\n\t\t\t\t\tbreak;\n\t\t\t\tcase OPEN_BRACKET_TOKEN:\n\t\t\t\t\tif (!this._parseTag(symbols, tags)) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\terror() {\n\t\treturn 'Error evaluating markup at #' + this._scanner.last().toString() + ' (' + (this._scanner.error() || this._error) + ')';\n\t}\n\t_parseTag(symbols, tags) {\n\t\tlet token = this._scanner.read();\n\t\tif (token !== IDENTIFIER_TOKEN) {\n\t\t\tthis._error = 'expected identifier';\n\t\t\treturn false;\n\t\t}\n\t\tconst name = this._scanner.buf().join('');\n\t\tif (name[0] === '/') {\n\t\t\tfor (let index = tags.length - 1; index >= 0; --index) {\n\t\t\t\tif (name === '/' + tags[index].name && tags[index].end === null) {\n\t\t\t\t\ttags[index].end = symbols.length;\n\t\t\t\t\ttoken = this._scanner.read();\n\t\t\t\t\tif (token !== CLOSE_BRACKET_TOKEN) {\n\t\t\t\t\t\tthis._error = 'expected close bracket';\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._error = 'failed to find matching tag';\n\t\t\treturn false;\n\t\t}\n\t\tconst tag = {\n\t\t\tname: name,\n\t\t\tvalue: null,\n\t\t\tattributes: {},\n\t\t\tstart: symbols.length,\n\t\t\tend: null\n\t\t};\n\t\ttoken = this._scanner.read();\n\t\tif (token === EQUALS_TOKEN) {\n\t\t\ttoken = this._scanner.read();\n\t\t\tif (token !== STRING_TOKEN) {\n\t\t\t\tthis._error = 'expected string';\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\ttag.value = this._scanner.buf().join('');\n\t\t\ttoken = this._scanner.read();\n\t\t}\n\t\twhile (true) {\n\t\t\tswitch (token) {\n\t\t\t\tcase CLOSE_BRACKET_TOKEN:\n\t\t\t\t\ttags.push(tag);\n\t\t\t\t\treturn true;\n\t\t\t\tcase IDENTIFIER_TOKEN:\n\t\t\t\t\t{\n\t\t\t\t\t\tconst identifier = this._scanner.buf().join('');\n\t\t\t\t\t\ttoken = this._scanner.read();\n\t\t\t\t\t\tif (token !== EQUALS_TOKEN) {\n\t\t\t\t\t\t\tthis._error = 'expected equals';\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttoken = this._scanner.read();\n\t\t\t\t\t\tif (token !== STRING_TOKEN) {\n\t\t\t\t\t\t\tthis._error = 'expected string';\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst value = this._scanner.buf().join('');\n\t\t\t\t\t\ttag.attributes[identifier] = value;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tdefault:\n\t\t\t\t\tthis._error = 'expected close bracket or identifier';\n\t\t\t\t\treturn false;\n\t\t\t}\n\t\t\ttoken = this._scanner.read();\n\t\t}\n\t}\n}\nfunction merge(target, source) {\n\tfor (const key in source) {\n\t\tif (!source.hasOwnProperty(key)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst value = source[key];\n\t\tif (value instanceof Object) {\n\t\t\tif (!target.hasOwnProperty(key)) {\n\t\t\t\ttarget[key] = {};\n\t\t\t}\n\t\t\tmerge(target[key], source[key]);\n\t\t} else {\n\t\t\ttarget[key] = value;\n\t\t}\n\t}\n}\nfunction combineTags(tags) {\n\tif (tags.length === 0) {\n\t\treturn null;\n\t}\n\tconst result = {};\n\tfor (let index = 0; index < tags.length; ++index) {\n\t\tconst tag = tags[index];\n\t\tconst tmp = {};\n\t\ttmp[tag.name] = {\n\t\t\tvalue: tag.value,\n\t\t\tattributes: tag.attributes\n\t\t};\n\t\tmerge(result, tmp);\n\t}\n\treturn result;\n}\nfunction resolveMarkupTags(tags, numSymbols) {\n\tif (tags.length === 0) {\n\t\treturn null;\n\t}\n\tconst edges = {};\n\tfor (let index = 0; index < tags.length; ++index) {\n\t\tconst tag = tags[index];\n\t\tif (!edges.hasOwnProperty(tag.start)) {\n\t\t\tedges[tag.start] = {\n\t\t\t\topen: [tag],\n\t\t\t\tclose: null\n\t\t\t};\n\t\t} else {\n\t\t\tif (edges[tag.start].open === null) {\n\t\t\t\tedges[tag.start].open = [tag];\n\t\t\t} else {\n\t\t\t\tedges[tag.start].open.push(tag);\n\t\t\t}\n\t\t}\n\t\tif (!edges.hasOwnProperty(tag.end)) {\n\t\t\tedges[tag.end] = {\n\t\t\t\topen: null,\n\t\t\t\tclose: [tag]\n\t\t\t};\n\t\t} else {\n\t\t\tif (edges[tag.end].close === null) {\n\t\t\t\tedges[tag.end].close = [tag];\n\t\t\t} else {\n\t\t\t\tedges[tag.end].close.push(tag);\n\t\t\t}\n\t\t}\n\t}\n\tlet tagStack = [];\n\tfunction removeTags(tags) {\n\t\ttagStack = tagStack.filter(function (tag) {\n\t\t\treturn tags.find(function (t) {\n\t\t\t\treturn t === tag;\n\t\t\t}) === undefined;\n\t\t});\n\t}\n\tfunction addTags(tags) {\n\t\tfor (let index = 0; index < tags.length; ++index) {\n\t\t\ttagStack.push(tags[index]);\n\t\t}\n\t}\n\tconst edgeKeys = Object.keys(edges).sort(function (a, b) {\n\t\treturn a - b;\n\t});\n\tconst resolvedTags = [];\n\tfor (let index = 0; index < edgeKeys.length; ++index) {\n\t\tconst edge = edges[edgeKeys[index]];\n\t\tif (edge.close !== null) {\n\t\t\tremoveTags(edge.close);\n\t\t}\n\t\tif (edge.open !== null) {\n\t\t\taddTags(edge.open);\n\t\t}\n\t\tresolvedTags.push({\n\t\t\tstart: edgeKeys[index],\n\t\t\ttags: combineTags(tagStack)\n\t\t});\n\t}\n\tconst result = [];\n\tlet prevTag = null;\n\tfor (let index = 0; index < resolvedTags.length; ++index) {\n\t\tconst resolvedTag = resolvedTags[index];\n\t\twhile (result.length < resolvedTag.start) {\n\t\t\tresult.push(prevTag ? prevTag.tags : null);\n\t\t}\n\t\tprevTag = resolvedTag;\n\t}\n\twhile (result.length < numSymbols) {\n\t\tresult.push(null);\n\t}\n\treturn result;\n}\nfunction evaluateMarkup(symbols) {\n\tconst parser = new Parser(symbols);\n\tconst stripped_symbols = [];\n\tconst tags = [];\n\tif (!parser.parse(stripped_symbols, tags)) {\n\t\tconsole.warn(parser.error());\n\t\treturn {\n\t\t\tsymbols: symbols,\n\t\t\ttags: null\n\t\t};\n\t}\n\tconst invalidTag = tags.find(function (t) {\n\t\treturn t.end === null;\n\t});\n\tif (invalidTag) {\n\t\tconsole.warn(`Markup error: found unclosed tag='${invalidTag.name}'`);\n\t\treturn {\n\t\t\tsymbols: symbols,\n\t\t\ttags: null\n\t\t};\n\t}\n\tconst resolved_tags = resolveMarkupTags(tags, stripped_symbols.length);\n\treturn {\n\t\tsymbols: stripped_symbols,\n\t\ttags: resolved_tags\n\t};\n}\nclass Markup {\n\tstatic evaluate(symbols) {\n\t\treturn evaluateMarkup(symbols);\n\t}\n}\n\nexport { Markup };\n","import '../../../core/tracing.js';\nimport { string } from '../../../core/string.js';\nimport { math } from '../../../core/math/math.js';\nimport { Color } from '../../../core/math/color.js';\nimport { Vec2 } from '../../../core/math/vec2.js';\nimport { BoundingBox } from '../../../core/shape/bounding-box.js';\nimport { SEMANTIC_POSITION, SEMANTIC_TEXCOORD0, SEMANTIC_COLOR, SEMANTIC_ATTR8, SEMANTIC_ATTR9, TYPE_FLOAT32 } from '../../../platform/graphics/constants.js';\nimport { VertexIterator } from '../../../platform/graphics/vertex-iterator.js';\nimport { GraphNode } from '../../../scene/graph-node.js';\nimport { MeshInstance } from '../../../scene/mesh-instance.js';\nimport { Model } from '../../../scene/model.js';\nimport { Mesh } from '../../../scene/mesh.js';\nimport { LocalizedAsset } from '../../asset/asset-localized.js';\nimport { FONT_MSDF, FONT_BITMAP } from '../../font/constants.js';\nimport { Markup } from './markup.js';\n\nclass MeshInfo {\n\tconstructor() {\n\t\tthis.count = 0;\n\t\tthis.quad = 0;\n\t\tthis.lines = {};\n\t\tthis.positions = [];\n\t\tthis.normals = [];\n\t\tthis.uvs = [];\n\t\tthis.colors = [];\n\t\tthis.indices = [];\n\t\tthis.outlines = [];\n\t\tthis.shadows = [];\n\t\tthis.meshInstance = null;\n\t}\n}\nfunction createTextMesh(device, meshInfo) {\n\tconst mesh = new Mesh(device);\n\tmesh.setPositions(meshInfo.positions);\n\tmesh.setNormals(meshInfo.normals);\n\tmesh.setColors32(meshInfo.colors);\n\tmesh.setUvs(0, meshInfo.uvs);\n\tmesh.setIndices(meshInfo.indices);\n\tmesh.setVertexStream(SEMANTIC_ATTR8, meshInfo.outlines, 3, undefined, TYPE_FLOAT32, false);\n\tmesh.setVertexStream(SEMANTIC_ATTR9, meshInfo.shadows, 3, undefined, TYPE_FLOAT32, false);\n\tmesh.update();\n\treturn mesh;\n}\nconst LINE_BREAK_CHAR = /^[\\r\\n]$/;\nconst WHITESPACE_CHAR = /^[ \\t]$/;\nconst WORD_BOUNDARY_CHAR = /^[ \\t\\-]|[\\u200b]$/;\nconst ALPHANUMERIC_CHAR = /^[a-z0-9]$/i;\nconst CJK_CHAR = /^[\\u1100-\\u11ff]|[\\u3000-\\u9fff]|[\\ua960-\\ua97f]|[\\uac00-\\ud7ff]$/;\nconst NO_LINE_BREAK_CJK_CHAR = /^[]$/;\nconst CONTROL_CHARS = ['\\u200B', '\\u061C', '\\u200E', '\\u200F', '\\u202A', '\\u202B', '\\u202C', '\\u202D', '\\u202E', '\\u2066', '\\u2067', '\\u2068', '\\u2069'];\nconst CONTROL_GLYPH_DATA = {\n\twidth: 0,\n\theight: 0,\n\txadvance: 0,\n\txoffset: 0,\n\tyoffset: 0\n};\nconst colorTmp = new Color();\nconst vec2Tmp = new Vec2();\nclass TextElement {\n\tconstructor(element) {\n\t\tthis._element = element;\n\t\tthis._system = element.system;\n\t\tthis._entity = element.entity;\n\t\tthis._text = '';\n\t\tthis._symbols = [];\n\t\tthis._colorPalette = [];\n\t\tthis._outlinePalette = [];\n\t\tthis._shadowPalette = [];\n\t\tthis._symbolColors = null;\n\t\tthis._symbolOutlineParams = null;\n\t\tthis._symbolShadowParams = null;\n\t\tthis._i18nKey = null;\n\t\tthis._fontAsset = new LocalizedAsset(this._system.app);\n\t\tthis._fontAsset.disableLocalization = true;\n\t\tthis._fontAsset.on('load', this._onFontLoad, this);\n\t\tthis._fontAsset.on('change', this._onFontChange, this);\n\t\tthis._fontAsset.on('remove', this._onFontRemove, this);\n\t\tthis._font = null;\n\t\tthis._color = new Color(1, 1, 1, 1);\n\t\tthis._colorUniform = new Float32Array(3);\n\t\tthis._spacing = 1;\n\t\tthis._fontSize = 32;\n\t\tthis._fontMinY = 0;\n\t\tthis._fontMaxY = 0;\n\t\tthis._originalFontSize = 32;\n\t\tthis._maxFontSize = 32;\n\t\tthis._minFontSize = 8;\n\t\tthis._autoFitWidth = false;\n\t\tthis._autoFitHeight = false;\n\t\tthis._maxLines = -1;\n\t\tthis._lineHeight = 32;\n\t\tthis._scaledLineHeight = 32;\n\t\tthis._wrapLines = false;\n\t\tthis._drawOrder = 0;\n\t\tthis._alignment = new Vec2(0.5, 0.5);\n\t\tthis._autoWidth = true;\n\t\tthis._autoHeight = true;\n\t\tthis.width = 0;\n\t\tthis.height = 0;\n\t\tthis._node = new GraphNode();\n\t\tthis._model = new Model();\n\t\tthis._model.graph = this._node;\n\t\tthis._entity.addChild(this._node);\n\t\tthis._meshInfo = [];\n\t\tthis._material = null;\n\t\tthis._aabbDirty = true;\n\t\tthis._aabb = new BoundingBox();\n\t\tthis._noResize = false;\n\t\tthis._currentMaterialType = null;\n\t\tthis._maskedMaterialSrc = null;\n\t\tthis._rtlReorder = false;\n\t\tthis._unicodeConverter = false;\n\t\tthis._rtl = false;\n\t\tthis._outlineColor = new Color(0, 0, 0, 1);\n\t\tthis._outlineColorUniform = new Float32Array(4);\n\t\tthis._outlineThicknessScale = 0.2;\n\t\tthis._outlineThickness = 0.0;\n\t\tthis._shadowColor = new Color(0, 0, 0, 1);\n\t\tthis._shadowColorUniform = new Float32Array(4);\n\t\tthis._shadowOffsetScale = 0.005;\n\t\tthis._shadowOffset = new Vec2(0, 0);\n\t\tthis._shadowOffsetUniform = new Float32Array(2);\n\t\tthis._enableMarkup = false;\n\t\tthis._onScreenChange(this._element.screen);\n\t\telement.on('resize', this._onParentResize, this);\n\t\telement.on('set:screen', this._onScreenChange, this);\n\t\telement.on('screen:set:screenspace', this._onScreenSpaceChange, this);\n\t\telement.on('set:draworder', this._onDrawOrderChange, this);\n\t\telement.on('set:pivot', this._onPivotChange, this);\n\t\tthis._system.app.i18n.on('set:locale', this._onLocaleSet, this);\n\t\tthis._system.app.i18n.on('data:add', this._onLocalizationData, this);\n\t\tthis._system.app.i18n.on('data:remove', this._onLocalizationData, this);\n\t\tthis._rangeStart = 0;\n\t\tthis._rangeEnd = 0;\n\t}\n\tdestroy() {\n\t\tthis._setMaterial(null);\n\t\tif (this._model) {\n\t\t\tthis._element.removeModelFromLayers(this._model);\n\t\t\tthis._model.destroy();\n\t\t\tthis._model = null;\n\t\t}\n\t\tthis._fontAsset.destroy();\n\t\tthis.font = null;\n\t\tthis._element.off('resize', this._onParentResize, this);\n\t\tthis._element.off('set:screen', this._onScreenChange, this);\n\t\tthis._element.off('screen:set:screenspace', this._onScreenSpaceChange, this);\n\t\tthis._element.off('set:draworder', this._onDrawOrderChange, this);\n\t\tthis._element.off('set:pivot', this._onPivotChange, this);\n\t\tthis._system.app.i18n.off('set:locale', this._onLocaleSet, this);\n\t\tthis._system.app.i18n.off('data:add', this._onLocalizationData, this);\n\t\tthis._system.app.i18n.off('data:remove', this._onLocalizationData, this);\n\t}\n\t_onParentResize(width, height) {\n\t\tif (this._noResize) return;\n\t\tif (this._font) this._updateText();\n\t}\n\t_onScreenChange(screen) {\n\t\tif (screen) {\n\t\t\tthis._updateMaterial(screen.screen.screenSpace);\n\t\t} else {\n\t\t\tthis._updateMaterial(false);\n\t\t}\n\t}\n\t_onScreenSpaceChange(value) {\n\t\tthis._updateMaterial(value);\n\t}\n\t_onDrawOrderChange(order) {\n\t\tthis._drawOrder = order;\n\t\tif (this._model) {\n\t\t\tfor (let i = 0, len = this._model.meshInstances.length; i < len; i++) {\n\t\t\t\tthis._model.meshInstances[i].drawOrder = order;\n\t\t\t}\n\t\t}\n\t}\n\t_onPivotChange(pivot) {\n\t\tif (this._font) this._updateText();\n\t}\n\t_onLocaleSet(locale) {\n\t\tif (!this._i18nKey) return;\n\t\tif (this.fontAsset) {\n\t\t\tconst asset = this._system.app.assets.get(this.fontAsset);\n\t\t\tif (!asset || !asset.resource || asset.resource !== this._font) {\n\t\t\t\tthis.font = null;\n\t\t\t}\n\t\t}\n\t\tthis._resetLocalizedText();\n\t}\n\t_onLocalizationData(locale, messages) {\n\t\tif (this._i18nKey && messages[this._i18nKey]) {\n\t\t\tthis._resetLocalizedText();\n\t\t}\n\t}\n\t_resetLocalizedText() {\n\t\tthis._setText(this._system.app.i18n.getText(this._i18nKey));\n\t}\n\t_setText(text) {\n\t\tif (this.unicodeConverter) {\n\t\t\tconst unicodeConverterFunc = this._system.getUnicodeConverter();\n\t\t\tif (unicodeConverterFunc) {\n\t\t\t\ttext = unicodeConverterFunc(text);\n\t\t\t} else {\n\t\t\t\tconsole.warn('Element created with unicodeConverter option but no unicodeConverter function registered');\n\t\t\t}\n\t\t}\n\t\tif (this._text !== text) {\n\t\t\tif (this._font) {\n\t\t\t\tthis._updateText(text);\n\t\t\t}\n\t\t\tthis._text = text;\n\t\t}\n\t}\n\t_updateText(text) {\n\t\tlet tags;\n\t\tif (text === undefined) text = this._text;\n\t\tthis._symbols = string.getSymbols(text.normalize ? text.normalize('NFC') : text);\n\t\tif (this._symbols.length === 0) {\n\t\t\tthis._symbols = [' '];\n\t\t}\n\t\tif (this._enableMarkup) {\n\t\t\tconst results = Markup.evaluate(this._symbols);\n\t\t\tthis._symbols = results.symbols;\n\t\t\ttags = results.tags || [];\n\t\t}\n\t\tif (this._rtlReorder) {\n\t\t\tconst rtlReorderFunc = this._system.app.systems.element.getRtlReorder();\n\t\t\tif (rtlReorderFunc) {\n\t\t\t\tconst results = rtlReorderFunc(this._symbols);\n\t\t\t\tthis._rtl = results.rtl;\n\t\t\t\tthis._symbols = results.mapping.map(function (v) {\n\t\t\t\t\treturn this._symbols[v];\n\t\t\t\t}, this);\n\t\t\t\tif (tags) {\n\t\t\t\t\ttags = results.mapping.map(function (v) {\n\t\t\t\t\t\treturn tags[v];\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.warn('Element created with rtlReorder option but no rtlReorder function registered');\n\t\t\t}\n\t\t} else {\n\t\t\tthis._rtl = false;\n\t\t}\n\t\tconst getColorThicknessHash = (color, thickness) => {\n\t\t\treturn `${color.toString(true).toLowerCase()}:${thickness.toFixed(2)}`;\n\t\t};\n\t\tconst getColorOffsetHash = (color, offset) => {\n\t\t\treturn `${color.toString(true).toLowerCase()}:${offset.x.toFixed(2)}:${offset.y.toFixed(2)}`;\n\t\t};\n\t\tif (tags) {\n\t\t\tconst paletteMap = {};\n\t\t\tconst outlinePaletteMap = {};\n\t\t\tconst shadowPaletteMap = {};\n\t\t\tthis._colorPalette = [Math.round(this._color.r * 255), Math.round(this._color.g * 255), Math.round(this._color.b * 255)];\n\t\t\tthis._outlinePalette = [Math.round(this._outlineColor.r * 255), Math.round(this._outlineColor.g * 255), Math.round(this._outlineColor.b * 255), Math.round(this._outlineColor.a * 255), Math.round(this._outlineThickness * 255)];\n\t\t\tthis._shadowPalette = [Math.round(this._shadowColor.r * 255), Math.round(this._shadowColor.g * 255), Math.round(this._shadowColor.b * 255), Math.round(this._shadowColor.a * 255), Math.round(this._shadowOffset.x * 127), Math.round(this._shadowOffset.y * 127)];\n\t\t\tthis._symbolColors = [];\n\t\t\tthis._symbolOutlineParams = [];\n\t\t\tthis._symbolShadowParams = [];\n\t\t\tpaletteMap[this._color.toString(false).toLowerCase()] = 0;\n\t\t\toutlinePaletteMap[getColorThicknessHash(this._outlineColor, this._outlineThickness)] = 0;\n\t\t\tshadowPaletteMap[getColorOffsetHash(this._shadowColor, this._shadowOffset)] = 0;\n\t\t\tfor (let i = 0, len = this._symbols.length; i < len; ++i) {\n\t\t\t\tconst tag = tags[i];\n\t\t\t\tlet color = 0;\n\t\t\t\tif (tag && tag.color && tag.color.value) {\n\t\t\t\t\tconst c = tag.color.value;\n\t\t\t\t\tif (c.length === 7 && c[0] === '#') {\n\t\t\t\t\t\tconst hex = c.substring(1).toLowerCase();\n\t\t\t\t\t\tif (paletteMap.hasOwnProperty(hex)) {\n\t\t\t\t\t\t\tcolor = paletteMap[hex];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (/^([0-9a-f]{2}){3}$/.test(hex)) {\n\t\t\t\t\t\t\t\tcolor = this._colorPalette.length / 3;\n\t\t\t\t\t\t\t\tpaletteMap[hex] = color;\n\t\t\t\t\t\t\t\tthis._colorPalette.push(parseInt(hex.substring(0, 2), 16));\n\t\t\t\t\t\t\t\tthis._colorPalette.push(parseInt(hex.substring(2, 4), 16));\n\t\t\t\t\t\t\t\tthis._colorPalette.push(parseInt(hex.substring(4, 6), 16));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis._symbolColors.push(color);\n\t\t\t\tlet outline = 0;\n\t\t\t\tif (tag && tag.outline && (tag.outline.attributes.color || tag.outline.attributes.thickness)) {\n\t\t\t\t\tlet _color = tag.outline.attributes.color ? colorTmp.fromString(tag.outline.attributes.color) : this._outlineColor;\n\t\t\t\t\tlet thickness = Number(tag.outline.attributes.thickness);\n\t\t\t\t\tif (Number.isNaN(_color.r) || Number.isNaN(_color.g) || Number.isNaN(_color.b) || Number.isNaN(_color.a)) {\n\t\t\t\t\t\t_color = this._outlineColor;\n\t\t\t\t\t}\n\t\t\t\t\tif (Number.isNaN(thickness)) {\n\t\t\t\t\t\tthickness = this._outlineThickness;\n\t\t\t\t\t}\n\t\t\t\t\tconst outlineHash = getColorThicknessHash(_color, thickness);\n\t\t\t\t\tif (outlinePaletteMap.hasOwnProperty(outlineHash)) {\n\t\t\t\t\t\toutline = outlinePaletteMap[outlineHash];\n\t\t\t\t\t} else {\n\t\t\t\t\t\toutline = this._outlinePalette.length / 5;\n\t\t\t\t\t\toutlinePaletteMap[outlineHash] = outline;\n\t\t\t\t\t\tthis._outlinePalette.push(Math.round(_color.r * 255), Math.round(_color.g * 255), Math.round(_color.b * 255), Math.round(_color.a * 255), Math.round(thickness * 255));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis._symbolOutlineParams.push(outline);\n\t\t\t\tlet shadow = 0;\n\t\t\t\tif (tag && tag.shadow && (tag.shadow.attributes.color || tag.shadow.attributes.offset || tag.shadow.attributes.offsetX || tag.shadow.attributes.offsetY)) {\n\t\t\t\t\tlet _color2 = tag.shadow.attributes.color ? colorTmp.fromString(tag.shadow.attributes.color) : this._shadowColor;\n\t\t\t\t\tconst off = Number(tag.shadow.attributes.offset);\n\t\t\t\t\tconst offX = Number(tag.shadow.attributes.offsetX);\n\t\t\t\t\tconst offY = Number(tag.shadow.attributes.offsetY);\n\t\t\t\t\tif (Number.isNaN(_color2.r) || Number.isNaN(_color2.g) || Number.isNaN(_color2.b) || Number.isNaN(_color2.a)) {\n\t\t\t\t\t\t_color2 = this._shadowColor;\n\t\t\t\t\t}\n\t\t\t\t\tconst offset = vec2Tmp.set(!Number.isNaN(offX) ? offX : !Number.isNaN(off) ? off : this._shadowOffset.x, !Number.isNaN(offY) ? offY : !Number.isNaN(off) ? off : this._shadowOffset.y);\n\t\t\t\t\tconst shadowHash = getColorOffsetHash(_color2, offset);\n\t\t\t\t\tif (shadowPaletteMap.hasOwnProperty(shadowHash)) {\n\t\t\t\t\t\tshadow = shadowPaletteMap[shadowHash];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tshadow = this._shadowPalette.length / 6;\n\t\t\t\t\t\tshadowPaletteMap[shadowHash] = shadow;\n\t\t\t\t\t\tthis._shadowPalette.push(Math.round(_color2.r * 255), Math.round(_color2.g * 255), Math.round(_color2.b * 255), Math.round(_color2.a * 255), Math.round(offset.x * 127), Math.round(offset.y * 127));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis._symbolShadowParams.push(shadow);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._colorPalette = [];\n\t\t\tthis._symbolColors = null;\n\t\t\tthis._symbolOutlineParams = null;\n\t\t\tthis._symbolShadowParams = null;\n\t\t}\n\t\tthis._updateMaterialEmissive();\n\t\tthis._updateMaterialOutline();\n\t\tthis._updateMaterialShadow();\n\t\tconst charactersPerTexture = this._calculateCharsPerTexture();\n\t\tlet removedModel = false;\n\t\tconst element = this._element;\n\t\tconst screenSpace = element._isScreenSpace();\n\t\tconst screenCulled = element._isScreenCulled();\n\t\tconst visibleFn = function visibleFn(camera) {\n\t\t\treturn element.isVisibleForCamera(camera);\n\t\t};\n\t\tfor (let i = 0, len = this._meshInfo.length; i < len; i++) {\n\t\t\tconst l = charactersPerTexture[i] || 0;\n\t\t\tconst meshInfo = this._meshInfo[i];\n\t\t\tif (meshInfo.count !== l) {\n\t\t\t\tif (!removedModel) {\n\t\t\t\t\telement.removeModelFromLayers(this._model);\n\t\t\t\t\tremovedModel = true;\n\t\t\t\t}\n\t\t\t\tmeshInfo.count = l;\n\t\t\t\tmeshInfo.positions.length = meshInfo.normals.length = l * 3 * 4;\n\t\t\t\tmeshInfo.indices.length = l * 3 * 2;\n\t\t\t\tmeshInfo.uvs.length = l * 2 * 4;\n\t\t\t\tmeshInfo.colors.length = l * 4 * 4;\n\t\t\t\tmeshInfo.outlines.length = l * 4 * 3;\n\t\t\t\tmeshInfo.shadows.length = l * 4 * 3;\n\t\t\t\tif (meshInfo.meshInstance) {\n\t\t\t\t\tthis._removeMeshInstance(meshInfo.meshInstance);\n\t\t\t\t}\n\t\t\t\tif (l === 0) {\n\t\t\t\t\tmeshInfo.meshInstance = null;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tfor (let v = 0; v < l; v++) {\n\t\t\t\t\tmeshInfo.indices[v * 3 * 2 + 0] = v * 4;\n\t\t\t\t\tmeshInfo.indices[v * 3 * 2 + 1] = v * 4 + 1;\n\t\t\t\t\tmeshInfo.indices[v * 3 * 2 + 2] = v * 4 + 3;\n\t\t\t\t\tmeshInfo.indices[v * 3 * 2 + 3] = v * 4 + 2;\n\t\t\t\t\tmeshInfo.indices[v * 3 * 2 + 4] = v * 4 + 3;\n\t\t\t\t\tmeshInfo.indices[v * 3 * 2 + 5] = v * 4 + 1;\n\t\t\t\t\tmeshInfo.normals[v * 4 * 3 + 0] = 0;\n\t\t\t\t\tmeshInfo.normals[v * 4 * 3 + 1] = 0;\n\t\t\t\t\tmeshInfo.normals[v * 4 * 3 + 2] = -1;\n\t\t\t\t\tmeshInfo.normals[v * 4 * 3 + 3] = 0;\n\t\t\t\t\tmeshInfo.normals[v * 4 * 3 + 4] = 0;\n\t\t\t\t\tmeshInfo.normals[v * 4 * 3 + 5] = -1;\n\t\t\t\t\tmeshInfo.normals[v * 4 * 3 + 6] = 0;\n\t\t\t\t\tmeshInfo.normals[v * 4 * 3 + 7] = 0;\n\t\t\t\t\tmeshInfo.normals[v * 4 * 3 + 8] = -1;\n\t\t\t\t\tmeshInfo.normals[v * 4 * 3 + 9] = 0;\n\t\t\t\t\tmeshInfo.normals[v * 4 * 3 + 10] = 0;\n\t\t\t\t\tmeshInfo.normals[v * 4 * 3 + 11] = -1;\n\t\t\t\t}\n\t\t\t\tconst mesh = createTextMesh(this._system.app.graphicsDevice, meshInfo);\n\t\t\t\tconst mi = new MeshInstance(mesh, this._material, this._node);\n\t\t\t\tmi.name = 'Text Element: ' + this._entity.name;\n\t\t\t\tmi.castShadow = false;\n\t\t\t\tmi.receiveShadow = false;\n\t\t\t\tmi.cull = !screenSpace;\n\t\t\t\tmi.screenSpace = screenSpace;\n\t\t\t\tmi.drawOrder = this._drawOrder;\n\t\t\t\tif (screenCulled) {\n\t\t\t\t\tmi.cull = true;\n\t\t\t\t\tmi.isVisibleFunc = visibleFn;\n\t\t\t\t}\n\t\t\t\tthis._setTextureParams(mi, this._font.textures[i]);\n\t\t\t\tmi.setParameter('material_emissive', this._colorUniform);\n\t\t\t\tmi.setParameter('material_opacity', this._color.a);\n\t\t\t\tmi.setParameter('font_sdfIntensity', this._font.intensity);\n\t\t\t\tmi.setParameter('font_pxrange', this._getPxRange(this._font));\n\t\t\t\tmi.setParameter('font_textureWidth', this._font.data.info.maps[i].width);\n\t\t\t\tmi.setParameter('outline_color', this._outlineColorUniform);\n\t\t\t\tmi.setParameter('outline_thickness', this._outlineThicknessScale * this._outlineThickness);\n\t\t\t\tmi.setParameter('shadow_color', this._shadowColorUniform);\n\t\t\t\tif (this._symbolShadowParams) {\n\t\t\t\t\tthis._shadowOffsetUniform[0] = 0;\n\t\t\t\t\tthis._shadowOffsetUniform[1] = 0;\n\t\t\t\t} else {\n\t\t\t\t\tconst ratio = -this._font.data.info.maps[i].width / this._font.data.info.maps[i].height;\n\t\t\t\t\tthis._shadowOffsetUniform[0] = this._shadowOffsetScale * this._shadowOffset.x;\n\t\t\t\t\tthis._shadowOffsetUniform[1] = ratio * this._shadowOffsetScale * this._shadowOffset.y;\n\t\t\t\t}\n\t\t\t\tmi.setParameter('shadow_offset', this._shadowOffsetUniform);\n\t\t\t\tmeshInfo.meshInstance = mi;\n\t\t\t\tthis._model.meshInstances.push(mi);\n\t\t\t}\n\t\t}\n\t\tif (this._element.maskedBy) {\n\t\t\tthis._element._setMaskedBy(this._element.maskedBy);\n\t\t}\n\t\tif (removedModel && this._element.enabled && this._entity.enabled) {\n\t\t\tthis._element.addModelToLayers(this._model);\n\t\t}\n\t\tthis._updateMeshes();\n\t\tthis._rangeStart = 0;\n\t\tthis._rangeEnd = this._symbols.length;\n\t\tthis._updateRenderRange();\n\t}\n\t_removeMeshInstance(meshInstance) {\n\t\tmeshInstance.destroy();\n\t\tconst idx = this._model.meshInstances.indexOf(meshInstance);\n\t\tif (idx !== -1) this._model.meshInstances.splice(idx, 1);\n\t}\n\t_setMaterial(material) {\n\t\tthis._material = material;\n\t\tif (this._model) {\n\t\t\tfor (let i = 0, len = this._model.meshInstances.length; i < len; i++) {\n\t\t\t\tconst mi = this._model.meshInstances[i];\n\t\t\t\tmi.material = material;\n\t\t\t}\n\t\t}\n\t}\n\t_updateMaterial(screenSpace) {\n\t\tconst element = this._element;\n\t\tconst screenCulled = element._isScreenCulled();\n\t\tconst visibleFn = function visibleFn(camera) {\n\t\t\treturn element.isVisibleForCamera(camera);\n\t\t};\n\t\tconst msdf = this._font && this._font.type === FONT_MSDF;\n\t\tthis._material = this._system.getTextElementMaterial(screenSpace, msdf, this._enableMarkup);\n\t\tif (this._model) {\n\t\t\tfor (let i = 0, len = this._model.meshInstances.length; i < len; i++) {\n\t\t\t\tconst mi = this._model.meshInstances[i];\n\t\t\t\tmi.cull = !screenSpace;\n\t\t\t\tmi.material = this._material;\n\t\t\t\tmi.screenSpace = screenSpace;\n\t\t\t\tif (screenCulled) {\n\t\t\t\t\tmi.cull = true;\n\t\t\t\t\tmi.isVisibleFunc = visibleFn;\n\t\t\t\t} else {\n\t\t\t\t\tmi.isVisibleFunc = null;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t_updateMaterialEmissive() {\n\t\tif (this._symbolColors) {\n\t\t\tthis._colorUniform[0] = 1;\n\t\t\tthis._colorUniform[1] = 1;\n\t\t\tthis._colorUniform[2] = 1;\n\t\t} else {\n\t\t\tthis._colorUniform[0] = this._color.r;\n\t\t\tthis._colorUniform[1] = this._color.g;\n\t\t\tthis._colorUniform[2] = this._color.b;\n\t\t}\n\t}\n\t_updateMaterialOutline() {\n\t\tif (this._symbolOutlineParams) {\n\t\t\tthis._outlineColorUniform[0] = 0;\n\t\t\tthis._outlineColorUniform[1] = 0;\n\t\t\tthis._outlineColorUniform[2] = 0;\n\t\t\tthis._outlineColorUniform[3] = 1;\n\t\t} else {\n\t\t\tthis._outlineColorUniform[0] = this._outlineColor.r;\n\t\t\tthis._outlineColorUniform[1] = this._outlineColor.g;\n\t\t\tthis._outlineColorUniform[2] = this._outlineColor.b;\n\t\t\tthis._outlineColorUniform[3] = this._outlineColor.a;\n\t\t}\n\t}\n\t_updateMaterialShadow() {\n\t\tif (this._symbolOutlineParams) {\n\t\t\tthis._shadowColorUniform[0] = 0;\n\t\t\tthis._shadowColorUniform[1] = 0;\n\t\t\tthis._shadowColorUniform[2] = 0;\n\t\t\tthis._shadowColorUniform[3] = 0;\n\t\t} else {\n\t\t\tthis._shadowColorUniform[0] = this._shadowColor.r;\n\t\t\tthis._shadowColorUniform[1] = this._shadowColor.g;\n\t\t\tthis._shadowColorUniform[2] = this._shadowColor.b;\n\t\t\tthis._shadowColorUniform[3] = this._shadowColor.a;\n\t\t}\n\t}\n\t_isWordBoundary(char) {\n\t\treturn WORD_BOUNDARY_CHAR.test(char);\n\t}\n\t_isValidNextChar(nextchar) {\n\t\treturn nextchar !== null && !NO_LINE_BREAK_CJK_CHAR.test(nextchar);\n\t}\n\t_isNextCJKBoundary(char, nextchar) {\n\t\treturn CJK_CHAR.test(char) && (WORD_BOUNDARY_CHAR.test(nextchar) || ALPHANUMERIC_CHAR.test(nextchar));\n\t}\n\t_isNextCJKWholeWord(nextchar) {\n\t\treturn CJK_CHAR.test(nextchar);\n\t}\n\t_updateMeshes() {\n\t\tconst json = this._font.data;\n\t\tconst self = this;\n\t\tconst minFont = Math.min(this._minFontSize, this._maxFontSize);\n\t\tconst maxFont = this._maxFontSize;\n\t\tconst autoFit = this._shouldAutoFit();\n\t\tif (autoFit) {\n\t\t\tthis._fontSize = this._maxFontSize;\n\t\t}\n\t\tconst MAGIC = 32;\n\t\tconst l = this._symbols.length;\n\t\tlet _x = 0;\n\t\tlet _y = 0;\n\t\tlet _z = 0;\n\t\tlet _xMinusTrailingWhitespace = 0;\n\t\tlet lines = 1;\n\t\tlet wordStartX = 0;\n\t\tlet wordStartIndex = 0;\n\t\tlet lineStartIndex = 0;\n\t\tlet numWordsThisLine = 0;\n\t\tlet numCharsThisLine = 0;\n\t\tlet numBreaksThisLine = 0;\n\t\tconst splitHorizontalAnchors = Math.abs(this._element.anchor.x - this._element.anchor.z) >= 0.0001;\n\t\tlet maxLineWidth = this._element.calculatedWidth;\n\t\tif (this.autoWidth && !splitHorizontalAnchors || !this._wrapLines) {\n\t\t\tmaxLineWidth = Number.POSITIVE_INFINITY;\n\t\t}\n\t\tlet fontMinY = 0;\n\t\tlet fontMaxY = 0;\n\t\tlet char, data, quad, nextchar;\n\t\tfunction breakLine(symbols, lineBreakIndex, lineBreakX) {\n\t\t\tself._lineWidths.push(Math.abs(lineBreakX));\n\t\t\tconst sliceStart = lineStartIndex > lineBreakIndex ? lineBreakIndex + 1 : lineStartIndex;\n\t\t\tconst sliceEnd = lineStartIndex > lineBreakIndex ? lineStartIndex + 1 : lineBreakIndex;\n\t\t\tconst chars = symbols.slice(sliceStart, sliceEnd);\n\t\t\tif (numBreaksThisLine) {\n\t\t\t\tlet i = chars.length;\n\t\t\t\twhile (i-- && numBreaksThisLine > 0) {\n\t\t\t\t\tif (LINE_BREAK_CHAR.test(chars[i])) {\n\t\t\t\t\t\tchars.splice(i, 1);\n\t\t\t\t\t\tnumBreaksThisLine--;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tself._lineContents.push(chars.join(''));\n\t\t\t_x = 0;\n\t\t\t_y -= self._scaledLineHeight;\n\t\t\tlines++;\n\t\t\tnumWordsThisLine = 0;\n\t\t\tnumCharsThisLine = 0;\n\t\t\tnumBreaksThisLine = 0;\n\t\t\twordStartX = 0;\n\t\t\tlineStartIndex = lineBreakIndex;\n\t\t}\n\t\tlet retryUpdateMeshes = true;\n\t\twhile (retryUpdateMeshes) {\n\t\t\tretryUpdateMeshes = false;\n\t\t\tif (autoFit) {\n\t\t\t\tthis._scaledLineHeight = this._lineHeight * this._fontSize / (this._maxFontSize || 0.0001);\n\t\t\t} else {\n\t\t\t\tthis._scaledLineHeight = this._lineHeight;\n\t\t\t}\n\t\t\tthis.width = 0;\n\t\t\tthis.height = 0;\n\t\t\tthis._lineWidths = [];\n\t\t\tthis._lineContents = [];\n\t\t\t_x = 0;\n\t\t\t_y = 0;\n\t\t\t_z = 0;\n\t\t\t_xMinusTrailingWhitespace = 0;\n\t\t\tlines = 1;\n\t\t\twordStartX = 0;\n\t\t\twordStartIndex = 0;\n\t\t\tlineStartIndex = 0;\n\t\t\tnumWordsThisLine = 0;\n\t\t\tnumCharsThisLine = 0;\n\t\t\tnumBreaksThisLine = 0;\n\t\t\tconst scale = this._fontSize / MAGIC;\n\t\t\tfontMinY = this._fontMinY * scale;\n\t\t\tfontMaxY = this._fontMaxY * scale;\n\t\t\tfor (let i = 0; i < this._meshInfo.length; i++) {\n\t\t\t\tthis._meshInfo[i].quad = 0;\n\t\t\t\tthis._meshInfo[i].lines = {};\n\t\t\t}\n\t\t\tlet color_r = 255;\n\t\t\tlet color_g = 255;\n\t\t\tlet color_b = 255;\n\t\t\tlet outline_color_rg = 255 + 255 * 256;\n\t\t\tlet outline_color_ba = 255 + 255 * 256;\n\t\t\tlet outline_thickness = 0;\n\t\t\tlet shadow_color_rg = 255 + 255 * 256;\n\t\t\tlet shadow_color_ba = 255 + 255 * 256;\n\t\t\tlet shadow_offset_xy = 127 + 127 * 256;\n\t\t\tfor (let i = 0; i < l; i++) {\n\t\t\t\tchar = this._symbols[i];\n\t\t\t\tnextchar = i + 1 >= l ? null : this._symbols[i + 1];\n\t\t\t\tconst isLineBreak = LINE_BREAK_CHAR.test(char);\n\t\t\t\tif (isLineBreak) {\n\t\t\t\t\tnumBreaksThisLine++;\n\t\t\t\t\tif (!this._wrapLines || this._maxLines < 0 || lines < this._maxLines) {\n\t\t\t\t\t\tbreakLine(this._symbols, i, _xMinusTrailingWhitespace);\n\t\t\t\t\t\twordStartIndex = i + 1;\n\t\t\t\t\t\tlineStartIndex = i + 1;\n\t\t\t\t\t}\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tlet x = 0;\n\t\t\t\tlet y = 0;\n\t\t\t\tlet advance = 0;\n\t\t\t\tlet quadsize = 1;\n\t\t\t\tlet dataScale, size;\n\t\t\t\tdata = json.chars[char];\n\t\t\t\tif (!data) {\n\t\t\t\t\tif (CONTROL_CHARS.indexOf(char) !== -1) {\n\t\t\t\t\t\tdata = CONTROL_GLYPH_DATA;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (json.chars[' ']) {\n\t\t\t\t\t\t\tdata = json.chars[' '];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfor (const key in json.chars) {\n\t\t\t\t\t\t\t\tdata = json.chars[key];\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (data) {\n\t\t\t\t\tlet kerning = 0;\n\t\t\t\t\tif (numCharsThisLine > 0) {\n\t\t\t\t\t\tconst kernTable = this._font.data.kerning;\n\t\t\t\t\t\tif (kernTable) {\n\t\t\t\t\t\t\tconst kernLeft = kernTable[string.getCodePoint(this._symbols[i - 1]) || 0];\n\t\t\t\t\t\t\tif (kernLeft) {\n\t\t\t\t\t\t\t\tkerning = kernLeft[string.getCodePoint(this._symbols[i]) || 0] || 0;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tdataScale = data.scale || 1;\n\t\t\t\t\tsize = (data.width + data.height) / 2;\n\t\t\t\t\tquadsize = scale * size / dataScale;\n\t\t\t\t\tadvance = (data.xadvance + kerning) * scale;\n\t\t\t\t\tx = (data.xoffset - kerning) * scale;\n\t\t\t\t\ty = data.yoffset * scale;\n\t\t\t\t} else {\n\t\t\t\t\tconsole.error(`Couldn't substitute missing character: '${char}'`);\n\t\t\t\t}\n\t\t\t\tconst isWhitespace = WHITESPACE_CHAR.test(char);\n\t\t\t\tconst meshInfoId = data && data.map || 0;\n\t\t\t\tconst ratio = -this._font.data.info.maps[meshInfoId].width / this._font.data.info.maps[meshInfoId].height;\n\t\t\t\tconst meshInfo = this._meshInfo[meshInfoId];\n\t\t\t\tconst candidateLineWidth = _x + this._spacing * advance;\n\t\t\t\tif (candidateLineWidth > maxLineWidth && numCharsThisLine > 0 && !isWhitespace) {\n\t\t\t\t\tif (this._maxLines < 0 || lines < this._maxLines) {\n\t\t\t\t\t\tif (numWordsThisLine === 0) {\n\t\t\t\t\t\t\twordStartIndex = i;\n\t\t\t\t\t\t\tbreakLine(this._symbols, i, _xMinusTrailingWhitespace);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst backtrack = Math.max(i - wordStartIndex, 0);\n\t\t\t\t\t\t\tif (this._meshInfo.length <= 1) {\n\t\t\t\t\t\t\t\tmeshInfo.lines[lines - 1] -= backtrack;\n\t\t\t\t\t\t\t\tmeshInfo.quad -= backtrack;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tconst backtrackStart = wordStartIndex;\n\t\t\t\t\t\t\t\tconst backtrackEnd = i;\n\t\t\t\t\t\t\t\tfor (let j = backtrackStart; j < backtrackEnd; j++) {\n\t\t\t\t\t\t\t\t\tconst backChar = this._symbols[j];\n\t\t\t\t\t\t\t\t\tconst backCharData = json.chars[backChar];\n\t\t\t\t\t\t\t\t\tconst backMeshInfo = this._meshInfo[backCharData && backCharData.map || 0];\n\t\t\t\t\t\t\t\t\tbackMeshInfo.lines[lines - 1] -= 1;\n\t\t\t\t\t\t\t\t\tbackMeshInfo.quad -= 1;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ti -= backtrack + 1;\n\t\t\t\t\t\t\tbreakLine(this._symbols, wordStartIndex, wordStartX);\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tquad = meshInfo.quad;\n\t\t\t\tmeshInfo.lines[lines - 1] = quad;\n\t\t\t\tlet left = _x - x;\n\t\t\t\tlet right = left + quadsize;\n\t\t\t\tconst bottom = _y - y;\n\t\t\t\tconst top = bottom + quadsize;\n\t\t\t\tif (this._rtl) {\n\t\t\t\t\tconst shift = quadsize - x - this._spacing * advance - x;\n\t\t\t\t\tleft -= shift;\n\t\t\t\t\tright -= shift;\n\t\t\t\t}\n\t\t\t\tmeshInfo.positions[quad * 4 * 3 + 0] = left;\n\t\t\t\tmeshInfo.positions[quad * 4 * 3 + 1] = bottom;\n\t\t\t\tmeshInfo.positions[quad * 4 * 3 + 2] = _z;\n\t\t\t\tmeshInfo.positions[quad * 4 * 3 + 3] = right;\n\t\t\t\tmeshInfo.positions[quad * 4 * 3 + 4] = bottom;\n\t\t\t\tmeshInfo.positions[quad * 4 * 3 + 5] = _z;\n\t\t\t\tmeshInfo.positions[quad * 4 * 3 + 6] = right;\n\t\t\t\tmeshInfo.positions[quad * 4 * 3 + 7] = top;\n\t\t\t\tmeshInfo.positions[quad * 4 * 3 + 8] = _z;\n\t\t\t\tmeshInfo.positions[quad * 4 * 3 + 9] = left;\n\t\t\t\tmeshInfo.positions[quad * 4 * 3 + 10] = top;\n\t\t\t\tmeshInfo.positions[quad * 4 * 3 + 11] = _z;\n\t\t\t\tthis.width = Math.max(this.width, candidateLineWidth);\n\t\t\t\tlet fontSize;\n\t\t\t\tif (this._shouldAutoFitWidth() && this.width > this._element.calculatedWidth) {\n\t\t\t\t\tfontSize = Math.floor(this._element.fontSize * this._element.calculatedWidth / (this.width || 0.0001));\n\t\t\t\t\tfontSize = math.clamp(fontSize, minFont, maxFont);\n\t\t\t\t\tif (fontSize !== this._element.fontSize) {\n\t\t\t\t\t\tthis._fontSize = fontSize;\n\t\t\t\t\t\tretryUpdateMeshes = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.height = Math.max(this.height, fontMaxY - (_y + fontMinY));\n\t\t\t\tif (this._shouldAutoFitHeight() && this.height > this._element.calculatedHeight) {\n\t\t\t\t\tfontSize = math.clamp(this._fontSize - 1, minFont, maxFont);\n\t\t\t\t\tif (fontSize !== this._element.fontSize) {\n\t\t\t\t\t\tthis._fontSize = fontSize;\n\t\t\t\t\t\tretryUpdateMeshes = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t_x += this._spacing * advance;\n\t\t\t\tif (!isWhitespace) {\n\t\t\t\t\t_xMinusTrailingWhitespace = _x;\n\t\t\t\t}\n\t\t\t\tif (this._isWordBoundary(char) || this._isValidNextChar(nextchar) && (this._isNextCJKBoundary(char, nextchar) || this._isNextCJKWholeWord(nextchar))) {\n\t\t\t\t\tnumWordsThisLine++;\n\t\t\t\t\twordStartX = _xMinusTrailingWhitespace;\n\t\t\t\t\twordStartIndex = i + 1;\n\t\t\t\t}\n\t\t\t\tnumCharsThisLine++;\n\t\t\t\tconst uv = this._getUv(char);\n\t\t\t\tmeshInfo.uvs[quad * 4 * 2 + 0] = uv[0];\n\t\t\t\tmeshInfo.uvs[quad * 4 * 2 + 1] = 1.0 - uv[1];\n\t\t\t\tmeshInfo.uvs[quad * 4 * 2 + 2] = uv[2];\n\t\t\t\tmeshInfo.uvs[quad * 4 * 2 + 3] = 1.0 - uv[1];\n\t\t\t\tmeshInfo.uvs[quad * 4 * 2 + 4] = uv[2];\n\t\t\t\tmeshInfo.uvs[quad * 4 * 2 + 5] = 1.0 - uv[3];\n\t\t\t\tmeshInfo.uvs[quad * 4 * 2 + 6] = uv[0];\n\t\t\t\tmeshInfo.uvs[quad * 4 * 2 + 7] = 1.0 - uv[3];\n\t\t\t\tif (this._symbolColors) {\n\t\t\t\t\tconst colorIdx = this._symbolColors[i] * 3;\n\t\t\t\t\tcolor_r = this._colorPalette[colorIdx];\n\t\t\t\t\tcolor_g = this._colorPalette[colorIdx + 1];\n\t\t\t\t\tcolor_b = this._colorPalette[colorIdx + 2];\n\t\t\t\t}\n\t\t\t\tmeshInfo.colors[quad * 4 * 4 + 0] = color_r;\n\t\t\t\tmeshInfo.colors[quad * 4 * 4 + 1] = color_g;\n\t\t\t\tmeshInfo.colors[quad * 4 * 4 + 2] = color_b;\n\t\t\t\tmeshInfo.colors[quad * 4 * 4 + 3] = 255;\n\t\t\t\tmeshInfo.colors[quad * 4 * 4 + 4] = color_r;\n\t\t\t\tmeshInfo.colors[quad * 4 * 4 + 5] = color_g;\n\t\t\t\tmeshInfo.colors[quad * 4 * 4 + 6] = color_b;\n\t\t\t\tmeshInfo.colors[quad * 4 * 4 + 7] = 255;\n\t\t\t\tmeshInfo.colors[quad * 4 * 4 + 8] = color_r;\n\t\t\t\tmeshInfo.colors[quad * 4 * 4 + 9] = color_g;\n\t\t\t\tmeshInfo.colors[quad * 4 * 4 + 10] = color_b;\n\t\t\t\tmeshInfo.colors[quad * 4 * 4 + 11] = 255;\n\t\t\t\tmeshInfo.colors[quad * 4 * 4 + 12] = color_r;\n\t\t\t\tmeshInfo.colors[quad * 4 * 4 + 13] = color_g;\n\t\t\t\tmeshInfo.colors[quad * 4 * 4 + 14] = color_b;\n\t\t\t\tmeshInfo.colors[quad * 4 * 4 + 15] = 255;\n\t\t\t\tif (this._symbolOutlineParams) {\n\t\t\t\t\tconst outlineIdx = this._symbolOutlineParams[i] * 5;\n\t\t\t\t\toutline_color_rg = this._outlinePalette[outlineIdx] + this._outlinePalette[outlineIdx + 1] * 256;\n\t\t\t\t\toutline_color_ba = this._outlinePalette[outlineIdx + 2] + this._outlinePalette[outlineIdx + 3] * 256;\n\t\t\t\t\toutline_thickness = this._outlinePalette[outlineIdx + 4];\n\t\t\t\t}\n\t\t\t\tmeshInfo.outlines[quad * 4 * 3 + 0] = outline_color_rg;\n\t\t\t\tmeshInfo.outlines[quad * 4 * 3 + 1] = outline_color_ba;\n\t\t\t\tmeshInfo.outlines[quad * 4 * 3 + 2] = outline_thickness;\n\t\t\t\tmeshInfo.outlines[quad * 4 * 3 + 3] = outline_color_rg;\n\t\t\t\tmeshInfo.outlines[quad * 4 * 3 + 4] = outline_color_ba;\n\t\t\t\tmeshInfo.outlines[quad * 4 * 3 + 5] = outline_thickness;\n\t\t\t\tmeshInfo.outlines[quad * 4 * 3 + 6] = outline_color_rg;\n\t\t\t\tmeshInfo.outlines[quad * 4 * 3 + 7] = outline_color_ba;\n\t\t\t\tmeshInfo.outlines[quad * 4 * 3 + 8] = outline_thickness;\n\t\t\t\tmeshInfo.outlines[quad * 4 * 3 + 9] = outline_color_rg;\n\t\t\t\tmeshInfo.outlines[quad * 4 * 3 + 10] = outline_color_ba;\n\t\t\t\tmeshInfo.outlines[quad * 4 * 3 + 11] = outline_thickness;\n\t\t\t\tif (this._symbolShadowParams) {\n\t\t\t\t\tconst shadowIdx = this._symbolShadowParams[i] * 6;\n\t\t\t\t\tshadow_color_rg = this._shadowPalette[shadowIdx] + this._shadowPalette[shadowIdx + 1] * 256;\n\t\t\t\t\tshadow_color_ba = this._shadowPalette[shadowIdx + 2] + this._shadowPalette[shadowIdx + 3] * 256;\n\t\t\t\t\tshadow_offset_xy = this._shadowPalette[shadowIdx + 4] + 127 + Math.round(ratio * this._shadowPalette[shadowIdx + 5] + 127) * 256;\n\t\t\t\t}\n\t\t\t\tmeshInfo.shadows[quad * 4 * 3 + 0] = shadow_color_rg;\n\t\t\t\tmeshInfo.shadows[quad * 4 * 3 + 1] = shadow_color_ba;\n\t\t\t\tmeshInfo.shadows[quad * 4 * 3 + 2] = shadow_offset_xy;\n\t\t\t\tmeshInfo.shadows[quad * 4 * 3 + 3] = shadow_color_rg;\n\t\t\t\tmeshInfo.shadows[quad * 4 * 3 + 4] = shadow_color_ba;\n\t\t\t\tmeshInfo.shadows[quad * 4 * 3 + 5] = shadow_offset_xy;\n\t\t\t\tmeshInfo.shadows[quad * 4 * 3 + 6] = shadow_color_rg;\n\t\t\t\tmeshInfo.shadows[quad * 4 * 3 + 7] = shadow_color_ba;\n\t\t\t\tmeshInfo.shadows[quad * 4 * 3 + 8] = shadow_offset_xy;\n\t\t\t\tmeshInfo.shadows[quad * 4 * 3 + 9] = shadow_color_rg;\n\t\t\t\tmeshInfo.shadows[quad * 4 * 3 + 10] = shadow_color_ba;\n\t\t\t\tmeshInfo.shadows[quad * 4 * 3 + 11] = shadow_offset_xy;\n\t\t\t\tmeshInfo.quad++;\n\t\t\t}\n\t\t\tif (retryUpdateMeshes) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (lineStartIndex < l) {\n\t\t\t\tbreakLine(this._symbols, l, _x);\n\t\t\t}\n\t\t}\n\t\tthis._noResize = true;\n\t\tthis.autoWidth = this._autoWidth;\n\t\tthis.autoHeight = this._autoHeight;\n\t\tthis._noResize = false;\n\t\tconst hp = this._element.pivot.x;\n\t\tconst vp = this._element.pivot.y;\n\t\tconst ha = this._alignment.x;\n\t\tconst va = this._alignment.y;\n\t\tfor (let i = 0; i < this._meshInfo.length; i++) {\n\t\t\tif (this._meshInfo[i].count === 0) continue;\n\t\t\tlet prevQuad = 0;\n\t\t\tfor (const line in this._meshInfo[i].lines) {\n\t\t\t\tconst index = this._meshInfo[i].lines[line];\n\t\t\t\tconst lw = this._lineWidths[parseInt(line, 10)];\n\t\t\t\tconst hoffset = -hp * this._element.calculatedWidth + ha * (this._element.calculatedWidth - lw) * (this._rtl ? -1 : 1);\n\t\t\t\tconst voffset = (1 - vp) * this._element.calculatedHeight - fontMaxY - (1 - va) * (this._element.calculatedHeight - this.height);\n\t\t\t\tfor (let _quad = prevQuad; _quad <= index; _quad++) {\n\t\t\t\t\tthis._meshInfo[i].positions[_quad * 4 * 3] += hoffset;\n\t\t\t\t\tthis._meshInfo[i].positions[_quad * 4 * 3 + 3] += hoffset;\n\t\t\t\t\tthis._meshInfo[i].positions[_quad * 4 * 3 + 6] += hoffset;\n\t\t\t\t\tthis._meshInfo[i].positions[_quad * 4 * 3 + 9] += hoffset;\n\t\t\t\t\tthis._meshInfo[i].positions[_quad * 4 * 3 + 1] += voffset;\n\t\t\t\t\tthis._meshInfo[i].positions[_quad * 4 * 3 + 4] += voffset;\n\t\t\t\t\tthis._meshInfo[i].positions[_quad * 4 * 3 + 7] += voffset;\n\t\t\t\t\tthis._meshInfo[i].positions[_quad * 4 * 3 + 10] += voffset;\n\t\t\t\t}\n\t\t\t\tif (this._rtl) {\n\t\t\t\t\tfor (let _quad2 = prevQuad; _quad2 <= index; _quad2++) {\n\t\t\t\t\t\tconst idx = _quad2 * 4 * 3;\n\t\t\t\t\t\tfor (let vert = 0; vert < 4; ++vert) {\n\t\t\t\t\t\t\tthis._meshInfo[i].positions[idx + vert * 3] = this._element.calculatedWidth - this._meshInfo[i].positions[idx + vert * 3] + hoffset * 2;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst tmp0 = this._meshInfo[i].positions[idx + 3];\n\t\t\t\t\t\tconst tmp1 = this._meshInfo[i].positions[idx + 6];\n\t\t\t\t\t\tthis._meshInfo[i].positions[idx + 3] = this._meshInfo[i].positions[idx + 0];\n\t\t\t\t\t\tthis._meshInfo[i].positions[idx + 6] = this._meshInfo[i].positions[idx + 9];\n\t\t\t\t\t\tthis._meshInfo[i].positions[idx + 0] = tmp0;\n\t\t\t\t\t\tthis._meshInfo[i].positions[idx + 9] = tmp1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tprevQuad = index + 1;\n\t\t\t}\n\t\t\tconst numVertices = this._meshInfo[i].count * 4;\n\t\t\tconst vertMax = this._meshInfo[i].quad * 4;\n\t\t\tconst it = new VertexIterator(this._meshInfo[i].meshInstance.mesh.vertexBuffer);\n\t\t\tfor (let v = 0; v < numVertices; v++) {\n\t\t\t\tif (v >= vertMax) {\n\t\t\t\t\tit.element[SEMANTIC_POSITION].set(0, 0, 0);\n\t\t\t\t\tit.element[SEMANTIC_TEXCOORD0].set(0, 0);\n\t\t\t\t\tit.element[SEMANTIC_COLOR].set(0, 0, 0, 0);\n\t\t\t\t\tit.element[SEMANTIC_ATTR8].set(0, 0, 0, 0);\n\t\t\t\t\tit.element[SEMANTIC_ATTR9].set(0, 0, 0, 0);\n\t\t\t\t} else {\n\t\t\t\t\tit.element[SEMANTIC_POSITION].set(this._meshInfo[i].positions[v * 3 + 0], this._meshInfo[i].positions[v * 3 + 1], this._meshInfo[i].positions[v * 3 + 2]);\n\t\t\t\t\tit.element[SEMANTIC_TEXCOORD0].set(this._meshInfo[i].uvs[v * 2 + 0], this._meshInfo[i].uvs[v * 2 + 1]);\n\t\t\t\t\tit.element[SEMANTIC_COLOR].set(this._meshInfo[i].colors[v * 4 + 0], this._meshInfo[i].colors[v * 4 + 1], this._meshInfo[i].colors[v * 4 + 2], this._meshInfo[i].colors[v * 4 + 3]);\n\t\t\t\t\tit.element[SEMANTIC_ATTR8].set(this._meshInfo[i].outlines[v * 3 + 0], this._meshInfo[i].outlines[v * 3 + 1], this._meshInfo[i].outlines[v * 3 + 2]);\n\t\t\t\t\tit.element[SEMANTIC_ATTR9].set(this._meshInfo[i].shadows[v * 3 + 0], this._meshInfo[i].shadows[v * 3 + 1], this._meshInfo[i].shadows[v * 3 + 2]);\n\t\t\t\t}\n\t\t\t\tit.next();\n\t\t\t}\n\t\t\tit.end();\n\t\t\tthis._meshInfo[i].meshInstance.mesh.aabb.compute(this._meshInfo[i].positions);\n\t\t\tthis._meshInfo[i].meshInstance._aabbVer = -1;\n\t\t}\n\t\tthis._aabbDirty = true;\n\t}\n\t_onFontRender() {\n\t\tthis.font = this._font;\n\t}\n\t_onFontLoad(asset) {\n\t\tif (this.font !== asset.resource) {\n\t\t\tthis.font = asset.resource;\n\t\t}\n\t}\n\t_onFontChange(asset, name, _new, _old) {\n\t\tif (name === 'data') {\n\t\t\tthis._font.data = _new;\n\t\t\tconst maps = this._font.data.info.maps.length;\n\t\t\tfor (let i = 0; i < maps; i++) {\n\t\t\t\tif (!this._meshInfo[i]) continue;\n\t\t\t\tconst mi = this._meshInfo[i].meshInstance;\n\t\t\t\tif (mi) {\n\t\t\t\t\tmi.setParameter('font_sdfIntensity', this._font.intensity);\n\t\t\t\t\tmi.setParameter('font_pxrange', this._getPxRange(this._font));\n\t\t\t\t\tmi.setParameter('font_textureWidth', this._font.data.info.maps[i].width);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t_onFontRemove(asset) {}\n\t_setTextureParams(mi, texture) {\n\t\tif (this._font) {\n\t\t\tif (this._font.type === FONT_MSDF) {\n\t\t\t\tmi.deleteParameter('texture_emissiveMap');\n\t\t\t\tmi.deleteParameter('texture_opacityMap');\n\t\t\t\tmi.setParameter('texture_msdfMap', texture);\n\t\t\t} else if (this._font.type === FONT_BITMAP) {\n\t\t\t\tmi.deleteParameter('texture_msdfMap');\n\t\t\t\tmi.setParameter('texture_emissiveMap', texture);\n\t\t\t\tmi.setParameter('texture_opacityMap', texture);\n\t\t\t}\n\t\t}\n\t}\n\t_getPxRange(font) {\n\t\tconst keys = Object.keys(this._font.data.chars);\n\t\tfor (let i = 0; i < keys.length; i++) {\n\t\t\tconst char = this._font.data.chars[keys[i]];\n\t\t\tif (char.range) {\n\t\t\t\treturn (char.scale || 1) * char.range;\n\t\t\t}\n\t\t}\n\t\treturn 2;\n\t}\n\t_getUv(char) {\n\t\tconst data = this._font.data;\n\t\tif (!data.chars[char]) {\n\t\t\tconst space = ' ';\n\t\t\tif (data.chars[space]) {\n\t\t\t\treturn this._getUv(space);\n\t\t\t}\n\t\t\treturn [0, 0, 0, 0];\n\t\t}\n\t\tconst map = data.chars[char].map;\n\t\tconst width = data.info.maps[map].width;\n\t\tconst height = data.info.maps[map].height;\n\t\tconst x = data.chars[char].x;\n\t\tconst y = data.chars[char].y;\n\t\tconst x1 = x;\n\t\tconst y1 = y;\n\t\tconst x2 = x + data.chars[char].width;\n\t\tconst y2 = y - data.chars[char].height;\n\t\tconst edge = 1 - data.chars[char].height / height;\n\t\treturn [x1 / width, edge - y1 / height, x2 / width, edge - y2 / height];\n\t}\n\tonEnable() {\n\t\tthis._fontAsset.autoLoad = true;\n\t\tif (this._model) {\n\t\t\tthis._element.addModelToLayers(this._model);\n\t\t}\n\t}\n\tonDisable() {\n\t\tthis._fontAsset.autoLoad = false;\n\t\tif (this._model) {\n\t\t\tthis._element.removeModelFromLayers(this._model);\n\t\t}\n\t}\n\t_setStencil(stencilParams) {\n\t\tif (this._model) {\n\t\t\tconst instances = this._model.meshInstances;\n\t\t\tfor (let i = 0; i < instances.length; i++) {\n\t\t\t\tinstances[i].stencilFront = stencilParams;\n\t\t\t\tinstances[i].stencilBack = stencilParams;\n\t\t\t}\n\t\t}\n\t}\n\t_shouldAutoFitWidth() {\n\t\treturn this._autoFitWidth && !this._autoWidth;\n\t}\n\t_shouldAutoFitHeight() {\n\t\treturn this._autoFitHeight && !this._autoHeight;\n\t}\n\t_shouldAutoFit() {\n\t\treturn this._autoFitWidth && !this._autoWidth || this._autoFitHeight && !this._autoHeight;\n\t}\n\t_calculateCharsPerTexture(symbolIndex) {\n\t\tconst charactersPerTexture = {};\n\t\tif (symbolIndex === undefined) {\n\t\t\tsymbolIndex = this._symbols.length;\n\t\t}\n\t\tfor (let i = 0, len = symbolIndex; i < len; i++) {\n\t\t\tconst char = this._symbols[i];\n\t\t\tlet info = this._font.data.chars[char];\n\t\t\tif (!info) {\n\t\t\t\tinfo = this._font.data.chars[' '];\n\t\t\t\tif (!info) {\n\t\t\t\t\tinfo = this._font.data.chars[Object.keys(this._font.data.chars)[0]];\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst map = info.map;\n\t\t\tif (!charactersPerTexture[map]) {\n\t\t\t\tcharactersPerTexture[map] = 1;\n\t\t\t} else {\n\t\t\t\tcharactersPerTexture[map]++;\n\t\t\t}\n\t\t}\n\t\treturn charactersPerTexture;\n\t}\n\t_updateRenderRange() {\n\t\tconst startChars = this._rangeStart === 0 ? 0 : this._calculateCharsPerTexture(this._rangeStart);\n\t\tconst endChars = this._rangeEnd === 0 ? 0 : this._calculateCharsPerTexture(this._rangeEnd);\n\t\tfor (let i = 0, len = this._meshInfo.length; i < len; i++) {\n\t\t\tconst start = startChars[i] || 0;\n\t\t\tconst end = endChars[i] || 0;\n\t\t\tconst instance = this._meshInfo[i].meshInstance;\n\t\t\tif (instance) {\n\t\t\t\tconst mesh = instance.mesh;\n\t\t\t\tif (mesh) {\n\t\t\t\t\tmesh.primitive[0].base = start * 3 * 2;\n\t\t\t\t\tmesh.primitive[0].count = (end - start) * 3 * 2;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tset text(value) {\n\t\tthis._i18nKey = null;\n\t\tconst str = value != null && value.toString() || '';\n\t\tthis._setText(str);\n\t}\n\tget text() {\n\t\treturn this._text;\n\t}\n\tset key(value) {\n\t\tconst str = value !== null ? value.toString() : null;\n\t\tif (this._i18nKey === str) {\n\t\t\treturn;\n\t\t}\n\t\tthis._i18nKey = str;\n\t\tif (str) {\n\t\t\tthis._fontAsset.disableLocalization = false;\n\t\t\tthis._resetLocalizedText();\n\t\t} else {\n\t\t\tthis._fontAsset.disableLocalization = true;\n\t\t}\n\t}\n\tget key() {\n\t\treturn this._i18nKey;\n\t}\n\tset color(value) {\n\t\tconst r = value.r;\n\t\tconst g = value.g;\n\t\tconst b = value.b;\n\t\tif (this._color.r === r && this._color.g === g && this._color.b === b) {\n\t\t\treturn;\n\t\t}\n\t\tthis._color.r = r;\n\t\tthis._color.g = g;\n\t\tthis._color.b = b;\n\t\tif (!this._model) {\n\t\t\treturn;\n\t\t}\n\t\tif (this._symbolColors) {\n\t\t\tif (this._font) {\n\t\t\t\tthis._updateText();\n\t\t\t}\n\t\t} else {\n\t\t\tthis._colorUniform[0] = this._color.r;\n\t\t\tthis._colorUniform[1] = this._color.g;\n\t\t\tthis._colorUniform[2] = this._color.b;\n\t\t\tfor (let i = 0, len = this._model.meshInstances.length; i < len; i++) {\n\t\t\t\tconst mi = this._model.meshInstances[i];\n\t\t\t\tmi.setParameter('material_emissive', this._colorUniform);\n\t\t\t}\n\t\t}\n\t\tif (this._element) {\n\t\t\tthis._element.fire('set:color', this._color);\n\t\t}\n\t}\n\tget color() {\n\t\treturn this._color;\n\t}\n\tset opacity(value) {\n\t\tif (this._color.a !== value) {\n\t\t\tthis._color.a = value;\n\t\t\tif (this._model) {\n\t\t\t\tfor (let i = 0, len = this._model.meshInstances.length; i < len; i++) {\n\t\t\t\t\tconst mi = this._model.meshInstances[i];\n\t\t\t\t\tmi.setParameter('material_opacity', value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (this._element) {\n\t\t\tthis._element.fire('set:opacity', value);\n\t\t}\n\t}\n\tget opacity() {\n\t\treturn this._color.a;\n\t}\n\tset lineHeight(value) {\n\t\tconst _prev = this._lineHeight;\n\t\tthis._lineHeight = value;\n\t\tthis._scaledLineHeight = value;\n\t\tif (_prev !== value && this._font) {\n\t\t\tthis._updateText();\n\t\t}\n\t}\n\tget lineHeight() {\n\t\treturn this._lineHeight;\n\t}\n\tset wrapLines(value) {\n\t\tconst _prev = this._wrapLines;\n\t\tthis._wrapLines = value;\n\t\tif (_prev !== value && this._font) {\n\t\t\tthis._updateText();\n\t\t}\n\t}\n\tget wrapLines() {\n\t\treturn this._wrapLines;\n\t}\n\tget lines() {\n\t\treturn this._lineContents;\n\t}\n\tset spacing(value) {\n\t\tconst _prev = this._spacing;\n\t\tthis._spacing = value;\n\t\tif (_prev !== value && this._font) {\n\t\t\tthis._updateText();\n\t\t}\n\t}\n\tget spacing() {\n\t\treturn this._spacing;\n\t}\n\tset fontSize(value) {\n\t\tconst _prev = this._fontSize;\n\t\tthis._fontSize = value;\n\t\tthis._originalFontSize = value;\n\t\tif (_prev !== value && this._font) {\n\t\t\tthis._updateText();\n\t\t}\n\t}\n\tget fontSize() {\n\t\treturn this._fontSize;\n\t}\n\tset fontAsset(value) {\n\t\tthis._fontAsset.defaultAsset = value;\n\t}\n\tget fontAsset() {\n\t\treturn this._fontAsset.localizedAsset;\n\t}\n\tset font(value) {\n\t\tlet previousFontType;\n\t\tif (this._font) {\n\t\t\tpreviousFontType = this._font.type;\n\t\t\tif (this._font.off) this._font.off('render', this._onFontRender, this);\n\t\t}\n\t\tthis._font = value;\n\t\tthis._fontMinY = 0;\n\t\tthis._fontMaxY = 0;\n\t\tif (!value) return;\n\t\tconst json = this._font.data;\n\t\tfor (const charId in json.chars) {\n\t\t\tconst data = json.chars[charId];\n\t\t\tif (data.bounds) {\n\t\t\t\tthis._fontMinY = Math.min(this._fontMinY, data.bounds[1]);\n\t\t\t\tthis._fontMaxY = Math.max(this._fontMaxY, data.bounds[3]);\n\t\t\t}\n\t\t}\n\t\tif (this._font.on) this._font.on('render', this._onFontRender, this);\n\t\tif (this._fontAsset.localizedAsset) {\n\t\t\tconst asset = this._system.app.assets.get(this._fontAsset.localizedAsset);\n\t\t\tif (asset.resource !== this._font) {\n\t\t\t\tthis._fontAsset.defaultAsset = null;\n\t\t\t}\n\t\t}\n\t\tif (value.type !== previousFontType) {\n\t\t\tconst screenSpace = this._element._isScreenSpace();\n\t\t\tthis._updateMaterial(screenSpace);\n\t\t}\n\t\tfor (let i = 0, len = this._font.textures.length; i < len; i++) {\n\t\t\tif (!this._meshInfo[i]) {\n\t\t\t\tthis._meshInfo[i] = new MeshInfo();\n\t\t\t} else {\n\t\t\t\tconst mi = this._meshInfo[i].meshInstance;\n\t\t\t\tif (mi) {\n\t\t\t\t\tmi.setParameter('font_sdfIntensity', this._font.intensity);\n\t\t\t\t\tmi.setParameter('font_pxrange', this._getPxRange(this._font));\n\t\t\t\t\tmi.setParameter('font_textureWidth', this._font.data.info.maps[i].width);\n\t\t\t\t\tthis._setTextureParams(mi, this._font.textures[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tlet removedModel = false;\n\t\tfor (let i = this._font.textures.length; i < this._meshInfo.length; i++) {\n\t\t\tif (this._meshInfo[i].meshInstance) {\n\t\t\t\tif (!removedModel) {\n\t\t\t\t\tthis._element.removeModelFromLayers(this._model);\n\t\t\t\t\tremovedModel = true;\n\t\t\t\t}\n\t\t\t\tthis._removeMeshInstance(this._meshInfo[i].meshInstance);\n\t\t\t}\n\t\t}\n\t\tif (this._meshInfo.length > this._font.textures.length) this._meshInfo.length = this._font.textures.length;\n\t\tthis._updateText();\n\t}\n\tget font() {\n\t\treturn this._font;\n\t}\n\tset alignment(value) {\n\t\tif (value instanceof Vec2) {\n\t\t\tthis._alignment.set(value.x, value.y);\n\t\t} else {\n\t\t\tthis._alignment.set(value[0], value[1]);\n\t\t}\n\t\tif (this._font) this._updateText();\n\t}\n\tget alignment() {\n\t\treturn this._alignment;\n\t}\n\tset autoWidth(value) {\n\t\tconst old = this._autoWidth;\n\t\tthis._autoWidth = value;\n\t\tif (value && Math.abs(this._element.anchor.x - this._element.anchor.z) < 0.0001) {\n\t\t\tthis._element.width = this.width;\n\t\t}\n\t\tif (old !== value) {\n\t\t\tconst newFontSize = this._shouldAutoFit() ? this._maxFontSize : this._originalFontSize;\n\t\t\tif (newFontSize !== this._fontSize) {\n\t\t\t\tthis._fontSize = newFontSize;\n\t\t\t\tif (this._font) {\n\t\t\t\t\tthis._updateText();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tget autoWidth() {\n\t\treturn this._autoWidth;\n\t}\n\tset autoHeight(value) {\n\t\tconst old = this._autoHeight;\n\t\tthis._autoHeight = value;\n\t\tif (value && Math.abs(this._element.anchor.y - this._element.anchor.w) < 0.0001) {\n\t\t\tthis._element.height = this.height;\n\t\t}\n\t\tif (old !== value) {\n\t\t\tconst newFontSize = this._shouldAutoFit() ? this._maxFontSize : this._originalFontSize;\n\t\t\tif (newFontSize !== this._fontSize) {\n\t\t\t\tthis._fontSize = newFontSize;\n\t\t\t\tif (this._font) {\n\t\t\t\t\tthis._updateText();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tget autoHeight() {\n\t\treturn this._autoHeight;\n\t}\n\tset rtlReorder(value) {\n\t\tif (this._rtlReorder !== value) {\n\t\t\tthis._rtlReorder = value;\n\t\t\tif (this._font) {\n\t\t\t\tthis._updateText();\n\t\t\t}\n\t\t}\n\t}\n\tget rtlReorder() {\n\t\treturn this._rtlReorder;\n\t}\n\tset unicodeConverter(value) {\n\t\tif (this._unicodeConverter !== value) {\n\t\t\tthis._unicodeConverter = value;\n\t\t\tthis._setText(this._text);\n\t\t}\n\t}\n\tget unicodeConverter() {\n\t\treturn this._unicodeConverter;\n\t}\n\tget aabb() {\n\t\tif (this._aabbDirty) {\n\t\t\tlet initialized = false;\n\t\t\tfor (let i = 0; i < this._meshInfo.length; i++) {\n\t\t\t\tif (!this._meshInfo[i].meshInstance) continue;\n\t\t\t\tif (!initialized) {\n\t\t\t\t\tthis._aabb.copy(this._meshInfo[i].meshInstance.aabb);\n\t\t\t\t\tinitialized = true;\n\t\t\t\t} else {\n\t\t\t\t\tthis._aabb.add(this._meshInfo[i].meshInstance.aabb);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._aabbDirty = false;\n\t\t}\n\t\treturn this._aabb;\n\t}\n\tset outlineColor(value) {\n\t\tconst r = value instanceof Color ? value.r : value[0];\n\t\tconst g = value instanceof Color ? value.g : value[1];\n\t\tconst b = value instanceof Color ? value.b : value[2];\n\t\tconst a = value instanceof Color ? value.a : value[3];\n\t\tif (this._outlineColor.r === r && this._outlineColor.g === g && this._outlineColor.b === b && this._outlineColor.a === a) {\n\t\t\treturn;\n\t\t}\n\t\tthis._outlineColor.r = r;\n\t\tthis._outlineColor.g = g;\n\t\tthis._outlineColor.b = b;\n\t\tthis._outlineColor.a = a;\n\t\tif (!this._model) {\n\t\t\treturn;\n\t\t}\n\t\tif (this._symbolOutlineParams) {\n\t\t\tif (this._font) {\n\t\t\t\tthis._updateText();\n\t\t\t}\n\t\t} else {\n\t\t\tthis._outlineColorUniform[0] = this._outlineColor.r;\n\t\t\tthis._outlineColorUniform[1] = this._outlineColor.g;\n\t\t\tthis._outlineColorUniform[2] = this._outlineColor.b;\n\t\t\tthis._outlineColorUniform[3] = this._outlineColor.a;\n\t\t\tfor (let i = 0, len = this._model.meshInstances.length; i < len; i++) {\n\t\t\t\tconst mi = this._model.meshInstances[i];\n\t\t\t\tmi.setParameter('outline_color', this._outlineColorUniform);\n\t\t\t}\n\t\t}\n\t\tif (this._element) {\n\t\t\tthis._element.fire('set:outline', this._color);\n\t\t}\n\t}\n\tget outlineColor() {\n\t\treturn this._outlineColor;\n\t}\n\tset outlineThickness(value) {\n\t\tconst _prev = this._outlineThickness;\n\t\tthis._outlineThickness = value;\n\t\tif (_prev !== value && this._font) {\n\t\t\tif (!this._model) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this._symbolOutlineParams) {\n\t\t\t\tif (this._font) {\n\t\t\t\t\tthis._updateText();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (let i = 0, len = this._model.meshInstances.length; i < len; i++) {\n\t\t\t\t\tconst mi = this._model.meshInstances[i];\n\t\t\t\t\tmi.setParameter('outline_thickness', this._outlineThicknessScale * this._outlineThickness);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tget outlineThickness() {\n\t\treturn this._outlineThickness;\n\t}\n\tset shadowColor(value) {\n\t\tconst r = value instanceof Color ? value.r : value[0];\n\t\tconst g = value instanceof Color ? value.g : value[1];\n\t\tconst b = value instanceof Color ? value.b : value[2];\n\t\tconst a = value instanceof Color ? value.a : value[3];\n\t\tif (this._shadowColor.r === r && this._shadowColor.g === g && this._shadowColor.b === b && this._shadowColor.a === a) {\n\t\t\treturn;\n\t\t}\n\t\tthis._shadowColor.r = r;\n\t\tthis._shadowColor.g = g;\n\t\tthis._shadowColor.b = b;\n\t\tthis._shadowColor.a = a;\n\t\tif (!this._model) {\n\t\t\treturn;\n\t\t}\n\t\tif (this._symbolShadowParams) {\n\t\t\tif (this._font) {\n\t\t\t\tthis._updateText();\n\t\t\t}\n\t\t} else {\n\t\t\tthis._shadowColorUniform[0] = this._shadowColor.r;\n\t\t\tthis._shadowColorUniform[1] = this._shadowColor.g;\n\t\t\tthis._shadowColorUniform[2] = this._shadowColor.b;\n\t\t\tthis._shadowColorUniform[3] = this._shadowColor.a;\n\t\t\tfor (let i = 0, len = this._model.meshInstances.length; i < len; i++) {\n\t\t\t\tconst mi = this._model.meshInstances[i];\n\t\t\t\tmi.setParameter('shadow_color', this._shadowColorUniform);\n\t\t\t}\n\t\t}\n\t}\n\tget shadowColor() {\n\t\treturn this._shadowColor;\n\t}\n\tset shadowOffset(value) {\n\t\tconst x = value instanceof Vec2 ? value.x : value[0],\n\t\t\ty = value instanceof Vec2 ? value.y : value[1];\n\t\tif (this._shadowOffset.x === x && this._shadowOffset.y === y) {\n\t\t\treturn;\n\t\t}\n\t\tthis._shadowOffset.set(x, y);\n\t\tif (this._font && this._model) {\n\t\t\tif (this._symbolShadowParams) {\n\t\t\t\tthis._updateText();\n\t\t\t} else {\n\t\t\t\tfor (let i = 0, len = this._model.meshInstances.length; i < len; i++) {\n\t\t\t\t\tconst ratio = -this._font.data.info.maps[i].width / this._font.data.info.maps[i].height;\n\t\t\t\t\tthis._shadowOffsetUniform[0] = this._shadowOffsetScale * this._shadowOffset.x;\n\t\t\t\t\tthis._shadowOffsetUniform[1] = ratio * this._shadowOffsetScale * this._shadowOffset.y;\n\t\t\t\t\tconst mi = this._model.meshInstances[i];\n\t\t\t\t\tmi.setParameter('shadow_offset', this._shadowOffsetUniform);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tget shadowOffset() {\n\t\treturn this._shadowOffset;\n\t}\n\tset minFontSize(value) {\n\t\tif (this._minFontSize === value) return;\n\t\tthis._minFontSize = value;\n\t\tif (this.font && this._shouldAutoFit()) {\n\t\t\tthis._updateText();\n\t\t}\n\t}\n\tget minFontSize() {\n\t\treturn this._minFontSize;\n\t}\n\tset maxFontSize(value) {\n\t\tif (this._maxFontSize === value) return;\n\t\tthis._maxFontSize = value;\n\t\tif (this.font && this._shouldAutoFit()) {\n\t\t\tthis._updateText();\n\t\t}\n\t}\n\tget maxFontSize() {\n\t\treturn this._maxFontSize;\n\t}\n\tset autoFitWidth(value) {\n\t\tif (this._autoFitWidth === value) return;\n\t\tthis._autoFitWidth = value;\n\t\tthis._fontSize = this._shouldAutoFit() ? this._maxFontSize : this._originalFontSize;\n\t\tif (this.font) {\n\t\t\tthis._updateText();\n\t\t}\n\t}\n\tget autoFitWidth() {\n\t\treturn this._autoFitWidth;\n\t}\n\tset autoFitHeight(value) {\n\t\tif (this._autoFitHeight === value) return;\n\t\tthis._autoFitHeight = value;\n\t\tthis._fontSize = this._shouldAutoFit() ? this._maxFontSize : this._originalFontSize;\n\t\tif (this.font) {\n\t\t\tthis._updateText();\n\t\t}\n\t}\n\tget autoFitHeight() {\n\t\treturn this._autoFitHeight;\n\t}\n\tset maxLines(value) {\n\t\tif (this._maxLines === value) return;\n\t\tif (value === null && this._maxLines === -1) return;\n\t\tthis._maxLines = value === null ? -1 : value;\n\t\tif (this.font && this._wrapLines) {\n\t\t\tthis._updateText();\n\t\t}\n\t}\n\tget maxLines() {\n\t\treturn this._maxLines;\n\t}\n\tset enableMarkup(value) {\n\t\tvalue = !!value;\n\t\tif (this._enableMarkup === value) return;\n\t\tthis._enableMarkup = value;\n\t\tif (this.font) {\n\t\t\tthis._updateText();\n\t\t}\n\t\tconst screenSpace = this._element._isScreenSpace();\n\t\tthis._updateMaterial(screenSpace);\n\t}\n\tget enableMarkup() {\n\t\treturn this._enableMarkup;\n\t}\n\tget symbols() {\n\t\treturn this._symbols;\n\t}\n\tget symbolColors() {\n\t\tif (this._symbolColors === null) {\n\t\t\treturn null;\n\t\t}\n\t\treturn this._symbolColors.map(function (c) {\n\t\t\treturn this._colorPalette.slice(c * 3, c * 3 + 3);\n\t\t}, this);\n\t}\n\tget symbolOutlineParams() {\n\t\tif (this._symbolOutlineParams === null) {\n\t\t\treturn null;\n\t\t}\n\t\treturn this._symbolOutlineParams.map(function (paramId) {\n\t\t\treturn this._outlinePalette.slice(paramId * 5, paramId * 5 + 5);\n\t\t}, this);\n\t}\n\tget symbolShadowParams() {\n\t\tif (this._symbolShadowParams === null) {\n\t\t\treturn null;\n\t\t}\n\t\treturn this._symbolShadowParams.map(function (paramId) {\n\t\t\treturn this._shadowPalette.slice(paramId * 6, paramId * 6 + 6);\n\t\t}, this);\n\t}\n\tget rtl() {\n\t\treturn this._rtl;\n\t}\n\tset rangeStart(rangeStart) {\n\t\trangeStart = Math.max(0, Math.min(rangeStart, this._symbols.length));\n\t\tif (rangeStart !== this._rangeStart) {\n\t\t\tthis._rangeStart = rangeStart;\n\t\t\tthis._updateRenderRange();\n\t\t}\n\t}\n\tget rangeStart() {\n\t\treturn this._rangeStart;\n\t}\n\tset rangeEnd(rangeEnd) {\n\t\trangeEnd = Math.max(this._rangeStart, Math.min(rangeEnd, this._symbols.length));\n\t\tif (rangeEnd !== this._rangeEnd) {\n\t\t\tthis._rangeEnd = rangeEnd;\n\t\t\tthis._updateRenderRange();\n\t\t}\n\t}\n\tget rangeEnd() {\n\t\treturn this._rangeEnd;\n\t}\n}\n\nexport { TextElement };\n","import '../../../core/tracing.js';\nimport { Mat4 } from '../../../core/math/mat4.js';\nimport { Vec2 } from '../../../core/math/vec2.js';\nimport { Vec3 } from '../../../core/math/vec3.js';\nimport { Vec4 } from '../../../core/math/vec4.js';\nimport { FUNC_EQUAL, STENCILOP_INCREMENT, FUNC_ALWAYS, STENCILOP_REPLACE } from '../../../platform/graphics/constants.js';\nimport { LAYERID_UI } from '../../../scene/constants.js';\nimport { BatchGroup } from '../../../scene/batching/batch-group.js';\nimport { StencilParameters } from '../../../platform/graphics/stencil-parameters.js';\nimport { Entity } from '../../entity.js';\nimport { Component } from '../component.js';\nimport { ELEMENTTYPE_GROUP, FITMODE_STRETCH, ELEMENTTYPE_IMAGE, ELEMENTTYPE_TEXT } from './constants.js';\nimport { ImageElement } from './image-element.js';\nimport { TextElement } from './text-element.js';\n\nconst position = new Vec3();\nconst invParentWtm = new Mat4();\nconst vecA = new Vec3();\nconst vecB = new Vec3();\nconst matA = new Mat4();\nconst matB = new Mat4();\nconst matC = new Mat4();\nconst matD = new Mat4();\nclass ElementComponent extends Component {\n\tconstructor(system, entity) {\n\t\tsuper(system, entity);\n\t\tthis._beingInitialized = false;\n\t\tthis._anchor = new Vec4();\n\t\tthis._localAnchor = new Vec4();\n\t\tthis._pivot = new Vec2();\n\t\tthis._width = this._calculatedWidth = 32;\n\t\tthis._height = this._calculatedHeight = 32;\n\t\tthis._margin = new Vec4(0, 0, -32, -32);\n\t\tthis._modelTransform = new Mat4();\n\t\tthis._screenToWorld = new Mat4();\n\t\tthis._anchorTransform = new Mat4();\n\t\tthis._anchorDirty = true;\n\t\tthis._parentWorldTransform = new Mat4();\n\t\tthis._screenTransform = new Mat4();\n\t\tthis._screenCorners = [new Vec3(), new Vec3(), new Vec3(), new Vec3()];\n\t\tthis._canvasCorners = [new Vec2(), new Vec2(), new Vec2(), new Vec2()];\n\t\tthis._worldCorners = [new Vec3(), new Vec3(), new Vec3(), new Vec3()];\n\t\tthis._cornersDirty = true;\n\t\tthis._canvasCornersDirty = true;\n\t\tthis._worldCornersDirty = true;\n\t\tthis.entity.on('insert', this._onInsert, this);\n\t\tthis._patch();\n\t\tthis.screen = null;\n\t\tthis._type = ELEMENTTYPE_GROUP;\n\t\tthis._image = null;\n\t\tthis._text = null;\n\t\tthis._group = null;\n\t\tthis._drawOrder = 0;\n\t\tthis._fitMode = FITMODE_STRETCH;\n\t\tthis._useInput = false;\n\t\tthis._layers = [LAYERID_UI];\n\t\tthis._addedModels = [];\n\t\tthis._batchGroupId = -1;\n\t\tthis._offsetReadAt = 0;\n\t\tthis._maskOffset = 0.5;\n\t\tthis._maskedBy = null;\n\t}\n\tget _absLeft() {\n\t\treturn this._localAnchor.x + this._margin.x;\n\t}\n\tget _absRight() {\n\t\treturn this._localAnchor.z - this._margin.z;\n\t}\n\tget _absTop() {\n\t\treturn this._localAnchor.w - this._margin.w;\n\t}\n\tget _absBottom() {\n\t\treturn this._localAnchor.y + this._margin.y;\n\t}\n\tget _hasSplitAnchorsX() {\n\t\treturn Math.abs(this._anchor.x - this._anchor.z) > 0.001;\n\t}\n\tget _hasSplitAnchorsY() {\n\t\treturn Math.abs(this._anchor.y - this._anchor.w) > 0.001;\n\t}\n\tget aabb() {\n\t\tif (this._image) return this._image.aabb;\n\t\tif (this._text) return this._text.aabb;\n\t\treturn null;\n\t}\n\tset anchor(value) {\n\t\tif (value instanceof Vec4) {\n\t\t\tthis._anchor.copy(value);\n\t\t} else {\n\t\t\tthis._anchor.set(...value);\n\t\t}\n\t\tif (!this.entity._parent && !this.screen) {\n\t\t\tthis._calculateLocalAnchors();\n\t\t} else {\n\t\t\tthis._calculateSize(this._hasSplitAnchorsX, this._hasSplitAnchorsY);\n\t\t}\n\t\tthis._anchorDirty = true;\n\t\tif (!this.entity._dirtyLocal) this.entity._dirtifyLocal();\n\t\tthis.fire('set:anchor', this._anchor);\n\t}\n\tget anchor() {\n\t\treturn this._anchor;\n\t}\n\tset batchGroupId(value) {\n\t\tif (this._batchGroupId === value) return;\n\t\tif (this.entity.enabled && this._batchGroupId >= 0) {\n\t\t\tvar _this$system$app$batc;\n\t\t\t(_this$system$app$batc = this.system.app.batcher) == null || _this$system$app$batc.remove(BatchGroup.ELEMENT, this.batchGroupId, this.entity);\n\t\t}\n\t\tif (this.entity.enabled && value >= 0) {\n\t\t\tvar _this$system$app$batc2;\n\t\t\t(_this$system$app$batc2 = this.system.app.batcher) == null || _this$system$app$batc2.insert(BatchGroup.ELEMENT, value, this.entity);\n\t\t}\n\t\tif (value < 0 && this._batchGroupId >= 0 && this.enabled && this.entity.enabled) {\n\t\t\tif (this._image && this._image._renderable.model) {\n\t\t\t\tthis.addModelToLayers(this._image._renderable.model);\n\t\t\t} else if (this._text && this._text._model) {\n\t\t\t\tthis.addModelToLayers(this._text._model);\n\t\t\t}\n\t\t}\n\t\tthis._batchGroupId = value;\n\t}\n\tget batchGroupId() {\n\t\treturn this._batchGroupId;\n\t}\n\tset bottom(value) {\n\t\tthis._margin.y = value;\n\t\tconst p = this.entity.getLocalPosition();\n\t\tconst wt = this._absTop;\n\t\tconst wb = this._localAnchor.y + value;\n\t\tthis._setHeight(wt - wb);\n\t\tp.y = value + this._calculatedHeight * this._pivot.y;\n\t\tthis.entity.setLocalPosition(p);\n\t}\n\tget bottom() {\n\t\treturn this._margin.y;\n\t}\n\tset calculatedWidth(value) {\n\t\tthis._setCalculatedWidth(value, true);\n\t}\n\tget calculatedWidth() {\n\t\treturn this._calculatedWidth;\n\t}\n\tset calculatedHeight(value) {\n\t\tthis._setCalculatedHeight(value, true);\n\t}\n\tget calculatedHeight() {\n\t\treturn this._calculatedHeight;\n\t}\n\tget canvasCorners() {\n\t\tif (!this._canvasCornersDirty || !this.screen || !this.screen.screen.screenSpace) return this._canvasCorners;\n\t\tconst device = this.system.app.graphicsDevice;\n\t\tconst screenCorners = this.screenCorners;\n\t\tconst sx = device.canvas.clientWidth / device.width;\n\t\tconst sy = device.canvas.clientHeight / device.height;\n\t\tfor (let i = 0; i < 4; i++) {\n\t\t\tthis._canvasCorners[i].set(screenCorners[i].x * sx, (device.height - screenCorners[i].y) * sy);\n\t\t}\n\t\tthis._canvasCornersDirty = false;\n\t\treturn this._canvasCorners;\n\t}\n\tset drawOrder(value) {\n\t\tlet priority = 0;\n\t\tif (this.screen) {\n\t\t\tpriority = this.screen.screen.priority;\n\t\t}\n\t\tif (value > 0xFFFFFF) {\n\t\t\tvalue = 0xFFFFFF;\n\t\t}\n\t\tthis._drawOrder = (priority << 24) + value;\n\t\tthis.fire('set:draworder', this._drawOrder);\n\t}\n\tget drawOrder() {\n\t\treturn this._drawOrder;\n\t}\n\tset height(value) {\n\t\tthis._height = value;\n\t\tif (!this._hasSplitAnchorsY) {\n\t\t\tthis._setCalculatedHeight(value, true);\n\t\t}\n\t\tthis.fire('set:height', this._height);\n\t}\n\tget height() {\n\t\treturn this._height;\n\t}\n\tset layers(value) {\n\t\tif (this._addedModels.length) {\n\t\t\tfor (let i = 0; i < this._layers.length; i++) {\n\t\t\t\tconst layer = this.system.app.scene.layers.getLayerById(this._layers[i]);\n\t\t\t\tif (layer) {\n\t\t\t\t\tfor (let j = 0; j < this._addedModels.length; j++) {\n\t\t\t\t\t\tlayer.removeMeshInstances(this._addedModels[j].meshInstances);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis._layers = value;\n\t\tif (!this.enabled || !this.entity.enabled || !this._addedModels.length) return;\n\t\tfor (let i = 0; i < this._layers.length; i++) {\n\t\t\tconst layer = this.system.app.scene.layers.getLayerById(this._layers[i]);\n\t\t\tif (layer) {\n\t\t\t\tfor (let j = 0; j < this._addedModels.length; j++) {\n\t\t\t\t\tlayer.addMeshInstances(this._addedModels[j].meshInstances);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tget layers() {\n\t\treturn this._layers;\n\t}\n\tset left(value) {\n\t\tthis._margin.x = value;\n\t\tconst p = this.entity.getLocalPosition();\n\t\tconst wr = this._absRight;\n\t\tconst wl = this._localAnchor.x + value;\n\t\tthis._setWidth(wr - wl);\n\t\tp.x = value + this._calculatedWidth * this._pivot.x;\n\t\tthis.entity.setLocalPosition(p);\n\t}\n\tget left() {\n\t\treturn this._margin.x;\n\t}\n\tset margin(value) {\n\t\tthis._margin.copy(value);\n\t\tthis._calculateSize(true, true);\n\t\tthis.fire('set:margin', this._margin);\n\t}\n\tget margin() {\n\t\treturn this._margin;\n\t}\n\tget maskedBy() {\n\t\treturn this._maskedBy;\n\t}\n\tset pivot(value) {\n\t\tconst {\n\t\t\tpivot,\n\t\t\tmargin\n\t\t} = this;\n\t\tconst prevX = pivot.x;\n\t\tconst prevY = pivot.y;\n\t\tif (value instanceof Vec2) {\n\t\t\tpivot.copy(value);\n\t\t} else {\n\t\t\tpivot.set(...value);\n\t\t}\n\t\tconst mx = margin.x + margin.z;\n\t\tconst dx = pivot.x - prevX;\n\t\tmargin.x += mx * dx;\n\t\tmargin.z -= mx * dx;\n\t\tconst my = margin.y + margin.w;\n\t\tconst dy = pivot.y - prevY;\n\t\tmargin.y += my * dy;\n\t\tmargin.w -= my * dy;\n\t\tthis._anchorDirty = true;\n\t\tthis._cornersDirty = true;\n\t\tthis._worldCornersDirty = true;\n\t\tthis._calculateSize(false, false);\n\t\tthis._flagChildrenAsDirty();\n\t\tthis.fire('set:pivot', pivot);\n\t}\n\tget pivot() {\n\t\treturn this._pivot;\n\t}\n\tset right(value) {\n\t\tthis._margin.z = value;\n\t\tconst p = this.entity.getLocalPosition();\n\t\tconst wl = this._absLeft;\n\t\tconst wr = this._localAnchor.z - value;\n\t\tthis._setWidth(wr - wl);\n\t\tp.x = this._localAnchor.z - this._localAnchor.x - value - this._calculatedWidth * (1 - this._pivot.x);\n\t\tthis.entity.setLocalPosition(p);\n\t}\n\tget right() {\n\t\treturn this._margin.z;\n\t}\n\tget screenCorners() {\n\t\tif (!this._cornersDirty || !this.screen) return this._screenCorners;\n\t\tconst parentBottomLeft = this.entity.parent && this.entity.parent.element && this.entity.parent.element.screenCorners[0];\n\t\tthis._screenCorners[0].set(this._absLeft, this._absBottom, 0);\n\t\tthis._screenCorners[1].set(this._absRight, this._absBottom, 0);\n\t\tthis._screenCorners[2].set(this._absRight, this._absTop, 0);\n\t\tthis._screenCorners[3].set(this._absLeft, this._absTop, 0);\n\t\tconst screenSpace = this.screen.screen.screenSpace;\n\t\tfor (let i = 0; i < 4; i++) {\n\t\t\tthis._screenTransform.transformPoint(this._screenCorners[i], this._screenCorners[i]);\n\t\t\tif (screenSpace) this._screenCorners[i].mulScalar(this.screen.screen.scale);\n\t\t\tif (parentBottomLeft) {\n\t\t\t\tthis._screenCorners[i].add(parentBottomLeft);\n\t\t\t}\n\t\t}\n\t\tthis._cornersDirty = false;\n\t\tthis._canvasCornersDirty = true;\n\t\tthis._worldCornersDirty = true;\n\t\treturn this._screenCorners;\n\t}\n\tget textWidth() {\n\t\treturn this._text ? this._text.width : 0;\n\t}\n\tget textHeight() {\n\t\treturn this._text ? this._text.height : 0;\n\t}\n\tset top(value) {\n\t\tthis._margin.w = value;\n\t\tconst p = this.entity.getLocalPosition();\n\t\tconst wb = this._absBottom;\n\t\tconst wt = this._localAnchor.w - value;\n\t\tthis._setHeight(wt - wb);\n\t\tp.y = this._localAnchor.w - this._localAnchor.y - value - this._calculatedHeight * (1 - this._pivot.y);\n\t\tthis.entity.setLocalPosition(p);\n\t}\n\tget top() {\n\t\treturn this._margin.w;\n\t}\n\tset type(value) {\n\t\tif (value !== this._type) {\n\t\t\tthis._type = value;\n\t\t\tif (this._image) {\n\t\t\t\tthis._image.destroy();\n\t\t\t\tthis._image = null;\n\t\t\t}\n\t\t\tif (this._text) {\n\t\t\t\tthis._text.destroy();\n\t\t\t\tthis._text = null;\n\t\t\t}\n\t\t\tif (value === ELEMENTTYPE_IMAGE) {\n\t\t\t\tthis._image = new ImageElement(this);\n\t\t\t} else if (value === ELEMENTTYPE_TEXT) {\n\t\t\t\tthis._text = new TextElement(this);\n\t\t\t}\n\t\t}\n\t}\n\tget type() {\n\t\treturn this._type;\n\t}\n\tset useInput(value) {\n\t\tif (this._useInput === value) return;\n\t\tthis._useInput = value;\n\t\tif (this.system.app.elementInput) {\n\t\t\tif (value) {\n\t\t\t\tif (this.enabled && this.entity.enabled) {\n\t\t\t\t\tthis.system.app.elementInput.addElement(this);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.system.app.elementInput.removeElement(this);\n\t\t\t}\n\t\t} else {\n\t\t\tif (this._useInput === true) ;\n\t\t}\n\t\tthis.fire('set:useInput', value);\n\t}\n\tget useInput() {\n\t\treturn this._useInput;\n\t}\n\tset fitMode(value) {\n\t\tthis._fitMode = value;\n\t\tthis._calculateSize(true, true);\n\t\tif (this._image) {\n\t\t\tthis._image.refreshMesh();\n\t\t}\n\t}\n\tget fitMode() {\n\t\treturn this._fitMode;\n\t}\n\tset width(value) {\n\t\tthis._width = value;\n\t\tif (!this._hasSplitAnchorsX) {\n\t\t\tthis._setCalculatedWidth(value, true);\n\t\t}\n\t\tthis.fire('set:width', this._width);\n\t}\n\tget width() {\n\t\treturn this._width;\n\t}\n\tget worldCorners() {\n\t\tif (!this._worldCornersDirty) {\n\t\t\treturn this._worldCorners;\n\t\t}\n\t\tif (this.screen) {\n\t\t\tconst screenCorners = this.screenCorners;\n\t\t\tif (!this.screen.screen.screenSpace) {\n\t\t\t\tmatA.copy(this.screen.screen._screenMatrix);\n\t\t\t\tmatA.data[13] = -matA.data[13];\n\t\t\t\tmatA.mul2(this.screen.getWorldTransform(), matA);\n\t\t\t\tfor (let i = 0; i < 4; i++) {\n\t\t\t\t\tmatA.transformPoint(screenCorners[i], this._worldCorners[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tconst localPos = this.entity.getLocalPosition();\n\t\t\tmatA.setTranslate(-localPos.x, -localPos.y, -localPos.z);\n\t\t\tmatB.setTRS(Vec3.ZERO, this.entity.getLocalRotation(), this.entity.getLocalScale());\n\t\t\tmatC.setTranslate(localPos.x, localPos.y, localPos.z);\n\t\t\tconst entity = this.entity.parent ? this.entity.parent : this.entity;\n\t\t\tmatD.copy(entity.getWorldTransform());\n\t\t\tmatD.mul(matC).mul(matB).mul(matA);\n\t\t\tvecA.set(localPos.x - this.pivot.x * this.calculatedWidth, localPos.y - this.pivot.y * this.calculatedHeight, localPos.z);\n\t\t\tmatD.transformPoint(vecA, this._worldCorners[0]);\n\t\t\tvecA.set(localPos.x + (1 - this.pivot.x) * this.calculatedWidth, localPos.y - this.pivot.y * this.calculatedHeight, localPos.z);\n\t\t\tmatD.transformPoint(vecA, this._worldCorners[1]);\n\t\t\tvecA.set(localPos.x + (1 - this.pivot.x) * this.calculatedWidth, localPos.y + (1 - this.pivot.y) * this.calculatedHeight, localPos.z);\n\t\t\tmatD.transformPoint(vecA, this._worldCorners[2]);\n\t\t\tvecA.set(localPos.x - this.pivot.x * this.calculatedWidth, localPos.y + (1 - this.pivot.y) * this.calculatedHeight, localPos.z);\n\t\t\tmatD.transformPoint(vecA, this._worldCorners[3]);\n\t\t}\n\t\tthis._worldCornersDirty = false;\n\t\treturn this._worldCorners;\n\t}\n\t_patch() {\n\t\tthis.entity._sync = this._sync;\n\t\tthis.entity.setPosition = this._setPosition;\n\t\tthis.entity.setLocalPosition = this._setLocalPosition;\n\t}\n\t_unpatch() {\n\t\tthis.entity._sync = Entity.prototype._sync;\n\t\tthis.entity.setPosition = Entity.prototype.setPosition;\n\t\tthis.entity.setLocalPosition = Entity.prototype.setLocalPosition;\n\t}\n\t_setPosition(x, y, z) {\n\t\tif (!this.element.screen) {\n\t\t\tEntity.prototype.setPosition.call(this, x, y, z);\n\t\t\treturn;\n\t\t}\n\t\tif (x instanceof Vec3) {\n\t\t\tposition.copy(x);\n\t\t} else {\n\t\t\tposition.set(x, y, z);\n\t\t}\n\t\tthis.getWorldTransform();\n\t\tinvParentWtm.copy(this.element._screenToWorld).invert();\n\t\tinvParentWtm.transformPoint(position, this.localPosition);\n\t\tif (!this._dirtyLocal) this._dirtifyLocal();\n\t}\n\t_setLocalPosition(x, y, z) {\n\t\tif (x instanceof Vec3) {\n\t\t\tthis.localPosition.copy(x);\n\t\t} else {\n\t\t\tthis.localPosition.set(x, y, z);\n\t\t}\n\t\tconst element = this.element;\n\t\tconst p = this.localPosition;\n\t\tconst pvt = element._pivot;\n\t\telement._margin.x = p.x - element._calculatedWidth * pvt.x;\n\t\telement._margin.z = element._localAnchor.z - element._localAnchor.x - element._calculatedWidth - element._margin.x;\n\t\telement._margin.y = p.y - element._calculatedHeight * pvt.y;\n\t\telement._margin.w = element._localAnchor.w - element._localAnchor.y - element._calculatedHeight - element._margin.y;\n\t\tif (!this._dirtyLocal) this._dirtifyLocal();\n\t}\n\t_sync() {\n\t\tconst element = this.element;\n\t\tconst screen = element.screen;\n\t\tif (screen) {\n\t\t\tif (element._anchorDirty) {\n\t\t\t\tlet resx = 0;\n\t\t\t\tlet resy = 0;\n\t\t\t\tlet px = 0;\n\t\t\t\tlet py = 1;\n\t\t\t\tif (this._parent && this._parent.element) {\n\t\t\t\t\tresx = this._parent.element.calculatedWidth;\n\t\t\t\t\tresy = this._parent.element.calculatedHeight;\n\t\t\t\t\tpx = this._parent.element.pivot.x;\n\t\t\t\t\tpy = this._parent.element.pivot.y;\n\t\t\t\t} else {\n\t\t\t\t\tconst resolution = screen.screen.resolution;\n\t\t\t\t\tresx = resolution.x / screen.screen.scale;\n\t\t\t\t\tresy = resolution.y / screen.screen.scale;\n\t\t\t\t}\n\t\t\t\telement._anchorTransform.setTranslate(resx * (element.anchor.x - px), -(resy * (py - element.anchor.y)), 0);\n\t\t\t\telement._anchorDirty = false;\n\t\t\t\telement._calculateLocalAnchors();\n\t\t\t}\n\t\t\tif (element._sizeDirty) {\n\t\t\t\telement._calculateSize(false, false);\n\t\t\t}\n\t\t}\n\t\tif (this._dirtyLocal) {\n\t\t\tthis.localTransform.setTRS(this.localPosition, this.localRotation, this.localScale);\n\t\t\tconst p = this.localPosition;\n\t\t\tconst pvt = element._pivot;\n\t\t\telement._margin.x = p.x - element._calculatedWidth * pvt.x;\n\t\t\telement._margin.z = element._localAnchor.z - element._localAnchor.x - element._calculatedWidth - element._margin.x;\n\t\t\telement._margin.y = p.y - element._calculatedHeight * pvt.y;\n\t\t\telement._margin.w = element._localAnchor.w - element._localAnchor.y - element._calculatedHeight - element._margin.y;\n\t\t\tthis._dirtyLocal = false;\n\t\t}\n\t\tif (!screen) {\n\t\t\tif (this._dirtyWorld) {\n\t\t\t\telement._cornersDirty = true;\n\t\t\t\telement._canvasCornersDirty = true;\n\t\t\t\telement._worldCornersDirty = true;\n\t\t\t}\n\t\t\tEntity.prototype._sync.call(this);\n\t\t\treturn;\n\t\t}\n\t\tif (this._dirtyWorld) {\n\t\t\tif (this._parent === null) {\n\t\t\t\tthis.worldTransform.copy(this.localTransform);\n\t\t\t} else {\n\t\t\t\tif (this._parent.element) {\n\t\t\t\t\telement._screenToWorld.mul2(this._parent.element._modelTransform, element._anchorTransform);\n\t\t\t\t} else {\n\t\t\t\t\telement._screenToWorld.copy(element._anchorTransform);\n\t\t\t\t}\n\t\t\t\telement._modelTransform.mul2(element._screenToWorld, this.localTransform);\n\t\t\t\tif (screen) {\n\t\t\t\t\telement._screenToWorld.mul2(screen.screen._screenMatrix, element._screenToWorld);\n\t\t\t\t\tif (!screen.screen.screenSpace) {\n\t\t\t\t\t\telement._screenToWorld.mul2(screen.worldTransform, element._screenToWorld);\n\t\t\t\t\t}\n\t\t\t\t\tthis.worldTransform.mul2(element._screenToWorld, this.localTransform);\n\t\t\t\t\tconst parentWorldTransform = element._parentWorldTransform;\n\t\t\t\t\tparentWorldTransform.setIdentity();\n\t\t\t\t\tconst parent = this._parent;\n\t\t\t\t\tif (parent && parent.element && parent !== screen) {\n\t\t\t\t\t\tmatA.setTRS(Vec3.ZERO, parent.getLocalRotation(), parent.getLocalScale());\n\t\t\t\t\t\tparentWorldTransform.mul2(parent.element._parentWorldTransform, matA);\n\t\t\t\t\t}\n\t\t\t\t\tconst depthOffset = vecA;\n\t\t\t\t\tdepthOffset.set(0, 0, this.localPosition.z);\n\t\t\t\t\tconst pivotOffset = vecB;\n\t\t\t\t\tpivotOffset.set(element._absLeft + element._pivot.x * element.calculatedWidth, element._absBottom + element._pivot.y * element.calculatedHeight, 0);\n\t\t\t\t\tmatA.setTranslate(-pivotOffset.x, -pivotOffset.y, -pivotOffset.z);\n\t\t\t\t\tmatB.setTRS(depthOffset, this.getLocalRotation(), this.getLocalScale());\n\t\t\t\t\tmatC.setTranslate(pivotOffset.x, pivotOffset.y, pivotOffset.z);\n\t\t\t\t\telement._screenTransform.mul2(element._parentWorldTransform, matC).mul(matB).mul(matA);\n\t\t\t\t\telement._cornersDirty = true;\n\t\t\t\t\telement._canvasCornersDirty = true;\n\t\t\t\t\telement._worldCornersDirty = true;\n\t\t\t\t} else {\n\t\t\t\t\tthis.worldTransform.copy(element._modelTransform);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._dirtyWorld = false;\n\t\t}\n\t}\n\t_onInsert(parent) {\n\t\tconst result = this._parseUpToScreen();\n\t\tthis.entity._dirtifyWorld();\n\t\tthis._updateScreen(result.screen);\n\t\tthis._dirtifyMask();\n\t}\n\t_dirtifyMask() {\n\t\tlet current = this.entity;\n\t\twhile (current) {\n\t\t\tconst next = current.parent;\n\t\t\tif ((next === null || next.screen) && current.element) {\n\t\t\t\tif (!this.system._prerender || !this.system._prerender.length) {\n\t\t\t\t\tthis.system._prerender = [];\n\t\t\t\t\tthis.system.app.once('prerender', this._onPrerender, this);\n\t\t\t\t}\n\t\t\t\tconst i = this.system._prerender.indexOf(this.entity);\n\t\t\t\tif (i >= 0) {\n\t\t\t\t\tthis.system._prerender.splice(i, 1);\n\t\t\t\t}\n\t\t\t\tconst j = this.system._prerender.indexOf(current);\n\t\t\t\tif (j < 0) {\n\t\t\t\t\tthis.system._prerender.push(current);\n\t\t\t\t}\n\t\t\t}\n\t\t\tcurrent = next;\n\t\t}\n\t}\n\t_onPrerender() {\n\t\tfor (let i = 0; i < this.system._prerender.length; i++) {\n\t\t\tconst mask = this.system._prerender[i];\n\t\t\tif (mask.element) {\n\t\t\t\tconst depth = 1;\n\t\t\t\tmask.element.syncMask(depth);\n\t\t\t}\n\t\t}\n\t\tthis.system._prerender.length = 0;\n\t}\n\t_bindScreen(screen) {\n\t\tscreen._bindElement(this);\n\t}\n\t_unbindScreen(screen) {\n\t\tscreen._unbindElement(this);\n\t}\n\t_updateScreen(screen) {\n\t\tif (this.screen && this.screen !== screen) {\n\t\t\tthis._unbindScreen(this.screen.screen);\n\t\t}\n\t\tconst previousScreen = this.screen;\n\t\tthis.screen = screen;\n\t\tif (this.screen) {\n\t\t\tthis._bindScreen(this.screen.screen);\n\t\t}\n\t\tthis._calculateSize(this._hasSplitAnchorsX, this._hasSplitAnchorsY);\n\t\tthis.fire('set:screen', this.screen, previousScreen);\n\t\tthis._anchorDirty = true;\n\t\tconst children = this.entity.children;\n\t\tfor (let i = 0, l = children.length; i < l; i++) {\n\t\t\tif (children[i].element) children[i].element._updateScreen(screen);\n\t\t}\n\t\tif (this.screen) this.screen.screen.syncDrawOrder();\n\t}\n\tsyncMask(depth) {\n\t\tconst result = this._parseUpToScreen();\n\t\tthis._updateMask(result.mask, depth);\n\t}\n\t_setMaskedBy(mask) {\n\t\tconst renderableElement = this._image || this._text;\n\t\tif (mask) {\n\t\t\tconst ref = mask.element._image._maskRef;\n\t\t\trenderableElement == null || renderableElement._setStencil(new StencilParameters({\n\t\t\t\tref: ref,\n\t\t\t\tfunc: FUNC_EQUAL\n\t\t\t}));\n\t\t\tthis._maskedBy = mask;\n\t\t} else {\n\t\t\trenderableElement == null || renderableElement._setStencil(null);\n\t\t\tthis._maskedBy = null;\n\t\t}\n\t}\n\t_updateMask(currentMask, depth) {\n\t\tif (currentMask) {\n\t\t\tthis._setMaskedBy(currentMask);\n\t\t\tif (this.mask) {\n\t\t\t\tconst ref = currentMask.element._image._maskRef;\n\t\t\t\tconst sp = new StencilParameters({\n\t\t\t\t\tref: ref,\n\t\t\t\t\tfunc: FUNC_EQUAL,\n\t\t\t\t\tzpass: STENCILOP_INCREMENT\n\t\t\t\t});\n\t\t\t\tthis._image._setStencil(sp);\n\t\t\t\tthis._image._maskRef = depth;\n\t\t\t\tdepth++;\n\t\t\t\tcurrentMask = this.entity;\n\t\t\t}\n\t\t\tconst children = this.entity.children;\n\t\t\tfor (let i = 0, l = children.length; i < l; i++) {\n\t\t\t\tvar _children$i$element;\n\t\t\t\t(_children$i$element = children[i].element) == null || _children$i$element._updateMask(currentMask, depth);\n\t\t\t}\n\t\t\tif (this.mask) depth--;\n\t\t} else {\n\t\t\tthis._setMaskedBy(null);\n\t\t\tif (this.mask) {\n\t\t\t\tconst sp = new StencilParameters({\n\t\t\t\t\tref: depth,\n\t\t\t\t\tfunc: FUNC_ALWAYS,\n\t\t\t\t\tzpass: STENCILOP_REPLACE\n\t\t\t\t});\n\t\t\t\tthis._image._setStencil(sp);\n\t\t\t\tthis._image._maskRef = depth;\n\t\t\t\tdepth++;\n\t\t\t\tcurrentMask = this.entity;\n\t\t\t}\n\t\t\tconst children = this.entity.children;\n\t\t\tfor (let i = 0, l = children.length; i < l; i++) {\n\t\t\t\tvar _children$i$element2;\n\t\t\t\t(_children$i$element2 = children[i].element) == null || _children$i$element2._updateMask(currentMask, depth);\n\t\t\t}\n\t\t\tif (this.mask) depth--;\n\t\t}\n\t}\n\t_parseUpToScreen() {\n\t\tconst result = {\n\t\t\tscreen: null,\n\t\t\tmask: null\n\t\t};\n\t\tlet parent = this.entity._parent;\n\t\twhile (parent && !parent.screen) {\n\t\t\tif (parent.element && parent.element.mask) {\n\t\t\t\tif (!result.mask) result.mask = parent;\n\t\t\t}\n\t\t\tparent = parent.parent;\n\t\t}\n\t\tif (parent && parent.screen) result.screen = parent;\n\t\treturn result;\n\t}\n\t_onScreenResize(res) {\n\t\tthis._anchorDirty = true;\n\t\tthis._cornersDirty = true;\n\t\tthis._worldCornersDirty = true;\n\t\tthis._calculateSize(this._hasSplitAnchorsX, this._hasSplitAnchorsY);\n\t\tthis.fire('screen:set:resolution', res);\n\t}\n\t_onScreenSpaceChange() {\n\t\tthis.fire('screen:set:screenspace', this.screen.screen.screenSpace);\n\t}\n\t_onScreenRemove() {\n\t\tif (this.screen) {\n\t\t\tif (this.screen._destroying) {\n\t\t\t\tthis.screen = null;\n\t\t\t} else {\n\t\t\t\tthis._updateScreen(null);\n\t\t\t}\n\t\t}\n\t}\n\t_calculateLocalAnchors() {\n\t\tlet resx = 1000;\n\t\tlet resy = 1000;\n\t\tconst parent = this.entity._parent;\n\t\tif (parent && parent.element) {\n\t\t\tresx = parent.element.calculatedWidth;\n\t\t\tresy = parent.element.calculatedHeight;\n\t\t} else if (this.screen) {\n\t\t\tconst res = this.screen.screen.resolution;\n\t\t\tconst scale = this.screen.screen.scale;\n\t\t\tresx = res.x / scale;\n\t\t\tresy = res.y / scale;\n\t\t}\n\t\tthis._localAnchor.set(this._anchor.x * resx, this._anchor.y * resy, this._anchor.z * resx, this._anchor.w * resy);\n\t}\n\tgetOffsetPosition(x, y) {\n\t\tconst p = this.entity.getLocalPosition().clone();\n\t\tp.x += x;\n\t\tp.y += y;\n\t\tthis._screenToWorld.transformPoint(p, p);\n\t\treturn p;\n\t}\n\tonLayersChanged(oldComp, newComp) {\n\t\tthis.addModelToLayers(this._image ? this._image._renderable.model : this._text._model);\n\t\toldComp.off('add', this.onLayerAdded, this);\n\t\toldComp.off('remove', this.onLayerRemoved, this);\n\t\tnewComp.on('add', this.onLayerAdded, this);\n\t\tnewComp.on('remove', this.onLayerRemoved, this);\n\t}\n\tonLayerAdded(layer) {\n\t\tconst index = this.layers.indexOf(layer.id);\n\t\tif (index < 0) return;\n\t\tif (this._image) {\n\t\t\tlayer.addMeshInstances(this._image._renderable.model.meshInstances);\n\t\t} else if (this._text) {\n\t\t\tlayer.addMeshInstances(this._text._model.meshInstances);\n\t\t}\n\t}\n\tonLayerRemoved(layer) {\n\t\tconst index = this.layers.indexOf(layer.id);\n\t\tif (index < 0) return;\n\t\tif (this._image) {\n\t\t\tlayer.removeMeshInstances(this._image._renderable.model.meshInstances);\n\t\t} else if (this._text) {\n\t\t\tlayer.removeMeshInstances(this._text._model.meshInstances);\n\t\t}\n\t}\n\tonEnable() {\n\t\tif (this._image) this._image.onEnable();\n\t\tif (this._text) this._text.onEnable();\n\t\tif (this._group) this._group.onEnable();\n\t\tif (this.useInput && this.system.app.elementInput) {\n\t\t\tthis.system.app.elementInput.addElement(this);\n\t\t}\n\t\tthis.system.app.scene.on('set:layers', this.onLayersChanged, this);\n\t\tif (this.system.app.scene.layers) {\n\t\t\tthis.system.app.scene.layers.on('add', this.onLayerAdded, this);\n\t\t\tthis.system.app.scene.layers.on('remove', this.onLayerRemoved, this);\n\t\t}\n\t\tif (this._batchGroupId >= 0) {\n\t\t\tvar _this$system$app$batc3;\n\t\t\t(_this$system$app$batc3 = this.system.app.batcher) == null || _this$system$app$batc3.insert(BatchGroup.ELEMENT, this.batchGroupId, this.entity);\n\t\t}\n\t\tthis.fire('enableelement');\n\t}\n\tonDisable() {\n\t\tthis.system.app.scene.off('set:layers', this.onLayersChanged, this);\n\t\tif (this.system.app.scene.layers) {\n\t\t\tthis.system.app.scene.layers.off('add', this.onLayerAdded, this);\n\t\t\tthis.system.app.scene.layers.off('remove', this.onLayerRemoved, this);\n\t\t}\n\t\tif (this._image) this._image.onDisable();\n\t\tif (this._text) this._text.onDisable();\n\t\tif (this._group) this._group.onDisable();\n\t\tif (this.system.app.elementInput && this.useInput) {\n\t\t\tthis.system.app.elementInput.removeElement(this);\n\t\t}\n\t\tif (this._batchGroupId >= 0) {\n\t\t\tvar _this$system$app$batc4;\n\t\t\t(_this$system$app$batc4 = this.system.app.batcher) == null || _this$system$app$batc4.remove(BatchGroup.ELEMENT, this.batchGroupId, this.entity);\n\t\t}\n\t\tthis.fire('disableelement');\n\t}\n\tonRemove() {\n\t\tthis.entity.off('insert', this._onInsert, this);\n\t\tthis._unpatch();\n\t\tif (this._image) this._image.destroy();\n\t\tif (this._text) this._text.destroy();\n\t\tif (this.system.app.elementInput && this.useInput) {\n\t\t\tthis.system.app.elementInput.removeElement(this);\n\t\t}\n\t\tif (this.screen && this.screen.screen) {\n\t\t\tthis._unbindScreen(this.screen.screen);\n\t\t\tthis.screen.screen.syncDrawOrder();\n\t\t}\n\t\tthis.off();\n\t}\n\t_calculateSize(propagateCalculatedWidth, propagateCalculatedHeight) {\n\t\tif (!this.entity._parent && !this.screen) return;\n\t\tthis._calculateLocalAnchors();\n\t\tconst newWidth = this._absRight - this._absLeft;\n\t\tconst newHeight = this._absTop - this._absBottom;\n\t\tif (propagateCalculatedWidth) {\n\t\t\tthis._setWidth(newWidth);\n\t\t} else {\n\t\t\tthis._setCalculatedWidth(newWidth, false);\n\t\t}\n\t\tif (propagateCalculatedHeight) {\n\t\t\tthis._setHeight(newHeight);\n\t\t} else {\n\t\t\tthis._setCalculatedHeight(newHeight, false);\n\t\t}\n\t\tconst p = this.entity.getLocalPosition();\n\t\tp.x = this._margin.x + this._calculatedWidth * this._pivot.x;\n\t\tp.y = this._margin.y + this._calculatedHeight * this._pivot.y;\n\t\tthis.entity.setLocalPosition(p);\n\t\tthis._sizeDirty = false;\n\t}\n\t_setWidth(w) {\n\t\tthis._width = w;\n\t\tthis._setCalculatedWidth(w, false);\n\t\tthis.fire('set:width', this._width);\n\t}\n\t_setHeight(h) {\n\t\tthis._height = h;\n\t\tthis._setCalculatedHeight(h, false);\n\t\tthis.fire('set:height', this._height);\n\t}\n\t_setCalculatedWidth(value, updateMargins) {\n\t\tif (Math.abs(value - this._calculatedWidth) <= 1e-4) return;\n\t\tthis._calculatedWidth = value;\n\t\tthis.entity._dirtifyLocal();\n\t\tif (updateMargins) {\n\t\t\tconst p = this.entity.getLocalPosition();\n\t\t\tconst pvt = this._pivot;\n\t\t\tthis._margin.x = p.x - this._calculatedWidth * pvt.x;\n\t\t\tthis._margin.z = this._localAnchor.z - this._localAnchor.x - this._calculatedWidth - this._margin.x;\n\t\t}\n\t\tthis._flagChildrenAsDirty();\n\t\tthis.fire('set:calculatedWidth', this._calculatedWidth);\n\t\tthis.fire('resize', this._calculatedWidth, this._calculatedHeight);\n\t}\n\t_setCalculatedHeight(value, updateMargins) {\n\t\tif (Math.abs(value - this._calculatedHeight) <= 1e-4) return;\n\t\tthis._calculatedHeight = value;\n\t\tthis.entity._dirtifyLocal();\n\t\tif (updateMargins) {\n\t\t\tconst p = this.entity.getLocalPosition();\n\t\t\tconst pvt = this._pivot;\n\t\t\tthis._margin.y = p.y - this._calculatedHeight * pvt.y;\n\t\t\tthis._margin.w = this._localAnchor.w - this._localAnchor.y - this._calculatedHeight - this._margin.y;\n\t\t}\n\t\tthis._flagChildrenAsDirty();\n\t\tthis.fire('set:calculatedHeight', this._calculatedHeight);\n\t\tthis.fire('resize', this._calculatedWidth, this._calculatedHeight);\n\t}\n\t_flagChildrenAsDirty() {\n\t\tconst c = this.entity._children;\n\t\tfor (let i = 0, l = c.length; i < l; i++) {\n\t\t\tif (c[i].element) {\n\t\t\t\tc[i].element._anchorDirty = true;\n\t\t\t\tc[i].element._sizeDirty = true;\n\t\t\t}\n\t\t}\n\t}\n\taddModelToLayers(model) {\n\t\tthis._addedModels.push(model);\n\t\tfor (let i = 0; i < this.layers.length; i++) {\n\t\t\tconst layer = this.system.app.scene.layers.getLayerById(this.layers[i]);\n\t\t\tif (!layer) continue;\n\t\t\tlayer.addMeshInstances(model.meshInstances);\n\t\t}\n\t}\n\tremoveModelFromLayers(model) {\n\t\tconst idx = this._addedModels.indexOf(model);\n\t\tif (idx >= 0) {\n\t\t\tthis._addedModels.splice(idx, 1);\n\t\t}\n\t\tfor (let i = 0; i < this.layers.length; i++) {\n\t\t\tconst layer = this.system.app.scene.layers.getLayerById(this.layers[i]);\n\t\t\tif (!layer) continue;\n\t\t\tlayer.removeMeshInstances(model.meshInstances);\n\t\t}\n\t}\n\tgetMaskOffset() {\n\t\tconst frame = this.system.app.frame;\n\t\tif (this._offsetReadAt !== frame) {\n\t\t\tthis._maskOffset = 0.5;\n\t\t\tthis._offsetReadAt = frame;\n\t\t}\n\t\tconst mo = this._maskOffset;\n\t\tthis._maskOffset -= 0.001;\n\t\treturn mo;\n\t}\n\tisVisibleForCamera(camera) {\n\t\tlet clipL, clipR, clipT, clipB;\n\t\tif (this.maskedBy) {\n\t\t\tconst corners = this.maskedBy.element.screenCorners;\n\t\t\tclipL = Math.min(Math.min(corners[0].x, corners[1].x), Math.min(corners[2].x, corners[3].x));\n\t\t\tclipR = Math.max(Math.max(corners[0].x, corners[1].x), Math.max(corners[2].x, corners[3].x));\n\t\t\tclipB = Math.min(Math.min(corners[0].y, corners[1].y), Math.min(corners[2].y, corners[3].y));\n\t\t\tclipT = Math.max(Math.max(corners[0].y, corners[1].y), Math.max(corners[2].y, corners[3].y));\n\t\t} else {\n\t\t\tconst sw = this.system.app.graphicsDevice.width;\n\t\t\tconst sh = this.system.app.graphicsDevice.height;\n\t\t\tconst cameraWidth = camera._rect.z * sw;\n\t\t\tconst cameraHeight = camera._rect.w * sh;\n\t\t\tclipL = camera._rect.x * sw;\n\t\t\tclipR = clipL + cameraWidth;\n\t\t\tclipT = (1 - camera._rect.y) * sh;\n\t\t\tclipB = clipT - cameraHeight;\n\t\t}\n\t\tconst hitCorners = this.screenCorners;\n\t\tconst left = Math.min(Math.min(hitCorners[0].x, hitCorners[1].x), Math.min(hitCorners[2].x, hitCorners[3].x));\n\t\tconst right = Math.max(Math.max(hitCorners[0].x, hitCorners[1].x), Math.max(hitCorners[2].x, hitCorners[3].x));\n\t\tconst bottom = Math.min(Math.min(hitCorners[0].y, hitCorners[1].y), Math.min(hitCorners[2].y, hitCorners[3].y));\n\t\tconst top = Math.max(Math.max(hitCorners[0].y, hitCorners[1].y), Math.max(hitCorners[2].y, hitCorners[3].y));\n\t\tif (right < clipL || left > clipR || bottom > clipT || top < clipB) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\t_isScreenSpace() {\n\t\tif (this.screen && this.screen.screen) {\n\t\t\treturn this.screen.screen.screenSpace;\n\t\t}\n\t\treturn false;\n\t}\n\t_isScreenCulled() {\n\t\tif (this.screen && this.screen.screen) {\n\t\t\treturn this.screen.screen.cull;\n\t\t}\n\t\treturn false;\n\t}\n\t_dirtyBatch() {\n\t\tif (this.batchGroupId !== -1) {\n\t\t\tvar _this$system$app$batc5;\n\t\t\t(_this$system$app$batc5 = this.system.app.batcher) == null || _this$system$app$batc5.markGroupDirty(this.batchGroupId);\n\t\t}\n\t}\n}\nfunction _define(name) {\n\tObject.defineProperty(ElementComponent.prototype, name, {\n\t\tget: function () {\n\t\t\tif (this._text) {\n\t\t\t\treturn this._text[name];\n\t\t\t} else if (this._image) {\n\t\t\t\treturn this._image[name];\n\t\t\t}\n\t\t\treturn null;\n\t\t},\n\t\tset: function (value) {\n\t\t\tif (this._text) {\n\t\t\t\tif (this._text[name] !== value) {\n\t\t\t\t\tthis._dirtyBatch();\n\t\t\t\t}\n\t\t\t\tthis._text[name] = value;\n\t\t\t} else if (this._image) {\n\t\t\t\tif (this._image[name] !== value) {\n\t\t\t\t\tthis._dirtyBatch();\n\t\t\t\t}\n\t\t\t\tthis._image[name] = value;\n\t\t\t}\n\t\t}\n\t});\n}\n_define('fontSize');\n_define('minFontSize');\n_define('maxFontSize');\n_define('maxLines');\n_define('autoFitWidth');\n_define('autoFitHeight');\n_define('color');\n_define('font');\n_define('fontAsset');\n_define('spacing');\n_define('lineHeight');\n_define('wrapLines');\n_define('lines');\n_define('alignment');\n_define('autoWidth');\n_define('autoHeight');\n_define('rtlReorder');\n_define('unicodeConverter');\n_define('text');\n_define('key');\n_define('texture');\n_define('textureAsset');\n_define('material');\n_define('materialAsset');\n_define('sprite');\n_define('spriteAsset');\n_define('spriteFrame');\n_define('pixelsPerUnit');\n_define('opacity');\n_define('rect');\n_define('mask');\n_define('outlineColor');\n_define('outlineThickness');\n_define('shadowColor');\n_define('shadowOffset');\n_define('enableMarkup');\n_define('rangeStart');\n_define('rangeEnd');\n\nexport { ElementComponent };\n","class ElementComponentData {\n\tconstructor() {\n\t\tthis.enabled = true;\n\t}\n}\n\nexport { ElementComponentData };\n","import { Color } from '../../../core/math/color.js';\nimport { Vec2 } from '../../../core/math/vec2.js';\nimport { Vec4 } from '../../../core/math/vec4.js';\nimport { PIXELFORMAT_RGBA8 } from '../../../platform/graphics/constants.js';\nimport { Texture } from '../../../platform/graphics/texture.js';\nimport { BLEND_PREMULTIPLIED, SPRITE_RENDERMODE_SLICED, SPRITE_RENDERMODE_TILED } from '../../../scene/constants.js';\nimport { StandardMaterial } from '../../../scene/materials/standard-material.js';\nimport { Component } from '../component.js';\nimport { ComponentSystem } from '../system.js';\nimport { ELEMENTTYPE_IMAGE, ELEMENTTYPE_TEXT } from './constants.js';\nimport { ElementComponent } from './component.js';\nimport { ElementComponentData } from './data.js';\n\nconst _schema = ['enabled'];\nclass ElementComponentSystem extends ComponentSystem {\n\tconstructor(app) {\n\t\tsuper(app);\n\t\tthis.id = 'element';\n\t\tthis.ComponentType = ElementComponent;\n\t\tthis.DataType = ElementComponentData;\n\t\tthis.schema = _schema;\n\t\tthis._unicodeConverter = null;\n\t\tthis._rtlReorder = null;\n\t\tthis._defaultTexture = new Texture(app.graphicsDevice, {\n\t\t\twidth: 1,\n\t\t\theight: 1,\n\t\t\tformat: PIXELFORMAT_RGBA8,\n\t\t\tname: 'element-system'\n\t\t});\n\t\tconst pixels = this._defaultTexture.lock();\n\t\tconst pixelData = new Uint8Array(4);\n\t\tpixelData[0] = 255.0;\n\t\tpixelData[1] = 255.0;\n\t\tpixelData[2] = 255.0;\n\t\tpixelData[3] = 255.0;\n\t\tpixels.set(pixelData);\n\t\tthis._defaultTexture.unlock();\n\t\tthis.defaultImageMaterial = null;\n\t\tthis.defaultImage9SlicedMaterial = null;\n\t\tthis.defaultImage9TiledMaterial = null;\n\t\tthis.defaultImageMaskMaterial = null;\n\t\tthis.defaultImage9SlicedMaskMaterial = null;\n\t\tthis.defaultImage9TiledMaskMaterial = null;\n\t\tthis.defaultScreenSpaceImageMaterial = null;\n\t\tthis.defaultScreenSpaceImage9SlicedMaterial = null;\n\t\tthis.defaultScreenSpaceImage9TiledMaterial = null;\n\t\tthis.defaultScreenSpaceImageMask9SlicedMaterial = null;\n\t\tthis.defaultScreenSpaceImageMask9TiledMaterial = null;\n\t\tthis.defaultScreenSpaceImageMaskMaterial = null;\n\t\tthis._defaultTextMaterials = {};\n\t\tthis.defaultImageMaterials = [];\n\t\tthis.on('beforeremove', this.onRemoveComponent, this);\n\t}\n\tdestroy() {\n\t\tsuper.destroy();\n\t\tthis._defaultTexture.destroy();\n\t}\n\tinitializeComponentData(component, data, properties) {\n\t\tcomponent._beingInitialized = true;\n\t\tif (data.anchor !== undefined) {\n\t\t\tif (data.anchor instanceof Vec4) {\n\t\t\t\tcomponent.anchor.copy(data.anchor);\n\t\t\t} else {\n\t\t\t\tcomponent.anchor.set(data.anchor[0], data.anchor[1], data.anchor[2], data.anchor[3]);\n\t\t\t}\n\t\t}\n\t\tif (data.pivot !== undefined) {\n\t\t\tif (data.pivot instanceof Vec2) {\n\t\t\t\tcomponent.pivot.copy(data.pivot);\n\t\t\t} else {\n\t\t\t\tcomponent.pivot.set(data.pivot[0], data.pivot[1]);\n\t\t\t}\n\t\t}\n\t\tconst splitHorAnchors = Math.abs(component.anchor.x - component.anchor.z) > 0.001;\n\t\tconst splitVerAnchors = Math.abs(component.anchor.y - component.anchor.w) > 0.001;\n\t\tlet _marginChange = false;\n\t\tlet color;\n\t\tif (data.margin !== undefined) {\n\t\t\tif (data.margin instanceof Vec4) {\n\t\t\t\tcomponent.margin.copy(data.margin);\n\t\t\t} else {\n\t\t\t\tcomponent._margin.set(data.margin[0], data.margin[1], data.margin[2], data.margin[3]);\n\t\t\t}\n\t\t\t_marginChange = true;\n\t\t}\n\t\tif (data.left !== undefined) {\n\t\t\tcomponent._margin.x = data.left;\n\t\t\t_marginChange = true;\n\t\t}\n\t\tif (data.bottom !== undefined) {\n\t\t\tcomponent._margin.y = data.bottom;\n\t\t\t_marginChange = true;\n\t\t}\n\t\tif (data.right !== undefined) {\n\t\t\tcomponent._margin.z = data.right;\n\t\t\t_marginChange = true;\n\t\t}\n\t\tif (data.top !== undefined) {\n\t\t\tcomponent._margin.w = data.top;\n\t\t\t_marginChange = true;\n\t\t}\n\t\tif (_marginChange) {\n\t\t\tcomponent.margin = component._margin;\n\t\t}\n\t\tlet shouldForceSetAnchor = false;\n\t\tif (data.width !== undefined && !splitHorAnchors) {\n\t\t\tcomponent.width = data.width;\n\t\t} else if (splitHorAnchors) {\n\t\t\tshouldForceSetAnchor = true;\n\t\t}\n\t\tif (data.height !== undefined && !splitVerAnchors) {\n\t\t\tcomponent.height = data.height;\n\t\t} else if (splitVerAnchors) {\n\t\t\tshouldForceSetAnchor = true;\n\t\t}\n\t\tif (shouldForceSetAnchor) {\n\t\t\tcomponent.anchor = component.anchor;\n\t\t}\n\t\tif (data.enabled !== undefined) {\n\t\t\tcomponent.enabled = data.enabled;\n\t\t}\n\t\tif (data.useInput !== undefined) {\n\t\t\tcomponent.useInput = data.useInput;\n\t\t}\n\t\tif (data.fitMode !== undefined) {\n\t\t\tcomponent.fitMode = data.fitMode;\n\t\t}\n\t\tcomponent.batchGroupId = data.batchGroupId === undefined || data.batchGroupId === null ? -1 : data.batchGroupId;\n\t\tif (data.layers && Array.isArray(data.layers)) {\n\t\t\tcomponent.layers = data.layers.slice(0);\n\t\t}\n\t\tif (data.type !== undefined) {\n\t\t\tcomponent.type = data.type;\n\t\t}\n\t\tif (component.type === ELEMENTTYPE_IMAGE) {\n\t\t\tif (data.rect !== undefined) {\n\t\t\t\tcomponent.rect = data.rect;\n\t\t\t}\n\t\t\tif (data.color !== undefined) {\n\t\t\t\tcolor = data.color;\n\t\t\t\tif (!(color instanceof Color)) {\n\t\t\t\t\tcolor = new Color(data.color[0], data.color[1], data.color[2]);\n\t\t\t\t}\n\t\t\t\tcomponent.color = color;\n\t\t\t}\n\t\t\tif (data.opacity !== undefined) component.opacity = data.opacity;\n\t\t\tif (data.textureAsset !== undefined) component.textureAsset = data.textureAsset;\n\t\t\tif (data.texture) component.texture = data.texture;\n\t\t\tif (data.spriteAsset !== undefined) component.spriteAsset = data.spriteAsset;\n\t\t\tif (data.sprite) component.sprite = data.sprite;\n\t\t\tif (data.spriteFrame !== undefined) component.spriteFrame = data.spriteFrame;\n\t\t\tif (data.pixelsPerUnit !== undefined && data.pixelsPerUnit !== null) component.pixelsPerUnit = data.pixelsPerUnit;\n\t\t\tif (data.materialAsset !== undefined) component.materialAsset = data.materialAsset;\n\t\t\tif (data.material) component.material = data.material;\n\t\t\tif (data.mask !== undefined) {\n\t\t\t\tcomponent.mask = data.mask;\n\t\t\t}\n\t\t} else if (component.type === ELEMENTTYPE_TEXT) {\n\t\t\tif (data.autoWidth !== undefined) component.autoWidth = data.autoWidth;\n\t\t\tif (data.autoHeight !== undefined) component.autoHeight = data.autoHeight;\n\t\t\tif (data.rtlReorder !== undefined) component.rtlReorder = data.rtlReorder;\n\t\t\tif (data.unicodeConverter !== undefined) component.unicodeConverter = data.unicodeConverter;\n\t\t\tif (data.text !== null && data.text !== undefined) {\n\t\t\t\tcomponent.text = data.text;\n\t\t\t} else if (data.key !== null && data.key !== undefined) {\n\t\t\t\tcomponent.key = data.key;\n\t\t\t}\n\t\t\tif (data.color !== undefined) {\n\t\t\t\tcolor = data.color;\n\t\t\t\tif (!(color instanceof Color)) {\n\t\t\t\t\tcolor = new Color(color[0], color[1], color[2]);\n\t\t\t\t}\n\t\t\t\tcomponent.color = color;\n\t\t\t}\n\t\t\tif (data.opacity !== undefined) {\n\t\t\t\tcomponent.opacity = data.opacity;\n\t\t\t}\n\t\t\tif (data.spacing !== undefined) component.spacing = data.spacing;\n\t\t\tif (data.fontSize !== undefined) {\n\t\t\t\tcomponent.fontSize = data.fontSize;\n\t\t\t\tif (!data.lineHeight) component.lineHeight = data.fontSize;\n\t\t\t}\n\t\t\tif (data.lineHeight !== undefined) component.lineHeight = data.lineHeight;\n\t\t\tif (data.maxLines !== undefined) component.maxLines = data.maxLines;\n\t\t\tif (data.wrapLines !== undefined) component.wrapLines = data.wrapLines;\n\t\t\tif (data.minFontSize !== undefined) component.minFontSize = data.minFontSize;\n\t\t\tif (data.maxFontSize !== undefined) component.maxFontSize = data.maxFontSize;\n\t\t\tif (data.autoFitWidth) component.autoFitWidth = data.autoFitWidth;\n\t\t\tif (data.autoFitHeight) component.autoFitHeight = data.autoFitHeight;\n\t\t\tif (data.fontAsset !== undefined) component.fontAsset = data.fontAsset;\n\t\t\tif (data.font !== undefined) component.font = data.font;\n\t\t\tif (data.alignment !== undefined) component.alignment = data.alignment;\n\t\t\tif (data.outlineColor !== undefined) component.outlineColor = data.outlineColor;\n\t\t\tif (data.outlineThickness !== undefined) component.outlineThickness = data.outlineThickness;\n\t\t\tif (data.shadowColor !== undefined) component.shadowColor = data.shadowColor;\n\t\t\tif (data.shadowOffset !== undefined) component.shadowOffset = data.shadowOffset;\n\t\t\tif (data.enableMarkup !== undefined) component.enableMarkup = data.enableMarkup;\n\t\t}\n\t\tconst result = component._parseUpToScreen();\n\t\tif (result.screen) {\n\t\t\tcomponent._updateScreen(result.screen);\n\t\t}\n\t\tsuper.initializeComponentData(component, data, properties);\n\t\tcomponent._beingInitialized = false;\n\t\tif (component.type === ELEMENTTYPE_IMAGE && component._image._meshDirty) {\n\t\t\tcomponent._image._updateMesh(component._image.mesh);\n\t\t}\n\t}\n\tonRemoveComponent(entity, component) {\n\t\tcomponent.onRemove();\n\t}\n\tcloneComponent(entity, clone) {\n\t\tconst source = entity.element;\n\t\tconst data = {\n\t\t\tenabled: source.enabled,\n\t\t\twidth: source.width,\n\t\t\theight: source.height,\n\t\t\tanchor: source.anchor.clone(),\n\t\t\tpivot: source.pivot.clone(),\n\t\t\tmargin: source.margin.clone(),\n\t\t\talignment: source.alignment && source.alignment.clone() || source.alignment,\n\t\t\tautoWidth: source.autoWidth,\n\t\t\tautoHeight: source.autoHeight,\n\t\t\ttype: source.type,\n\t\t\trect: source.rect && source.rect.clone() || source.rect,\n\t\t\trtlReorder: source.rtlReorder,\n\t\t\tunicodeConverter: source.unicodeConverter,\n\t\t\tmaterialAsset: source.materialAsset,\n\t\t\tmaterial: source.material,\n\t\t\tcolor: source.color && source.color.clone() || source.color,\n\t\t\topacity: source.opacity,\n\t\t\ttextureAsset: source.textureAsset,\n\t\t\ttexture: source.texture,\n\t\t\tspriteAsset: source.spriteAsset,\n\t\t\tsprite: source.sprite,\n\t\t\tspriteFrame: source.spriteFrame,\n\t\t\tpixelsPerUnit: source.pixelsPerUnit,\n\t\t\tspacing: source.spacing,\n\t\t\tlineHeight: source.lineHeight,\n\t\t\twrapLines: source.wrapLines,\n\t\t\tlayers: source.layers,\n\t\t\tfontSize: source.fontSize,\n\t\t\tminFontSize: source.minFontSize,\n\t\t\tmaxFontSize: source.maxFontSize,\n\t\t\tautoFitWidth: source.autoFitWidth,\n\t\t\tautoFitHeight: source.autoFitHeight,\n\t\t\tmaxLines: source.maxLines,\n\t\t\tfontAsset: source.fontAsset,\n\t\t\tfont: source.font,\n\t\t\tuseInput: source.useInput,\n\t\t\tfitMode: source.fitMode,\n\t\t\tbatchGroupId: source.batchGroupId,\n\t\t\tmask: source.mask,\n\t\t\toutlineColor: source.outlineColor && source.outlineColor.clone() || source.outlineColor,\n\t\t\toutlineThickness: source.outlineThickness,\n\t\t\tshadowColor: source.shadowColor && source.shadowColor.clone() || source.shadowColor,\n\t\t\tshadowOffset: source.shadowOffset && source.shadowOffset.clone() || source.shadowOffset,\n\t\t\tenableMarkup: source.enableMarkup\n\t\t};\n\t\tif (source.key !== undefined && source.key !== null) {\n\t\t\tdata.key = source.key;\n\t\t} else {\n\t\t\tdata.text = source.text;\n\t\t}\n\t\treturn this.addComponent(clone, data);\n\t}\n\tgetTextElementMaterial(screenSpace, msdf, textAttibutes) {\n\t\tconst hash = (screenSpace && 1 << 0) | (msdf && 1 << 1) | (textAttibutes && 1 << 2);\n\t\tlet material = this._defaultTextMaterials[hash];\n\t\tif (material) {\n\t\t\treturn material;\n\t\t}\n\t\tlet name = \"TextMaterial\";\n\t\tmaterial = new StandardMaterial();\n\t\tif (msdf) {\n\t\t\tmaterial.msdfMap = this._defaultTexture;\n\t\t\tmaterial.msdfTextAttribute = textAttibutes;\n\t\t\tmaterial.emissive.set(1, 1, 1);\n\t\t} else {\n\t\t\tname = \"Bitmap\" + name;\n\t\t\tmaterial.emissive.set(0.5, 0.5, 0.5);\n\t\t\tmaterial.emissiveMap = this._defaultTexture;\n\t\t\tmaterial.emissiveTint = true;\n\t\t\tmaterial.opacityMap = this._defaultTexture;\n\t\t\tmaterial.opacityMapChannel = 'a';\n\t\t}\n\t\tif (screenSpace) {\n\t\t\tname = 'ScreenSpace' + name;\n\t\t\tmaterial.depthTest = false;\n\t\t}\n\t\tmaterial.name = 'default' + name;\n\t\tmaterial.useLighting = false;\n\t\tmaterial.useGammaTonemap = false;\n\t\tmaterial.useFog = false;\n\t\tmaterial.useSkybox = false;\n\t\tmaterial.diffuse.set(0, 0, 0);\n\t\tmaterial.opacity = 0.5;\n\t\tmaterial.blendType = BLEND_PREMULTIPLIED;\n\t\tmaterial.depthWrite = false;\n\t\tmaterial.emissiveVertexColor = true;\n\t\tmaterial.update();\n\t\tthis._defaultTextMaterials[hash] = material;\n\t\treturn material;\n\t}\n\t_createBaseImageMaterial() {\n\t\tconst material = new StandardMaterial();\n\t\tmaterial.diffuse.set(0, 0, 0);\n\t\tmaterial.emissive.set(0.5, 0.5, 0.5);\n\t\tmaterial.emissiveMap = this._defaultTexture;\n\t\tmaterial.emissiveTint = true;\n\t\tmaterial.opacityMap = this._defaultTexture;\n\t\tmaterial.opacityMapChannel = 'a';\n\t\tmaterial.opacityTint = true;\n\t\tmaterial.opacity = 0;\n\t\tmaterial.useLighting = false;\n\t\tmaterial.useGammaTonemap = false;\n\t\tmaterial.useFog = false;\n\t\tmaterial.useSkybox = false;\n\t\tmaterial.blendType = BLEND_PREMULTIPLIED;\n\t\tmaterial.depthWrite = false;\n\t\treturn material;\n\t}\n\tgetImageElementMaterial(screenSpace, mask, nineSliced, nineSliceTiled) {\n\t\tif (screenSpace) {\n\t\t\tif (mask) {\n\t\t\t\tif (nineSliced) {\n\t\t\t\t\tif (!this.defaultScreenSpaceImageMask9SlicedMaterial) {\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMask9SlicedMaterial = this._createBaseImageMaterial();\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMask9SlicedMaterial.name = 'defaultScreenSpaceImageMask9SlicedMaterial';\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMask9SlicedMaterial.nineSlicedMode = SPRITE_RENDERMODE_SLICED;\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMask9SlicedMaterial.depthTest = false;\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMask9SlicedMaterial.alphaTest = 1;\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMask9SlicedMaterial.redWrite = false;\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMask9SlicedMaterial.greenWrite = false;\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMask9SlicedMaterial.blueWrite = false;\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMask9SlicedMaterial.alphaWrite = false;\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMask9SlicedMaterial.update();\n\t\t\t\t\t\tthis.defaultImageMaterials.push(this.defaultScreenSpaceImageMask9SlicedMaterial);\n\t\t\t\t\t}\n\t\t\t\t\treturn this.defaultScreenSpaceImageMask9SlicedMaterial;\n\t\t\t\t} else if (nineSliceTiled) {\n\t\t\t\t\tif (!this.defaultScreenSpaceImageMask9TiledMaterial) {\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMask9TiledMaterial = this.defaultScreenSpaceImage9TiledMaterial.clone();\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMask9TiledMaterial.name = 'defaultScreenSpaceImageMask9TiledMaterial';\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMask9TiledMaterial.nineSlicedMode = SPRITE_RENDERMODE_TILED;\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMask9TiledMaterial.depthTest = false;\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMask9TiledMaterial.alphaTest = 1;\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMask9TiledMaterial.redWrite = false;\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMask9TiledMaterial.greenWrite = false;\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMask9TiledMaterial.blueWrite = false;\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMask9TiledMaterial.alphaWrite = false;\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMask9TiledMaterial.update();\n\t\t\t\t\t\tthis.defaultImageMaterials.push(this.defaultScreenSpaceImageMask9TiledMaterial);\n\t\t\t\t\t}\n\t\t\t\t\treturn this.defaultScreenSpaceImageMask9TiledMaterial;\n\t\t\t\t} else {\n\t\t\t\t\tif (!this.defaultScreenSpaceImageMaskMaterial) {\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMaskMaterial = this._createBaseImageMaterial();\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMaskMaterial.name = 'defaultScreenSpaceImageMaskMaterial';\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMaskMaterial.depthTest = false;\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMaskMaterial.alphaTest = 1;\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMaskMaterial.redWrite = false;\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMaskMaterial.greenWrite = false;\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMaskMaterial.blueWrite = false;\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMaskMaterial.alphaWrite = false;\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMaskMaterial.update();\n\t\t\t\t\t\tthis.defaultImageMaterials.push(this.defaultScreenSpaceImageMaskMaterial);\n\t\t\t\t\t}\n\t\t\t\t\treturn this.defaultScreenSpaceImageMaskMaterial;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (nineSliced) {\n\t\t\t\t\tif (!this.defaultScreenSpaceImage9SlicedMaterial) {\n\t\t\t\t\t\tthis.defaultScreenSpaceImage9SlicedMaterial = this._createBaseImageMaterial();\n\t\t\t\t\t\tthis.defaultScreenSpaceImage9SlicedMaterial.name = 'defaultScreenSpaceImage9SlicedMaterial';\n\t\t\t\t\t\tthis.defaultScreenSpaceImage9SlicedMaterial.nineSlicedMode = SPRITE_RENDERMODE_SLICED;\n\t\t\t\t\t\tthis.defaultScreenSpaceImage9SlicedMaterial.depthTest = false;\n\t\t\t\t\t\tthis.defaultScreenSpaceImage9SlicedMaterial.update();\n\t\t\t\t\t\tthis.defaultImageMaterials.push(this.defaultScreenSpaceImage9SlicedMaterial);\n\t\t\t\t\t}\n\t\t\t\t\treturn this.defaultScreenSpaceImage9SlicedMaterial;\n\t\t\t\t} else if (nineSliceTiled) {\n\t\t\t\t\tif (!this.defaultScreenSpaceImage9TiledMaterial) {\n\t\t\t\t\t\tthis.defaultScreenSpaceImage9TiledMaterial = this._createBaseImageMaterial();\n\t\t\t\t\t\tthis.defaultScreenSpaceImage9TiledMaterial.name = 'defaultScreenSpaceImage9TiledMaterial';\n\t\t\t\t\t\tthis.defaultScreenSpaceImage9TiledMaterial.nineSlicedMode = SPRITE_RENDERMODE_TILED;\n\t\t\t\t\t\tthis.defaultScreenSpaceImage9TiledMaterial.depthTest = false;\n\t\t\t\t\t\tthis.defaultScreenSpaceImage9TiledMaterial.update();\n\t\t\t\t\t\tthis.defaultImageMaterials.push(this.defaultScreenSpaceImage9TiledMaterial);\n\t\t\t\t\t}\n\t\t\t\t\treturn this.defaultScreenSpaceImage9TiledMaterial;\n\t\t\t\t} else {\n\t\t\t\t\tif (!this.defaultScreenSpaceImageMaterial) {\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMaterial = this._createBaseImageMaterial();\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMaterial.name = 'defaultScreenSpaceImageMaterial';\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMaterial.depthTest = false;\n\t\t\t\t\t\tthis.defaultScreenSpaceImageMaterial.update();\n\t\t\t\t\t\tthis.defaultImageMaterials.push(this.defaultScreenSpaceImageMaterial);\n\t\t\t\t\t}\n\t\t\t\t\treturn this.defaultScreenSpaceImageMaterial;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (mask) {\n\t\t\t\tif (nineSliced) {\n\t\t\t\t\tif (!this.defaultImage9SlicedMaskMaterial) {\n\t\t\t\t\t\tthis.defaultImage9SlicedMaskMaterial = this._createBaseImageMaterial();\n\t\t\t\t\t\tthis.defaultImage9SlicedMaskMaterial.name = 'defaultImage9SlicedMaskMaterial';\n\t\t\t\t\t\tthis.defaultImage9SlicedMaskMaterial.nineSlicedMode = SPRITE_RENDERMODE_SLICED;\n\t\t\t\t\t\tthis.defaultImage9SlicedMaskMaterial.alphaTest = 1;\n\t\t\t\t\t\tthis.defaultImage9SlicedMaskMaterial.redWrite = false;\n\t\t\t\t\t\tthis.defaultImage9SlicedMaskMaterial.greenWrite = false;\n\t\t\t\t\t\tthis.defaultImage9SlicedMaskMaterial.blueWrite = false;\n\t\t\t\t\t\tthis.defaultImage9SlicedMaskMaterial.alphaWrite = false;\n\t\t\t\t\t\tthis.defaultImage9SlicedMaskMaterial.update();\n\t\t\t\t\t\tthis.defaultImageMaterials.push(this.defaultImage9SlicedMaskMaterial);\n\t\t\t\t\t}\n\t\t\t\t\treturn this.defaultImage9SlicedMaskMaterial;\n\t\t\t\t} else if (nineSliceTiled) {\n\t\t\t\t\tif (!this.defaultImage9TiledMaskMaterial) {\n\t\t\t\t\t\tthis.defaultImage9TiledMaskMaterial = this._createBaseImageMaterial();\n\t\t\t\t\t\tthis.defaultImage9TiledMaskMaterial.name = 'defaultImage9TiledMaskMaterial';\n\t\t\t\t\t\tthis.defaultImage9TiledMaskMaterial.nineSlicedMode = SPRITE_RENDERMODE_TILED;\n\t\t\t\t\t\tthis.defaultImage9TiledMaskMaterial.alphaTest = 1;\n\t\t\t\t\t\tthis.defaultImage9TiledMaskMaterial.redWrite = false;\n\t\t\t\t\t\tthis.defaultImage9TiledMaskMaterial.greenWrite = false;\n\t\t\t\t\t\tthis.defaultImage9TiledMaskMaterial.blueWrite = false;\n\t\t\t\t\t\tthis.defaultImage9TiledMaskMaterial.alphaWrite = false;\n\t\t\t\t\t\tthis.defaultImage9TiledMaskMaterial.update();\n\t\t\t\t\t\tthis.defaultImageMaterials.push(this.defaultImage9TiledMaskMaterial);\n\t\t\t\t\t}\n\t\t\t\t\treturn this.defaultImage9TiledMaskMaterial;\n\t\t\t\t} else {\n\t\t\t\t\tif (!this.defaultImageMaskMaterial) {\n\t\t\t\t\t\tthis.defaultImageMaskMaterial = this._createBaseImageMaterial();\n\t\t\t\t\t\tthis.defaultImageMaskMaterial.name = 'defaultImageMaskMaterial';\n\t\t\t\t\t\tthis.defaultImageMaskMaterial.alphaTest = 1;\n\t\t\t\t\t\tthis.defaultImageMaskMaterial.redWrite = false;\n\t\t\t\t\t\tthis.defaultImageMaskMaterial.greenWrite = false;\n\t\t\t\t\t\tthis.defaultImageMaskMaterial.blueWrite = false;\n\t\t\t\t\t\tthis.defaultImageMaskMaterial.alphaWrite = false;\n\t\t\t\t\t\tthis.defaultImageMaskMaterial.update();\n\t\t\t\t\t\tthis.defaultImageMaterials.push(this.defaultImageMaskMaterial);\n\t\t\t\t\t}\n\t\t\t\t\treturn this.defaultImageMaskMaterial;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (nineSliced) {\n\t\t\t\t\tif (!this.defaultImage9SlicedMaterial) {\n\t\t\t\t\t\tthis.defaultImage9SlicedMaterial = this._createBaseImageMaterial();\n\t\t\t\t\t\tthis.defaultImage9SlicedMaterial.name = 'defaultImage9SlicedMaterial';\n\t\t\t\t\t\tthis.defaultImage9SlicedMaterial.nineSlicedMode = SPRITE_RENDERMODE_SLICED;\n\t\t\t\t\t\tthis.defaultImage9SlicedMaterial.update();\n\t\t\t\t\t\tthis.defaultImageMaterials.push(this.defaultImage9SlicedMaterial);\n\t\t\t\t\t}\n\t\t\t\t\treturn this.defaultImage9SlicedMaterial;\n\t\t\t\t} else if (nineSliceTiled) {\n\t\t\t\t\tif (!this.defaultImage9TiledMaterial) {\n\t\t\t\t\t\tthis.defaultImage9TiledMaterial = this._createBaseImageMaterial();\n\t\t\t\t\t\tthis.defaultImage9TiledMaterial.name = 'defaultImage9TiledMaterial';\n\t\t\t\t\t\tthis.defaultImage9TiledMaterial.nineSlicedMode = SPRITE_RENDERMODE_TILED;\n\t\t\t\t\t\tthis.defaultImage9TiledMaterial.update();\n\t\t\t\t\t\tthis.defaultImageMaterials.push(this.defaultImage9TiledMaterial);\n\t\t\t\t\t}\n\t\t\t\t\treturn this.defaultImage9TiledMaterial;\n\t\t\t\t} else {\n\t\t\t\t\tif (!this.defaultImageMaterial) {\n\t\t\t\t\t\tthis.defaultImageMaterial = this._createBaseImageMaterial();\n\t\t\t\t\t\tthis.defaultImageMaterial.name = 'defaultImageMaterial';\n\t\t\t\t\t\tthis.defaultImageMaterial.update();\n\t\t\t\t\t\tthis.defaultImageMaterials.push(this.defaultImageMaterial);\n\t\t\t\t\t}\n\t\t\t\t\treturn this.defaultImageMaterial;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tregisterUnicodeConverter(func) {\n\t\tthis._unicodeConverter = func;\n\t}\n\tregisterRtlReorder(func) {\n\t\tthis._rtlReorder = func;\n\t}\n\tgetUnicodeConverter() {\n\t\treturn this._unicodeConverter;\n\t}\n\tgetRtlReorder() {\n\t\treturn this._rtlReorder;\n\t}\n}\nComponent._buildAccessors(ElementComponent.prototype, _schema);\n\nexport { ElementComponentSystem };\n","const MOTION_FREE = 'free';\nconst MOTION_LIMITED = 'limited';\nconst MOTION_LOCKED = 'locked';\n\nexport { MOTION_FREE, MOTION_LIMITED, MOTION_LOCKED };\n","import '../../../core/tracing.js';\nimport { math } from '../../../core/math/math.js';\nimport { Mat4 } from '../../../core/math/mat4.js';\nimport { Quat } from '../../../core/math/quat.js';\nimport { Vec2 } from '../../../core/math/vec2.js';\nimport { Component } from '../component.js';\nimport { MOTION_LOCKED, MOTION_LIMITED, MOTION_FREE } from './constants.js';\n\nconst properties = ['angularDampingX', 'angularDampingY', 'angularDampingZ', 'angularEquilibriumX', 'angularEquilibriumY', 'angularEquilibriumZ', 'angularLimitsX', 'angularLimitsY', 'angularLimitsZ', 'angularMotionX', 'angularMotionY', 'angularMotionZ', 'angularSpringX', 'angularSpringY', 'angularSpringZ', 'angularStiffnessX', 'angularStiffnessY', 'angularStiffnessZ', 'breakForce', 'enableCollision', 'enabled', 'entityA', 'entityB', 'linearDampingX', 'linearDampingY', 'linearDampingZ', 'linearEquilibriumX', 'linearEquilibriumY', 'linearEquilibriumZ', 'linearLimitsX', 'linearLimitsY', 'linearLimitsZ', 'linearMotionX', 'linearMotionY', 'linearMotionZ', 'linearSpringX', 'linearSpringY', 'linearSpringZ', 'linearStiffnessX', 'linearStiffnessY', 'linearStiffnessZ'];\nclass JointComponent extends Component {\n\tconstructor(system, entity) {\n\t\tsuper(system, entity);\n\t\tthis._constraint = null;\n\t\tthis._entityA = null;\n\t\tthis._entityB = null;\n\t\tthis._breakForce = 3.4e+38;\n\t\tthis._enableCollision = true;\n\t\tthis._linearMotionX = MOTION_LOCKED;\n\t\tthis._linearLimitsX = new Vec2(0, 0);\n\t\tthis._linearSpringX = false;\n\t\tthis._linearStiffnessX = 0;\n\t\tthis._linearDampingX = 1;\n\t\tthis._linearEquilibriumX = 0;\n\t\tthis._linearMotionY = MOTION_LOCKED;\n\t\tthis._linearLimitsY = new Vec2(0, 0);\n\t\tthis._linearSpringY = false;\n\t\tthis._linearStiffnessY = 0;\n\t\tthis._linearDampingY = 1;\n\t\tthis._linearEquilibriumY = 0;\n\t\tthis._linearMotionZ = MOTION_LOCKED;\n\t\tthis._linearLimitsZ = new Vec2(0, 0);\n\t\tthis._linearSpringZ = false;\n\t\tthis._linearStiffnessZ = 0;\n\t\tthis._linearDampingZ = 1;\n\t\tthis._linearEquilibriumZ = 0;\n\t\tthis._angularMotionX = MOTION_LOCKED;\n\t\tthis._angularLimitsX = new Vec2(0, 0);\n\t\tthis._angularSpringX = false;\n\t\tthis._angularStiffnessX = 0;\n\t\tthis._angularDampingX = 1;\n\t\tthis._angularEquilibriumX = 0;\n\t\tthis._angularMotionY = MOTION_LOCKED;\n\t\tthis._angularLimitsY = new Vec2(0, 0);\n\t\tthis._angularSpringY = false;\n\t\tthis._angularStiffnessY = 0;\n\t\tthis._angularDampingY = 1;\n\t\tthis._angularEquilibriumY = 0;\n\t\tthis._angularMotionZ = MOTION_LOCKED;\n\t\tthis._angularLimitsZ = new Vec2(0, 0);\n\t\tthis._angularSpringZ = false;\n\t\tthis._angularEquilibriumZ = 0;\n\t\tthis._angularDampingZ = 1;\n\t\tthis._angularStiffnessZ = 0;\n\t\tthis.on('set_enabled', this._onSetEnabled, this);\n\t}\n\tset entityA(body) {\n\t\tthis._destroyConstraint();\n\t\tthis._entityA = body;\n\t\tthis._createConstraint();\n\t}\n\tget entityA() {\n\t\treturn this._entityA;\n\t}\n\tset entityB(body) {\n\t\tthis._destroyConstraint();\n\t\tthis._entityB = body;\n\t\tthis._createConstraint();\n\t}\n\tget entityB() {\n\t\treturn this._entityB;\n\t}\n\tset breakForce(force) {\n\t\tif (this._constraint && this._breakForce !== force) {\n\t\t\tthis._constraint.setBreakingImpulseThreshold(force);\n\t\t\tthis._breakForce = force;\n\t\t}\n\t}\n\tget breakForce() {\n\t\treturn this._breakForce;\n\t}\n\tset enableCollision(enableCollision) {\n\t\tthis._destroyConstraint();\n\t\tthis._enableCollision = enableCollision;\n\t\tthis._createConstraint();\n\t}\n\tget enableCollision() {\n\t\treturn this._enableCollision;\n\t}\n\tset angularLimitsX(limits) {\n\t\tif (!this._angularLimitsX.equals(limits)) {\n\t\t\tthis._angularLimitsX.copy(limits);\n\t\t\tthis._updateAngularLimits();\n\t\t}\n\t}\n\tget angularLimitsX() {\n\t\treturn this._angularLimitsX;\n\t}\n\tset angularMotionX(value) {\n\t\tif (this._angularMotionX !== value) {\n\t\t\tthis._angularMotionX = value;\n\t\t\tthis._updateAngularLimits();\n\t\t}\n\t}\n\tget angularMotionX() {\n\t\treturn this._angularMotionX;\n\t}\n\tset angularLimitsY(limits) {\n\t\tif (!this._angularLimitsY.equals(limits)) {\n\t\t\tthis._angularLimitsY.copy(limits);\n\t\t\tthis._updateAngularLimits();\n\t\t}\n\t}\n\tget angularLimitsY() {\n\t\treturn this._angularLimitsY;\n\t}\n\tset angularMotionY(value) {\n\t\tif (this._angularMotionY !== value) {\n\t\t\tthis._angularMotionY = value;\n\t\t\tthis._updateAngularLimits();\n\t\t}\n\t}\n\tget angularMotionY() {\n\t\treturn this._angularMotionY;\n\t}\n\tset angularLimitsZ(limits) {\n\t\tif (!this._angularLimitsZ.equals(limits)) {\n\t\t\tthis._angularLimitsZ.copy(limits);\n\t\t\tthis._updateAngularLimits();\n\t\t}\n\t}\n\tget angularLimitsZ() {\n\t\treturn this._angularLimitsZ;\n\t}\n\tset angularMotionZ(value) {\n\t\tif (this._angularMotionZ !== value) {\n\t\t\tthis._angularMotionZ = value;\n\t\t\tthis._updateAngularLimits();\n\t\t}\n\t}\n\tget angularMotionZ() {\n\t\treturn this._angularMotionZ;\n\t}\n\tset linearLimitsX(limits) {\n\t\tif (!this._linearLimitsX.equals(limits)) {\n\t\t\tthis._linearLimitsX.copy(limits);\n\t\t\tthis._updateLinearLimits();\n\t\t}\n\t}\n\tget linearLimitsX() {\n\t\treturn this._linearLimitsX;\n\t}\n\tset linearMotionX(value) {\n\t\tif (this._linearMotionX !== value) {\n\t\t\tthis._linearMotionX = value;\n\t\t\tthis._updateLinearLimits();\n\t\t}\n\t}\n\tget linearMotionX() {\n\t\treturn this._linearMotionX;\n\t}\n\tset linearLimitsY(limits) {\n\t\tif (!this._linearLimitsY.equals(limits)) {\n\t\t\tthis._linearLimitsY.copy(limits);\n\t\t\tthis._updateLinearLimits();\n\t\t}\n\t}\n\tget linearLimitsY() {\n\t\treturn this._linearLimitsY;\n\t}\n\tset linearMotionY(value) {\n\t\tif (this._linearMotionY !== value) {\n\t\t\tthis._linearMotionY = value;\n\t\t\tthis._updateLinearLimits();\n\t\t}\n\t}\n\tget linearMotionY() {\n\t\treturn this._linearMotionY;\n\t}\n\tset linearLimitsZ(limits) {\n\t\tif (!this._linearLimitsZ.equals(limits)) {\n\t\t\tthis._linearLimitsZ.copy(limits);\n\t\t\tthis._updateLinearLimits();\n\t\t}\n\t}\n\tget linearLimitsZ() {\n\t\treturn this._linearLimitsZ;\n\t}\n\tset linearMotionZ(value) {\n\t\tif (this._linearMotionZ !== value) {\n\t\t\tthis._linearMotionZ = value;\n\t\t\tthis._updateLinearLimits();\n\t\t}\n\t}\n\tget linearMotionZ() {\n\t\treturn this._linearMotionZ;\n\t}\n\t_convertTransform(pcTransform, ammoTransform) {\n\t\tconst pos = pcTransform.getTranslation();\n\t\tconst rot = new Quat();\n\t\trot.setFromMat4(pcTransform);\n\t\tconst ammoVec = new Ammo.btVector3(pos.x, pos.y, pos.z);\n\t\tconst ammoQuat = new Ammo.btQuaternion(rot.x, rot.y, rot.z, rot.w);\n\t\tammoTransform.setOrigin(ammoVec);\n\t\tammoTransform.setRotation(ammoQuat);\n\t\tAmmo.destroy(ammoVec);\n\t\tAmmo.destroy(ammoQuat);\n\t}\n\t_updateAngularLimits() {\n\t\tconst constraint = this._constraint;\n\t\tif (constraint) {\n\t\t\tlet lx, ly, lz, ux, uy, uz;\n\t\t\tif (this._angularMotionX === MOTION_LIMITED) {\n\t\t\t\tlx = this._angularLimitsX.x * math.DEG_TO_RAD;\n\t\t\t\tux = this._angularLimitsX.y * math.DEG_TO_RAD;\n\t\t\t} else if (this._angularMotionX === MOTION_FREE) {\n\t\t\t\tlx = 1;\n\t\t\t\tux = 0;\n\t\t\t} else {\n\t\t\t\tlx = ux = 0;\n\t\t\t}\n\t\t\tif (this._angularMotionY === MOTION_LIMITED) {\n\t\t\t\tly = this._angularLimitsY.x * math.DEG_TO_RAD;\n\t\t\t\tuy = this._angularLimitsY.y * math.DEG_TO_RAD;\n\t\t\t} else if (this._angularMotionY === MOTION_FREE) {\n\t\t\t\tly = 1;\n\t\t\t\tuy = 0;\n\t\t\t} else {\n\t\t\t\tly = uy = 0;\n\t\t\t}\n\t\t\tif (this._angularMotionZ === MOTION_LIMITED) {\n\t\t\t\tlz = this._angularLimitsZ.x * math.DEG_TO_RAD;\n\t\t\t\tuz = this._angularLimitsZ.y * math.DEG_TO_RAD;\n\t\t\t} else if (this._angularMotionZ === MOTION_FREE) {\n\t\t\t\tlz = 1;\n\t\t\t\tuz = 0;\n\t\t\t} else {\n\t\t\t\tlz = uz = 0;\n\t\t\t}\n\t\t\tconst limits = new Ammo.btVector3(lx, ly, lz);\n\t\t\tconstraint.setAngularLowerLimit(limits);\n\t\t\tlimits.setValue(ux, uy, uz);\n\t\t\tconstraint.setAngularUpperLimit(limits);\n\t\t\tAmmo.destroy(limits);\n\t\t}\n\t}\n\t_updateLinearLimits() {\n\t\tconst constraint = this._constraint;\n\t\tif (constraint) {\n\t\t\tlet lx, ly, lz, ux, uy, uz;\n\t\t\tif (this._linearMotionX === MOTION_LIMITED) {\n\t\t\t\tlx = this._linearLimitsX.x;\n\t\t\t\tux = this._linearLimitsX.y;\n\t\t\t} else if (this._linearMotionX === MOTION_FREE) {\n\t\t\t\tlx = 1;\n\t\t\t\tux = 0;\n\t\t\t} else {\n\t\t\t\tlx = ux = 0;\n\t\t\t}\n\t\t\tif (this._linearMotionY === MOTION_LIMITED) {\n\t\t\t\tly = this._linearLimitsY.x;\n\t\t\t\tuy = this._linearLimitsY.y;\n\t\t\t} else if (this._linearMotionY === MOTION_FREE) {\n\t\t\t\tly = 1;\n\t\t\t\tuy = 0;\n\t\t\t} else {\n\t\t\t\tly = uy = 0;\n\t\t\t}\n\t\t\tif (this._linearMotionZ === MOTION_LIMITED) {\n\t\t\t\tlz = this._linearLimitsZ.x;\n\t\t\t\tuz = this._linearLimitsZ.y;\n\t\t\t} else if (this._linearMotionZ === MOTION_FREE) {\n\t\t\t\tlz = 1;\n\t\t\t\tuz = 0;\n\t\t\t} else {\n\t\t\t\tlz = uz = 0;\n\t\t\t}\n\t\t\tconst limits = new Ammo.btVector3(lx, ly, lz);\n\t\t\tconstraint.setLinearLowerLimit(limits);\n\t\t\tlimits.setValue(ux, uy, uz);\n\t\t\tconstraint.setLinearUpperLimit(limits);\n\t\t\tAmmo.destroy(limits);\n\t\t}\n\t}\n\t_createConstraint() {\n\t\tif (this._entityA && this._entityA.rigidbody) {\n\t\t\tthis._destroyConstraint();\n\t\t\tconst mat = new Mat4();\n\t\t\tconst bodyA = this._entityA.rigidbody.body;\n\t\t\tbodyA.activate();\n\t\t\tconst jointWtm = this.entity.getWorldTransform();\n\t\t\tconst entityAWtm = this._entityA.getWorldTransform();\n\t\t\tconst invEntityAWtm = entityAWtm.clone().invert();\n\t\t\tmat.mul2(invEntityAWtm, jointWtm);\n\t\t\tconst frameA = new Ammo.btTransform();\n\t\t\tthis._convertTransform(mat, frameA);\n\t\t\tif (this._entityB && this._entityB.rigidbody) {\n\t\t\t\tconst bodyB = this._entityB.rigidbody.body;\n\t\t\t\tbodyB.activate();\n\t\t\t\tconst entityBWtm = this._entityB.getWorldTransform();\n\t\t\t\tconst invEntityBWtm = entityBWtm.clone().invert();\n\t\t\t\tmat.mul2(invEntityBWtm, jointWtm);\n\t\t\t\tconst frameB = new Ammo.btTransform();\n\t\t\t\tthis._convertTransform(mat, frameB);\n\t\t\t\tthis._constraint = new Ammo.btGeneric6DofSpringConstraint(bodyA, bodyB, frameA, frameB, !this._enableCollision);\n\t\t\t\tAmmo.destroy(frameB);\n\t\t\t} else {\n\t\t\t\tthis._constraint = new Ammo.btGeneric6DofSpringConstraint(bodyA, frameA, !this._enableCollision);\n\t\t\t}\n\t\t\tAmmo.destroy(frameA);\n\t\t\tconst axis = ['X', 'Y', 'Z', 'X', 'Y', 'Z'];\n\t\t\tfor (let i = 0; i < 6; i++) {\n\t\t\t\tconst type = i < 3 ? '_linear' : '_angular';\n\t\t\t\tthis._constraint.enableSpring(i, this[type + 'Spring' + axis[i]]);\n\t\t\t\tthis._constraint.setDamping(i, this[type + 'Damping' + axis[i]]);\n\t\t\t\tthis._constraint.setEquilibriumPoint(i, this[type + 'Equilibrium' + axis[i]]);\n\t\t\t\tthis._constraint.setStiffness(i, this[type + 'Stiffness' + axis[i]]);\n\t\t\t}\n\t\t\tthis._constraint.setBreakingImpulseThreshold(this._breakForce);\n\t\t\tthis._updateLinearLimits();\n\t\t\tthis._updateAngularLimits();\n\t\t\tconst app = this.system.app;\n\t\t\tconst dynamicsWorld = app.systems.rigidbody.dynamicsWorld;\n\t\t\tdynamicsWorld.addConstraint(this._constraint, !this._enableCollision);\n\t\t}\n\t}\n\t_destroyConstraint() {\n\t\tif (this._constraint) {\n\t\t\tconst app = this.system.app;\n\t\t\tconst dynamicsWorld = app.systems.rigidbody.dynamicsWorld;\n\t\t\tdynamicsWorld.removeConstraint(this._constraint);\n\t\t\tAmmo.destroy(this._constraint);\n\t\t\tthis._constraint = null;\n\t\t}\n\t}\n\tinitFromData(data) {\n\t\tfor (const prop of properties) {\n\t\t\tif (data.hasOwnProperty(prop)) {\n\t\t\t\tif (data[prop] instanceof Vec2) {\n\t\t\t\t\tthis['_' + prop].copy(data[prop]);\n\t\t\t\t} else {\n\t\t\t\t\tthis['_' + prop] = data[prop];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis._createConstraint();\n\t}\n\tonEnable() {\n\t\tthis._createConstraint();\n\t}\n\tonDisable() {\n\t\tthis._destroyConstraint();\n\t}\n\t_onSetEnabled(prop, old, value) {}\n\t_onBeforeRemove() {\n\t\tthis.fire('remove');\n\t}\n}\nconst functionMap = {\n\tDamping: 'setDamping',\n\tEquilibrium: 'setEquilibriumPoint',\n\tSpring: 'enableSpring',\n\tStiffness: 'setStiffness'\n};\n['linear', 'angular'].forEach(type => {\n\t['Damping', 'Equilibrium', 'Spring', 'Stiffness'].forEach(name => {\n\t\t['X', 'Y', 'Z'].forEach(axis => {\n\t\t\tconst prop = type + name + axis;\n\t\t\tconst propInternal = '_' + prop;\n\t\t\tlet index = type === 'linear' ? 0 : 3;\n\t\t\tif (axis === 'Y') index += 1;\n\t\t\tif (axis === 'Z') index += 2;\n\t\t\tObject.defineProperty(JointComponent.prototype, prop, {\n\t\t\t\tget: function () {\n\t\t\t\t\treturn this[propInternal];\n\t\t\t\t},\n\t\t\t\tset: function (value) {\n\t\t\t\t\tif (this[propInternal] !== value) {\n\t\t\t\t\t\tthis[propInternal] = value;\n\t\t\t\t\t\tthis._constraint[functionMap[name]](index, value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t});\n});\n\nexport { JointComponent };\n","class JointComponentData {\n\tconstructor() {\n\t\tthis.enabled = true;\n\t}\n}\n\nexport { JointComponentData };\n","import { Component } from '../component.js';\nimport { ComponentSystem } from '../system.js';\nimport { JointComponent } from './component.js';\nimport { JointComponentData } from './data.js';\n\nconst _schema = ['enabled'];\nclass JointComponentSystem extends ComponentSystem {\n\tconstructor(app) {\n\t\tsuper(app);\n\t\tthis.id = 'joint';\n\t\tthis.app = app;\n\t\tthis.ComponentType = JointComponent;\n\t\tthis.DataType = JointComponentData;\n\t\tthis.schema = _schema;\n\t}\n\tinitializeComponentData(component, data, properties) {\n\t\tcomponent.initFromData(data);\n\t}\n}\nComponent._buildAccessors(JointComponent.prototype, _schema);\n\nexport { JointComponentSystem };\n","import { Component } from '../component.js';\n\nclass LayoutChildComponent extends Component {\n\tconstructor(system, entity) {\n\t\tsuper(system, entity);\n\t\tthis._minWidth = 0;\n\t\tthis._minHeight = 0;\n\t\tthis._maxWidth = null;\n\t\tthis._maxHeight = null;\n\t\tthis._fitWidthProportion = 0;\n\t\tthis._fitHeightProportion = 0;\n\t\tthis._excludeFromLayout = false;\n\t}\n\tset minWidth(value) {\n\t\tif (value !== this._minWidth) {\n\t\t\tthis._minWidth = value;\n\t\t\tthis.fire('resize');\n\t\t}\n\t}\n\tget minWidth() {\n\t\treturn this._minWidth;\n\t}\n\tset minHeight(value) {\n\t\tif (value !== this._minHeight) {\n\t\t\tthis._minHeight = value;\n\t\t\tthis.fire('resize');\n\t\t}\n\t}\n\tget minHeight() {\n\t\treturn this._minHeight;\n\t}\n\tset maxWidth(value) {\n\t\tif (value !== this._maxWidth) {\n\t\t\tthis._maxWidth = value;\n\t\t\tthis.fire('resize');\n\t\t}\n\t}\n\tget maxWidth() {\n\t\treturn this._maxWidth;\n\t}\n\tset maxHeight(value) {\n\t\tif (value !== this._maxHeight) {\n\t\t\tthis._maxHeight = value;\n\t\t\tthis.fire('resize');\n\t\t}\n\t}\n\tget maxHeight() {\n\t\treturn this._maxHeight;\n\t}\n\tset fitWidthProportion(value) {\n\t\tif (value !== this._fitWidthProportion) {\n\t\t\tthis._fitWidthProportion = value;\n\t\t\tthis.fire('resize');\n\t\t}\n\t}\n\tget fitWidthProportion() {\n\t\treturn this._fitWidthProportion;\n\t}\n\tset fitHeightProportion(value) {\n\t\tif (value !== this._fitHeightProportion) {\n\t\t\tthis._fitHeightProportion = value;\n\t\t\tthis.fire('resize');\n\t\t}\n\t}\n\tget fitHeightProportion() {\n\t\treturn this._fitHeightProportion;\n\t}\n\tset excludeFromLayout(value) {\n\t\tif (value !== this._excludeFromLayout) {\n\t\t\tthis._excludeFromLayout = value;\n\t\t\tthis.fire('resize');\n\t\t}\n\t}\n\tget excludeFromLayout() {\n\t\treturn this._excludeFromLayout;\n\t}\n}\n\nexport { LayoutChildComponent };\n","class LayoutChildComponentData {\n\tconstructor() {\n\t\tthis.enabled = true;\n\t}\n}\n\nexport { LayoutChildComponentData };\n","import { Component } from '../component.js';\nimport { ComponentSystem } from '../system.js';\nimport { LayoutChildComponent } from './component.js';\nimport { LayoutChildComponentData } from './data.js';\n\nconst _schema = ['enabled'];\nclass LayoutChildComponentSystem extends ComponentSystem {\n\tconstructor(app) {\n\t\tsuper(app);\n\t\tthis.id = 'layoutchild';\n\t\tthis.ComponentType = LayoutChildComponent;\n\t\tthis.DataType = LayoutChildComponentData;\n\t\tthis.schema = _schema;\n\t}\n\tinitializeComponentData(component, data, properties) {\n\t\tif (data.enabled !== undefined) component.enabled = data.enabled;\n\t\tif (data.minWidth !== undefined) component.minWidth = data.minWidth;\n\t\tif (data.minHeight !== undefined) component.minHeight = data.minHeight;\n\t\tif (data.maxWidth !== undefined) component.maxWidth = data.maxWidth;\n\t\tif (data.maxHeight !== undefined) component.maxHeight = data.maxHeight;\n\t\tif (data.fitWidthProportion !== undefined) component.fitWidthProportion = data.fitWidthProportion;\n\t\tif (data.fitHeightProportion !== undefined) component.fitHeightProportion = data.fitHeightProportion;\n\t\tif (data.excludeFromLayout !== undefined) component.excludeFromLayout = data.excludeFromLayout;\n\t\tsuper.initializeComponentData(component, data, properties);\n\t}\n\tcloneComponent(entity, clone) {\n\t\tconst layoutChild = entity.layoutchild;\n\t\treturn this.addComponent(clone, {\n\t\t\tenabled: layoutChild.enabled,\n\t\t\tminWidth: layoutChild.minWidth,\n\t\t\tminHeight: layoutChild.minHeight,\n\t\t\tmaxWidth: layoutChild.maxWidth,\n\t\t\tmaxHeight: layoutChild.maxHeight,\n\t\t\tfitWidthProportion: layoutChild.fitWidthProportion,\n\t\t\tfitHeightProportion: layoutChild.fitHeightProportion,\n\t\t\texcludeFromLayout: layoutChild.excludeFromLayout\n\t\t});\n\t}\n}\nComponent._buildAccessors(LayoutChildComponent.prototype, _schema);\n\nexport { LayoutChildComponentSystem };\n","const FITTING_NONE = 0;\nconst FITTING_STRETCH = 1;\nconst FITTING_SHRINK = 2;\nconst FITTING_BOTH = 3;\n\nexport { FITTING_BOTH, FITTING_NONE, FITTING_SHRINK, FITTING_STRETCH };\n","import { Vec2 } from '../../../core/math/vec2.js';\nimport { Vec4 } from '../../../core/math/vec4.js';\nimport { ORIENTATION_HORIZONTAL, ORIENTATION_VERTICAL } from '../../../scene/constants.js';\nimport { FITTING_SHRINK, FITTING_BOTH, FITTING_STRETCH, FITTING_NONE } from './constants.js';\n\nconst AXIS_MAPPINGS = {};\nAXIS_MAPPINGS[ORIENTATION_HORIZONTAL] = {\n\taxis: 'x',\n\tsize: 'width',\n\tcalculatedSize: 'calculatedWidth',\n\tminSize: 'minWidth',\n\tmaxSize: 'maxWidth',\n\tfitting: 'widthFitting',\n\tfittingProportion: 'fitWidthProportion'\n};\nAXIS_MAPPINGS[ORIENTATION_VERTICAL] = {\n\taxis: 'y',\n\tsize: 'height',\n\tcalculatedSize: 'calculatedHeight',\n\tminSize: 'minHeight',\n\tmaxSize: 'maxHeight',\n\tfitting: 'heightFitting',\n\tfittingProportion: 'fitHeightProportion'\n};\nconst OPPOSITE_ORIENTATION = {};\nOPPOSITE_ORIENTATION[ORIENTATION_HORIZONTAL] = ORIENTATION_VERTICAL;\nOPPOSITE_ORIENTATION[ORIENTATION_VERTICAL] = ORIENTATION_HORIZONTAL;\nconst PROPERTY_DEFAULTS = {\n\tminWidth: 0,\n\tminHeight: 0,\n\tmaxWidth: Number.POSITIVE_INFINITY,\n\tmaxHeight: Number.POSITIVE_INFINITY,\n\twidth: null,\n\theight: null,\n\tfitWidthProportion: 0,\n\tfitHeightProportion: 0\n};\nconst FITTING_ACTION = {\n\tNONE: 'NONE',\n\tAPPLY_STRETCHING: 'APPLY_STRETCHING',\n\tAPPLY_SHRINKING: 'APPLY_SHRINKING'\n};\nconst availableSpace = new Vec2();\nfunction createCalculator(orientation) {\n\tlet options;\n\tconst a = AXIS_MAPPINGS[orientation];\n\tconst b = AXIS_MAPPINGS[OPPOSITE_ORIENTATION[orientation]];\n\tfunction minExtentA(element, size) {\n\t\treturn -size[a.size] * element.pivot[a.axis];\n\t}\n\tfunction minExtentB(element, size) {\n\t\treturn -size[b.size] * element.pivot[b.axis];\n\t}\n\tfunction maxExtentA(element, size) {\n\t\treturn size[a.size] * (1 - element.pivot[a.axis]);\n\t}\n\tfunction calculateAll(allElements, layoutOptions) {\n\t\tallElements = allElements.filter(shouldIncludeInLayout);\n\t\toptions = layoutOptions;\n\t\tavailableSpace.x = options.containerSize.x - options.padding.x - options.padding.z;\n\t\tavailableSpace.y = options.containerSize.y - options.padding.y - options.padding.w;\n\t\tresetAnchors(allElements);\n\t\tconst lines = reverseLinesIfRequired(splitLines(allElements));\n\t\tconst sizes = calculateSizesOnAxisB(lines, calculateSizesOnAxisA(lines));\n\t\tconst positions = calculateBasePositions(lines, sizes);\n\t\tapplyAlignmentAndPadding(lines, sizes, positions);\n\t\tapplySizesAndPositions(lines, sizes, positions);\n\t\treturn createLayoutInfo(lines);\n\t}\n\tfunction shouldIncludeInLayout(element) {\n\t\tconst layoutChildComponent = element.entity.layoutchild;\n\t\treturn !layoutChildComponent || !layoutChildComponent.enabled || !layoutChildComponent.excludeFromLayout;\n\t}\n\tfunction resetAnchors(allElements) {\n\t\tfor (let i = 0; i < allElements.length; ++i) {\n\t\t\tconst element = allElements[i];\n\t\t\tconst anchor = element.anchor;\n\t\t\tif (anchor.x !== 0 || anchor.y !== 0 || anchor.z !== 0 || anchor.w !== 0) {\n\t\t\t\telement.anchor = Vec4.ZERO;\n\t\t\t}\n\t\t}\n\t}\n\tfunction splitLines(allElements) {\n\t\tif (!options.wrap) {\n\t\t\treturn [allElements];\n\t\t}\n\t\tconst lines = [[]];\n\t\tconst sizes = getElementSizeProperties(allElements);\n\t\tlet runningSize = 0;\n\t\tconst allowOverrun = options[a.fitting] === FITTING_SHRINK;\n\t\tfor (let i = 0; i < allElements.length; ++i) {\n\t\t\tif (lines[lines.length - 1].length > 0) {\n\t\t\t\trunningSize += options.spacing[a.axis];\n\t\t\t}\n\t\t\tconst idealElementSize = sizes[i][a.size];\n\t\t\trunningSize += idealElementSize;\n\t\t\tif (!allowOverrun && runningSize > availableSpace[a.axis] && lines[lines.length - 1].length !== 0) {\n\t\t\t\trunningSize = idealElementSize;\n\t\t\t\tlines.push([]);\n\t\t\t}\n\t\t\tlines[lines.length - 1].push(allElements[i]);\n\t\t\tif (allowOverrun && runningSize > availableSpace[a.axis] && i !== allElements.length - 1) {\n\t\t\t\trunningSize = 0;\n\t\t\t\tlines.push([]);\n\t\t\t}\n\t\t}\n\t\treturn lines;\n\t}\n\tfunction reverseLinesIfRequired(lines) {\n\t\tconst reverseAxisA = options.orientation === ORIENTATION_HORIZONTAL && options.reverseX || options.orientation === ORIENTATION_VERTICAL && options.reverseY;\n\t\tconst reverseAxisB = options.orientation === ORIENTATION_HORIZONTAL && options.reverseY || options.orientation === ORIENTATION_VERTICAL && options.reverseX;\n\t\tif (reverseAxisA) {\n\t\t\tfor (let lineIndex = 0; lineIndex < lines.length; ++lineIndex) {\n\t\t\t\tif (reverseAxisA) {\n\t\t\t\t\tlines[lineIndex].reverse();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (reverseAxisB) {\n\t\t\tlines.reverse();\n\t\t}\n\t\treturn lines;\n\t}\n\tfunction calculateSizesOnAxisA(lines) {\n\t\tconst sizesAllLines = [];\n\t\tfor (let lineIndex = 0; lineIndex < lines.length; ++lineIndex) {\n\t\t\tconst line = lines[lineIndex];\n\t\t\tconst sizesThisLine = getElementSizeProperties(line);\n\t\t\tconst idealRequiredSpace = calculateTotalSpace(sizesThisLine, a);\n\t\t\tconst fittingAction = determineFittingAction(options[a.fitting], idealRequiredSpace, availableSpace[a.axis]);\n\t\t\tif (fittingAction === FITTING_ACTION.APPLY_STRETCHING) {\n\t\t\t\tstretchSizesToFitContainer(sizesThisLine, idealRequiredSpace, a);\n\t\t\t} else if (fittingAction === FITTING_ACTION.APPLY_SHRINKING) {\n\t\t\t\tshrinkSizesToFitContainer(sizesThisLine, idealRequiredSpace, a);\n\t\t\t}\n\t\t\tsizesAllLines.push(sizesThisLine);\n\t\t}\n\t\treturn sizesAllLines;\n\t}\n\tfunction calculateSizesOnAxisB(lines, sizesAllLines) {\n\t\tconst largestElementsForEachLine = [];\n\t\tconst largestSizesForEachLine = [];\n\t\tfor (let lineIndex = 0; lineIndex < lines.length; ++lineIndex) {\n\t\t\tconst line = lines[lineIndex];\n\t\t\tline.largestElement = null;\n\t\t\tline.largestSize = {\n\t\t\t\twidth: Number.NEGATIVE_INFINITY,\n\t\t\t\theight: Number.NEGATIVE_INFINITY\n\t\t\t};\n\t\t\tfor (let elementIndex = 0; elementIndex < line.length; ++elementIndex) {\n\t\t\t\tconst sizesThisElement = sizesAllLines[lineIndex][elementIndex];\n\t\t\t\tif (sizesThisElement[b.size] > line.largestSize[b.size]) {\n\t\t\t\t\tline.largestElement = line[elementIndex];\n\t\t\t\t\tline.largestSize = sizesThisElement;\n\t\t\t\t}\n\t\t\t}\n\t\t\tlargestElementsForEachLine.push(line.largestElement);\n\t\t\tlargestSizesForEachLine.push(line.largestSize);\n\t\t}\n\t\tconst idealRequiredSpace = calculateTotalSpace(largestSizesForEachLine, b);\n\t\tconst fittingAction = determineFittingAction(options[b.fitting], idealRequiredSpace, availableSpace[b.axis]);\n\t\tif (fittingAction === FITTING_ACTION.APPLY_STRETCHING) {\n\t\t\tstretchSizesToFitContainer(largestSizesForEachLine, idealRequiredSpace, b);\n\t\t} else if (fittingAction === FITTING_ACTION.APPLY_SHRINKING) {\n\t\t\tshrinkSizesToFitContainer(largestSizesForEachLine, idealRequiredSpace, b);\n\t\t}\n\t\tfor (let lineIndex = 0; lineIndex < lines.length; ++lineIndex) {\n\t\t\tconst line = lines[lineIndex];\n\t\t\tfor (let elementIndex = 0; elementIndex < line.length; ++elementIndex) {\n\t\t\t\tconst sizesForThisElement = sizesAllLines[lineIndex][elementIndex];\n\t\t\t\tconst currentSize = sizesForThisElement[b.size];\n\t\t\t\tconst availableSize = lines.length === 1 ? availableSpace[b.axis] : line.largestSize[b.size];\n\t\t\t\tconst elementFittingAction = determineFittingAction(options[b.fitting], currentSize, availableSize);\n\t\t\t\tif (elementFittingAction === FITTING_ACTION.APPLY_STRETCHING) {\n\t\t\t\t\tsizesForThisElement[b.size] = Math.min(availableSize, sizesForThisElement[b.maxSize]);\n\t\t\t\t} else if (elementFittingAction === FITTING_ACTION.APPLY_SHRINKING) {\n\t\t\t\t\tsizesForThisElement[b.size] = Math.max(availableSize, sizesForThisElement[b.minSize]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn sizesAllLines;\n\t}\n\tfunction determineFittingAction(fittingMode, currentSize, availableSize) {\n\t\tswitch (fittingMode) {\n\t\t\tcase FITTING_NONE:\n\t\t\t\treturn FITTING_ACTION.NONE;\n\t\t\tcase FITTING_STRETCH:\n\t\t\t\tif (currentSize < availableSize) {\n\t\t\t\t\treturn FITTING_ACTION.APPLY_STRETCHING;\n\t\t\t\t}\n\t\t\t\treturn FITTING_ACTION.NONE;\n\t\t\tcase FITTING_SHRINK:\n\t\t\t\tif (currentSize >= availableSize) {\n\t\t\t\t\treturn FITTING_ACTION.APPLY_SHRINKING;\n\t\t\t\t}\n\t\t\t\treturn FITTING_ACTION.NONE;\n\t\t\tcase FITTING_BOTH:\n\t\t\t\tif (currentSize < availableSize) {\n\t\t\t\t\treturn FITTING_ACTION.APPLY_STRETCHING;\n\t\t\t\t}\n\t\t\t\treturn FITTING_ACTION.APPLY_SHRINKING;\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Unrecognized fitting mode: ${fittingMode}`);\n\t\t}\n\t}\n\tfunction calculateTotalSpace(sizes, axis) {\n\t\tconst totalSizes = sumValues(sizes, axis.size);\n\t\tconst totalSpacing = (sizes.length - 1) * options.spacing[axis.axis];\n\t\treturn totalSizes + totalSpacing;\n\t}\n\tfunction stretchSizesToFitContainer(sizesThisLine, idealRequiredSpace, axis) {\n\t\tconst ascendingMaxSizeOrder = getTraversalOrder(sizesThisLine, axis.maxSize);\n\t\tconst fittingProportions = getNormalizedValues(sizesThisLine, axis.fittingProportion);\n\t\tconst fittingProportionSums = createSumArray(fittingProportions, ascendingMaxSizeOrder);\n\t\tlet remainingUndershoot = availableSpace[axis.axis] - idealRequiredSpace;\n\t\tfor (let i = 0; i < sizesThisLine.length; ++i) {\n\t\t\tconst index = ascendingMaxSizeOrder[i];\n\t\t\tconst targetIncrease = calculateAdjustment(index, remainingUndershoot, fittingProportions, fittingProportionSums);\n\t\t\tconst targetSize = sizesThisLine[index][axis.size] + targetIncrease;\n\t\t\tconst maxSize = sizesThisLine[index][axis.maxSize];\n\t\t\tconst actualSize = Math.min(targetSize, maxSize);\n\t\t\tsizesThisLine[index][axis.size] = actualSize;\n\t\t\tconst actualIncrease = Math.max(targetSize - actualSize, 0);\n\t\t\tconst appliedIncrease = targetIncrease - actualIncrease;\n\t\t\tremainingUndershoot -= appliedIncrease;\n\t\t}\n\t}\n\tfunction shrinkSizesToFitContainer(sizesThisLine, idealRequiredSpace, axis) {\n\t\tconst descendingMinSizeOrder = getTraversalOrder(sizesThisLine, axis.minSize, true);\n\t\tconst fittingProportions = getNormalizedValues(sizesThisLine, axis.fittingProportion);\n\t\tconst inverseFittingProportions = invertNormalizedValues(fittingProportions);\n\t\tconst inverseFittingProportionSums = createSumArray(inverseFittingProportions, descendingMinSizeOrder);\n\t\tlet remainingOvershoot = idealRequiredSpace - availableSpace[axis.axis];\n\t\tfor (let i = 0; i < sizesThisLine.length; ++i) {\n\t\t\tconst index = descendingMinSizeOrder[i];\n\t\t\tconst targetReduction = calculateAdjustment(index, remainingOvershoot, inverseFittingProportions, inverseFittingProportionSums);\n\t\t\tconst targetSize = sizesThisLine[index][axis.size] - targetReduction;\n\t\t\tconst minSize = sizesThisLine[index][axis.minSize];\n\t\t\tconst actualSize = Math.max(targetSize, minSize);\n\t\t\tsizesThisLine[index][axis.size] = actualSize;\n\t\t\tconst actualReduction = Math.max(actualSize - targetSize, 0);\n\t\t\tconst appliedReduction = targetReduction - actualReduction;\n\t\t\tremainingOvershoot -= appliedReduction;\n\t\t}\n\t}\n\tfunction calculateAdjustment(index, remainingAdjustment, fittingProportions, fittingProportionSums) {\n\t\tconst proportion = fittingProportions[index];\n\t\tconst sumOfRemainingProportions = fittingProportionSums[index];\n\t\tif (Math.abs(proportion) < 1e-5 && Math.abs(sumOfRemainingProportions) < 1e-5) {\n\t\t\treturn remainingAdjustment;\n\t\t}\n\t\treturn remainingAdjustment * proportion / sumOfRemainingProportions;\n\t}\n\tfunction calculateBasePositions(lines, sizes) {\n\t\tconst cursor = {};\n\t\tcursor[a.axis] = 0;\n\t\tcursor[b.axis] = 0;\n\t\tlines[a.size] = Number.NEGATIVE_INFINITY;\n\t\tconst positionsAllLines = [];\n\t\tfor (let lineIndex = 0; lineIndex < lines.length; ++lineIndex) {\n\t\t\tconst line = lines[lineIndex];\n\t\t\tif (line.length === 0) {\n\t\t\t\tpositionsAllLines.push([]);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst positionsThisLine = [];\n\t\t\tconst sizesThisLine = sizes[lineIndex];\n\t\t\tfor (let elementIndex = 0; elementIndex < line.length; ++elementIndex) {\n\t\t\t\tconst element = line[elementIndex];\n\t\t\t\tconst sizesThisElement = sizesThisLine[elementIndex];\n\t\t\t\tcursor[b.axis] -= minExtentB(element, sizesThisElement);\n\t\t\t\tcursor[a.axis] -= minExtentA(element, sizesThisElement);\n\t\t\t\tpositionsThisLine[elementIndex] = {};\n\t\t\t\tpositionsThisLine[elementIndex][a.axis] = cursor[a.axis];\n\t\t\t\tpositionsThisLine[elementIndex][b.axis] = cursor[b.axis];\n\t\t\t\tcursor[b.axis] += minExtentB(element, sizesThisElement);\n\t\t\t\tcursor[a.axis] += maxExtentA(element, sizesThisElement) + options.spacing[a.axis];\n\t\t\t}\n\t\t\tline[a.size] = cursor[a.axis] - options.spacing[a.axis];\n\t\t\tline[b.size] = line.largestSize[b.size];\n\t\t\tlines[a.size] = Math.max(lines[a.size], line[a.size]);\n\t\t\tcursor[a.axis] = 0;\n\t\t\tcursor[b.axis] += line[b.size] + options.spacing[b.axis];\n\t\t\tpositionsAllLines.push(positionsThisLine);\n\t\t}\n\t\tlines[b.size] = cursor[b.axis] - options.spacing[b.axis];\n\t\treturn positionsAllLines;\n\t}\n\tfunction applyAlignmentAndPadding(lines, sizes, positions) {\n\t\tconst alignmentA = options.alignment[a.axis];\n\t\tconst alignmentB = options.alignment[b.axis];\n\t\tconst paddingA = options.padding[a.axis];\n\t\tconst paddingB = options.padding[b.axis];\n\t\tfor (let lineIndex = 0; lineIndex < lines.length; ++lineIndex) {\n\t\t\tconst line = lines[lineIndex];\n\t\t\tconst sizesThisLine = sizes[lineIndex];\n\t\t\tconst positionsThisLine = positions[lineIndex];\n\t\t\tconst axisAOffset = (availableSpace[a.axis] - line[a.size]) * alignmentA + paddingA;\n\t\t\tconst axisBOffset = (availableSpace[b.axis] - lines[b.size]) * alignmentB + paddingB;\n\t\t\tfor (let elementIndex = 0; elementIndex < line.length; ++elementIndex) {\n\t\t\t\tconst withinLineAxisBOffset = (line[b.size] - sizesThisLine[elementIndex][b.size]) * options.alignment[b.axis];\n\t\t\t\tpositionsThisLine[elementIndex][a.axis] += axisAOffset;\n\t\t\t\tpositionsThisLine[elementIndex][b.axis] += axisBOffset + withinLineAxisBOffset;\n\t\t\t}\n\t\t}\n\t}\n\tfunction applySizesAndPositions(lines, sizes, positions) {\n\t\tfor (let lineIndex = 0; lineIndex < lines.length; ++lineIndex) {\n\t\t\tconst line = lines[lineIndex];\n\t\t\tconst sizesThisLine = sizes[lineIndex];\n\t\t\tconst positionsThisLine = positions[lineIndex];\n\t\t\tfor (let elementIndex = 0; elementIndex < line.length; ++elementIndex) {\n\t\t\t\tconst element = line[elementIndex];\n\t\t\t\telement[a.calculatedSize] = sizesThisLine[elementIndex][a.size];\n\t\t\t\telement[b.calculatedSize] = sizesThisLine[elementIndex][b.size];\n\t\t\t\tif (options.orientation === ORIENTATION_HORIZONTAL) {\n\t\t\t\t\telement.entity.setLocalPosition(positionsThisLine[elementIndex][a.axis], positionsThisLine[elementIndex][b.axis], element.entity.getLocalPosition().z);\n\t\t\t\t} else {\n\t\t\t\t\telement.entity.setLocalPosition(positionsThisLine[elementIndex][b.axis], positionsThisLine[elementIndex][a.axis], element.entity.getLocalPosition().z);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tfunction createLayoutInfo(lines) {\n\t\tconst layoutWidth = lines.width;\n\t\tconst layoutHeight = lines.height;\n\t\tconst xOffset = (availableSpace.x - layoutWidth) * options.alignment.x + options.padding.x;\n\t\tconst yOffset = (availableSpace.y - layoutHeight) * options.alignment.y + options.padding.y;\n\t\treturn {\n\t\t\tbounds: new Vec4(xOffset, yOffset, layoutWidth, layoutHeight)\n\t\t};\n\t}\n\tfunction getElementSizeProperties(elements) {\n\t\tconst sizeProperties = [];\n\t\tfor (let i = 0; i < elements.length; ++i) {\n\t\t\tconst element = elements[i];\n\t\t\tconst minWidth = Math.max(getProperty(element, 'minWidth'), 0);\n\t\t\tconst minHeight = Math.max(getProperty(element, 'minHeight'), 0);\n\t\t\tconst maxWidth = Math.max(getProperty(element, 'maxWidth'), minWidth);\n\t\t\tconst maxHeight = Math.max(getProperty(element, 'maxHeight'), minHeight);\n\t\t\tconst width = clamp(getProperty(element, 'width'), minWidth, maxWidth);\n\t\t\tconst height = clamp(getProperty(element, 'height'), minHeight, maxHeight);\n\t\t\tconst fitWidthProportion = getProperty(element, 'fitWidthProportion');\n\t\t\tconst fitHeightProportion = getProperty(element, 'fitHeightProportion');\n\t\t\tsizeProperties.push({\n\t\t\t\tminWidth: minWidth,\n\t\t\t\tminHeight: minHeight,\n\t\t\t\tmaxWidth: maxWidth,\n\t\t\t\tmaxHeight: maxHeight,\n\t\t\t\twidth: width,\n\t\t\t\theight: height,\n\t\t\t\tfitWidthProportion: fitWidthProportion,\n\t\t\t\tfitHeightProportion: fitHeightProportion\n\t\t\t});\n\t\t}\n\t\treturn sizeProperties;\n\t}\n\tfunction getProperty(element, propertyName) {\n\t\tconst layoutChildComponent = element.entity.layoutchild;\n\t\tif (layoutChildComponent && layoutChildComponent.enabled && layoutChildComponent[propertyName] !== undefined && layoutChildComponent[propertyName] !== null) {\n\t\t\treturn layoutChildComponent[propertyName];\n\t\t} else if (element[propertyName] !== undefined) {\n\t\t\treturn element[propertyName];\n\t\t}\n\t\treturn PROPERTY_DEFAULTS[propertyName];\n\t}\n\tfunction clamp(value, min, max) {\n\t\treturn Math.min(Math.max(value, min), max);\n\t}\n\tfunction sumValues(items, propertyName) {\n\t\treturn items.reduce(function (accumulator, current) {\n\t\t\treturn accumulator + current[propertyName];\n\t\t}, 0);\n\t}\n\tfunction getNormalizedValues(items, propertyName) {\n\t\tconst sum = sumValues(items, propertyName);\n\t\tconst normalizedValues = [];\n\t\tconst numItems = items.length;\n\t\tif (sum === 0) {\n\t\t\tfor (let i = 0; i < numItems; ++i) {\n\t\t\t\tnormalizedValues.push(1 / numItems);\n\t\t\t}\n\t\t} else {\n\t\t\tfor (let i = 0; i < numItems; ++i) {\n\t\t\t\tnormalizedValues.push(items[i][propertyName] / sum);\n\t\t\t}\n\t\t}\n\t\treturn normalizedValues;\n\t}\n\tfunction invertNormalizedValues(values) {\n\t\tif (values.length === 1) {\n\t\t\treturn [1];\n\t\t}\n\t\tconst invertedValues = [];\n\t\tconst numValues = values.length;\n\t\tfor (let i = 0; i < numValues; ++i) {\n\t\t\tinvertedValues.push((1 - values[i]) / (numValues - 1));\n\t\t}\n\t\treturn invertedValues;\n\t}\n\tfunction getTraversalOrder(items, orderBy, descending) {\n\t\titems.forEach(assignIndex);\n\t\treturn items.slice().sort(function (itemA, itemB) {\n\t\t\treturn descending ? itemB[orderBy] - itemA[orderBy] : itemA[orderBy] - itemB[orderBy];\n\t\t}).map(getIndex);\n\t}\n\tfunction assignIndex(item, index) {\n\t\titem.index = index;\n\t}\n\tfunction getIndex(item) {\n\t\treturn item.index;\n\t}\n\tfunction createSumArray(values, order) {\n\t\tconst sumArray = [];\n\t\tsumArray[order[values.length - 1]] = values[order[values.length - 1]];\n\t\tfor (let i = values.length - 2; i >= 0; --i) {\n\t\t\tsumArray[order[i]] = sumArray[order[i + 1]] + values[order[i]];\n\t\t}\n\t\treturn sumArray;\n\t}\n\treturn calculateAll;\n}\nconst CALCULATE_FNS = {};\nCALCULATE_FNS[ORIENTATION_HORIZONTAL] = createCalculator(ORIENTATION_HORIZONTAL);\nCALCULATE_FNS[ORIENTATION_VERTICAL] = createCalculator(ORIENTATION_VERTICAL);\nclass LayoutCalculator {\n\tcalculateLayout(elements, options) {\n\t\tconst calculateFn = CALCULATE_FNS[options.orientation];\n\t\tif (!calculateFn) {\n\t\t\tthrow new Error('Unrecognized orientation value: ' + options.orientation);\n\t\t} else {\n\t\t\treturn calculateFn(elements, options);\n\t\t}\n\t}\n}\n\nexport { LayoutCalculator };\n","import '../../../core/tracing.js';\nimport { Vec2 } from '../../../core/math/vec2.js';\nimport { Vec4 } from '../../../core/math/vec4.js';\nimport { ORIENTATION_HORIZONTAL } from '../../../scene/constants.js';\nimport { FITTING_NONE } from './constants.js';\nimport { Component } from '../component.js';\nimport { LayoutCalculator } from './layout-calculator.js';\n\nfunction getElement(entity) {\n\treturn entity.element;\n}\nfunction isEnabledAndHasEnabledElement(entity) {\n\treturn entity.enabled && entity.element && entity.element.enabled;\n}\nclass LayoutGroupComponent extends Component {\n\tconstructor(system, entity) {\n\t\tsuper(system, entity);\n\t\tthis._orientation = ORIENTATION_HORIZONTAL;\n\t\tthis._reverseX = false;\n\t\tthis._reverseY = true;\n\t\tthis._alignment = new Vec2(0, 1);\n\t\tthis._padding = new Vec4();\n\t\tthis._spacing = new Vec2();\n\t\tthis._widthFitting = FITTING_NONE;\n\t\tthis._heightFitting = FITTING_NONE;\n\t\tthis._wrap = false;\n\t\tthis._layoutCalculator = new LayoutCalculator();\n\t\tthis._listenForReflowEvents(this.entity, 'on');\n\t\tthis.entity.children.forEach(child => {\n\t\t\tthis._listenForReflowEvents(child, 'on');\n\t\t});\n\t\tthis.entity.on('childinsert', this._onChildInsert, this);\n\t\tthis.entity.on('childremove', this._onChildRemove, this);\n\t\tsystem.app.systems.element.on('add', this._onElementOrLayoutComponentAdd, this);\n\t\tsystem.app.systems.element.on('beforeremove', this._onElementOrLayoutComponentRemove, this);\n\t\tsystem.app.systems.layoutchild.on('add', this._onElementOrLayoutComponentAdd, this);\n\t\tsystem.app.systems.layoutchild.on('beforeremove', this._onElementOrLayoutComponentRemove, this);\n\t}\n\tset orientation(value) {\n\t\tif (value !== this._orientation) {\n\t\t\tthis._orientation = value;\n\t\t\tthis._scheduleReflow();\n\t\t}\n\t}\n\tget orientation() {\n\t\treturn this._orientation;\n\t}\n\tset reverseX(value) {\n\t\tif (value !== this._reverseX) {\n\t\t\tthis._reverseX = value;\n\t\t\tthis._scheduleReflow();\n\t\t}\n\t}\n\tget reverseX() {\n\t\treturn this._reverseX;\n\t}\n\tset reverseY(value) {\n\t\tif (value !== this._reverseY) {\n\t\t\tthis._reverseY = value;\n\t\t\tthis._scheduleReflow();\n\t\t}\n\t}\n\tget reverseY() {\n\t\treturn this._reverseY;\n\t}\n\tset alignment(value) {\n\t\tif (!value.equals(this._alignment)) {\n\t\t\tthis._alignment.copy(value);\n\t\t\tthis._scheduleReflow();\n\t\t}\n\t}\n\tget alignment() {\n\t\treturn this._alignment;\n\t}\n\tset padding(value) {\n\t\tif (!value.equals(this._padding)) {\n\t\t\tthis._padding.copy(value);\n\t\t\tthis._scheduleReflow();\n\t\t}\n\t}\n\tget padding() {\n\t\treturn this._padding;\n\t}\n\tset spacing(value) {\n\t\tif (!value.equals(this._spacing)) {\n\t\t\tthis._spacing.copy(value);\n\t\t\tthis._scheduleReflow();\n\t\t}\n\t}\n\tget spacing() {\n\t\treturn this._spacing;\n\t}\n\tset widthFitting(value) {\n\t\tif (value !== this._widthFitting) {\n\t\t\tthis._widthFitting = value;\n\t\t\tthis._scheduleReflow();\n\t\t}\n\t}\n\tget widthFitting() {\n\t\treturn this._widthFitting;\n\t}\n\tset heightFitting(value) {\n\t\tif (value !== this._heightFitting) {\n\t\t\tthis._heightFitting = value;\n\t\t\tthis._scheduleReflow();\n\t\t}\n\t}\n\tget heightFitting() {\n\t\treturn this._heightFitting;\n\t}\n\tset wrap(value) {\n\t\tif (value !== this._wrap) {\n\t\t\tthis._wrap = value;\n\t\t\tthis._scheduleReflow();\n\t\t}\n\t}\n\tget wrap() {\n\t\treturn this._wrap;\n\t}\n\t_isSelfOrChild(entity) {\n\t\treturn entity === this.entity || this.entity.children.indexOf(entity) !== -1;\n\t}\n\t_listenForReflowEvents(target, onOff) {\n\t\tif (target.element) {\n\t\t\ttarget.element[onOff]('enableelement', this._scheduleReflow, this);\n\t\t\ttarget.element[onOff]('disableelement', this._scheduleReflow, this);\n\t\t\ttarget.element[onOff]('resize', this._scheduleReflow, this);\n\t\t\ttarget.element[onOff]('set:pivot', this._scheduleReflow, this);\n\t\t}\n\t\tif (target.layoutchild) {\n\t\t\ttarget.layoutchild[onOff]('set_enabled', this._scheduleReflow, this);\n\t\t\ttarget.layoutchild[onOff]('resize', this._scheduleReflow, this);\n\t\t}\n\t}\n\t_onElementOrLayoutComponentAdd(entity) {\n\t\tif (this._isSelfOrChild(entity)) {\n\t\t\tthis._listenForReflowEvents(entity, 'on');\n\t\t\tthis._scheduleReflow();\n\t\t}\n\t}\n\t_onElementOrLayoutComponentRemove(entity) {\n\t\tif (this._isSelfOrChild(entity)) {\n\t\t\tthis._listenForReflowEvents(entity, 'off');\n\t\t\tthis._scheduleReflow();\n\t\t}\n\t}\n\t_onChildInsert(child) {\n\t\tthis._listenForReflowEvents(child, 'on');\n\t\tthis._scheduleReflow();\n\t}\n\t_onChildRemove(child) {\n\t\tthis._listenForReflowEvents(child, 'off');\n\t\tthis._scheduleReflow();\n\t}\n\t_scheduleReflow() {\n\t\tif (this.enabled && this.entity && this.entity.enabled && !this._isPerformingReflow) {\n\t\t\tthis.system.scheduleReflow(this);\n\t\t}\n\t}\n\treflow() {\n\t\tconst container = getElement(this.entity);\n\t\tconst elements = this.entity.children.filter(isEnabledAndHasEnabledElement).map(getElement);\n\t\tif (!container || elements.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\tconst containerWidth = Math.max(container.calculatedWidth, 0);\n\t\tconst containerHeight = Math.max(container.calculatedHeight, 0);\n\t\tconst options = {\n\t\t\torientation: this._orientation,\n\t\t\treverseX: this._reverseX,\n\t\t\treverseY: this._reverseY,\n\t\t\talignment: this._alignment,\n\t\t\tpadding: this._padding,\n\t\t\tspacing: this._spacing,\n\t\t\twidthFitting: this._widthFitting,\n\t\t\theightFitting: this._heightFitting,\n\t\t\twrap: this._wrap,\n\t\t\tcontainerSize: new Vec2(containerWidth, containerHeight)\n\t\t};\n\t\tthis._isPerformingReflow = true;\n\t\tconst layoutInfo = this._layoutCalculator.calculateLayout(elements, options);\n\t\tthis._isPerformingReflow = false;\n\t\tthis.fire('reflow', layoutInfo);\n\t}\n\tonEnable() {\n\t\tthis._scheduleReflow();\n\t}\n\tonRemove() {\n\t\tthis.entity.off('childinsert', this._onChildInsert, this);\n\t\tthis.entity.off('childremove', this._onChildRemove, this);\n\t\tthis._listenForReflowEvents(this.entity, 'off');\n\t\tthis.entity.children.forEach(child => {\n\t\t\tthis._listenForReflowEvents(child, 'off');\n\t\t});\n\t\tthis.system.app.systems.element.off('add', this._onElementOrLayoutComponentAdd, this);\n\t\tthis.system.app.systems.element.off('beforeremove', this._onElementOrLayoutComponentRemove, this);\n\t\tthis.system.app.systems.layoutchild.off('add', this._onElementOrLayoutComponentAdd, this);\n\t\tthis.system.app.systems.layoutchild.off('beforeremove', this._onElementOrLayoutComponentRemove, this);\n\t}\n}\n\nexport { LayoutGroupComponent };\n","class LayoutGroupComponentData {\n\tconstructor() {\n\t\tthis.enabled = true;\n\t}\n}\n\nexport { LayoutGroupComponentData };\n","import { Vec2 } from '../../../core/math/vec2.js';\nimport { Vec4 } from '../../../core/math/vec4.js';\nimport { Component } from '../component.js';\nimport { ComponentSystem } from '../system.js';\nimport { LayoutGroupComponent } from './component.js';\nimport { LayoutGroupComponentData } from './data.js';\n\nconst _schema = ['enabled'];\nconst MAX_ITERATIONS = 100;\nclass LayoutGroupComponentSystem extends ComponentSystem {\n\tconstructor(app) {\n\t\tsuper(app);\n\t\tthis.id = 'layoutgroup';\n\t\tthis.ComponentType = LayoutGroupComponent;\n\t\tthis.DataType = LayoutGroupComponentData;\n\t\tthis.schema = _schema;\n\t\tthis._reflowQueue = [];\n\t\tthis.on('beforeremove', this._onRemoveComponent, this);\n\t\tthis.app.systems.on('postUpdate', this._onPostUpdate, this);\n\t}\n\tinitializeComponentData(component, data, properties) {\n\t\tif (data.enabled !== undefined) component.enabled = data.enabled;\n\t\tif (data.orientation !== undefined) component.orientation = data.orientation;\n\t\tif (data.reverseX !== undefined) component.reverseX = data.reverseX;\n\t\tif (data.reverseY !== undefined) component.reverseY = data.reverseY;\n\t\tif (data.alignment !== undefined) {\n\t\t\tcomponent.alignment = Array.isArray(data.alignment) ? new Vec2(data.alignment) : data.alignment;\n\t\t}\n\t\tif (data.padding !== undefined) {\n\t\t\tcomponent.padding = Array.isArray(data.padding) ? new Vec4(data.padding) : data.padding;\n\t\t}\n\t\tif (data.spacing !== undefined) {\n\t\t\tcomponent.spacing = Array.isArray(data.spacing) ? new Vec2(data.spacing) : data.spacing;\n\t\t}\n\t\tif (data.widthFitting !== undefined) component.widthFitting = data.widthFitting;\n\t\tif (data.heightFitting !== undefined) component.heightFitting = data.heightFitting;\n\t\tif (data.wrap !== undefined) component.wrap = data.wrap;\n\t\tsuper.initializeComponentData(component, data, properties);\n\t}\n\tcloneComponent(entity, clone) {\n\t\tconst layoutGroup = entity.layoutgroup;\n\t\treturn this.addComponent(clone, {\n\t\t\tenabled: layoutGroup.enabled,\n\t\t\torientation: layoutGroup.orientation,\n\t\t\treverseX: layoutGroup.reverseX,\n\t\t\treverseY: layoutGroup.reverseY,\n\t\t\talignment: layoutGroup.alignment,\n\t\t\tpadding: layoutGroup.padding,\n\t\t\tspacing: layoutGroup.spacing,\n\t\t\twidthFitting: layoutGroup.widthFitting,\n\t\t\theightFitting: layoutGroup.heightFitting,\n\t\t\twrap: layoutGroup.wrap\n\t\t});\n\t}\n\tscheduleReflow(component) {\n\t\tif (this._reflowQueue.indexOf(component) === -1) {\n\t\t\tthis._reflowQueue.push(component);\n\t\t}\n\t}\n\t_onPostUpdate() {\n\t\tthis._processReflowQueue();\n\t}\n\t_processReflowQueue() {\n\t\tif (this._reflowQueue.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\tlet iterationCount = 0;\n\t\twhile (this._reflowQueue.length > 0) {\n\t\t\tconst queue = this._reflowQueue.slice();\n\t\t\tthis._reflowQueue.length = 0;\n\t\t\tqueue.sort(function (componentA, componentB) {\n\t\t\t\treturn componentA.entity.graphDepth - componentB.entity.graphDepth;\n\t\t\t});\n\t\t\tfor (let i = 0; i < queue.length; ++i) {\n\t\t\t\tqueue[i].reflow();\n\t\t\t}\n\t\t\tif (++iterationCount >= MAX_ITERATIONS) {\n\t\t\t\tconsole.warn('Max reflow iterations limit reached, bailing.');\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\t_onRemoveComponent(entity, component) {\n\t\tcomponent.onRemove();\n\t}\n\tdestroy() {\n\t\tsuper.destroy();\n\t\tthis.app.systems.off('postUpdate', this._onPostUpdate, this);\n\t}\n}\nComponent._buildAccessors(LayoutGroupComponent.prototype, _schema);\n\nexport { LayoutGroupComponentSystem };\n","import '../../../core/tracing.js';\nimport { LAYERID_WORLD } from '../../../scene/constants.js';\nimport { BatchGroup } from '../../../scene/batching/batch-group.js';\nimport { GraphNode } from '../../../scene/graph-node.js';\nimport { MeshInstance } from '../../../scene/mesh-instance.js';\nimport { Model } from '../../../scene/model.js';\nimport { getShapePrimitive } from '../../../scene/procedural.js';\nimport { Asset } from '../../asset/asset.js';\nimport { Component } from '../component.js';\n\nclass ModelComponent extends Component {\n\tconstructor(system, entity) {\n\t\tsuper(system, entity);\n\t\tthis._type = 'asset';\n\t\tthis._asset = null;\n\t\tthis._model = null;\n\t\tthis._mapping = {};\n\t\tthis._castShadows = true;\n\t\tthis._receiveShadows = true;\n\t\tthis._materialAsset = null;\n\t\tthis._material = void 0;\n\t\tthis._castShadowsLightmap = true;\n\t\tthis._lightmapped = false;\n\t\tthis._lightmapSizeMultiplier = 1;\n\t\tthis.isStatic = false;\n\t\tthis._layers = [LAYERID_WORLD];\n\t\tthis._batchGroupId = -1;\n\t\tthis._customAabb = null;\n\t\tthis._area = null;\n\t\tthis._materialEvents = null;\n\t\tthis._clonedModel = false;\n\t\tthis._material = system.defaultMaterial;\n\t\tentity.on('remove', this.onRemoveChild, this);\n\t\tentity.on('removehierarchy', this.onRemoveChild, this);\n\t\tentity.on('insert', this.onInsertChild, this);\n\t\tentity.on('inserthierarchy', this.onInsertChild, this);\n\t}\n\tset meshInstances(value) {\n\t\tif (!this._model) return;\n\t\tthis._model.meshInstances = value;\n\t}\n\tget meshInstances() {\n\t\tif (!this._model) return null;\n\t\treturn this._model.meshInstances;\n\t}\n\tset customAabb(value) {\n\t\tthis._customAabb = value;\n\t\tif (this._model) {\n\t\t\tconst mi = this._model.meshInstances;\n\t\t\tif (mi) {\n\t\t\t\tfor (let i = 0; i < mi.length; i++) {\n\t\t\t\t\tmi[i].setCustomAabb(this._customAabb);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tget customAabb() {\n\t\treturn this._customAabb;\n\t}\n\tset type(value) {\n\t\tif (this._type === value) return;\n\t\tthis._area = null;\n\t\tthis._type = value;\n\t\tif (value === 'asset') {\n\t\t\tif (this._asset !== null) {\n\t\t\t\tthis._bindModelAsset(this._asset);\n\t\t\t} else {\n\t\t\t\tthis.model = null;\n\t\t\t}\n\t\t} else {\n\t\t\tconst primData = getShapePrimitive(this.system.app.graphicsDevice, value);\n\t\t\tthis._area = primData.area;\n\t\t\tconst mesh = primData.mesh;\n\t\t\tconst node = new GraphNode();\n\t\t\tconst model = new Model();\n\t\t\tmodel.graph = node;\n\t\t\tmodel.meshInstances = [new MeshInstance(mesh, this._material, node)];\n\t\t\tthis.model = model;\n\t\t\tthis._asset = null;\n\t\t}\n\t}\n\tget type() {\n\t\treturn this._type;\n\t}\n\tset asset(value) {\n\t\tconst assets = this.system.app.assets;\n\t\tlet _id = value;\n\t\tif (value instanceof Asset) {\n\t\t\t_id = value.id;\n\t\t}\n\t\tif (this._asset !== _id) {\n\t\t\tif (this._asset) {\n\t\t\t\tassets.off('add:' + this._asset, this._onModelAssetAdded, this);\n\t\t\t\tconst _prev = assets.get(this._asset);\n\t\t\t\tif (_prev) {\n\t\t\t\t\tthis._unbindModelAsset(_prev);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._asset = _id;\n\t\t\tif (this._asset) {\n\t\t\t\tconst asset = assets.get(this._asset);\n\t\t\t\tif (!asset) {\n\t\t\t\t\tthis.model = null;\n\t\t\t\t\tassets.on('add:' + this._asset, this._onModelAssetAdded, this);\n\t\t\t\t} else {\n\t\t\t\t\tthis._bindModelAsset(asset);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.model = null;\n\t\t\t}\n\t\t}\n\t}\n\tget asset() {\n\t\treturn this._asset;\n\t}\n\tset model(value) {\n\t\tif (this._model === value) return;\n\t\tif (value && value._immutable) {\n\t\t\treturn;\n\t\t}\n\t\tif (this._model) {\n\t\t\tthis._model._immutable = false;\n\t\t\tthis.removeModelFromLayers();\n\t\t\tthis._model.getGraph().destroy();\n\t\t\tdelete this._model._entity;\n\t\t\tif (this._clonedModel) {\n\t\t\t\tthis._model.destroy();\n\t\t\t\tthis._clonedModel = false;\n\t\t\t}\n\t\t}\n\t\tthis._model = value;\n\t\tif (this._model) {\n\t\t\tthis._model._immutable = true;\n\t\t\tconst meshInstances = this._model.meshInstances;\n\t\t\tfor (let i = 0; i < meshInstances.length; i++) {\n\t\t\t\tmeshInstances[i].castShadow = this._castShadows;\n\t\t\t\tmeshInstances[i].receiveShadow = this._receiveShadows;\n\t\t\t\tmeshInstances[i].setCustomAabb(this._customAabb);\n\t\t\t}\n\t\t\tthis.lightmapped = this._lightmapped;\n\t\t\tthis.entity.addChild(this._model.graph);\n\t\t\tif (this.enabled && this.entity.enabled) {\n\t\t\t\tthis.addModelToLayers();\n\t\t\t}\n\t\t\tthis._model._entity = this.entity;\n\t\t\tif (this.entity.animation) this.entity.animation.setModel(this._model);\n\t\t\tif (this.entity.anim) {\n\t\t\t\tthis.entity.anim.rebind();\n\t\t\t}\n\t\t\tif (this.type === 'asset') {\n\t\t\t\tthis.mapping = this._mapping;\n\t\t\t} else {\n\t\t\t\tthis._unsetMaterialEvents();\n\t\t\t}\n\t\t}\n\t}\n\tget model() {\n\t\treturn this._model;\n\t}\n\tset lightmapped(value) {\n\t\tif (value !== this._lightmapped) {\n\t\t\tthis._lightmapped = value;\n\t\t\tif (this._model) {\n\t\t\t\tconst mi = this._model.meshInstances;\n\t\t\t\tfor (let i = 0; i < mi.length; i++) {\n\t\t\t\t\tmi[i].setLightmapped(value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tget lightmapped() {\n\t\treturn this._lightmapped;\n\t}\n\tset castShadows(value) {\n\t\tif (this._castShadows === value) return;\n\t\tconst model = this._model;\n\t\tif (model) {\n\t\t\tconst layers = this.layers;\n\t\t\tconst scene = this.system.app.scene;\n\t\t\tif (this._castShadows && !value) {\n\t\t\t\tfor (let i = 0; i < layers.length; i++) {\n\t\t\t\t\tconst layer = this.system.app.scene.layers.getLayerById(this.layers[i]);\n\t\t\t\t\tif (!layer) continue;\n\t\t\t\t\tlayer.removeShadowCasters(model.meshInstances);\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst meshInstances = model.meshInstances;\n\t\t\tfor (let i = 0; i < meshInstances.length; i++) {\n\t\t\t\tmeshInstances[i].castShadow = value;\n\t\t\t}\n\t\t\tif (!this._castShadows && value) {\n\t\t\t\tfor (let i = 0; i < layers.length; i++) {\n\t\t\t\t\tconst layer = scene.layers.getLayerById(layers[i]);\n\t\t\t\t\tif (!layer) continue;\n\t\t\t\t\tlayer.addShadowCasters(model.meshInstances);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis._castShadows = value;\n\t}\n\tget castShadows() {\n\t\treturn this._castShadows;\n\t}\n\tset receiveShadows(value) {\n\t\tif (this._receiveShadows === value) return;\n\t\tthis._receiveShadows = value;\n\t\tif (this._model) {\n\t\t\tconst meshInstances = this._model.meshInstances;\n\t\t\tfor (let i = 0, len = meshInstances.length; i < len; i++) {\n\t\t\t\tmeshInstances[i].receiveShadow = value;\n\t\t\t}\n\t\t}\n\t}\n\tget receiveShadows() {\n\t\treturn this._receiveShadows;\n\t}\n\tset castShadowsLightmap(value) {\n\t\tthis._castShadowsLightmap = value;\n\t}\n\tget castShadowsLightmap() {\n\t\treturn this._castShadowsLightmap;\n\t}\n\tset lightmapSizeMultiplier(value) {\n\t\tthis._lightmapSizeMultiplier = value;\n\t}\n\tget lightmapSizeMultiplier() {\n\t\treturn this._lightmapSizeMultiplier;\n\t}\n\tset layers(value) {\n\t\tconst layers = this.system.app.scene.layers;\n\t\tif (this.meshInstances) {\n\t\t\tfor (let i = 0; i < this._layers.length; i++) {\n\t\t\t\tconst layer = layers.getLayerById(this._layers[i]);\n\t\t\t\tif (!layer) continue;\n\t\t\t\tlayer.removeMeshInstances(this.meshInstances);\n\t\t\t}\n\t\t}\n\t\tthis._layers.length = 0;\n\t\tfor (let i = 0; i < value.length; i++) {\n\t\t\tthis._layers[i] = value[i];\n\t\t}\n\t\tif (!this.enabled || !this.entity.enabled || !this.meshInstances) return;\n\t\tfor (let i = 0; i < this._layers.length; i++) {\n\t\t\tconst layer = layers.getLayerById(this._layers[i]);\n\t\t\tif (!layer) continue;\n\t\t\tlayer.addMeshInstances(this.meshInstances);\n\t\t}\n\t}\n\tget layers() {\n\t\treturn this._layers;\n\t}\n\tset batchGroupId(value) {\n\t\tif (this._batchGroupId === value) return;\n\t\tif (this.entity.enabled && this._batchGroupId >= 0) {\n\t\t\tvar _this$system$app$batc;\n\t\t\t(_this$system$app$batc = this.system.app.batcher) == null || _this$system$app$batc.remove(BatchGroup.MODEL, this.batchGroupId, this.entity);\n\t\t}\n\t\tif (this.entity.enabled && value >= 0) {\n\t\t\tvar _this$system$app$batc2;\n\t\t\t(_this$system$app$batc2 = this.system.app.batcher) == null || _this$system$app$batc2.insert(BatchGroup.MODEL, value, this.entity);\n\t\t}\n\t\tif (value < 0 && this._batchGroupId >= 0 && this.enabled && this.entity.enabled) {\n\t\t\tthis.addModelToLayers();\n\t\t}\n\t\tthis._batchGroupId = value;\n\t}\n\tget batchGroupId() {\n\t\treturn this._batchGroupId;\n\t}\n\tset materialAsset(value) {\n\t\tlet _id = value;\n\t\tif (value instanceof Asset) {\n\t\t\t_id = value.id;\n\t\t}\n\t\tconst assets = this.system.app.assets;\n\t\tif (_id !== this._materialAsset) {\n\t\t\tif (this._materialAsset) {\n\t\t\t\tassets.off('add:' + this._materialAsset, this._onMaterialAssetAdd, this);\n\t\t\t\tconst _prev = assets.get(this._materialAsset);\n\t\t\t\tif (_prev) {\n\t\t\t\t\tthis._unbindMaterialAsset(_prev);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._materialAsset = _id;\n\t\t\tif (this._materialAsset) {\n\t\t\t\tconst asset = assets.get(this._materialAsset);\n\t\t\t\tif (!asset) {\n\t\t\t\t\tthis._setMaterial(this.system.defaultMaterial);\n\t\t\t\t\tassets.on('add:' + this._materialAsset, this._onMaterialAssetAdd, this);\n\t\t\t\t} else {\n\t\t\t\t\tthis._bindMaterialAsset(asset);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._setMaterial(this.system.defaultMaterial);\n\t\t\t}\n\t\t}\n\t}\n\tget materialAsset() {\n\t\treturn this._materialAsset;\n\t}\n\tset material(value) {\n\t\tif (this._material === value) return;\n\t\tthis.materialAsset = null;\n\t\tthis._setMaterial(value);\n\t}\n\tget material() {\n\t\treturn this._material;\n\t}\n\tset mapping(value) {\n\t\tif (this._type !== 'asset') return;\n\t\tthis._unsetMaterialEvents();\n\t\tif (!value) value = {};\n\t\tthis._mapping = value;\n\t\tif (!this._model) return;\n\t\tconst meshInstances = this._model.meshInstances;\n\t\tconst modelAsset = this.asset ? this.system.app.assets.get(this.asset) : null;\n\t\tconst assetMapping = modelAsset ? modelAsset.data.mapping : null;\n\t\tlet asset = null;\n\t\tfor (let i = 0, len = meshInstances.length; i < len; i++) {\n\t\t\tif (value[i] !== undefined) {\n\t\t\t\tif (value[i]) {\n\t\t\t\t\tasset = this.system.app.assets.get(value[i]);\n\t\t\t\t\tthis._loadAndSetMeshInstanceMaterial(asset, meshInstances[i], i);\n\t\t\t\t} else {\n\t\t\t\t\tmeshInstances[i].material = this.system.defaultMaterial;\n\t\t\t\t}\n\t\t\t} else if (assetMapping) {\n\t\t\t\tif (assetMapping[i] && (assetMapping[i].material || assetMapping[i].path)) {\n\t\t\t\t\tif (assetMapping[i].material !== undefined) {\n\t\t\t\t\t\tasset = this.system.app.assets.get(assetMapping[i].material);\n\t\t\t\t\t} else if (assetMapping[i].path !== undefined) {\n\t\t\t\t\t\tconst url = this._getMaterialAssetUrl(assetMapping[i].path);\n\t\t\t\t\t\tif (url) {\n\t\t\t\t\t\t\tasset = this.system.app.assets.getByUrl(url);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis._loadAndSetMeshInstanceMaterial(asset, meshInstances[i], i);\n\t\t\t\t} else {\n\t\t\t\t\tmeshInstances[i].material = this.system.defaultMaterial;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tget mapping() {\n\t\treturn this._mapping;\n\t}\n\taddModelToLayers() {\n\t\tconst layers = this.system.app.scene.layers;\n\t\tfor (let i = 0; i < this._layers.length; i++) {\n\t\t\tconst layer = layers.getLayerById(this._layers[i]);\n\t\t\tif (layer) {\n\t\t\t\tlayer.addMeshInstances(this.meshInstances);\n\t\t\t}\n\t\t}\n\t}\n\tremoveModelFromLayers() {\n\t\tconst layers = this.system.app.scene.layers;\n\t\tfor (let i = 0; i < this._layers.length; i++) {\n\t\t\tconst layer = layers.getLayerById(this._layers[i]);\n\t\t\tif (!layer) continue;\n\t\t\tlayer.removeMeshInstances(this.meshInstances);\n\t\t}\n\t}\n\tonRemoveChild() {\n\t\tif (this._model) this.removeModelFromLayers();\n\t}\n\tonInsertChild() {\n\t\tif (this._model && this.enabled && this.entity.enabled) this.addModelToLayers();\n\t}\n\tonRemove() {\n\t\tthis.asset = null;\n\t\tthis.model = null;\n\t\tthis.materialAsset = null;\n\t\tthis._unsetMaterialEvents();\n\t\tthis.entity.off('remove', this.onRemoveChild, this);\n\t\tthis.entity.off('insert', this.onInsertChild, this);\n\t}\n\tonLayersChanged(oldComp, newComp) {\n\t\tthis.addModelToLayers();\n\t\toldComp.off('add', this.onLayerAdded, this);\n\t\toldComp.off('remove', this.onLayerRemoved, this);\n\t\tnewComp.on('add', this.onLayerAdded, this);\n\t\tnewComp.on('remove', this.onLayerRemoved, this);\n\t}\n\tonLayerAdded(layer) {\n\t\tconst index = this.layers.indexOf(layer.id);\n\t\tif (index < 0) return;\n\t\tlayer.addMeshInstances(this.meshInstances);\n\t}\n\tonLayerRemoved(layer) {\n\t\tconst index = this.layers.indexOf(layer.id);\n\t\tif (index < 0) return;\n\t\tlayer.removeMeshInstances(this.meshInstances);\n\t}\n\t_setMaterialEvent(index, event, id, handler) {\n\t\tconst evt = event + ':' + id;\n\t\tthis.system.app.assets.on(evt, handler, this);\n\t\tif (!this._materialEvents) this._materialEvents = [];\n\t\tif (!this._materialEvents[index]) this._materialEvents[index] = {};\n\t\tthis._materialEvents[index][evt] = {\n\t\t\tid: id,\n\t\t\thandler: handler\n\t\t};\n\t}\n\t_unsetMaterialEvents() {\n\t\tconst assets = this.system.app.assets;\n\t\tconst events = this._materialEvents;\n\t\tif (!events) return;\n\t\tfor (let i = 0, len = events.length; i < len; i++) {\n\t\t\tif (!events[i]) continue;\n\t\t\tconst evt = events[i];\n\t\t\tfor (const key in evt) {\n\t\t\t\tassets.off(key, evt[key].handler, this);\n\t\t\t}\n\t\t}\n\t\tthis._materialEvents = null;\n\t}\n\t_getAssetByIdOrPath(idOrPath) {\n\t\tlet asset = null;\n\t\tconst isPath = isNaN(parseInt(idOrPath, 10));\n\t\tif (!isPath) {\n\t\t\tasset = this.system.app.assets.get(idOrPath);\n\t\t} else if (this.asset) {\n\t\t\tconst url = this._getMaterialAssetUrl(idOrPath);\n\t\t\tif (url) asset = this.system.app.assets.getByUrl(url);\n\t\t}\n\t\treturn asset;\n\t}\n\t_getMaterialAssetUrl(path) {\n\t\tif (!this.asset) return null;\n\t\tconst modelAsset = this.system.app.assets.get(this.asset);\n\t\treturn modelAsset ? modelAsset.getAbsoluteUrl(path) : null;\n\t}\n\t_loadAndSetMeshInstanceMaterial(materialAsset, meshInstance, index) {\n\t\tconst assets = this.system.app.assets;\n\t\tif (!materialAsset) return;\n\t\tif (materialAsset.resource) {\n\t\t\tmeshInstance.material = materialAsset.resource;\n\t\t\tthis._setMaterialEvent(index, 'remove', materialAsset.id, function () {\n\t\t\t\tmeshInstance.material = this.system.defaultMaterial;\n\t\t\t});\n\t\t} else {\n\t\t\tthis._setMaterialEvent(index, 'load', materialAsset.id, function (asset) {\n\t\t\t\tmeshInstance.material = asset.resource;\n\t\t\t\tthis._setMaterialEvent(index, 'remove', materialAsset.id, function () {\n\t\t\t\t\tmeshInstance.material = this.system.defaultMaterial;\n\t\t\t\t});\n\t\t\t});\n\t\t\tif (this.enabled && this.entity.enabled) assets.load(materialAsset);\n\t\t}\n\t}\n\tonEnable() {\n\t\tconst app = this.system.app;\n\t\tconst scene = app.scene;\n\t\tscene.on('set:layers', this.onLayersChanged, this);\n\t\tif (scene.layers) {\n\t\t\tscene.layers.on('add', this.onLayerAdded, this);\n\t\t\tscene.layers.on('remove', this.onLayerRemoved, this);\n\t\t}\n\t\tconst isAsset = this._type === 'asset';\n\t\tlet asset;\n\t\tif (this._model) {\n\t\t\tthis.addModelToLayers();\n\t\t} else if (isAsset && this._asset) {\n\t\t\tasset = app.assets.get(this._asset);\n\t\t\tif (asset && asset.resource !== this._model) {\n\t\t\t\tthis._bindModelAsset(asset);\n\t\t\t}\n\t\t}\n\t\tif (this._materialAsset) {\n\t\t\tasset = app.assets.get(this._materialAsset);\n\t\t\tif (asset && asset.resource !== this._material) {\n\t\t\t\tthis._bindMaterialAsset(asset);\n\t\t\t}\n\t\t}\n\t\tif (isAsset) {\n\t\t\tif (this._mapping) {\n\t\t\t\tfor (const index in this._mapping) {\n\t\t\t\t\tif (this._mapping[index]) {\n\t\t\t\t\t\tasset = this._getAssetByIdOrPath(this._mapping[index]);\n\t\t\t\t\t\tif (asset && !asset.resource) {\n\t\t\t\t\t\t\tapp.assets.load(asset);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (this._batchGroupId >= 0) {\n\t\t\tvar _app$batcher;\n\t\t\t(_app$batcher = app.batcher) == null || _app$batcher.insert(BatchGroup.MODEL, this.batchGroupId, this.entity);\n\t\t}\n\t}\n\tonDisable() {\n\t\tconst app = this.system.app;\n\t\tconst scene = app.scene;\n\t\tscene.off('set:layers', this.onLayersChanged, this);\n\t\tif (scene.layers) {\n\t\t\tscene.layers.off('add', this.onLayerAdded, this);\n\t\t\tscene.layers.off('remove', this.onLayerRemoved, this);\n\t\t}\n\t\tif (this._batchGroupId >= 0) {\n\t\t\tvar _app$batcher2;\n\t\t\t(_app$batcher2 = app.batcher) == null || _app$batcher2.remove(BatchGroup.MODEL, this.batchGroupId, this.entity);\n\t\t}\n\t\tif (this._model) {\n\t\t\tthis.removeModelFromLayers();\n\t\t}\n\t}\n\thide() {\n\t\tif (this._model) {\n\t\t\tconst instances = this._model.meshInstances;\n\t\t\tfor (let i = 0, l = instances.length; i < l; i++) {\n\t\t\t\tinstances[i].visible = false;\n\t\t\t}\n\t\t}\n\t}\n\tshow() {\n\t\tif (this._model) {\n\t\t\tconst instances = this._model.meshInstances;\n\t\t\tfor (let i = 0, l = instances.length; i < l; i++) {\n\t\t\t\tinstances[i].visible = true;\n\t\t\t}\n\t\t}\n\t}\n\t_bindMaterialAsset(asset) {\n\t\tasset.on('load', this._onMaterialAssetLoad, this);\n\t\tasset.on('unload', this._onMaterialAssetUnload, this);\n\t\tasset.on('remove', this._onMaterialAssetRemove, this);\n\t\tasset.on('change', this._onMaterialAssetChange, this);\n\t\tif (asset.resource) {\n\t\t\tthis._onMaterialAssetLoad(asset);\n\t\t} else {\n\t\t\tif (!this.enabled || !this.entity.enabled) return;\n\t\t\tthis.system.app.assets.load(asset);\n\t\t}\n\t}\n\t_unbindMaterialAsset(asset) {\n\t\tasset.off('load', this._onMaterialAssetLoad, this);\n\t\tasset.off('unload', this._onMaterialAssetUnload, this);\n\t\tasset.off('remove', this._onMaterialAssetRemove, this);\n\t\tasset.off('change', this._onMaterialAssetChange, this);\n\t}\n\t_onMaterialAssetAdd(asset) {\n\t\tthis.system.app.assets.off('add:' + asset.id, this._onMaterialAssetAdd, this);\n\t\tif (this._materialAsset === asset.id) {\n\t\t\tthis._bindMaterialAsset(asset);\n\t\t}\n\t}\n\t_onMaterialAssetLoad(asset) {\n\t\tthis._setMaterial(asset.resource);\n\t}\n\t_onMaterialAssetUnload(asset) {\n\t\tthis._setMaterial(this.system.defaultMaterial);\n\t}\n\t_onMaterialAssetRemove(asset) {\n\t\tthis._onMaterialAssetUnload(asset);\n\t}\n\t_onMaterialAssetChange(asset) {}\n\t_bindModelAsset(asset) {\n\t\tthis._unbindModelAsset(asset);\n\t\tasset.on('load', this._onModelAssetLoad, this);\n\t\tasset.on('unload', this._onModelAssetUnload, this);\n\t\tasset.on('change', this._onModelAssetChange, this);\n\t\tasset.on('remove', this._onModelAssetRemove, this);\n\t\tif (asset.resource) {\n\t\t\tthis._onModelAssetLoad(asset);\n\t\t} else {\n\t\t\tif (!this.enabled || !this.entity.enabled) return;\n\t\t\tthis.system.app.assets.load(asset);\n\t\t}\n\t}\n\t_unbindModelAsset(asset) {\n\t\tasset.off('load', this._onModelAssetLoad, this);\n\t\tasset.off('unload', this._onModelAssetUnload, this);\n\t\tasset.off('change', this._onModelAssetChange, this);\n\t\tasset.off('remove', this._onModelAssetRemove, this);\n\t}\n\t_onModelAssetAdded(asset) {\n\t\tthis.system.app.assets.off('add:' + asset.id, this._onModelAssetAdded, this);\n\t\tif (asset.id === this._asset) {\n\t\t\tthis._bindModelAsset(asset);\n\t\t}\n\t}\n\t_onModelAssetLoad(asset) {\n\t\tthis.model = asset.resource.clone();\n\t\tthis._clonedModel = true;\n\t}\n\t_onModelAssetUnload(asset) {\n\t\tthis.model = null;\n\t}\n\t_onModelAssetChange(asset, attr, _new, _old) {\n\t\tif (attr === 'data') {\n\t\t\tthis.mapping = this._mapping;\n\t\t}\n\t}\n\t_onModelAssetRemove(asset) {\n\t\tthis.model = null;\n\t}\n\t_setMaterial(material) {\n\t\tif (this._material === material) return;\n\t\tthis._material = material;\n\t\tconst model = this._model;\n\t\tif (model && this._type !== 'asset') {\n\t\t\tconst meshInstances = model.meshInstances;\n\t\t\tfor (let i = 0, len = meshInstances.length; i < len; i++) {\n\t\t\t\tmeshInstances[i].material = material;\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport { ModelComponent };\n","class ModelComponentData {\n\tconstructor() {\n\t\tthis.enabled = true;\n\t}\n}\n\nexport { ModelComponentData };\n","import { extend } from '../../../core/core.js';\nimport { Vec3 } from '../../../core/math/vec3.js';\nimport { BoundingBox } from '../../../core/shape/bounding-box.js';\nimport { getDefaultMaterial } from '../../../scene/materials/default-material.js';\nimport { Asset } from '../../asset/asset.js';\nimport { Component } from '../component.js';\nimport { ComponentSystem } from '../system.js';\nimport { ModelComponent } from './component.js';\nimport { ModelComponentData } from './data.js';\n\nconst _schema = ['enabled'];\nclass ModelComponentSystem extends ComponentSystem {\n\tconstructor(app) {\n\t\tsuper(app);\n\t\tthis.id = 'model';\n\t\tthis.ComponentType = ModelComponent;\n\t\tthis.DataType = ModelComponentData;\n\t\tthis.schema = _schema;\n\t\tthis.defaultMaterial = getDefaultMaterial(app.graphicsDevice);\n\t\tthis.on('beforeremove', this.onRemove, this);\n\t}\n\tinitializeComponentData(component, _data, properties) {\n\t\tproperties = ['material', 'materialAsset', 'asset', 'castShadows', 'receiveShadows', 'castShadowsLightmap', 'lightmapped', 'lightmapSizeMultiplier', 'type', 'mapping', 'layers', 'isStatic', 'batchGroupId'];\n\t\tif (_data.batchGroupId === null || _data.batchGroupId === undefined) {\n\t\t\t_data.batchGroupId = -1;\n\t\t}\n\t\tif (_data.layers && _data.layers.length) {\n\t\t\t_data.layers = _data.layers.slice(0);\n\t\t}\n\t\tfor (let i = 0; i < properties.length; i++) {\n\t\t\tif (_data.hasOwnProperty(properties[i])) {\n\t\t\t\tcomponent[properties[i]] = _data[properties[i]];\n\t\t\t}\n\t\t}\n\t\tif (_data.aabbCenter && _data.aabbHalfExtents) {\n\t\t\tcomponent.customAabb = new BoundingBox(new Vec3(_data.aabbCenter), new Vec3(_data.aabbHalfExtents));\n\t\t}\n\t\tsuper.initializeComponentData(component, _data, ['enabled']);\n\t}\n\tcloneComponent(entity, clone) {\n\t\tconst data = {\n\t\t\ttype: entity.model.type,\n\t\t\tasset: entity.model.asset,\n\t\t\tcastShadows: entity.model.castShadows,\n\t\t\treceiveShadows: entity.model.receiveShadows,\n\t\t\tcastShadowsLightmap: entity.model.castShadowsLightmap,\n\t\t\tlightmapped: entity.model.lightmapped,\n\t\t\tlightmapSizeMultiplier: entity.model.lightmapSizeMultiplier,\n\t\t\tisStatic: entity.model.isStatic,\n\t\t\tenabled: entity.model.enabled,\n\t\t\tlayers: entity.model.layers,\n\t\t\tbatchGroupId: entity.model.batchGroupId,\n\t\t\tmapping: extend({}, entity.model.mapping)\n\t\t};\n\t\tlet materialAsset = entity.model.materialAsset;\n\t\tif (!(materialAsset instanceof Asset) && materialAsset != null) {\n\t\t\tmaterialAsset = this.app.assets.get(materialAsset);\n\t\t}\n\t\tconst material = entity.model.material;\n\t\tif (!material || material === this.defaultMaterial || !materialAsset || material === materialAsset.resource) {\n\t\t\tdata.materialAsset = materialAsset;\n\t\t}\n\t\tconst component = this.addComponent(clone, data);\n\t\tif (entity.model.model && entity.model.type === 'asset' && !entity.model.asset) {\n\t\t\tcomponent.model = entity.model.model.clone();\n\t\t\tcomponent._clonedModel = true;\n\t\t}\n\t\tif (!data.materialAsset) component.material = material;\n\t\tif (entity.model.model) {\n\t\t\tconst meshInstances = entity.model.model.meshInstances;\n\t\t\tconst meshInstancesClone = component.model.meshInstances;\n\t\t\tfor (let i = 0; i < meshInstances.length; i++) {\n\t\t\t\tmeshInstancesClone[i].mask = meshInstances[i].mask;\n\t\t\t\tmeshInstancesClone[i].material = meshInstances[i].material;\n\t\t\t\tmeshInstancesClone[i].layer = meshInstances[i].layer;\n\t\t\t\tmeshInstancesClone[i].receiveShadow = meshInstances[i].receiveShadow;\n\t\t\t}\n\t\t}\n\t\tif (entity.model.customAabb) {\n\t\t\tcomponent.customAabb = entity.model.customAabb.clone();\n\t\t}\n\t\treturn component;\n\t}\n\tonRemove(entity, component) {\n\t\tcomponent.onRemove();\n\t}\n}\nComponent._buildAccessors(ModelComponent.prototype, _schema);\n\nexport { ModelComponentSystem };\n","import { LAYERID_DEPTH } from '../../../scene/constants.js';\nimport { Mesh } from '../../../scene/mesh.js';\nimport { ParticleEmitter } from '../../../scene/particle-system/particle-emitter.js';\nimport { Asset } from '../../asset/asset.js';\nimport { Component } from '../component.js';\n\nconst SIMPLE_PROPERTIES = ['emitterExtents', 'emitterRadius', 'emitterExtentsInner', 'emitterRadiusInner', 'loop', 'initialVelocity', 'animSpeed', 'normalMap', 'particleNormal'];\nconst COMPLEX_PROPERTIES = ['numParticles', 'lifetime', 'rate', 'rate2', 'startAngle', 'startAngle2', 'lighting', 'halfLambert', 'intensity', 'wrap', 'wrapBounds', 'depthWrite', 'noFog', 'sort', 'stretch', 'alignToMotion', 'preWarm', 'emitterShape', 'animTilesX', 'animTilesY', 'animStartFrame', 'animNumFrames', 'animNumAnimations', 'animIndex', 'randomizeAnimIndex', 'animLoop', 'colorMap', 'localSpace', 'screenSpace', 'orientation'];\nconst GRAPH_PROPERTIES = ['scaleGraph', 'scaleGraph2', 'colorGraph', 'colorGraph2', 'alphaGraph', 'alphaGraph2', 'velocityGraph', 'velocityGraph2', 'localVelocityGraph', 'localVelocityGraph2', 'rotationSpeedGraph', 'rotationSpeedGraph2', 'radialSpeedGraph', 'radialSpeedGraph2'];\nconst ASSET_PROPERTIES = ['colorMapAsset', 'normalMapAsset', 'meshAsset', 'renderAsset'];\nlet depthLayer;\nclass ParticleSystemComponent extends Component {\n\tconstructor(system, entity) {\n\t\tsuper(system, entity);\n\t\tthis._requestedDepth = false;\n\t\tthis._drawOrder = 0;\n\t\tthis.on('set_colorMapAsset', this.onSetColorMapAsset, this);\n\t\tthis.on('set_normalMapAsset', this.onSetNormalMapAsset, this);\n\t\tthis.on('set_meshAsset', this.onSetMeshAsset, this);\n\t\tthis.on('set_mesh', this.onSetMesh, this);\n\t\tthis.on('set_renderAsset', this.onSetRenderAsset, this);\n\t\tthis.on('set_loop', this.onSetLoop, this);\n\t\tthis.on('set_blendType', this.onSetBlendType, this);\n\t\tthis.on('set_depthSoftening', this.onSetDepthSoftening, this);\n\t\tthis.on('set_layers', this.onSetLayers, this);\n\t\tSIMPLE_PROPERTIES.forEach(prop => {\n\t\t\tthis.on(`set_${prop}`, this.onSetSimpleProperty, this);\n\t\t});\n\t\tCOMPLEX_PROPERTIES.forEach(prop => {\n\t\t\tthis.on(`set_${prop}`, this.onSetComplexProperty, this);\n\t\t});\n\t\tGRAPH_PROPERTIES.forEach(prop => {\n\t\t\tthis.on(`set_${prop}`, this.onSetGraphProperty, this);\n\t\t});\n\t}\n\tset drawOrder(drawOrder) {\n\t\tthis._drawOrder = drawOrder;\n\t\tif (this.emitter) {\n\t\t\tthis.emitter.drawOrder = drawOrder;\n\t\t}\n\t}\n\tget drawOrder() {\n\t\treturn this._drawOrder;\n\t}\n\taddMeshInstanceToLayers() {\n\t\tif (!this.emitter) return;\n\t\tfor (let i = 0; i < this.layers.length; i++) {\n\t\t\tconst layer = this.system.app.scene.layers.getLayerById(this.layers[i]);\n\t\t\tif (!layer) continue;\n\t\t\tlayer.addMeshInstances([this.emitter.meshInstance]);\n\t\t\tthis.emitter._layer = layer;\n\t\t}\n\t}\n\tremoveMeshInstanceFromLayers() {\n\t\tif (!this.emitter) return;\n\t\tfor (let i = 0; i < this.layers.length; i++) {\n\t\t\tconst layer = this.system.app.scene.layers.getLayerById(this.layers[i]);\n\t\t\tif (!layer) continue;\n\t\t\tlayer.removeMeshInstances([this.emitter.meshInstance]);\n\t\t}\n\t}\n\tonSetLayers(name, oldValue, newValue) {\n\t\tif (!this.emitter) return;\n\t\tfor (let i = 0; i < oldValue.length; i++) {\n\t\t\tconst layer = this.system.app.scene.layers.getLayerById(oldValue[i]);\n\t\t\tif (!layer) continue;\n\t\t\tlayer.removeMeshInstances([this.emitter.meshInstance]);\n\t\t}\n\t\tif (!this.enabled || !this.entity.enabled) return;\n\t\tfor (let i = 0; i < newValue.length; i++) {\n\t\t\tconst layer = this.system.app.scene.layers.getLayerById(newValue[i]);\n\t\t\tif (!layer) continue;\n\t\t\tlayer.addMeshInstances([this.emitter.meshInstance]);\n\t\t}\n\t}\n\tonLayersChanged(oldComp, newComp) {\n\t\tthis.addMeshInstanceToLayers();\n\t\toldComp.off('add', this.onLayerAdded, this);\n\t\toldComp.off('remove', this.onLayerRemoved, this);\n\t\tnewComp.on('add', this.onLayerAdded, this);\n\t\tnewComp.on('remove', this.onLayerRemoved, this);\n\t}\n\tonLayerAdded(layer) {\n\t\tif (!this.emitter) return;\n\t\tconst index = this.layers.indexOf(layer.id);\n\t\tif (index < 0) return;\n\t\tlayer.addMeshInstances([this.emitter.meshInstance]);\n\t}\n\tonLayerRemoved(layer) {\n\t\tif (!this.emitter) return;\n\t\tconst index = this.layers.indexOf(layer.id);\n\t\tif (index < 0) return;\n\t\tlayer.removeMeshInstances([this.emitter.meshInstance]);\n\t}\n\t_bindColorMapAsset(asset) {\n\t\tasset.on('load', this._onColorMapAssetLoad, this);\n\t\tasset.on('unload', this._onColorMapAssetUnload, this);\n\t\tasset.on('remove', this._onColorMapAssetRemove, this);\n\t\tasset.on('change', this._onColorMapAssetChange, this);\n\t\tif (asset.resource) {\n\t\t\tthis._onColorMapAssetLoad(asset);\n\t\t} else {\n\t\t\tif (!this.enabled || !this.entity.enabled) return;\n\t\t\tthis.system.app.assets.load(asset);\n\t\t}\n\t}\n\t_unbindColorMapAsset(asset) {\n\t\tasset.off('load', this._onColorMapAssetLoad, this);\n\t\tasset.off('unload', this._onColorMapAssetUnload, this);\n\t\tasset.off('remove', this._onColorMapAssetRemove, this);\n\t\tasset.off('change', this._onColorMapAssetChange, this);\n\t}\n\t_onColorMapAssetLoad(asset) {\n\t\tthis.colorMap = asset.resource;\n\t}\n\t_onColorMapAssetUnload(asset) {\n\t\tthis.colorMap = null;\n\t}\n\t_onColorMapAssetRemove(asset) {\n\t\tthis._onColorMapAssetUnload(asset);\n\t}\n\t_onColorMapAssetChange(asset) {}\n\tonSetColorMapAsset(name, oldValue, newValue) {\n\t\tconst assets = this.system.app.assets;\n\t\tif (oldValue) {\n\t\t\tconst asset = assets.get(oldValue);\n\t\t\tif (asset) {\n\t\t\t\tthis._unbindColorMapAsset(asset);\n\t\t\t}\n\t\t}\n\t\tif (newValue) {\n\t\t\tif (newValue instanceof Asset) {\n\t\t\t\tthis.data.colorMapAsset = newValue.id;\n\t\t\t\tnewValue = newValue.id;\n\t\t\t}\n\t\t\tconst asset = assets.get(newValue);\n\t\t\tif (asset) {\n\t\t\t\tthis._bindColorMapAsset(asset);\n\t\t\t} else {\n\t\t\t\tassets.once('add:' + newValue, asset => {\n\t\t\t\t\tthis._bindColorMapAsset(asset);\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tthis.colorMap = null;\n\t\t}\n\t}\n\t_bindNormalMapAsset(asset) {\n\t\tasset.on('load', this._onNormalMapAssetLoad, this);\n\t\tasset.on('unload', this._onNormalMapAssetUnload, this);\n\t\tasset.on('remove', this._onNormalMapAssetRemove, this);\n\t\tasset.on('change', this._onNormalMapAssetChange, this);\n\t\tif (asset.resource) {\n\t\t\tthis._onNormalMapAssetLoad(asset);\n\t\t} else {\n\t\t\tif (!this.enabled || !this.entity.enabled) return;\n\t\t\tthis.system.app.assets.load(asset);\n\t\t}\n\t}\n\t_unbindNormalMapAsset(asset) {\n\t\tasset.off('load', this._onNormalMapAssetLoad, this);\n\t\tasset.off('unload', this._onNormalMapAssetUnload, this);\n\t\tasset.off('remove', this._onNormalMapAssetRemove, this);\n\t\tasset.off('change', this._onNormalMapAssetChange, this);\n\t}\n\t_onNormalMapAssetLoad(asset) {\n\t\tthis.normalMap = asset.resource;\n\t}\n\t_onNormalMapAssetUnload(asset) {\n\t\tthis.normalMap = null;\n\t}\n\t_onNormalMapAssetRemove(asset) {\n\t\tthis._onNormalMapAssetUnload(asset);\n\t}\n\t_onNormalMapAssetChange(asset) {}\n\tonSetNormalMapAsset(name, oldValue, newValue) {\n\t\tconst assets = this.system.app.assets;\n\t\tif (oldValue) {\n\t\t\tconst asset = assets.get(oldValue);\n\t\t\tif (asset) {\n\t\t\t\tthis._unbindNormalMapAsset(asset);\n\t\t\t}\n\t\t}\n\t\tif (newValue) {\n\t\t\tif (newValue instanceof Asset) {\n\t\t\t\tthis.data.normalMapAsset = newValue.id;\n\t\t\t\tnewValue = newValue.id;\n\t\t\t}\n\t\t\tconst asset = assets.get(newValue);\n\t\t\tif (asset) {\n\t\t\t\tthis._bindNormalMapAsset(asset);\n\t\t\t} else {\n\t\t\t\tassets.once('add:' + newValue, asset => {\n\t\t\t\t\tthis._bindNormalMapAsset(asset);\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tthis.normalMap = null;\n\t\t}\n\t}\n\t_bindMeshAsset(asset) {\n\t\tasset.on('load', this._onMeshAssetLoad, this);\n\t\tasset.on('unload', this._onMeshAssetUnload, this);\n\t\tasset.on('remove', this._onMeshAssetRemove, this);\n\t\tasset.on('change', this._onMeshAssetChange, this);\n\t\tif (asset.resource) {\n\t\t\tthis._onMeshAssetLoad(asset);\n\t\t} else {\n\t\t\tif (!this.enabled || !this.entity.enabled) return;\n\t\t\tthis.system.app.assets.load(asset);\n\t\t}\n\t}\n\t_unbindMeshAsset(asset) {\n\t\tasset.off('load', this._onMeshAssetLoad, this);\n\t\tasset.off('unload', this._onMeshAssetUnload, this);\n\t\tasset.off('remove', this._onMeshAssetRemove, this);\n\t\tasset.off('change', this._onMeshAssetChange, this);\n\t}\n\t_onMeshAssetLoad(asset) {\n\t\tthis._onMeshChanged(asset.resource);\n\t}\n\t_onMeshAssetUnload(asset) {\n\t\tthis.mesh = null;\n\t}\n\t_onMeshAssetRemove(asset) {\n\t\tthis._onMeshAssetUnload(asset);\n\t}\n\t_onMeshAssetChange(asset) {}\n\tonSetMeshAsset(name, oldValue, newValue) {\n\t\tconst assets = this.system.app.assets;\n\t\tif (oldValue) {\n\t\t\tconst asset = assets.get(oldValue);\n\t\t\tif (asset) {\n\t\t\t\tthis._unbindMeshAsset(asset);\n\t\t\t}\n\t\t}\n\t\tif (newValue) {\n\t\t\tif (newValue instanceof Asset) {\n\t\t\t\tthis.data.meshAsset = newValue.id;\n\t\t\t\tnewValue = newValue.id;\n\t\t\t}\n\t\t\tconst asset = assets.get(newValue);\n\t\t\tif (asset) {\n\t\t\t\tthis._bindMeshAsset(asset);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._onMeshChanged(null);\n\t\t}\n\t}\n\tonSetMesh(name, oldValue, newValue) {\n\t\tif (!newValue || newValue instanceof Asset || typeof newValue === 'number') {\n\t\t\tthis.meshAsset = newValue;\n\t\t} else {\n\t\t\tthis._onMeshChanged(newValue);\n\t\t}\n\t}\n\t_onMeshChanged(mesh) {\n\t\tif (mesh && !(mesh instanceof Mesh)) {\n\t\t\tif (mesh.meshInstances[0]) {\n\t\t\t\tmesh = mesh.meshInstances[0].mesh;\n\t\t\t} else {\n\t\t\t\tmesh = null;\n\t\t\t}\n\t\t}\n\t\tthis.data.mesh = mesh;\n\t\tif (this.emitter) {\n\t\t\tthis.emitter.mesh = mesh;\n\t\t\tthis.emitter.resetMaterial();\n\t\t\tthis.rebuild();\n\t\t}\n\t}\n\tonSetRenderAsset(name, oldValue, newValue) {\n\t\tconst assets = this.system.app.assets;\n\t\tif (oldValue) {\n\t\t\tconst asset = assets.get(oldValue);\n\t\t\tif (asset) {\n\t\t\t\tthis._unbindRenderAsset(asset);\n\t\t\t}\n\t\t}\n\t\tif (newValue) {\n\t\t\tif (newValue instanceof Asset) {\n\t\t\t\tthis.data.renderAsset = newValue.id;\n\t\t\t\tnewValue = newValue.id;\n\t\t\t}\n\t\t\tconst asset = assets.get(newValue);\n\t\t\tif (asset) {\n\t\t\t\tthis._bindRenderAsset(asset);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._onRenderChanged(null);\n\t\t}\n\t}\n\t_bindRenderAsset(asset) {\n\t\tasset.on('load', this._onRenderAssetLoad, this);\n\t\tasset.on('unload', this._onRenderAssetUnload, this);\n\t\tasset.on('remove', this._onRenderAssetRemove, this);\n\t\tif (asset.resource) {\n\t\t\tthis._onRenderAssetLoad(asset);\n\t\t} else {\n\t\t\tif (!this.enabled || !this.entity.enabled) return;\n\t\t\tthis.system.app.assets.load(asset);\n\t\t}\n\t}\n\t_unbindRenderAsset(asset) {\n\t\tasset.off('load', this._onRenderAssetLoad, this);\n\t\tasset.off('unload', this._onRenderAssetUnload, this);\n\t\tasset.off('remove', this._onRenderAssetRemove, this);\n\t\tif (asset.resource) {\n\t\t\tasset.resource.off('set:meshes', this._onRenderSetMeshes, this);\n\t\t}\n\t}\n\t_onRenderAssetLoad(asset) {\n\t\tthis._onRenderChanged(asset.resource);\n\t}\n\t_onRenderAssetUnload(asset) {\n\t\tthis._onRenderChanged(null);\n\t}\n\t_onRenderAssetRemove(asset) {\n\t\tthis._onRenderAssetUnload(asset);\n\t}\n\t_onRenderChanged(render) {\n\t\tif (!render) {\n\t\t\tthis._onMeshChanged(null);\n\t\t\treturn;\n\t\t}\n\t\trender.off('set:meshes', this._onRenderSetMeshes, this);\n\t\trender.on('set:meshes', this._onRenderSetMeshes, this);\n\t\tif (render.meshes) {\n\t\t\tthis._onRenderSetMeshes(render.meshes);\n\t\t}\n\t}\n\t_onRenderSetMeshes(meshes) {\n\t\tthis._onMeshChanged(meshes && meshes[0]);\n\t}\n\tonSetLoop(name, oldValue, newValue) {\n\t\tif (this.emitter) {\n\t\t\tthis.emitter[name] = newValue;\n\t\t\tthis.emitter.resetTime();\n\t\t}\n\t}\n\tonSetBlendType(name, oldValue, newValue) {\n\t\tif (this.emitter) {\n\t\t\tthis.emitter[name] = newValue;\n\t\t\tthis.emitter.material.blendType = newValue;\n\t\t\tthis.emitter.resetMaterial();\n\t\t\tthis.rebuild();\n\t\t}\n\t}\n\t_requestDepth() {\n\t\tif (this._requestedDepth) return;\n\t\tif (!depthLayer) depthLayer = this.system.app.scene.layers.getLayerById(LAYERID_DEPTH);\n\t\tif (depthLayer) {\n\t\t\tdepthLayer.incrementCounter();\n\t\t\tthis._requestedDepth = true;\n\t\t}\n\t}\n\t_releaseDepth() {\n\t\tif (!this._requestedDepth) return;\n\t\tif (depthLayer) {\n\t\t\tdepthLayer.decrementCounter();\n\t\t\tthis._requestedDepth = false;\n\t\t}\n\t}\n\tonSetDepthSoftening(name, oldValue, newValue) {\n\t\tif (oldValue !== newValue) {\n\t\t\tif (newValue) {\n\t\t\t\tif (this.enabled && this.entity.enabled) this._requestDepth();\n\t\t\t\tif (this.emitter) this.emitter[name] = newValue;\n\t\t\t} else {\n\t\t\t\tif (this.enabled && this.entity.enabled) this._releaseDepth();\n\t\t\t\tif (this.emitter) this.emitter[name] = newValue;\n\t\t\t}\n\t\t\tif (this.emitter) {\n\t\t\t\tthis.reset();\n\t\t\t\tthis.emitter.resetMaterial();\n\t\t\t\tthis.rebuild();\n\t\t\t}\n\t\t}\n\t}\n\tonSetSimpleProperty(name, oldValue, newValue) {\n\t\tif (this.emitter) {\n\t\t\tthis.emitter[name] = newValue;\n\t\t\tthis.emitter.resetMaterial();\n\t\t}\n\t}\n\tonSetComplexProperty(name, oldValue, newValue) {\n\t\tif (this.emitter) {\n\t\t\tthis.emitter[name] = newValue;\n\t\t\tthis.emitter.resetMaterial();\n\t\t\tthis.rebuild();\n\t\t\tthis.reset();\n\t\t}\n\t}\n\tonSetGraphProperty(name, oldValue, newValue) {\n\t\tif (this.emitter) {\n\t\t\tthis.emitter[name] = newValue;\n\t\t\tthis.emitter.rebuildGraphs();\n\t\t\tthis.emitter.resetMaterial();\n\t\t}\n\t}\n\tonEnable() {\n\t\tconst data = this.data;\n\t\tfor (let i = 0, len = ASSET_PROPERTIES.length; i < len; i++) {\n\t\t\tlet asset = data[ASSET_PROPERTIES[i]];\n\t\t\tif (asset) {\n\t\t\t\tif (!(asset instanceof Asset)) {\n\t\t\t\t\tconst id = parseInt(asset, 10);\n\t\t\t\t\tif (id >= 0) {\n\t\t\t\t\t\tasset = this.system.app.assets.get(asset);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (asset && !asset.resource) {\n\t\t\t\t\tthis.system.app.assets.load(asset);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (this.system.app.graphicsDevice.disableParticleSystem) {\n\t\t\treturn;\n\t\t}\n\t\tif (!this.emitter) {\n\t\t\tlet mesh = data.mesh;\n\t\t\tif (!(mesh instanceof Mesh)) mesh = null;\n\t\t\tthis.emitter = new ParticleEmitter(this.system.app.graphicsDevice, {\n\t\t\t\tnumParticles: data.numParticles,\n\t\t\t\temitterExtents: data.emitterExtents,\n\t\t\t\temitterExtentsInner: data.emitterExtentsInner,\n\t\t\t\temitterRadius: data.emitterRadius,\n\t\t\t\temitterRadiusInner: data.emitterRadiusInner,\n\t\t\t\temitterShape: data.emitterShape,\n\t\t\t\tinitialVelocity: data.initialVelocity,\n\t\t\t\twrap: data.wrap,\n\t\t\t\tlocalSpace: data.localSpace,\n\t\t\t\tscreenSpace: data.screenSpace,\n\t\t\t\twrapBounds: data.wrapBounds,\n\t\t\t\tlifetime: data.lifetime,\n\t\t\t\trate: data.rate,\n\t\t\t\trate2: data.rate2,\n\t\t\t\torientation: data.orientation,\n\t\t\t\tparticleNormal: data.particleNormal,\n\t\t\t\tanimTilesX: data.animTilesX,\n\t\t\t\tanimTilesY: data.animTilesY,\n\t\t\t\tanimStartFrame: data.animStartFrame,\n\t\t\t\tanimNumFrames: data.animNumFrames,\n\t\t\t\tanimNumAnimations: data.animNumAnimations,\n\t\t\t\tanimIndex: data.animIndex,\n\t\t\t\trandomizeAnimIndex: data.randomizeAnimIndex,\n\t\t\t\tanimSpeed: data.animSpeed,\n\t\t\t\tanimLoop: data.animLoop,\n\t\t\t\tstartAngle: data.startAngle,\n\t\t\t\tstartAngle2: data.startAngle2,\n\t\t\t\tscaleGraph: data.scaleGraph,\n\t\t\t\tscaleGraph2: data.scaleGraph2,\n\t\t\t\tcolorGraph: data.colorGraph,\n\t\t\t\tcolorGraph2: data.colorGraph2,\n\t\t\t\talphaGraph: data.alphaGraph,\n\t\t\t\talphaGraph2: data.alphaGraph2,\n\t\t\t\tlocalVelocityGraph: data.localVelocityGraph,\n\t\t\t\tlocalVelocityGraph2: data.localVelocityGraph2,\n\t\t\t\tvelocityGraph: data.velocityGraph,\n\t\t\t\tvelocityGraph2: data.velocityGraph2,\n\t\t\t\trotationSpeedGraph: data.rotationSpeedGraph,\n\t\t\t\trotationSpeedGraph2: data.rotationSpeedGraph2,\n\t\t\t\tradialSpeedGraph: data.radialSpeedGraph,\n\t\t\t\tradialSpeedGraph2: data.radialSpeedGraph2,\n\t\t\t\tcolorMap: data.colorMap,\n\t\t\t\tnormalMap: data.normalMap,\n\t\t\t\tloop: data.loop,\n\t\t\t\tpreWarm: data.preWarm,\n\t\t\t\tsort: data.sort,\n\t\t\t\tstretch: data.stretch,\n\t\t\t\talignToMotion: data.alignToMotion,\n\t\t\t\tlighting: data.lighting,\n\t\t\t\thalfLambert: data.halfLambert,\n\t\t\t\tintensity: data.intensity,\n\t\t\t\tdepthSoftening: data.depthSoftening,\n\t\t\t\tscene: this.system.app.scene,\n\t\t\t\tmesh: mesh,\n\t\t\t\tdepthWrite: data.depthWrite,\n\t\t\t\tnoFog: data.noFog,\n\t\t\t\tnode: this.entity,\n\t\t\t\tblendType: data.blendType\n\t\t\t});\n\t\t\tthis.emitter.meshInstance.node = this.entity;\n\t\t\tthis.emitter.drawOrder = this.drawOrder;\n\t\t\tif (!data.autoPlay) {\n\t\t\t\tthis.pause();\n\t\t\t\tthis.emitter.meshInstance.visible = false;\n\t\t\t}\n\t\t}\n\t\tif (this.emitter.colorMap) {\n\t\t\tthis.addMeshInstanceToLayers();\n\t\t}\n\t\tthis.system.app.scene.on('set:layers', this.onLayersChanged, this);\n\t\tif (this.system.app.scene.layers) {\n\t\t\tthis.system.app.scene.layers.on('add', this.onLayerAdded, this);\n\t\t\tthis.system.app.scene.layers.on('remove', this.onLayerRemoved, this);\n\t\t}\n\t\tif (this.enabled && this.entity.enabled && data.depthSoftening) {\n\t\t\tthis._requestDepth();\n\t\t}\n\t}\n\tonDisable() {\n\t\tthis.system.app.scene.off('set:layers', this.onLayersChanged, this);\n\t\tif (this.system.app.scene.layers) {\n\t\t\tthis.system.app.scene.layers.off('add', this.onLayerAdded, this);\n\t\t\tthis.system.app.scene.layers.off('remove', this.onLayerRemoved, this);\n\t\t}\n\t\tif (this.emitter) {\n\t\t\tthis.removeMeshInstanceFromLayers();\n\t\t\tif (this.data.depthSoftening) this._releaseDepth();\n\t\t\tthis.emitter.camera = null;\n\t\t}\n\t}\n\tonBeforeRemove() {\n\t\tif (this.enabled) {\n\t\t\tthis.enabled = false;\n\t\t}\n\t\tif (this.emitter) {\n\t\t\tthis.emitter.destroy();\n\t\t\tthis.emitter = null;\n\t\t}\n\t\tfor (let i = 0; i < ASSET_PROPERTIES.length; i++) {\n\t\t\tconst prop = ASSET_PROPERTIES[i];\n\t\t\tif (this.data[prop]) {\n\t\t\t\tthis[prop] = null;\n\t\t\t}\n\t\t}\n\t\tthis.off();\n\t}\n\treset() {\n\t\tif (this.emitter) {\n\t\t\tthis.emitter.reset();\n\t\t}\n\t}\n\tstop() {\n\t\tif (this.emitter) {\n\t\t\tthis.emitter.loop = false;\n\t\t\tthis.emitter.resetTime();\n\t\t\tthis.emitter.addTime(0, true);\n\t\t}\n\t}\n\tpause() {\n\t\tthis.data.paused = true;\n\t}\n\tunpause() {\n\t\tthis.data.paused = false;\n\t}\n\tplay() {\n\t\tthis.data.paused = false;\n\t\tif (this.emitter) {\n\t\t\tthis.emitter.meshInstance.visible = true;\n\t\t\tthis.emitter.loop = this.data.loop;\n\t\t\tthis.emitter.resetTime();\n\t\t}\n\t}\n\tisPlaying() {\n\t\tif (this.data.paused) {\n\t\t\treturn false;\n\t\t}\n\t\tif (this.emitter && this.emitter.loop) {\n\t\t\treturn true;\n\t\t}\n\t\treturn Date.now() <= this.emitter.endTime;\n\t}\n\trebuild() {\n\t\tconst enabled = this.enabled;\n\t\tthis.enabled = false;\n\t\tif (this.emitter) {\n\t\t\tthis.emitter.rebuild();\n\t\t\tthis.emitter.meshInstance.node = this.entity;\n\t\t}\n\t\tthis.enabled = enabled;\n\t}\n}\n\nexport { ParticleSystemComponent };\n","import { Vec3 } from '../../../core/math/vec3.js';\nimport { EMITTERSHAPE_BOX, PARTICLEMODE_GPU, PARTICLEORIENTATION_SCREEN, BLEND_NORMAL, LAYERID_WORLD } from '../../../scene/constants.js';\n\nclass ParticleSystemComponentData {\n\tconstructor() {\n\t\tthis.numParticles = 1;\n\t\tthis.rate = 1;\n\t\tthis.rate2 = null;\n\t\tthis.startAngle = 0;\n\t\tthis.startAngle2 = null;\n\t\tthis.lifetime = 50;\n\t\tthis.emitterExtents = new Vec3();\n\t\tthis.emitterExtentsInner = new Vec3();\n\t\tthis.emitterRadius = 0;\n\t\tthis.emitterRadiusInner = 0;\n\t\tthis.emitterShape = EMITTERSHAPE_BOX;\n\t\tthis.initialVelocity = 0;\n\t\tthis.wrapBounds = new Vec3();\n\t\tthis.localSpace = false;\n\t\tthis.screenSpace = false;\n\t\tthis.colorMap = null;\n\t\tthis.colorMapAsset = null;\n\t\tthis.normalMap = null;\n\t\tthis.normalMapAsset = null;\n\t\tthis.loop = true;\n\t\tthis.preWarm = false;\n\t\tthis.sort = 0;\n\t\tthis.mode = PARTICLEMODE_GPU;\n\t\tthis.scene = null;\n\t\tthis.lighting = false;\n\t\tthis.halfLambert = false;\n\t\tthis.intensity = 1;\n\t\tthis.stretch = 0.0;\n\t\tthis.alignToMotion = false;\n\t\tthis.depthSoftening = 0;\n\t\tthis.meshAsset = null;\n\t\tthis.mesh = null;\n\t\tthis.depthWrite = false;\n\t\tthis.noFog = false;\n\t\tthis.orientation = PARTICLEORIENTATION_SCREEN;\n\t\tthis.particleNormal = new Vec3(0, 1, 0);\n\t\tthis.animTilesX = 1;\n\t\tthis.animTilesY = 1;\n\t\tthis.animStartFrame = 0;\n\t\tthis.animNumFrames = 1;\n\t\tthis.animNumAnimations = 1;\n\t\tthis.animIndex = 0;\n\t\tthis.randomizeAnimIndex = false;\n\t\tthis.animSpeed = 1;\n\t\tthis.animLoop = true;\n\t\tthis.scaleGraph = null;\n\t\tthis.scaleGraph2 = null;\n\t\tthis.colorGraph = null;\n\t\tthis.colorGraph2 = null;\n\t\tthis.alphaGraph = null;\n\t\tthis.alphaGraph2 = null;\n\t\tthis.localVelocityGraph = null;\n\t\tthis.localVelocityGraph2 = null;\n\t\tthis.velocityGraph = null;\n\t\tthis.velocityGraph2 = null;\n\t\tthis.rotationSpeedGraph = null;\n\t\tthis.rotationSpeedGraph2 = null;\n\t\tthis.radialSpeedGraph = null;\n\t\tthis.radialSpeedGraph2 = null;\n\t\tthis.blendType = BLEND_NORMAL;\n\t\tthis.enabled = true;\n\t\tthis.paused = false;\n\t\tthis.autoPlay = true;\n\t\tthis.layers = [LAYERID_WORLD];\n\t}\n}\n\nexport { ParticleSystemComponentData };\n","import { Curve } from '../../../core/math/curve.js';\nimport { CurveSet } from '../../../core/math/curve-set.js';\nimport { Vec3 } from '../../../core/math/vec3.js';\nimport { Asset } from '../../asset/asset.js';\nimport { Component } from '../component.js';\nimport { ComponentSystem } from '../system.js';\nimport { ParticleSystemComponent } from './component.js';\nimport { ParticleSystemComponentData } from './data.js';\n\nconst _schema = ['enabled', 'autoPlay', 'numParticles', 'lifetime', 'rate', 'rate2', 'startAngle', 'startAngle2', 'loop', 'preWarm', 'lighting', 'halfLambert', 'intensity', 'depthWrite', 'noFog', 'depthSoftening', 'sort', 'blendType', 'stretch', 'alignToMotion', 'emitterShape', 'emitterExtents', 'emitterExtentsInner', 'emitterRadius', 'emitterRadiusInner', 'initialVelocity', 'wrap', 'wrapBounds', 'localSpace', 'screenSpace', 'colorMapAsset', 'normalMapAsset', 'mesh', 'meshAsset', 'renderAsset', 'orientation', 'particleNormal', 'localVelocityGraph', 'localVelocityGraph2', 'velocityGraph', 'velocityGraph2', 'rotationSpeedGraph', 'rotationSpeedGraph2', 'radialSpeedGraph', 'radialSpeedGraph2', 'scaleGraph', 'scaleGraph2', 'colorGraph', 'colorGraph2', 'alphaGraph', 'alphaGraph2', 'colorMap', 'normalMap', 'animTilesX', 'animTilesY', 'animStartFrame', 'animNumFrames', 'animNumAnimations', 'animIndex', 'randomizeAnimIndex', 'animSpeed', 'animLoop', 'layers'];\nclass ParticleSystemComponentSystem extends ComponentSystem {\n\tconstructor(app) {\n\t\tsuper(app);\n\t\tthis.id = 'particlesystem';\n\t\tthis.ComponentType = ParticleSystemComponent;\n\t\tthis.DataType = ParticleSystemComponentData;\n\t\tthis.schema = _schema;\n\t\tthis.propertyTypes = {\n\t\t\temitterExtents: 'vec3',\n\t\t\temitterExtentsInner: 'vec3',\n\t\t\tparticleNormal: 'vec3',\n\t\t\twrapBounds: 'vec3',\n\t\t\tlocalVelocityGraph: 'curveset',\n\t\t\tlocalVelocityGraph2: 'curveset',\n\t\t\tvelocityGraph: 'curveset',\n\t\t\tvelocityGraph2: 'curveset',\n\t\t\tcolorGraph: 'curveset',\n\t\t\tcolorGraph2: 'curveset',\n\t\t\talphaGraph: 'curve',\n\t\t\talphaGraph2: 'curve',\n\t\t\trotationSpeedGraph: 'curve',\n\t\t\trotationSpeedGraph2: 'curve',\n\t\t\tradialSpeedGraph: 'curve',\n\t\t\tradialSpeedGraph2: 'curve',\n\t\t\tscaleGraph: 'curve',\n\t\t\tscaleGraph2: 'curve'\n\t\t};\n\t\tthis.on('beforeremove', this.onBeforeRemove, this);\n\t\tthis.app.systems.on('update', this.onUpdate, this);\n\t}\n\tinitializeComponentData(component, _data, properties) {\n\t\tconst data = {};\n\t\tproperties = [];\n\t\tconst types = this.propertyTypes;\n\t\tif (_data.mesh instanceof Asset || typeof _data.mesh === 'number') {\n\t\t\t_data.meshAsset = _data.mesh;\n\t\t\tdelete _data.mesh;\n\t\t}\n\t\tfor (const prop in _data) {\n\t\t\tif (_data.hasOwnProperty(prop)) {\n\t\t\t\tproperties.push(prop);\n\t\t\t\tdata[prop] = _data[prop];\n\t\t\t}\n\t\t\tif (types[prop] === 'vec3') {\n\t\t\t\tif (Array.isArray(data[prop])) {\n\t\t\t\t\tdata[prop] = new Vec3(data[prop][0], data[prop][1], data[prop][2]);\n\t\t\t\t}\n\t\t\t} else if (types[prop] === 'curve') {\n\t\t\t\tif (!(data[prop] instanceof Curve)) {\n\t\t\t\t\tconst t = data[prop].type;\n\t\t\t\t\tdata[prop] = new Curve(data[prop].keys);\n\t\t\t\t\tdata[prop].type = t;\n\t\t\t\t}\n\t\t\t} else if (types[prop] === 'curveset') {\n\t\t\t\tif (!(data[prop] instanceof CurveSet)) {\n\t\t\t\t\tconst t = data[prop].type;\n\t\t\t\t\tdata[prop] = new CurveSet(data[prop].keys);\n\t\t\t\t\tdata[prop].type = t;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (data.layers && Array.isArray(data.layers)) {\n\t\t\t\tdata.layers = data.layers.slice(0);\n\t\t\t}\n\t\t}\n\t\tsuper.initializeComponentData(component, data, properties);\n\t}\n\tcloneComponent(entity, clone) {\n\t\tconst source = entity.particlesystem.data;\n\t\tconst schema = this.schema;\n\t\tconst data = {};\n\t\tfor (let i = 0, len = schema.length; i < len; i++) {\n\t\t\tconst prop = schema[i];\n\t\t\tlet sourceProp = source[prop];\n\t\t\tif (sourceProp instanceof Vec3 || sourceProp instanceof Curve || sourceProp instanceof CurveSet) {\n\t\t\t\tsourceProp = sourceProp.clone();\n\t\t\t\tdata[prop] = sourceProp;\n\t\t\t} else if (prop === 'layers') {\n\t\t\t\tdata.layers = source.layers.slice(0);\n\t\t\t} else {\n\t\t\t\tif (sourceProp !== null && sourceProp !== undefined) {\n\t\t\t\t\tdata[prop] = sourceProp;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this.addComponent(clone, data);\n\t}\n\tonUpdate(dt) {\n\t\tconst components = this.store;\n\t\tlet numSteps;\n\t\tconst stats = this.app.stats.particles;\n\t\tconst composition = this.app.scene.layers;\n\t\tfor (let i = 0; i < composition.layerList.length; i++) {\n\t\t\tcomposition.layerList[i].requiresLightCube = false;\n\t\t}\n\t\tfor (const id in components) {\n\t\t\tif (components.hasOwnProperty(id)) {\n\t\t\t\tconst component = components[id];\n\t\t\t\tconst entity = component.entity;\n\t\t\t\tconst data = component.data;\n\t\t\t\tif (data.enabled && entity.enabled) {\n\t\t\t\t\tconst emitter = entity.particlesystem.emitter;\n\t\t\t\t\tif (!(emitter != null && emitter.meshInstance.visible)) continue;\n\t\t\t\t\tif (emitter.lighting) {\n\t\t\t\t\t\tconst layers = data.layers;\n\t\t\t\t\t\tfor (let i = 0; i < layers.length; i++) {\n\t\t\t\t\t\t\tconst layer = composition.getLayerById(layers[i]);\n\t\t\t\t\t\t\tif (layer) layer.requiresLightCube = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (!data.paused) {\n\t\t\t\t\t\temitter.simTime += dt;\n\t\t\t\t\t\tif (emitter.simTime > emitter.fixedTimeStep) {\n\t\t\t\t\t\t\tnumSteps = Math.floor(emitter.simTime / emitter.fixedTimeStep);\n\t\t\t\t\t\t\temitter.simTime -= numSteps * emitter.fixedTimeStep;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (numSteps) {\n\t\t\t\t\t\t\tnumSteps = Math.min(numSteps, emitter.maxSubSteps);\n\t\t\t\t\t\t\tfor (let i = 0; i < numSteps; i++) {\n\t\t\t\t\t\t\t\temitter.addTime(emitter.fixedTimeStep, false);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tstats._updatesPerFrame += numSteps;\n\t\t\t\t\t\t\tstats._frameTime += emitter._addTimeTime;\n\t\t\t\t\t\t\temitter._addTimeTime = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\temitter.finishFrame();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tonBeforeRemove(entity, component) {\n\t\tcomponent.onBeforeRemove();\n\t}\n\tdestroy() {\n\t\tsuper.destroy();\n\t\tthis.app.systems.off('update', this.onUpdate, this);\n\t}\n}\nComponent._buildAccessors(ParticleSystemComponent.prototype, _schema);\n\nexport { ParticleSystemComponentSystem };\n","import { RefCountedObject } from '../core/ref-counted-object.js';\nimport { SkinInstance } from './skin-instance.js';\n\nclass SkinInstanceCachedObject extends RefCountedObject {\n\tconstructor(skin, skinInstance) {\n\t\tsuper();\n\t\tthis.skin = skin;\n\t\tthis.skinInstance = skinInstance;\n\t}\n}\nclass SkinInstanceCache {\n\tstatic createCachedSkinInstance(skin, rootBone, entity) {\n\t\tlet skinInst = SkinInstanceCache.getCachedSkinInstance(skin, rootBone);\n\t\tif (!skinInst) {\n\t\t\tskinInst = new SkinInstance(skin);\n\t\t\tskinInst.resolve(rootBone, entity);\n\t\t\tSkinInstanceCache.addCachedSkinInstance(skin, rootBone, skinInst);\n\t\t}\n\t\treturn skinInst;\n\t}\n\tstatic getCachedSkinInstance(skin, rootBone) {\n\t\tlet skinInstance = null;\n\t\tconst cachedObjArray = SkinInstanceCache._skinInstanceCache.get(rootBone);\n\t\tif (cachedObjArray) {\n\t\t\tconst cachedObj = cachedObjArray.find(element => element.skin === skin);\n\t\t\tif (cachedObj) {\n\t\t\t\tcachedObj.incRefCount();\n\t\t\t\tskinInstance = cachedObj.skinInstance;\n\t\t\t}\n\t\t}\n\t\treturn skinInstance;\n\t}\n\tstatic addCachedSkinInstance(skin, rootBone, skinInstance) {\n\t\tlet cachedObjArray = SkinInstanceCache._skinInstanceCache.get(rootBone);\n\t\tif (!cachedObjArray) {\n\t\t\tcachedObjArray = [];\n\t\t\tSkinInstanceCache._skinInstanceCache.set(rootBone, cachedObjArray);\n\t\t}\n\t\tlet cachedObj = cachedObjArray.find(element => element.skin === skin);\n\t\tif (!cachedObj) {\n\t\t\tcachedObj = new SkinInstanceCachedObject(skin, skinInstance);\n\t\t\tcachedObjArray.push(cachedObj);\n\t\t}\n\t\tcachedObj.incRefCount();\n\t}\n\tstatic removeCachedSkinInstance(skinInstance) {\n\t\tif (skinInstance) {\n\t\t\tconst rootBone = skinInstance.rootBone;\n\t\t\tif (rootBone) {\n\t\t\t\tconst cachedObjArray = SkinInstanceCache._skinInstanceCache.get(rootBone);\n\t\t\t\tif (cachedObjArray) {\n\t\t\t\t\tconst cachedObjIndex = cachedObjArray.findIndex(element => element.skinInstance === skinInstance);\n\t\t\t\t\tif (cachedObjIndex >= 0) {\n\t\t\t\t\t\tconst cachedObj = cachedObjArray[cachedObjIndex];\n\t\t\t\t\t\tcachedObj.decRefCount();\n\t\t\t\t\t\tif (cachedObj.refCount === 0) {\n\t\t\t\t\t\t\tcachedObjArray.splice(cachedObjIndex, 1);\n\t\t\t\t\t\t\tif (!cachedObjArray.length) {\n\t\t\t\t\t\t\t\tSkinInstanceCache._skinInstanceCache.delete(rootBone);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (skinInstance) {\n\t\t\t\t\t\t\t\tskinInstance.destroy();\n\t\t\t\t\t\t\t\tcachedObj.skinInstance = null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\nSkinInstanceCache._skinInstanceCache = new Map();\n\nexport { SkinInstanceCache };\n","class AssetReference {\n\tconstructor(propertyName, parent, registry, callbacks, scope) {\n\t\tthis.propertyName = propertyName;\n\t\tthis.parent = parent;\n\t\tthis._scope = scope;\n\t\tthis._registry = registry;\n\t\tthis.id = null;\n\t\tthis.url = null;\n\t\tthis.asset = null;\n\t\tthis._onAssetLoad = callbacks.load;\n\t\tthis._onAssetAdd = callbacks.add;\n\t\tthis._onAssetRemove = callbacks.remove;\n\t\tthis._onAssetUnload = callbacks.unload;\n\t}\n\tset id(value) {\n\t\tif (this.url) throw Error('Can\\'t set id and url');\n\t\tthis._unbind();\n\t\tthis._id = value;\n\t\tthis.asset = this._registry.get(this._id);\n\t\tthis._bind();\n\t}\n\tget id() {\n\t\treturn this._id;\n\t}\n\tset url(value) {\n\t\tif (this.id) throw Error('Can\\'t set id and url');\n\t\tthis._unbind();\n\t\tthis._url = value;\n\t\tthis.asset = this._registry.getByUrl(this._url);\n\t\tthis._bind();\n\t}\n\tget url() {\n\t\treturn this._url;\n\t}\n\t_bind() {\n\t\tif (this.id) {\n\t\t\tif (this._onAssetLoad) this._registry.on('load:' + this.id, this._onLoad, this);\n\t\t\tif (this._onAssetAdd) this._registry.once('add:' + this.id, this._onAdd, this);\n\t\t\tif (this._onAssetRemove) this._registry.on('remove:' + this.id, this._onRemove, this);\n\t\t\tif (this._onAssetUnload) this._registry.on('unload:' + this.id, this._onUnload, this);\n\t\t}\n\t\tif (this.url) {\n\t\t\tif (this._onAssetLoad) this._registry.on('load:url:' + this.url, this._onLoad, this);\n\t\t\tif (this._onAssetAdd) this._registry.once('add:url:' + this.url, this._onAdd, this);\n\t\t\tif (this._onAssetRemove) this._registry.on('remove:url:' + this.url, this._onRemove, this);\n\t\t}\n\t}\n\t_unbind() {\n\t\tif (this.id) {\n\t\t\tif (this._onAssetLoad) this._registry.off('load:' + this.id, this._onLoad, this);\n\t\t\tif (this._onAssetAdd) this._registry.off('add:' + this.id, this._onAdd, this);\n\t\t\tif (this._onAssetRemove) this._registry.off('remove:' + this.id, this._onRemove, this);\n\t\t\tif (this._onAssetUnload) this._registry.off('unload:' + this.id, this._onUnload, this);\n\t\t}\n\t\tif (this.url) {\n\t\t\tif (this._onAssetLoad) this._registry.off('load:' + this.url, this._onLoad, this);\n\t\t\tif (this._onAssetAdd) this._registry.off('add:' + this.url, this._onAdd, this);\n\t\t\tif (this._onAssetRemove) this._registry.off('remove:' + this.url, this._onRemove, this);\n\t\t}\n\t}\n\t_onLoad(asset) {\n\t\tthis._onAssetLoad.call(this._scope, this.propertyName, this.parent, asset);\n\t}\n\t_onAdd(asset) {\n\t\tthis.asset = asset;\n\t\tthis._onAssetAdd.call(this._scope, this.propertyName, this.parent, asset);\n\t}\n\t_onRemove(asset) {\n\t\tthis._onAssetRemove.call(this._scope, this.propertyName, this.parent, asset);\n\t\tthis.asset = null;\n\t}\n\t_onUnload(asset) {\n\t\tthis._onAssetUnload.call(this._scope, this.propertyName, this.parent, asset);\n\t}\n}\n\nexport { AssetReference };\n","import '../../../core/tracing.js';\nimport { LAYERID_WORLD, RENDERSTYLE_SOLID } from '../../../scene/constants.js';\nimport { BatchGroup } from '../../../scene/batching/batch-group.js';\nimport { MeshInstance } from '../../../scene/mesh-instance.js';\nimport { MorphInstance } from '../../../scene/morph-instance.js';\nimport { getShapePrimitive } from '../../../scene/procedural.js';\nimport { GraphNode } from '../../../scene/graph-node.js';\nimport { SkinInstanceCache } from '../../../scene/skin-instance-cache.js';\nimport { Asset } from '../../asset/asset.js';\nimport { AssetReference } from '../../asset/asset-reference.js';\nimport { Component } from '../component.js';\nimport { EntityReference } from '../../utils/entity-reference.js';\n\nclass RenderComponent extends Component {\n\tconstructor(system, entity) {\n\t\tsuper(system, entity);\n\t\tthis._type = 'asset';\n\t\tthis._castShadows = true;\n\t\tthis._receiveShadows = true;\n\t\tthis._castShadowsLightmap = true;\n\t\tthis._lightmapped = false;\n\t\tthis._lightmapSizeMultiplier = 1;\n\t\tthis.isStatic = false;\n\t\tthis._batchGroupId = -1;\n\t\tthis._layers = [LAYERID_WORLD];\n\t\tthis._renderStyle = RENDERSTYLE_SOLID;\n\t\tthis._meshInstances = [];\n\t\tthis._customAabb = null;\n\t\tthis._area = null;\n\t\tthis._assetReference = [];\n\t\tthis._materialReferences = [];\n\t\tthis._material = void 0;\n\t\tthis._rootBone = void 0;\n\t\tthis._rootBone = new EntityReference(this, 'rootBone');\n\t\tthis._rootBone.on('set:entity', this._onSetRootBone, this);\n\t\tthis._assetReference = new AssetReference('asset', this, system.app.assets, {\n\t\t\tadd: this._onRenderAssetAdded,\n\t\t\tload: this._onRenderAssetLoad,\n\t\t\tremove: this._onRenderAssetRemove,\n\t\t\tunload: this._onRenderAssetUnload\n\t\t}, this);\n\t\tthis._material = system.defaultMaterial;\n\t\tentity.on('remove', this.onRemoveChild, this);\n\t\tentity.on('removehierarchy', this.onRemoveChild, this);\n\t\tentity.on('insert', this.onInsertChild, this);\n\t\tentity.on('inserthierarchy', this.onInsertChild, this);\n\t}\n\tset renderStyle(renderStyle) {\n\t\tif (this._renderStyle !== renderStyle) {\n\t\t\tthis._renderStyle = renderStyle;\n\t\t\tMeshInstance._prepareRenderStyleForArray(this._meshInstances, renderStyle);\n\t\t}\n\t}\n\tget renderStyle() {\n\t\treturn this._renderStyle;\n\t}\n\tset customAabb(value) {\n\t\tthis._customAabb = value;\n\t\tconst mi = this._meshInstances;\n\t\tif (mi) {\n\t\t\tfor (let i = 0; i < mi.length; i++) {\n\t\t\t\tmi[i].setCustomAabb(this._customAabb);\n\t\t\t}\n\t\t}\n\t}\n\tget customAabb() {\n\t\treturn this._customAabb;\n\t}\n\tset type(value) {\n\t\tif (this._type !== value) {\n\t\t\tthis._area = null;\n\t\t\tthis._type = value;\n\t\t\tthis.destroyMeshInstances();\n\t\t\tif (value !== 'asset') {\n\t\t\t\tlet material = this._material;\n\t\t\t\tif (!material || material === this.system.defaultMaterial) {\n\t\t\t\t\tmaterial = this._materialReferences[0] && this._materialReferences[0].asset && this._materialReferences[0].asset.resource;\n\t\t\t\t}\n\t\t\t\tconst primData = getShapePrimitive(this.system.app.graphicsDevice, value);\n\t\t\t\tthis._area = primData.area;\n\t\t\t\tthis.meshInstances = [new MeshInstance(primData.mesh, material || this.system.defaultMaterial, this.entity)];\n\t\t\t}\n\t\t}\n\t}\n\tget type() {\n\t\treturn this._type;\n\t}\n\tset meshInstances(value) {\n\t\tthis.destroyMeshInstances();\n\t\tthis._meshInstances = value;\n\t\tif (this._meshInstances) {\n\t\t\tconst mi = this._meshInstances;\n\t\t\tfor (let i = 0; i < mi.length; i++) {\n\t\t\t\tif (!mi[i].node) {\n\t\t\t\t\tmi[i].node = this.entity;\n\t\t\t\t}\n\t\t\t\tmi[i].castShadow = this._castShadows;\n\t\t\t\tmi[i].receiveShadow = this._receiveShadows;\n\t\t\t\tmi[i].renderStyle = this._renderStyle;\n\t\t\t\tmi[i].setLightmapped(this._lightmapped);\n\t\t\t\tmi[i].setCustomAabb(this._customAabb);\n\t\t\t}\n\t\t\tif (this.enabled && this.entity.enabled) {\n\t\t\t\tthis.addToLayers();\n\t\t\t}\n\t\t}\n\t}\n\tget meshInstances() {\n\t\treturn this._meshInstances;\n\t}\n\tset lightmapped(value) {\n\t\tif (value !== this._lightmapped) {\n\t\t\tthis._lightmapped = value;\n\t\t\tconst mi = this._meshInstances;\n\t\t\tif (mi) {\n\t\t\t\tfor (let i = 0; i < mi.length; i++) {\n\t\t\t\t\tmi[i].setLightmapped(value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tget lightmapped() {\n\t\treturn this._lightmapped;\n\t}\n\tset castShadows(value) {\n\t\tif (this._castShadows !== value) {\n\t\t\tconst mi = this._meshInstances;\n\t\t\tif (mi) {\n\t\t\t\tconst layers = this.layers;\n\t\t\t\tconst scene = this.system.app.scene;\n\t\t\t\tif (this._castShadows && !value) {\n\t\t\t\t\tfor (let i = 0; i < layers.length; i++) {\n\t\t\t\t\t\tconst layer = scene.layers.getLayerById(this.layers[i]);\n\t\t\t\t\t\tif (layer) {\n\t\t\t\t\t\t\tlayer.removeShadowCasters(mi);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (let i = 0; i < mi.length; i++) {\n\t\t\t\t\tmi[i].castShadow = value;\n\t\t\t\t}\n\t\t\t\tif (!this._castShadows && value) {\n\t\t\t\t\tfor (let i = 0; i < layers.length; i++) {\n\t\t\t\t\t\tconst layer = scene.layers.getLayerById(layers[i]);\n\t\t\t\t\t\tif (layer) {\n\t\t\t\t\t\t\tlayer.addShadowCasters(mi);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._castShadows = value;\n\t\t}\n\t}\n\tget castShadows() {\n\t\treturn this._castShadows;\n\t}\n\tset receiveShadows(value) {\n\t\tif (this._receiveShadows !== value) {\n\t\t\tthis._receiveShadows = value;\n\t\t\tconst mi = this._meshInstances;\n\t\t\tif (mi) {\n\t\t\t\tfor (let i = 0; i < mi.length; i++) {\n\t\t\t\t\tmi[i].receiveShadow = value;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tget receiveShadows() {\n\t\treturn this._receiveShadows;\n\t}\n\tset castShadowsLightmap(value) {\n\t\tthis._castShadowsLightmap = value;\n\t}\n\tget castShadowsLightmap() {\n\t\treturn this._castShadowsLightmap;\n\t}\n\tset lightmapSizeMultiplier(value) {\n\t\tthis._lightmapSizeMultiplier = value;\n\t}\n\tget lightmapSizeMultiplier() {\n\t\treturn this._lightmapSizeMultiplier;\n\t}\n\tset layers(value) {\n\t\tconst layers = this.system.app.scene.layers;\n\t\tlet layer;\n\t\tif (this._meshInstances) {\n\t\t\tfor (let i = 0; i < this._layers.length; i++) {\n\t\t\t\tlayer = layers.getLayerById(this._layers[i]);\n\t\t\t\tif (layer) {\n\t\t\t\t\tlayer.removeMeshInstances(this._meshInstances);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis._layers.length = 0;\n\t\tfor (let i = 0; i < value.length; i++) {\n\t\t\tthis._layers[i] = value[i];\n\t\t}\n\t\tif (!this.enabled || !this.entity.enabled || !this._meshInstances) return;\n\t\tfor (let i = 0; i < this._layers.length; i++) {\n\t\t\tlayer = layers.getLayerById(this._layers[i]);\n\t\t\tif (layer) {\n\t\t\t\tlayer.addMeshInstances(this._meshInstances);\n\t\t\t}\n\t\t}\n\t}\n\tget layers() {\n\t\treturn this._layers;\n\t}\n\tset batchGroupId(value) {\n\t\tif (this._batchGroupId !== value) {\n\t\t\tif (this.entity.enabled && this._batchGroupId >= 0) {\n\t\t\t\tvar _this$system$app$batc;\n\t\t\t\t(_this$system$app$batc = this.system.app.batcher) == null || _this$system$app$batc.remove(BatchGroup.RENDER, this.batchGroupId, this.entity);\n\t\t\t}\n\t\t\tif (this.entity.enabled && value >= 0) {\n\t\t\t\tvar _this$system$app$batc2;\n\t\t\t\t(_this$system$app$batc2 = this.system.app.batcher) == null || _this$system$app$batc2.insert(BatchGroup.RENDER, value, this.entity);\n\t\t\t}\n\t\t\tif (value < 0 && this._batchGroupId >= 0 && this.enabled && this.entity.enabled) {\n\t\t\t\tthis.addToLayers();\n\t\t\t}\n\t\t\tthis._batchGroupId = value;\n\t\t}\n\t}\n\tget batchGroupId() {\n\t\treturn this._batchGroupId;\n\t}\n\tset material(value) {\n\t\tif (this._material !== value) {\n\t\t\tthis._material = value;\n\t\t\tif (this._meshInstances && this._type !== 'asset') {\n\t\t\t\tfor (let i = 0; i < this._meshInstances.length; i++) {\n\t\t\t\t\tthis._meshInstances[i].material = value;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tget material() {\n\t\treturn this._material;\n\t}\n\tset materialAssets(value = []) {\n\t\tif (this._materialReferences.length > value.length) {\n\t\t\tfor (let i = value.length; i < this._materialReferences.length; i++) {\n\t\t\t\tthis._materialReferences[i].id = null;\n\t\t\t}\n\t\t\tthis._materialReferences.length = value.length;\n\t\t}\n\t\tfor (let i = 0; i < value.length; i++) {\n\t\t\tif (!this._materialReferences[i]) {\n\t\t\t\tthis._materialReferences.push(new AssetReference(i, this, this.system.app.assets, {\n\t\t\t\t\tadd: this._onMaterialAdded,\n\t\t\t\t\tload: this._onMaterialLoad,\n\t\t\t\t\tremove: this._onMaterialRemove,\n\t\t\t\t\tunload: this._onMaterialUnload\n\t\t\t\t}, this));\n\t\t\t}\n\t\t\tif (value[i]) {\n\t\t\t\tconst id = value[i] instanceof Asset ? value[i].id : value[i];\n\t\t\t\tif (this._materialReferences[i].id !== id) {\n\t\t\t\t\tthis._materialReferences[i].id = id;\n\t\t\t\t}\n\t\t\t\tif (this._materialReferences[i].asset) {\n\t\t\t\t\tthis._onMaterialAdded(i, this, this._materialReferences[i].asset);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._materialReferences[i].id = null;\n\t\t\t\tif (this._meshInstances[i]) {\n\t\t\t\t\tthis._meshInstances[i].material = this.system.defaultMaterial;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tget materialAssets() {\n\t\treturn this._materialReferences.map(function (ref) {\n\t\t\treturn ref.id;\n\t\t});\n\t}\n\tset asset(value) {\n\t\tconst id = value instanceof Asset ? value.id : value;\n\t\tif (this._assetReference.id === id) return;\n\t\tif (this._assetReference.asset && this._assetReference.asset.resource) {\n\t\t\tthis._onRenderAssetRemove();\n\t\t}\n\t\tthis._assetReference.id = id;\n\t\tif (this._assetReference.asset) {\n\t\t\tthis._onRenderAssetAdded();\n\t\t}\n\t}\n\tget asset() {\n\t\treturn this._assetReference.id;\n\t}\n\tassignAsset(asset) {\n\t\tconst id = asset instanceof Asset ? asset.id : asset;\n\t\tthis._assetReference.id = id;\n\t}\n\t_onSetRootBone(entity) {\n\t\tif (entity) {\n\t\t\tthis._onRootBoneChanged();\n\t\t}\n\t}\n\t_onRootBoneChanged() {\n\t\tthis._clearSkinInstances();\n\t\tif (this.enabled && this.entity.enabled) {\n\t\t\tthis._cloneSkinInstances();\n\t\t}\n\t}\n\tdestroyMeshInstances() {\n\t\tconst meshInstances = this._meshInstances;\n\t\tif (meshInstances) {\n\t\t\tthis.removeFromLayers();\n\t\t\tthis._clearSkinInstances();\n\t\t\tfor (let i = 0; i < meshInstances.length; i++) {\n\t\t\t\tmeshInstances[i].destroy();\n\t\t\t}\n\t\t\tthis._meshInstances.length = 0;\n\t\t}\n\t}\n\taddToLayers() {\n\t\tconst layers = this.system.app.scene.layers;\n\t\tfor (let i = 0; i < this._layers.length; i++) {\n\t\t\tconst layer = layers.getLayerById(this._layers[i]);\n\t\t\tif (layer) {\n\t\t\t\tlayer.addMeshInstances(this._meshInstances);\n\t\t\t}\n\t\t}\n\t}\n\tremoveFromLayers() {\n\t\tif (this._meshInstances && this._meshInstances.length) {\n\t\t\tconst layers = this.system.app.scene.layers;\n\t\t\tfor (let i = 0; i < this._layers.length; i++) {\n\t\t\t\tconst layer = layers.getLayerById(this._layers[i]);\n\t\t\t\tif (layer) {\n\t\t\t\t\tlayer.removeMeshInstances(this._meshInstances);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tonRemoveChild() {\n\t\tthis.removeFromLayers();\n\t}\n\tonInsertChild() {\n\t\tif (this._meshInstances && this.enabled && this.entity.enabled) {\n\t\t\tthis.addToLayers();\n\t\t}\n\t}\n\tonRemove() {\n\t\tthis.destroyMeshInstances();\n\t\tthis.asset = null;\n\t\tthis.materialAsset = null;\n\t\tthis._assetReference.id = null;\n\t\tfor (let i = 0; i < this._materialReferences.length; i++) {\n\t\t\tthis._materialReferences[i].id = null;\n\t\t}\n\t\tthis.entity.off('remove', this.onRemoveChild, this);\n\t\tthis.entity.off('insert', this.onInsertChild, this);\n\t}\n\tonLayersChanged(oldComp, newComp) {\n\t\tthis.addToLayers();\n\t\toldComp.off('add', this.onLayerAdded, this);\n\t\toldComp.off('remove', this.onLayerRemoved, this);\n\t\tnewComp.on('add', this.onLayerAdded, this);\n\t\tnewComp.on('remove', this.onLayerRemoved, this);\n\t}\n\tonLayerAdded(layer) {\n\t\tconst index = this.layers.indexOf(layer.id);\n\t\tif (index < 0) return;\n\t\tlayer.addMeshInstances(this._meshInstances);\n\t}\n\tonLayerRemoved(layer) {\n\t\tconst index = this.layers.indexOf(layer.id);\n\t\tif (index < 0) return;\n\t\tlayer.removeMeshInstances(this._meshInstances);\n\t}\n\tonEnable() {\n\t\tconst app = this.system.app;\n\t\tconst scene = app.scene;\n\t\tthis._rootBone.onParentComponentEnable();\n\t\tthis._cloneSkinInstances();\n\t\tscene.on('set:layers', this.onLayersChanged, this);\n\t\tif (scene.layers) {\n\t\t\tscene.layers.on('add', this.onLayerAdded, this);\n\t\t\tscene.layers.on('remove', this.onLayerRemoved, this);\n\t\t}\n\t\tconst isAsset = this._type === 'asset';\n\t\tif (this._meshInstances && this._meshInstances.length) {\n\t\t\tthis.addToLayers();\n\t\t} else if (isAsset && this.asset) {\n\t\t\tthis._onRenderAssetAdded();\n\t\t}\n\t\tfor (let i = 0; i < this._materialReferences.length; i++) {\n\t\t\tif (this._materialReferences[i].asset) {\n\t\t\t\tthis.system.app.assets.load(this._materialReferences[i].asset);\n\t\t\t}\n\t\t}\n\t\tif (this._batchGroupId >= 0) {\n\t\t\tvar _app$batcher;\n\t\t\t(_app$batcher = app.batcher) == null || _app$batcher.insert(BatchGroup.RENDER, this.batchGroupId, this.entity);\n\t\t}\n\t}\n\tonDisable() {\n\t\tconst app = this.system.app;\n\t\tconst scene = app.scene;\n\t\tscene.off('set:layers', this.onLayersChanged, this);\n\t\tif (scene.layers) {\n\t\t\tscene.layers.off('add', this.onLayerAdded, this);\n\t\t\tscene.layers.off('remove', this.onLayerRemoved, this);\n\t\t}\n\t\tif (this._batchGroupId >= 0) {\n\t\t\tvar _app$batcher2;\n\t\t\t(_app$batcher2 = app.batcher) == null || _app$batcher2.remove(BatchGroup.RENDER, this.batchGroupId, this.entity);\n\t\t}\n\t\tthis.removeFromLayers();\n\t}\n\thide() {\n\t\tif (this._meshInstances) {\n\t\t\tfor (let i = 0; i < this._meshInstances.length; i++) {\n\t\t\t\tthis._meshInstances[i].visible = false;\n\t\t\t}\n\t\t}\n\t}\n\tshow() {\n\t\tif (this._meshInstances) {\n\t\t\tfor (let i = 0; i < this._meshInstances.length; i++) {\n\t\t\t\tthis._meshInstances[i].visible = true;\n\t\t\t}\n\t\t}\n\t}\n\t_onRenderAssetAdded() {\n\t\tif (!this._assetReference.asset) return;\n\t\tif (this._assetReference.asset.resource) {\n\t\t\tthis._onRenderAssetLoad();\n\t\t} else if (this.enabled && this.entity.enabled) {\n\t\t\tthis.system.app.assets.load(this._assetReference.asset);\n\t\t}\n\t}\n\t_onRenderAssetLoad() {\n\t\tthis.destroyMeshInstances();\n\t\tif (this._assetReference.asset) {\n\t\t\tconst render = this._assetReference.asset.resource;\n\t\t\trender.off('set:meshes', this._onSetMeshes, this);\n\t\t\trender.on('set:meshes', this._onSetMeshes, this);\n\t\t\tif (render.meshes) {\n\t\t\t\tthis._onSetMeshes(render.meshes);\n\t\t\t}\n\t\t}\n\t}\n\t_onSetMeshes(meshes) {\n\t\tthis._cloneMeshes(meshes);\n\t}\n\t_clearSkinInstances() {\n\t\tfor (let i = 0; i < this._meshInstances.length; i++) {\n\t\t\tconst meshInstance = this._meshInstances[i];\n\t\t\tSkinInstanceCache.removeCachedSkinInstance(meshInstance.skinInstance);\n\t\t\tmeshInstance.skinInstance = null;\n\t\t}\n\t}\n\t_cloneSkinInstances() {\n\t\tif (this._meshInstances.length && this._rootBone.entity instanceof GraphNode) {\n\t\t\tfor (let i = 0; i < this._meshInstances.length; i++) {\n\t\t\t\tconst meshInstance = this._meshInstances[i];\n\t\t\t\tconst mesh = meshInstance.mesh;\n\t\t\t\tif (mesh.skin && !meshInstance.skinInstance) {\n\t\t\t\t\tmeshInstance.skinInstance = SkinInstanceCache.createCachedSkinInstance(mesh.skin, this._rootBone.entity, this.entity);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t_cloneMeshes(meshes) {\n\t\tif (meshes && meshes.length) {\n\t\t\tconst meshInstances = [];\n\t\t\tfor (let i = 0; i < meshes.length; i++) {\n\t\t\t\tconst mesh = meshes[i];\n\t\t\t\tconst material = this._materialReferences[i] && this._materialReferences[i].asset && this._materialReferences[i].asset.resource;\n\t\t\t\tconst meshInst = new MeshInstance(mesh, material || this.system.defaultMaterial, this.entity);\n\t\t\t\tmeshInstances.push(meshInst);\n\t\t\t\tif (mesh.morph) {\n\t\t\t\t\tmeshInst.morphInstance = new MorphInstance(mesh.morph);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.meshInstances = meshInstances;\n\t\t\tthis._cloneSkinInstances();\n\t\t}\n\t}\n\t_onRenderAssetUnload() {\n\t\tif (this._type === 'asset') {\n\t\t\tthis.destroyMeshInstances();\n\t\t}\n\t}\n\t_onRenderAssetRemove() {\n\t\tif (this._assetReference.asset && this._assetReference.asset.resource) {\n\t\t\tthis._assetReference.asset.resource.off('set:meshes', this._onSetMeshes, this);\n\t\t}\n\t\tthis._onRenderAssetUnload();\n\t}\n\t_onMaterialAdded(index, component, asset) {\n\t\tif (asset.resource) {\n\t\t\tthis._onMaterialLoad(index, component, asset);\n\t\t} else {\n\t\t\tif (this.enabled && this.entity.enabled) {\n\t\t\t\tthis.system.app.assets.load(asset);\n\t\t\t}\n\t\t}\n\t}\n\t_updateMainMaterial(index, material) {\n\t\tif (index === 0) {\n\t\t\tthis.material = material;\n\t\t}\n\t}\n\t_onMaterialLoad(index, component, asset) {\n\t\tif (this._meshInstances[index]) {\n\t\t\tthis._meshInstances[index].material = asset.resource;\n\t\t}\n\t\tthis._updateMainMaterial(index, asset.resource);\n\t}\n\t_onMaterialRemove(index, component, asset) {\n\t\tif (this._meshInstances[index]) {\n\t\t\tthis._meshInstances[index].material = this.system.defaultMaterial;\n\t\t}\n\t\tthis._updateMainMaterial(index, this.system.defaultMaterial);\n\t}\n\t_onMaterialUnload(index, component, asset) {\n\t\tif (this._meshInstances[index]) {\n\t\t\tthis._meshInstances[index].material = this.system.defaultMaterial;\n\t\t}\n\t\tthis._updateMainMaterial(index, this.system.defaultMaterial);\n\t}\n\tresolveDuplicatedEntityReferenceProperties(oldRender, duplicatedIdsMap) {\n\t\tif (oldRender.rootBone && duplicatedIdsMap[oldRender.rootBone]) {\n\t\t\tthis.rootBone = duplicatedIdsMap[oldRender.rootBone];\n\t\t}\n\t\tthis._clearSkinInstances();\n\t}\n}\n\nexport { RenderComponent };\n","class RenderComponentData {\n\tconstructor() {\n\t\tthis.enabled = true;\n\t\tthis.rootBone = null;\n\t}\n}\n\nexport { RenderComponentData };\n","import { Vec3 } from '../../../core/math/vec3.js';\nimport { BoundingBox } from '../../../core/shape/bounding-box.js';\nimport { getDefaultMaterial } from '../../../scene/materials/default-material.js';\nimport { Component } from '../component.js';\nimport { ComponentSystem } from '../system.js';\nimport { RenderComponent } from './component.js';\nimport { RenderComponentData } from './data.js';\n\nconst _schema = [{\n\tname: 'rootBone',\n\ttype: 'entity'\n}, 'enabled'];\nconst _properties = ['material', 'meshInstances', 'asset', 'materialAssets', 'castShadows', 'receiveShadows', 'castShadowsLightmap', 'lightmapped', 'lightmapSizeMultiplier', 'renderStyle', 'type', 'layers', 'isStatic', 'batchGroupId'];\nclass RenderComponentSystem extends ComponentSystem {\n\tconstructor(app) {\n\t\tsuper(app);\n\t\tthis.id = 'render';\n\t\tthis.ComponentType = RenderComponent;\n\t\tthis.DataType = RenderComponentData;\n\t\tthis.schema = _schema;\n\t\tthis.defaultMaterial = getDefaultMaterial(app.graphicsDevice);\n\t\tthis.on('beforeremove', this.onRemove, this);\n\t}\n\tinitializeComponentData(component, _data, properties) {\n\t\tif (_data.batchGroupId === null || _data.batchGroupId === undefined) {\n\t\t\t_data.batchGroupId = -1;\n\t\t}\n\t\tif (_data.layers && _data.layers.length) {\n\t\t\t_data.layers = _data.layers.slice(0);\n\t\t}\n\t\tfor (let i = 0; i < _properties.length; i++) {\n\t\t\tif (_data.hasOwnProperty(_properties[i])) {\n\t\t\t\tcomponent[_properties[i]] = _data[_properties[i]];\n\t\t\t}\n\t\t}\n\t\tif (_data.aabbCenter && _data.aabbHalfExtents) {\n\t\t\tcomponent.customAabb = new BoundingBox(new Vec3(_data.aabbCenter), new Vec3(_data.aabbHalfExtents));\n\t\t}\n\t\tsuper.initializeComponentData(component, _data, _schema);\n\t}\n\tcloneComponent(entity, clone) {\n\t\tconst data = {};\n\t\tfor (let i = 0; i < _properties.length; i++) {\n\t\t\tdata[_properties[i]] = entity.render[_properties[i]];\n\t\t}\n\t\tdata.enabled = entity.render.enabled;\n\t\tdelete data.meshInstances;\n\t\tconst component = this.addComponent(clone, data);\n\t\tconst srcMeshInstances = entity.render.meshInstances;\n\t\tconst meshes = srcMeshInstances.map(mi => mi.mesh);\n\t\tcomponent._onSetMeshes(meshes);\n\t\tfor (let m = 0; m < srcMeshInstances.length; m++) {\n\t\t\tcomponent.meshInstances[m].material = srcMeshInstances[m].material;\n\t\t}\n\t\tif (entity.render.customAabb) {\n\t\t\tcomponent.customAabb = entity.render.customAabb.clone();\n\t\t}\n\t\treturn component;\n\t}\n\tonRemove(entity, component) {\n\t\tcomponent.onRemove();\n\t}\n}\nComponent._buildAccessors(RenderComponent.prototype, _schema);\n\nexport { RenderComponentSystem };\n","class ObjectPool {\n\tconstructor(constructorFunc, size) {\n\t\tthis._pool = [];\n\t\tthis._count = 0;\n\t\tthis._constructor = constructorFunc;\n\t\tthis._resize(size);\n\t}\n\t_resize(size) {\n\t\tif (size > this._pool.length) {\n\t\t\tfor (let i = this._pool.length; i < size; i++) {\n\t\t\t\tthis._pool[i] = new this._constructor();\n\t\t\t}\n\t\t}\n\t}\n\tallocate() {\n\t\tif (this._count >= this._pool.length) {\n\t\t\tthis._resize(this._pool.length * 2);\n\t\t}\n\t\treturn this._pool[this._count++];\n\t}\n\tfreeAll() {\n\t\tthis._count = 0;\n\t}\n}\n\nexport { ObjectPool };\n","import { Quat } from '../../../core/math/quat.js';\nimport { Vec3 } from '../../../core/math/vec3.js';\nimport { BODYGROUP_STATIC, BODYMASK_NOT_STATIC, BODYTYPE_STATIC, BODYTYPE_DYNAMIC, BODYTYPE_KINEMATIC, BODYGROUP_KINEMATIC, BODYMASK_ALL, BODYGROUP_DYNAMIC, BODYFLAG_KINEMATIC_OBJECT, BODYSTATE_DISABLE_DEACTIVATION, BODYSTATE_ACTIVE_TAG, BODYSTATE_DISABLE_SIMULATION } from './constants.js';\nimport { Component } from '../component.js';\n\nlet _ammoTransform;\nlet _ammoVec1, _ammoVec2, _ammoQuat;\nconst _quat1 = new Quat();\nconst _quat2 = new Quat();\nconst _vec3 = new Vec3();\nclass RigidBodyComponent extends Component {\n\tconstructor(system, entity) {\n\t\tsuper(system, entity);\n\t\tthis._angularDamping = 0;\n\t\tthis._angularFactor = new Vec3(1, 1, 1);\n\t\tthis._angularVelocity = new Vec3();\n\t\tthis._body = null;\n\t\tthis._friction = 0.5;\n\t\tthis._group = BODYGROUP_STATIC;\n\t\tthis._linearDamping = 0;\n\t\tthis._linearFactor = new Vec3(1, 1, 1);\n\t\tthis._linearVelocity = new Vec3();\n\t\tthis._mask = BODYMASK_NOT_STATIC;\n\t\tthis._mass = 1;\n\t\tthis._restitution = 0;\n\t\tthis._rollingFriction = 0;\n\t\tthis._simulationEnabled = false;\n\t\tthis._type = BODYTYPE_STATIC;\n\t}\n\tstatic onLibraryLoaded() {\n\t\tif (typeof Ammo !== 'undefined') {\n\t\t\t_ammoTransform = new Ammo.btTransform();\n\t\t\t_ammoVec1 = new Ammo.btVector3();\n\t\t\t_ammoVec2 = new Ammo.btVector3();\n\t\t\t_ammoQuat = new Ammo.btQuaternion();\n\t\t}\n\t}\n\tset angularDamping(damping) {\n\t\tif (this._angularDamping !== damping) {\n\t\t\tthis._angularDamping = damping;\n\t\t\tif (this._body) {\n\t\t\t\tthis._body.setDamping(this._linearDamping, damping);\n\t\t\t}\n\t\t}\n\t}\n\tget angularDamping() {\n\t\treturn this._angularDamping;\n\t}\n\tset angularFactor(factor) {\n\t\tif (!this._angularFactor.equals(factor)) {\n\t\t\tthis._angularFactor.copy(factor);\n\t\t\tif (this._body && this._type === BODYTYPE_DYNAMIC) {\n\t\t\t\t_ammoVec1.setValue(factor.x, factor.y, factor.z);\n\t\t\t\tthis._body.setAngularFactor(_ammoVec1);\n\t\t\t}\n\t\t}\n\t}\n\tget angularFactor() {\n\t\treturn this._angularFactor;\n\t}\n\tset angularVelocity(velocity) {\n\t\tif (this._body && this._type === BODYTYPE_DYNAMIC) {\n\t\t\tthis._body.activate();\n\t\t\t_ammoVec1.setValue(velocity.x, velocity.y, velocity.z);\n\t\t\tthis._body.setAngularVelocity(_ammoVec1);\n\t\t\tthis._angularVelocity.copy(velocity);\n\t\t}\n\t}\n\tget angularVelocity() {\n\t\tif (this._body && this._type === BODYTYPE_DYNAMIC) {\n\t\t\tconst velocity = this._body.getAngularVelocity();\n\t\t\tthis._angularVelocity.set(velocity.x(), velocity.y(), velocity.z());\n\t\t}\n\t\treturn this._angularVelocity;\n\t}\n\tset body(body) {\n\t\tif (this._body !== body) {\n\t\t\tthis._body = body;\n\t\t\tif (body && this._simulationEnabled) {\n\t\t\t\tbody.activate();\n\t\t\t}\n\t\t}\n\t}\n\tget body() {\n\t\treturn this._body;\n\t}\n\tset friction(friction) {\n\t\tif (this._friction !== friction) {\n\t\t\tthis._friction = friction;\n\t\t\tif (this._body) {\n\t\t\t\tthis._body.setFriction(friction);\n\t\t\t}\n\t\t}\n\t}\n\tget friction() {\n\t\treturn this._friction;\n\t}\n\tset group(group) {\n\t\tif (this._group !== group) {\n\t\t\tthis._group = group;\n\t\t\tif (this.enabled && this.entity.enabled) {\n\t\t\t\tthis.disableSimulation();\n\t\t\t\tthis.enableSimulation();\n\t\t\t}\n\t\t}\n\t}\n\tget group() {\n\t\treturn this._group;\n\t}\n\tset linearDamping(damping) {\n\t\tif (this._linearDamping !== damping) {\n\t\t\tthis._linearDamping = damping;\n\t\t\tif (this._body) {\n\t\t\t\tthis._body.setDamping(damping, this._angularDamping);\n\t\t\t}\n\t\t}\n\t}\n\tget linearDamping() {\n\t\treturn this._linearDamping;\n\t}\n\tset linearFactor(factor) {\n\t\tif (!this._linearFactor.equals(factor)) {\n\t\t\tthis._linearFactor.copy(factor);\n\t\t\tif (this._body && this._type === BODYTYPE_DYNAMIC) {\n\t\t\t\t_ammoVec1.setValue(factor.x, factor.y, factor.z);\n\t\t\t\tthis._body.setLinearFactor(_ammoVec1);\n\t\t\t}\n\t\t}\n\t}\n\tget linearFactor() {\n\t\treturn this._linearFactor;\n\t}\n\tset linearVelocity(velocity) {\n\t\tif (this._body && this._type === BODYTYPE_DYNAMIC) {\n\t\t\tthis._body.activate();\n\t\t\t_ammoVec1.setValue(velocity.x, velocity.y, velocity.z);\n\t\t\tthis._body.setLinearVelocity(_ammoVec1);\n\t\t\tthis._linearVelocity.copy(velocity);\n\t\t}\n\t}\n\tget linearVelocity() {\n\t\tif (this._body && this._type === BODYTYPE_DYNAMIC) {\n\t\t\tconst velocity = this._body.getLinearVelocity();\n\t\t\tthis._linearVelocity.set(velocity.x(), velocity.y(), velocity.z());\n\t\t}\n\t\treturn this._linearVelocity;\n\t}\n\tset mask(mask) {\n\t\tif (this._mask !== mask) {\n\t\t\tthis._mask = mask;\n\t\t\tif (this.enabled && this.entity.enabled) {\n\t\t\t\tthis.disableSimulation();\n\t\t\t\tthis.enableSimulation();\n\t\t\t}\n\t\t}\n\t}\n\tget mask() {\n\t\treturn this._mask;\n\t}\n\tset mass(mass) {\n\t\tif (this._mass !== mass) {\n\t\t\tthis._mass = mass;\n\t\t\tif (this._body && this._type === BODYTYPE_DYNAMIC) {\n\t\t\t\tconst enabled = this.enabled && this.entity.enabled;\n\t\t\t\tif (enabled) {\n\t\t\t\t\tthis.disableSimulation();\n\t\t\t\t}\n\t\t\t\tthis._body.getCollisionShape().calculateLocalInertia(mass, _ammoVec1);\n\t\t\t\tthis._body.setMassProps(mass, _ammoVec1);\n\t\t\t\tthis._body.updateInertiaTensor();\n\t\t\t\tif (enabled) {\n\t\t\t\t\tthis.enableSimulation();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tget mass() {\n\t\treturn this._mass;\n\t}\n\tset restitution(restitution) {\n\t\tif (this._restitution !== restitution) {\n\t\t\tthis._restitution = restitution;\n\t\t\tif (this._body) {\n\t\t\t\tthis._body.setRestitution(restitution);\n\t\t\t}\n\t\t}\n\t}\n\tget restitution() {\n\t\treturn this._restitution;\n\t}\n\tset rollingFriction(friction) {\n\t\tif (this._rollingFriction !== friction) {\n\t\t\tthis._rollingFriction = friction;\n\t\t\tif (this._body) {\n\t\t\t\tthis._body.setRollingFriction(friction);\n\t\t\t}\n\t\t}\n\t}\n\tget rollingFriction() {\n\t\treturn this._rollingFriction;\n\t}\n\tset type(type) {\n\t\tif (this._type !== type) {\n\t\t\tthis._type = type;\n\t\t\tthis.disableSimulation();\n\t\t\tswitch (type) {\n\t\t\t\tcase BODYTYPE_DYNAMIC:\n\t\t\t\t\tthis._group = BODYGROUP_DYNAMIC;\n\t\t\t\t\tthis._mask = BODYMASK_ALL;\n\t\t\t\t\tbreak;\n\t\t\t\tcase BODYTYPE_KINEMATIC:\n\t\t\t\t\tthis._group = BODYGROUP_KINEMATIC;\n\t\t\t\t\tthis._mask = BODYMASK_ALL;\n\t\t\t\t\tbreak;\n\t\t\t\tcase BODYTYPE_STATIC:\n\t\t\t\tdefault:\n\t\t\t\t\tthis._group = BODYGROUP_STATIC;\n\t\t\t\t\tthis._mask = BODYMASK_NOT_STATIC;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tthis.createBody();\n\t\t}\n\t}\n\tget type() {\n\t\treturn this._type;\n\t}\n\tcreateBody() {\n\t\tconst entity = this.entity;\n\t\tlet shape;\n\t\tif (entity.collision) {\n\t\t\tshape = entity.collision.shape;\n\t\t\tif (entity.trigger) {\n\t\t\t\tentity.trigger.destroy();\n\t\t\t\tdelete entity.trigger;\n\t\t\t}\n\t\t}\n\t\tif (shape) {\n\t\t\tif (this._body) {\n\t\t\t\tthis.system.removeBody(this._body);\n\t\t\t\tthis.system.destroyBody(this._body);\n\t\t\t\tthis._body = null;\n\t\t\t}\n\t\t\tconst mass = this._type === BODYTYPE_DYNAMIC ? this._mass : 0;\n\t\t\tthis._getEntityTransform(_ammoTransform);\n\t\t\tconst body = this.system.createBody(mass, shape, _ammoTransform);\n\t\t\tbody.setRestitution(this._restitution);\n\t\t\tbody.setFriction(this._friction);\n\t\t\tbody.setRollingFriction(this._rollingFriction);\n\t\t\tbody.setDamping(this._linearDamping, this._angularDamping);\n\t\t\tif (this._type === BODYTYPE_DYNAMIC) {\n\t\t\t\tconst linearFactor = this._linearFactor;\n\t\t\t\t_ammoVec1.setValue(linearFactor.x, linearFactor.y, linearFactor.z);\n\t\t\t\tbody.setLinearFactor(_ammoVec1);\n\t\t\t\tconst angularFactor = this._angularFactor;\n\t\t\t\t_ammoVec1.setValue(angularFactor.x, angularFactor.y, angularFactor.z);\n\t\t\t\tbody.setAngularFactor(_ammoVec1);\n\t\t\t} else if (this._type === BODYTYPE_KINEMATIC) {\n\t\t\t\tbody.setCollisionFlags(body.getCollisionFlags() | BODYFLAG_KINEMATIC_OBJECT);\n\t\t\t\tbody.setActivationState(BODYSTATE_DISABLE_DEACTIVATION);\n\t\t\t}\n\t\t\tbody.entity = entity;\n\t\t\tthis.body = body;\n\t\t\tif (this.enabled && entity.enabled) {\n\t\t\t\tthis.enableSimulation();\n\t\t\t}\n\t\t}\n\t}\n\tisActive() {\n\t\treturn this._body ? this._body.isActive() : false;\n\t}\n\tactivate() {\n\t\tif (this._body) {\n\t\t\tthis._body.activate();\n\t\t}\n\t}\n\tenableSimulation() {\n\t\tconst entity = this.entity;\n\t\tif (entity.collision && entity.collision.enabled && !this._simulationEnabled) {\n\t\t\tconst body = this._body;\n\t\t\tif (body) {\n\t\t\t\tthis.system.addBody(body, this._group, this._mask);\n\t\t\t\tswitch (this._type) {\n\t\t\t\t\tcase BODYTYPE_DYNAMIC:\n\t\t\t\t\t\tthis.system._dynamic.push(this);\n\t\t\t\t\t\tbody.forceActivationState(BODYSTATE_ACTIVE_TAG);\n\t\t\t\t\t\tthis.syncEntityToBody();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase BODYTYPE_KINEMATIC:\n\t\t\t\t\t\tthis.system._kinematic.push(this);\n\t\t\t\t\t\tbody.forceActivationState(BODYSTATE_DISABLE_DEACTIVATION);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase BODYTYPE_STATIC:\n\t\t\t\t\t\tbody.forceActivationState(BODYSTATE_ACTIVE_TAG);\n\t\t\t\t\t\tthis.syncEntityToBody();\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (entity.collision.type === 'compound') {\n\t\t\t\t\tthis.system._compounds.push(entity.collision);\n\t\t\t\t}\n\t\t\t\tbody.activate();\n\t\t\t\tthis._simulationEnabled = true;\n\t\t\t}\n\t\t}\n\t}\n\tdisableSimulation() {\n\t\tconst body = this._body;\n\t\tif (body && this._simulationEnabled) {\n\t\t\tconst system = this.system;\n\t\t\tlet idx = system._compounds.indexOf(this.entity.collision);\n\t\t\tif (idx > -1) {\n\t\t\t\tsystem._compounds.splice(idx, 1);\n\t\t\t}\n\t\t\tidx = system._dynamic.indexOf(this);\n\t\t\tif (idx > -1) {\n\t\t\t\tsystem._dynamic.splice(idx, 1);\n\t\t\t}\n\t\t\tidx = system._kinematic.indexOf(this);\n\t\t\tif (idx > -1) {\n\t\t\t\tsystem._kinematic.splice(idx, 1);\n\t\t\t}\n\t\t\tsystem.removeBody(body);\n\t\t\tbody.forceActivationState(BODYSTATE_DISABLE_SIMULATION);\n\t\t\tthis._simulationEnabled = false;\n\t\t}\n\t}\n\tapplyForce(x, y, z, px, py, pz) {\n\t\tconst body = this._body;\n\t\tif (body) {\n\t\t\tbody.activate();\n\t\t\tif (x instanceof Vec3) {\n\t\t\t\t_ammoVec1.setValue(x.x, x.y, x.z);\n\t\t\t} else {\n\t\t\t\t_ammoVec1.setValue(x, y, z);\n\t\t\t}\n\t\t\tif (y instanceof Vec3) {\n\t\t\t\t_ammoVec2.setValue(y.x, y.y, y.z);\n\t\t\t} else if (px !== undefined) {\n\t\t\t\t_ammoVec2.setValue(px, py, pz);\n\t\t\t} else {\n\t\t\t\t_ammoVec2.setValue(0, 0, 0);\n\t\t\t}\n\t\t\tbody.applyForce(_ammoVec1, _ammoVec2);\n\t\t}\n\t}\n\tapplyTorque(x, y, z) {\n\t\tconst body = this._body;\n\t\tif (body) {\n\t\t\tbody.activate();\n\t\t\tif (x instanceof Vec3) {\n\t\t\t\t_ammoVec1.setValue(x.x, x.y, x.z);\n\t\t\t} else {\n\t\t\t\t_ammoVec1.setValue(x, y, z);\n\t\t\t}\n\t\t\tbody.applyTorque(_ammoVec1);\n\t\t}\n\t}\n\tapplyImpulse(x, y, z, px, py, pz) {\n\t\tconst body = this._body;\n\t\tif (body) {\n\t\t\tbody.activate();\n\t\t\tif (x instanceof Vec3) {\n\t\t\t\t_ammoVec1.setValue(x.x, x.y, x.z);\n\t\t\t} else {\n\t\t\t\t_ammoVec1.setValue(x, y, z);\n\t\t\t}\n\t\t\tif (y instanceof Vec3) {\n\t\t\t\t_ammoVec2.setValue(y.x, y.y, y.z);\n\t\t\t} else if (px !== undefined) {\n\t\t\t\t_ammoVec2.setValue(px, py, pz);\n\t\t\t} else {\n\t\t\t\t_ammoVec2.setValue(0, 0, 0);\n\t\t\t}\n\t\t\tbody.applyImpulse(_ammoVec1, _ammoVec2);\n\t\t}\n\t}\n\tapplyTorqueImpulse(x, y, z) {\n\t\tconst body = this._body;\n\t\tif (body) {\n\t\t\tbody.activate();\n\t\t\tif (x instanceof Vec3) {\n\t\t\t\t_ammoVec1.setValue(x.x, x.y, x.z);\n\t\t\t} else {\n\t\t\t\t_ammoVec1.setValue(x, y, z);\n\t\t\t}\n\t\t\tbody.applyTorqueImpulse(_ammoVec1);\n\t\t}\n\t}\n\tisStatic() {\n\t\treturn this._type === BODYTYPE_STATIC;\n\t}\n\tisStaticOrKinematic() {\n\t\treturn this._type === BODYTYPE_STATIC || this._type === BODYTYPE_KINEMATIC;\n\t}\n\tisKinematic() {\n\t\treturn this._type === BODYTYPE_KINEMATIC;\n\t}\n\t_getEntityTransform(transform) {\n\t\tconst entity = this.entity;\n\t\tconst component = entity.collision;\n\t\tif (component) {\n\t\t\tconst bodyPos = component.getShapePosition();\n\t\t\tconst bodyRot = component.getShapeRotation();\n\t\t\t_ammoVec1.setValue(bodyPos.x, bodyPos.y, bodyPos.z);\n\t\t\t_ammoQuat.setValue(bodyRot.x, bodyRot.y, bodyRot.z, bodyRot.w);\n\t\t} else {\n\t\t\tconst pos = entity.getPosition();\n\t\t\tconst rot = entity.getRotation();\n\t\t\t_ammoVec1.setValue(pos.x, pos.y, pos.z);\n\t\t\t_ammoQuat.setValue(rot.x, rot.y, rot.z, rot.w);\n\t\t}\n\t\ttransform.setOrigin(_ammoVec1);\n\t\ttransform.setRotation(_ammoQuat);\n\t}\n\tsyncEntityToBody() {\n\t\tconst body = this._body;\n\t\tif (body) {\n\t\t\tthis._getEntityTransform(_ammoTransform);\n\t\t\tbody.setWorldTransform(_ammoTransform);\n\t\t\tif (this._type === BODYTYPE_KINEMATIC) {\n\t\t\t\tconst motionState = body.getMotionState();\n\t\t\t\tif (motionState) {\n\t\t\t\t\tmotionState.setWorldTransform(_ammoTransform);\n\t\t\t\t}\n\t\t\t}\n\t\t\tbody.activate();\n\t\t}\n\t}\n\t_updateDynamic() {\n\t\tconst body = this._body;\n\t\tif (body.isActive()) {\n\t\t\tconst motionState = body.getMotionState();\n\t\t\tif (motionState) {\n\t\t\t\tconst entity = this.entity;\n\t\t\t\tmotionState.getWorldTransform(_ammoTransform);\n\t\t\t\tconst p = _ammoTransform.getOrigin();\n\t\t\t\tconst q = _ammoTransform.getRotation();\n\t\t\t\tconst component = entity.collision;\n\t\t\t\tif (component && component._hasOffset) {\n\t\t\t\t\tconst lo = component.data.linearOffset;\n\t\t\t\t\tconst ao = component.data.angularOffset;\n\t\t\t\t\tconst invertedAo = _quat2.copy(ao).invert();\n\t\t\t\t\tconst entityRot = _quat1.set(q.x(), q.y(), q.z(), q.w()).mul(invertedAo);\n\t\t\t\t\tentityRot.transformVector(lo, _vec3);\n\t\t\t\t\tentity.setPosition(p.x() - _vec3.x, p.y() - _vec3.y, p.z() - _vec3.z);\n\t\t\t\t\tentity.setRotation(entityRot);\n\t\t\t\t} else {\n\t\t\t\t\tentity.setPosition(p.x(), p.y(), p.z());\n\t\t\t\t\tentity.setRotation(q.x(), q.y(), q.z(), q.w());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t_updateKinematic() {\n\t\tconst motionState = this._body.getMotionState();\n\t\tif (motionState) {\n\t\t\tthis._getEntityTransform(_ammoTransform);\n\t\t\tmotionState.setWorldTransform(_ammoTransform);\n\t\t}\n\t}\n\tteleport(x, y, z, rx, ry, rz) {\n\t\tif (x instanceof Vec3) {\n\t\t\tthis.entity.setPosition(x);\n\t\t} else {\n\t\t\tthis.entity.setPosition(x, y, z);\n\t\t}\n\t\tif (y instanceof Quat) {\n\t\t\tthis.entity.setRotation(y);\n\t\t} else if (y instanceof Vec3) {\n\t\t\tthis.entity.setEulerAngles(y);\n\t\t} else if (rx !== undefined) {\n\t\t\tthis.entity.setEulerAngles(rx, ry, rz);\n\t\t}\n\t\tthis.syncEntityToBody();\n\t}\n\tonEnable() {\n\t\tif (!this._body) {\n\t\t\tthis.createBody();\n\t\t}\n\t\tthis.enableSimulation();\n\t}\n\tonDisable() {\n\t\tthis.disableSimulation();\n\t}\n}\n\nexport { RigidBodyComponent };\n","class RigidBodyComponentData {\n\tconstructor() {\n\t\tthis.enabled = true;\n\t}\n}\n\nexport { RigidBodyComponentData };\n","import '../../../core/time.js';\nimport { ObjectPool } from '../../../core/object-pool.js';\nimport '../../../core/tracing.js';\nimport { Vec3 } from '../../../core/math/vec3.js';\nimport { Component } from '../component.js';\nimport { ComponentSystem } from '../system.js';\nimport { BODYFLAG_NORESPONSE_OBJECT } from './constants.js';\nimport { RigidBodyComponent } from './component.js';\nimport { RigidBodyComponentData } from './data.js';\n\nlet ammoRayStart, ammoRayEnd;\nclass RaycastResult {\n\tconstructor(entity, point, normal, hitFraction) {\n\t\tthis.entity = entity;\n\t\tthis.point = point;\n\t\tthis.normal = normal;\n\t\tthis.hitFraction = hitFraction;\n\t}\n}\nclass SingleContactResult {\n\tconstructor(a, b, contactPoint) {\n\t\tif (arguments.length === 0) {\n\t\t\tthis.a = null;\n\t\t\tthis.b = null;\n\t\t\tthis.impulse = 0;\n\t\t\tthis.localPointA = new Vec3();\n\t\t\tthis.localPointB = new Vec3();\n\t\t\tthis.pointA = new Vec3();\n\t\t\tthis.pointB = new Vec3();\n\t\t\tthis.normal = new Vec3();\n\t\t} else {\n\t\t\tthis.a = a;\n\t\t\tthis.b = b;\n\t\t\tthis.impulse = contactPoint.impulse;\n\t\t\tthis.localPointA = contactPoint.localPoint;\n\t\t\tthis.localPointB = contactPoint.localPointOther;\n\t\t\tthis.pointA = contactPoint.point;\n\t\t\tthis.pointB = contactPoint.pointOther;\n\t\t\tthis.normal = contactPoint.normal;\n\t\t}\n\t}\n}\nclass ContactPoint {\n\tconstructor(localPoint = new Vec3(), localPointOther = new Vec3(), point = new Vec3(), pointOther = new Vec3(), normal = new Vec3(), impulse = 0) {\n\t\tthis.localPoint = localPoint;\n\t\tthis.localPointOther = localPointOther;\n\t\tthis.point = point;\n\t\tthis.pointOther = pointOther;\n\t\tthis.normal = normal;\n\t\tthis.impulse = impulse;\n\t}\n}\nclass ContactResult {\n\tconstructor(other, contacts) {\n\t\tthis.other = other;\n\t\tthis.contacts = contacts;\n\t}\n}\nconst _schema = ['enabled'];\nclass RigidBodyComponentSystem extends ComponentSystem {\n\tconstructor(app) {\n\t\tsuper(app);\n\t\tthis.maxSubSteps = 10;\n\t\tthis.fixedTimeStep = 1 / 60;\n\t\tthis.gravity = new Vec3(0, -9.81, 0);\n\t\tthis._gravityFloat32 = new Float32Array(3);\n\t\tthis._dynamic = [];\n\t\tthis._kinematic = [];\n\t\tthis._triggers = [];\n\t\tthis._compounds = [];\n\t\tthis.id = 'rigidbody';\n\t\tthis._stats = app.stats.frame;\n\t\tthis.ComponentType = RigidBodyComponent;\n\t\tthis.DataType = RigidBodyComponentData;\n\t\tthis.contactPointPool = null;\n\t\tthis.contactResultPool = null;\n\t\tthis.singleContactResultPool = null;\n\t\tthis.schema = _schema;\n\t\tthis.collisions = {};\n\t\tthis.frameCollisions = {};\n\t\tthis.on('beforeremove', this.onBeforeRemove, this);\n\t}\n\tonLibraryLoaded() {\n\t\tif (typeof Ammo !== 'undefined') {\n\t\t\tthis.collisionConfiguration = new Ammo.btDefaultCollisionConfiguration();\n\t\t\tthis.dispatcher = new Ammo.btCollisionDispatcher(this.collisionConfiguration);\n\t\t\tthis.overlappingPairCache = new Ammo.btDbvtBroadphase();\n\t\t\tthis.solver = new Ammo.btSequentialImpulseConstraintSolver();\n\t\t\tthis.dynamicsWorld = new Ammo.btDiscreteDynamicsWorld(this.dispatcher, this.overlappingPairCache, this.solver, this.collisionConfiguration);\n\t\t\tif (this.dynamicsWorld.setInternalTickCallback) {\n\t\t\t\tconst checkForCollisionsPointer = Ammo.addFunction(this._checkForCollisions.bind(this), 'vif');\n\t\t\t\tthis.dynamicsWorld.setInternalTickCallback(checkForCollisionsPointer);\n\t\t\t}\n\t\t\tammoRayStart = new Ammo.btVector3();\n\t\t\tammoRayEnd = new Ammo.btVector3();\n\t\t\tRigidBodyComponent.onLibraryLoaded();\n\t\t\tthis.contactPointPool = new ObjectPool(ContactPoint, 1);\n\t\t\tthis.contactResultPool = new ObjectPool(ContactResult, 1);\n\t\t\tthis.singleContactResultPool = new ObjectPool(SingleContactResult, 1);\n\t\t\tthis.app.systems.on('update', this.onUpdate, this);\n\t\t} else {\n\t\t\tthis.app.systems.off('update', this.onUpdate, this);\n\t\t}\n\t}\n\tinitializeComponentData(component, data, properties) {\n\t\tconst props = ['mass', 'linearDamping', 'angularDamping', 'linearFactor', 'angularFactor', 'friction', 'rollingFriction', 'restitution', 'type', 'group', 'mask'];\n\t\tfor (const property of props) {\n\t\t\tif (data.hasOwnProperty(property)) {\n\t\t\t\tconst value = data[property];\n\t\t\t\tif (Array.isArray(value)) {\n\t\t\t\t\tcomponent[property] = new Vec3(value[0], value[1], value[2]);\n\t\t\t\t} else {\n\t\t\t\t\tcomponent[property] = value;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tsuper.initializeComponentData(component, data, ['enabled']);\n\t}\n\tcloneComponent(entity, clone) {\n\t\tconst rigidbody = entity.rigidbody;\n\t\tconst data = {\n\t\t\tenabled: rigidbody.enabled,\n\t\t\tmass: rigidbody.mass,\n\t\t\tlinearDamping: rigidbody.linearDamping,\n\t\t\tangularDamping: rigidbody.angularDamping,\n\t\t\tlinearFactor: [rigidbody.linearFactor.x, rigidbody.linearFactor.y, rigidbody.linearFactor.z],\n\t\t\tangularFactor: [rigidbody.angularFactor.x, rigidbody.angularFactor.y, rigidbody.angularFactor.z],\n\t\t\tfriction: rigidbody.friction,\n\t\t\trollingFriction: rigidbody.rollingFriction,\n\t\t\trestitution: rigidbody.restitution,\n\t\t\ttype: rigidbody.type,\n\t\t\tgroup: rigidbody.group,\n\t\t\tmask: rigidbody.mask\n\t\t};\n\t\treturn this.addComponent(clone, data);\n\t}\n\tonBeforeRemove(entity, component) {\n\t\tif (component.enabled) {\n\t\t\tcomponent.enabled = false;\n\t\t}\n\t\tif (component.body) {\n\t\t\tthis.destroyBody(component.body);\n\t\t\tcomponent.body = null;\n\t\t}\n\t}\n\taddBody(body, group, mask) {\n\t\tif (group !== undefined && mask !== undefined) {\n\t\t\tthis.dynamicsWorld.addRigidBody(body, group, mask);\n\t\t} else {\n\t\t\tthis.dynamicsWorld.addRigidBody(body);\n\t\t}\n\t}\n\tremoveBody(body) {\n\t\tthis.dynamicsWorld.removeRigidBody(body);\n\t}\n\tcreateBody(mass, shape, transform) {\n\t\tconst localInertia = new Ammo.btVector3(0, 0, 0);\n\t\tif (mass !== 0) {\n\t\t\tshape.calculateLocalInertia(mass, localInertia);\n\t\t}\n\t\tconst motionState = new Ammo.btDefaultMotionState(transform);\n\t\tconst bodyInfo = new Ammo.btRigidBodyConstructionInfo(mass, motionState, shape, localInertia);\n\t\tconst body = new Ammo.btRigidBody(bodyInfo);\n\t\tAmmo.destroy(bodyInfo);\n\t\tAmmo.destroy(localInertia);\n\t\treturn body;\n\t}\n\tdestroyBody(body) {\n\t\tconst motionState = body.getMotionState();\n\t\tif (motionState) {\n\t\t\tAmmo.destroy(motionState);\n\t\t}\n\t\tAmmo.destroy(body);\n\t}\n\traycastFirst(start, end, options = {}) {\n\t\tif (options.filterTags || options.filterCallback) {\n\t\t\toptions.sort = true;\n\t\t\treturn this.raycastAll(start, end, options)[0] || null;\n\t\t}\n\t\tlet result = null;\n\t\tammoRayStart.setValue(start.x, start.y, start.z);\n\t\tammoRayEnd.setValue(end.x, end.y, end.z);\n\t\tconst rayCallback = new Ammo.ClosestRayResultCallback(ammoRayStart, ammoRayEnd);\n\t\tif (typeof options.filterCollisionGroup === 'number') {\n\t\t\trayCallback.set_m_collisionFilterGroup(options.filterCollisionGroup);\n\t\t}\n\t\tif (typeof options.filterCollisionMask === 'number') {\n\t\t\trayCallback.set_m_collisionFilterMask(options.filterCollisionMask);\n\t\t}\n\t\tthis.dynamicsWorld.rayTest(ammoRayStart, ammoRayEnd, rayCallback);\n\t\tif (rayCallback.hasHit()) {\n\t\t\tconst collisionObj = rayCallback.get_m_collisionObject();\n\t\t\tconst body = Ammo.castObject(collisionObj, Ammo.btRigidBody);\n\t\t\tif (body) {\n\t\t\t\tconst point = rayCallback.get_m_hitPointWorld();\n\t\t\t\tconst normal = rayCallback.get_m_hitNormalWorld();\n\t\t\t\tresult = new RaycastResult(body.entity, new Vec3(point.x(), point.y(), point.z()), new Vec3(normal.x(), normal.y(), normal.z()), rayCallback.get_m_closestHitFraction());\n\t\t\t}\n\t\t}\n\t\tAmmo.destroy(rayCallback);\n\t\treturn result;\n\t}\n\traycastAll(start, end, options = {}) {\n\t\tconst results = [];\n\t\tammoRayStart.setValue(start.x, start.y, start.z);\n\t\tammoRayEnd.setValue(end.x, end.y, end.z);\n\t\tconst rayCallback = new Ammo.AllHitsRayResultCallback(ammoRayStart, ammoRayEnd);\n\t\tif (typeof options.filterCollisionGroup === 'number') {\n\t\t\trayCallback.set_m_collisionFilterGroup(options.filterCollisionGroup);\n\t\t}\n\t\tif (typeof options.filterCollisionMask === 'number') {\n\t\t\trayCallback.set_m_collisionFilterMask(options.filterCollisionMask);\n\t\t}\n\t\tthis.dynamicsWorld.rayTest(ammoRayStart, ammoRayEnd, rayCallback);\n\t\tif (rayCallback.hasHit()) {\n\t\t\tconst collisionObjs = rayCallback.get_m_collisionObjects();\n\t\t\tconst points = rayCallback.get_m_hitPointWorld();\n\t\t\tconst normals = rayCallback.get_m_hitNormalWorld();\n\t\t\tconst hitFractions = rayCallback.get_m_hitFractions();\n\t\t\tconst numHits = collisionObjs.size();\n\t\t\tfor (let i = 0; i < numHits; i++) {\n\t\t\t\tconst body = Ammo.castObject(collisionObjs.at(i), Ammo.btRigidBody);\n\t\t\t\tif (body && body.entity) {\n\t\t\t\t\tif (options.filterTags && !body.entity.tags.has(...options.filterTags) || options.filterCallback && !options.filterCallback(body.entity)) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tconst point = points.at(i);\n\t\t\t\t\tconst normal = normals.at(i);\n\t\t\t\t\tconst result = new RaycastResult(body.entity, new Vec3(point.x(), point.y(), point.z()), new Vec3(normal.x(), normal.y(), normal.z()), hitFractions.at(i));\n\t\t\t\t\tresults.push(result);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (options.sort) {\n\t\t\t\tresults.sort((a, b) => a.hitFraction - b.hitFraction);\n\t\t\t}\n\t\t}\n\t\tAmmo.destroy(rayCallback);\n\t\treturn results;\n\t}\n\t_storeCollision(entity, other) {\n\t\tlet isNewCollision = false;\n\t\tconst guid = entity.getGuid();\n\t\tthis.collisions[guid] = this.collisions[guid] || {\n\t\t\tothers: [],\n\t\t\tentity: entity\n\t\t};\n\t\tif (this.collisions[guid].others.indexOf(other) < 0) {\n\t\t\tthis.collisions[guid].others.push(other);\n\t\t\tisNewCollision = true;\n\t\t}\n\t\tthis.frameCollisions[guid] = this.frameCollisions[guid] || {\n\t\t\tothers: [],\n\t\t\tentity: entity\n\t\t};\n\t\tthis.frameCollisions[guid].others.push(other);\n\t\treturn isNewCollision;\n\t}\n\t_createContactPointFromAmmo(contactPoint) {\n\t\tconst localPointA = contactPoint.get_m_localPointA();\n\t\tconst localPointB = contactPoint.get_m_localPointB();\n\t\tconst positionWorldOnA = contactPoint.getPositionWorldOnA();\n\t\tconst positionWorldOnB = contactPoint.getPositionWorldOnB();\n\t\tconst normalWorldOnB = contactPoint.get_m_normalWorldOnB();\n\t\tconst contact = this.contactPointPool.allocate();\n\t\tcontact.localPoint.set(localPointA.x(), localPointA.y(), localPointA.z());\n\t\tcontact.localPointOther.set(localPointB.x(), localPointB.y(), localPointB.z());\n\t\tcontact.point.set(positionWorldOnA.x(), positionWorldOnA.y(), positionWorldOnA.z());\n\t\tcontact.pointOther.set(positionWorldOnB.x(), positionWorldOnB.y(), positionWorldOnB.z());\n\t\tcontact.normal.set(normalWorldOnB.x(), normalWorldOnB.y(), normalWorldOnB.z());\n\t\tcontact.impulse = contactPoint.getAppliedImpulse();\n\t\treturn contact;\n\t}\n\t_createReverseContactPointFromAmmo(contactPoint) {\n\t\tconst localPointA = contactPoint.get_m_localPointA();\n\t\tconst localPointB = contactPoint.get_m_localPointB();\n\t\tconst positionWorldOnA = contactPoint.getPositionWorldOnA();\n\t\tconst positionWorldOnB = contactPoint.getPositionWorldOnB();\n\t\tconst normalWorldOnB = contactPoint.get_m_normalWorldOnB();\n\t\tconst contact = this.contactPointPool.allocate();\n\t\tcontact.localPointOther.set(localPointA.x(), localPointA.y(), localPointA.z());\n\t\tcontact.localPoint.set(localPointB.x(), localPointB.y(), localPointB.z());\n\t\tcontact.pointOther.set(positionWorldOnA.x(), positionWorldOnA.y(), positionWorldOnA.z());\n\t\tcontact.point.set(positionWorldOnB.x(), positionWorldOnB.y(), positionWorldOnB.z());\n\t\tcontact.normal.set(normalWorldOnB.x(), normalWorldOnB.y(), normalWorldOnB.z());\n\t\tcontact.impulse = contactPoint.getAppliedImpulse();\n\t\treturn contact;\n\t}\n\t_createSingleContactResult(a, b, contactPoint) {\n\t\tconst result = this.singleContactResultPool.allocate();\n\t\tresult.a = a;\n\t\tresult.b = b;\n\t\tresult.localPointA = contactPoint.localPoint;\n\t\tresult.localPointB = contactPoint.localPointOther;\n\t\tresult.pointA = contactPoint.point;\n\t\tresult.pointB = contactPoint.pointOther;\n\t\tresult.normal = contactPoint.normal;\n\t\tresult.impulse = contactPoint.impulse;\n\t\treturn result;\n\t}\n\t_createContactResult(other, contacts) {\n\t\tconst result = this.contactResultPool.allocate();\n\t\tresult.other = other;\n\t\tresult.contacts = contacts;\n\t\treturn result;\n\t}\n\t_cleanOldCollisions() {\n\t\tfor (const guid in this.collisions) {\n\t\t\tif (this.collisions.hasOwnProperty(guid)) {\n\t\t\t\tconst frameCollision = this.frameCollisions[guid];\n\t\t\t\tconst collision = this.collisions[guid];\n\t\t\t\tconst entity = collision.entity;\n\t\t\t\tconst entityCollision = entity.collision;\n\t\t\t\tconst entityRigidbody = entity.rigidbody;\n\t\t\t\tconst others = collision.others;\n\t\t\t\tconst length = others.length;\n\t\t\t\tlet i = length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\tconst other = others[i];\n\t\t\t\t\tif (!frameCollision || frameCollision.others.indexOf(other) < 0) {\n\t\t\t\t\t\tothers.splice(i, 1);\n\t\t\t\t\t\tif (entity.trigger) {\n\t\t\t\t\t\t\tif (entityCollision) {\n\t\t\t\t\t\t\t\tentityCollision.fire('triggerleave', other);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (other.rigidbody) {\n\t\t\t\t\t\t\t\tother.rigidbody.fire('triggerleave', entity);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (!other.trigger) {\n\t\t\t\t\t\t\tif (entityRigidbody) {\n\t\t\t\t\t\t\t\tentityRigidbody.fire('collisionend', other);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (entityCollision) {\n\t\t\t\t\t\t\t\tentityCollision.fire('collisionend', other);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (others.length === 0) {\n\t\t\t\t\tdelete this.collisions[guid];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t_hasContactEvent(entity) {\n\t\tconst c = entity.collision;\n\t\tif (c && (c.hasEvent('collisionstart') || c.hasEvent('collisionend') || c.hasEvent('contact'))) {\n\t\t\treturn true;\n\t\t}\n\t\tconst r = entity.rigidbody;\n\t\treturn r && (r.hasEvent('collisionstart') || r.hasEvent('collisionend') || r.hasEvent('contact'));\n\t}\n\t_checkForCollisions(world, timeStep) {\n\t\tconst dynamicsWorld = Ammo.wrapPointer(world, Ammo.btDynamicsWorld);\n\t\tconst dispatcher = dynamicsWorld.getDispatcher();\n\t\tconst numManifolds = dispatcher.getNumManifolds();\n\t\tthis.frameCollisions = {};\n\t\tfor (let i = 0; i < numManifolds; i++) {\n\t\t\tconst manifold = dispatcher.getManifoldByIndexInternal(i);\n\t\t\tconst body0 = manifold.getBody0();\n\t\t\tconst body1 = manifold.getBody1();\n\t\t\tconst wb0 = Ammo.castObject(body0, Ammo.btRigidBody);\n\t\t\tconst wb1 = Ammo.castObject(body1, Ammo.btRigidBody);\n\t\t\tconst e0 = wb0.entity;\n\t\t\tconst e1 = wb1.entity;\n\t\t\tif (!e0 || !e1) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst flags0 = wb0.getCollisionFlags();\n\t\t\tconst flags1 = wb1.getCollisionFlags();\n\t\t\tconst numContacts = manifold.getNumContacts();\n\t\t\tconst forwardContacts = [];\n\t\t\tconst reverseContacts = [];\n\t\t\tlet newCollision;\n\t\t\tif (numContacts > 0) {\n\t\t\t\tif (flags0 & BODYFLAG_NORESPONSE_OBJECT || flags1 & BODYFLAG_NORESPONSE_OBJECT) {\n\t\t\t\t\tconst e0Events = e0.collision && (e0.collision.hasEvent('triggerenter') || e0.collision.hasEvent('triggerleave'));\n\t\t\t\t\tconst e1Events = e1.collision && (e1.collision.hasEvent('triggerenter') || e1.collision.hasEvent('triggerleave'));\n\t\t\t\t\tconst e0BodyEvents = e0.rigidbody && (e0.rigidbody.hasEvent('triggerenter') || e0.rigidbody.hasEvent('triggerleave'));\n\t\t\t\t\tconst e1BodyEvents = e1.rigidbody && (e1.rigidbody.hasEvent('triggerenter') || e1.rigidbody.hasEvent('triggerleave'));\n\t\t\t\t\tif (e0Events) {\n\t\t\t\t\t\tnewCollision = this._storeCollision(e0, e1);\n\t\t\t\t\t\tif (newCollision && !(flags1 & BODYFLAG_NORESPONSE_OBJECT)) {\n\t\t\t\t\t\t\te0.collision.fire('triggerenter', e1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (e1Events) {\n\t\t\t\t\t\tnewCollision = this._storeCollision(e1, e0);\n\t\t\t\t\t\tif (newCollision && !(flags0 & BODYFLAG_NORESPONSE_OBJECT)) {\n\t\t\t\t\t\t\te1.collision.fire('triggerenter', e0);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (e0BodyEvents) {\n\t\t\t\t\t\tif (!newCollision) {\n\t\t\t\t\t\t\tnewCollision = this._storeCollision(e1, e0);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (newCollision) {\n\t\t\t\t\t\t\te0.rigidbody.fire('triggerenter', e1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (e1BodyEvents) {\n\t\t\t\t\t\tif (!newCollision) {\n\t\t\t\t\t\t\tnewCollision = this._storeCollision(e0, e1);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (newCollision) {\n\t\t\t\t\t\t\te1.rigidbody.fire('triggerenter', e0);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconst e0Events = this._hasContactEvent(e0);\n\t\t\t\t\tconst e1Events = this._hasContactEvent(e1);\n\t\t\t\t\tconst globalEvents = this.hasEvent('contact');\n\t\t\t\t\tif (globalEvents || e0Events || e1Events) {\n\t\t\t\t\t\tfor (let j = 0; j < numContacts; j++) {\n\t\t\t\t\t\t\tconst btContactPoint = manifold.getContactPoint(j);\n\t\t\t\t\t\t\tconst contactPoint = this._createContactPointFromAmmo(btContactPoint);\n\t\t\t\t\t\t\tif (e0Events || e1Events) {\n\t\t\t\t\t\t\t\tforwardContacts.push(contactPoint);\n\t\t\t\t\t\t\t\tconst reverseContactPoint = this._createReverseContactPointFromAmmo(btContactPoint);\n\t\t\t\t\t\t\t\treverseContacts.push(reverseContactPoint);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (globalEvents) {\n\t\t\t\t\t\t\t\tconst result = this._createSingleContactResult(e0, e1, contactPoint);\n\t\t\t\t\t\t\t\tthis.fire('contact', result);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (e0Events) {\n\t\t\t\t\t\t\tconst forwardResult = this._createContactResult(e1, forwardContacts);\n\t\t\t\t\t\t\tnewCollision = this._storeCollision(e0, e1);\n\t\t\t\t\t\t\tif (e0.collision) {\n\t\t\t\t\t\t\t\te0.collision.fire('contact', forwardResult);\n\t\t\t\t\t\t\t\tif (newCollision) {\n\t\t\t\t\t\t\t\t\te0.collision.fire('collisionstart', forwardResult);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (e0.rigidbody) {\n\t\t\t\t\t\t\t\te0.rigidbody.fire('contact', forwardResult);\n\t\t\t\t\t\t\t\tif (newCollision) {\n\t\t\t\t\t\t\t\t\te0.rigidbody.fire('collisionstart', forwardResult);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (e1Events) {\n\t\t\t\t\t\t\tconst reverseResult = this._createContactResult(e0, reverseContacts);\n\t\t\t\t\t\t\tnewCollision = this._storeCollision(e1, e0);\n\t\t\t\t\t\t\tif (e1.collision) {\n\t\t\t\t\t\t\t\te1.collision.fire('contact', reverseResult);\n\t\t\t\t\t\t\t\tif (newCollision) {\n\t\t\t\t\t\t\t\t\te1.collision.fire('collisionstart', reverseResult);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (e1.rigidbody) {\n\t\t\t\t\t\t\t\te1.rigidbody.fire('contact', reverseResult);\n\t\t\t\t\t\t\t\tif (newCollision) {\n\t\t\t\t\t\t\t\t\te1.rigidbody.fire('collisionstart', reverseResult);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis._cleanOldCollisions();\n\t\tthis.contactPointPool.freeAll();\n\t\tthis.contactResultPool.freeAll();\n\t\tthis.singleContactResultPool.freeAll();\n\t}\n\tonUpdate(dt) {\n\t\tlet i, len;\n\t\tthis._gravityFloat32[0] = this.gravity.x;\n\t\tthis._gravityFloat32[1] = this.gravity.y;\n\t\tthis._gravityFloat32[2] = this.gravity.z;\n\t\tconst gravity = this.dynamicsWorld.getGravity();\n\t\tif (gravity.x() !== this._gravityFloat32[0] || gravity.y() !== this._gravityFloat32[1] || gravity.z() !== this._gravityFloat32[2]) {\n\t\t\tgravity.setValue(this.gravity.x, this.gravity.y, this.gravity.z);\n\t\t\tthis.dynamicsWorld.setGravity(gravity);\n\t\t}\n\t\tconst triggers = this._triggers;\n\t\tfor (i = 0, len = triggers.length; i < len; i++) {\n\t\t\ttriggers[i].updateTransform();\n\t\t}\n\t\tconst compounds = this._compounds;\n\t\tfor (i = 0, len = compounds.length; i < len; i++) {\n\t\t\tcompounds[i]._updateCompound();\n\t\t}\n\t\tconst kinematic = this._kinematic;\n\t\tfor (i = 0, len = kinematic.length; i < len; i++) {\n\t\t\tkinematic[i]._updateKinematic();\n\t\t}\n\t\tthis.dynamicsWorld.stepSimulation(dt, this.maxSubSteps, this.fixedTimeStep);\n\t\tconst dynamic = this._dynamic;\n\t\tfor (i = 0, len = dynamic.length; i < len; i++) {\n\t\t\tdynamic[i]._updateDynamic();\n\t\t}\n\t\tif (!this.dynamicsWorld.setInternalTickCallback) this._checkForCollisions(Ammo.getPointer(this.dynamicsWorld), dt);\n\t}\n\tdestroy() {\n\t\tsuper.destroy();\n\t\tthis.app.systems.off('update', this.onUpdate, this);\n\t\tif (typeof Ammo !== 'undefined') {\n\t\t\tAmmo.destroy(this.dynamicsWorld);\n\t\t\tAmmo.destroy(this.solver);\n\t\t\tAmmo.destroy(this.overlappingPairCache);\n\t\t\tAmmo.destroy(this.dispatcher);\n\t\t\tAmmo.destroy(this.collisionConfiguration);\n\t\t\tthis.dynamicsWorld = null;\n\t\t\tthis.solver = null;\n\t\t\tthis.overlappingPairCache = null;\n\t\t\tthis.dispatcher = null;\n\t\t\tthis.collisionConfiguration = null;\n\t\t}\n\t}\n}\nComponent._buildAccessors(RigidBodyComponent.prototype, _schema);\n\nexport { ContactPoint, ContactResult, RaycastResult, RigidBodyComponentSystem, SingleContactResult };\n","const SCALEMODE_NONE = 'none';\nconst SCALEMODE_BLEND = 'blend';\n\nexport { SCALEMODE_BLEND, SCALEMODE_NONE };\n","import '../../../core/tracing.js';\nimport { Mat4 } from '../../../core/math/mat4.js';\nimport { Vec2 } from '../../../core/math/vec2.js';\nimport { Entity } from '../../entity.js';\nimport { SCALEMODE_NONE, SCALEMODE_BLEND } from './constants.js';\nimport { Component } from '../component.js';\n\nconst _transform = new Mat4();\nclass ScreenComponent extends Component {\n\tconstructor(system, entity) {\n\t\tsuper(system, entity);\n\t\tthis._resolution = new Vec2(640, 320);\n\t\tthis._referenceResolution = new Vec2(640, 320);\n\t\tthis._scaleMode = SCALEMODE_NONE;\n\t\tthis.scale = 1;\n\t\tthis._scaleBlend = 0.5;\n\t\tthis._priority = 0;\n\t\tthis._screenSpace = false;\n\t\tthis.cull = this._screenSpace;\n\t\tthis._screenMatrix = new Mat4();\n\t\tthis._elements = new Set();\n\t\tsystem.app.graphicsDevice.on('resizecanvas', this._onResize, this);\n\t}\n\tsyncDrawOrder() {\n\t\tthis.system.queueDrawOrderSync(this.entity.getGuid(), this._processDrawOrderSync, this);\n\t}\n\t_recurseDrawOrderSync(e, i) {\n\t\tif (!(e instanceof Entity)) {\n\t\t\treturn i;\n\t\t}\n\t\tif (e.element) {\n\t\t\tconst prevDrawOrder = e.element.drawOrder;\n\t\t\te.element.drawOrder = i++;\n\t\t\tif (e.element._batchGroupId >= 0 && prevDrawOrder !== e.element.drawOrder) {\n\t\t\t\tvar _this$system$app$batc;\n\t\t\t\t(_this$system$app$batc = this.system.app.batcher) == null || _this$system$app$batc.markGroupDirty(e.element._batchGroupId);\n\t\t\t}\n\t\t}\n\t\tif (e.particlesystem) {\n\t\t\te.particlesystem.drawOrder = i++;\n\t\t}\n\t\tconst children = e.children;\n\t\tfor (let j = 0; j < children.length; j++) {\n\t\t\ti = this._recurseDrawOrderSync(children[j], i);\n\t\t}\n\t\treturn i;\n\t}\n\t_processDrawOrderSync() {\n\t\tconst i = 1;\n\t\tthis._recurseDrawOrderSync(this.entity, i);\n\t\tthis.fire('syncdraworder');\n\t}\n\t_calcProjectionMatrix() {\n\t\tconst w = this._resolution.x / this.scale;\n\t\tconst h = this._resolution.y / this.scale;\n\t\tconst left = 0;\n\t\tconst right = w;\n\t\tconst bottom = -h;\n\t\tconst top = 0;\n\t\tconst near = 1;\n\t\tconst far = -1;\n\t\tthis._screenMatrix.setOrtho(left, right, bottom, top, near, far);\n\t\tif (!this._screenSpace) {\n\t\t\t_transform.setScale(0.5 * w, 0.5 * h, 1);\n\t\t\tthis._screenMatrix.mul2(_transform, this._screenMatrix);\n\t\t}\n\t}\n\t_updateScale() {\n\t\tthis.scale = this._calcScale(this._resolution, this.referenceResolution);\n\t}\n\t_calcScale(resolution, referenceResolution) {\n\t\tconst lx = Math.log2((resolution.x || 1) / referenceResolution.x);\n\t\tconst ly = Math.log2((resolution.y || 1) / referenceResolution.y);\n\t\treturn Math.pow(2, lx * (1 - this._scaleBlend) + ly * this._scaleBlend);\n\t}\n\t_onResize(width, height) {\n\t\tif (this._screenSpace) {\n\t\t\tthis._resolution.set(width, height);\n\t\t\tthis.resolution = this._resolution;\n\t\t}\n\t}\n\t_bindElement(element) {\n\t\tthis._elements.add(element);\n\t}\n\t_unbindElement(element) {\n\t\tthis._elements.delete(element);\n\t}\n\tonRemove() {\n\t\tthis.system.app.graphicsDevice.off('resizecanvas', this._onResize, this);\n\t\tthis.fire('remove');\n\t\tthis._elements.forEach(element => element._onScreenRemove());\n\t\tthis._elements.clear();\n\t\tthis.off();\n\t}\n\tset resolution(value) {\n\t\tif (!this._screenSpace) {\n\t\t\tthis._resolution.set(value.x, value.y);\n\t\t} else {\n\t\t\tthis._resolution.set(this.system.app.graphicsDevice.width, this.system.app.graphicsDevice.height);\n\t\t}\n\t\tthis._updateScale();\n\t\tthis._calcProjectionMatrix();\n\t\tif (!this.entity._dirtyLocal) this.entity._dirtifyLocal();\n\t\tthis.fire('set:resolution', this._resolution);\n\t\tthis._elements.forEach(element => element._onScreenResize(this._resolution));\n\t}\n\tget resolution() {\n\t\treturn this._resolution;\n\t}\n\tset referenceResolution(value) {\n\t\tthis._referenceResolution.set(value.x, value.y);\n\t\tthis._updateScale();\n\t\tthis._calcProjectionMatrix();\n\t\tif (!this.entity._dirtyLocal) this.entity._dirtifyLocal();\n\t\tthis.fire('set:referenceresolution', this._resolution);\n\t\tthis._elements.forEach(element => element._onScreenResize(this._resolution));\n\t}\n\tget referenceResolution() {\n\t\tif (this._scaleMode === SCALEMODE_NONE) {\n\t\t\treturn this._resolution;\n\t\t}\n\t\treturn this._referenceResolution;\n\t}\n\tset screenSpace(value) {\n\t\tthis._screenSpace = value;\n\t\tif (this._screenSpace) {\n\t\t\tthis._resolution.set(this.system.app.graphicsDevice.width, this.system.app.graphicsDevice.height);\n\t\t}\n\t\tthis.resolution = this._resolution;\n\t\tif (!this.entity._dirtyLocal) this.entity._dirtifyLocal();\n\t\tthis.fire('set:screenspace', this._screenSpace);\n\t\tthis._elements.forEach(element => element._onScreenSpaceChange());\n\t}\n\tget screenSpace() {\n\t\treturn this._screenSpace;\n\t}\n\tset scaleMode(value) {\n\t\tif (value !== SCALEMODE_NONE && value !== SCALEMODE_BLEND) {\n\t\t\tvalue = SCALEMODE_NONE;\n\t\t}\n\t\tif (!this._screenSpace && value !== SCALEMODE_NONE) {\n\t\t\tvalue = SCALEMODE_NONE;\n\t\t}\n\t\tthis._scaleMode = value;\n\t\tthis.resolution = this._resolution;\n\t\tthis.fire('set:scalemode', this._scaleMode);\n\t}\n\tget scaleMode() {\n\t\treturn this._scaleMode;\n\t}\n\tset scaleBlend(value) {\n\t\tthis._scaleBlend = value;\n\t\tthis._updateScale();\n\t\tthis._calcProjectionMatrix();\n\t\tif (!this.entity._dirtyLocal) this.entity._dirtifyLocal();\n\t\tthis.fire('set:scaleblend', this._scaleBlend);\n\t\tthis._elements.forEach(element => element._onScreenResize(this._resolution));\n\t}\n\tget scaleBlend() {\n\t\treturn this._scaleBlend;\n\t}\n\tset priority(value) {\n\t\tif (value > 0xFF) {\n\t\t\tvalue = 0xFF;\n\t\t}\n\t\tif (this._priority === value) {\n\t\t\treturn;\n\t\t}\n\t\tthis._priority = value;\n\t\tthis.syncDrawOrder();\n\t}\n\tget priority() {\n\t\treturn this._priority;\n\t}\n}\n\nexport { ScreenComponent };\n","class ScreenComponentData {\n\tconstructor() {\n\t\tthis.enabled = true;\n\t}\n}\n\nexport { ScreenComponentData };\n","import { IndexedList } from '../../../core/indexed-list.js';\nimport { Vec2 } from '../../../core/math/vec2.js';\nimport { Component } from '../component.js';\nimport { ComponentSystem } from '../system.js';\nimport { ScreenComponent } from './component.js';\nimport { ScreenComponentData } from './data.js';\n\nconst _schema = ['enabled'];\nclass ScreenComponentSystem extends ComponentSystem {\n\tconstructor(app) {\n\t\tsuper(app);\n\t\tthis.id = 'screen';\n\t\tthis.ComponentType = ScreenComponent;\n\t\tthis.DataType = ScreenComponentData;\n\t\tthis.schema = _schema;\n\t\tthis.windowResolution = new Vec2();\n\t\tthis._drawOrderSyncQueue = new IndexedList();\n\t\tthis.app.graphicsDevice.on('resizecanvas', this._onResize, this);\n\t\tthis.app.systems.on('update', this._onUpdate, this);\n\t\tthis.on('beforeremove', this.onRemoveComponent, this);\n\t}\n\tinitializeComponentData(component, data, properties) {\n\t\tif (data.priority !== undefined) component.priority = data.priority;\n\t\tif (data.screenSpace !== undefined) component.screenSpace = data.screenSpace;\n\t\tcomponent.cull = component.screenSpace;\n\t\tif (data.scaleMode !== undefined) component.scaleMode = data.scaleMode;\n\t\tif (data.scaleBlend !== undefined) component.scaleBlend = data.scaleBlend;\n\t\tif (data.resolution !== undefined) {\n\t\t\tif (data.resolution instanceof Vec2) {\n\t\t\t\tcomponent._resolution.copy(data.resolution);\n\t\t\t} else {\n\t\t\t\tcomponent._resolution.set(data.resolution[0], data.resolution[1]);\n\t\t\t}\n\t\t\tcomponent.resolution = component._resolution;\n\t\t}\n\t\tif (data.referenceResolution !== undefined) {\n\t\t\tif (data.referenceResolution instanceof Vec2) {\n\t\t\t\tcomponent._referenceResolution.copy(data.referenceResolution);\n\t\t\t} else {\n\t\t\t\tcomponent._referenceResolution.set(data.referenceResolution[0], data.referenceResolution[1]);\n\t\t\t}\n\t\t\tcomponent.referenceResolution = component._referenceResolution;\n\t\t}\n\t\tcomponent.syncDrawOrder();\n\t\tsuper.initializeComponentData(component, data, properties);\n\t}\n\tdestroy() {\n\t\tsuper.destroy();\n\t\tthis.app.graphicsDevice.off('resizecanvas', this._onResize, this);\n\t\tthis.app.systems.off('update', this._onUpdate, this);\n\t}\n\t_onUpdate(dt) {\n\t\tconst components = this.store;\n\t\tfor (const id in components) {\n\t\t\tif (components[id].entity.screen.update) components[id].entity.screen.update(dt);\n\t\t}\n\t}\n\t_onResize(width, height) {\n\t\tthis.windowResolution.x = width;\n\t\tthis.windowResolution.y = height;\n\t}\n\tcloneComponent(entity, clone) {\n\t\tconst screen = entity.screen;\n\t\treturn this.addComponent(clone, {\n\t\t\tenabled: screen.enabled,\n\t\t\tscreenSpace: screen.screenSpace,\n\t\t\tscaleMode: screen.scaleMode,\n\t\t\tresolution: screen.resolution.clone(),\n\t\t\treferenceResolution: screen.referenceResolution.clone()\n\t\t});\n\t}\n\tonRemoveComponent(entity, component) {\n\t\tcomponent.onRemove();\n\t}\n\tprocessDrawOrderSyncQueue() {\n\t\tconst list = this._drawOrderSyncQueue.list();\n\t\tfor (let i = 0; i < list.length; i++) {\n\t\t\tconst item = list[i];\n\t\t\titem.callback.call(item.scope);\n\t\t}\n\t\tthis._drawOrderSyncQueue.clear();\n\t}\n\tqueueDrawOrderSync(id, fn, scope) {\n\t\tif (!this._drawOrderSyncQueue.list().length) {\n\t\t\tthis.app.once('prerender', this.processDrawOrderSyncQueue, this);\n\t\t}\n\t\tif (!this._drawOrderSyncQueue.has(id)) {\n\t\t\tthis._drawOrderSyncQueue.push(id, {\n\t\t\t\tcallback: fn,\n\t\t\t\tscope: scope\n\t\t\t});\n\t\t}\n\t}\n}\nComponent._buildAccessors(ScreenComponent.prototype, _schema);\n\nexport { ScreenComponentSystem };\n","import '../../../core/tracing.js';\nimport { path } from '../../../core/path.js';\nimport { Component } from '../component.js';\n\nclass ScriptLegacyComponent extends Component {\n\tconstructor(system, entity) {\n\t\tsuper(system, entity);\n\t\tthis.on('set_scripts', this.onSetScripts, this);\n\t}\n\tsend(name, functionName) {\n\t\tconst args = Array.prototype.slice.call(arguments, 2);\n\t\tconst instances = this.entity.script.instances;\n\t\tlet fn;\n\t\tif (instances && instances[name]) {\n\t\t\tfn = instances[name].instance[functionName];\n\t\t\tif (fn) {\n\t\t\t\treturn fn.apply(instances[name].instance, args);\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\tonEnable() {\n\t\tif (this.data.areScriptsLoaded && !this.system.preloading) {\n\t\t\tif (!this.data.initialized) {\n\t\t\t\tthis.system._initializeScriptComponent(this);\n\t\t\t} else {\n\t\t\t\tthis.system._enableScriptComponent(this);\n\t\t\t}\n\t\t\tif (!this.data.postInitialized) {\n\t\t\t\tthis.system._postInitializeScriptComponent(this);\n\t\t\t}\n\t\t}\n\t}\n\tonDisable() {\n\t\tthis.system._disableScriptComponent(this);\n\t}\n\tonSetScripts(name, oldValue, newValue) {\n\t\tif (!this.system._inTools || this.runInTools) {\n\t\t\tif (this._updateScriptAttributes(oldValue, newValue)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this.enabled) {\n\t\t\t\tthis.system._disableScriptComponent(this);\n\t\t\t}\n\t\t\tthis.system._destroyScriptComponent(this);\n\t\t\tthis.data.areScriptsLoaded = false;\n\t\t\tconst scripts = newValue;\n\t\t\tconst urls = scripts.map(function (s) {\n\t\t\t\treturn s.url;\n\t\t\t});\n\t\t\tif (this._loadFromCache(urls)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._loadScripts(urls);\n\t\t}\n\t}\n\t_updateScriptAttributes(oldValue, newValue) {\n\t\tlet onlyUpdateAttributes = true;\n\t\tif (oldValue.length !== newValue.length) {\n\t\t\tonlyUpdateAttributes = false;\n\t\t} else {\n\t\t\tfor (let i = 0, len = newValue.length; i < len; i++) {\n\t\t\t\tif (oldValue[i].url !== newValue[i].url) {\n\t\t\t\t\tonlyUpdateAttributes = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (onlyUpdateAttributes) {\n\t\t\tfor (const key in this.instances) {\n\t\t\t\tif (this.instances.hasOwnProperty(key)) {\n\t\t\t\t\tthis.system._updateAccessors(this.entity, this.instances[key]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn onlyUpdateAttributes;\n\t}\n\t_loadFromCache(urls) {\n\t\tconst cached = [];\n\t\tconst prefix = this.system.app._scriptPrefix || '';\n\t\tconst regex = /^http(s)?:\\/\\//i;\n\t\tfor (let i = 0, len = urls.length; i < len; i++) {\n\t\t\tlet url = urls[i];\n\t\t\tif (!regex.test(url)) {\n\t\t\t\turl = path.join(prefix, url);\n\t\t\t}\n\t\t\tconst type = this.system.app.loader.getFromCache(url, 'script');\n\t\t\tif (!type) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tcached.push(type);\n\t\t}\n\t\tfor (let i = 0, len = cached.length; i < len; i++) {\n\t\t\tconst ScriptType = cached[i];\n\t\t\tif (ScriptType === true) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (ScriptType && this.entity.script) {\n\t\t\t\tif (!this.entity.script.instances[ScriptType._pcScriptName]) {\n\t\t\t\t\tconst instance = new ScriptType(this.entity);\n\t\t\t\t\tthis.system._preRegisterInstance(this.entity, urls[i], ScriptType._pcScriptName, instance);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (this.data) {\n\t\t\tthis.data.areScriptsLoaded = true;\n\t\t}\n\t\tif (!this.system.preloading) {\n\t\t\tthis.system.onInitialize(this.entity);\n\t\t\tthis.system.onPostInitialize(this.entity);\n\t\t}\n\t\treturn true;\n\t}\n\t_loadScripts(urls) {\n\t\tlet count = urls.length;\n\t\tconst prefix = this.system.app._scriptPrefix || '';\n\t\turls.forEach(url => {\n\t\t\tlet _url = null;\n\t\t\tlet _unprefixed = null;\n\t\t\tif (url.toLowerCase().startsWith('http://') || url.toLowerCase().startsWith('https://')) {\n\t\t\t\t_unprefixed = url;\n\t\t\t\t_url = url;\n\t\t\t} else {\n\t\t\t\t_unprefixed = url;\n\t\t\t\t_url = path.join(prefix, url);\n\t\t\t}\n\t\t\tthis.system.app.loader.load(_url, 'script', (err, ScriptType) => {\n\t\t\t\tcount--;\n\t\t\t\tif (!err) {\n\t\t\t\t\tif (ScriptType && this.entity.script) {\n\t\t\t\t\t\tif (!this.entity.script.instances[ScriptType._pcScriptName]) {\n\t\t\t\t\t\t\tconst instance = new ScriptType(this.entity);\n\t\t\t\t\t\t\tthis.system._preRegisterInstance(this.entity, _unprefixed, ScriptType._pcScriptName, instance);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconsole.error(err);\n\t\t\t\t}\n\t\t\t\tif (count === 0) {\n\t\t\t\t\tthis.data.areScriptsLoaded = true;\n\t\t\t\t\tif (!this.system.preloading) {\n\t\t\t\t\t\tthis.system.onInitialize(this.entity);\n\t\t\t\t\t\tthis.system.onPostInitialize(this.entity);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n}\n\nexport { ScriptLegacyComponent };\n","class ScriptLegacyComponentData {\n\tconstructor() {\n\t\tthis.scripts = [];\n\t\tthis.enabled = true;\n\t\tthis.instances = {};\n\t\tthis._instances = {};\n\t\tthis.runInTools = false;\n\t\tthis.attributes = {};\n\t\tthis.initialized = false;\n\t\tthis.postInitialized = false;\n\t\tthis.areScriptsLoaded = false;\n\t}\n}\n\nexport { ScriptLegacyComponentData };\n","import { extend } from '../../../core/core.js';\nimport { events } from '../../../core/events.js';\nimport '../../../core/tracing.js';\nimport { Color } from '../../../core/math/color.js';\nimport { Curve } from '../../../core/math/curve.js';\nimport { CurveSet } from '../../../core/math/curve-set.js';\nimport { Vec2 } from '../../../core/math/vec2.js';\nimport { Vec3 } from '../../../core/math/vec3.js';\nimport { Vec4 } from '../../../core/math/vec4.js';\nimport { Entity } from '../../entity.js';\nimport { Component } from '../component.js';\nimport { ComponentSystem } from '../system.js';\nimport { ScriptLegacyComponent } from './component.js';\nimport { ScriptLegacyComponentData } from './data.js';\n\nconst _schema = ['enabled', 'scripts', 'instances', 'runInTools'];\nconst INITIALIZE = 'initialize';\nconst POST_INITIALIZE = 'postInitialize';\nconst UPDATE = 'update';\nconst POST_UPDATE = 'postUpdate';\nconst FIXED_UPDATE = 'fixedUpdate';\nconst TOOLS_UPDATE = 'toolsUpdate';\nconst ON_ENABLE = 'onEnable';\nconst ON_DISABLE = 'onDisable';\nclass ScriptLegacyComponentSystem extends ComponentSystem {\n\tconstructor(app) {\n\t\tsuper(app);\n\t\tthis.id = 'script';\n\t\tthis.ComponentType = ScriptLegacyComponent;\n\t\tthis.DataType = ScriptLegacyComponentData;\n\t\tthis.schema = _schema;\n\t\tthis.preloading = false;\n\t\tthis.instancesWithUpdate = [];\n\t\tthis.instancesWithFixedUpdate = [];\n\t\tthis.instancesWithPostUpdate = [];\n\t\tthis.instancesWithToolsUpdate = [];\n\t\tthis.on('beforeremove', this.onBeforeRemove, this);\n\t\tthis.app.systems.on(INITIALIZE, this.onInitialize, this);\n\t\tthis.app.systems.on(POST_INITIALIZE, this.onPostInitialize, this);\n\t\tthis.app.systems.on(UPDATE, this.onUpdate, this);\n\t\tthis.app.systems.on(FIXED_UPDATE, this.onFixedUpdate, this);\n\t\tthis.app.systems.on(POST_UPDATE, this.onPostUpdate, this);\n\t\tthis.app.systems.on(TOOLS_UPDATE, this.onToolsUpdate, this);\n\t}\n\tinitializeComponentData(component, data, properties) {\n\t\tproperties = ['runInTools', 'enabled', 'scripts'];\n\t\tif (data.scripts && data.scripts.length) {\n\t\t\tdata.scripts.forEach(function (script) {\n\t\t\t\tif (script.attributes && Array.isArray(script.attributes)) {\n\t\t\t\t\tconst dict = {};\n\t\t\t\t\tfor (let i = 0; i < script.attributes.length; i++) {\n\t\t\t\t\t\tdict[script.attributes[i].name] = script.attributes[i];\n\t\t\t\t\t}\n\t\t\t\t\tscript.attributes = dict;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tsuper.initializeComponentData(component, data, properties);\n\t}\n\tcloneComponent(entity, clone) {\n\t\tconst src = this.store[entity.getGuid()];\n\t\tconst data = {\n\t\t\trunInTools: src.data.runInTools,\n\t\t\tscripts: [],\n\t\t\tenabled: src.data.enabled\n\t\t};\n\t\tconst scripts = src.data.scripts;\n\t\tfor (let i = 0, len = scripts.length; i < len; i++) {\n\t\t\tconst attributes = scripts[i].attributes;\n\t\t\tif (attributes) {\n\t\t\t\tdelete scripts[i].attributes;\n\t\t\t}\n\t\t\tdata.scripts.push(extend({}, scripts[i]));\n\t\t\tif (attributes) {\n\t\t\t\tdata.scripts[i].attributes = this._cloneAttributes(attributes);\n\t\t\t\tscripts[i].attributes = attributes;\n\t\t\t}\n\t\t}\n\t\treturn this.addComponent(clone, data);\n\t}\n\tonBeforeRemove(entity, component) {\n\t\tif (component.enabled) {\n\t\t\tthis._disableScriptComponent(component);\n\t\t}\n\t\tthis._destroyScriptComponent(component);\n\t}\n\tonInitialize(root) {\n\t\tthis._registerInstances(root);\n\t\tif (root.enabled) {\n\t\t\tif (root.script && root.script.enabled) {\n\t\t\t\tthis._initializeScriptComponent(root.script);\n\t\t\t}\n\t\t\tconst children = root._children;\n\t\t\tfor (let i = 0, len = children.length; i < len; i++) {\n\t\t\t\tif (children[i] instanceof Entity) {\n\t\t\t\t\tthis.onInitialize(children[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tonPostInitialize(root) {\n\t\tif (root.enabled) {\n\t\t\tif (root.script && root.script.enabled) {\n\t\t\t\tthis._postInitializeScriptComponent(root.script);\n\t\t\t}\n\t\t\tconst children = root._children;\n\t\t\tfor (let i = 0, len = children.length; i < len; i++) {\n\t\t\t\tif (children[i] instanceof Entity) {\n\t\t\t\t\tthis.onPostInitialize(children[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t_callInstancesMethod(script, method) {\n\t\tconst instances = script.data.instances;\n\t\tfor (const name in instances) {\n\t\t\tif (instances.hasOwnProperty(name)) {\n\t\t\t\tconst instance = instances[name].instance;\n\t\t\t\tif (instance[method]) {\n\t\t\t\t\tinstance[method]();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t_initializeScriptComponent(script) {\n\t\tthis._callInstancesMethod(script, INITIALIZE);\n\t\tscript.data.initialized = true;\n\t\tif (script.enabled && script.entity.enabled) {\n\t\t\tthis._enableScriptComponent(script);\n\t\t}\n\t}\n\t_enableScriptComponent(script) {\n\t\tthis._callInstancesMethod(script, ON_ENABLE);\n\t}\n\t_disableScriptComponent(script) {\n\t\tthis._callInstancesMethod(script, ON_DISABLE);\n\t}\n\t_destroyScriptComponent(script) {\n\t\tconst instances = script.data.instances;\n\t\tfor (const name in instances) {\n\t\t\tif (instances.hasOwnProperty(name)) {\n\t\t\t\tconst instance = instances[name].instance;\n\t\t\t\tif (instance.destroy) {\n\t\t\t\t\tinstance.destroy();\n\t\t\t\t}\n\t\t\t\tif (instance.update) {\n\t\t\t\t\tconst index = this.instancesWithUpdate.indexOf(instance);\n\t\t\t\t\tif (index >= 0) {\n\t\t\t\t\t\tthis.instancesWithUpdate.splice(index, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (instance.fixedUpdate) {\n\t\t\t\t\tconst index = this.instancesWithFixedUpdate.indexOf(instance);\n\t\t\t\t\tif (index >= 0) {\n\t\t\t\t\t\tthis.instancesWithFixedUpdate.splice(index, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (instance.postUpdate) {\n\t\t\t\t\tconst index = this.instancesWithPostUpdate.indexOf(instance);\n\t\t\t\t\tif (index >= 0) {\n\t\t\t\t\t\tthis.instancesWithPostUpdate.splice(index, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (instance.toolsUpdate) {\n\t\t\t\t\tconst index = this.instancesWithToolsUpdate.indexOf(instance);\n\t\t\t\t\tif (index >= 0) {\n\t\t\t\t\t\tthis.instancesWithToolsUpdate.splice(index, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (script.instances[name].instance === script[name]) {\n\t\t\t\t\tdelete script[name];\n\t\t\t\t}\n\t\t\t\tdelete script.instances[name];\n\t\t\t}\n\t\t}\n\t}\n\t_postInitializeScriptComponent(script) {\n\t\tthis._callInstancesMethod(script, POST_INITIALIZE);\n\t\tscript.data.postInitialized = true;\n\t}\n\t_updateInstances(method, updateList, dt) {\n\t\tfor (let i = 0, len = updateList.length; i < len; i++) {\n\t\t\tconst item = updateList[i];\n\t\t\tif (item && item.entity && item.entity.enabled && item.entity.script.enabled) {\n\t\t\t\titem[method](dt);\n\t\t\t}\n\t\t}\n\t}\n\tonUpdate(dt) {\n\t\tthis._updateInstances(UPDATE, this.instancesWithUpdate, dt);\n\t}\n\tonFixedUpdate(dt) {\n\t\tthis._updateInstances(FIXED_UPDATE, this.instancesWithFixedUpdate, dt);\n\t}\n\tonPostUpdate(dt) {\n\t\tthis._updateInstances(POST_UPDATE, this.instancesWithPostUpdate, dt);\n\t}\n\tonToolsUpdate(dt) {\n\t\tthis._updateInstances(TOOLS_UPDATE, this.instancesWithToolsUpdate, dt);\n\t}\n\tbroadcast(name, functionName) {\n\t\tconst args = Array.prototype.slice.call(arguments, 2);\n\t\tconst dataStore = this.store;\n\t\tfor (const id in dataStore) {\n\t\t\tif (dataStore.hasOwnProperty(id)) {\n\t\t\t\tconst data = dataStore[id].data;\n\t\t\t\tif (data.instances[name]) {\n\t\t\t\t\tconst fn = data.instances[name].instance[functionName];\n\t\t\t\t\tif (fn) {\n\t\t\t\t\t\tfn.apply(data.instances[name].instance, args);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t_preRegisterInstance(entity, url, name, instance) {\n\t\tif (entity.script) {\n\t\t\tentity.script.data._instances = entity.script.data._instances || {};\n\t\t\tif (entity.script.data._instances[name]) {\n\t\t\t\tthrow Error(`Script name collision '${name}'. Scripts from '${url}' and '${entity.script.data._instances[name].url}' {${entity.getGuid()}}`);\n\t\t\t}\n\t\t\tentity.script.data._instances[name] = {\n\t\t\t\turl: url,\n\t\t\t\tname: name,\n\t\t\t\tinstance: instance\n\t\t\t};\n\t\t}\n\t}\n\t_registerInstances(entity) {\n\t\tif (entity.script) {\n\t\t\tif (entity.script.data._instances) {\n\t\t\t\tentity.script.instances = entity.script.data._instances;\n\t\t\t\tfor (const instanceName in entity.script.instances) {\n\t\t\t\t\tconst preRegistered = entity.script.instances[instanceName];\n\t\t\t\t\tconst instance = preRegistered.instance;\n\t\t\t\t\tevents.attach(instance);\n\t\t\t\t\tif (instance.update) {\n\t\t\t\t\t\tthis.instancesWithUpdate.push(instance);\n\t\t\t\t\t}\n\t\t\t\t\tif (instance.fixedUpdate) {\n\t\t\t\t\t\tthis.instancesWithFixedUpdate.push(instance);\n\t\t\t\t\t}\n\t\t\t\t\tif (instance.postUpdate) {\n\t\t\t\t\t\tthis.instancesWithPostUpdate.push(instance);\n\t\t\t\t\t}\n\t\t\t\t\tif (instance.toolsUpdate) {\n\t\t\t\t\t\tthis.instancesWithToolsUpdate.push(instance);\n\t\t\t\t\t}\n\t\t\t\t\tif (entity.script.scripts) {\n\t\t\t\t\t\tthis._createAccessors(entity, preRegistered);\n\t\t\t\t\t}\n\t\t\t\t\tif (entity.script[instanceName]) {\n\t\t\t\t\t\tthrow Error(`Script with name '${instanceName}' is already attached to Script Component`);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tentity.script[instanceName] = instance;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tdelete entity.script.data._instances;\n\t\t\t}\n\t\t}\n\t\tconst children = entity._children;\n\t\tfor (let i = 0, len = children.length; i < len; i++) {\n\t\t\tif (children[i] instanceof Entity) {\n\t\t\t\tthis._registerInstances(children[i]);\n\t\t\t}\n\t\t}\n\t}\n\t_cloneAttributes(attributes) {\n\t\tconst result = {};\n\t\tfor (const key in attributes) {\n\t\t\tif (!attributes.hasOwnProperty(key)) continue;\n\t\t\tif (attributes[key].type !== 'entity') {\n\t\t\t\tresult[key] = extend({}, attributes[key]);\n\t\t\t} else {\n\t\t\t\tconst val = attributes[key].value;\n\t\t\t\tdelete attributes[key].value;\n\t\t\t\tresult[key] = extend({}, attributes[key]);\n\t\t\t\tresult[key].value = val;\n\t\t\t\tattributes[key].value = val;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\t_createAccessors(entity, instance) {\n\t\tconst len = entity.script.scripts.length;\n\t\tconst url = instance.url;\n\t\tfor (let i = 0; i < len; i++) {\n\t\t\tconst script = entity.script.scripts[i];\n\t\t\tif (script.url === url) {\n\t\t\t\tconst attributes = script.attributes;\n\t\t\t\tif (script.name && attributes) {\n\t\t\t\t\tfor (const key in attributes) {\n\t\t\t\t\t\tif (attributes.hasOwnProperty(key)) {\n\t\t\t\t\t\t\tthis._createAccessor(attributes[key], instance);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tentity.script.data.attributes[script.name] = this._cloneAttributes(attributes);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\t_createAccessor(attribute, instance) {\n\t\tconst self = this;\n\t\tattribute = {\n\t\t\tname: attribute.name,\n\t\t\tvalue: attribute.value,\n\t\t\ttype: attribute.type\n\t\t};\n\t\tthis._convertAttributeValue(attribute);\n\t\tObject.defineProperty(instance.instance, attribute.name, {\n\t\t\tget: function () {\n\t\t\t\treturn attribute.value;\n\t\t\t},\n\t\t\tset: function (value) {\n\t\t\t\tconst oldValue = attribute.value;\n\t\t\t\tattribute.value = value;\n\t\t\t\tself._convertAttributeValue(attribute);\n\t\t\t\tinstance.instance.fire('set', attribute.name, oldValue, attribute.value);\n\t\t\t},\n\t\t\tconfigurable: true\n\t\t});\n\t}\n\t_updateAccessors(entity, instance) {\n\t\tconst len = entity.script.scripts.length;\n\t\tconst url = instance.url;\n\t\tfor (let i = 0; i < len; i++) {\n\t\t\tconst scriptComponent = entity.script;\n\t\t\tconst script = scriptComponent.scripts[i];\n\t\t\tif (script.url === url) {\n\t\t\t\tconst name = script.name;\n\t\t\t\tconst attributes = script.attributes;\n\t\t\t\tif (name) {\n\t\t\t\t\tif (attributes) {\n\t\t\t\t\t\tfor (const key in attributes) {\n\t\t\t\t\t\t\tif (attributes.hasOwnProperty(key)) {\n\t\t\t\t\t\t\t\tthis._createAccessor(attributes[key], instance);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tconst previousAttributes = scriptComponent.data.attributes[name];\n\t\t\t\t\tif (previousAttributes) {\n\t\t\t\t\t\tfor (const key in previousAttributes) {\n\t\t\t\t\t\t\tconst oldAttribute = previousAttributes[key];\n\t\t\t\t\t\t\tif (!(key in attributes)) {\n\t\t\t\t\t\t\t\tdelete instance.instance[oldAttribute.name];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (attributes[key].value !== oldAttribute.value) {\n\t\t\t\t\t\t\t\t\tif (instance.instance.onAttributeChanged) {\n\t\t\t\t\t\t\t\t\t\tinstance.instance.onAttributeChanged(oldAttribute.name, oldAttribute.value, attributes[key].value);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (attributes) {\n\t\t\t\t\t\tscriptComponent.data.attributes[name] = this._cloneAttributes(attributes);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdelete scriptComponent.data.attributes[name];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\t_convertAttributeValue(attribute) {\n\t\tif (attribute.type === 'rgb' || attribute.type === 'rgba') {\n\t\t\tif (Array.isArray(attribute.value)) {\n\t\t\t\tattribute.value = attribute.value.length === 3 ? new Color(attribute.value[0], attribute.value[1], attribute.value[2]) : new Color(attribute.value[0], attribute.value[1], attribute.value[2], attribute.value[3]);\n\t\t\t}\n\t\t} else if (attribute.type === 'vec2') {\n\t\t\tif (Array.isArray(attribute.value)) attribute.value = new Vec2(attribute.value[0], attribute.value[1]);\n\t\t} else if (attribute.type === 'vec3' || attribute.type === 'vector') {\n\t\t\tif (Array.isArray(attribute.value)) attribute.value = new Vec3(attribute.value[0], attribute.value[1], attribute.value[2]);\n\t\t} else if (attribute.type === 'vec4') {\n\t\t\tif (Array.isArray(attribute.value)) attribute.value = new Vec4(attribute.value[0], attribute.value[1], attribute.value[2], attribute.value[3]);\n\t\t} else if (attribute.type === 'entity') {\n\t\t\tif (attribute.value !== null && typeof attribute.value === 'string') attribute.value = this.app.root.findByGuid(attribute.value);\n\t\t} else if (attribute.type === 'curve' || attribute.type === 'colorcurve') {\n\t\t\tconst curveType = attribute.value.keys[0] instanceof Array ? CurveSet : Curve;\n\t\t\tattribute.value = new curveType(attribute.value.keys);\n\t\t\tattribute.value.type = attribute.value.type;\n\t\t}\n\t}\n\tdestroy() {\n\t\tsuper.destroy();\n\t\tthis.app.systems.off(INITIALIZE, this.onInitialize, this);\n\t\tthis.app.systems.off(POST_INITIALIZE, this.onPostInitialize, this);\n\t\tthis.app.systems.off(UPDATE, this.onUpdate, this);\n\t\tthis.app.systems.off(FIXED_UPDATE, this.onFixedUpdate, this);\n\t\tthis.app.systems.off(POST_UPDATE, this.onPostUpdate, this);\n\t\tthis.app.systems.off(TOOLS_UPDATE, this.onToolsUpdate, this);\n\t}\n}\nComponent._buildAccessors(ScriptLegacyComponent.prototype, _schema);\n\nexport { ScriptLegacyComponentSystem };\n","import { platform } from '../../../core/platform.js';\nimport { EventHandler } from '../../../core/event-handler.js';\nimport { Quat } from '../../../core/math/quat.js';\nimport { Vec2 } from '../../../core/math/vec2.js';\nimport { Vec3 } from '../../../core/math/vec3.js';\nimport { ElementComponent } from './component.js';\nimport { Ray } from '../../../core/shape/ray.js';\nimport { Plane } from '../../../core/shape/plane.js';\n\nconst _inputScreenPosition = new Vec2();\nconst _inputWorldPosition = new Vec3();\nconst _ray = new Ray();\nconst _plane = new Plane();\nconst _normal = new Vec3();\nconst _point = new Vec3();\nconst _entityRotation = new Quat();\nconst OPPOSITE_AXIS = {\n\tx: 'y',\n\ty: 'x'\n};\nclass ElementDragHelper extends EventHandler {\n\tconstructor(element, axis) {\n\t\tsuper();\n\t\tif (!element || !(element instanceof ElementComponent)) {\n\t\t\tthrow new Error('Element was null or not an ElementComponent');\n\t\t}\n\t\tif (axis && axis !== 'x' && axis !== 'y') {\n\t\t\tthrow new Error('Unrecognized axis: ' + axis);\n\t\t}\n\t\tthis._element = element;\n\t\tthis._app = element.system.app;\n\t\tthis._axis = axis || null;\n\t\tthis._enabled = true;\n\t\tthis._dragScale = new Vec3();\n\t\tthis._dragStartMousePosition = new Vec3();\n\t\tthis._dragStartHandlePosition = new Vec3();\n\t\tthis._deltaMousePosition = new Vec3();\n\t\tthis._deltaHandlePosition = new Vec3();\n\t\tthis._isDragging = false;\n\t\tthis._toggleLifecycleListeners('on');\n\t}\n\t_toggleLifecycleListeners(onOrOff) {\n\t\tthis._element[onOrOff]('mousedown', this._onMouseDownOrTouchStart, this);\n\t\tthis._element[onOrOff]('touchstart', this._onMouseDownOrTouchStart, this);\n\t\tthis._element[onOrOff]('selectstart', this._onMouseDownOrTouchStart, this);\n\t}\n\t_toggleDragListeners(onOrOff) {\n\t\tconst isOn = onOrOff === 'on';\n\t\tif (this._hasDragListeners && isOn) {\n\t\t\treturn;\n\t\t}\n\t\tif (this._app.mouse) {\n\t\t\tthis._element[onOrOff]('mousemove', this._onMove, this);\n\t\t\tthis._element[onOrOff]('mouseup', this._onMouseUpOrTouchEnd, this);\n\t\t}\n\t\tif (platform.touch) {\n\t\t\tthis._element[onOrOff]('touchmove', this._onMove, this);\n\t\t\tthis._element[onOrOff]('touchend', this._onMouseUpOrTouchEnd, this);\n\t\t\tthis._element[onOrOff]('touchcancel', this._onMouseUpOrTouchEnd, this);\n\t\t}\n\t\tthis._element[onOrOff]('selectmove', this._onMove, this);\n\t\tthis._element[onOrOff]('selectend', this._onMouseUpOrTouchEnd, this);\n\t\tthis._hasDragListeners = isOn;\n\t}\n\t_onMouseDownOrTouchStart(event) {\n\t\tif (this._element && !this._isDragging && this.enabled) {\n\t\t\tthis._dragCamera = event.camera;\n\t\t\tthis._calculateDragScale();\n\t\t\tconst currentMousePosition = this._screenToLocal(event);\n\t\t\tif (currentMousePosition) {\n\t\t\t\tthis._toggleDragListeners('on');\n\t\t\t\tthis._isDragging = true;\n\t\t\t\tthis._dragStartMousePosition.copy(currentMousePosition);\n\t\t\t\tthis._dragStartHandlePosition.copy(this._element.entity.getLocalPosition());\n\t\t\t\tthis.fire('drag:start');\n\t\t\t}\n\t\t}\n\t}\n\t_onMouseUpOrTouchEnd() {\n\t\tif (this._isDragging) {\n\t\t\tthis._isDragging = false;\n\t\t\tthis._toggleDragListeners('off');\n\t\t\tthis.fire('drag:end');\n\t\t}\n\t}\n\t_screenToLocal(event) {\n\t\tif (event.inputSource) {\n\t\t\t_ray.set(event.inputSource.getOrigin(), event.inputSource.getDirection());\n\t\t} else {\n\t\t\tthis._determineInputPosition(event);\n\t\t\tthis._chooseRayOriginAndDirection();\n\t\t}\n\t\t_normal.copy(this._element.entity.forward).mulScalar(-1);\n\t\t_plane.setFromPointNormal(this._element.entity.getPosition(), _normal);\n\t\tif (_plane.intersectsRay(_ray, _point)) {\n\t\t\t_entityRotation.copy(this._element.entity.getRotation()).invert().transformVector(_point, _point);\n\t\t\t_point.mul(this._dragScale);\n\t\t\treturn _point;\n\t\t}\n\t\treturn null;\n\t}\n\t_determineInputPosition(event) {\n\t\tconst devicePixelRatio = this._app.graphicsDevice.maxPixelRatio;\n\t\tif (typeof event.x !== 'undefined' && typeof event.y !== 'undefined') {\n\t\t\t_inputScreenPosition.x = event.x * devicePixelRatio;\n\t\t\t_inputScreenPosition.y = event.y * devicePixelRatio;\n\t\t} else if (event.changedTouches) {\n\t\t\t_inputScreenPosition.x = event.changedTouches[0].x * devicePixelRatio;\n\t\t\t_inputScreenPosition.y = event.changedTouches[0].y * devicePixelRatio;\n\t\t} else {\n\t\t\tconsole.warn('Could not determine position from input event');\n\t\t}\n\t}\n\t_chooseRayOriginAndDirection() {\n\t\tif (this._element.screen && this._element.screen.screen.screenSpace) {\n\t\t\t_ray.origin.set(_inputScreenPosition.x, -_inputScreenPosition.y, 0);\n\t\t\t_ray.direction.copy(Vec3.FORWARD);\n\t\t} else {\n\t\t\t_inputWorldPosition.copy(this._dragCamera.screenToWorld(_inputScreenPosition.x, _inputScreenPosition.y, 1));\n\t\t\t_ray.origin.copy(this._dragCamera.entity.getPosition());\n\t\t\t_ray.direction.copy(_inputWorldPosition).sub(_ray.origin).normalize();\n\t\t}\n\t}\n\t_calculateDragScale() {\n\t\tlet current = this._element.entity.parent;\n\t\tconst screen = this._element.screen && this._element.screen.screen;\n\t\tconst isWithin2DScreen = screen && screen.screenSpace;\n\t\tconst screenScale = isWithin2DScreen ? screen.scale : 1;\n\t\tconst dragScale = this._dragScale;\n\t\tdragScale.set(screenScale, screenScale, screenScale);\n\t\twhile (current) {\n\t\t\tdragScale.mul(current.getLocalScale());\n\t\t\tcurrent = current.parent;\n\t\t\tif (isWithin2DScreen && current.screen) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tdragScale.x = 1 / dragScale.x;\n\t\tdragScale.y = 1 / dragScale.y;\n\t\tdragScale.z = 0;\n\t}\n\t_onMove(event) {\n\t\tconst {\n\t\t\t_element: element,\n\t\t\t_deltaMousePosition: deltaMousePosition,\n\t\t\t_deltaHandlePosition: deltaHandlePosition,\n\t\t\t_axis: axis\n\t\t} = this;\n\t\tif (element && this._isDragging && this.enabled && element.enabled && element.entity.enabled) {\n\t\t\tconst currentMousePosition = this._screenToLocal(event);\n\t\t\tif (currentMousePosition) {\n\t\t\t\tdeltaMousePosition.sub2(currentMousePosition, this._dragStartMousePosition);\n\t\t\t\tdeltaHandlePosition.add2(this._dragStartHandlePosition, deltaMousePosition);\n\t\t\t\tif (axis) {\n\t\t\t\t\tconst currentPosition = element.entity.getLocalPosition();\n\t\t\t\t\tconst constrainedAxis = OPPOSITE_AXIS[axis];\n\t\t\t\t\tdeltaHandlePosition[constrainedAxis] = currentPosition[constrainedAxis];\n\t\t\t\t}\n\t\t\t\telement.entity.setLocalPosition(deltaHandlePosition);\n\t\t\t\tthis.fire('drag:move', deltaHandlePosition);\n\t\t\t}\n\t\t}\n\t}\n\tdestroy() {\n\t\tthis._toggleLifecycleListeners('off');\n\t\tthis._toggleDragListeners('off');\n\t}\n\tset enabled(value) {\n\t\tthis._enabled = value;\n\t}\n\tget enabled() {\n\t\treturn this._enabled;\n\t}\n\tget isDragging() {\n\t\treturn this._isDragging;\n\t}\n}\n\nexport { ElementDragHelper };\n","const SCROLL_MODE_CLAMP = 0;\nconst SCROLL_MODE_BOUNCE = 1;\nconst SCROLL_MODE_INFINITE = 2;\nconst SCROLLBAR_VISIBILITY_SHOW_ALWAYS = 0;\nconst SCROLLBAR_VISIBILITY_SHOW_WHEN_REQUIRED = 1;\n\nexport { SCROLLBAR_VISIBILITY_SHOW_ALWAYS, SCROLLBAR_VISIBILITY_SHOW_WHEN_REQUIRED, SCROLL_MODE_BOUNCE, SCROLL_MODE_CLAMP, SCROLL_MODE_INFINITE };\n","import '../../../core/tracing.js';\nimport { math } from '../../../core/math/math.js';\nimport { Vec2 } from '../../../core/math/vec2.js';\nimport { Vec3 } from '../../../core/math/vec3.js';\nimport { ORIENTATION_HORIZONTAL, ORIENTATION_VERTICAL } from '../../../scene/constants.js';\nimport { EntityReference } from '../../utils/entity-reference.js';\nimport { ElementDragHelper } from '../element/element-drag-helper.js';\nimport { SCROLL_MODE_INFINITE, SCROLL_MODE_BOUNCE, SCROLL_MODE_CLAMP, SCROLLBAR_VISIBILITY_SHOW_WHEN_REQUIRED, SCROLLBAR_VISIBILITY_SHOW_ALWAYS } from './constants.js';\nimport { Component } from '../component.js';\nimport { EVENT_MOUSEWHEEL } from '../../../platform/input/constants.js';\n\nconst _tempScrollValue = new Vec2();\nclass ScrollViewComponent extends Component {\n\tconstructor(system, entity) {\n\t\tsuper(system, entity);\n\t\tthis._viewportReference = new EntityReference(this, 'viewportEntity', {\n\t\t\t'element#gain': this._onViewportElementGain,\n\t\t\t'element#resize': this._onSetContentOrViewportSize\n\t\t});\n\t\tthis._contentReference = new EntityReference(this, 'contentEntity', {\n\t\t\t'element#gain': this._onContentElementGain,\n\t\t\t'element#lose': this._onContentElementLose,\n\t\t\t'element#resize': this._onSetContentOrViewportSize\n\t\t});\n\t\tthis._scrollbarUpdateFlags = {};\n\t\tthis._scrollbarReferences = {};\n\t\tthis._scrollbarReferences[ORIENTATION_HORIZONTAL] = new EntityReference(this, 'horizontalScrollbarEntity', {\n\t\t\t'scrollbar#set:value': this._onSetHorizontalScrollbarValue,\n\t\t\t'scrollbar#gain': this._onHorizontalScrollbarGain\n\t\t});\n\t\tthis._scrollbarReferences[ORIENTATION_VERTICAL] = new EntityReference(this, 'verticalScrollbarEntity', {\n\t\t\t'scrollbar#set:value': this._onSetVerticalScrollbarValue,\n\t\t\t'scrollbar#gain': this._onVerticalScrollbarGain\n\t\t});\n\t\tthis._prevContentSizes = {};\n\t\tthis._prevContentSizes[ORIENTATION_HORIZONTAL] = null;\n\t\tthis._prevContentSizes[ORIENTATION_VERTICAL] = null;\n\t\tthis._scroll = new Vec2();\n\t\tthis._velocity = new Vec3();\n\t\tthis._dragStartPosition = new Vec3();\n\t\tthis._disabledContentInput = false;\n\t\tthis._disabledContentInputEntities = [];\n\t\tthis._toggleLifecycleListeners('on', system);\n\t\tthis._toggleElementListeners('on');\n\t}\n\t_toggleLifecycleListeners(onOrOff, system) {\n\t\tthis[onOrOff]('set_horizontal', this._onSetHorizontalScrollingEnabled, this);\n\t\tthis[onOrOff]('set_vertical', this._onSetVerticalScrollingEnabled, this);\n\t\tsystem.app.systems.element[onOrOff]('add', this._onElementComponentAdd, this);\n\t\tsystem.app.systems.element[onOrOff]('beforeremove', this._onElementComponentRemove, this);\n\t}\n\t_toggleElementListeners(onOrOff) {\n\t\tif (this.entity.element) {\n\t\t\tif (onOrOff === 'on' && this._hasElementListeners) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.entity.element[onOrOff]('resize', this._onSetContentOrViewportSize, this);\n\t\t\tthis.entity.element[onOrOff](EVENT_MOUSEWHEEL, this._onMouseWheel, this);\n\t\t\tthis._hasElementListeners = onOrOff === 'on';\n\t\t}\n\t}\n\t_onElementComponentAdd(entity) {\n\t\tif (this.entity === entity) {\n\t\t\tthis._toggleElementListeners('on');\n\t\t}\n\t}\n\t_onElementComponentRemove(entity) {\n\t\tif (this.entity === entity) {\n\t\t\tthis._toggleElementListeners('off');\n\t\t}\n\t}\n\t_onViewportElementGain() {\n\t\tthis._syncAll();\n\t}\n\t_onContentElementGain() {\n\t\tthis._destroyDragHelper();\n\t\tthis._contentDragHelper = new ElementDragHelper(this._contentReference.entity.element);\n\t\tthis._contentDragHelper.on('drag:start', this._onContentDragStart, this);\n\t\tthis._contentDragHelper.on('drag:end', this._onContentDragEnd, this);\n\t\tthis._contentDragHelper.on('drag:move', this._onContentDragMove, this);\n\t\tthis._prevContentSizes[ORIENTATION_HORIZONTAL] = null;\n\t\tthis._prevContentSizes[ORIENTATION_VERTICAL] = null;\n\t\tthis._syncAll();\n\t}\n\t_onContentElementLose() {\n\t\tthis._destroyDragHelper();\n\t}\n\t_onContentDragStart() {\n\t\tif (this._contentReference.entity && this.enabled && this.entity.enabled) {\n\t\t\tthis._dragStartPosition.copy(this._contentReference.entity.getLocalPosition());\n\t\t}\n\t}\n\t_onContentDragEnd() {\n\t\tthis._prevContentDragPosition = null;\n\t\tthis._enableContentInput();\n\t}\n\t_onContentDragMove(position) {\n\t\tif (this._contentReference.entity && this.enabled && this.entity.enabled) {\n\t\t\tthis._wasDragged = true;\n\t\t\tthis._setScrollFromContentPosition(position);\n\t\t\tthis._setVelocityFromContentPositionDelta(position);\n\t\t\tif (!this._disabledContentInput) {\n\t\t\t\tconst dx = position.x - this._dragStartPosition.x;\n\t\t\t\tconst dy = position.y - this._dragStartPosition.y;\n\t\t\t\tif (Math.abs(dx) > this.dragThreshold || Math.abs(dy) > this.dragThreshold) {\n\t\t\t\t\tthis._disableContentInput();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t_onSetContentOrViewportSize() {\n\t\tthis._syncAll();\n\t}\n\t_onSetHorizontalScrollbarValue(scrollValueX) {\n\t\tif (!this._scrollbarUpdateFlags[ORIENTATION_HORIZONTAL] && this.enabled && this.entity.enabled) {\n\t\t\tthis._onSetScroll(scrollValueX, null);\n\t\t}\n\t}\n\t_onSetVerticalScrollbarValue(scrollValueY) {\n\t\tif (!this._scrollbarUpdateFlags[ORIENTATION_VERTICAL] && this.enabled && this.entity.enabled) {\n\t\t\tthis._onSetScroll(null, scrollValueY);\n\t\t}\n\t}\n\t_onSetHorizontalScrollingEnabled() {\n\t\tthis._syncScrollbarEnabledState(ORIENTATION_HORIZONTAL);\n\t}\n\t_onSetVerticalScrollingEnabled() {\n\t\tthis._syncScrollbarEnabledState(ORIENTATION_VERTICAL);\n\t}\n\t_onHorizontalScrollbarGain() {\n\t\tthis._syncScrollbarEnabledState(ORIENTATION_HORIZONTAL);\n\t\tthis._syncScrollbarPosition(ORIENTATION_HORIZONTAL);\n\t}\n\t_onVerticalScrollbarGain() {\n\t\tthis._syncScrollbarEnabledState(ORIENTATION_VERTICAL);\n\t\tthis._syncScrollbarPosition(ORIENTATION_VERTICAL);\n\t}\n\t_onSetScroll(x, y, resetVelocity) {\n\t\tif (resetVelocity !== false) {\n\t\t\tthis._velocity.set(0, 0, 0);\n\t\t}\n\t\tconst xChanged = this._updateAxis(x, 'x', ORIENTATION_HORIZONTAL);\n\t\tconst yChanged = this._updateAxis(y, 'y', ORIENTATION_VERTICAL);\n\t\tif (xChanged || yChanged) {\n\t\t\tthis.fire('set:scroll', this._scroll);\n\t\t}\n\t}\n\t_updateAxis(scrollValue, axis, orientation) {\n\t\tconst hasChanged = scrollValue !== null && Math.abs(scrollValue - this._scroll[axis]) > 1e-5;\n\t\tif (hasChanged || this._isDragging() || scrollValue === 0) {\n\t\t\tthis._scroll[axis] = this._determineNewScrollValue(scrollValue, axis, orientation);\n\t\t\tthis._syncContentPosition(orientation);\n\t\t\tthis._syncScrollbarPosition(orientation);\n\t\t}\n\t\treturn hasChanged;\n\t}\n\t_determineNewScrollValue(scrollValue, axis, orientation) {\n\t\tif (!this._getScrollingEnabled(orientation)) {\n\t\t\treturn this._scroll[axis];\n\t\t}\n\t\tswitch (this.scrollMode) {\n\t\t\tcase SCROLL_MODE_CLAMP:\n\t\t\t\treturn math.clamp(scrollValue, 0, this._getMaxScrollValue(orientation));\n\t\t\tcase SCROLL_MODE_BOUNCE:\n\t\t\t\tthis._setVelocityFromOvershoot(scrollValue, axis, orientation);\n\t\t\t\treturn scrollValue;\n\t\t\tcase SCROLL_MODE_INFINITE:\n\t\t\t\treturn scrollValue;\n\t\t\tdefault:\n\t\t\t\tconsole.warn('Unhandled scroll mode:' + this.scrollMode);\n\t\t\t\treturn scrollValue;\n\t\t}\n\t}\n\t_syncAll() {\n\t\tthis._syncContentPosition(ORIENTATION_HORIZONTAL);\n\t\tthis._syncContentPosition(ORIENTATION_VERTICAL);\n\t\tthis._syncScrollbarPosition(ORIENTATION_HORIZONTAL);\n\t\tthis._syncScrollbarPosition(ORIENTATION_VERTICAL);\n\t\tthis._syncScrollbarEnabledState(ORIENTATION_HORIZONTAL);\n\t\tthis._syncScrollbarEnabledState(ORIENTATION_VERTICAL);\n\t}\n\t_syncContentPosition(orientation) {\n\t\tconst axis = this._getAxis(orientation);\n\t\tconst sign = this._getSign(orientation);\n\t\tconst contentEntity = this._contentReference.entity;\n\t\tif (contentEntity) {\n\t\t\tconst prevContentSize = this._prevContentSizes[orientation];\n\t\t\tconst currContentSize = this._getContentSize(orientation);\n\t\t\tif (prevContentSize !== null && Math.abs(prevContentSize - currContentSize) > 1e-4) {\n\t\t\t\tconst prevMaxOffset = this._getMaxOffset(orientation, prevContentSize);\n\t\t\t\tconst currMaxOffset = this._getMaxOffset(orientation, currContentSize);\n\t\t\t\tif (currMaxOffset === 0) {\n\t\t\t\t\tthis._scroll[axis] = 1;\n\t\t\t\t} else {\n\t\t\t\t\tthis._scroll[axis] = math.clamp(this._scroll[axis] * prevMaxOffset / currMaxOffset, 0, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst offset = this._scroll[axis] * this._getMaxOffset(orientation);\n\t\t\tconst contentPosition = contentEntity.getLocalPosition();\n\t\t\tcontentPosition[axis] = offset * sign;\n\t\t\tcontentEntity.setLocalPosition(contentPosition);\n\t\t\tthis._prevContentSizes[orientation] = currContentSize;\n\t\t}\n\t}\n\t_syncScrollbarPosition(orientation) {\n\t\tconst axis = this._getAxis(orientation);\n\t\tconst scrollbarEntity = this._scrollbarReferences[orientation].entity;\n\t\tif (scrollbarEntity && scrollbarEntity.scrollbar) {\n\t\t\tthis._scrollbarUpdateFlags[orientation] = true;\n\t\t\tscrollbarEntity.scrollbar.value = this._scroll[axis];\n\t\t\tscrollbarEntity.scrollbar.handleSize = this._getScrollbarHandleSize(axis, orientation);\n\t\t\tthis._scrollbarUpdateFlags[orientation] = false;\n\t\t}\n\t}\n\t_syncScrollbarEnabledState(orientation) {\n\t\tconst entity = this._scrollbarReferences[orientation].entity;\n\t\tif (entity) {\n\t\t\tconst isScrollingEnabled = this._getScrollingEnabled(orientation);\n\t\t\tconst requestedVisibility = this._getScrollbarVisibility(orientation);\n\t\t\tswitch (requestedVisibility) {\n\t\t\t\tcase SCROLLBAR_VISIBILITY_SHOW_ALWAYS:\n\t\t\t\t\tentity.enabled = isScrollingEnabled;\n\t\t\t\t\treturn;\n\t\t\t\tcase SCROLLBAR_VISIBILITY_SHOW_WHEN_REQUIRED:\n\t\t\t\t\tentity.enabled = isScrollingEnabled && this._contentIsLargerThanViewport(orientation);\n\t\t\t\t\treturn;\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.warn('Unhandled scrollbar visibility:' + requestedVisibility);\n\t\t\t\t\tentity.enabled = isScrollingEnabled;\n\t\t\t}\n\t\t}\n\t}\n\t_contentIsLargerThanViewport(orientation) {\n\t\treturn this._getContentSize(orientation) > this._getViewportSize(orientation);\n\t}\n\t_contentPositionToScrollValue(contentPosition) {\n\t\tconst maxOffsetH = this._getMaxOffset(ORIENTATION_HORIZONTAL);\n\t\tconst maxOffsetV = this._getMaxOffset(ORIENTATION_VERTICAL);\n\t\tif (maxOffsetH === 0) {\n\t\t\t_tempScrollValue.x = 0;\n\t\t} else {\n\t\t\t_tempScrollValue.x = contentPosition.x / maxOffsetH;\n\t\t}\n\t\tif (maxOffsetV === 0) {\n\t\t\t_tempScrollValue.y = 0;\n\t\t} else {\n\t\t\t_tempScrollValue.y = contentPosition.y / -maxOffsetV;\n\t\t}\n\t\treturn _tempScrollValue;\n\t}\n\t_getMaxOffset(orientation, contentSize) {\n\t\tcontentSize = contentSize === undefined ? this._getContentSize(orientation) : contentSize;\n\t\tconst viewportSize = this._getViewportSize(orientation);\n\t\tif (contentSize < viewportSize) {\n\t\t\treturn -this._getViewportSize(orientation);\n\t\t}\n\t\treturn viewportSize - contentSize;\n\t}\n\t_getMaxScrollValue(orientation) {\n\t\treturn this._contentIsLargerThanViewport(orientation) ? 1 : 0;\n\t}\n\t_getScrollbarHandleSize(axis, orientation) {\n\t\tconst viewportSize = this._getViewportSize(orientation);\n\t\tconst contentSize = this._getContentSize(orientation);\n\t\tif (Math.abs(contentSize) < 0.001) {\n\t\t\treturn 1;\n\t\t}\n\t\tconst handleSize = Math.min(viewportSize / contentSize, 1);\n\t\tconst overshoot = this._toOvershoot(this._scroll[axis], orientation);\n\t\tif (overshoot === 0) {\n\t\t\treturn handleSize;\n\t\t}\n\t\treturn handleSize / (1 + Math.abs(overshoot));\n\t}\n\t_getViewportSize(orientation) {\n\t\treturn this._getSize(orientation, this._viewportReference);\n\t}\n\t_getContentSize(orientation) {\n\t\treturn this._getSize(orientation, this._contentReference);\n\t}\n\t_getSize(orientation, entityReference) {\n\t\tif (entityReference.entity && entityReference.entity.element) {\n\t\t\treturn entityReference.entity.element[this._getCalculatedDimension(orientation)];\n\t\t}\n\t\treturn 0;\n\t}\n\t_getScrollingEnabled(orientation) {\n\t\tif (orientation === ORIENTATION_HORIZONTAL) {\n\t\t\treturn this.horizontal;\n\t\t} else if (orientation === ORIENTATION_VERTICAL) {\n\t\t\treturn this.vertical;\n\t\t}\n\t\treturn undefined;\n\t}\n\t_getScrollbarVisibility(orientation) {\n\t\tif (orientation === ORIENTATION_HORIZONTAL) {\n\t\t\treturn this.horizontalScrollbarVisibility;\n\t\t} else if (orientation === ORIENTATION_VERTICAL) {\n\t\t\treturn this.verticalScrollbarVisibility;\n\t\t}\n\t\treturn undefined;\n\t}\n\t_getSign(orientation) {\n\t\treturn orientation === ORIENTATION_HORIZONTAL ? 1 : -1;\n\t}\n\t_getAxis(orientation) {\n\t\treturn orientation === ORIENTATION_HORIZONTAL ? 'x' : 'y';\n\t}\n\t_getCalculatedDimension(orientation) {\n\t\treturn orientation === ORIENTATION_HORIZONTAL ? 'calculatedWidth' : 'calculatedHeight';\n\t}\n\t_destroyDragHelper() {\n\t\tif (this._contentDragHelper) {\n\t\t\tthis._contentDragHelper.destroy();\n\t\t}\n\t}\n\tonUpdate() {\n\t\tif (this._contentReference.entity) {\n\t\t\tthis._updateVelocity();\n\t\t\tthis._syncScrollbarEnabledState(ORIENTATION_HORIZONTAL);\n\t\t\tthis._syncScrollbarEnabledState(ORIENTATION_VERTICAL);\n\t\t}\n\t}\n\t_updateVelocity() {\n\t\tif (!this._isDragging()) {\n\t\t\tif (this.scrollMode === SCROLL_MODE_BOUNCE) {\n\t\t\t\tif (this._hasOvershoot('x', ORIENTATION_HORIZONTAL)) {\n\t\t\t\t\tthis._setVelocityFromOvershoot(this.scroll.x, 'x', ORIENTATION_HORIZONTAL);\n\t\t\t\t}\n\t\t\t\tif (this._hasOvershoot('y', ORIENTATION_VERTICAL)) {\n\t\t\t\t\tthis._setVelocityFromOvershoot(this.scroll.y, 'y', ORIENTATION_VERTICAL);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (Math.abs(this._velocity.x) > 1e-4 || Math.abs(this._velocity.y) > 1e-4) {\n\t\t\t\tconst position = this._contentReference.entity.getLocalPosition();\n\t\t\t\tposition.x += this._velocity.x;\n\t\t\t\tposition.y += this._velocity.y;\n\t\t\t\tthis._contentReference.entity.setLocalPosition(position);\n\t\t\t\tthis._setScrollFromContentPosition(position);\n\t\t\t}\n\t\t\tthis._velocity.x *= 1 - this.friction;\n\t\t\tthis._velocity.y *= 1 - this.friction;\n\t\t}\n\t}\n\t_hasOvershoot(axis, orientation) {\n\t\treturn Math.abs(this._toOvershoot(this.scroll[axis], orientation)) > 0.001;\n\t}\n\t_toOvershoot(scrollValue, orientation) {\n\t\tconst maxScrollValue = this._getMaxScrollValue(orientation);\n\t\tif (scrollValue < 0) {\n\t\t\treturn scrollValue;\n\t\t} else if (scrollValue > maxScrollValue) {\n\t\t\treturn scrollValue - maxScrollValue;\n\t\t}\n\t\treturn 0;\n\t}\n\t_setVelocityFromOvershoot(scrollValue, axis, orientation) {\n\t\tconst overshootValue = this._toOvershoot(scrollValue, orientation);\n\t\tconst overshootPixels = overshootValue * this._getMaxOffset(orientation) * this._getSign(orientation);\n\t\tif (Math.abs(overshootPixels) > 0) {\n\t\t\tthis._velocity[axis] = -overshootPixels / (this.bounceAmount * 50 + 1);\n\t\t}\n\t}\n\t_setVelocityFromContentPositionDelta(position) {\n\t\tif (this._prevContentDragPosition) {\n\t\t\tthis._velocity.sub2(position, this._prevContentDragPosition);\n\t\t\tthis._prevContentDragPosition.copy(position);\n\t\t} else {\n\t\t\tthis._velocity.set(0, 0, 0);\n\t\t\tthis._prevContentDragPosition = position.clone();\n\t\t}\n\t}\n\t_setScrollFromContentPosition(position) {\n\t\tlet scrollValue = this._contentPositionToScrollValue(position);\n\t\tif (this._isDragging()) {\n\t\t\tscrollValue = this._applyScrollValueTension(scrollValue);\n\t\t}\n\t\tthis._onSetScroll(scrollValue.x, scrollValue.y, false);\n\t}\n\t_applyScrollValueTension(scrollValue) {\n\t\tconst factor = 1;\n\t\tlet max = this._getMaxScrollValue(ORIENTATION_HORIZONTAL);\n\t\tlet overshoot = this._toOvershoot(scrollValue.x, ORIENTATION_HORIZONTAL);\n\t\tif (overshoot > 0) {\n\t\t\tscrollValue.x = max + factor * Math.log10(1 + overshoot);\n\t\t} else if (overshoot < 0) {\n\t\t\tscrollValue.x = -factor * Math.log10(1 - overshoot);\n\t\t}\n\t\tmax = this._getMaxScrollValue(ORIENTATION_VERTICAL);\n\t\tovershoot = this._toOvershoot(scrollValue.y, ORIENTATION_VERTICAL);\n\t\tif (overshoot > 0) {\n\t\t\tscrollValue.y = max + factor * Math.log10(1 + overshoot);\n\t\t} else if (overshoot < 0) {\n\t\t\tscrollValue.y = -factor * Math.log10(1 - overshoot);\n\t\t}\n\t\treturn scrollValue;\n\t}\n\t_isDragging() {\n\t\treturn this._contentDragHelper && this._contentDragHelper.isDragging;\n\t}\n\t_setScrollbarComponentsEnabled(enabled) {\n\t\tif (this._scrollbarReferences[ORIENTATION_HORIZONTAL].hasComponent('scrollbar')) {\n\t\t\tthis._scrollbarReferences[ORIENTATION_HORIZONTAL].entity.scrollbar.enabled = enabled;\n\t\t}\n\t\tif (this._scrollbarReferences[ORIENTATION_VERTICAL].hasComponent('scrollbar')) {\n\t\t\tthis._scrollbarReferences[ORIENTATION_VERTICAL].entity.scrollbar.enabled = enabled;\n\t\t}\n\t}\n\t_setContentDraggingEnabled(enabled) {\n\t\tif (this._contentDragHelper) {\n\t\t\tthis._contentDragHelper.enabled = enabled;\n\t\t}\n\t}\n\t_onMouseWheel(event) {\n\t\tif (this.useMouseWheel) {\n\t\t\tconst wheelEvent = event.event;\n\t\t\tconst normalizedDeltaX = wheelEvent.deltaX / this._contentReference.entity.element.calculatedWidth * this.mouseWheelSensitivity.x;\n\t\t\tconst normalizedDeltaY = wheelEvent.deltaY / this._contentReference.entity.element.calculatedHeight * this.mouseWheelSensitivity.y;\n\t\t\tconst scrollX = math.clamp(this._scroll.x + normalizedDeltaX, 0, this._getMaxScrollValue(ORIENTATION_HORIZONTAL));\n\t\t\tconst scrollY = math.clamp(this._scroll.y + normalizedDeltaY, 0, this._getMaxScrollValue(ORIENTATION_VERTICAL));\n\t\t\tthis.scroll = new Vec2(scrollX, scrollY);\n\t\t}\n\t}\n\t_enableContentInput() {\n\t\twhile (this._disabledContentInputEntities.length) {\n\t\t\tconst e = this._disabledContentInputEntities.pop();\n\t\t\tif (e.element) {\n\t\t\t\te.element.useInput = true;\n\t\t\t}\n\t\t}\n\t\tthis._disabledContentInput = false;\n\t}\n\t_disableContentInput() {\n\t\tconst _disableInput = e => {\n\t\t\tif (e.element && e.element.useInput) {\n\t\t\t\tthis._disabledContentInputEntities.push(e);\n\t\t\t\te.element.useInput = false;\n\t\t\t}\n\t\t\tconst children = e.children;\n\t\t\tfor (let i = 0, l = children.length; i < l; i++) {\n\t\t\t\t_disableInput(children[i]);\n\t\t\t}\n\t\t};\n\t\tconst contentEntity = this._contentReference.entity;\n\t\tif (contentEntity) {\n\t\t\tconst children = contentEntity.children;\n\t\t\tfor (let i = 0, l = children.length; i < l; i++) {\n\t\t\t\t_disableInput(children[i]);\n\t\t\t}\n\t\t}\n\t\tthis._disabledContentInput = true;\n\t}\n\tonEnable() {\n\t\tthis._viewportReference.onParentComponentEnable();\n\t\tthis._contentReference.onParentComponentEnable();\n\t\tthis._scrollbarReferences[ORIENTATION_HORIZONTAL].onParentComponentEnable();\n\t\tthis._scrollbarReferences[ORIENTATION_VERTICAL].onParentComponentEnable();\n\t\tthis._setScrollbarComponentsEnabled(true);\n\t\tthis._setContentDraggingEnabled(true);\n\t\tthis._syncAll();\n\t}\n\tonDisable() {\n\t\tthis._setScrollbarComponentsEnabled(false);\n\t\tthis._setContentDraggingEnabled(false);\n\t}\n\tonRemove() {\n\t\tthis._toggleLifecycleListeners('off', this.system);\n\t\tthis._toggleElementListeners('off');\n\t\tthis._destroyDragHelper();\n\t}\n\tset scroll(value) {\n\t\tthis._onSetScroll(value.x, value.y);\n\t}\n\tget scroll() {\n\t\treturn this._scroll;\n\t}\n}\n\nexport { ScrollViewComponent };\n","class ScrollViewComponentData {\n\tconstructor() {\n\t\tthis.enabled = true;\n\t}\n}\n\nexport { ScrollViewComponentData };\n","import { Component } from '../component.js';\nimport { ComponentSystem } from '../system.js';\nimport { ScrollViewComponent } from './component.js';\nimport { ScrollViewComponentData } from './data.js';\nimport { Vec2 } from '../../../core/math/vec2.js';\n\nconst _schema = [{\n\tname: 'enabled',\n\ttype: 'boolean'\n}, {\n\tname: 'horizontal',\n\ttype: 'boolean'\n}, {\n\tname: 'vertical',\n\ttype: 'boolean'\n}, {\n\tname: 'scrollMode',\n\ttype: 'number'\n}, {\n\tname: 'bounceAmount',\n\ttype: 'number'\n}, {\n\tname: 'friction',\n\ttype: 'number'\n}, {\n\tname: 'dragThreshold',\n\ttype: 'number'\n}, {\n\tname: 'useMouseWheel',\n\ttype: 'boolean'\n}, {\n\tname: 'mouseWheelSensitivity',\n\ttype: 'vec2'\n}, {\n\tname: 'horizontalScrollbarVisibility',\n\ttype: 'number'\n}, {\n\tname: 'verticalScrollbarVisibility',\n\ttype: 'number'\n}, {\n\tname: 'viewportEntity',\n\ttype: 'entity'\n}, {\n\tname: 'contentEntity',\n\ttype: 'entity'\n}, {\n\tname: 'horizontalScrollbarEntity',\n\ttype: 'entity'\n}, {\n\tname: 'verticalScrollbarEntity',\n\ttype: 'entity'\n}];\nconst DEFAULT_DRAG_THRESHOLD = 10;\nclass ScrollViewComponentSystem extends ComponentSystem {\n\tconstructor(app) {\n\t\tsuper(app);\n\t\tthis.id = 'scrollview';\n\t\tthis.ComponentType = ScrollViewComponent;\n\t\tthis.DataType = ScrollViewComponentData;\n\t\tthis.schema = _schema;\n\t\tthis.on('beforeremove', this._onRemoveComponent, this);\n\t\tthis.app.systems.on('update', this.onUpdate, this);\n\t}\n\tinitializeComponentData(component, data, properties) {\n\t\tif (data.dragThreshold === undefined) {\n\t\t\tdata.dragThreshold = DEFAULT_DRAG_THRESHOLD;\n\t\t}\n\t\tif (data.useMouseWheel === undefined) {\n\t\t\tdata.useMouseWheel = true;\n\t\t}\n\t\tif (data.mouseWheelSensitivity === undefined) {\n\t\t\tdata.mouseWheelSensitivity = new Vec2(1, 1);\n\t\t}\n\t\tsuper.initializeComponentData(component, data, _schema);\n\t}\n\tonUpdate(dt) {\n\t\tconst components = this.store;\n\t\tfor (const id in components) {\n\t\t\tconst entity = components[id].entity;\n\t\t\tconst component = entity.scrollview;\n\t\t\tif (component.enabled && entity.enabled) {\n\t\t\t\tcomponent.onUpdate();\n\t\t\t}\n\t\t}\n\t}\n\t_onRemoveComponent(entity, component) {\n\t\tcomponent.onRemove();\n\t}\n\tdestroy() {\n\t\tsuper.destroy();\n\t\tthis.app.systems.off('update', this.onUpdate, this);\n\t}\n}\nComponent._buildAccessors(ScrollViewComponent.prototype, _schema);\n\nexport { ScrollViewComponentSystem };\n","import { math } from '../../../core/math/math.js';\nimport { ORIENTATION_HORIZONTAL } from '../../../scene/constants.js';\nimport { Component } from '../component.js';\nimport { ElementDragHelper } from '../element/element-drag-helper.js';\nimport { EntityReference } from '../../utils/entity-reference.js';\n\nclass ScrollbarComponent extends Component {\n\tconstructor(system, entity) {\n\t\tsuper(system, entity);\n\t\tthis._handleReference = new EntityReference(this, 'handleEntity', {\n\t\t\t'element#gain': this._onHandleElementGain,\n\t\t\t'element#lose': this._onHandleElementLose,\n\t\t\t'element#set:anchor': this._onSetHandleAlignment,\n\t\t\t'element#set:margin': this._onSetHandleAlignment,\n\t\t\t'element#set:pivot': this._onSetHandleAlignment\n\t\t});\n\t\tthis._toggleLifecycleListeners('on');\n\t}\n\t_toggleLifecycleListeners(onOrOff) {\n\t\tthis[onOrOff]('set_value', this._onSetValue, this);\n\t\tthis[onOrOff]('set_handleSize', this._onSetHandleSize, this);\n\t\tthis[onOrOff]('set_orientation', this._onSetOrientation, this);\n\t}\n\t_onHandleElementGain() {\n\t\tthis._destroyDragHelper();\n\t\tthis._handleDragHelper = new ElementDragHelper(this._handleReference.entity.element, this._getAxis());\n\t\tthis._handleDragHelper.on('drag:move', this._onHandleDrag, this);\n\t\tthis._updateHandlePositionAndSize();\n\t}\n\t_onHandleElementLose() {\n\t\tthis._destroyDragHelper();\n\t}\n\t_onHandleDrag(position) {\n\t\tif (this._handleReference.entity && this.enabled && this.entity.enabled) {\n\t\t\tthis.value = this._handlePositionToScrollValue(position[this._getAxis()]);\n\t\t}\n\t}\n\t_onSetValue(name, oldValue, newValue) {\n\t\tif (Math.abs(newValue - oldValue) > 1e-5) {\n\t\t\tthis.data.value = math.clamp(newValue, 0, 1);\n\t\t\tthis._updateHandlePositionAndSize();\n\t\t\tthis.fire('set:value', this.data.value);\n\t\t}\n\t}\n\t_onSetHandleSize(name, oldValue, newValue) {\n\t\tif (Math.abs(newValue - oldValue) > 1e-5) {\n\t\t\tthis.data.handleSize = math.clamp(newValue, 0, 1);\n\t\t\tthis._updateHandlePositionAndSize();\n\t\t}\n\t}\n\t_onSetHandleAlignment() {\n\t\tthis._updateHandlePositionAndSize();\n\t}\n\t_onSetOrientation(name, oldValue, newValue) {\n\t\tif (newValue !== oldValue && this._handleReference.hasComponent('element')) {\n\t\t\tthis._handleReference.entity.element[this._getOppositeDimension()] = 0;\n\t\t}\n\t}\n\t_updateHandlePositionAndSize() {\n\t\tconst handleEntity = this._handleReference.entity;\n\t\tconst handleElement = handleEntity && handleEntity.element;\n\t\tif (handleEntity) {\n\t\t\tconst position = handleEntity.getLocalPosition();\n\t\t\tposition[this._getAxis()] = this._getHandlePosition();\n\t\t\tthis._handleReference.entity.setLocalPosition(position);\n\t\t}\n\t\tif (handleElement) {\n\t\t\thandleElement[this._getDimension()] = this._getHandleLength();\n\t\t}\n\t}\n\t_handlePositionToScrollValue(handlePosition) {\n\t\treturn handlePosition * this._getSign() / this._getUsableTrackLength();\n\t}\n\t_scrollValueToHandlePosition(value) {\n\t\treturn value * this._getSign() * this._getUsableTrackLength();\n\t}\n\t_getUsableTrackLength() {\n\t\treturn Math.max(this._getTrackLength() - this._getHandleLength(), 0.001);\n\t}\n\t_getTrackLength() {\n\t\tif (this.entity.element) {\n\t\t\treturn this.orientation === ORIENTATION_HORIZONTAL ? this.entity.element.calculatedWidth : this.entity.element.calculatedHeight;\n\t\t}\n\t\treturn 0;\n\t}\n\t_getHandleLength() {\n\t\treturn this._getTrackLength() * this.handleSize;\n\t}\n\t_getHandlePosition() {\n\t\treturn this._scrollValueToHandlePosition(this.value);\n\t}\n\t_getSign() {\n\t\treturn this.orientation === ORIENTATION_HORIZONTAL ? 1 : -1;\n\t}\n\t_getAxis() {\n\t\treturn this.orientation === ORIENTATION_HORIZONTAL ? 'x' : 'y';\n\t}\n\t_getDimension() {\n\t\treturn this.orientation === ORIENTATION_HORIZONTAL ? 'width' : 'height';\n\t}\n\t_getOppositeDimension() {\n\t\treturn this.orientation === ORIENTATION_HORIZONTAL ? 'height' : 'width';\n\t}\n\t_destroyDragHelper() {\n\t\tif (this._handleDragHelper) {\n\t\t\tthis._handleDragHelper.destroy();\n\t\t}\n\t}\n\t_setHandleDraggingEnabled(enabled) {\n\t\tif (this._handleDragHelper) {\n\t\t\tthis._handleDragHelper.enabled = enabled;\n\t\t}\n\t}\n\tonEnable() {\n\t\tthis._handleReference.onParentComponentEnable();\n\t\tthis._setHandleDraggingEnabled(true);\n\t}\n\tonDisable() {\n\t\tthis._setHandleDraggingEnabled(false);\n\t}\n\tonRemove() {\n\t\tthis._destroyDragHelper();\n\t\tthis._toggleLifecycleListeners('off');\n\t}\n}\n\nexport { ScrollbarComponent };\n","class ScrollbarComponentData {\n\tconstructor() {\n\t\tthis.enabled = true;\n\t}\n}\n\nexport { ScrollbarComponentData };\n","import { Component } from '../component.js';\nimport { ComponentSystem } from '../system.js';\nimport { ScrollbarComponent } from './component.js';\nimport { ScrollbarComponentData } from './data.js';\n\nconst _schema = [{\n\tname: 'enabled',\n\ttype: 'boolean'\n}, {\n\tname: 'orientation',\n\ttype: 'number'\n}, {\n\tname: 'value',\n\ttype: 'number'\n}, {\n\tname: 'handleSize',\n\ttype: 'number'\n}, {\n\tname: 'handleEntity',\n\ttype: 'entity'\n}];\nclass ScrollbarComponentSystem extends ComponentSystem {\n\tconstructor(app) {\n\t\tsuper(app);\n\t\tthis.id = 'scrollbar';\n\t\tthis.ComponentType = ScrollbarComponent;\n\t\tthis.DataType = ScrollbarComponentData;\n\t\tthis.schema = _schema;\n\t\tthis.on('beforeremove', this._onRemoveComponent, this);\n\t}\n\tinitializeComponentData(component, data, properties) {\n\t\tsuper.initializeComponentData(component, data, _schema);\n\t}\n\t_onRemoveComponent(entity, component) {\n\t\tcomponent.onRemove();\n\t}\n}\nComponent._buildAccessors(ScrollbarComponent.prototype, _schema);\n\nexport { ScrollbarComponentSystem };\n","import { EventHandler } from '../../../core/event-handler.js';\nimport '../../../core/tracing.js';\nimport { math } from '../../../core/math/math.js';\nimport { Vec3 } from '../../../core/math/vec3.js';\nimport { Asset } from '../../asset/asset.js';\nimport { SoundInstance } from '../../../platform/sound/instance.js';\nimport { SoundInstance3d } from '../../../platform/sound/instance3d.js';\n\nconst instanceOptions = {\n\tvolume: 0,\n\tpitch: 0,\n\tloop: false,\n\tstartTime: 0,\n\tduration: 0,\n\tposition: new Vec3(),\n\tmaxDistance: 0,\n\trefDistance: 0,\n\trollOffFactor: 0,\n\tdistanceModel: 0,\n\tonPlay: null,\n\tonPause: null,\n\tonResume: null,\n\tonStop: null,\n\tonEnd: null\n};\nclass SoundSlot extends EventHandler {\n\tconstructor(component, name = 'Untitled', options = {}) {\n\t\tsuper();\n\t\tthis.name = void 0;\n\t\tthis.instances = [];\n\t\tthis._component = component;\n\t\tthis._assets = component.system.app.assets;\n\t\tthis._manager = component.system.manager;\n\t\tthis.name = name;\n\t\tthis._volume = options.volume !== undefined ? math.clamp(Number(options.volume) || 0, 0, 1) : 1;\n\t\tthis._pitch = options.pitch !== undefined ? Math.max(0.01, Number(options.pitch) || 0) : 1;\n\t\tthis._loop = !!(options.loop !== undefined ? options.loop : false);\n\t\tthis._duration = options.duration > 0 ? options.duration : null;\n\t\tthis._startTime = Math.max(0, Number(options.startTime) || 0);\n\t\tthis._overlap = !!options.overlap;\n\t\tthis._autoPlay = !!options.autoPlay;\n\t\tthis._firstNode = null;\n\t\tthis._lastNode = null;\n\t\tthis._asset = options.asset;\n\t\tif (this._asset instanceof Asset) {\n\t\t\tthis._asset = this._asset.id;\n\t\t}\n\t\tthis._onInstancePlayHandler = this._onInstancePlay.bind(this);\n\t\tthis._onInstancePauseHandler = this._onInstancePause.bind(this);\n\t\tthis._onInstanceResumeHandler = this._onInstanceResume.bind(this);\n\t\tthis._onInstanceStopHandler = this._onInstanceStop.bind(this);\n\t\tthis._onInstanceEndHandler = this._onInstanceEnd.bind(this);\n\t}\n\tplay() {\n\t\tif (!this.overlap) {\n\t\t\tthis.stop();\n\t\t}\n\t\tif (!this.isLoaded && !this._hasAsset()) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst instance = this._createInstance();\n\t\tthis.instances.push(instance);\n\t\tif (!this.isLoaded) {\n\t\t\tconst onLoad = function onLoad(sound) {\n\t\t\t\tconst playWhenLoaded = instance._playWhenLoaded;\n\t\t\t\tinstance.sound = sound;\n\t\t\t\tif (playWhenLoaded) {\n\t\t\t\t\tinstance.play();\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.off('load', onLoad);\n\t\t\tthis.once('load', onLoad);\n\t\t\tthis.load();\n\t\t} else {\n\t\t\tinstance.play();\n\t\t}\n\t\treturn instance;\n\t}\n\tpause() {\n\t\tlet paused = false;\n\t\tconst instances = this.instances;\n\t\tfor (let i = 0, len = instances.length; i < len; i++) {\n\t\t\tif (instances[i].pause()) {\n\t\t\t\tpaused = true;\n\t\t\t}\n\t\t}\n\t\treturn paused;\n\t}\n\tresume() {\n\t\tlet resumed = false;\n\t\tconst instances = this.instances;\n\t\tfor (let i = 0, len = instances.length; i < len; i++) {\n\t\t\tif (instances[i].resume()) resumed = true;\n\t\t}\n\t\treturn resumed;\n\t}\n\tstop() {\n\t\tlet stopped = false;\n\t\tconst instances = this.instances;\n\t\tlet i = instances.length;\n\t\twhile (i--) {\n\t\t\tinstances[i].stop();\n\t\t\tstopped = true;\n\t\t}\n\t\tinstances.length = 0;\n\t\treturn stopped;\n\t}\n\tload() {\n\t\tif (!this._hasAsset()) return;\n\t\tconst asset = this._assets.get(this._asset);\n\t\tif (!asset) {\n\t\t\tthis._assets.off('add:' + this._asset, this._onAssetAdd, this);\n\t\t\tthis._assets.once('add:' + this._asset, this._onAssetAdd, this);\n\t\t\treturn;\n\t\t}\n\t\tasset.off('remove', this._onAssetRemoved, this);\n\t\tasset.on('remove', this._onAssetRemoved, this);\n\t\tif (!asset.resource) {\n\t\t\tasset.off('load', this._onAssetLoad, this);\n\t\t\tasset.once('load', this._onAssetLoad, this);\n\t\t\tthis._assets.load(asset);\n\t\t\treturn;\n\t\t}\n\t\tthis.fire('load', asset.resource);\n\t}\n\tsetExternalNodes(firstNode, lastNode) {\n\t\tif (!firstNode) {\n\t\t\tconsole.error('The firstNode must have a valid AudioNode');\n\t\t\treturn;\n\t\t}\n\t\tif (!lastNode) {\n\t\t\tlastNode = firstNode;\n\t\t}\n\t\tthis._firstNode = firstNode;\n\t\tthis._lastNode = lastNode;\n\t\tif (!this._overlap) {\n\t\t\tconst instances = this.instances;\n\t\t\tfor (let i = 0, len = instances.length; i < len; i++) {\n\t\t\t\tinstances[i].setExternalNodes(firstNode, lastNode);\n\t\t\t}\n\t\t}\n\t}\n\tclearExternalNodes() {\n\t\tthis._firstNode = null;\n\t\tthis._lastNode = null;\n\t\tif (!this._overlap) {\n\t\t\tconst instances = this.instances;\n\t\t\tfor (let i = 0, len = instances.length; i < len; i++) {\n\t\t\t\tinstances[i].clearExternalNodes();\n\t\t\t}\n\t\t}\n\t}\n\tgetExternalNodes() {\n\t\treturn [this._firstNode, this._lastNode];\n\t}\n\t_hasAsset() {\n\t\treturn this._asset != null;\n\t}\n\t_createInstance() {\n\t\tlet instance = null;\n\t\tconst component = this._component;\n\t\tlet sound = null;\n\t\tif (this._hasAsset()) {\n\t\t\tconst asset = this._assets.get(this._asset);\n\t\t\tif (asset) {\n\t\t\t\tsound = asset.resource;\n\t\t\t}\n\t\t}\n\t\tconst data = instanceOptions;\n\t\tdata.volume = this._volume * component.volume;\n\t\tdata.pitch = this._pitch * component.pitch;\n\t\tdata.loop = this._loop;\n\t\tdata.startTime = this._startTime;\n\t\tdata.duration = this._duration;\n\t\tdata.onPlay = this._onInstancePlayHandler;\n\t\tdata.onPause = this._onInstancePauseHandler;\n\t\tdata.onResume = this._onInstanceResumeHandler;\n\t\tdata.onStop = this._onInstanceStopHandler;\n\t\tdata.onEnd = this._onInstanceEndHandler;\n\t\tif (component.positional) {\n\t\t\tdata.position.copy(component.entity.getPosition());\n\t\t\tdata.maxDistance = component.maxDistance;\n\t\t\tdata.refDistance = component.refDistance;\n\t\t\tdata.rollOffFactor = component.rollOffFactor;\n\t\t\tdata.distanceModel = component.distanceModel;\n\t\t\tinstance = new SoundInstance3d(this._manager, sound, data);\n\t\t} else {\n\t\t\tinstance = new SoundInstance(this._manager, sound, data);\n\t\t}\n\t\tif (this._firstNode) {\n\t\t\tinstance.setExternalNodes(this._firstNode, this._lastNode);\n\t\t}\n\t\treturn instance;\n\t}\n\t_onInstancePlay(instance) {\n\t\tthis.fire('play', instance);\n\t\tthis._component.fire('play', this, instance);\n\t}\n\t_onInstancePause(instance) {\n\t\tthis.fire('pause', instance);\n\t\tthis._component.fire('pause', this, instance);\n\t}\n\t_onInstanceResume(instance) {\n\t\tthis.fire('resume', instance);\n\t\tthis._component.fire('resume', this, instance);\n\t}\n\t_onInstanceStop(instance) {\n\t\tconst idx = this.instances.indexOf(instance);\n\t\tif (idx !== -1) {\n\t\t\tthis.instances.splice(idx, 1);\n\t\t}\n\t\tthis.fire('stop', instance);\n\t\tthis._component.fire('stop', this, instance);\n\t}\n\t_onInstanceEnd(instance) {\n\t\tconst idx = this.instances.indexOf(instance);\n\t\tif (idx !== -1) {\n\t\t\tthis.instances.splice(idx, 1);\n\t\t}\n\t\tthis.fire('end', instance);\n\t\tthis._component.fire('end', this, instance);\n\t}\n\t_onAssetAdd(asset) {\n\t\tthis.load();\n\t}\n\t_onAssetLoad(asset) {\n\t\tthis.load();\n\t}\n\t_onAssetRemoved(asset) {\n\t\tasset.off('remove', this._onAssetRemoved, this);\n\t\tthis._assets.off('add:' + asset.id, this._onAssetAdd, this);\n\t\tthis.stop();\n\t}\n\tupdatePosition(position) {\n\t\tconst instances = this.instances;\n\t\tfor (let i = 0, len = instances.length; i < len; i++) {\n\t\t\tinstances[i].position = position;\n\t\t}\n\t}\n\tset asset(value) {\n\t\tconst old = this._asset;\n\t\tif (old) {\n\t\t\tthis._assets.off('add:' + old, this._onAssetAdd, this);\n\t\t\tconst oldAsset = this._assets.get(old);\n\t\t\tif (oldAsset) {\n\t\t\t\toldAsset.off('remove', this._onAssetRemoved, this);\n\t\t\t}\n\t\t}\n\t\tthis._asset = value;\n\t\tif (this._asset instanceof Asset) {\n\t\t\tthis._asset = this._asset.id;\n\t\t}\n\t\tif (this._hasAsset() && this._component.enabled && this._component.entity.enabled) {\n\t\t\tthis.load();\n\t\t}\n\t}\n\tget asset() {\n\t\treturn this._asset;\n\t}\n\tset autoPlay(value) {\n\t\tthis._autoPlay = !!value;\n\t}\n\tget autoPlay() {\n\t\treturn this._autoPlay;\n\t}\n\tset duration(value) {\n\t\tthis._duration = Math.max(0, Number(value) || 0) || null;\n\t\tif (!this._overlap) {\n\t\t\tconst instances = this.instances;\n\t\t\tfor (let i = 0, len = instances.length; i < len; i++) {\n\t\t\t\tinstances[i].duration = this._duration;\n\t\t\t}\n\t\t}\n\t}\n\tget duration() {\n\t\tlet assetDuration = 0;\n\t\tif (this._hasAsset()) {\n\t\t\tconst asset = this._assets.get(this._asset);\n\t\t\tassetDuration = asset != null && asset.resource ? asset.resource.duration : 0;\n\t\t}\n\t\tif (this._duration != null) {\n\t\t\treturn this._duration % (assetDuration || 1);\n\t\t}\n\t\treturn assetDuration;\n\t}\n\tget isLoaded() {\n\t\tif (this._hasAsset()) {\n\t\t\tconst asset = this._assets.get(this._asset);\n\t\t\tif (asset) {\n\t\t\t\treturn !!asset.resource;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\tget isPaused() {\n\t\tconst instances = this.instances;\n\t\tconst len = instances.length;\n\t\tif (len === 0) return false;\n\t\tfor (let i = 0; i < len; i++) {\n\t\t\tif (!instances[i].isPaused) return false;\n\t\t}\n\t\treturn true;\n\t}\n\tget isPlaying() {\n\t\tconst instances = this.instances;\n\t\tfor (let i = 0, len = instances.length; i < len; i++) {\n\t\t\tif (instances[i].isPlaying) return true;\n\t\t}\n\t\treturn false;\n\t}\n\tget isStopped() {\n\t\tconst instances = this.instances;\n\t\tfor (let i = 0, len = instances.length; i < len; i++) {\n\t\t\tif (!instances[i].isStopped) return false;\n\t\t}\n\t\treturn true;\n\t}\n\tset loop(value) {\n\t\tthis._loop = !!value;\n\t\tconst instances = this.instances;\n\t\tfor (let i = 0, len = instances.length; i < len; i++) {\n\t\t\tinstances[i].loop = this._loop;\n\t\t}\n\t}\n\tget loop() {\n\t\treturn this._loop;\n\t}\n\tset overlap(value) {\n\t\tthis._overlap = !!value;\n\t}\n\tget overlap() {\n\t\treturn this._overlap;\n\t}\n\tset pitch(value) {\n\t\tthis._pitch = Math.max(Number(value) || 0, 0.01);\n\t\tif (!this._overlap) {\n\t\t\tconst instances = this.instances;\n\t\t\tfor (let i = 0, len = instances.length; i < len; i++) {\n\t\t\t\tinstances[i].pitch = this.pitch * this._component.pitch;\n\t\t\t}\n\t\t}\n\t}\n\tget pitch() {\n\t\treturn this._pitch;\n\t}\n\tset startTime(value) {\n\t\tthis._startTime = Math.max(0, Number(value) || 0);\n\t\tif (!this._overlap) {\n\t\t\tconst instances = this.instances;\n\t\t\tfor (let i = 0, len = instances.length; i < len; i++) {\n\t\t\t\tinstances[i].startTime = this._startTime;\n\t\t\t}\n\t\t}\n\t}\n\tget startTime() {\n\t\treturn this._startTime;\n\t}\n\tset volume(value) {\n\t\tthis._volume = math.clamp(Number(value) || 0, 0, 1);\n\t\tif (!this._overlap) {\n\t\t\tconst instances = this.instances;\n\t\t\tfor (let i = 0, len = instances.length; i < len; i++) {\n\t\t\t\tinstances[i].volume = this._volume * this._component.volume;\n\t\t\t}\n\t\t}\n\t}\n\tget volume() {\n\t\treturn this._volume;\n\t}\n}\n\nexport { SoundSlot };\n","import '../../../core/tracing.js';\nimport { DISTANCE_LINEAR } from '../../../platform/audio/constants.js';\nimport { Component } from '../component.js';\nimport { SoundSlot } from './slot.js';\n\nclass SoundComponent extends Component {\n\tconstructor(system, entity) {\n\t\tsuper(system, entity);\n\t\tthis._volume = 1;\n\t\tthis._pitch = 1;\n\t\tthis._positional = true;\n\t\tthis._refDistance = 1;\n\t\tthis._maxDistance = 10000;\n\t\tthis._rollOffFactor = 1;\n\t\tthis._distanceModel = DISTANCE_LINEAR;\n\t\tthis._slots = {};\n\t\tthis._playingBeforeDisable = {};\n\t}\n\t_updateSoundInstances(property, value, isFactor) {\n\t\tconst slots = this._slots;\n\t\tfor (const key in slots) {\n\t\t\tconst slot = slots[key];\n\t\t\tif (!slot.overlap) {\n\t\t\t\tconst instances = slot.instances;\n\t\t\t\tfor (let i = 0, len = instances.length; i < len; i++) {\n\t\t\t\t\tinstances[i][property] = isFactor ? slot[property] * value : value;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tset distanceModel(value) {\n\t\tthis._distanceModel = value;\n\t\tthis._updateSoundInstances('distanceModel', value, false);\n\t}\n\tget distanceModel() {\n\t\treturn this._distanceModel;\n\t}\n\tset maxDistance(value) {\n\t\tthis._maxDistance = value;\n\t\tthis._updateSoundInstances('maxDistance', value, false);\n\t}\n\tget maxDistance() {\n\t\treturn this._maxDistance;\n\t}\n\tset refDistance(value) {\n\t\tthis._refDistance = value;\n\t\tthis._updateSoundInstances('refDistance', value, false);\n\t}\n\tget refDistance() {\n\t\treturn this._refDistance;\n\t}\n\tset rollOffFactor(value) {\n\t\tthis._rollOffFactor = value;\n\t\tthis._updateSoundInstances('rollOffFactor', value, false);\n\t}\n\tget rollOffFactor() {\n\t\treturn this._rollOffFactor;\n\t}\n\tset pitch(value) {\n\t\tthis._pitch = value;\n\t\tthis._updateSoundInstances('pitch', value, true);\n\t}\n\tget pitch() {\n\t\treturn this._pitch;\n\t}\n\tset volume(value) {\n\t\tthis._volume = value;\n\t\tthis._updateSoundInstances('volume', value, true);\n\t}\n\tget volume() {\n\t\treturn this._volume;\n\t}\n\tset positional(newValue) {\n\t\tthis._positional = newValue;\n\t\tconst slots = this._slots;\n\t\tfor (const key in slots) {\n\t\t\tconst slot = slots[key];\n\t\t\tif (!slot.overlap) {\n\t\t\t\tconst instances = slot.instances;\n\t\t\t\tconst oldLength = instances.length;\n\t\t\t\tfor (let i = oldLength - 1; i >= 0; i--) {\n\t\t\t\t\tconst isPlaying = instances[i].isPlaying || instances[i].isSuspended;\n\t\t\t\t\tconst currentTime = instances[i].currentTime;\n\t\t\t\t\tif (isPlaying) instances[i].stop();\n\t\t\t\t\tconst instance = slot._createInstance();\n\t\t\t\t\tif (isPlaying) {\n\t\t\t\t\t\tinstance.play();\n\t\t\t\t\t\tinstance.currentTime = currentTime;\n\t\t\t\t\t}\n\t\t\t\t\tinstances.push(instance);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tget positional() {\n\t\treturn this._positional;\n\t}\n\tset slots(newValue) {\n\t\tconst oldValue = this._slots;\n\t\tif (oldValue) {\n\t\t\tfor (const key in oldValue) {\n\t\t\t\toldValue[key].stop();\n\t\t\t}\n\t\t}\n\t\tconst slots = {};\n\t\tfor (const key in newValue) {\n\t\t\tif (!(newValue[key] instanceof SoundSlot)) {\n\t\t\t\tif (newValue[key].name) {\n\t\t\t\t\tslots[newValue[key].name] = new SoundSlot(this, newValue[key].name, newValue[key]);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tslots[newValue[key].name] = newValue[key];\n\t\t\t}\n\t\t}\n\t\tthis._slots = slots;\n\t\tif (this.enabled && this.entity.enabled) this.onEnable();\n\t}\n\tget slots() {\n\t\treturn this._slots;\n\t}\n\tonEnable() {\n\t\tif (this.system._inTools) {\n\t\t\treturn;\n\t\t}\n\t\tconst slots = this._slots;\n\t\tconst playingBeforeDisable = this._playingBeforeDisable;\n\t\tfor (const key in slots) {\n\t\t\tconst slot = slots[key];\n\t\t\tif (slot.autoPlay && slot.isStopped) {\n\t\t\t\tslot.play();\n\t\t\t} else if (playingBeforeDisable[key]) {\n\t\t\t\tslot.resume();\n\t\t\t} else if (!slot.isLoaded) {\n\t\t\t\tslot.load();\n\t\t\t}\n\t\t}\n\t}\n\tonDisable() {\n\t\tconst slots = this._slots;\n\t\tconst playingBeforeDisable = {};\n\t\tfor (const key in slots) {\n\t\t\tif (!slots[key].overlap) {\n\t\t\t\tif (slots[key].isPlaying) {\n\t\t\t\t\tslots[key].pause();\n\t\t\t\t\tplayingBeforeDisable[key] = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis._playingBeforeDisable = playingBeforeDisable;\n\t}\n\tonRemove() {\n\t\tthis.off();\n\t}\n\taddSlot(name, options) {\n\t\tconst slots = this._slots;\n\t\tif (slots[name]) {\n\t\t\treturn null;\n\t\t}\n\t\tconst slot = new SoundSlot(this, name, options);\n\t\tslots[name] = slot;\n\t\tif (slot.autoPlay && this.enabled && this.entity.enabled) {\n\t\t\tslot.play();\n\t\t}\n\t\treturn slot;\n\t}\n\tremoveSlot(name) {\n\t\tconst slots = this._slots;\n\t\tif (slots[name]) {\n\t\t\tslots[name].stop();\n\t\t\tdelete slots[name];\n\t\t}\n\t}\n\tslot(name) {\n\t\treturn this._slots[name];\n\t}\n\t_getSlotProperty(name, property) {\n\t\tif (!this.enabled || !this.entity.enabled) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst slot = this._slots[name];\n\t\tif (!slot) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn slot[property];\n\t}\n\tisPlaying(name) {\n\t\treturn this._getSlotProperty(name, 'isPlaying') || false;\n\t}\n\tisLoaded(name) {\n\t\treturn this._getSlotProperty(name, 'isLoaded') || false;\n\t}\n\tisPaused(name) {\n\t\treturn this._getSlotProperty(name, 'isPaused') || false;\n\t}\n\tisStopped(name) {\n\t\treturn this._getSlotProperty(name, 'isStopped') || false;\n\t}\n\tplay(name) {\n\t\tif (!this.enabled || !this.entity.enabled) {\n\t\t\treturn null;\n\t\t}\n\t\tconst slot = this._slots[name];\n\t\tif (!slot) {\n\t\t\treturn null;\n\t\t}\n\t\treturn slot.play();\n\t}\n\tpause(name) {\n\t\tconst slots = this._slots;\n\t\tif (name) {\n\t\t\tconst slot = slots[name];\n\t\t\tif (!slot) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tslot.pause();\n\t\t} else {\n\t\t\tfor (const key in slots) {\n\t\t\t\tslots[key].pause();\n\t\t\t}\n\t\t}\n\t}\n\tresume(name) {\n\t\tconst slots = this._slots;\n\t\tif (name) {\n\t\t\tconst slot = slots[name];\n\t\t\tif (!slot) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (slot.isPaused) {\n\t\t\t\tslot.resume();\n\t\t\t}\n\t\t} else {\n\t\t\tfor (const key in slots) {\n\t\t\t\tslots[key].resume();\n\t\t\t}\n\t\t}\n\t}\n\tstop(name) {\n\t\tconst slots = this._slots;\n\t\tif (name) {\n\t\t\tconst slot = slots[name];\n\t\t\tif (!slot) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tslot.stop();\n\t\t} else {\n\t\t\tfor (const key in slots) {\n\t\t\t\tslots[key].stop();\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport { SoundComponent };\n","class SoundComponentData {\n\tconstructor() {\n\t\tthis.enabled = true;\n\t}\n}\n\nexport { SoundComponentData };\n","import '../../../core/tracing.js';\nimport { hasAudioContext } from '../../../platform/audio/capabilities.js';\nimport { Component } from '../component.js';\nimport { ComponentSystem } from '../system.js';\nimport { SoundComponent } from './component.js';\nimport { SoundComponentData } from './data.js';\n\nconst _schema = ['enabled'];\nclass SoundComponentSystem extends ComponentSystem {\n\tconstructor(app) {\n\t\tsuper(app);\n\t\tthis.id = 'sound';\n\t\tthis.ComponentType = SoundComponent;\n\t\tthis.DataType = SoundComponentData;\n\t\tthis.schema = _schema;\n\t\tthis.manager = app.soundManager;\n\t\tthis.app.systems.on('update', this.onUpdate, this);\n\t\tthis.on('beforeremove', this.onBeforeRemove, this);\n\t}\n\tset volume(volume) {\n\t\tthis.manager.volume = volume;\n\t}\n\tget volume() {\n\t\treturn this.manager.volume;\n\t}\n\tget context() {\n\t\tif (!hasAudioContext()) {\n\t\t\treturn null;\n\t\t}\n\t\treturn this.manager.context;\n\t}\n\tinitializeComponentData(component, data, properties) {\n\t\tproperties = ['volume', 'pitch', 'positional', 'refDistance', 'maxDistance', 'rollOffFactor', 'distanceModel', 'slots'];\n\t\tfor (let i = 0; i < properties.length; i++) {\n\t\t\tif (data.hasOwnProperty(properties[i])) {\n\t\t\t\tcomponent[properties[i]] = data[properties[i]];\n\t\t\t}\n\t\t}\n\t\tsuper.initializeComponentData(component, data, ['enabled']);\n\t}\n\tcloneComponent(entity, clone) {\n\t\tconst srcComponent = entity.sound;\n\t\tconst srcSlots = srcComponent.slots;\n\t\tconst slots = {};\n\t\tfor (const key in srcSlots) {\n\t\t\tconst srcSlot = srcSlots[key];\n\t\t\tslots[key] = {\n\t\t\t\tname: srcSlot.name,\n\t\t\t\tvolume: srcSlot.volume,\n\t\t\t\tpitch: srcSlot.pitch,\n\t\t\t\tloop: srcSlot.loop,\n\t\t\t\tduration: srcSlot.duration,\n\t\t\t\tstartTime: srcSlot.startTime,\n\t\t\t\toverlap: srcSlot.overlap,\n\t\t\t\tautoPlay: srcSlot.autoPlay,\n\t\t\t\tasset: srcSlot.asset\n\t\t\t};\n\t\t}\n\t\tconst cloneData = {\n\t\t\tdistanceModel: srcComponent.distanceModel,\n\t\t\tenabled: srcComponent.enabled,\n\t\t\tmaxDistance: srcComponent.maxDistance,\n\t\t\tpitch: srcComponent.pitch,\n\t\t\tpositional: srcComponent.positional,\n\t\t\trefDistance: srcComponent.refDistance,\n\t\t\trollOffFactor: srcComponent.rollOffFactor,\n\t\t\tslots: slots,\n\t\t\tvolume: srcComponent.volume\n\t\t};\n\t\treturn this.addComponent(clone, cloneData);\n\t}\n\tonUpdate(dt) {\n\t\tconst store = this.store;\n\t\tfor (const id in store) {\n\t\t\tif (store.hasOwnProperty(id)) {\n\t\t\t\tconst item = store[id];\n\t\t\t\tconst entity = item.entity;\n\t\t\t\tif (entity.enabled) {\n\t\t\t\t\tconst component = entity.sound;\n\t\t\t\t\tif (component.enabled && component.positional) {\n\t\t\t\t\t\tconst position = entity.getPosition();\n\t\t\t\t\t\tconst slots = component.slots;\n\t\t\t\t\t\tfor (const key in slots) {\n\t\t\t\t\t\t\tslots[key].updatePosition(position);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tonBeforeRemove(entity, component) {\n\t\tconst slots = component.slots;\n\t\tfor (const key in slots) {\n\t\t\tif (!slots[key].overlap) {\n\t\t\t\tslots[key].stop();\n\t\t\t}\n\t\t}\n\t\tcomponent.onRemove();\n\t}\n\tdestroy() {\n\t\tsuper.destroy();\n\t\tthis.app.systems.off('update', this.onUpdate, this);\n\t}\n}\nComponent._buildAccessors(SoundComponent.prototype, _schema);\n\nexport { SoundComponentSystem };\n","const SPRITETYPE_SIMPLE = 'simple';\nconst SPRITETYPE_ANIMATED = 'animated';\n\nexport { SPRITETYPE_ANIMATED, SPRITETYPE_SIMPLE };\n","import { EventHandler } from '../../../core/event-handler.js';\nimport { math } from '../../../core/math/math.js';\nimport { Asset } from '../../asset/asset.js';\nimport { SPRITE_RENDERMODE_SIMPLE } from '../../../scene/constants.js';\n\nclass SpriteAnimationClip extends EventHandler {\n\tconstructor(component, data) {\n\t\tsuper();\n\t\tthis._component = component;\n\t\tthis._frame = 0;\n\t\tthis._sprite = null;\n\t\tthis._spriteAsset = null;\n\t\tthis.spriteAsset = data.spriteAsset;\n\t\tthis.name = data.name;\n\t\tthis.fps = data.fps || 0;\n\t\tthis.loop = data.loop || false;\n\t\tthis._playing = false;\n\t\tthis._paused = false;\n\t\tthis._time = 0;\n\t}\n\tget duration() {\n\t\tif (this._sprite) {\n\t\t\tconst fps = this.fps || Number.MIN_VALUE;\n\t\t\treturn this._sprite.frameKeys.length / Math.abs(fps);\n\t\t}\n\t\treturn 0;\n\t}\n\tset frame(value) {\n\t\tthis._setFrame(value);\n\t\tconst fps = this.fps || Number.MIN_VALUE;\n\t\tthis._setTime(this._frame / fps);\n\t}\n\tget frame() {\n\t\treturn this._frame;\n\t}\n\tget isPaused() {\n\t\treturn this._paused;\n\t}\n\tget isPlaying() {\n\t\treturn this._playing;\n\t}\n\tset sprite(value) {\n\t\tif (this._sprite) {\n\t\t\tthis._sprite.off('set:meshes', this._onSpriteMeshesChange, this);\n\t\t\tthis._sprite.off('set:pixelsPerUnit', this._onSpritePpuChanged, this);\n\t\t\tthis._sprite.off('set:atlas', this._onSpriteMeshesChange, this);\n\t\t\tif (this._sprite.atlas) {\n\t\t\t\tthis._sprite.atlas.off('set:texture', this._onSpriteMeshesChange, this);\n\t\t\t}\n\t\t}\n\t\tthis._sprite = value;\n\t\tif (this._sprite) {\n\t\t\tthis._sprite.on('set:meshes', this._onSpriteMeshesChange, this);\n\t\t\tthis._sprite.on('set:pixelsPerUnit', this._onSpritePpuChanged, this);\n\t\t\tthis._sprite.on('set:atlas', this._onSpriteMeshesChange, this);\n\t\t\tif (this._sprite.atlas) {\n\t\t\t\tthis._sprite.atlas.on('set:texture', this._onSpriteMeshesChange, this);\n\t\t\t}\n\t\t}\n\t\tif (this._component.currentClip === this) {\n\t\t\tlet mi;\n\t\t\tif (!value || !value.atlas) {\n\t\t\t\tmi = this._component._meshInstance;\n\t\t\t\tif (mi) {\n\t\t\t\t\tmi.deleteParameter('texture_emissiveMap');\n\t\t\t\t\tmi.deleteParameter('texture_opacityMap');\n\t\t\t\t}\n\t\t\t\tthis._component._hideModel();\n\t\t\t} else {\n\t\t\t\tif (value.atlas.texture) {\n\t\t\t\t\tmi = this._component._meshInstance;\n\t\t\t\t\tif (mi) {\n\t\t\t\t\t\tmi.setParameter('texture_emissiveMap', value.atlas.texture);\n\t\t\t\t\t\tmi.setParameter('texture_opacityMap', value.atlas.texture);\n\t\t\t\t\t}\n\t\t\t\t\tif (this._component.enabled && this._component.entity.enabled) {\n\t\t\t\t\t\tthis._component._showModel();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (this.time && this.fps) {\n\t\t\t\t\tthis.time = this.time;\n\t\t\t\t} else {\n\t\t\t\t\tthis.frame = this.frame;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tget sprite() {\n\t\treturn this._sprite;\n\t}\n\tset spriteAsset(value) {\n\t\tconst assets = this._component.system.app.assets;\n\t\tlet id = value;\n\t\tif (value instanceof Asset) {\n\t\t\tid = value.id;\n\t\t}\n\t\tif (this._spriteAsset !== id) {\n\t\t\tif (this._spriteAsset) {\n\t\t\t\tconst prev = assets.get(this._spriteAsset);\n\t\t\t\tif (prev) {\n\t\t\t\t\tthis._unbindSpriteAsset(prev);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._spriteAsset = id;\n\t\t\tif (this._spriteAsset) {\n\t\t\t\tconst asset = assets.get(this._spriteAsset);\n\t\t\t\tif (!asset) {\n\t\t\t\t\tthis.sprite = null;\n\t\t\t\t\tassets.on('add:' + this._spriteAsset, this._onSpriteAssetAdded, this);\n\t\t\t\t} else {\n\t\t\t\t\tthis._bindSpriteAsset(asset);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.sprite = null;\n\t\t\t}\n\t\t}\n\t}\n\tget spriteAsset() {\n\t\treturn this._spriteAsset;\n\t}\n\tset time(value) {\n\t\tthis._setTime(value);\n\t\tif (this._sprite) {\n\t\t\tthis.frame = Math.min(this._sprite.frameKeys.length - 1, Math.floor(this._time * Math.abs(this.fps)));\n\t\t} else {\n\t\t\tthis.frame = 0;\n\t\t}\n\t}\n\tget time() {\n\t\treturn this._time;\n\t}\n\t_onSpriteAssetAdded(asset) {\n\t\tthis._component.system.app.assets.off('add:' + asset.id, this._onSpriteAssetAdded, this);\n\t\tif (this._spriteAsset === asset.id) {\n\t\t\tthis._bindSpriteAsset(asset);\n\t\t}\n\t}\n\t_bindSpriteAsset(asset) {\n\t\tasset.on('load', this._onSpriteAssetLoad, this);\n\t\tasset.on('remove', this._onSpriteAssetRemove, this);\n\t\tif (asset.resource) {\n\t\t\tthis._onSpriteAssetLoad(asset);\n\t\t} else {\n\t\t\tthis._component.system.app.assets.load(asset);\n\t\t}\n\t}\n\t_unbindSpriteAsset(asset) {\n\t\tif (!asset) {\n\t\t\treturn;\n\t\t}\n\t\tasset.off('load', this._onSpriteAssetLoad, this);\n\t\tasset.off('remove', this._onSpriteAssetRemove, this);\n\t\tif (asset.resource && !asset.resource.atlas) {\n\t\t\tthis._component.system.app.assets.off('load:' + asset.data.textureAtlasAsset, this._onTextureAtlasLoad, this);\n\t\t}\n\t}\n\t_onSpriteAssetLoad(asset) {\n\t\tif (!asset.resource) {\n\t\t\tthis.sprite = null;\n\t\t} else {\n\t\t\tif (!asset.resource.atlas) {\n\t\t\t\tconst atlasAssetId = asset.data.textureAtlasAsset;\n\t\t\t\tconst assets = this._component.system.app.assets;\n\t\t\t\tassets.off('load:' + atlasAssetId, this._onTextureAtlasLoad, this);\n\t\t\t\tassets.once('load:' + atlasAssetId, this._onTextureAtlasLoad, this);\n\t\t\t} else {\n\t\t\t\tthis.sprite = asset.resource;\n\t\t\t}\n\t\t}\n\t}\n\t_onTextureAtlasLoad(atlasAsset) {\n\t\tconst spriteAsset = this._spriteAsset;\n\t\tif (spriteAsset instanceof Asset) {\n\t\t\tthis._onSpriteAssetLoad(spriteAsset);\n\t\t} else {\n\t\t\tthis._onSpriteAssetLoad(this._component.system.app.assets.get(spriteAsset));\n\t\t}\n\t}\n\t_onSpriteAssetRemove(asset) {\n\t\tthis.sprite = null;\n\t}\n\t_onSpriteMeshesChange() {\n\t\tif (this._component.currentClip === this) {\n\t\t\tthis._component._showFrame(this.frame);\n\t\t}\n\t}\n\t_onSpritePpuChanged() {\n\t\tif (this._component.currentClip === this) {\n\t\t\tif (this.sprite.renderMode !== SPRITE_RENDERMODE_SIMPLE) {\n\t\t\t\tthis._component._showFrame(this.frame);\n\t\t\t}\n\t\t}\n\t}\n\t_update(dt) {\n\t\tif (this.fps === 0) return;\n\t\tif (!this._playing || this._paused || !this._sprite) return;\n\t\tconst dir = this.fps < 0 ? -1 : 1;\n\t\tconst time = this._time + dt * this._component.speed * dir;\n\t\tconst duration = this.duration;\n\t\tconst end = time > duration || time < 0;\n\t\tthis._setTime(time);\n\t\tlet frame = this.frame;\n\t\tif (this._sprite) {\n\t\t\tframe = Math.floor(this._sprite.frameKeys.length * this._time / duration);\n\t\t} else {\n\t\t\tframe = 0;\n\t\t}\n\t\tif (frame !== this._frame) {\n\t\t\tthis._setFrame(frame);\n\t\t}\n\t\tif (end) {\n\t\t\tif (this.loop) {\n\t\t\t\tthis.fire('loop');\n\t\t\t\tthis._component.fire('loop', this);\n\t\t\t} else {\n\t\t\t\tthis._playing = false;\n\t\t\t\tthis._paused = false;\n\t\t\t\tthis.fire('end');\n\t\t\t\tthis._component.fire('end', this);\n\t\t\t}\n\t\t}\n\t}\n\t_setTime(value) {\n\t\tthis._time = value;\n\t\tconst duration = this.duration;\n\t\tif (this._time < 0) {\n\t\t\tif (this.loop) {\n\t\t\t\tthis._time = this._time % duration + duration;\n\t\t\t} else {\n\t\t\t\tthis._time = 0;\n\t\t\t}\n\t\t} else if (this._time > duration) {\n\t\t\tif (this.loop) {\n\t\t\t\tthis._time %= duration;\n\t\t\t} else {\n\t\t\t\tthis._time = duration;\n\t\t\t}\n\t\t}\n\t}\n\t_setFrame(value) {\n\t\tif (this._sprite) {\n\t\t\tthis._frame = math.clamp(value, 0, this._sprite.frameKeys.length - 1);\n\t\t} else {\n\t\t\tthis._frame = value;\n\t\t}\n\t\tif (this._component.currentClip === this) {\n\t\t\tthis._component._showFrame(this._frame);\n\t\t}\n\t}\n\t_destroy() {\n\t\tif (this._spriteAsset) {\n\t\t\tconst assets = this._component.system.app.assets;\n\t\t\tthis._unbindSpriteAsset(assets.get(this._spriteAsset));\n\t\t}\n\t\tif (this._sprite) {\n\t\t\tthis.sprite = null;\n\t\t}\n\t\tif (this._spriteAsset) {\n\t\t\tthis.spriteAsset = null;\n\t\t}\n\t}\n\tplay() {\n\t\tif (this._playing) return;\n\t\tthis._playing = true;\n\t\tthis._paused = false;\n\t\tthis.frame = 0;\n\t\tthis.fire('play');\n\t\tthis._component.fire('play', this);\n\t}\n\tpause() {\n\t\tif (!this._playing || this._paused) return;\n\t\tthis._paused = true;\n\t\tthis.fire('pause');\n\t\tthis._component.fire('pause', this);\n\t}\n\tresume() {\n\t\tif (!this._paused) return;\n\t\tthis._paused = false;\n\t\tthis.fire('resume');\n\t\tthis._component.fire('resume', this);\n\t}\n\tstop() {\n\t\tif (!this._playing) return;\n\t\tthis._playing = false;\n\t\tthis._paused = false;\n\t\tthis._time = 0;\n\t\tthis.frame = 0;\n\t\tthis.fire('stop');\n\t\tthis._component.fire('stop', this);\n\t}\n}\n\nexport { SpriteAnimationClip };\n","import '../../../core/tracing.js';\nimport { math } from '../../../core/math/math.js';\nimport { Color } from '../../../core/math/color.js';\nimport { Vec2 } from '../../../core/math/vec2.js';\nimport { Vec4 } from '../../../core/math/vec4.js';\nimport { LAYERID_WORLD, SPRITE_RENDERMODE_TILED, SPRITE_RENDERMODE_SLICED } from '../../../scene/constants.js';\nimport { BatchGroup } from '../../../scene/batching/batch-group.js';\nimport { GraphNode } from '../../../scene/graph-node.js';\nimport { MeshInstance } from '../../../scene/mesh-instance.js';\nimport { Model } from '../../../scene/model.js';\nimport { Component } from '../component.js';\nimport { SPRITETYPE_SIMPLE, SPRITETYPE_ANIMATED } from './constants.js';\nimport { SpriteAnimationClip } from './sprite-animation-clip.js';\n\nconst PARAM_EMISSIVE_MAP = 'texture_emissiveMap';\nconst PARAM_OPACITY_MAP = 'texture_opacityMap';\nconst PARAM_EMISSIVE = 'material_emissive';\nconst PARAM_OPACITY = 'material_opacity';\nconst PARAM_INNER_OFFSET = 'innerOffset';\nconst PARAM_OUTER_SCALE = 'outerScale';\nconst PARAM_ATLAS_RECT = 'atlasRect';\nclass SpriteComponent extends Component {\n\tconstructor(system, entity) {\n\t\tsuper(system, entity);\n\t\tthis._type = SPRITETYPE_SIMPLE;\n\t\tthis._material = system.defaultMaterial;\n\t\tthis._color = new Color(1, 1, 1, 1);\n\t\tthis._colorUniform = new Float32Array(3);\n\t\tthis._speed = 1;\n\t\tthis._flipX = false;\n\t\tthis._flipY = false;\n\t\tthis._width = 1;\n\t\tthis._height = 1;\n\t\tthis._drawOrder = 0;\n\t\tthis._layers = [LAYERID_WORLD];\n\t\tthis._outerScale = new Vec2(1, 1);\n\t\tthis._outerScaleUniform = new Float32Array(2);\n\t\tthis._innerOffset = new Vec4();\n\t\tthis._innerOffsetUniform = new Float32Array(4);\n\t\tthis._atlasRect = new Vec4();\n\t\tthis._atlasRectUniform = new Float32Array(4);\n\t\tthis._batchGroupId = -1;\n\t\tthis._batchGroup = null;\n\t\tthis._node = new GraphNode();\n\t\tthis._model = new Model();\n\t\tthis._model.graph = this._node;\n\t\tthis._meshInstance = null;\n\t\tentity.addChild(this._model.graph);\n\t\tthis._model._entity = entity;\n\t\tthis._updateAabbFunc = this._updateAabb.bind(this);\n\t\tthis._addedModel = false;\n\t\tthis._autoPlayClip = null;\n\t\tthis._clips = {};\n\t\tthis._defaultClip = new SpriteAnimationClip(this, {\n\t\t\tname: this.entity.name,\n\t\t\tfps: 0,\n\t\t\tloop: false,\n\t\t\tspriteAsset: null\n\t\t});\n\t\tthis._currentClip = this._defaultClip;\n\t}\n\tset type(value) {\n\t\tif (this._type === value) return;\n\t\tthis._type = value;\n\t\tif (this._type === SPRITETYPE_SIMPLE) {\n\t\t\tthis.stop();\n\t\t\tthis._currentClip = this._defaultClip;\n\t\t\tif (this.enabled && this.entity.enabled) {\n\t\t\t\tthis._currentClip.frame = this.frame;\n\t\t\t\tif (this._currentClip.sprite) {\n\t\t\t\t\tthis._showModel();\n\t\t\t\t} else {\n\t\t\t\t\tthis._hideModel();\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (this._type === SPRITETYPE_ANIMATED) {\n\t\t\tthis.stop();\n\t\t\tif (this._autoPlayClip) {\n\t\t\t\tthis._tryAutoPlay();\n\t\t\t}\n\t\t\tif (this._currentClip && this._currentClip.isPlaying && this.enabled && this.entity.enabled) {\n\t\t\t\tthis._showModel();\n\t\t\t} else {\n\t\t\t\tthis._hideModel();\n\t\t\t}\n\t\t}\n\t}\n\tget type() {\n\t\treturn this._type;\n\t}\n\tset frame(value) {\n\t\tthis._currentClip.frame = value;\n\t}\n\tget frame() {\n\t\treturn this._currentClip.frame;\n\t}\n\tset spriteAsset(value) {\n\t\tthis._defaultClip.spriteAsset = value;\n\t}\n\tget spriteAsset() {\n\t\treturn this._defaultClip._spriteAsset;\n\t}\n\tset sprite(value) {\n\t\tthis._currentClip.sprite = value;\n\t}\n\tget sprite() {\n\t\treturn this._currentClip.sprite;\n\t}\n\tset material(value) {\n\t\tthis._material = value;\n\t\tif (this._meshInstance) {\n\t\t\tthis._meshInstance.material = value;\n\t\t}\n\t}\n\tget material() {\n\t\treturn this._material;\n\t}\n\tset color(value) {\n\t\tthis._color.r = value.r;\n\t\tthis._color.g = value.g;\n\t\tthis._color.b = value.b;\n\t\tif (this._meshInstance) {\n\t\t\tthis._colorUniform[0] = this._color.r;\n\t\t\tthis._colorUniform[1] = this._color.g;\n\t\t\tthis._colorUniform[2] = this._color.b;\n\t\t\tthis._meshInstance.setParameter(PARAM_EMISSIVE, this._colorUniform);\n\t\t}\n\t}\n\tget color() {\n\t\treturn this._color;\n\t}\n\tset opacity(value) {\n\t\tthis._color.a = value;\n\t\tif (this._meshInstance) {\n\t\t\tthis._meshInstance.setParameter(PARAM_OPACITY, value);\n\t\t}\n\t}\n\tget opacity() {\n\t\treturn this._color.a;\n\t}\n\tset clips(value) {\n\t\tif (!value) {\n\t\t\tfor (const name in this._clips) {\n\t\t\t\tthis.removeClip(name);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tfor (const name in this._clips) {\n\t\t\tlet found = false;\n\t\t\tfor (const key in value) {\n\t\t\t\tif (value[key].name === name) {\n\t\t\t\t\tfound = true;\n\t\t\t\t\tthis._clips[name].fps = value[key].fps;\n\t\t\t\t\tthis._clips[name].loop = value[key].loop;\n\t\t\t\t\tif (value[key].hasOwnProperty('sprite')) {\n\t\t\t\t\t\tthis._clips[name].sprite = value[key].sprite;\n\t\t\t\t\t} else if (value[key].hasOwnProperty('spriteAsset')) {\n\t\t\t\t\t\tthis._clips[name].spriteAsset = value[key].spriteAsset;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!found) {\n\t\t\t\tthis.removeClip(name);\n\t\t\t}\n\t\t}\n\t\tfor (const key in value) {\n\t\t\tif (this._clips[value[key].name]) continue;\n\t\t\tthis.addClip(value[key]);\n\t\t}\n\t\tif (this._autoPlayClip) {\n\t\t\tthis._tryAutoPlay();\n\t\t}\n\t\tif (!this._currentClip || !this._currentClip.sprite) {\n\t\t\tthis._hideModel();\n\t\t}\n\t}\n\tget clips() {\n\t\treturn this._clips;\n\t}\n\tget currentClip() {\n\t\treturn this._currentClip;\n\t}\n\tset speed(value) {\n\t\tthis._speed = value;\n\t}\n\tget speed() {\n\t\treturn this._speed;\n\t}\n\tset flipX(value) {\n\t\tif (this._flipX === value) return;\n\t\tthis._flipX = value;\n\t\tthis._updateTransform();\n\t}\n\tget flipX() {\n\t\treturn this._flipX;\n\t}\n\tset flipY(value) {\n\t\tif (this._flipY === value) return;\n\t\tthis._flipY = value;\n\t\tthis._updateTransform();\n\t}\n\tget flipY() {\n\t\treturn this._flipY;\n\t}\n\tset width(value) {\n\t\tif (value === this._width) return;\n\t\tthis._width = value;\n\t\tthis._outerScale.x = this._width;\n\t\tif (this.sprite && (this.sprite.renderMode === SPRITE_RENDERMODE_TILED || this.sprite.renderMode === SPRITE_RENDERMODE_SLICED)) {\n\t\t\tthis._updateTransform();\n\t\t}\n\t}\n\tget width() {\n\t\treturn this._width;\n\t}\n\tset height(value) {\n\t\tif (value === this._height) return;\n\t\tthis._height = value;\n\t\tthis._outerScale.y = this.height;\n\t\tif (this.sprite && (this.sprite.renderMode === SPRITE_RENDERMODE_TILED || this.sprite.renderMode === SPRITE_RENDERMODE_SLICED)) {\n\t\t\tthis._updateTransform();\n\t\t}\n\t}\n\tget height() {\n\t\treturn this._height;\n\t}\n\tset batchGroupId(value) {\n\t\tif (this._batchGroupId === value) return;\n\t\tconst prev = this._batchGroupId;\n\t\tthis._batchGroupId = value;\n\t\tif (this.entity.enabled && prev >= 0) {\n\t\t\tvar _this$system$app$batc;\n\t\t\t(_this$system$app$batc = this.system.app.batcher) == null || _this$system$app$batc.remove(BatchGroup.SPRITE, prev, this.entity);\n\t\t}\n\t\tif (this.entity.enabled && value >= 0) {\n\t\t\tvar _this$system$app$batc2;\n\t\t\t(_this$system$app$batc2 = this.system.app.batcher) == null || _this$system$app$batc2.insert(BatchGroup.SPRITE, value, this.entity);\n\t\t} else {\n\t\t\tif (prev >= 0) {\n\t\t\t\tif (this._currentClip && this._currentClip.sprite && this.enabled && this.entity.enabled) {\n\t\t\t\t\tthis._showModel();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tget batchGroupId() {\n\t\treturn this._batchGroupId;\n\t}\n\tset autoPlayClip(value) {\n\t\tthis._autoPlayClip = value instanceof SpriteAnimationClip ? value.name : value;\n\t\tthis._tryAutoPlay();\n\t}\n\tget autoPlayClip() {\n\t\treturn this._autoPlayClip;\n\t}\n\tset drawOrder(value) {\n\t\tthis._drawOrder = value;\n\t\tif (this._meshInstance) {\n\t\t\tthis._meshInstance.drawOrder = value;\n\t\t}\n\t}\n\tget drawOrder() {\n\t\treturn this._drawOrder;\n\t}\n\tset layers(value) {\n\t\tif (this._addedModel) {\n\t\t\tthis._hideModel();\n\t\t}\n\t\tthis._layers = value;\n\t\tif (!this._meshInstance) {\n\t\t\treturn;\n\t\t}\n\t\tif (this.enabled && this.entity.enabled) {\n\t\t\tthis._showModel();\n\t\t}\n\t}\n\tget layers() {\n\t\treturn this._layers;\n\t}\n\tget aabb() {\n\t\tif (this._meshInstance) {\n\t\t\treturn this._meshInstance.aabb;\n\t\t}\n\t\treturn null;\n\t}\n\tonEnable() {\n\t\tconst app = this.system.app;\n\t\tconst scene = app.scene;\n\t\tscene.on('set:layers', this._onLayersChanged, this);\n\t\tif (scene.layers) {\n\t\t\tscene.layers.on('add', this._onLayerAdded, this);\n\t\t\tscene.layers.on('remove', this._onLayerRemoved, this);\n\t\t}\n\t\tthis._showModel();\n\t\tif (this._autoPlayClip) this._tryAutoPlay();\n\t\tif (this._batchGroupId >= 0) {\n\t\t\tvar _app$batcher;\n\t\t\t(_app$batcher = app.batcher) == null || _app$batcher.insert(BatchGroup.SPRITE, this._batchGroupId, this.entity);\n\t\t}\n\t}\n\tonDisable() {\n\t\tconst app = this.system.app;\n\t\tconst scene = app.scene;\n\t\tscene.off('set:layers', this._onLayersChanged, this);\n\t\tif (scene.layers) {\n\t\t\tscene.layers.off('add', this._onLayerAdded, this);\n\t\t\tscene.layers.off('remove', this._onLayerRemoved, this);\n\t\t}\n\t\tthis.stop();\n\t\tthis._hideModel();\n\t\tif (this._batchGroupId >= 0) {\n\t\t\tvar _app$batcher2;\n\t\t\t(_app$batcher2 = app.batcher) == null || _app$batcher2.remove(BatchGroup.SPRITE, this._batchGroupId, this.entity);\n\t\t}\n\t}\n\tonDestroy() {\n\t\tvar _this$_node;\n\t\tthis._currentClip = null;\n\t\tif (this._defaultClip) {\n\t\t\tthis._defaultClip._destroy();\n\t\t\tthis._defaultClip = null;\n\t\t}\n\t\tfor (const key in this._clips) {\n\t\t\tthis._clips[key]._destroy();\n\t\t}\n\t\tthis._clips = null;\n\t\tthis._hideModel();\n\t\tthis._model = null;\n\t\t(_this$_node = this._node) == null || _this$_node.remove();\n\t\tthis._node = null;\n\t\tif (this._meshInstance) {\n\t\t\tthis._meshInstance.material = null;\n\t\t\tthis._meshInstance.mesh = null;\n\t\t\tthis._meshInstance = null;\n\t\t}\n\t}\n\t_showModel() {\n\t\tif (this._addedModel) return;\n\t\tif (!this._meshInstance) return;\n\t\tconst meshInstances = [this._meshInstance];\n\t\tfor (let i = 0, len = this._layers.length; i < len; i++) {\n\t\t\tconst layer = this.system.app.scene.layers.getLayerById(this._layers[i]);\n\t\t\tif (layer) {\n\t\t\t\tlayer.addMeshInstances(meshInstances);\n\t\t\t}\n\t\t}\n\t\tthis._addedModel = true;\n\t}\n\t_hideModel() {\n\t\tif (!this._addedModel || !this._meshInstance) return;\n\t\tconst meshInstances = [this._meshInstance];\n\t\tfor (let i = 0, len = this._layers.length; i < len; i++) {\n\t\t\tconst layer = this.system.app.scene.layers.getLayerById(this._layers[i]);\n\t\t\tif (layer) {\n\t\t\t\tlayer.removeMeshInstances(meshInstances);\n\t\t\t}\n\t\t}\n\t\tthis._addedModel = false;\n\t}\n\t_showFrame(frame) {\n\t\tif (!this.sprite) return;\n\t\tconst mesh = this.sprite.meshes[frame];\n\t\tif (!mesh) {\n\t\t\tif (this._meshInstance) {\n\t\t\t\tthis._meshInstance.mesh = null;\n\t\t\t\tthis._meshInstance.visible = false;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tlet material;\n\t\tif (this.sprite.renderMode === SPRITE_RENDERMODE_SLICED) {\n\t\t\tmaterial = this.system.default9SlicedMaterialSlicedMode;\n\t\t} else if (this.sprite.renderMode === SPRITE_RENDERMODE_TILED) {\n\t\t\tmaterial = this.system.default9SlicedMaterialTiledMode;\n\t\t} else {\n\t\t\tmaterial = this.system.defaultMaterial;\n\t\t}\n\t\tif (!this._meshInstance) {\n\t\t\tthis._meshInstance = new MeshInstance(mesh, this._material, this._node);\n\t\t\tthis._meshInstance.castShadow = false;\n\t\t\tthis._meshInstance.receiveShadow = false;\n\t\t\tthis._meshInstance.drawOrder = this._drawOrder;\n\t\t\tthis._model.meshInstances.push(this._meshInstance);\n\t\t\tthis._colorUniform[0] = this._color.r;\n\t\t\tthis._colorUniform[1] = this._color.g;\n\t\t\tthis._colorUniform[2] = this._color.b;\n\t\t\tthis._meshInstance.setParameter(PARAM_EMISSIVE, this._colorUniform);\n\t\t\tthis._meshInstance.setParameter(PARAM_OPACITY, this._color.a);\n\t\t\tif (this.enabled && this.entity.enabled) {\n\t\t\t\tthis._showModel();\n\t\t\t}\n\t\t}\n\t\tif (this._meshInstance.material !== material) {\n\t\t\tthis._meshInstance.material = material;\n\t\t}\n\t\tif (this._meshInstance.mesh !== mesh) {\n\t\t\tthis._meshInstance.mesh = mesh;\n\t\t\tthis._meshInstance.visible = true;\n\t\t\tthis._meshInstance._aabbVer = -1;\n\t\t}\n\t\tif (this.sprite.atlas && this.sprite.atlas.texture) {\n\t\t\tthis._meshInstance.setParameter(PARAM_EMISSIVE_MAP, this.sprite.atlas.texture);\n\t\t\tthis._meshInstance.setParameter(PARAM_OPACITY_MAP, this.sprite.atlas.texture);\n\t\t} else {\n\t\t\tthis._meshInstance.deleteParameter(PARAM_EMISSIVE_MAP);\n\t\t\tthis._meshInstance.deleteParameter(PARAM_OPACITY_MAP);\n\t\t}\n\t\tif (this.sprite.atlas && (this.sprite.renderMode === SPRITE_RENDERMODE_SLICED || this.sprite.renderMode === SPRITE_RENDERMODE_TILED)) {\n\t\t\tthis._meshInstance._updateAabbFunc = this._updateAabbFunc;\n\t\t\tconst frameData = this.sprite.atlas.frames[this.sprite.frameKeys[frame]];\n\t\t\tif (frameData) {\n\t\t\t\tconst borderWidthScale = 2 / frameData.rect.z;\n\t\t\t\tconst borderHeightScale = 2 / frameData.rect.w;\n\t\t\t\tthis._innerOffset.set(frameData.border.x * borderWidthScale, frameData.border.y * borderHeightScale, frameData.border.z * borderWidthScale, frameData.border.w * borderHeightScale);\n\t\t\t\tconst tex = this.sprite.atlas.texture;\n\t\t\t\tthis._atlasRect.set(frameData.rect.x / tex.width, frameData.rect.y / tex.height, frameData.rect.z / tex.width, frameData.rect.w / tex.height);\n\t\t\t} else {\n\t\t\t\tthis._innerOffset.set(0, 0, 0, 0);\n\t\t\t}\n\t\t\tthis._innerOffsetUniform[0] = this._innerOffset.x;\n\t\t\tthis._innerOffsetUniform[1] = this._innerOffset.y;\n\t\t\tthis._innerOffsetUniform[2] = this._innerOffset.z;\n\t\t\tthis._innerOffsetUniform[3] = this._innerOffset.w;\n\t\t\tthis._meshInstance.setParameter(PARAM_INNER_OFFSET, this._innerOffsetUniform);\n\t\t\tthis._atlasRectUniform[0] = this._atlasRect.x;\n\t\t\tthis._atlasRectUniform[1] = this._atlasRect.y;\n\t\t\tthis._atlasRectUniform[2] = this._atlasRect.z;\n\t\t\tthis._atlasRectUniform[3] = this._atlasRect.w;\n\t\t\tthis._meshInstance.setParameter(PARAM_ATLAS_RECT, this._atlasRectUniform);\n\t\t} else {\n\t\t\tthis._meshInstance._updateAabbFunc = null;\n\t\t}\n\t\tthis._updateTransform();\n\t}\n\t_updateTransform() {\n\t\tlet scaleX = this.flipX ? -1 : 1;\n\t\tlet scaleY = this.flipY ? -1 : 1;\n\t\tlet posX = 0;\n\t\tlet posY = 0;\n\t\tif (this.sprite && (this.sprite.renderMode === SPRITE_RENDERMODE_SLICED || this.sprite.renderMode === SPRITE_RENDERMODE_TILED)) {\n\t\t\tlet w = 1;\n\t\t\tlet h = 1;\n\t\t\tif (this.sprite.atlas) {\n\t\t\t\tconst frameData = this.sprite.atlas.frames[this.sprite.frameKeys[this.frame]];\n\t\t\t\tif (frameData) {\n\t\t\t\t\tw = frameData.rect.z;\n\t\t\t\t\th = frameData.rect.w;\n\t\t\t\t\tposX = (0.5 - frameData.pivot.x) * this._width;\n\t\t\t\t\tposY = (0.5 - frameData.pivot.y) * this._height;\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst scaleMulX = w / this.sprite.pixelsPerUnit;\n\t\t\tconst scaleMulY = h / this.sprite.pixelsPerUnit;\n\t\t\tthis._outerScale.set(Math.max(this._width, this._innerOffset.x * scaleMulX), Math.max(this._height, this._innerOffset.y * scaleMulY));\n\t\t\tscaleX *= scaleMulX;\n\t\t\tscaleY *= scaleMulY;\n\t\t\tthis._outerScale.x /= scaleMulX;\n\t\t\tthis._outerScale.y /= scaleMulY;\n\t\t\tscaleX *= math.clamp(this._width / (this._innerOffset.x * scaleMulX), 0.0001, 1);\n\t\t\tscaleY *= math.clamp(this._height / (this._innerOffset.y * scaleMulY), 0.0001, 1);\n\t\t\tif (this._meshInstance) {\n\t\t\t\tthis._outerScaleUniform[0] = this._outerScale.x;\n\t\t\t\tthis._outerScaleUniform[1] = this._outerScale.y;\n\t\t\t\tthis._meshInstance.setParameter(PARAM_OUTER_SCALE, this._outerScaleUniform);\n\t\t\t}\n\t\t}\n\t\tthis._node.setLocalScale(scaleX, scaleY, 1);\n\t\tthis._node.setLocalPosition(posX, posY, 0);\n\t}\n\t_updateAabb(aabb) {\n\t\taabb.center.set(0, 0, 0);\n\t\taabb.halfExtents.set(this._outerScale.x * 0.5, this._outerScale.y * 0.5, 0.001);\n\t\taabb.setFromTransformedAabb(aabb, this._node.getWorldTransform());\n\t\treturn aabb;\n\t}\n\t_tryAutoPlay() {\n\t\tif (!this._autoPlayClip) return;\n\t\tif (this.type !== SPRITETYPE_ANIMATED) return;\n\t\tconst clip = this._clips[this._autoPlayClip];\n\t\tif (clip && !clip.isPlaying && (!this._currentClip || !this._currentClip.isPlaying)) {\n\t\t\tif (this.enabled && this.entity.enabled) {\n\t\t\t\tthis.play(clip.name);\n\t\t\t}\n\t\t}\n\t}\n\t_onLayersChanged(oldComp, newComp) {\n\t\toldComp.off('add', this.onLayerAdded, this);\n\t\toldComp.off('remove', this.onLayerRemoved, this);\n\t\tnewComp.on('add', this.onLayerAdded, this);\n\t\tnewComp.on('remove', this.onLayerRemoved, this);\n\t\tif (this.enabled && this.entity.enabled) {\n\t\t\tthis._showModel();\n\t\t}\n\t}\n\t_onLayerAdded(layer) {\n\t\tconst index = this.layers.indexOf(layer.id);\n\t\tif (index < 0) return;\n\t\tif (this._addedModel && this.enabled && this.entity.enabled && this._meshInstance) {\n\t\t\tlayer.addMeshInstances([this._meshInstance]);\n\t\t}\n\t}\n\t_onLayerRemoved(layer) {\n\t\tif (!this._meshInstance) return;\n\t\tconst index = this.layers.indexOf(layer.id);\n\t\tif (index < 0) return;\n\t\tlayer.removeMeshInstances([this._meshInstance]);\n\t}\n\tremoveModelFromLayers() {\n\t\tfor (let i = 0; i < this.layers.length; i++) {\n\t\t\tconst layer = this.system.app.scene.layers.getLayerById(this.layers[i]);\n\t\t\tif (!layer) continue;\n\t\t\tlayer.removeMeshInstances([this._meshInstance]);\n\t\t}\n\t}\n\taddClip(data) {\n\t\tconst clip = new SpriteAnimationClip(this, {\n\t\t\tname: data.name,\n\t\t\tfps: data.fps,\n\t\t\tloop: data.loop,\n\t\t\tspriteAsset: data.spriteAsset\n\t\t});\n\t\tthis._clips[data.name] = clip;\n\t\tif (clip.name && clip.name === this._autoPlayClip) this._tryAutoPlay();\n\t\treturn clip;\n\t}\n\tremoveClip(name) {\n\t\tdelete this._clips[name];\n\t}\n\tclip(name) {\n\t\treturn this._clips[name];\n\t}\n\tplay(name) {\n\t\tconst clip = this._clips[name];\n\t\tconst current = this._currentClip;\n\t\tif (current && current !== clip) {\n\t\t\tcurrent._playing = false;\n\t\t}\n\t\tthis._currentClip = clip;\n\t\tif (this._currentClip) {\n\t\t\tthis._currentClip = clip;\n\t\t\tthis._currentClip.play();\n\t\t}\n\t\treturn clip;\n\t}\n\tpause() {\n\t\tif (this._currentClip === this._defaultClip) return;\n\t\tif (this._currentClip.isPlaying) {\n\t\t\tthis._currentClip.pause();\n\t\t}\n\t}\n\tresume() {\n\t\tif (this._currentClip === this._defaultClip) return;\n\t\tif (this._currentClip.isPaused) {\n\t\t\tthis._currentClip.resume();\n\t\t}\n\t}\n\tstop() {\n\t\tif (this._currentClip === this._defaultClip) return;\n\t\tthis._currentClip.stop();\n\t}\n}\n\nexport { SpriteComponent };\n","class SpriteComponentData {\n\tconstructor() {\n\t\tthis.enabled = true;\n\t}\n}\n\nexport { SpriteComponentData };\n","import { Color } from '../../../core/math/color.js';\nimport { PIXELFORMAT_RGBA8, CULLFACE_NONE } from '../../../platform/graphics/constants.js';\nimport { Texture } from '../../../platform/graphics/texture.js';\nimport { BLEND_PREMULTIPLIED, SPRITE_RENDERMODE_SLICED, SPRITE_RENDERMODE_TILED } from '../../../scene/constants.js';\nimport { StandardMaterial } from '../../../scene/materials/standard-material.js';\nimport { Component } from '../component.js';\nimport { ComponentSystem } from '../system.js';\nimport { SpriteComponent } from './component.js';\nimport { SpriteComponentData } from './data.js';\n\nconst _schema = ['enabled'];\nclass SpriteComponentSystem extends ComponentSystem {\n\tconstructor(app) {\n\t\tsuper(app);\n\t\tthis.id = 'sprite';\n\t\tthis.ComponentType = SpriteComponent;\n\t\tthis.DataType = SpriteComponentData;\n\t\tthis.schema = _schema;\n\t\tthis._defaultTexture = null;\n\t\tthis._defaultMaterial = null;\n\t\tthis._default9SlicedMaterialSlicedMode = null;\n\t\tthis._default9SlicedMaterialTiledMode = null;\n\t\tthis.app.systems.on('update', this.onUpdate, this);\n\t\tthis.on('beforeremove', this.onBeforeRemove, this);\n\t}\n\tset defaultMaterial(material) {\n\t\tthis._defaultMaterial = material;\n\t}\n\tget defaultMaterial() {\n\t\tif (!this._defaultMaterial) {\n\t\t\tconst texture = new Texture(this.app.graphicsDevice, {\n\t\t\t\twidth: 1,\n\t\t\t\theight: 1,\n\t\t\t\tformat: PIXELFORMAT_RGBA8,\n\t\t\t\tname: 'sprite'\n\t\t\t});\n\t\t\tconst pixels = new Uint8Array(texture.lock());\n\t\t\tpixels[0] = pixels[1] = pixels[2] = pixels[3] = 255;\n\t\t\ttexture.unlock();\n\t\t\tconst material = new StandardMaterial();\n\t\t\tmaterial.diffuse.set(0, 0, 0);\n\t\t\tmaterial.emissive.set(0.5, 0.5, 0.5);\n\t\t\tmaterial.emissiveMap = texture;\n\t\t\tmaterial.emissiveTint = true;\n\t\t\tmaterial.opacityMap = texture;\n\t\t\tmaterial.opacityMapChannel = 'a';\n\t\t\tmaterial.opacityTint = true;\n\t\t\tmaterial.opacity = 0;\n\t\t\tmaterial.useLighting = false;\n\t\t\tmaterial.useGammaTonemap = false;\n\t\t\tmaterial.useFog = false;\n\t\t\tmaterial.useSkybox = false;\n\t\t\tmaterial.blendType = BLEND_PREMULTIPLIED;\n\t\t\tmaterial.depthWrite = false;\n\t\t\tmaterial.pixelSnap = false;\n\t\t\tmaterial.cull = CULLFACE_NONE;\n\t\t\tmaterial.update();\n\t\t\tthis._defaultTexture = texture;\n\t\t\tthis._defaultMaterial = material;\n\t\t}\n\t\treturn this._defaultMaterial;\n\t}\n\tset default9SlicedMaterialSlicedMode(material) {\n\t\tthis._default9SlicedMaterialSlicedMode = material;\n\t}\n\tget default9SlicedMaterialSlicedMode() {\n\t\tif (!this._default9SlicedMaterialSlicedMode) {\n\t\t\tconst material = this.defaultMaterial.clone();\n\t\t\tmaterial.nineSlicedMode = SPRITE_RENDERMODE_SLICED;\n\t\t\tmaterial.update();\n\t\t\tthis._default9SlicedMaterialSlicedMode = material;\n\t\t}\n\t\treturn this._default9SlicedMaterialSlicedMode;\n\t}\n\tset default9SlicedMaterialTiledMode(material) {\n\t\tthis._default9SlicedMaterialTiledMode = material;\n\t}\n\tget default9SlicedMaterialTiledMode() {\n\t\tif (!this._default9SlicedMaterialTiledMode) {\n\t\t\tconst material = this.defaultMaterial.clone();\n\t\t\tmaterial.nineSlicedMode = SPRITE_RENDERMODE_TILED;\n\t\t\tmaterial.update();\n\t\t\tthis._default9SlicedMaterialTiledMode = material;\n\t\t}\n\t\treturn this._default9SlicedMaterialTiledMode;\n\t}\n\tdestroy() {\n\t\tsuper.destroy();\n\t\tthis.app.systems.off('update', this.onUpdate, this);\n\t\tif (this._defaultTexture) {\n\t\t\tthis._defaultTexture.destroy();\n\t\t\tthis._defaultTexture = null;\n\t\t}\n\t}\n\tinitializeComponentData(component, data, properties) {\n\t\tif (data.enabled !== undefined) {\n\t\t\tcomponent.enabled = data.enabled;\n\t\t}\n\t\tcomponent.type = data.type;\n\t\tif (data.layers && Array.isArray(data.layers)) {\n\t\t\tcomponent.layers = data.layers.slice(0);\n\t\t}\n\t\tif (data.drawOrder !== undefined) {\n\t\t\tcomponent.drawOrder = data.drawOrder;\n\t\t}\n\t\tif (data.color !== undefined) {\n\t\t\tif (data.color instanceof Color) {\n\t\t\t\tvar _data$opacity;\n\t\t\t\tcomponent.color.set(data.color.r, data.color.g, data.color.b, (_data$opacity = data.opacity) != null ? _data$opacity : 1);\n\t\t\t} else {\n\t\t\t\tvar _data$opacity2;\n\t\t\t\tcomponent.color.set(data.color[0], data.color[1], data.color[2], (_data$opacity2 = data.opacity) != null ? _data$opacity2 : 1);\n\t\t\t}\n\t\t\tcomponent.color = component.color;\n\t\t}\n\t\tif (data.opacity !== undefined) {\n\t\t\tcomponent.opacity = data.opacity;\n\t\t}\n\t\tif (data.flipX !== undefined) {\n\t\t\tcomponent.flipX = data.flipX;\n\t\t}\n\t\tif (data.flipY !== undefined) {\n\t\t\tcomponent.flipY = data.flipY;\n\t\t}\n\t\tif (data.width !== undefined) {\n\t\t\tcomponent.width = data.width;\n\t\t}\n\t\tif (data.height !== undefined) {\n\t\t\tcomponent.height = data.height;\n\t\t}\n\t\tif (data.spriteAsset !== undefined) {\n\t\t\tcomponent.spriteAsset = data.spriteAsset;\n\t\t}\n\t\tif (data.sprite) {\n\t\t\tcomponent.sprite = data.sprite;\n\t\t}\n\t\tif (data.frame !== undefined) {\n\t\t\tcomponent.frame = data.frame;\n\t\t}\n\t\tif (data.clips) {\n\t\t\tfor (const name in data.clips) {\n\t\t\t\tcomponent.addClip(data.clips[name]);\n\t\t\t}\n\t\t}\n\t\tif (data.speed !== undefined) {\n\t\t\tcomponent.speed = data.speed;\n\t\t}\n\t\tif (data.autoPlayClip) {\n\t\t\tcomponent.autoPlayClip = data.autoPlayClip;\n\t\t}\n\t\tcomponent.batchGroupId = data.batchGroupId === undefined || data.batchGroupId === null ? -1 : data.batchGroupId;\n\t\tsuper.initializeComponentData(component, data, properties);\n\t}\n\tcloneComponent(entity, clone) {\n\t\tconst source = entity.sprite;\n\t\treturn this.addComponent(clone, {\n\t\t\tenabled: source.enabled,\n\t\t\ttype: source.type,\n\t\t\tspriteAsset: source.spriteAsset,\n\t\t\tsprite: source.sprite,\n\t\t\twidth: source.width,\n\t\t\theight: source.height,\n\t\t\tframe: source.frame,\n\t\t\tcolor: source.color.clone(),\n\t\t\topacity: source.opacity,\n\t\t\tflipX: source.flipX,\n\t\t\tflipY: source.flipY,\n\t\t\tspeed: source.speed,\n\t\t\tclips: source.clips,\n\t\t\tautoPlayClip: source.autoPlayClip,\n\t\t\tbatchGroupId: source.batchGroupId,\n\t\t\tdrawOrder: source.drawOrder,\n\t\t\tlayers: source.layers.slice(0)\n\t\t});\n\t}\n\tonUpdate(dt) {\n\t\tconst components = this.store;\n\t\tfor (const id in components) {\n\t\t\tif (components.hasOwnProperty(id)) {\n\t\t\t\tconst component = components[id];\n\t\t\t\tif (component.data.enabled && component.entity.enabled) {\n\t\t\t\t\tconst sprite = component.entity.sprite;\n\t\t\t\t\tif (sprite._currentClip) {\n\t\t\t\t\t\tsprite._currentClip._update(dt);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tonBeforeRemove(entity, component) {\n\t\tcomponent.onDestroy();\n\t}\n}\nComponent._buildAccessors(SpriteComponent.prototype, _schema);\n\nexport { SpriteComponentSystem };\n","import { Vec3 } from '../../../core/math/vec3.js';\nimport { Component } from '../component.js';\n\nclass ZoneComponent extends Component {\n\tconstructor(system, entity) {\n\t\tsuper(system, entity);\n\t\tthis._oldState = true;\n\t\tthis._size = new Vec3();\n\t\tthis.on('set_enabled', this._onSetEnabled, this);\n\t}\n\tset size(data) {\n\t\tif (data instanceof Vec3) {\n\t\t\tthis._size.copy(data);\n\t\t} else if (data instanceof Array && data.length >= 3) {\n\t\t\tthis.size.set(data[0], data[1], data[2]);\n\t\t}\n\t}\n\tget size() {\n\t\treturn this._size;\n\t}\n\tonEnable() {\n\t\tthis._checkState();\n\t}\n\tonDisable() {\n\t\tthis._checkState();\n\t}\n\t_onSetEnabled(prop, old, value) {\n\t\tthis._checkState();\n\t}\n\t_checkState() {\n\t\tconst state = this.enabled && this.entity.enabled;\n\t\tif (state === this._oldState) return;\n\t\tthis._oldState = state;\n\t\tthis.fire('enable');\n\t\tthis.fire('state', this.enabled);\n\t}\n\t_onBeforeRemove() {\n\t\tthis.fire('remove');\n\t}\n}\n\nexport { ZoneComponent };\n","class ZoneComponentData {\n\tconstructor() {\n\t\tthis.enabled = true;\n\t}\n}\n\nexport { ZoneComponentData };\n","import { Vec3 } from '../../../core/math/vec3.js';\nimport { Component } from '../component.js';\nimport { ComponentSystem } from '../system.js';\nimport { ZoneComponent } from './component.js';\nimport { ZoneComponentData } from './data.js';\n\nconst _schema = ['enabled'];\nclass ZoneComponentSystem extends ComponentSystem {\n\tconstructor(app) {\n\t\tsuper(app);\n\t\tthis.id = 'zone';\n\t\tthis.ComponentType = ZoneComponent;\n\t\tthis.DataType = ZoneComponentData;\n\t\tthis.schema = _schema;\n\t\tthis.on('beforeremove', this._onBeforeRemove, this);\n\t}\n\tinitializeComponentData(component, data, properties) {\n\t\tcomponent.enabled = data.hasOwnProperty('enabled') ? !!data.enabled : true;\n\t\tif (data.size) {\n\t\t\tif (data.size instanceof Vec3) {\n\t\t\t\tcomponent.size.copy(data.size);\n\t\t\t} else if (data.size instanceof Array && data.size.length >= 3) {\n\t\t\t\tcomponent.size.set(data.size[0], data.size[1], data.size[2]);\n\t\t\t}\n\t\t}\n\t}\n\tcloneComponent(entity, clone) {\n\t\tconst data = {\n\t\t\tsize: entity.zone.size\n\t\t};\n\t\treturn this.addComponent(clone, data);\n\t}\n\t_onBeforeRemove(entity, component) {\n\t\tcomponent._onBeforeRemove();\n\t}\n}\nComponent._buildAccessors(ZoneComponent.prototype, _schema);\n\nexport { ZoneComponentSystem };\n","import { FILTER_NEAREST, ADDRESS_CLAMP_TO_EDGE, PIXELFORMAT_RGBA16F, PIXELFORMAT_RGBA32F, PIXELFORMAT_RGBA8 } from '../../../platform/graphics/constants.js';\nimport { RenderTarget } from '../../../platform/graphics/render-target.js';\nimport { Texture } from '../../../platform/graphics/texture.js';\nimport { LAYERID_DEPTH } from '../../../scene/constants.js';\n\nclass PostEffect {\n\tconstructor(effect, inputTarget) {\n\t\tthis.effect = effect;\n\t\tthis.inputTarget = inputTarget;\n\t\tthis.outputTarget = null;\n\t\tthis.name = effect.constructor.name;\n\t}\n}\nclass PostEffectQueue {\n\tconstructor(app, camera) {\n\t\tthis.app = app;\n\t\tthis.camera = camera;\n\t\tthis.destinationRenderTarget = null;\n\t\tthis.effects = [];\n\t\tthis.enabled = false;\n\t\tthis.depthTarget = null;\n\t\tcamera.on('set:rect', this.onCameraRectChanged, this);\n\t}\n\t_allocateColorBuffer(format, name) {\n\t\tvar _renderTarget$width, _renderTarget$height;\n\t\tconst rect = this.camera.rect;\n\t\tconst renderTarget = this.destinationRenderTarget;\n\t\tconst device = this.app.graphicsDevice;\n\t\tconst width = Math.floor(rect.z * ((_renderTarget$width = renderTarget == null ? void 0 : renderTarget.width) != null ? _renderTarget$width : device.width));\n\t\tconst height = Math.floor(rect.w * ((_renderTarget$height = renderTarget == null ? void 0 : renderTarget.height) != null ? _renderTarget$height : device.height));\n\t\tconst colorBuffer = new Texture(device, {\n\t\t\tname: name,\n\t\t\tformat: format,\n\t\t\twidth: width,\n\t\t\theight: height,\n\t\t\tmipmaps: false,\n\t\t\tminFilter: FILTER_NEAREST,\n\t\t\tmagFilter: FILTER_NEAREST,\n\t\t\taddressU: ADDRESS_CLAMP_TO_EDGE,\n\t\t\taddressV: ADDRESS_CLAMP_TO_EDGE\n\t\t});\n\t\treturn colorBuffer;\n\t}\n\t_createOffscreenTarget(useDepth, hdr) {\n\t\tconst device = this.app.graphicsDevice;\n\t\tconst format = hdr && device.getRenderableHdrFormat([PIXELFORMAT_RGBA16F, PIXELFORMAT_RGBA32F], true) || PIXELFORMAT_RGBA8;\n\t\tconst name = this.camera.entity.name + '-posteffect-' + this.effects.length;\n\t\tconst colorBuffer = this._allocateColorBuffer(format, name);\n\t\treturn new RenderTarget({\n\t\t\tcolorBuffer: colorBuffer,\n\t\t\tdepth: useDepth,\n\t\t\tstencil: useDepth && this.app.graphicsDevice.supportsStencil,\n\t\t\tsamples: useDepth ? device.samples : 1\n\t\t});\n\t}\n\t_resizeOffscreenTarget(rt) {\n\t\tconst format = rt.colorBuffer.format;\n\t\tconst name = rt.colorBuffer.name;\n\t\trt.destroyFrameBuffers();\n\t\trt.destroyTextureBuffers();\n\t\trt._colorBuffer = this._allocateColorBuffer(format, name);\n\t\trt._colorBuffers = [rt._colorBuffer];\n\t}\n\t_destroyOffscreenTarget(rt) {\n\t\trt.destroyTextureBuffers();\n\t\trt.destroy();\n\t}\n\taddEffect(effect) {\n\t\tconst effects = this.effects;\n\t\tconst isFirstEffect = effects.length === 0;\n\t\tconst inputTarget = this._createOffscreenTarget(isFirstEffect, effect.hdr);\n\t\tconst newEntry = new PostEffect(effect, inputTarget);\n\t\teffects.push(newEntry);\n\t\tthis._sourceTarget = newEntry.inputTarget;\n\t\tif (effects.length > 1) {\n\t\t\teffects[effects.length - 2].outputTarget = newEntry.inputTarget;\n\t\t}\n\t\tthis._newPostEffect = effect;\n\t\tif (effect.needsDepthBuffer) {\n\t\t\tthis._requestDepthMap();\n\t\t}\n\t\tthis.enable();\n\t\tthis._newPostEffect = undefined;\n\t}\n\tremoveEffect(effect) {\n\t\tlet index = -1;\n\t\tfor (let i = 0, len = this.effects.length; i < len; i++) {\n\t\t\tif (this.effects[i].effect === effect) {\n\t\t\t\tindex = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (index >= 0) {\n\t\t\tif (index > 0) {\n\t\t\t\tthis.effects[index - 1].outputTarget = index + 1 < this.effects.length ? this.effects[index + 1].inputTarget : null;\n\t\t\t} else {\n\t\t\t\tif (this.effects.length > 1) {\n\t\t\t\t\tif (!this.effects[1].inputTarget._depth) {\n\t\t\t\t\t\tthis._destroyOffscreenTarget(this.effects[1].inputTarget);\n\t\t\t\t\t\tthis.effects[1].inputTarget = this._createOffscreenTarget(true, this.effects[1].hdr);\n\t\t\t\t\t\tthis._sourceTarget = this.effects[1].inputTarget;\n\t\t\t\t\t}\n\t\t\t\t\tthis.camera.renderTarget = this.effects[1].inputTarget;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._destroyOffscreenTarget(this.effects[index].inputTarget);\n\t\t\tthis.effects.splice(index, 1);\n\t\t}\n\t\tif (this.enabled) {\n\t\t\tif (effect.needsDepthBuffer) {\n\t\t\t\tthis._releaseDepthMap();\n\t\t\t}\n\t\t}\n\t\tif (this.effects.length === 0) {\n\t\t\tthis.disable();\n\t\t}\n\t}\n\t_requestDepthMaps() {\n\t\tfor (let i = 0, len = this.effects.length; i < len; i++) {\n\t\t\tconst effect = this.effects[i].effect;\n\t\t\tif (this._newPostEffect === effect) continue;\n\t\t\tif (effect.needsDepthBuffer) {\n\t\t\t\tthis._requestDepthMap();\n\t\t\t}\n\t\t}\n\t}\n\t_releaseDepthMaps() {\n\t\tfor (let i = 0, len = this.effects.length; i < len; i++) {\n\t\t\tconst effect = this.effects[i].effect;\n\t\t\tif (effect.needsDepthBuffer) {\n\t\t\t\tthis._releaseDepthMap();\n\t\t\t}\n\t\t}\n\t}\n\t_requestDepthMap() {\n\t\tconst depthLayer = this.app.scene.layers.getLayerById(LAYERID_DEPTH);\n\t\tif (depthLayer) {\n\t\t\tdepthLayer.incrementCounter();\n\t\t\tthis.camera.requestSceneDepthMap(true);\n\t\t}\n\t}\n\t_releaseDepthMap() {\n\t\tconst depthLayer = this.app.scene.layers.getLayerById(LAYERID_DEPTH);\n\t\tif (depthLayer) {\n\t\t\tdepthLayer.decrementCounter();\n\t\t\tthis.camera.requestSceneDepthMap(false);\n\t\t}\n\t}\n\tdestroy() {\n\t\tfor (let i = 0, len = this.effects.length; i < len; i++) {\n\t\t\tthis.effects[i].inputTarget.destroy();\n\t\t}\n\t\tthis.effects.length = 0;\n\t\tthis.disable();\n\t}\n\tenable() {\n\t\tif (!this.enabled && this.effects.length) {\n\t\t\tthis.enabled = true;\n\t\t\tthis._requestDepthMaps();\n\t\t\tthis.app.graphicsDevice.on('resizecanvas', this._onCanvasResized, this);\n\t\t\tthis.destinationRenderTarget = this.camera.renderTarget;\n\t\t\tthis.camera.renderTarget = this.effects[0].inputTarget;\n\t\t\tthis.camera.onPostprocessing = () => {\n\t\t\t\tif (this.enabled) {\n\t\t\t\t\tlet rect = null;\n\t\t\t\t\tconst len = this.effects.length;\n\t\t\t\t\tif (len) {\n\t\t\t\t\t\tfor (let i = 0; i < len; i++) {\n\t\t\t\t\t\t\tconst fx = this.effects[i];\n\t\t\t\t\t\t\tlet destTarget = fx.outputTarget;\n\t\t\t\t\t\t\tif (i === len - 1) {\n\t\t\t\t\t\t\t\trect = this.camera.rect;\n\t\t\t\t\t\t\t\tif (this.destinationRenderTarget) {\n\t\t\t\t\t\t\t\t\tdestTarget = this.destinationRenderTarget;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfx.effect.render(fx.inputTarget, destTarget, rect);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n\tdisable() {\n\t\tif (this.enabled) {\n\t\t\tthis.enabled = false;\n\t\t\tthis.app.graphicsDevice.off('resizecanvas', this._onCanvasResized, this);\n\t\t\tthis._releaseDepthMaps();\n\t\t\tthis._destroyOffscreenTarget(this._sourceTarget);\n\t\t\tthis.camera.renderTarget = null;\n\t\t\tthis.camera.onPostprocessing = null;\n\t\t}\n\t}\n\t_onCanvasResized(width, height) {\n\t\tvar _renderTarget$width2, _renderTarget$height2;\n\t\tconst rect = this.camera.rect;\n\t\tconst renderTarget = this.destinationRenderTarget;\n\t\twidth = (_renderTarget$width2 = renderTarget == null ? void 0 : renderTarget.width) != null ? _renderTarget$width2 : width;\n\t\theight = (_renderTarget$height2 = renderTarget == null ? void 0 : renderTarget.height) != null ? _renderTarget$height2 : height;\n\t\tthis.camera.camera.aspectRatio = width * rect.z / (height * rect.w);\n\t\tthis.resizeRenderTargets();\n\t}\n\tresizeRenderTargets() {\n\t\tvar _renderTarget$width3, _renderTarget$height3;\n\t\tconst device = this.app.graphicsDevice;\n\t\tconst renderTarget = this.destinationRenderTarget;\n\t\tconst width = (_renderTarget$width3 = renderTarget == null ? void 0 : renderTarget.width) != null ? _renderTarget$width3 : device.width;\n\t\tconst height = (_renderTarget$height3 = renderTarget == null ? void 0 : renderTarget.height) != null ? _renderTarget$height3 : device.height;\n\t\tconst rect = this.camera.rect;\n\t\tconst desiredWidth = Math.floor(rect.z * width);\n\t\tconst desiredHeight = Math.floor(rect.w * height);\n\t\tconst effects = this.effects;\n\t\tfor (let i = 0, len = effects.length; i < len; i++) {\n\t\t\tconst fx = effects[i];\n\t\t\tif (fx.inputTarget.width !== desiredWidth || fx.inputTarget.height !== desiredHeight) {\n\t\t\t\tthis._resizeOffscreenTarget(fx.inputTarget);\n\t\t\t}\n\t\t}\n\t}\n\tonCameraRectChanged(name, oldValue, newValue) {\n\t\tif (this.enabled) {\n\t\t\tthis.resizeRenderTargets();\n\t\t}\n\t}\n}\n\nexport { PostEffectQueue };\n","import '../../../core/tracing.js';\nimport { LAYERID_UI, LAYERID_DEPTH, ASPECT_AUTO } from '../../../scene/constants.js';\nimport { Camera } from '../../../scene/camera.js';\nimport { ShaderPass } from '../../../scene/shader-pass.js';\nimport { Component } from '../component.js';\nimport { PostEffectQueue } from './post-effect-queue.js';\n\nclass CameraComponent extends Component {\n\tconstructor(system, entity) {\n\t\tsuper(system, entity);\n\t\tthis.onPostprocessing = null;\n\t\tthis.onPreRender = null;\n\t\tthis.onPostRender = null;\n\t\tthis._renderSceneDepthMap = 0;\n\t\tthis._renderSceneColorMap = 0;\n\t\tthis._sceneDepthMapRequested = false;\n\t\tthis._sceneColorMapRequested = false;\n\t\tthis._priority = 0;\n\t\tthis._disablePostEffectsLayer = LAYERID_UI;\n\t\tthis._camera = new Camera();\n\t\tthis._camera.node = entity;\n\t\tthis._postEffects = new PostEffectQueue(system.app, this);\n\t}\n\tsetShaderPass(name) {\n\t\tconst shaderPass = ShaderPass.get(this.system.app.graphicsDevice);\n\t\tconst shaderPassInfo = name ? shaderPass.allocate(name, {\n\t\t\tisForward: true\n\t\t}) : null;\n\t\tthis._camera.shaderPassInfo = shaderPassInfo;\n\t\treturn shaderPassInfo.index;\n\t}\n\tgetShaderPass() {\n\t\tvar _this$_camera$shaderP;\n\t\treturn (_this$_camera$shaderP = this._camera.shaderPassInfo) == null ? void 0 : _this$_camera$shaderP.name;\n\t}\n\tset renderPasses(passes) {\n\t\tthis._camera.renderPasses = passes;\n\t}\n\tget renderPasses() {\n\t\treturn this._camera.renderPasses;\n\t}\n\tset aperture(value) {\n\t\tthis._camera.aperture = value;\n\t}\n\tget aperture() {\n\t\treturn this._camera.aperture;\n\t}\n\tset aspectRatio(value) {\n\t\tthis._camera.aspectRatio = value;\n\t}\n\tget aspectRatio() {\n\t\treturn this._camera.aspectRatio;\n\t}\n\tset aspectRatioMode(value) {\n\t\tthis._camera.aspectRatioMode = value;\n\t}\n\tget aspectRatioMode() {\n\t\treturn this._camera.aspectRatioMode;\n\t}\n\tset calculateProjection(value) {\n\t\tthis._camera.calculateProjection = value;\n\t}\n\tget calculateProjection() {\n\t\treturn this._camera.calculateProjection;\n\t}\n\tset calculateTransform(value) {\n\t\tthis._camera.calculateTransform = value;\n\t}\n\tget calculateTransform() {\n\t\treturn this._camera.calculateTransform;\n\t}\n\tget camera() {\n\t\treturn this._camera;\n\t}\n\tset clearColor(value) {\n\t\tthis._camera.clearColor = value;\n\t}\n\tget clearColor() {\n\t\treturn this._camera.clearColor;\n\t}\n\tset clearColorBuffer(value) {\n\t\tthis._camera.clearColorBuffer = value;\n\t\tthis.dirtyLayerCompositionCameras();\n\t}\n\tget clearColorBuffer() {\n\t\treturn this._camera.clearColorBuffer;\n\t}\n\tset clearDepthBuffer(value) {\n\t\tthis._camera.clearDepthBuffer = value;\n\t\tthis.dirtyLayerCompositionCameras();\n\t}\n\tget clearDepthBuffer() {\n\t\treturn this._camera.clearDepthBuffer;\n\t}\n\tset clearStencilBuffer(value) {\n\t\tthis._camera.clearStencilBuffer = value;\n\t\tthis.dirtyLayerCompositionCameras();\n\t}\n\tget clearStencilBuffer() {\n\t\treturn this._camera.clearStencilBuffer;\n\t}\n\tset cullFaces(value) {\n\t\tthis._camera.cullFaces = value;\n\t}\n\tget cullFaces() {\n\t\treturn this._camera.cullFaces;\n\t}\n\tset disablePostEffectsLayer(layer) {\n\t\tthis._disablePostEffectsLayer = layer;\n\t\tthis.dirtyLayerCompositionCameras();\n\t}\n\tget disablePostEffectsLayer() {\n\t\treturn this._disablePostEffectsLayer;\n\t}\n\tset farClip(value) {\n\t\tthis._camera.farClip = value;\n\t}\n\tget farClip() {\n\t\treturn this._camera.farClip;\n\t}\n\tset flipFaces(value) {\n\t\tthis._camera.flipFaces = value;\n\t}\n\tget flipFaces() {\n\t\treturn this._camera.flipFaces;\n\t}\n\tset fov(value) {\n\t\tthis._camera.fov = value;\n\t}\n\tget fov() {\n\t\treturn this._camera.fov;\n\t}\n\tget frustum() {\n\t\treturn this._camera.frustum;\n\t}\n\tset frustumCulling(value) {\n\t\tthis._camera.frustumCulling = value;\n\t}\n\tget frustumCulling() {\n\t\treturn this._camera.frustumCulling;\n\t}\n\tset horizontalFov(value) {\n\t\tthis._camera.horizontalFov = value;\n\t}\n\tget horizontalFov() {\n\t\treturn this._camera.horizontalFov;\n\t}\n\tset layers(newValue) {\n\t\tconst layers = this._camera.layers;\n\t\tfor (let i = 0; i < layers.length; i++) {\n\t\t\tconst layer = this.system.app.scene.layers.getLayerById(layers[i]);\n\t\t\tif (!layer) continue;\n\t\t\tlayer.removeCamera(this);\n\t\t}\n\t\tthis._camera.layers = newValue;\n\t\tif (!this.enabled || !this.entity.enabled) return;\n\t\tfor (let i = 0; i < newValue.length; i++) {\n\t\t\tconst layer = this.system.app.scene.layers.getLayerById(newValue[i]);\n\t\t\tif (!layer) continue;\n\t\t\tlayer.addCamera(this);\n\t\t}\n\t}\n\tget layers() {\n\t\treturn this._camera.layers;\n\t}\n\tget layersSet() {\n\t\treturn this._camera.layersSet;\n\t}\n\tset nearClip(value) {\n\t\tthis._camera.nearClip = value;\n\t}\n\tget nearClip() {\n\t\treturn this._camera.nearClip;\n\t}\n\tset orthoHeight(value) {\n\t\tthis._camera.orthoHeight = value;\n\t}\n\tget orthoHeight() {\n\t\treturn this._camera.orthoHeight;\n\t}\n\tget postEffects() {\n\t\treturn this._postEffects;\n\t}\n\tget postEffectsEnabled() {\n\t\treturn this._postEffects.enabled;\n\t}\n\tset priority(newValue) {\n\t\tthis._priority = newValue;\n\t\tthis.dirtyLayerCompositionCameras();\n\t}\n\tget priority() {\n\t\treturn this._priority;\n\t}\n\tset projection(value) {\n\t\tthis._camera.projection = value;\n\t}\n\tget projection() {\n\t\treturn this._camera.projection;\n\t}\n\tget projectionMatrix() {\n\t\treturn this._camera.projectionMatrix;\n\t}\n\tset rect(value) {\n\t\tthis._camera.rect = value;\n\t\tthis.fire('set:rect', this._camera.rect);\n\t}\n\tget rect() {\n\t\treturn this._camera.rect;\n\t}\n\tset renderSceneColorMap(value) {\n\t\tif (value && !this._sceneColorMapRequested) {\n\t\t\tthis.requestSceneColorMap(true);\n\t\t\tthis._sceneColorMapRequested = true;\n\t\t} else if (this._sceneColorMapRequested) {\n\t\t\tthis.requestSceneColorMap(false);\n\t\t\tthis._sceneColorMapRequested = false;\n\t\t}\n\t}\n\tget renderSceneColorMap() {\n\t\treturn this._renderSceneColorMap > 0;\n\t}\n\tset renderSceneDepthMap(value) {\n\t\tif (value && !this._sceneDepthMapRequested) {\n\t\t\tthis.requestSceneDepthMap(true);\n\t\t\tthis._sceneDepthMapRequested = true;\n\t\t} else if (this._sceneDepthMapRequested) {\n\t\t\tthis.requestSceneDepthMap(false);\n\t\t\tthis._sceneDepthMapRequested = false;\n\t\t}\n\t}\n\tget renderSceneDepthMap() {\n\t\treturn this._renderSceneDepthMap > 0;\n\t}\n\tset renderTarget(value) {\n\t\tthis._camera.renderTarget = value;\n\t\tthis.dirtyLayerCompositionCameras();\n\t}\n\tget renderTarget() {\n\t\treturn this._camera.renderTarget;\n\t}\n\tset scissorRect(value) {\n\t\tthis._camera.scissorRect = value;\n\t}\n\tget scissorRect() {\n\t\treturn this._camera.scissorRect;\n\t}\n\tset sensitivity(value) {\n\t\tthis._camera.sensitivity = value;\n\t}\n\tget sensitivity() {\n\t\treturn this._camera.sensitivity;\n\t}\n\tset shutter(value) {\n\t\tthis._camera.shutter = value;\n\t}\n\tget shutter() {\n\t\treturn this._camera.shutter;\n\t}\n\tget viewMatrix() {\n\t\treturn this._camera.viewMatrix;\n\t}\n\t_enableDepthLayer(value) {\n\t\tconst hasDepthLayer = this.layers.find(layerId => layerId === LAYERID_DEPTH);\n\t\tif (hasDepthLayer) {\n\t\t\tconst depthLayer = this.system.app.scene.layers.getLayerById(LAYERID_DEPTH);\n\t\t\tif (value) {\n\t\t\t\tdepthLayer == null || depthLayer.incrementCounter();\n\t\t\t} else {\n\t\t\t\tdepthLayer == null || depthLayer.decrementCounter();\n\t\t\t}\n\t\t} else if (value) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\trequestSceneColorMap(enabled) {\n\t\tthis._renderSceneColorMap += enabled ? 1 : -1;\n\t\tthis._enableDepthLayer(enabled);\n\t\tthis.camera._enableRenderPassColorGrab(this.system.app.graphicsDevice, this.renderSceneColorMap);\n\t}\n\trequestSceneDepthMap(enabled) {\n\t\tthis._renderSceneDepthMap += enabled ? 1 : -1;\n\t\tthis._enableDepthLayer(enabled);\n\t\tthis.camera._enableRenderPassDepthGrab(this.system.app.graphicsDevice, this.system.app.renderer, this.renderSceneDepthMap);\n\t}\n\tdirtyLayerCompositionCameras() {\n\t\tconst layerComp = this.system.app.scene.layers;\n\t\tlayerComp._dirty = true;\n\t}\n\tscreenToWorld(screenx, screeny, cameraz, worldCoord) {\n\t\tconst device = this.system.app.graphicsDevice;\n\t\tconst w = device.clientRect.width;\n\t\tconst h = device.clientRect.height;\n\t\treturn this._camera.screenToWorld(screenx, screeny, cameraz, w, h, worldCoord);\n\t}\n\tworldToScreen(worldCoord, screenCoord) {\n\t\tconst device = this.system.app.graphicsDevice;\n\t\tconst w = device.clientRect.width;\n\t\tconst h = device.clientRect.height;\n\t\treturn this._camera.worldToScreen(worldCoord, w, h, screenCoord);\n\t}\n\tonAppPrerender() {\n\t\tthis._camera._viewMatDirty = true;\n\t\tthis._camera._viewProjMatDirty = true;\n\t}\n\taddCameraToLayers() {\n\t\tconst layers = this.layers;\n\t\tfor (let i = 0; i < layers.length; i++) {\n\t\t\tconst layer = this.system.app.scene.layers.getLayerById(layers[i]);\n\t\t\tif (layer) {\n\t\t\t\tlayer.addCamera(this);\n\t\t\t}\n\t\t}\n\t}\n\tremoveCameraFromLayers() {\n\t\tconst layers = this.layers;\n\t\tfor (let i = 0; i < layers.length; i++) {\n\t\t\tconst layer = this.system.app.scene.layers.getLayerById(layers[i]);\n\t\t\tif (layer) {\n\t\t\t\tlayer.removeCamera(this);\n\t\t\t}\n\t\t}\n\t}\n\tonLayersChanged(oldComp, newComp) {\n\t\tthis.addCameraToLayers();\n\t\toldComp.off('add', this.onLayerAdded, this);\n\t\toldComp.off('remove', this.onLayerRemoved, this);\n\t\tnewComp.on('add', this.onLayerAdded, this);\n\t\tnewComp.on('remove', this.onLayerRemoved, this);\n\t}\n\tonLayerAdded(layer) {\n\t\tconst index = this.layers.indexOf(layer.id);\n\t\tif (index < 0) return;\n\t\tlayer.addCamera(this);\n\t}\n\tonLayerRemoved(layer) {\n\t\tconst index = this.layers.indexOf(layer.id);\n\t\tif (index < 0) return;\n\t\tlayer.removeCamera(this);\n\t}\n\tonEnable() {\n\t\tconst system = this.system;\n\t\tconst scene = system.app.scene;\n\t\tconst layers = scene.layers;\n\t\tsystem.addCamera(this);\n\t\tscene.on('set:layers', this.onLayersChanged, this);\n\t\tif (layers) {\n\t\t\tlayers.on('add', this.onLayerAdded, this);\n\t\t\tlayers.on('remove', this.onLayerRemoved, this);\n\t\t}\n\t\tif (this.enabled && this.entity.enabled) {\n\t\t\tthis.addCameraToLayers();\n\t\t}\n\t\tthis.postEffects.enable();\n\t}\n\tonDisable() {\n\t\tconst system = this.system;\n\t\tconst scene = system.app.scene;\n\t\tconst layers = scene.layers;\n\t\tthis.postEffects.disable();\n\t\tthis.removeCameraFromLayers();\n\t\tscene.off('set:layers', this.onLayersChanged, this);\n\t\tif (layers) {\n\t\t\tlayers.off('add', this.onLayerAdded, this);\n\t\t\tlayers.off('remove', this.onLayerRemoved, this);\n\t\t}\n\t\tsystem.removeCamera(this);\n\t}\n\tonRemove() {\n\t\tthis.onDisable();\n\t\tthis.off();\n\t\tthis.camera.destroy();\n\t}\n\tcalculateAspectRatio(rt) {\n\t\tconst device = this.system.app.graphicsDevice;\n\t\tconst width = rt ? rt.width : device.width;\n\t\tconst height = rt ? rt.height : device.height;\n\t\treturn width * this.rect.z / (height * this.rect.w);\n\t}\n\tframeUpdate(rt) {\n\t\tif (this.aspectRatioMode === ASPECT_AUTO) {\n\t\t\tthis.aspectRatio = this.calculateAspectRatio(rt);\n\t\t}\n\t}\n\tstartXr(type, spaceType, options) {\n\t\tthis.system.app.xr.start(this, type, spaceType, options);\n\t}\n\tendXr(callback) {\n\t\tif (!this._camera.xr) {\n\t\t\tif (callback) callback(new Error('Camera is not in XR'));\n\t\t\treturn;\n\t\t}\n\t\tthis._camera.xr.end(callback);\n\t}\n\tcopy(source) {\n\t\tthis.aperture = source.aperture;\n\t\tthis.aspectRatio = source.aspectRatio;\n\t\tthis.aspectRatioMode = source.aspectRatioMode;\n\t\tthis.calculateProjection = source.calculateProjection;\n\t\tthis.calculateTransform = source.calculateTransform;\n\t\tthis.clearColor = source.clearColor;\n\t\tthis.clearColorBuffer = source.clearColorBuffer;\n\t\tthis.clearDepthBuffer = source.clearDepthBuffer;\n\t\tthis.clearStencilBuffer = source.clearStencilBuffer;\n\t\tthis.cullFaces = source.cullFaces;\n\t\tthis.disablePostEffectsLayer = source.disablePostEffectsLayer;\n\t\tthis.farClip = source.farClip;\n\t\tthis.flipFaces = source.flipFaces;\n\t\tthis.fov = source.fov;\n\t\tthis.frustumCulling = source.frustumCulling;\n\t\tthis.horizontalFov = source.horizontalFov;\n\t\tthis.layers = source.layers;\n\t\tthis.nearClip = source.nearClip;\n\t\tthis.orthoHeight = source.orthoHeight;\n\t\tthis.priority = source.priority;\n\t\tthis.projection = source.projection;\n\t\tthis.rect = source.rect;\n\t\tthis.renderTarget = source.renderTarget;\n\t\tthis.scissorRect = source.scissorRect;\n\t\tthis.sensitivity = source.sensitivity;\n\t\tthis.shutter = source.shutter;\n\t}\n}\n\nexport { CameraComponent };\n","class CameraComponentData {\n\tconstructor() {\n\t\tthis.enabled = true;\n\t}\n}\n\nexport { CameraComponentData };\n","import { sortPriority } from '../../../core/sort.js';\nimport { Color } from '../../../core/math/color.js';\nimport { Vec4 } from '../../../core/math/vec4.js';\nimport { Component } from '../component.js';\nimport { ComponentSystem } from '../system.js';\nimport { CameraComponent } from './component.js';\nimport { CameraComponentData } from './data.js';\n\nconst _schema = ['enabled'];\nclass CameraComponentSystem extends ComponentSystem {\n\tconstructor(app) {\n\t\tsuper(app);\n\t\tthis.cameras = [];\n\t\tthis.id = 'camera';\n\t\tthis.ComponentType = CameraComponent;\n\t\tthis.DataType = CameraComponentData;\n\t\tthis.schema = _schema;\n\t\tthis.on('beforeremove', this.onBeforeRemove, this);\n\t\tthis.app.on('prerender', this.onAppPrerender, this);\n\t\tthis.app.systems.on('update', this.onUpdate, this);\n\t}\n\tinitializeComponentData(component, data, properties) {\n\t\tproperties = ['aspectRatio', 'aspectRatioMode', 'calculateProjection', 'calculateTransform', 'clearColor', 'clearColorBuffer', 'clearDepthBuffer', 'clearStencilBuffer', 'renderSceneColorMap', 'renderSceneDepthMap', 'cullFaces', 'farClip', 'flipFaces', 'fov', 'frustumCulling', 'horizontalFov', 'layers', 'renderTarget', 'nearClip', 'orthoHeight', 'projection', 'priority', 'rect', 'scissorRect', 'aperture', 'shutter', 'sensitivity'];\n\t\tfor (let i = 0; i < properties.length; i++) {\n\t\t\tconst property = properties[i];\n\t\t\tif (data.hasOwnProperty(property)) {\n\t\t\t\tconst value = data[property];\n\t\t\t\tswitch (property) {\n\t\t\t\t\tcase 'rect':\n\t\t\t\t\tcase 'scissorRect':\n\t\t\t\t\t\tif (Array.isArray(value)) {\n\t\t\t\t\t\t\tcomponent[property] = new Vec4(value[0], value[1], value[2], value[3]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcomponent[property] = value;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'clearColor':\n\t\t\t\t\t\tif (Array.isArray(value)) {\n\t\t\t\t\t\t\tcomponent[property] = new Color(value[0], value[1], value[2], value[3]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcomponent[property] = value;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tcomponent[property] = value;\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tsuper.initializeComponentData(component, data, ['enabled']);\n\t}\n\tcloneComponent(entity, clone) {\n\t\tconst c = entity.camera;\n\t\treturn this.addComponent(clone, {\n\t\t\taspectRatio: c.aspectRatio,\n\t\t\taspectRatioMode: c.aspectRatioMode,\n\t\t\tcalculateProjection: c.calculateProjection,\n\t\t\tcalculateTransform: c.calculateTransform,\n\t\t\tclearColor: c.clearColor,\n\t\t\tclearColorBuffer: c.clearColorBuffer,\n\t\t\tclearDepthBuffer: c.clearDepthBuffer,\n\t\t\tclearStencilBuffer: c.clearStencilBuffer,\n\t\t\trenderSceneDepthMap: c.renderSceneDepthMap,\n\t\t\trenderSceneColorMap: c.renderSceneColorMap,\n\t\t\tcullFaces: c.cullFaces,\n\t\t\tenabled: c.enabled,\n\t\t\tfarClip: c.farClip,\n\t\t\tflipFaces: c.flipFaces,\n\t\t\tfov: c.fov,\n\t\t\tfrustumCulling: c.frustumCulling,\n\t\t\thorizontalFov: c.horizontalFov,\n\t\t\tlayers: c.layers,\n\t\t\trenderTarget: c.renderTarget,\n\t\t\tnearClip: c.nearClip,\n\t\t\torthoHeight: c.orthoHeight,\n\t\t\tprojection: c.projection,\n\t\t\tpriority: c.priority,\n\t\t\trect: c.rect,\n\t\t\tscissorRect: c.scissorRect,\n\t\t\taperture: c.aperture,\n\t\t\tsensitivity: c.sensitivity,\n\t\t\tshutter: c.shutter\n\t\t});\n\t}\n\tonBeforeRemove(entity, component) {\n\t\tthis.removeCamera(component);\n\t\tcomponent.onRemove();\n\t}\n\tonUpdate(dt) {}\n\tonAppPrerender() {\n\t\tfor (let i = 0, len = this.cameras.length; i < len; i++) {\n\t\t\tthis.cameras[i].onAppPrerender();\n\t\t}\n\t}\n\taddCamera(camera) {\n\t\tthis.cameras.push(camera);\n\t\tsortPriority(this.cameras);\n\t}\n\tremoveCamera(camera) {\n\t\tconst index = this.cameras.indexOf(camera);\n\t\tif (index >= 0) {\n\t\t\tthis.cameras.splice(index, 1);\n\t\t\tsortPriority(this.cameras);\n\t\t}\n\t}\n\tdestroy() {\n\t\tsuper.destroy();\n\t\tthis.app.systems.off('update', this.onUpdate, this);\n\t}\n}\nComponent._buildAccessors(CameraComponent.prototype, _schema);\n\nexport { CameraComponentSystem };\n","import { math } from '../../../core/math/math.js';\nimport { Color } from '../../../core/math/color.js';\nimport { Vec4 } from '../../../core/math/vec4.js';\nimport { LIGHTSHAPE_PUNCTUAL, LIGHTFALLOFF_LINEAR, SHADOW_PCF3, BLUR_GAUSSIAN, SHADOWUPDATE_REALTIME, MASK_AFFECT_DYNAMIC, MASK_AFFECT_LIGHTMAPPED, MASK_BAKE, LAYERID_WORLD } from '../../../scene/constants.js';\nimport { Asset } from '../../asset/asset.js';\nimport { Component } from '../component.js';\n\nconst _lightProps = [];\nconst _lightPropsDefault = [];\nclass LightComponent extends Component {\n\tconstructor(system, entity) {\n\t\tsuper(system, entity);\n\t\tthis._cookieAsset = null;\n\t\tthis._cookieAssetId = null;\n\t\tthis._cookieAssetAdd = false;\n\t\tthis._cookieMatrix = null;\n\t}\n\taddLightToLayers() {\n\t\tfor (let i = 0; i < this.layers.length; i++) {\n\t\t\tconst layer = this.system.app.scene.layers.getLayerById(this.layers[i]);\n\t\t\tif (layer) {\n\t\t\t\tlayer.addLight(this);\n\t\t\t\tthis.light.addLayer(layer);\n\t\t\t}\n\t\t}\n\t}\n\tremoveLightFromLayers() {\n\t\tfor (let i = 0; i < this.layers.length; i++) {\n\t\t\tconst layer = this.system.app.scene.layers.getLayerById(this.layers[i]);\n\t\t\tif (layer) {\n\t\t\t\tlayer.removeLight(this);\n\t\t\t\tthis.light.removeLayer(layer);\n\t\t\t}\n\t\t}\n\t}\n\tonLayersChanged(oldComp, newComp) {\n\t\tif (this.enabled && this.entity.enabled) {\n\t\t\tthis.addLightToLayers();\n\t\t}\n\t\toldComp.off('add', this.onLayerAdded, this);\n\t\toldComp.off('remove', this.onLayerRemoved, this);\n\t\tnewComp.on('add', this.onLayerAdded, this);\n\t\tnewComp.on('remove', this.onLayerRemoved, this);\n\t}\n\tonLayerAdded(layer) {\n\t\tconst index = this.layers.indexOf(layer.id);\n\t\tif (index >= 0 && this.enabled && this.entity.enabled) {\n\t\t\tlayer.addLight(this);\n\t\t\tthis.light.addLayer(layer);\n\t\t}\n\t}\n\tonLayerRemoved(layer) {\n\t\tconst index = this.layers.indexOf(layer.id);\n\t\tif (index >= 0) {\n\t\t\tlayer.removeLight(this);\n\t\t\tthis.light.removeLayer(layer);\n\t\t}\n\t}\n\trefreshProperties() {\n\t\tfor (let i = 0; i < _lightProps.length; i++) {\n\t\t\tconst name = _lightProps[i];\n\t\t\tthis[name] = this[name];\n\t\t}\n\t\tif (this.enabled && this.entity.enabled) this.onEnable();\n\t}\n\tonCookieAssetSet() {\n\t\tlet forceLoad = false;\n\t\tif (this._cookieAsset.type === 'cubemap' && !this._cookieAsset.loadFaces) {\n\t\t\tthis._cookieAsset.loadFaces = true;\n\t\t\tforceLoad = true;\n\t\t}\n\t\tif (!this._cookieAsset.resource || forceLoad) this.system.app.assets.load(this._cookieAsset);\n\t\tif (this._cookieAsset.resource) this.onCookieAssetLoad();\n\t}\n\tonCookieAssetAdd(asset) {\n\t\tif (this._cookieAssetId !== asset.id) return;\n\t\tthis._cookieAsset = asset;\n\t\tif (this.light.enabled) this.onCookieAssetSet();\n\t\tthis._cookieAsset.on('load', this.onCookieAssetLoad, this);\n\t\tthis._cookieAsset.on('remove', this.onCookieAssetRemove, this);\n\t}\n\tonCookieAssetLoad() {\n\t\tif (!this._cookieAsset || !this._cookieAsset.resource) return;\n\t\tthis.cookie = this._cookieAsset.resource;\n\t}\n\tonCookieAssetRemove() {\n\t\tif (!this._cookieAssetId) return;\n\t\tif (this._cookieAssetAdd) {\n\t\t\tthis.system.app.assets.off('add:' + this._cookieAssetId, this.onCookieAssetAdd, this);\n\t\t\tthis._cookieAssetAdd = false;\n\t\t}\n\t\tif (this._cookieAsset) {\n\t\t\tthis._cookieAsset.off('load', this.onCookieAssetLoad, this);\n\t\t\tthis._cookieAsset.off('remove', this.onCookieAssetRemove, this);\n\t\t\tthis._cookieAsset = null;\n\t\t}\n\t\tthis.cookie = null;\n\t}\n\tonEnable() {\n\t\tthis.light.enabled = true;\n\t\tthis.system.app.scene.on('set:layers', this.onLayersChanged, this);\n\t\tif (this.system.app.scene.layers) {\n\t\t\tthis.system.app.scene.layers.on('add', this.onLayerAdded, this);\n\t\t\tthis.system.app.scene.layers.on('remove', this.onLayerRemoved, this);\n\t\t}\n\t\tif (this.enabled && this.entity.enabled) {\n\t\t\tthis.addLightToLayers();\n\t\t}\n\t\tif (this._cookieAsset && !this.cookie) this.onCookieAssetSet();\n\t}\n\tonDisable() {\n\t\tthis.light.enabled = false;\n\t\tthis.system.app.scene.off('set:layers', this.onLayersChanged, this);\n\t\tif (this.system.app.scene.layers) {\n\t\t\tthis.system.app.scene.layers.off('add', this.onLayerAdded, this);\n\t\t\tthis.system.app.scene.layers.off('remove', this.onLayerRemoved, this);\n\t\t}\n\t\tthis.removeLightFromLayers();\n\t}\n\tonRemove() {\n\t\tthis.onDisable();\n\t\tthis.light.destroy();\n\t\tthis.cookieAsset = null;\n\t}\n\tset shadowUpdateOverrides(values) {\n\t\tthis.light.shadowUpdateOverrides = values;\n\t}\n\tget shadowUpdateOverrides() {\n\t\treturn this.light.shadowUpdateOverrides;\n\t}\n\tset penumbraSize(value) {\n\t\tthis.light.penumbraSize = value;\n\t}\n\tget penumbraSize() {\n\t\treturn this.light.penumbraSize;\n\t}\n}\nfunction _defineProperty(name, defaultValue, setFunc, skipEqualsCheck) {\n\tconst c = LightComponent.prototype;\n\t_lightProps.push(name);\n\t_lightPropsDefault.push(defaultValue);\n\tObject.defineProperty(c, name, {\n\t\tget: function () {\n\t\t\treturn this.data[name];\n\t\t},\n\t\tset: function (value) {\n\t\t\tconst data = this.data;\n\t\t\tconst oldValue = data[name];\n\t\t\tif (!skipEqualsCheck && oldValue === value) return;\n\t\t\tdata[name] = value;\n\t\t\tif (setFunc) setFunc.call(this, value, oldValue);\n\t\t},\n\t\tconfigurable: true\n\t});\n}\nfunction _defineProps() {\n\t_defineProperty('enabled', true, function (newValue, oldValue) {\n\t\tthis.onSetEnabled(null, oldValue, newValue);\n\t});\n\t_defineProperty('light', null);\n\t_defineProperty('type', 'directional', function (newValue, oldValue) {\n\t\tthis.system.changeType(this, oldValue, newValue);\n\t\tthis.refreshProperties();\n\t});\n\t_defineProperty('color', new Color(1, 1, 1), function (newValue, oldValue) {\n\t\tthis.light.setColor(newValue);\n\t}, true);\n\t_defineProperty('intensity', 1, function (newValue, oldValue) {\n\t\tthis.light.intensity = newValue;\n\t});\n\t_defineProperty('luminance', 0, function (newValue, oldValue) {\n\t\tthis.light.luminance = newValue;\n\t});\n\t_defineProperty('shape', LIGHTSHAPE_PUNCTUAL, function (newValue, oldValue) {\n\t\tthis.light.shape = newValue;\n\t});\n\t_defineProperty('affectSpecularity', true, function (newValue, oldValue) {\n\t\tthis.light.affectSpecularity = newValue;\n\t});\n\t_defineProperty('castShadows', false, function (newValue, oldValue) {\n\t\tthis.light.castShadows = newValue;\n\t});\n\t_defineProperty('shadowDistance', 40, function (newValue, oldValue) {\n\t\tthis.light.shadowDistance = newValue;\n\t});\n\t_defineProperty('shadowIntensity', 1, function (newValue, oldValue) {\n\t\tthis.light.shadowIntensity = newValue;\n\t});\n\t_defineProperty('shadowResolution', 1024, function (newValue, oldValue) {\n\t\tthis.light.shadowResolution = newValue;\n\t});\n\t_defineProperty('shadowBias', 0.05, function (newValue, oldValue) {\n\t\tthis.light.shadowBias = -0.01 * math.clamp(newValue, 0, 1);\n\t});\n\t_defineProperty('numCascades', 1, function (newValue, oldValue) {\n\t\tthis.light.numCascades = math.clamp(Math.floor(newValue), 1, 4);\n\t});\n\t_defineProperty('bakeNumSamples', 1, function (newValue, oldValue) {\n\t\tthis.light.bakeNumSamples = math.clamp(Math.floor(newValue), 1, 255);\n\t});\n\t_defineProperty('bakeArea', 0, function (newValue, oldValue) {\n\t\tthis.light.bakeArea = math.clamp(newValue, 0, 180);\n\t});\n\t_defineProperty('cascadeDistribution', 0.5, function (newValue, oldValue) {\n\t\tthis.light.cascadeDistribution = math.clamp(newValue, 0, 1);\n\t});\n\t_defineProperty('normalOffsetBias', 0, function (newValue, oldValue) {\n\t\tthis.light.normalOffsetBias = math.clamp(newValue, 0, 1);\n\t});\n\t_defineProperty('range', 10, function (newValue, oldValue) {\n\t\tthis.light.attenuationEnd = newValue;\n\t});\n\t_defineProperty('innerConeAngle', 40, function (newValue, oldValue) {\n\t\tthis.light.innerConeAngle = newValue;\n\t});\n\t_defineProperty('outerConeAngle', 45, function (newValue, oldValue) {\n\t\tthis.light.outerConeAngle = newValue;\n\t});\n\t_defineProperty('falloffMode', LIGHTFALLOFF_LINEAR, function (newValue, oldValue) {\n\t\tthis.light.falloffMode = newValue;\n\t});\n\t_defineProperty('shadowType', SHADOW_PCF3, function (newValue, oldValue) {\n\t\tthis.light.shadowType = newValue;\n\t});\n\t_defineProperty('vsmBlurSize', 11, function (newValue, oldValue) {\n\t\tthis.light.vsmBlurSize = newValue;\n\t});\n\t_defineProperty('vsmBlurMode', BLUR_GAUSSIAN, function (newValue, oldValue) {\n\t\tthis.light.vsmBlurMode = newValue;\n\t});\n\t_defineProperty('vsmBias', 0.01 * 0.25, function (newValue, oldValue) {\n\t\tthis.light.vsmBias = math.clamp(newValue, 0, 1);\n\t});\n\t_defineProperty('cookieAsset', null, function (newValue, oldValue) {\n\t\tif (this._cookieAssetId && (newValue instanceof Asset && newValue.id === this._cookieAssetId || newValue === this._cookieAssetId)) return;\n\t\tthis.onCookieAssetRemove();\n\t\tthis._cookieAssetId = null;\n\t\tif (newValue instanceof Asset) {\n\t\t\tthis.data.cookieAsset = newValue.id;\n\t\t\tthis._cookieAssetId = newValue.id;\n\t\t\tthis.onCookieAssetAdd(newValue);\n\t\t} else if (typeof newValue === 'number') {\n\t\t\tthis._cookieAssetId = newValue;\n\t\t\tconst asset = this.system.app.assets.get(newValue);\n\t\t\tif (asset) {\n\t\t\t\tthis.onCookieAssetAdd(asset);\n\t\t\t} else {\n\t\t\t\tthis._cookieAssetAdd = true;\n\t\t\t\tthis.system.app.assets.on('add:' + this._cookieAssetId, this.onCookieAssetAdd, this);\n\t\t\t}\n\t\t}\n\t});\n\t_defineProperty('cookie', null, function (newValue, oldValue) {\n\t\tthis.light.cookie = newValue;\n\t});\n\t_defineProperty('cookieIntensity', 1, function (newValue, oldValue) {\n\t\tthis.light.cookieIntensity = math.clamp(newValue, 0, 1);\n\t});\n\t_defineProperty('cookieFalloff', true, function (newValue, oldValue) {\n\t\tthis.light.cookieFalloff = newValue;\n\t});\n\t_defineProperty('cookieChannel', 'rgb', function (newValue, oldValue) {\n\t\tthis.light.cookieChannel = newValue;\n\t});\n\t_defineProperty('cookieAngle', 0, function (newValue, oldValue) {\n\t\tif (newValue !== 0 || this.cookieScale !== null) {\n\t\t\tif (!this._cookieMatrix) this._cookieMatrix = new Vec4();\n\t\t\tlet scx = 1;\n\t\t\tlet scy = 1;\n\t\t\tif (this.cookieScale) {\n\t\t\t\tscx = this.cookieScale.x;\n\t\t\t\tscy = this.cookieScale.y;\n\t\t\t}\n\t\t\tconst c = Math.cos(newValue * math.DEG_TO_RAD);\n\t\t\tconst s = Math.sin(newValue * math.DEG_TO_RAD);\n\t\t\tthis._cookieMatrix.set(c / scx, -s / scx, s / scy, c / scy);\n\t\t\tthis.light.cookieTransform = this._cookieMatrix;\n\t\t} else {\n\t\t\tthis.light.cookieTransform = null;\n\t\t}\n\t});\n\t_defineProperty('cookieScale', null, function (newValue, oldValue) {\n\t\tif (newValue !== null || this.cookieAngle !== 0) {\n\t\t\tif (!this._cookieMatrix) this._cookieMatrix = new Vec4();\n\t\t\tconst scx = newValue.x;\n\t\t\tconst scy = newValue.y;\n\t\t\tconst c = Math.cos(this.cookieAngle * math.DEG_TO_RAD);\n\t\t\tconst s = Math.sin(this.cookieAngle * math.DEG_TO_RAD);\n\t\t\tthis._cookieMatrix.set(c / scx, -s / scx, s / scy, c / scy);\n\t\t\tthis.light.cookieTransform = this._cookieMatrix;\n\t\t} else {\n\t\t\tthis.light.cookieTransform = null;\n\t\t}\n\t}, true);\n\t_defineProperty('cookieOffset', null, function (newValue, oldValue) {\n\t\tthis.light.cookieOffset = newValue;\n\t}, true);\n\t_defineProperty('shadowUpdateMode', SHADOWUPDATE_REALTIME, function (newValue, oldValue) {\n\t\tthis.light.shadowUpdateMode = newValue;\n\t}, true);\n\t_defineProperty('mask', 1, function (newValue, oldValue) {\n\t\tthis.light.mask = newValue;\n\t});\n\t_defineProperty('affectDynamic', true, function (newValue, oldValue) {\n\t\tif (newValue) {\n\t\t\tthis.light.mask |= MASK_AFFECT_DYNAMIC;\n\t\t} else {\n\t\t\tthis.light.mask &= ~MASK_AFFECT_DYNAMIC;\n\t\t}\n\t\tthis.light.layersDirty();\n\t});\n\t_defineProperty('affectLightmapped', false, function (newValue, oldValue) {\n\t\tif (newValue) {\n\t\t\tthis.light.mask |= MASK_AFFECT_LIGHTMAPPED;\n\t\t\tif (this.bake) this.light.mask &= ~MASK_BAKE;\n\t\t} else {\n\t\t\tthis.light.mask &= ~MASK_AFFECT_LIGHTMAPPED;\n\t\t\tif (this.bake) this.light.mask |= MASK_BAKE;\n\t\t}\n\t});\n\t_defineProperty('bake', false, function (newValue, oldValue) {\n\t\tif (newValue) {\n\t\t\tthis.light.mask |= MASK_BAKE;\n\t\t\tif (this.affectLightmapped) this.light.mask &= ~MASK_AFFECT_LIGHTMAPPED;\n\t\t} else {\n\t\t\tthis.light.mask &= ~MASK_BAKE;\n\t\t\tif (this.affectLightmapped) this.light.mask |= MASK_AFFECT_LIGHTMAPPED;\n\t\t}\n\t\tthis.light.layersDirty();\n\t});\n\t_defineProperty('bakeDir', true, function (newValue, oldValue) {\n\t\tthis.light.bakeDir = newValue;\n\t});\n\t_defineProperty('isStatic', false, function (newValue, oldValue) {\n\t\tthis.light.isStatic = newValue;\n\t});\n\t_defineProperty('layers', [LAYERID_WORLD], function (newValue, oldValue) {\n\t\tfor (let i = 0; i < oldValue.length; i++) {\n\t\t\tconst layer = this.system.app.scene.layers.getLayerById(oldValue[i]);\n\t\t\tif (!layer) continue;\n\t\t\tlayer.removeLight(this);\n\t\t\tthis.light.removeLayer(layer);\n\t\t}\n\t\tfor (let i = 0; i < newValue.length; i++) {\n\t\t\tconst layer = this.system.app.scene.layers.getLayerById(newValue[i]);\n\t\t\tif (!layer) continue;\n\t\t\tif (this.enabled && this.entity.enabled) {\n\t\t\t\tlayer.addLight(this);\n\t\t\t\tthis.light.addLayer(layer);\n\t\t\t}\n\t\t}\n\t});\n\t_lightProps.push(\"penumbraSize\");\n\t_lightPropsDefault.push(1);\n}\n_defineProps();\n\nexport { LightComponent, _lightProps, _lightPropsDefault };\n","import { _lightProps, _lightPropsDefault } from './component.js';\n\nclass LightComponentData {\n\tconstructor() {\n\t\tconst _props = _lightProps;\n\t\tconst _propsDefault = _lightPropsDefault;\n\t\tfor (let i = 0; i < _props.length; i++) {\n\t\t\tconst value = _propsDefault[i];\n\t\t\tif (value && value.clone) {\n\t\t\t\tthis[_props[i]] = value.clone();\n\t\t\t} else {\n\t\t\t\tthis[_props[i]] = value;\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport { LightComponentData };\n","import { Color } from '../../../core/math/color.js';\nimport { Vec2 } from '../../../core/math/vec2.js';\nimport { LIGHTSHAPE_PUNCTUAL } from '../../../scene/constants.js';\nimport { Light, lightTypes } from '../../../scene/light.js';\nimport { ComponentSystem } from '../system.js';\nimport { LightComponent, _lightProps } from './component.js';\nimport { LightComponentData } from './data.js';\n\nclass LightComponentSystem extends ComponentSystem {\n\tconstructor(app) {\n\t\tsuper(app);\n\t\tthis.id = 'light';\n\t\tthis.ComponentType = LightComponent;\n\t\tthis.DataType = LightComponentData;\n\t\tthis.on('beforeremove', this._onRemoveComponent, this);\n\t}\n\tinitializeComponentData(component, _data) {\n\t\tconst properties = _lightProps;\n\t\tconst data = {};\n\t\tfor (let i = 0, len = properties.length; i < len; i++) {\n\t\t\tconst property = properties[i];\n\t\t\tdata[property] = _data[property];\n\t\t}\n\t\tif (!data.type) data.type = component.data.type;\n\t\tcomponent.data.type = data.type;\n\t\tif (data.layers && Array.isArray(data.layers)) {\n\t\t\tdata.layers = data.layers.slice(0);\n\t\t}\n\t\tif (data.color && Array.isArray(data.color)) data.color = new Color(data.color[0], data.color[1], data.color[2]);\n\t\tif (data.cookieOffset && data.cookieOffset instanceof Array) data.cookieOffset = new Vec2(data.cookieOffset[0], data.cookieOffset[1]);\n\t\tif (data.cookieScale && data.cookieScale instanceof Array) data.cookieScale = new Vec2(data.cookieScale[0], data.cookieScale[1]);\n\t\tif (data.enable) {\n\t\t\tconsole.warn('WARNING: enable: Property is deprecated. Set enabled property instead.');\n\t\t\tdata.enabled = data.enable;\n\t\t}\n\t\tif (!data.shape) {\n\t\t\tdata.shape = LIGHTSHAPE_PUNCTUAL;\n\t\t}\n\t\tconst light = new Light(this.app.graphicsDevice);\n\t\tlight.type = lightTypes[data.type];\n\t\tlight._node = component.entity;\n\t\tcomponent.data.light = light;\n\t\tsuper.initializeComponentData(component, data, properties);\n\t}\n\t_onRemoveComponent(entity, component) {\n\t\tcomponent.onRemove();\n\t}\n\tcloneComponent(entity, clone) {\n\t\tconst light = entity.light;\n\t\tconst data = [];\n\t\tlet name;\n\t\tconst _props = _lightProps;\n\t\tfor (let i = 0; i < _props.length; i++) {\n\t\t\tname = _props[i];\n\t\t\tif (name === 'light') continue;\n\t\t\tif (light[name] && light[name].clone) {\n\t\t\t\tdata[name] = light[name].clone();\n\t\t\t} else {\n\t\t\t\tdata[name] = light[name];\n\t\t\t}\n\t\t}\n\t\treturn this.addComponent(clone, data);\n\t}\n\tchangeType(component, oldValue, newValue) {\n\t\tif (oldValue !== newValue) {\n\t\t\tcomponent.light.type = lightTypes[newValue];\n\t\t}\n\t}\n}\n\nexport { LightComponentSystem };\n","import '../../core/tracing.js';\nimport { Color } from '../../core/math/color.js';\nimport { Curve } from '../../core/math/curve.js';\nimport { CurveSet } from '../../core/math/curve-set.js';\nimport { Vec2 } from '../../core/math/vec2.js';\nimport { Vec3 } from '../../core/math/vec3.js';\nimport { Vec4 } from '../../core/math/vec4.js';\nimport { GraphNode } from '../../scene/graph-node.js';\nimport { Asset } from '../asset/asset.js';\n\nconst components = ['x', 'y', 'z', 'w'];\nconst vecLookup = [undefined, undefined, Vec2, Vec3, Vec4];\nfunction rawToValue(app, args, value, old) {\n\tswitch (args.type) {\n\t\tcase 'boolean':\n\t\t\treturn !!value;\n\t\tcase 'number':\n\t\t\tif (typeof value === 'number') {\n\t\t\t\treturn value;\n\t\t\t} else if (typeof value === 'string') {\n\t\t\t\tconst v = parseInt(value, 10);\n\t\t\t\tif (isNaN(v)) return null;\n\t\t\t\treturn v;\n\t\t\t} else if (typeof value === 'boolean') {\n\t\t\t\treturn 0 + value;\n\t\t\t}\n\t\t\treturn null;\n\t\tcase 'json':\n\t\t\t{\n\t\t\t\tconst result = {};\n\t\t\t\tif (Array.isArray(args.schema)) {\n\t\t\t\t\tif (!value || typeof value !== 'object') {\n\t\t\t\t\t\tvalue = {};\n\t\t\t\t\t}\n\t\t\t\t\tfor (let i = 0; i < args.schema.length; i++) {\n\t\t\t\t\t\tconst field = args.schema[i];\n\t\t\t\t\t\tif (!field.name) continue;\n\t\t\t\t\t\tif (field.array) {\n\t\t\t\t\t\t\tresult[field.name] = [];\n\t\t\t\t\t\t\tconst arr = Array.isArray(value[field.name]) ? value[field.name] : [];\n\t\t\t\t\t\t\tfor (let j = 0; j < arr.length; j++) {\n\t\t\t\t\t\t\t\tresult[field.name].push(rawToValue(app, field, arr[j]));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst val = value.hasOwnProperty(field.name) ? value[field.name] : field.default;\n\t\t\t\t\t\t\tresult[field.name] = rawToValue(app, field, val);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t}\n\t\tcase 'asset':\n\t\t\tif (value instanceof Asset) {\n\t\t\t\treturn value;\n\t\t\t} else if (typeof value === 'number') {\n\t\t\t\treturn app.assets.get(value) || null;\n\t\t\t} else if (typeof value === 'string') {\n\t\t\t\treturn app.assets.get(parseInt(value, 10)) || null;\n\t\t\t}\n\t\t\treturn null;\n\t\tcase 'entity':\n\t\t\tif (value instanceof GraphNode) {\n\t\t\t\treturn value;\n\t\t\t} else if (typeof value === 'string') {\n\t\t\t\treturn app.getEntityFromIndex(value);\n\t\t\t}\n\t\t\treturn null;\n\t\tcase 'rgb':\n\t\tcase 'rgba':\n\t\t\tif (value instanceof Color) {\n\t\t\t\tif (old instanceof Color) {\n\t\t\t\t\told.copy(value);\n\t\t\t\t\treturn old;\n\t\t\t\t}\n\t\t\t\treturn value.clone();\n\t\t\t} else if (value instanceof Array && value.length >= 3 && value.length <= 4) {\n\t\t\t\tfor (let i = 0; i < value.length; i++) {\n\t\t\t\t\tif (typeof value[i] !== 'number') return null;\n\t\t\t\t}\n\t\t\t\tif (!old) old = new Color();\n\t\t\t\told.r = value[0];\n\t\t\t\told.g = value[1];\n\t\t\t\told.b = value[2];\n\t\t\t\told.a = value.length === 3 ? 1 : value[3];\n\t\t\t\treturn old;\n\t\t\t} else if (typeof value === 'string' && /#([0-9abcdef]{2}){3,4}/i.test(value)) {\n\t\t\t\tif (!old) old = new Color();\n\t\t\t\told.fromString(value);\n\t\t\t\treturn old;\n\t\t\t}\n\t\t\treturn null;\n\t\tcase 'vec2':\n\t\tcase 'vec3':\n\t\tcase 'vec4':\n\t\t\t{\n\t\t\t\tconst len = parseInt(args.type.slice(3), 10);\n\t\t\t\tconst vecType = vecLookup[len];\n\t\t\t\tif (value instanceof vecType) {\n\t\t\t\t\tif (old instanceof vecType) {\n\t\t\t\t\t\told.copy(value);\n\t\t\t\t\t\treturn old;\n\t\t\t\t\t}\n\t\t\t\t\treturn value.clone();\n\t\t\t\t} else if (value instanceof Array && value.length === len) {\n\t\t\t\t\tfor (let i = 0; i < value.length; i++) {\n\t\t\t\t\t\tif (typeof value[i] !== 'number') return null;\n\t\t\t\t\t}\n\t\t\t\t\tif (!old) old = new vecType();\n\t\t\t\t\tfor (let i = 0; i < len; i++) old[components[i]] = value[i];\n\t\t\t\t\treturn old;\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\tcase 'curve':\n\t\t\tif (value) {\n\t\t\t\tlet curve;\n\t\t\t\tif (value instanceof Curve || value instanceof CurveSet) {\n\t\t\t\t\tcurve = value.clone();\n\t\t\t\t} else {\n\t\t\t\t\tconst CurveType = value.keys[0] instanceof Array ? CurveSet : Curve;\n\t\t\t\t\tcurve = new CurveType(value.keys);\n\t\t\t\t\tcurve.type = value.type;\n\t\t\t\t}\n\t\t\t\treturn curve;\n\t\t\t}\n\t\t\tbreak;\n\t}\n\treturn value;\n}\nclass ScriptAttributes {\n\tconstructor(scriptType) {\n\t\tthis.scriptType = scriptType;\n\t\tthis.index = {};\n\t}\n\tadd(name, args) {\n\t\tif (this.index[name]) {\n\t\t\treturn;\n\t\t} else if (ScriptAttributes.reservedNames.has(name)) {\n\t\t\treturn;\n\t\t}\n\t\tthis.index[name] = args;\n\t\tObject.defineProperty(this.scriptType.prototype, name, {\n\t\t\tget: function () {\n\t\t\t\treturn this.__attributes[name];\n\t\t\t},\n\t\t\tset: function (raw) {\n\t\t\t\tconst evt = 'attr';\n\t\t\t\tconst evtName = 'attr:' + name;\n\t\t\t\tconst old = this.__attributes[name];\n\t\t\t\tlet oldCopy = old;\n\t\t\t\tif (old && args.type !== 'json' && args.type !== 'entity' && old.clone) {\n\t\t\t\t\tif (this.hasEvent(evt) || this.hasEvent(evtName)) {\n\t\t\t\t\t\toldCopy = old.clone();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (args.array) {\n\t\t\t\t\tthis.__attributes[name] = [];\n\t\t\t\t\tif (raw) {\n\t\t\t\t\t\tfor (let i = 0, len = raw.length; i < len; i++) {\n\t\t\t\t\t\t\tthis.__attributes[name].push(rawToValue(this.app, args, raw[i], old ? old[i] : null));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.__attributes[name] = rawToValue(this.app, args, raw, old);\n\t\t\t\t}\n\t\t\t\tthis.fire(evt, name, this.__attributes[name], oldCopy);\n\t\t\t\tthis.fire(evtName, this.__attributes[name], oldCopy);\n\t\t\t}\n\t\t});\n\t}\n\tremove(name) {\n\t\tif (!this.index[name]) return false;\n\t\tdelete this.index[name];\n\t\tdelete this.scriptType.prototype[name];\n\t\treturn true;\n\t}\n\thas(name) {\n\t\treturn !!this.index[name];\n\t}\n\tget(name) {\n\t\treturn this.index[name] || null;\n\t}\n}\nScriptAttributes.reservedNames = new Set(['app', 'entity', 'enabled', '_enabled', '_enabledOld', '_destroyed', '__attributes', '__attributesRaw', '__scriptType', '__executionOrder', '_callbacks', '_callbackActive', 'has', 'get', 'on', 'off', 'fire', 'once', 'hasEvent']);\n\nexport { ScriptAttributes };\n","const SCRIPT_INITIALIZE = 'initialize';\nconst SCRIPT_POST_INITIALIZE = 'postInitialize';\nconst SCRIPT_UPDATE = 'update';\nconst SCRIPT_POST_UPDATE = 'postUpdate';\nconst SCRIPT_SWAP = 'swap';\n\nexport { SCRIPT_INITIALIZE, SCRIPT_POST_INITIALIZE, SCRIPT_POST_UPDATE, SCRIPT_SWAP, SCRIPT_UPDATE };\n","import '../../../core/tracing.js';\nimport { SortedLoopArray } from '../../../core/sorted-loop-array.js';\nimport { ScriptAttributes } from '../../script/script-attributes.js';\nimport { SCRIPT_POST_INITIALIZE, SCRIPT_INITIALIZE, SCRIPT_UPDATE, SCRIPT_POST_UPDATE, SCRIPT_SWAP } from '../../script/constants.js';\nimport { Component } from '../component.js';\nimport { Entity } from '../../entity.js';\n\nclass ScriptComponent extends Component {\n\tconstructor(system, entity) {\n\t\tsuper(system, entity);\n\t\tthis._scripts = [];\n\t\tthis._updateList = new SortedLoopArray({\n\t\t\tsortBy: '__executionOrder'\n\t\t});\n\t\tthis._postUpdateList = new SortedLoopArray({\n\t\t\tsortBy: '__executionOrder'\n\t\t});\n\t\tthis._scriptsIndex = {};\n\t\tthis._destroyedScripts = [];\n\t\tthis._destroyed = false;\n\t\tthis._scriptsData = null;\n\t\tthis._oldState = true;\n\t\tthis._enabled = true;\n\t\tthis._beingEnabled = false;\n\t\tthis._isLoopingThroughScripts = false;\n\t\tthis._executionOrder = -1;\n\t\tthis.on('set_enabled', this._onSetEnabled, this);\n\t}\n\tset scripts(value) {\n\t\tthis._scriptsData = value;\n\t\tfor (const key in value) {\n\t\t\tif (!value.hasOwnProperty(key)) continue;\n\t\t\tconst script = this._scriptsIndex[key];\n\t\t\tif (script) {\n\t\t\t\tif (typeof value[key].enabled === 'boolean') script.enabled = !!value[key].enabled;\n\t\t\t\tif (typeof value[key].attributes === 'object') {\n\t\t\t\t\tfor (const attr in value[key].attributes) {\n\t\t\t\t\t\tif (ScriptAttributes.reservedNames.has(attr)) continue;\n\t\t\t\t\t\tif (!script.__attributes.hasOwnProperty(attr)) {\n\t\t\t\t\t\t\tconst scriptType = this.system.app.scripts.get(key);\n\t\t\t\t\t\t\tif (scriptType) scriptType.attributes.add(attr, {});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tscript[attr] = value[key].attributes[attr];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.log(this.order);\n\t\t\t}\n\t\t}\n\t}\n\tget scripts() {\n\t\treturn this._scripts;\n\t}\n\tset enabled(value) {\n\t\tconst oldValue = this._enabled;\n\t\tthis._enabled = value;\n\t\tthis.fire('set', 'enabled', oldValue, value);\n\t}\n\tget enabled() {\n\t\treturn this._enabled;\n\t}\n\tonEnable() {\n\t\tthis._beingEnabled = true;\n\t\tthis._checkState();\n\t\tif (!this.entity._beingEnabled) {\n\t\t\tthis.onPostStateChange();\n\t\t}\n\t\tthis._beingEnabled = false;\n\t}\n\tonDisable() {\n\t\tthis._checkState();\n\t}\n\tonPostStateChange() {\n\t\tconst wasLooping = this._beginLooping();\n\t\tfor (let i = 0, len = this.scripts.length; i < len; i++) {\n\t\t\tconst script = this.scripts[i];\n\t\t\tif (script._initialized && !script._postInitialized && script.enabled) {\n\t\t\t\tscript._postInitialized = true;\n\t\t\t\tif (script.postInitialize) this._scriptMethod(script, SCRIPT_POST_INITIALIZE);\n\t\t\t}\n\t\t}\n\t\tthis._endLooping(wasLooping);\n\t}\n\t_beginLooping() {\n\t\tconst looping = this._isLoopingThroughScripts;\n\t\tthis._isLoopingThroughScripts = true;\n\t\treturn looping;\n\t}\n\t_endLooping(wasLoopingBefore) {\n\t\tthis._isLoopingThroughScripts = wasLoopingBefore;\n\t\tif (!this._isLoopingThroughScripts) {\n\t\t\tthis._removeDestroyedScripts();\n\t\t}\n\t}\n\t_onSetEnabled(prop, old, value) {\n\t\tthis._beingEnabled = true;\n\t\tthis._checkState();\n\t\tthis._beingEnabled = false;\n\t}\n\t_checkState() {\n\t\tconst state = this.enabled && this.entity.enabled;\n\t\tif (state === this._oldState) return;\n\t\tthis._oldState = state;\n\t\tthis.fire(state ? 'enable' : 'disable');\n\t\tthis.fire('state', state);\n\t\tif (state) {\n\t\t\tthis.system._addComponentToEnabled(this);\n\t\t} else {\n\t\t\tthis.system._removeComponentFromEnabled(this);\n\t\t}\n\t\tconst wasLooping = this._beginLooping();\n\t\tfor (let i = 0, len = this.scripts.length; i < len; i++) {\n\t\t\tconst script = this.scripts[i];\n\t\t\tscript.enabled = script._enabled;\n\t\t}\n\t\tthis._endLooping(wasLooping);\n\t}\n\t_onBeforeRemove() {\n\t\tthis.fire('remove');\n\t\tconst wasLooping = this._beginLooping();\n\t\tfor (let i = 0; i < this.scripts.length; i++) {\n\t\t\tconst script = this.scripts[i];\n\t\t\tif (!script) continue;\n\t\t\tthis.destroy(script.__scriptType.__name);\n\t\t}\n\t\tthis._endLooping(wasLooping);\n\t}\n\t_removeDestroyedScripts() {\n\t\tconst len = this._destroyedScripts.length;\n\t\tif (!len) return;\n\t\tfor (let i = 0; i < len; i++) {\n\t\t\tconst script = this._destroyedScripts[i];\n\t\t\tthis._removeScriptInstance(script);\n\t\t}\n\t\tthis._destroyedScripts.length = 0;\n\t\tthis._resetExecutionOrder(0, this._scripts.length);\n\t}\n\t_onInitializeAttributes() {\n\t\tfor (let i = 0, len = this.scripts.length; i < len; i++) this.scripts[i].__initializeAttributes();\n\t}\n\t_scriptMethod(script, method, arg) {\n\t\tscript[method](arg);\n\t}\n\t_onInitialize() {\n\t\tconst scripts = this._scripts;\n\t\tconst wasLooping = this._beginLooping();\n\t\tfor (let i = 0, len = scripts.length; i < len; i++) {\n\t\t\tconst script = scripts[i];\n\t\t\tif (!script._initialized && script.enabled) {\n\t\t\t\tscript._initialized = true;\n\t\t\t\tif (script.initialize) this._scriptMethod(script, SCRIPT_INITIALIZE);\n\t\t\t}\n\t\t}\n\t\tthis._endLooping(wasLooping);\n\t}\n\t_onPostInitialize() {\n\t\tthis.onPostStateChange();\n\t}\n\t_onUpdate(dt) {\n\t\tconst list = this._updateList;\n\t\tif (!list.length) return;\n\t\tconst wasLooping = this._beginLooping();\n\t\tfor (list.loopIndex = 0; list.loopIndex < list.length; list.loopIndex++) {\n\t\t\tconst script = list.items[list.loopIndex];\n\t\t\tif (script.enabled) {\n\t\t\t\tthis._scriptMethod(script, SCRIPT_UPDATE, dt);\n\t\t\t}\n\t\t}\n\t\tthis._endLooping(wasLooping);\n\t}\n\t_onPostUpdate(dt) {\n\t\tconst list = this._postUpdateList;\n\t\tif (!list.length) return;\n\t\tconst wasLooping = this._beginLooping();\n\t\tfor (list.loopIndex = 0; list.loopIndex < list.length; list.loopIndex++) {\n\t\t\tconst script = list.items[list.loopIndex];\n\t\t\tif (script.enabled) {\n\t\t\t\tthis._scriptMethod(script, SCRIPT_POST_UPDATE, dt);\n\t\t\t}\n\t\t}\n\t\tthis._endLooping(wasLooping);\n\t}\n\t_insertScriptInstance(scriptInstance, index, scriptsLength) {\n\t\tif (index === -1) {\n\t\t\tthis._scripts.push(scriptInstance);\n\t\t\tscriptInstance.__executionOrder = scriptsLength;\n\t\t\tif (scriptInstance.update) {\n\t\t\t\tthis._updateList.append(scriptInstance);\n\t\t\t}\n\t\t\tif (scriptInstance.postUpdate) {\n\t\t\t\tthis._postUpdateList.append(scriptInstance);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._scripts.splice(index, 0, scriptInstance);\n\t\t\tscriptInstance.__executionOrder = index;\n\t\t\tthis._resetExecutionOrder(index + 1, scriptsLength + 1);\n\t\t\tif (scriptInstance.update) {\n\t\t\t\tthis._updateList.insert(scriptInstance);\n\t\t\t}\n\t\t\tif (scriptInstance.postUpdate) {\n\t\t\t\tthis._postUpdateList.insert(scriptInstance);\n\t\t\t}\n\t\t}\n\t}\n\t_removeScriptInstance(scriptInstance) {\n\t\tconst idx = this._scripts.indexOf(scriptInstance);\n\t\tif (idx === -1) return idx;\n\t\tthis._scripts.splice(idx, 1);\n\t\tif (scriptInstance.update) {\n\t\t\tthis._updateList.remove(scriptInstance);\n\t\t}\n\t\tif (scriptInstance.postUpdate) {\n\t\t\tthis._postUpdateList.remove(scriptInstance);\n\t\t}\n\t\treturn idx;\n\t}\n\t_resetExecutionOrder(startIndex, scriptsLength) {\n\t\tfor (let i = startIndex; i < scriptsLength; i++) {\n\t\t\tthis._scripts[i].__executionOrder = i;\n\t\t}\n\t}\n\t_resolveEntityScriptAttribute(attribute, attributeName, oldValue, useGuid, newAttributes, duplicatedIdsMap) {\n\t\tif (attribute.array) {\n\t\t\tconst len = oldValue.length;\n\t\t\tif (!len) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst newGuidArray = oldValue.slice();\n\t\t\tfor (let i = 0; i < len; i++) {\n\t\t\t\tconst guid = newGuidArray[i] instanceof Entity ? newGuidArray[i].getGuid() : newGuidArray[i];\n\t\t\t\tif (duplicatedIdsMap[guid]) {\n\t\t\t\t\tnewGuidArray[i] = useGuid ? duplicatedIdsMap[guid].getGuid() : duplicatedIdsMap[guid];\n\t\t\t\t}\n\t\t\t}\n\t\t\tnewAttributes[attributeName] = newGuidArray;\n\t\t} else {\n\t\t\tif (oldValue instanceof Entity) {\n\t\t\t\toldValue = oldValue.getGuid();\n\t\t\t} else if (typeof oldValue !== 'string') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (duplicatedIdsMap[oldValue]) {\n\t\t\t\tnewAttributes[attributeName] = duplicatedIdsMap[oldValue];\n\t\t\t}\n\t\t}\n\t}\n\thas(nameOrType) {\n\t\tif (typeof nameOrType === 'string') {\n\t\t\treturn !!this._scriptsIndex[nameOrType];\n\t\t}\n\t\tif (!nameOrType) return false;\n\t\tconst scriptType = nameOrType;\n\t\tconst scriptName = scriptType.__name;\n\t\tconst scriptData = this._scriptsIndex[scriptName];\n\t\tconst scriptInstance = scriptData && scriptData.instance;\n\t\treturn scriptInstance instanceof scriptType;\n\t}\n\tget(nameOrType) {\n\t\tif (typeof nameOrType === 'string') {\n\t\t\tconst data = this._scriptsIndex[nameOrType];\n\t\t\treturn data ? data.instance : null;\n\t\t}\n\t\tif (!nameOrType) return null;\n\t\tconst scriptType = nameOrType;\n\t\tconst scriptName = scriptType.__name;\n\t\tconst scriptData = this._scriptsIndex[scriptName];\n\t\tconst scriptInstance = scriptData && scriptData.instance;\n\t\treturn scriptInstance instanceof scriptType ? scriptInstance : null;\n\t}\n\tcreate(nameOrType, args = {}) {\n\t\tconst self = this;\n\t\tlet scriptType = nameOrType;\n\t\tlet scriptName = nameOrType;\n\t\tif (typeof scriptType === 'string') {\n\t\t\tscriptType = this.system.app.scripts.get(scriptType);\n\t\t} else if (scriptType) {\n\t\t\tscriptName = scriptType.__name;\n\t\t}\n\t\tif (scriptType) {\n\t\t\tif (!this._scriptsIndex[scriptName] || !this._scriptsIndex[scriptName].instance) {\n\t\t\t\tconst scriptInstance = new scriptType({\n\t\t\t\t\tapp: this.system.app,\n\t\t\t\t\tentity: this.entity,\n\t\t\t\t\tenabled: args.hasOwnProperty('enabled') ? args.enabled : true,\n\t\t\t\t\tattributes: args.attributes\n\t\t\t\t});\n\t\t\t\tconst len = this._scripts.length;\n\t\t\t\tlet ind = -1;\n\t\t\t\tif (typeof args.ind === 'number' && args.ind !== -1 && len > args.ind) ind = args.ind;\n\t\t\t\tthis._insertScriptInstance(scriptInstance, ind, len);\n\t\t\t\tthis._scriptsIndex[scriptName] = {\n\t\t\t\t\tinstance: scriptInstance,\n\t\t\t\t\tonSwap: function () {\n\t\t\t\t\t\tself.swap(scriptName);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tthis[scriptName] = scriptInstance;\n\t\t\t\tif (!args.preloading) scriptInstance.__initializeAttributes();\n\t\t\t\tthis.fire('create', scriptName, scriptInstance);\n\t\t\t\tthis.fire('create:' + scriptName, scriptInstance);\n\t\t\t\tthis.system.app.scripts.on('swap:' + scriptName, this._scriptsIndex[scriptName].onSwap);\n\t\t\t\tif (!args.preloading) {\n\t\t\t\t\tif (scriptInstance.enabled && !scriptInstance._initialized) {\n\t\t\t\t\t\tscriptInstance._initialized = true;\n\t\t\t\t\t\tif (scriptInstance.initialize) this._scriptMethod(scriptInstance, SCRIPT_INITIALIZE);\n\t\t\t\t\t}\n\t\t\t\t\tif (scriptInstance.enabled && !scriptInstance._postInitialized) {\n\t\t\t\t\t\tscriptInstance._postInitialized = true;\n\t\t\t\t\t\tif (scriptInstance.postInitialize) this._scriptMethod(scriptInstance, SCRIPT_POST_INITIALIZE);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn scriptInstance;\n\t\t\t}\n\t\t} else {\n\t\t\tthis._scriptsIndex[scriptName] = {\n\t\t\t\tawaiting: true,\n\t\t\t\tind: this._scripts.length\n\t\t\t};\n\t\t}\n\t\treturn null;\n\t}\n\tdestroy(nameOrType) {\n\t\tlet scriptName = nameOrType;\n\t\tlet scriptType = nameOrType;\n\t\tif (typeof scriptType === 'string') {\n\t\t\tscriptType = this.system.app.scripts.get(scriptType);\n\t\t} else if (scriptType) {\n\t\t\tscriptName = scriptType.__name;\n\t\t}\n\t\tconst scriptData = this._scriptsIndex[scriptName];\n\t\tdelete this._scriptsIndex[scriptName];\n\t\tif (!scriptData) return false;\n\t\tconst scriptInstance = scriptData.instance;\n\t\tif (scriptInstance && !scriptInstance._destroyed) {\n\t\t\tscriptInstance.enabled = false;\n\t\t\tscriptInstance._destroyed = true;\n\t\t\tif (!this._isLoopingThroughScripts) {\n\t\t\t\tconst ind = this._removeScriptInstance(scriptInstance);\n\t\t\t\tif (ind >= 0) {\n\t\t\t\t\tthis._resetExecutionOrder(ind, this._scripts.length);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._destroyedScripts.push(scriptInstance);\n\t\t\t}\n\t\t}\n\t\tthis.system.app.scripts.off('swap:' + scriptName, scriptData.onSwap);\n\t\tdelete this[scriptName];\n\t\tthis.fire('destroy', scriptName, scriptInstance || null);\n\t\tthis.fire('destroy:' + scriptName, scriptInstance || null);\n\t\tif (scriptInstance) scriptInstance.fire('destroy');\n\t\treturn true;\n\t}\n\tswap(nameOrType) {\n\t\tlet scriptName = nameOrType;\n\t\tlet scriptType = nameOrType;\n\t\tif (typeof scriptType === 'string') {\n\t\t\tscriptType = this.system.app.scripts.get(scriptType);\n\t\t} else if (scriptType) {\n\t\t\tscriptName = scriptType.__name;\n\t\t}\n\t\tconst old = this._scriptsIndex[scriptName];\n\t\tif (!old || !old.instance) return false;\n\t\tconst scriptInstanceOld = old.instance;\n\t\tconst ind = this._scripts.indexOf(scriptInstanceOld);\n\t\tconst scriptInstance = new scriptType({\n\t\t\tapp: this.system.app,\n\t\t\tentity: this.entity,\n\t\t\tenabled: scriptInstanceOld.enabled,\n\t\t\tattributes: scriptInstanceOld.__attributes\n\t\t});\n\t\tif (!scriptInstance.swap) return false;\n\t\tscriptInstance.__initializeAttributes();\n\t\tthis._scripts[ind] = scriptInstance;\n\t\tthis._scriptsIndex[scriptName].instance = scriptInstance;\n\t\tthis[scriptName] = scriptInstance;\n\t\tscriptInstance.__executionOrder = ind;\n\t\tif (scriptInstanceOld.update) {\n\t\t\tthis._updateList.remove(scriptInstanceOld);\n\t\t}\n\t\tif (scriptInstanceOld.postUpdate) {\n\t\t\tthis._postUpdateList.remove(scriptInstanceOld);\n\t\t}\n\t\tif (scriptInstance.update) {\n\t\t\tthis._updateList.insert(scriptInstance);\n\t\t}\n\t\tif (scriptInstance.postUpdate) {\n\t\t\tthis._postUpdateList.insert(scriptInstance);\n\t\t}\n\t\tthis._scriptMethod(scriptInstance, SCRIPT_SWAP, scriptInstanceOld);\n\t\tthis.fire('swap', scriptName, scriptInstance);\n\t\tthis.fire('swap:' + scriptName, scriptInstance);\n\t\treturn true;\n\t}\n\tresolveDuplicatedEntityReferenceProperties(oldScriptComponent, duplicatedIdsMap) {\n\t\tconst newScriptComponent = this.entity.script;\n\t\tfor (const scriptName in oldScriptComponent._scriptsIndex) {\n\t\t\tconst scriptType = this.system.app.scripts.get(scriptName);\n\t\t\tif (!scriptType) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst script = oldScriptComponent._scriptsIndex[scriptName];\n\t\t\tif (!script || !script.instance) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst newAttributesRaw = newScriptComponent[scriptName].__attributesRaw;\n\t\t\tconst newAttributes = newScriptComponent[scriptName].__attributes;\n\t\t\tif (!newAttributesRaw && !newAttributes) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst useGuid = !!newAttributesRaw;\n\t\t\tconst oldAttributes = script.instance.__attributes;\n\t\t\tfor (const attributeName in oldAttributes) {\n\t\t\t\tif (!oldAttributes[attributeName]) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst attribute = scriptType.attributes.get(attributeName);\n\t\t\t\tif (!attribute) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (attribute.type === 'entity') {\n\t\t\t\t\tthis._resolveEntityScriptAttribute(attribute, attributeName, oldAttributes[attributeName], useGuid, newAttributesRaw || newAttributes, duplicatedIdsMap);\n\t\t\t\t} else if (attribute.type === 'json' && Array.isArray(attribute.schema)) {\n\t\t\t\t\tconst oldValue = oldAttributes[attributeName];\n\t\t\t\t\tconst newJsonValue = newAttributesRaw ? newAttributesRaw[attributeName] : newAttributes[attributeName];\n\t\t\t\t\tfor (let i = 0; i < attribute.schema.length; i++) {\n\t\t\t\t\t\tconst field = attribute.schema[i];\n\t\t\t\t\t\tif (field.type !== 'entity') {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (attribute.array) {\n\t\t\t\t\t\t\tfor (let j = 0; j < oldValue.length; j++) {\n\t\t\t\t\t\t\t\tthis._resolveEntityScriptAttribute(field, field.name, oldValue[j][field.name], useGuid, newJsonValue[j], duplicatedIdsMap);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis._resolveEntityScriptAttribute(field, field.name, oldValue[field.name], useGuid, newJsonValue, duplicatedIdsMap);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tmove(nameOrType, ind) {\n\t\tconst len = this._scripts.length;\n\t\tif (ind >= len || ind < 0) return false;\n\t\tlet scriptType = nameOrType;\n\t\tlet scriptName = nameOrType;\n\t\tif (typeof scriptName !== 'string') {\n\t\t\tscriptName = nameOrType.__name;\n\t\t} else {\n\t\t\tscriptType = null;\n\t\t}\n\t\tconst scriptData = this._scriptsIndex[scriptName];\n\t\tif (!scriptData || !scriptData.instance) return false;\n\t\tconst scriptInstance = scriptData.instance;\n\t\tif (scriptType && !(scriptInstance instanceof scriptType)) return false;\n\t\tconst indOld = this._scripts.indexOf(scriptInstance);\n\t\tif (indOld === -1 || indOld === ind) return false;\n\t\tthis._scripts.splice(ind, 0, this._scripts.splice(indOld, 1)[0]);\n\t\tthis._resetExecutionOrder(0, len);\n\t\tthis._updateList.sort();\n\t\tthis._postUpdateList.sort();\n\t\tthis.fire('move', scriptName, scriptInstance, ind, indOld);\n\t\tthis.fire('move:' + scriptName, scriptInstance, ind, indOld);\n\t\treturn true;\n\t}\n}\n\nexport { ScriptComponent };\n","class ScriptComponentData {\n\tconstructor() {\n\t\tthis.enabled = true;\n\t}\n}\n\nexport { ScriptComponentData };\n","import { SortedLoopArray } from '../../../core/sorted-loop-array.js';\nimport { ComponentSystem } from '../system.js';\nimport { ScriptComponent } from './component.js';\nimport { ScriptComponentData } from './data.js';\n\nconst METHOD_INITIALIZE_ATTRIBUTES = '_onInitializeAttributes';\nconst METHOD_INITIALIZE = '_onInitialize';\nconst METHOD_POST_INITIALIZE = '_onPostInitialize';\nconst METHOD_UPDATE = '_onUpdate';\nconst METHOD_POST_UPDATE = '_onPostUpdate';\nlet executionOrderCounter = 0;\nclass ScriptComponentSystem extends ComponentSystem {\n\tconstructor(app) {\n\t\tsuper(app);\n\t\tthis.id = 'script';\n\t\tthis.ComponentType = ScriptComponent;\n\t\tthis.DataType = ScriptComponentData;\n\t\tthis._components = new SortedLoopArray({\n\t\t\tsortBy: '_executionOrder'\n\t\t});\n\t\tthis._enabledComponents = new SortedLoopArray({\n\t\t\tsortBy: '_executionOrder'\n\t\t});\n\t\tthis.preloading = true;\n\t\tthis.on('beforeremove', this._onBeforeRemove, this);\n\t\tthis.app.systems.on('initialize', this._onInitialize, this);\n\t\tthis.app.systems.on('postInitialize', this._onPostInitialize, this);\n\t\tthis.app.systems.on('update', this._onUpdate, this);\n\t\tthis.app.systems.on('postUpdate', this._onPostUpdate, this);\n\t}\n\tinitializeComponentData(component, data) {\n\t\tcomponent._executionOrder = executionOrderCounter++;\n\t\tthis._components.append(component);\n\t\tif (executionOrderCounter > Number.MAX_SAFE_INTEGER) {\n\t\t\tthis._resetExecutionOrder();\n\t\t}\n\t\tcomponent.enabled = data.hasOwnProperty('enabled') ? !!data.enabled : true;\n\t\tif (component.enabled && component.entity.enabled) {\n\t\t\tthis._enabledComponents.append(component);\n\t\t}\n\t\tif (data.hasOwnProperty('order') && data.hasOwnProperty('scripts')) {\n\t\t\tcomponent._scriptsData = data.scripts;\n\t\t\tfor (let i = 0; i < data.order.length; i++) {\n\t\t\t\tcomponent.create(data.order[i], {\n\t\t\t\t\tenabled: data.scripts[data.order[i]].enabled,\n\t\t\t\t\tattributes: data.scripts[data.order[i]].attributes,\n\t\t\t\t\tpreloading: this.preloading\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\tcloneComponent(entity, clone) {\n\t\tconst order = [];\n\t\tconst scripts = {};\n\t\tfor (let i = 0; i < entity.script._scripts.length; i++) {\n\t\t\tconst scriptInstance = entity.script._scripts[i];\n\t\t\tconst scriptName = scriptInstance.__scriptType.__name;\n\t\t\torder.push(scriptName);\n\t\t\tconst attributes = {};\n\t\t\tfor (const key in scriptInstance.__attributes) attributes[key] = scriptInstance.__attributes[key];\n\t\t\tscripts[scriptName] = {\n\t\t\t\tenabled: scriptInstance._enabled,\n\t\t\t\tattributes: attributes\n\t\t\t};\n\t\t}\n\t\tfor (const key in entity.script._scriptsIndex) {\n\t\t\tif (key.awaiting) {\n\t\t\t\torder.splice(key.ind, 0, key);\n\t\t\t}\n\t\t}\n\t\tconst data = {\n\t\t\tenabled: entity.script.enabled,\n\t\t\torder: order,\n\t\t\tscripts: scripts\n\t\t};\n\t\treturn this.addComponent(clone, data);\n\t}\n\t_resetExecutionOrder() {\n\t\texecutionOrderCounter = 0;\n\t\tfor (let i = 0, len = this._components.length; i < len; i++) {\n\t\t\tthis._components.items[i]._executionOrder = executionOrderCounter++;\n\t\t}\n\t}\n\t_callComponentMethod(components, name, dt) {\n\t\tfor (components.loopIndex = 0; components.loopIndex < components.length; components.loopIndex++) {\n\t\t\tcomponents.items[components.loopIndex][name](dt);\n\t\t}\n\t}\n\t_onInitialize() {\n\t\tthis.preloading = false;\n\t\tthis._callComponentMethod(this._components, METHOD_INITIALIZE_ATTRIBUTES);\n\t\tthis._callComponentMethod(this._enabledComponents, METHOD_INITIALIZE);\n\t}\n\t_onPostInitialize() {\n\t\tthis._callComponentMethod(this._enabledComponents, METHOD_POST_INITIALIZE);\n\t}\n\t_onUpdate(dt) {\n\t\tthis._callComponentMethod(this._enabledComponents, METHOD_UPDATE, dt);\n\t}\n\t_onPostUpdate(dt) {\n\t\tthis._callComponentMethod(this._enabledComponents, METHOD_POST_UPDATE, dt);\n\t}\n\t_addComponentToEnabled(component) {\n\t\tthis._enabledComponents.insert(component);\n\t}\n\t_removeComponentFromEnabled(component) {\n\t\tthis._enabledComponents.remove(component);\n\t}\n\t_onBeforeRemove(entity, component) {\n\t\tconst ind = this._components.items.indexOf(component);\n\t\tif (ind >= 0) {\n\t\t\tcomponent._onBeforeRemove();\n\t\t}\n\t\tthis._removeComponentFromEnabled(component);\n\t\tthis._components.remove(component);\n\t}\n\tdestroy() {\n\t\tsuper.destroy();\n\t\tthis.app.systems.off('initialize', this._onInitialize, this);\n\t\tthis.app.systems.off('postInitialize', this._onPostInitialize, this);\n\t\tthis.app.systems.off('update', this._onUpdate, this);\n\t\tthis.app.systems.off('postUpdate', this._onPostUpdate, this);\n\t}\n}\n\nexport { ScriptComponentSystem };\n","import { EventHandler } from '../core/event-handler.js';\n\nclass Render extends EventHandler {\n\tconstructor() {\n\t\tsuper();\n\t\tthis._meshes = null;\n\t}\n\tset meshes(value) {\n\t\tthis.decRefMeshes();\n\t\tthis._meshes = value;\n\t\tthis.incRefMeshes();\n\t\tthis.fire('set:meshes', value);\n\t}\n\tget meshes() {\n\t\treturn this._meshes;\n\t}\n\tdestroy() {\n\t\tthis.meshes = null;\n\t}\n\tdecRefMeshes() {\n\t\tif (this._meshes) {\n\t\t\tconst count = this._meshes.length;\n\t\t\tfor (let i = 0; i < count; i++) {\n\t\t\t\tconst mesh = this._meshes[i];\n\t\t\t\tif (mesh) {\n\t\t\t\t\tmesh.decRefCount();\n\t\t\t\t\tif (mesh.refCount < 1) {\n\t\t\t\t\t\tmesh.destroy();\n\t\t\t\t\t\tthis._meshes[i] = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tincRefMeshes() {\n\t\tif (this._meshes) {\n\t\t\tconst count = this._meshes.length;\n\t\t\tfor (let i = 0; i < count; i++) {\n\t\t\t\tif (this._meshes[i]) {\n\t\t\t\t\tthis._meshes[i].incRefCount();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport { Render };\n","import { Render } from '../../scene/render.js';\n\nfunction onContainerAssetLoaded(containerAsset) {\n\tconst renderAsset = this;\n\tif (!renderAsset.resource) return;\n\tconst containerResource = containerAsset.resource;\n\tconst render = containerResource.renders && containerResource.renders[renderAsset.data.renderIndex];\n\tif (render) {\n\t\trenderAsset.resource.meshes = render.resource.meshes;\n\t}\n}\nfunction onContainerAssetAdded(containerAsset) {\n\tconst renderAsset = this;\n\trenderAsset.registry.off('load:' + containerAsset.id, onContainerAssetLoaded, renderAsset);\n\trenderAsset.registry.on('load:' + containerAsset.id, onContainerAssetLoaded, renderAsset);\n\trenderAsset.registry.off('remove:' + containerAsset.id, onContainerAssetRemoved, renderAsset);\n\trenderAsset.registry.once('remove:' + containerAsset.id, onContainerAssetRemoved, renderAsset);\n\tif (!containerAsset.resource) {\n\t\trenderAsset.registry.load(containerAsset);\n\t} else {\n\t\tonContainerAssetLoaded.call(renderAsset, containerAsset);\n\t}\n}\nfunction onContainerAssetRemoved(containerAsset) {\n\tconst renderAsset = this;\n\trenderAsset.registry.off('load:' + containerAsset.id, onContainerAssetLoaded, renderAsset);\n\tif (renderAsset.resource) {\n\t\trenderAsset.resource.destroy();\n\t}\n}\nclass RenderHandler {\n\tconstructor(app) {\n\t\tthis.handlerType = \"render\";\n\t\tthis._registry = app.assets;\n\t}\n\tload(url, callback, asset) {}\n\topen(url, data) {\n\t\treturn new Render();\n\t}\n\tpatch(asset, registry) {\n\t\tif (!asset.data.containerAsset) return;\n\t\tconst containerAsset = registry.get(asset.data.containerAsset);\n\t\tif (!containerAsset) {\n\t\t\tregistry.once('add:' + asset.data.containerAsset, onContainerAssetAdded, asset);\n\t\t\treturn;\n\t\t}\n\t\tonContainerAssetAdded.call(asset, containerAsset);\n\t}\n}\n\nexport { RenderHandler };\n","class AnimCurve {\n\tconstructor(paths, input, output, interpolation) {\n\t\tthis._paths = paths;\n\t\tthis._input = input;\n\t\tthis._output = output;\n\t\tthis._interpolation = interpolation;\n\t}\n\tget paths() {\n\t\treturn this._paths;\n\t}\n\tget input() {\n\t\treturn this._input;\n\t}\n\tget output() {\n\t\treturn this._output;\n\t}\n\tget interpolation() {\n\t\treturn this._interpolation;\n\t}\n}\n\nexport { AnimCurve };\n","class AnimData {\n\tconstructor(components, data) {\n\t\tthis._components = components;\n\t\tthis._data = data;\n\t}\n\tget components() {\n\t\treturn this._components;\n\t}\n\tget data() {\n\t\treturn this._data;\n\t}\n}\n\nexport { AnimData };\n","function DracoWorker(jsUrl, wasmUrl) {\n\tlet draco;\n\tconst POSITION_ATTRIBUTE = 0;\n\tconst NORMAL_ATTRIBUTE = 1;\n\tconst wrap = (typedArray, dataType) => {\n\t\tswitch (dataType) {\n\t\t\tcase draco.DT_INT8:\n\t\t\t\treturn new Int8Array(typedArray.buffer, typedArray.byteOffset, typedArray.byteLength);\n\t\t\tcase draco.DT_INT16:\n\t\t\t\treturn new Int16Array(typedArray.buffer, typedArray.byteOffset, typedArray.byteLength / 2);\n\t\t\tcase draco.DT_INT32:\n\t\t\t\treturn new Int32Array(typedArray.buffer, typedArray.byteOffset, typedArray.byteLength / 4);\n\t\t\tcase draco.DT_UINT8:\n\t\t\t\treturn new Uint8Array(typedArray.buffer, typedArray.byteOffset, typedArray.byteLength);\n\t\t\tcase draco.DT_UINT16:\n\t\t\t\treturn new Uint16Array(typedArray.buffer, typedArray.byteOffset, typedArray.byteLength / 2);\n\t\t\tcase draco.DT_UINT32:\n\t\t\t\treturn new Uint32Array(typedArray.buffer, typedArray.byteOffset, typedArray.byteLength / 4);\n\t\t\tcase draco.DT_FLOAT32:\n\t\t\t\treturn new Float32Array(typedArray.buffer, typedArray.byteOffset, typedArray.byteLength / 4);\n\t\t}\n\t\treturn null;\n\t};\n\tconst componentSizeInBytes = dataType => {\n\t\tswitch (dataType) {\n\t\t\tcase draco.DT_INT8:\n\t\t\t\treturn 1;\n\t\t\tcase draco.DT_INT16:\n\t\t\t\treturn 2;\n\t\t\tcase draco.DT_INT32:\n\t\t\t\treturn 4;\n\t\t\tcase draco.DT_UINT8:\n\t\t\t\treturn 1;\n\t\t\tcase draco.DT_UINT16:\n\t\t\t\treturn 2;\n\t\t\tcase draco.DT_UINT32:\n\t\t\t\treturn 4;\n\t\t\tcase draco.DT_FLOAT32:\n\t\t\t\treturn 4;\n\t\t}\n\t\treturn 1;\n\t};\n\tconst attributeSizeInBytes = attribute => {\n\t\treturn attribute.num_components() * componentSizeInBytes(attribute.data_type());\n\t};\n\tconst attributeOrder = {\n\t\t0: 0,\n\t\t1: 1,\n\t\t5: 2,\n\t\t2: 3,\n\t\t7: 4,\n\t\t8: 5,\n\t\t4: 6,\n\t\t3: 7\n\t};\n\tconst generateNormals = (vertices, indices) => {\n\t\tconst subtract = (dst, a, b) => {\n\t\t\tdst[0] = a[0] - b[0];\n\t\t\tdst[1] = a[1] - b[1];\n\t\t\tdst[2] = a[2] - b[2];\n\t\t};\n\t\tconst cross = (dst, a, b) => {\n\t\t\tdst[0] = a[1] * b[2] - b[1] * a[2];\n\t\t\tdst[1] = a[2] * b[0] - b[2] * a[0];\n\t\t\tdst[2] = a[0] * b[1] - b[0] * a[1];\n\t\t};\n\t\tconst normalize = (dst, offset) => {\n\t\t\tconst a = dst[offset + 0];\n\t\t\tconst b = dst[offset + 1];\n\t\t\tconst c = dst[offset + 2];\n\t\t\tconst l = 1.0 / Math.sqrt(a * a + b * b + c * c);\n\t\t\tdst[offset + 0] *= l;\n\t\t\tdst[offset + 1] *= l;\n\t\t\tdst[offset + 2] *= l;\n\t\t};\n\t\tconst copy = (dst, src, srcOffset) => {\n\t\t\tfor (let i = 0; i < 3; ++i) {\n\t\t\t\tdst[i] = src[srcOffset + i];\n\t\t\t}\n\t\t};\n\t\tconst numTriangles = indices.length / 3;\n\t\tconst numVertices = vertices.length / 3;\n\t\tconst result = new Float32Array(vertices.length);\n\t\tconst a = [0, 0, 0],\n\t\t\tb = [0, 0, 0],\n\t\t\tc = [0, 0, 0],\n\t\t\tt1 = [0, 0, 0],\n\t\t\tt2 = [0, 0, 0],\n\t\t\tn = [0, 0, 0];\n\t\tfor (let i = 0; i < numTriangles; ++i) {\n\t\t\tconst v0 = indices[i * 3 + 0] * 3;\n\t\t\tconst v1 = indices[i * 3 + 1] * 3;\n\t\t\tconst v2 = indices[i * 3 + 2] * 3;\n\t\t\tcopy(a, vertices, v0);\n\t\t\tcopy(b, vertices, v1);\n\t\t\tcopy(c, vertices, v2);\n\t\t\tsubtract(t1, b, a);\n\t\t\tsubtract(t2, c, a);\n\t\t\tcross(n, t1, t2);\n\t\t\tnormalize(n, 0);\n\t\t\tfor (let j = 0; j < 3; ++j) {\n\t\t\t\tresult[v0 + j] += n[j];\n\t\t\t\tresult[v1 + j] += n[j];\n\t\t\t\tresult[v2 + j] += n[j];\n\t\t\t}\n\t\t}\n\t\tfor (let i = 0; i < numVertices; ++i) {\n\t\t\tnormalize(result, i * 3);\n\t\t}\n\t\treturn new Uint8Array(result.buffer);\n\t};\n\tconst decodeMesh = inputBuffer => {\n\t\tconst result = {};\n\t\tconst buffer = new draco.DecoderBuffer();\n\t\tbuffer.Init(inputBuffer, inputBuffer.length);\n\t\tconst decoder = new draco.Decoder();\n\t\tif (decoder.GetEncodedGeometryType(buffer) !== draco.TRIANGULAR_MESH) {\n\t\t\tresult.error = 'Failed to decode draco mesh: not a mesh';\n\t\t\treturn result;\n\t\t}\n\t\tconst mesh = new draco.Mesh();\n\t\tconst status = decoder.DecodeBufferToMesh(buffer, mesh);\n\t\tif (!status || !status.ok() || mesh.ptr === 0) {\n\t\t\tresult.error = 'Failed to decode draco asset';\n\t\t\treturn result;\n\t\t}\n\t\tconst numIndices = mesh.num_faces() * 3;\n\t\tconst shortIndices = mesh.num_points() <= 65535;\n\t\tconst indicesSize = numIndices * (shortIndices ? 2 : 4);\n\t\tconst indicesPtr = draco._malloc(indicesSize);\n\t\tif (shortIndices) {\n\t\t\tdecoder.GetTrianglesUInt16Array(mesh, indicesSize, indicesPtr);\n\t\t\tresult.indices = new Uint16Array(draco.HEAPU16.buffer, indicesPtr, numIndices).slice().buffer;\n\t\t} else {\n\t\t\tdecoder.GetTrianglesUInt32Array(mesh, indicesSize, indicesPtr);\n\t\t\tresult.indices = new Uint32Array(draco.HEAPU32.buffer, indicesPtr, numIndices).slice().buffer;\n\t\t}\n\t\tdraco._free(indicesPtr);\n\t\tconst attributes = [];\n\t\tfor (let i = 0; i < mesh.num_attributes(); ++i) {\n\t\t\tattributes.push(decoder.GetAttribute(mesh, i));\n\t\t}\n\t\tattributes.sort((a, b) => {\n\t\t\tvar _attributeOrder$a$att, _attributeOrder$b$att;\n\t\t\treturn ((_attributeOrder$a$att = attributeOrder[a.attribute_type()]) != null ? _attributeOrder$a$att : attributeOrder.length) - ((_attributeOrder$b$att = attributeOrder[b.attribute_type()]) != null ? _attributeOrder$b$att : attributeOrder.length);\n\t\t});\n\t\tresult.attributes = attributes.map(a => a.unique_id());\n\t\tlet totalVertexSize = 0;\n\t\tconst offsets = attributes.map(a => {\n\t\t\tconst offset = totalVertexSize;\n\t\t\ttotalVertexSize += Math.ceil(attributeSizeInBytes(a) / 4) * 4;\n\t\t\treturn offset;\n\t\t});\n\t\tconst hasNormals = attributes.some(a => a.attribute_type() === NORMAL_ATTRIBUTE);\n\t\tconst normalOffset = offsets[1];\n\t\tif (!hasNormals) {\n\t\t\tfor (let i = 1; i < offsets.length; ++i) {\n\t\t\t\toffsets[i] += 12;\n\t\t\t}\n\t\t\ttotalVertexSize += 12;\n\t\t}\n\t\tresult.vertices = new ArrayBuffer(mesh.num_points() * totalVertexSize);\n\t\tconst dst = new Uint8Array(result.vertices);\n\t\tfor (let i = 0; i < mesh.num_attributes(); ++i) {\n\t\t\tconst attribute = attributes[i];\n\t\t\tconst sizeInBytes = attributeSizeInBytes(attribute);\n\t\t\tconst ptrSize = mesh.num_points() * sizeInBytes;\n\t\t\tconst ptr = draco._malloc(ptrSize);\n\t\t\tdecoder.GetAttributeDataArrayForAllPoints(mesh, attribute, attribute.data_type(), ptrSize, ptr);\n\t\t\tconst src = new Uint8Array(draco.HEAPU8.buffer, ptr, ptrSize);\n\t\t\tfor (let j = 0; j < mesh.num_points(); ++j) {\n\t\t\t\tfor (let c = 0; c < sizeInBytes; ++c) {\n\t\t\t\t\tdst[j * totalVertexSize + offsets[i] + c] = src[j * sizeInBytes + c];\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!hasNormals && attribute.attribute_type() === POSITION_ATTRIBUTE) {\n\t\t\t\tconst normals = generateNormals(wrap(src, attribute.data_type()), shortIndices ? new Uint16Array(result.indices) : new Uint32Array(result.indices));\n\t\t\t\tfor (let j = 0; j < mesh.num_points(); ++j) {\n\t\t\t\t\tfor (let c = 0; c < 12; ++c) {\n\t\t\t\t\t\tdst[j * totalVertexSize + normalOffset + c] = normals[j * 12 + c];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tdraco._free(ptr);\n\t\t}\n\t\tdraco.destroy(mesh);\n\t\tdraco.destroy(decoder);\n\t\tdraco.destroy(buffer);\n\t\treturn result;\n\t};\n\tconst decode = data => {\n\t\tconst result = decodeMesh(new Uint8Array(data.buffer));\n\t\tself.postMessage({\n\t\t\tjobId: data.jobId,\n\t\t\terror: result.error,\n\t\t\tindices: result.indices,\n\t\t\tvertices: result.vertices,\n\t\t\tattributes: result.attributes\n\t\t}, [result.indices, result.vertices].filter(t => t != null));\n\t};\n\tconst workQueue = [];\n\tself.onmessage = message => {\n\t\tconst data = message.data;\n\t\tswitch (data.type) {\n\t\t\tcase 'init':\n\t\t\t\tself.DracoDecoderModule({\n\t\t\t\t\tinstantiateWasm: (imports, successCallback) => {\n\t\t\t\t\t\tWebAssembly.instantiate(data.module, imports).then(result => successCallback(result)).catch(reason => console.error('instantiate failed + ' + reason));\n\t\t\t\t\t\treturn {};\n\t\t\t\t\t}\n\t\t\t\t}).then(instance => {\n\t\t\t\t\tdraco = instance;\n\t\t\t\t\tworkQueue.forEach(data => decode(data));\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'decodeMesh':\n\t\t\t\tif (draco) {\n\t\t\t\t\tdecode(data);\n\t\t\t\t} else {\n\t\t\t\t\tworkQueue.push(data);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t};\n}\n\nexport { DracoWorker };\n","import { WasmModule } from '../../core/wasm-module.js';\nimport { DracoWorker } from './draco-worker.js';\nimport '../../core/tracing.js';\nimport { http } from '../../platform/net/http.js';\n\nconst downloadMaxRetries = 3;\nclass JobQueue {\n\tconstructor() {\n\t\tthis.workers = [[], [], []];\n\t\tthis.jobId = 0;\n\t\tthis.jobQueue = [];\n\t\tthis.jobCallbacks = new Map();\n\t\tthis.run = (worker, job) => {\n\t\t\tworker.postMessage({\n\t\t\t\ttype: 'decodeMesh',\n\t\t\t\tjobId: job.jobId,\n\t\t\t\tbuffer: job.buffer\n\t\t\t}, [job.buffer]);\n\t\t};\n\t}\n\tinit(workers) {\n\t\tworkers.forEach(worker => {\n\t\t\tworker.addEventListener('message', message => {\n\t\t\t\tconst data = message.data;\n\t\t\t\tconst callback = this.jobCallbacks.get(data.jobId);\n\t\t\t\tif (callback) {\n\t\t\t\t\tcallback(data.error, {\n\t\t\t\t\t\tindices: data.indices,\n\t\t\t\t\t\tvertices: data.vertices,\n\t\t\t\t\t\tattributes: data.attributes\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tthis.jobCallbacks.delete(data.jobId);\n\t\t\t\tif (this.jobQueue.length > 0) {\n\t\t\t\t\tconst job = this.jobQueue.shift();\n\t\t\t\t\tthis.run(worker, job);\n\t\t\t\t} else {\n\t\t\t\t\tconst index2 = this.workers[2].indexOf(worker);\n\t\t\t\t\tif (index2 !== -1) {\n\t\t\t\t\t\tthis.workers[2].splice(index2, 1);\n\t\t\t\t\t\tthis.workers[1].push(worker);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst index1 = this.workers[1].indexOf(worker);\n\t\t\t\t\t\tif (index1 !== -1) {\n\t\t\t\t\t\t\tthis.workers[1].splice(index1, 1);\n\t\t\t\t\t\t\tthis.workers[0].push(worker);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\tthis.workers[0] = workers;\n\t\twhile (this.jobQueue.length && (this.workers[0].length || this.workers[1].length)) {\n\t\t\tconst job = this.jobQueue.shift();\n\t\t\tif (this.workers[0].length > 0) {\n\t\t\t\tconst worker = this.workers[0].shift();\n\t\t\t\tthis.workers[1].push(worker);\n\t\t\t\tthis.run(worker, job);\n\t\t\t} else {\n\t\t\t\tconst worker = this.workers[1].shift();\n\t\t\t\tthis.workers[2].push(worker);\n\t\t\t\tthis.run(worker, job);\n\t\t\t}\n\t\t}\n\t}\n\tenqueueJob(buffer, callback) {\n\t\tconst job = {\n\t\t\tjobId: this.jobId++,\n\t\t\tbuffer: buffer\n\t\t};\n\t\tthis.jobCallbacks.set(job.jobId, callback);\n\t\tif (this.workers[0].length > 0) {\n\t\t\tconst worker = this.workers[0].shift();\n\t\t\tthis.workers[1].push(worker);\n\t\t\tthis.run(worker, job);\n\t\t} else if (this.workers[1].length > 0) {\n\t\t\tconst worker = this.workers[1].shift();\n\t\t\tthis.workers[2].push(worker);\n\t\t\tthis.run(worker, job);\n\t\t} else {\n\t\t\tthis.jobQueue.push(job);\n\t\t}\n\t}\n}\nconst downloadScript = url => {\n\treturn new Promise((resolve, reject) => {\n\t\tconst options = {\n\t\t\tcache: true,\n\t\t\tresponseType: 'text',\n\t\t\tretry: downloadMaxRetries > 0,\n\t\t\tmaxRetries: downloadMaxRetries\n\t\t};\n\t\thttp.get(url, options, (err, response) => {\n\t\t\tif (err) {\n\t\t\t\treject(err);\n\t\t\t} else {\n\t\t\t\tresolve(response);\n\t\t\t}\n\t\t});\n\t});\n};\nconst compileModule = url => {\n\tconst compileManual = () => {\n\t\treturn fetch(url).then(result => result.arrayBuffer()).then(buffer => WebAssembly.compile(buffer));\n\t};\n\tconst compileStreaming = () => {\n\t\treturn WebAssembly.compileStreaming(fetch(url)).catch(err => {\n\t\t\treturn compileManual();\n\t\t});\n\t};\n\treturn WebAssembly.compileStreaming ? compileStreaming() : compileManual();\n};\nconst defaultNumWorkers = 1;\nlet jobQueue;\nlet lazyConfig;\nconst initializeWorkers = config => {\n\tif (jobQueue) {\n\t\treturn true;\n\t}\n\tif (!config) {\n\t\tif (lazyConfig) {\n\t\t\tconfig = lazyConfig;\n\t\t} else {\n\t\t\tconst moduleConfig = WasmModule.getConfig('DracoDecoderModule');\n\t\t\tif (moduleConfig) {\n\t\t\t\tconfig = {\n\t\t\t\t\tjsUrl: moduleConfig.glueUrl,\n\t\t\t\t\twasmUrl: moduleConfig.wasmUrl,\n\t\t\t\t\tnumWorkers: moduleConfig.numWorkers\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tconfig = {\n\t\t\t\t\tjsUrl: 'draco.wasm.js',\n\t\t\t\t\twasmUrl: 'draco.wasm.wasm',\n\t\t\t\t\tnumWorkers: defaultNumWorkers\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\tif (!config.jsUrl || !config.wasmUrl) {\n\t\treturn false;\n\t}\n\tjobQueue = new JobQueue();\n\tPromise.all([downloadScript(config.jsUrl), compileModule(config.wasmUrl)]).then(([dracoSource, dracoModule]) => {\n\t\tconst code = ['/* draco */', dracoSource, '/* worker */', `(\\n${DracoWorker.toString()}\\n)()\\n\\n`].join('\\n');\n\t\tconst blob = new Blob([code], {\n\t\t\ttype: 'application/javascript'\n\t\t});\n\t\tconst workerUrl = URL.createObjectURL(blob);\n\t\tconst numWorkers = Math.max(1, Math.min(16, config.numWorkers || defaultNumWorkers));\n\t\tconst workers = [];\n\t\tfor (let i = 0; i < numWorkers; ++i) {\n\t\t\tconst worker = new Worker(workerUrl);\n\t\t\tworker.postMessage({\n\t\t\t\ttype: 'init',\n\t\t\t\tmodule: dracoModule\n\t\t\t});\n\t\t\tworkers.push(worker);\n\t\t}\n\t\tjobQueue.init(workers);\n\t});\n\treturn true;\n};\nconst dracoInitialize = config => {\n\tif (config != null && config.lazyInit) {\n\t\tlazyConfig = config;\n\t} else {\n\t\tinitializeWorkers(config);\n\t}\n};\nconst dracoDecode = (buffer, callback) => {\n\tif (!initializeWorkers()) {\n\t\treturn false;\n\t}\n\tjobQueue.enqueueJob(buffer, callback);\n\treturn true;\n};\n\nexport { dracoDecode, dracoInitialize };\n","import '../../core/tracing.js';\nimport { path } from '../../core/path.js';\nimport { Color } from '../../core/math/color.js';\nimport { Mat4 } from '../../core/math/mat4.js';\nimport { math } from '../../core/math/math.js';\nimport { Vec2 } from '../../core/math/vec2.js';\nimport { Vec3 } from '../../core/math/vec3.js';\nimport { BoundingBox } from '../../core/shape/bounding-box.js';\nimport { CULLFACE_NONE, CULLFACE_BACK, INDEXFORMAT_UINT32, INDEXFORMAT_UINT16, INDEXFORMAT_UINT8, BUFFER_STATIC, FILTER_LINEAR_MIPMAP_LINEAR, FILTER_NEAREST_MIPMAP_LINEAR, FILTER_LINEAR_MIPMAP_NEAREST, FILTER_NEAREST_MIPMAP_NEAREST, FILTER_LINEAR, FILTER_NEAREST, ADDRESS_REPEAT, ADDRESS_MIRRORED_REPEAT, ADDRESS_CLAMP_TO_EDGE, PRIMITIVE_TRIANGLES, PRIMITIVE_TRIFAN, PRIMITIVE_TRISTRIP, PRIMITIVE_LINESTRIP, PRIMITIVE_LINELOOP, PRIMITIVE_LINES, PRIMITIVE_POINTS, SEMANTIC_NORMAL, SEMANTIC_COLOR, TYPE_UINT8, TYPE_UINT16, TYPE_FLOAT32, TYPE_UINT32, TYPE_INT32, TYPE_INT16, TYPE_INT8, SEMANTIC_POSITION, SEMANTIC_TANGENT, SEMANTIC_BLENDINDICES, SEMANTIC_BLENDWEIGHT, SEMANTIC_TEXCOORD0, SEMANTIC_TEXCOORD1, SEMANTIC_TEXCOORD2, SEMANTIC_TEXCOORD3, SEMANTIC_TEXCOORD4, SEMANTIC_TEXCOORD5, SEMANTIC_TEXCOORD6, SEMANTIC_TEXCOORD7, typedArrayTypesByteSize, typedArrayTypes } from '../../platform/graphics/constants.js';\nimport { IndexBuffer } from '../../platform/graphics/index-buffer.js';\nimport { Texture } from '../../platform/graphics/texture.js';\nimport { VertexBuffer } from '../../platform/graphics/vertex-buffer.js';\nimport { VertexFormat } from '../../platform/graphics/vertex-format.js';\nimport { http } from '../../platform/net/http.js';\nimport { SPECOCC_AO, BLEND_NONE, BLEND_NORMAL, PROJECTION_ORTHOGRAPHIC, PROJECTION_PERSPECTIVE, ASPECT_AUTO, LIGHTFALLOFF_INVERSESQUARED, ASPECT_MANUAL } from '../../scene/constants.js';\nimport { GraphNode } from '../../scene/graph-node.js';\nimport { Light, lightTypes } from '../../scene/light.js';\nimport { Mesh } from '../../scene/mesh.js';\nimport { Morph } from '../../scene/morph.js';\nimport { MorphTarget } from '../../scene/morph-target.js';\nimport { calculateNormals } from '../../scene/procedural.js';\nimport { Render } from '../../scene/render.js';\nimport { Skin } from '../../scene/skin.js';\nimport { StandardMaterial } from '../../scene/materials/standard-material.js';\nimport { Entity } from '../entity.js';\nimport { INTERPOLATION_LINEAR, INTERPOLATION_CUBIC, INTERPOLATION_STEP } from '../anim/constants.js';\nimport { AnimCurve } from '../anim/evaluator/anim-curve.js';\nimport { AnimData } from '../anim/evaluator/anim-data.js';\nimport { AnimTrack } from '../anim/evaluator/anim-track.js';\nimport { Asset } from '../asset/asset.js';\nimport { ABSOLUTE_URL } from '../asset/constants.js';\nimport { dracoDecode } from './draco-decoder.js';\n\nclass GlbResources {\n\tconstructor() {\n\t\tthis.gltf = void 0;\n\t\tthis.nodes = void 0;\n\t\tthis.scenes = void 0;\n\t\tthis.animations = void 0;\n\t\tthis.textures = void 0;\n\t\tthis.materials = void 0;\n\t\tthis.variants = void 0;\n\t\tthis.meshVariants = void 0;\n\t\tthis.meshDefaultMaterials = void 0;\n\t\tthis.renders = void 0;\n\t\tthis.skins = void 0;\n\t\tthis.lights = void 0;\n\t\tthis.cameras = void 0;\n\t}\n\tdestroy() {\n\t\tif (this.renders) {\n\t\t\tthis.renders.forEach(render => {\n\t\t\t\trender.meshes = null;\n\t\t\t});\n\t\t}\n\t}\n}\nconst isDataURI = uri => {\n\treturn /^data:.*,.*$/i.test(uri);\n};\nconst getDataURIMimeType = uri => {\n\treturn uri.substring(uri.indexOf(':') + 1, uri.indexOf(';'));\n};\nconst getNumComponents = accessorType => {\n\tswitch (accessorType) {\n\t\tcase 'SCALAR':\n\t\t\treturn 1;\n\t\tcase 'VEC2':\n\t\t\treturn 2;\n\t\tcase 'VEC3':\n\t\t\treturn 3;\n\t\tcase 'VEC4':\n\t\t\treturn 4;\n\t\tcase 'MAT2':\n\t\t\treturn 4;\n\t\tcase 'MAT3':\n\t\t\treturn 9;\n\t\tcase 'MAT4':\n\t\t\treturn 16;\n\t\tdefault:\n\t\t\treturn 3;\n\t}\n};\nconst getComponentType = componentType => {\n\tswitch (componentType) {\n\t\tcase 5120:\n\t\t\treturn TYPE_INT8;\n\t\tcase 5121:\n\t\t\treturn TYPE_UINT8;\n\t\tcase 5122:\n\t\t\treturn TYPE_INT16;\n\t\tcase 5123:\n\t\t\treturn TYPE_UINT16;\n\t\tcase 5124:\n\t\t\treturn TYPE_INT32;\n\t\tcase 5125:\n\t\t\treturn TYPE_UINT32;\n\t\tcase 5126:\n\t\t\treturn TYPE_FLOAT32;\n\t\tdefault:\n\t\t\treturn 0;\n\t}\n};\nconst getComponentSizeInBytes = componentType => {\n\tswitch (componentType) {\n\t\tcase 5120:\n\t\t\treturn 1;\n\t\tcase 5121:\n\t\t\treturn 1;\n\t\tcase 5122:\n\t\t\treturn 2;\n\t\tcase 5123:\n\t\t\treturn 2;\n\t\tcase 5124:\n\t\t\treturn 4;\n\t\tcase 5125:\n\t\t\treturn 4;\n\t\tcase 5126:\n\t\t\treturn 4;\n\t\tdefault:\n\t\t\treturn 0;\n\t}\n};\nconst getComponentDataType = componentType => {\n\tswitch (componentType) {\n\t\tcase 5120:\n\t\t\treturn Int8Array;\n\t\tcase 5121:\n\t\t\treturn Uint8Array;\n\t\tcase 5122:\n\t\t\treturn Int16Array;\n\t\tcase 5123:\n\t\t\treturn Uint16Array;\n\t\tcase 5124:\n\t\t\treturn Int32Array;\n\t\tcase 5125:\n\t\t\treturn Uint32Array;\n\t\tcase 5126:\n\t\t\treturn Float32Array;\n\t\tdefault:\n\t\t\treturn null;\n\t}\n};\nconst gltfToEngineSemanticMap = {\n\t'POSITION': SEMANTIC_POSITION,\n\t'NORMAL': SEMANTIC_NORMAL,\n\t'TANGENT': SEMANTIC_TANGENT,\n\t'COLOR_0': SEMANTIC_COLOR,\n\t'JOINTS_0': SEMANTIC_BLENDINDICES,\n\t'WEIGHTS_0': SEMANTIC_BLENDWEIGHT,\n\t'TEXCOORD_0': SEMANTIC_TEXCOORD0,\n\t'TEXCOORD_1': SEMANTIC_TEXCOORD1,\n\t'TEXCOORD_2': SEMANTIC_TEXCOORD2,\n\t'TEXCOORD_3': SEMANTIC_TEXCOORD3,\n\t'TEXCOORD_4': SEMANTIC_TEXCOORD4,\n\t'TEXCOORD_5': SEMANTIC_TEXCOORD5,\n\t'TEXCOORD_6': SEMANTIC_TEXCOORD6,\n\t'TEXCOORD_7': SEMANTIC_TEXCOORD7\n};\nconst attributeOrder = {\n\t[SEMANTIC_POSITION]: 0,\n\t[SEMANTIC_NORMAL]: 1,\n\t[SEMANTIC_TANGENT]: 2,\n\t[SEMANTIC_COLOR]: 3,\n\t[SEMANTIC_BLENDINDICES]: 4,\n\t[SEMANTIC_BLENDWEIGHT]: 5,\n\t[SEMANTIC_TEXCOORD0]: 6,\n\t[SEMANTIC_TEXCOORD1]: 7,\n\t[SEMANTIC_TEXCOORD2]: 8,\n\t[SEMANTIC_TEXCOORD3]: 9,\n\t[SEMANTIC_TEXCOORD4]: 10,\n\t[SEMANTIC_TEXCOORD5]: 11,\n\t[SEMANTIC_TEXCOORD6]: 12,\n\t[SEMANTIC_TEXCOORD7]: 13\n};\nconst getDequantizeFunc = srcType => {\n\tswitch (srcType) {\n\t\tcase TYPE_INT8:\n\t\t\treturn x => Math.max(x / 127.0, -1.0);\n\t\tcase TYPE_UINT8:\n\t\t\treturn x => x / 255.0;\n\t\tcase TYPE_INT16:\n\t\t\treturn x => Math.max(x / 32767.0, -1.0);\n\t\tcase TYPE_UINT16:\n\t\t\treturn x => x / 65535.0;\n\t\tdefault:\n\t\t\treturn x => x;\n\t}\n};\nconst dequantizeArray = (dstArray, srcArray, srcType) => {\n\tconst convFunc = getDequantizeFunc(srcType);\n\tconst len = srcArray.length;\n\tfor (let i = 0; i < len; ++i) {\n\t\tdstArray[i] = convFunc(srcArray[i]);\n\t}\n\treturn dstArray;\n};\nconst getAccessorData = (gltfAccessor, bufferViews, flatten = false) => {\n\tconst numComponents = getNumComponents(gltfAccessor.type);\n\tconst dataType = getComponentDataType(gltfAccessor.componentType);\n\tif (!dataType) {\n\t\treturn null;\n\t}\n\tlet result;\n\tif (gltfAccessor.sparse) {\n\t\tconst sparse = gltfAccessor.sparse;\n\t\tconst indicesAccessor = {\n\t\t\tcount: sparse.count,\n\t\t\ttype: 'SCALAR'\n\t\t};\n\t\tconst indices = getAccessorData(Object.assign(indicesAccessor, sparse.indices), bufferViews, true);\n\t\tconst valuesAccessor = {\n\t\t\tcount: sparse.count,\n\t\t\ttype: gltfAccessor.type,\n\t\t\tcomponentType: gltfAccessor.componentType\n\t\t};\n\t\tconst values = getAccessorData(Object.assign(valuesAccessor, sparse.values), bufferViews, true);\n\t\tif (gltfAccessor.hasOwnProperty('bufferView')) {\n\t\t\tconst baseAccessor = {\n\t\t\t\tbufferView: gltfAccessor.bufferView,\n\t\t\t\tbyteOffset: gltfAccessor.byteOffset,\n\t\t\t\tcomponentType: gltfAccessor.componentType,\n\t\t\t\tcount: gltfAccessor.count,\n\t\t\t\ttype: gltfAccessor.type\n\t\t\t};\n\t\t\tresult = getAccessorData(baseAccessor, bufferViews, true).slice();\n\t\t} else {\n\t\t\tresult = new dataType(gltfAccessor.count * numComponents);\n\t\t}\n\t\tfor (let i = 0; i < sparse.count; ++i) {\n\t\t\tconst targetIndex = indices[i];\n\t\t\tfor (let j = 0; j < numComponents; ++j) {\n\t\t\t\tresult[targetIndex * numComponents + j] = values[i * numComponents + j];\n\t\t\t}\n\t\t}\n\t} else {\n\t\tif (gltfAccessor.hasOwnProperty(\"bufferView\")) {\n\t\t\tconst bufferView = bufferViews[gltfAccessor.bufferView];\n\t\t\tif (flatten && bufferView.hasOwnProperty('byteStride')) {\n\t\t\t\tconst bytesPerElement = numComponents * dataType.BYTES_PER_ELEMENT;\n\t\t\t\tconst storage = new ArrayBuffer(gltfAccessor.count * bytesPerElement);\n\t\t\t\tconst tmpArray = new Uint8Array(storage);\n\t\t\t\tlet dstOffset = 0;\n\t\t\t\tfor (let i = 0; i < gltfAccessor.count; ++i) {\n\t\t\t\t\tlet srcOffset = (gltfAccessor.byteOffset || 0) + i * bufferView.byteStride;\n\t\t\t\t\tfor (let b = 0; b < bytesPerElement; ++b) {\n\t\t\t\t\t\ttmpArray[dstOffset++] = bufferView[srcOffset++];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tresult = new dataType(storage);\n\t\t\t} else {\n\t\t\t\tresult = new dataType(bufferView.buffer, bufferView.byteOffset + (gltfAccessor.byteOffset || 0), gltfAccessor.count * numComponents);\n\t\t\t}\n\t\t} else {\n\t\t\tresult = new dataType(gltfAccessor.count * numComponents);\n\t\t}\n\t}\n\treturn result;\n};\nconst getAccessorDataFloat32 = (gltfAccessor, bufferViews) => {\n\tconst data = getAccessorData(gltfAccessor, bufferViews, true);\n\tif (data instanceof Float32Array || !gltfAccessor.normalized) {\n\t\treturn data;\n\t}\n\tconst float32Data = new Float32Array(data.length);\n\tdequantizeArray(float32Data, data, getComponentType(gltfAccessor.componentType));\n\treturn float32Data;\n};\nconst getAccessorBoundingBox = gltfAccessor => {\n\tlet min = gltfAccessor.min;\n\tlet max = gltfAccessor.max;\n\tif (!min || !max) {\n\t\treturn null;\n\t}\n\tif (gltfAccessor.normalized) {\n\t\tconst ctype = getComponentType(gltfAccessor.componentType);\n\t\tmin = dequantizeArray([], min, ctype);\n\t\tmax = dequantizeArray([], max, ctype);\n\t}\n\treturn new BoundingBox(new Vec3((max[0] + min[0]) * 0.5, (max[1] + min[1]) * 0.5, (max[2] + min[2]) * 0.5), new Vec3((max[0] - min[0]) * 0.5, (max[1] - min[1]) * 0.5, (max[2] - min[2]) * 0.5));\n};\nconst getPrimitiveType = primitive => {\n\tif (!primitive.hasOwnProperty('mode')) {\n\t\treturn PRIMITIVE_TRIANGLES;\n\t}\n\tswitch (primitive.mode) {\n\t\tcase 0:\n\t\t\treturn PRIMITIVE_POINTS;\n\t\tcase 1:\n\t\t\treturn PRIMITIVE_LINES;\n\t\tcase 2:\n\t\t\treturn PRIMITIVE_LINELOOP;\n\t\tcase 3:\n\t\t\treturn PRIMITIVE_LINESTRIP;\n\t\tcase 4:\n\t\t\treturn PRIMITIVE_TRIANGLES;\n\t\tcase 5:\n\t\t\treturn PRIMITIVE_TRISTRIP;\n\t\tcase 6:\n\t\t\treturn PRIMITIVE_TRIFAN;\n\t\tdefault:\n\t\t\treturn PRIMITIVE_TRIANGLES;\n\t}\n};\nconst generateIndices = numVertices => {\n\tconst dummyIndices = new Uint16Array(numVertices);\n\tfor (let i = 0; i < numVertices; i++) {\n\t\tdummyIndices[i] = i;\n\t}\n\treturn dummyIndices;\n};\nconst generateNormals = (sourceDesc, indices) => {\n\tconst p = sourceDesc[SEMANTIC_POSITION];\n\tif (!p || p.components !== 3) {\n\t\treturn;\n\t}\n\tlet positions;\n\tif (p.size !== p.stride) {\n\t\tconst srcStride = p.stride / typedArrayTypesByteSize[p.type];\n\t\tconst src = new typedArrayTypes[p.type](p.buffer, p.offset, p.count * srcStride);\n\t\tpositions = new typedArrayTypes[p.type](p.count * 3);\n\t\tfor (let i = 0; i < p.count; ++i) {\n\t\t\tpositions[i * 3 + 0] = src[i * srcStride + 0];\n\t\t\tpositions[i * 3 + 1] = src[i * srcStride + 1];\n\t\t\tpositions[i * 3 + 2] = src[i * srcStride + 2];\n\t\t}\n\t} else {\n\t\tpositions = new typedArrayTypes[p.type](p.buffer, p.offset, p.count * 3);\n\t}\n\tconst numVertices = p.count;\n\tif (!indices) {\n\t\tindices = generateIndices(numVertices);\n\t}\n\tconst normalsTemp = calculateNormals(positions, indices);\n\tconst normals = new Float32Array(normalsTemp.length);\n\tnormals.set(normalsTemp);\n\tsourceDesc[SEMANTIC_NORMAL] = {\n\t\tbuffer: normals.buffer,\n\t\tsize: 12,\n\t\toffset: 0,\n\t\tstride: 12,\n\t\tcount: numVertices,\n\t\tcomponents: 3,\n\t\ttype: TYPE_FLOAT32\n\t};\n};\nconst flipTexCoordVs = vertexBuffer => {\n\tlet i, j;\n\tconst floatOffsets = [];\n\tconst shortOffsets = [];\n\tconst byteOffsets = [];\n\tfor (i = 0; i < vertexBuffer.format.elements.length; ++i) {\n\t\tconst element = vertexBuffer.format.elements[i];\n\t\tif (element.name === SEMANTIC_TEXCOORD0 || element.name === SEMANTIC_TEXCOORD1) {\n\t\t\tswitch (element.dataType) {\n\t\t\t\tcase TYPE_FLOAT32:\n\t\t\t\t\tfloatOffsets.push({\n\t\t\t\t\t\toffset: element.offset / 4 + 1,\n\t\t\t\t\t\tstride: element.stride / 4\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase TYPE_UINT16:\n\t\t\t\t\tshortOffsets.push({\n\t\t\t\t\t\toffset: element.offset / 2 + 1,\n\t\t\t\t\t\tstride: element.stride / 2\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase TYPE_UINT8:\n\t\t\t\t\tbyteOffsets.push({\n\t\t\t\t\t\toffset: element.offset + 1,\n\t\t\t\t\t\tstride: element.stride\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\tconst flip = (offsets, type, one) => {\n\t\tconst typedArray = new type(vertexBuffer.storage);\n\t\tfor (i = 0; i < offsets.length; ++i) {\n\t\t\tlet index = offsets[i].offset;\n\t\t\tconst stride = offsets[i].stride;\n\t\t\tfor (j = 0; j < vertexBuffer.numVertices; ++j) {\n\t\t\t\ttypedArray[index] = one - typedArray[index];\n\t\t\t\tindex += stride;\n\t\t\t}\n\t\t}\n\t};\n\tif (floatOffsets.length > 0) {\n\t\tflip(floatOffsets, Float32Array, 1.0);\n\t}\n\tif (shortOffsets.length > 0) {\n\t\tflip(shortOffsets, Uint16Array, 65535);\n\t}\n\tif (byteOffsets.length > 0) {\n\t\tflip(byteOffsets, Uint8Array, 255);\n\t}\n};\nconst cloneTexture = texture => {\n\tconst shallowCopyLevels = texture => {\n\t\tconst result = [];\n\t\tfor (let mip = 0; mip < texture._levels.length; ++mip) {\n\t\t\tlet level = [];\n\t\t\tif (texture.cubemap) {\n\t\t\t\tfor (let face = 0; face < 6; ++face) {\n\t\t\t\t\tlevel.push(texture._levels[mip][face]);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlevel = texture._levels[mip];\n\t\t\t}\n\t\t\tresult.push(level);\n\t\t}\n\t\treturn result;\n\t};\n\tconst result = new Texture(texture.device, texture);\n\tresult._levels = shallowCopyLevels(texture);\n\treturn result;\n};\nconst cloneTextureAsset = src => {\n\tconst result = new Asset(src.name + '_clone', src.type, src.file, src.data, src.options);\n\tresult.loaded = true;\n\tresult.resource = cloneTexture(src.resource);\n\tsrc.registry.add(result);\n\treturn result;\n};\nconst createVertexBufferInternal = (device, sourceDesc, flipV) => {\n\tconst positionDesc = sourceDesc[SEMANTIC_POSITION];\n\tif (!positionDesc) {\n\t\treturn null;\n\t}\n\tconst numVertices = positionDesc.count;\n\tconst vertexDesc = [];\n\tfor (const semantic in sourceDesc) {\n\t\tif (sourceDesc.hasOwnProperty(semantic)) {\n\t\t\tconst element = {\n\t\t\t\tsemantic: semantic,\n\t\t\t\tcomponents: sourceDesc[semantic].components,\n\t\t\t\ttype: sourceDesc[semantic].type,\n\t\t\t\tnormalize: !!sourceDesc[semantic].normalize\n\t\t\t};\n\t\t\tif (!VertexFormat.isElementValid(device, element)) {\n\t\t\t\telement.components++;\n\t\t\t}\n\t\t\tvertexDesc.push(element);\n\t\t}\n\t}\n\tvertexDesc.sort((lhs, rhs) => {\n\t\treturn attributeOrder[lhs.semantic] - attributeOrder[rhs.semantic];\n\t});\n\tlet i, j, k;\n\tlet source, target, sourceOffset;\n\tconst vertexFormat = new VertexFormat(device, vertexDesc);\n\tlet isCorrectlyInterleaved = true;\n\tfor (i = 0; i < vertexFormat.elements.length; ++i) {\n\t\ttarget = vertexFormat.elements[i];\n\t\tsource = sourceDesc[target.name];\n\t\tsourceOffset = source.offset - positionDesc.offset;\n\t\tif (source.buffer !== positionDesc.buffer || source.stride !== target.stride || source.size !== target.size || sourceOffset !== target.offset) {\n\t\t\tisCorrectlyInterleaved = false;\n\t\t\tbreak;\n\t\t}\n\t}\n\tconst vertexBuffer = new VertexBuffer(device, vertexFormat, numVertices, BUFFER_STATIC);\n\tconst vertexData = vertexBuffer.lock();\n\tconst targetArray = new Uint32Array(vertexData);\n\tlet sourceArray;\n\tif (isCorrectlyInterleaved) {\n\t\tsourceArray = new Uint32Array(positionDesc.buffer, positionDesc.offset, numVertices * vertexBuffer.format.size / 4);\n\t\ttargetArray.set(sourceArray);\n\t} else {\n\t\tlet targetStride, sourceStride;\n\t\tfor (i = 0; i < vertexBuffer.format.elements.length; ++i) {\n\t\t\ttarget = vertexBuffer.format.elements[i];\n\t\t\ttargetStride = target.stride / 4;\n\t\t\tsource = sourceDesc[target.name];\n\t\t\tsourceStride = source.stride / 4;\n\t\t\tsourceArray = new Uint32Array(source.buffer, source.offset, (source.count - 1) * sourceStride + (source.size + 3) / 4);\n\t\t\tlet src = 0;\n\t\t\tlet dst = target.offset / 4;\n\t\t\tconst kend = Math.floor((source.size + 3) / 4);\n\t\t\tfor (j = 0; j < numVertices; ++j) {\n\t\t\t\tfor (k = 0; k < kend; ++k) {\n\t\t\t\t\ttargetArray[dst + k] = sourceArray[src + k];\n\t\t\t\t}\n\t\t\t\tsrc += sourceStride;\n\t\t\t\tdst += targetStride;\n\t\t\t}\n\t\t}\n\t}\n\tif (flipV) {\n\t\tflipTexCoordVs(vertexBuffer);\n\t}\n\tvertexBuffer.unlock();\n\treturn vertexBuffer;\n};\nconst createVertexBuffer = (device, attributes, indices, accessors, bufferViews, flipV, vertexBufferDict) => {\n\tconst useAttributes = {};\n\tconst attribIds = [];\n\tfor (const attrib in attributes) {\n\t\tif (attributes.hasOwnProperty(attrib) && gltfToEngineSemanticMap.hasOwnProperty(attrib)) {\n\t\t\tuseAttributes[attrib] = attributes[attrib];\n\t\t\tattribIds.push(attrib + ':' + attributes[attrib]);\n\t\t}\n\t}\n\tattribIds.sort();\n\tconst vbKey = attribIds.join();\n\tlet vb = vertexBufferDict[vbKey];\n\tif (!vb) {\n\t\tconst sourceDesc = {};\n\t\tfor (const attrib in useAttributes) {\n\t\t\tconst accessor = accessors[attributes[attrib]];\n\t\t\tconst accessorData = getAccessorData(accessor, bufferViews);\n\t\t\tconst bufferView = bufferViews[accessor.bufferView];\n\t\t\tconst semantic = gltfToEngineSemanticMap[attrib];\n\t\t\tconst size = getNumComponents(accessor.type) * getComponentSizeInBytes(accessor.componentType);\n\t\t\tconst stride = bufferView && bufferView.hasOwnProperty('byteStride') ? bufferView.byteStride : size;\n\t\t\tsourceDesc[semantic] = {\n\t\t\t\tbuffer: accessorData.buffer,\n\t\t\t\tsize: size,\n\t\t\t\toffset: accessorData.byteOffset,\n\t\t\t\tstride: stride,\n\t\t\t\tcount: accessor.count,\n\t\t\t\tcomponents: getNumComponents(accessor.type),\n\t\t\t\ttype: getComponentType(accessor.componentType),\n\t\t\t\tnormalize: accessor.normalized\n\t\t\t};\n\t\t}\n\t\tif (!sourceDesc.hasOwnProperty(SEMANTIC_NORMAL)) {\n\t\t\tgenerateNormals(sourceDesc, indices);\n\t\t}\n\t\tvb = createVertexBufferInternal(device, sourceDesc, flipV);\n\t\tvertexBufferDict[vbKey] = vb;\n\t}\n\treturn vb;\n};\nconst createSkin = (device, gltfSkin, accessors, bufferViews, nodes, glbSkins) => {\n\tlet i, j, bindMatrix;\n\tconst joints = gltfSkin.joints;\n\tconst numJoints = joints.length;\n\tconst ibp = [];\n\tif (gltfSkin.hasOwnProperty('inverseBindMatrices')) {\n\t\tconst inverseBindMatrices = gltfSkin.inverseBindMatrices;\n\t\tconst ibmData = getAccessorData(accessors[inverseBindMatrices], bufferViews, true);\n\t\tconst ibmValues = [];\n\t\tfor (i = 0; i < numJoints; i++) {\n\t\t\tfor (j = 0; j < 16; j++) {\n\t\t\t\tibmValues[j] = ibmData[i * 16 + j];\n\t\t\t}\n\t\t\tbindMatrix = new Mat4();\n\t\t\tbindMatrix.set(ibmValues);\n\t\t\tibp.push(bindMatrix);\n\t\t}\n\t} else {\n\t\tfor (i = 0; i < numJoints; i++) {\n\t\t\tbindMatrix = new Mat4();\n\t\t\tibp.push(bindMatrix);\n\t\t}\n\t}\n\tconst boneNames = [];\n\tfor (i = 0; i < numJoints; i++) {\n\t\tboneNames[i] = nodes[joints[i]].name;\n\t}\n\tconst key = boneNames.join('#');\n\tlet skin = glbSkins.get(key);\n\tif (!skin) {\n\t\tskin = new Skin(device, ibp, boneNames);\n\t\tglbSkins.set(key, skin);\n\t}\n\treturn skin;\n};\nconst createDracoMesh = (device, primitive, accessors, bufferViews, meshVariants, meshDefaultMaterials, promises) => {\n\tvar _primitive$extensions;\n\tconst result = new Mesh(device);\n\tresult.aabb = getAccessorBoundingBox(accessors[primitive.attributes.POSITION]);\n\tconst vertexDesc = [];\n\tfor (const [name, index] of Object.entries(primitive.attributes)) {\n\t\tvar _accessor$normalized;\n\t\tconst accessor = accessors[index];\n\t\tconst semantic = gltfToEngineSemanticMap[name];\n\t\tconst componentType = getComponentType(accessor.componentType);\n\t\tvertexDesc.push({\n\t\t\tsemantic: semantic,\n\t\t\tcomponents: getNumComponents(accessor.type),\n\t\t\ttype: componentType,\n\t\t\tnormalize: (_accessor$normalized = accessor.normalized) != null ? _accessor$normalized : semantic === SEMANTIC_COLOR && (componentType === TYPE_UINT8 || componentType === TYPE_UINT16)\n\t\t});\n\t}\n\tpromises.push(new Promise((resolve, reject) => {\n\t\tconst dracoExt = primitive.extensions.KHR_draco_mesh_compression;\n\t\tdracoDecode(bufferViews[dracoExt.bufferView].slice().buffer, (err, decompressedData) => {\n\t\t\tif (err) {\n\t\t\t\tconsole.log(err);\n\t\t\t\treject(err);\n\t\t\t} else {\n\t\t\t\tvar _primitive$attributes;\n\t\t\t\tconst order = {};\n\t\t\t\tfor (const [name, index] of Object.entries(dracoExt.attributes)) {\n\t\t\t\t\torder[gltfToEngineSemanticMap[name]] = decompressedData.attributes.indexOf(index);\n\t\t\t\t}\n\t\t\t\tvertexDesc.sort((a, b) => {\n\t\t\t\t\treturn order[a.semantic] - order[b.semantic];\n\t\t\t\t});\n\t\t\t\tif (!((_primitive$attributes = primitive.attributes) != null && _primitive$attributes.NORMAL)) {\n\t\t\t\t\tvertexDesc.splice(1, 0, {\n\t\t\t\t\t\tsemantic: 'NORMAL',\n\t\t\t\t\t\tcomponents: 3,\n\t\t\t\t\t\ttype: TYPE_FLOAT32\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst vertexFormat = new VertexFormat(device, vertexDesc);\n\t\t\t\tconst numVertices = decompressedData.vertices.byteLength / vertexFormat.size;\n\t\t\t\tconst indexFormat = numVertices <= 65535 ? INDEXFORMAT_UINT16 : INDEXFORMAT_UINT32;\n\t\t\t\tconst numIndices = decompressedData.indices.byteLength / (numVertices <= 65535 ? 2 : 4);\n\t\t\t\tconst vertexBuffer = new VertexBuffer(device, vertexFormat, numVertices, BUFFER_STATIC, decompressedData.vertices);\n\t\t\t\tconst indexBuffer = new IndexBuffer(device, indexFormat, numIndices, BUFFER_STATIC, decompressedData.indices);\n\t\t\t\tresult.vertexBuffer = vertexBuffer;\n\t\t\t\tresult.indexBuffer[0] = indexBuffer;\n\t\t\t\tresult.primitive[0].type = getPrimitiveType(primitive);\n\t\t\t\tresult.primitive[0].base = 0;\n\t\t\t\tresult.primitive[0].count = indexBuffer ? numIndices : numVertices;\n\t\t\t\tresult.primitive[0].indexed = !!indexBuffer;\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t}));\n\tif (primitive != null && (_primitive$extensions = primitive.extensions) != null && _primitive$extensions.KHR_materials_variants) {\n\t\tconst variants = primitive.extensions.KHR_materials_variants;\n\t\tconst tempMapping = {};\n\t\tvariants.mappings.forEach(mapping => {\n\t\t\tmapping.variants.forEach(variant => {\n\t\t\t\ttempMapping[variant] = mapping.material;\n\t\t\t});\n\t\t});\n\t\tmeshVariants[result.id] = tempMapping;\n\t}\n\tmeshDefaultMaterials[result.id] = primitive.material;\n\treturn result;\n};\nconst createMesh = (device, gltfMesh, accessors, bufferViews, flipV, vertexBufferDict, meshVariants, meshDefaultMaterials, assetOptions, promises) => {\n\tconst meshes = [];\n\tgltfMesh.primitives.forEach(primitive => {\n\t\tvar _primitive$extensions2;\n\t\tif ((_primitive$extensions2 = primitive.extensions) != null && _primitive$extensions2.KHR_draco_mesh_compression) {\n\t\t\tmeshes.push(createDracoMesh(device, primitive, accessors, bufferViews, meshVariants, meshDefaultMaterials, promises));\n\t\t} else {\n\t\t\tlet indices = primitive.hasOwnProperty('indices') ? getAccessorData(accessors[primitive.indices], bufferViews, true) : null;\n\t\t\tconst vertexBuffer = createVertexBuffer(device, primitive.attributes, indices, accessors, bufferViews, flipV, vertexBufferDict);\n\t\t\tconst primitiveType = getPrimitiveType(primitive);\n\t\t\tconst mesh = new Mesh(device);\n\t\t\tmesh.vertexBuffer = vertexBuffer;\n\t\t\tmesh.primitive[0].type = primitiveType;\n\t\t\tmesh.primitive[0].base = 0;\n\t\t\tmesh.primitive[0].indexed = indices !== null;\n\t\t\tif (indices !== null) {\n\t\t\t\tlet indexFormat;\n\t\t\t\tif (indices instanceof Uint8Array) {\n\t\t\t\t\tindexFormat = INDEXFORMAT_UINT8;\n\t\t\t\t} else if (indices instanceof Uint16Array) {\n\t\t\t\t\tindexFormat = INDEXFORMAT_UINT16;\n\t\t\t\t} else {\n\t\t\t\t\tindexFormat = INDEXFORMAT_UINT32;\n\t\t\t\t}\n\t\t\t\tif (indexFormat === INDEXFORMAT_UINT32 && !device.extUintElement) {\n\t\t\t\t\tindexFormat = INDEXFORMAT_UINT16;\n\t\t\t\t\tindices = new Uint16Array(indices);\n\t\t\t\t}\n\t\t\t\tif (indexFormat === INDEXFORMAT_UINT8 && device.isWebGPU) {\n\t\t\t\t\tindexFormat = INDEXFORMAT_UINT16;\n\t\t\t\t\tindices = new Uint16Array(indices);\n\t\t\t\t}\n\t\t\t\tconst indexBuffer = new IndexBuffer(device, indexFormat, indices.length, BUFFER_STATIC, indices);\n\t\t\t\tmesh.indexBuffer[0] = indexBuffer;\n\t\t\t\tmesh.primitive[0].count = indices.length;\n\t\t\t} else {\n\t\t\t\tmesh.primitive[0].count = vertexBuffer.numVertices;\n\t\t\t}\n\t\t\tif (primitive.hasOwnProperty(\"extensions\") && primitive.extensions.hasOwnProperty(\"KHR_materials_variants\")) {\n\t\t\t\tconst variants = primitive.extensions.KHR_materials_variants;\n\t\t\t\tconst tempMapping = {};\n\t\t\t\tvariants.mappings.forEach(mapping => {\n\t\t\t\t\tmapping.variants.forEach(variant => {\n\t\t\t\t\t\ttempMapping[variant] = mapping.material;\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tmeshVariants[mesh.id] = tempMapping;\n\t\t\t}\n\t\t\tmeshDefaultMaterials[mesh.id] = primitive.material;\n\t\t\tlet accessor = accessors[primitive.attributes.POSITION];\n\t\t\tmesh.aabb = getAccessorBoundingBox(accessor);\n\t\t\tif (primitive.hasOwnProperty('targets')) {\n\t\t\t\tconst targets = [];\n\t\t\t\tprimitive.targets.forEach((target, index) => {\n\t\t\t\t\tconst options = {};\n\t\t\t\t\tif (target.hasOwnProperty('POSITION')) {\n\t\t\t\t\t\taccessor = accessors[target.POSITION];\n\t\t\t\t\t\toptions.deltaPositions = getAccessorDataFloat32(accessor, bufferViews);\n\t\t\t\t\t\toptions.deltaPositionsType = TYPE_FLOAT32;\n\t\t\t\t\t\toptions.aabb = getAccessorBoundingBox(accessor);\n\t\t\t\t\t}\n\t\t\t\t\tif (target.hasOwnProperty('NORMAL')) {\n\t\t\t\t\t\taccessor = accessors[target.NORMAL];\n\t\t\t\t\t\toptions.deltaNormals = getAccessorDataFloat32(accessor, bufferViews);\n\t\t\t\t\t\toptions.deltaNormalsType = TYPE_FLOAT32;\n\t\t\t\t\t}\n\t\t\t\t\tif (gltfMesh.hasOwnProperty('extras') && gltfMesh.extras.hasOwnProperty('targetNames')) {\n\t\t\t\t\t\toptions.name = gltfMesh.extras.targetNames[index];\n\t\t\t\t\t} else {\n\t\t\t\t\t\toptions.name = index.toString(10);\n\t\t\t\t\t}\n\t\t\t\t\tif (gltfMesh.hasOwnProperty('weights')) {\n\t\t\t\t\t\toptions.defaultWeight = gltfMesh.weights[index];\n\t\t\t\t\t}\n\t\t\t\t\toptions.preserveData = assetOptions.morphPreserveData;\n\t\t\t\t\ttargets.push(new MorphTarget(options));\n\t\t\t\t});\n\t\t\t\tmesh.morph = new Morph(targets, device, {\n\t\t\t\t\tpreferHighPrecision: assetOptions.morphPreferHighPrecision\n\t\t\t\t});\n\t\t\t}\n\t\t\tmeshes.push(mesh);\n\t\t}\n\t});\n\treturn meshes;\n};\nconst extractTextureTransform = (source, material, maps) => {\n\tvar _source$extensions;\n\tlet map;\n\tconst texCoord = source.texCoord;\n\tif (texCoord) {\n\t\tfor (map = 0; map < maps.length; ++map) {\n\t\t\tmaterial[maps[map] + 'MapUv'] = texCoord;\n\t\t}\n\t}\n\tconst zeros = [0, 0];\n\tconst ones = [1, 1];\n\tconst textureTransform = (_source$extensions = source.extensions) == null ? void 0 : _source$extensions.KHR_texture_transform;\n\tif (textureTransform) {\n\t\tconst offset = textureTransform.offset || zeros;\n\t\tconst scale = textureTransform.scale || ones;\n\t\tconst rotation = textureTransform.rotation ? -textureTransform.rotation * math.RAD_TO_DEG : 0;\n\t\tconst tilingVec = new Vec2(scale[0], scale[1]);\n\t\tconst offsetVec = new Vec2(offset[0], 1.0 - scale[1] - offset[1]);\n\t\tfor (map = 0; map < maps.length; ++map) {\n\t\t\tmaterial[`${maps[map]}MapTiling`] = tilingVec;\n\t\t\tmaterial[`${maps[map]}MapOffset`] = offsetVec;\n\t\t\tmaterial[`${maps[map]}MapRotation`] = rotation;\n\t\t}\n\t}\n};\nconst extensionPbrSpecGlossiness = (data, material, textures) => {\n\tlet color, texture;\n\tif (data.hasOwnProperty('diffuseFactor')) {\n\t\tcolor = data.diffuseFactor;\n\t\tmaterial.diffuse.set(Math.pow(color[0], 1 / 2.2), Math.pow(color[1], 1 / 2.2), Math.pow(color[2], 1 / 2.2));\n\t\tmaterial.opacity = color[3];\n\t} else {\n\t\tmaterial.diffuse.set(1, 1, 1);\n\t\tmaterial.opacity = 1;\n\t}\n\tif (data.hasOwnProperty('diffuseTexture')) {\n\t\tconst diffuseTexture = data.diffuseTexture;\n\t\ttexture = textures[diffuseTexture.index];\n\t\tmaterial.diffuseMap = texture;\n\t\tmaterial.diffuseMapChannel = 'rgb';\n\t\tmaterial.opacityMap = texture;\n\t\tmaterial.opacityMapChannel = 'a';\n\t\textractTextureTransform(diffuseTexture, material, ['diffuse', 'opacity']);\n\t}\n\tmaterial.useMetalness = false;\n\tif (data.hasOwnProperty('specularFactor')) {\n\t\tcolor = data.specularFactor;\n\t\tmaterial.specular.set(Math.pow(color[0], 1 / 2.2), Math.pow(color[1], 1 / 2.2), Math.pow(color[2], 1 / 2.2));\n\t} else {\n\t\tmaterial.specular.set(1, 1, 1);\n\t}\n\tif (data.hasOwnProperty('glossinessFactor')) {\n\t\tmaterial.gloss = data.glossinessFactor;\n\t} else {\n\t\tmaterial.gloss = 1.0;\n\t}\n\tif (data.hasOwnProperty('specularGlossinessTexture')) {\n\t\tconst specularGlossinessTexture = data.specularGlossinessTexture;\n\t\tmaterial.specularEncoding = 'srgb';\n\t\tmaterial.specularMap = material.glossMap = textures[specularGlossinessTexture.index];\n\t\tmaterial.specularMapChannel = 'rgb';\n\t\tmaterial.glossMapChannel = 'a';\n\t\textractTextureTransform(specularGlossinessTexture, material, ['gloss', 'metalness']);\n\t}\n};\nconst extensionClearCoat = (data, material, textures) => {\n\tif (data.hasOwnProperty('clearcoatFactor')) {\n\t\tmaterial.clearCoat = data.clearcoatFactor * 0.25;\n\t} else {\n\t\tmaterial.clearCoat = 0;\n\t}\n\tif (data.hasOwnProperty('clearcoatTexture')) {\n\t\tconst clearcoatTexture = data.clearcoatTexture;\n\t\tmaterial.clearCoatMap = textures[clearcoatTexture.index];\n\t\tmaterial.clearCoatMapChannel = 'r';\n\t\textractTextureTransform(clearcoatTexture, material, ['clearCoat']);\n\t}\n\tif (data.hasOwnProperty('clearcoatRoughnessFactor')) {\n\t\tmaterial.clearCoatGloss = data.clearcoatRoughnessFactor;\n\t} else {\n\t\tmaterial.clearCoatGloss = 0;\n\t}\n\tif (data.hasOwnProperty('clearcoatRoughnessTexture')) {\n\t\tconst clearcoatRoughnessTexture = data.clearcoatRoughnessTexture;\n\t\tmaterial.clearCoatGlossMap = textures[clearcoatRoughnessTexture.index];\n\t\tmaterial.clearCoatGlossMapChannel = 'g';\n\t\textractTextureTransform(clearcoatRoughnessTexture, material, ['clearCoatGloss']);\n\t}\n\tif (data.hasOwnProperty('clearcoatNormalTexture')) {\n\t\tconst clearcoatNormalTexture = data.clearcoatNormalTexture;\n\t\tmaterial.clearCoatNormalMap = textures[clearcoatNormalTexture.index];\n\t\textractTextureTransform(clearcoatNormalTexture, material, ['clearCoatNormal']);\n\t\tif (clearcoatNormalTexture.hasOwnProperty('scale')) {\n\t\t\tmaterial.clearCoatBumpiness = clearcoatNormalTexture.scale;\n\t\t}\n\t}\n\tmaterial.clearCoatGlossInvert = true;\n};\nconst extensionUnlit = (data, material, textures) => {\n\tmaterial.useLighting = false;\n\tmaterial.emissive.copy(material.diffuse);\n\tmaterial.emissiveTint = material.diffuseTint;\n\tmaterial.emissiveMap = material.diffuseMap;\n\tmaterial.emissiveMapUv = material.diffuseMapUv;\n\tmaterial.emissiveMapTiling.copy(material.diffuseMapTiling);\n\tmaterial.emissiveMapOffset.copy(material.diffuseMapOffset);\n\tmaterial.emissiveMapRotation = material.diffuseMapRotation;\n\tmaterial.emissiveMapChannel = material.diffuseMapChannel;\n\tmaterial.emissiveVertexColor = material.diffuseVertexColor;\n\tmaterial.emissiveVertexColorChannel = material.diffuseVertexColorChannel;\n\tmaterial.useLighting = false;\n\tmaterial.useSkybox = false;\n\tmaterial.diffuse.set(0, 0, 0);\n\tmaterial.diffuseTint = false;\n\tmaterial.diffuseMap = null;\n\tmaterial.diffuseVertexColor = false;\n};\nconst extensionSpecular = (data, material, textures) => {\n\tmaterial.useMetalnessSpecularColor = true;\n\tif (data.hasOwnProperty('specularColorTexture')) {\n\t\tmaterial.specularEncoding = 'srgb';\n\t\tmaterial.specularMap = textures[data.specularColorTexture.index];\n\t\tmaterial.specularMapChannel = 'rgb';\n\t\textractTextureTransform(data.specularColorTexture, material, ['specular']);\n\t}\n\tif (data.hasOwnProperty('specularColorFactor')) {\n\t\tconst color = data.specularColorFactor;\n\t\tmaterial.specular.set(Math.pow(color[0], 1 / 2.2), Math.pow(color[1], 1 / 2.2), Math.pow(color[2], 1 / 2.2));\n\t} else {\n\t\tmaterial.specular.set(1, 1, 1);\n\t}\n\tif (data.hasOwnProperty('specularFactor')) {\n\t\tmaterial.specularityFactor = data.specularFactor;\n\t} else {\n\t\tmaterial.specularityFactor = 1;\n\t}\n\tif (data.hasOwnProperty('specularTexture')) {\n\t\tmaterial.specularityFactorMapChannel = 'a';\n\t\tmaterial.specularityFactorMap = textures[data.specularTexture.index];\n\t\textractTextureTransform(data.specularTexture, material, ['specularityFactor']);\n\t}\n};\nconst extensionIor = (data, material, textures) => {\n\tif (data.hasOwnProperty('ior')) {\n\t\tmaterial.refractionIndex = 1.0 / data.ior;\n\t}\n};\nconst extensionTransmission = (data, material, textures) => {\n\tmaterial.blendType = BLEND_NORMAL;\n\tmaterial.useDynamicRefraction = true;\n\tif (data.hasOwnProperty('transmissionFactor')) {\n\t\tmaterial.refraction = data.transmissionFactor;\n\t}\n\tif (data.hasOwnProperty('transmissionTexture')) {\n\t\tmaterial.refractionMapChannel = 'r';\n\t\tmaterial.refractionMap = textures[data.transmissionTexture.index];\n\t\textractTextureTransform(data.transmissionTexture, material, ['refraction']);\n\t}\n};\nconst extensionSheen = (data, material, textures) => {\n\tmaterial.useSheen = true;\n\tif (data.hasOwnProperty('sheenColorFactor')) {\n\t\tconst color = data.sheenColorFactor;\n\t\tmaterial.sheen.set(Math.pow(color[0], 1 / 2.2), Math.pow(color[1], 1 / 2.2), Math.pow(color[2], 1 / 2.2));\n\t} else {\n\t\tmaterial.sheen.set(1, 1, 1);\n\t}\n\tif (data.hasOwnProperty('sheenColorTexture')) {\n\t\tmaterial.sheenMap = textures[data.sheenColorTexture.index];\n\t\tmaterial.sheenEncoding = 'srgb';\n\t\textractTextureTransform(data.sheenColorTexture, material, ['sheen']);\n\t}\n\tif (data.hasOwnProperty('sheenRoughnessFactor')) {\n\t\tmaterial.sheenGloss = data.sheenRoughnessFactor;\n\t} else {\n\t\tmaterial.sheenGloss = 0.0;\n\t}\n\tif (data.hasOwnProperty('sheenRoughnessTexture')) {\n\t\tmaterial.sheenGlossMap = textures[data.sheenRoughnessTexture.index];\n\t\tmaterial.sheenGlossMapChannel = 'a';\n\t\textractTextureTransform(data.sheenRoughnessTexture, material, ['sheenGloss']);\n\t}\n\tmaterial.sheenGlossInvert = true;\n};\nconst extensionVolume = (data, material, textures) => {\n\tmaterial.blendType = BLEND_NORMAL;\n\tmaterial.useDynamicRefraction = true;\n\tif (data.hasOwnProperty('thicknessFactor')) {\n\t\tmaterial.thickness = data.thicknessFactor;\n\t}\n\tif (data.hasOwnProperty('thicknessTexture')) {\n\t\tmaterial.thicknessMap = textures[data.thicknessTexture.index];\n\t\tmaterial.thicknessMapChannel = 'g';\n\t\textractTextureTransform(data.thicknessTexture, material, ['thickness']);\n\t}\n\tif (data.hasOwnProperty('attenuationDistance')) {\n\t\tmaterial.attenuationDistance = data.attenuationDistance;\n\t}\n\tif (data.hasOwnProperty('attenuationColor')) {\n\t\tconst color = data.attenuationColor;\n\t\tmaterial.attenuation.set(Math.pow(color[0], 1 / 2.2), Math.pow(color[1], 1 / 2.2), Math.pow(color[2], 1 / 2.2));\n\t}\n};\nconst extensionEmissiveStrength = (data, material, textures) => {\n\tif (data.hasOwnProperty('emissiveStrength')) {\n\t\tmaterial.emissiveIntensity = data.emissiveStrength;\n\t}\n};\nconst extensionIridescence = (data, material, textures) => {\n\tmaterial.useIridescence = true;\n\tif (data.hasOwnProperty('iridescenceFactor')) {\n\t\tmaterial.iridescence = data.iridescenceFactor;\n\t}\n\tif (data.hasOwnProperty('iridescenceTexture')) {\n\t\tmaterial.iridescenceMapChannel = 'r';\n\t\tmaterial.iridescenceMap = textures[data.iridescenceTexture.index];\n\t\textractTextureTransform(data.iridescenceTexture, material, ['iridescence']);\n\t}\n\tif (data.hasOwnProperty('iridescenceIor')) {\n\t\tmaterial.iridescenceRefractionIndex = data.iridescenceIor;\n\t}\n\tif (data.hasOwnProperty('iridescenceThicknessMinimum')) {\n\t\tmaterial.iridescenceThicknessMin = data.iridescenceThicknessMinimum;\n\t}\n\tif (data.hasOwnProperty('iridescenceThicknessMaximum')) {\n\t\tmaterial.iridescenceThicknessMax = data.iridescenceThicknessMaximum;\n\t}\n\tif (data.hasOwnProperty('iridescenceThicknessTexture')) {\n\t\tmaterial.iridescenceThicknessMapChannel = 'g';\n\t\tmaterial.iridescenceThicknessMap = textures[data.iridescenceThicknessTexture.index];\n\t\textractTextureTransform(data.iridescenceThicknessTexture, material, ['iridescenceThickness']);\n\t}\n};\nconst createMaterial = (gltfMaterial, textures, flipV) => {\n\tconst material = new StandardMaterial();\n\tmaterial.occludeSpecular = SPECOCC_AO;\n\tmaterial.diffuseTint = true;\n\tmaterial.diffuseVertexColor = true;\n\tmaterial.specularTint = true;\n\tmaterial.specularVertexColor = true;\n\tif (gltfMaterial.hasOwnProperty('name')) {\n\t\tmaterial.name = gltfMaterial.name;\n\t}\n\tlet color, texture;\n\tif (gltfMaterial.hasOwnProperty('pbrMetallicRoughness')) {\n\t\tconst pbrData = gltfMaterial.pbrMetallicRoughness;\n\t\tif (pbrData.hasOwnProperty('baseColorFactor')) {\n\t\t\tcolor = pbrData.baseColorFactor;\n\t\t\tmaterial.diffuse.set(Math.pow(color[0], 1 / 2.2), Math.pow(color[1], 1 / 2.2), Math.pow(color[2], 1 / 2.2));\n\t\t\tmaterial.opacity = color[3];\n\t\t} else {\n\t\t\tmaterial.diffuse.set(1, 1, 1);\n\t\t\tmaterial.opacity = 1;\n\t\t}\n\t\tif (pbrData.hasOwnProperty('baseColorTexture')) {\n\t\t\tconst baseColorTexture = pbrData.baseColorTexture;\n\t\t\ttexture = textures[baseColorTexture.index];\n\t\t\tmaterial.diffuseMap = texture;\n\t\t\tmaterial.diffuseMapChannel = 'rgb';\n\t\t\tmaterial.opacityMap = texture;\n\t\t\tmaterial.opacityMapChannel = 'a';\n\t\t\textractTextureTransform(baseColorTexture, material, ['diffuse', 'opacity']);\n\t\t}\n\t\tmaterial.useMetalness = true;\n\t\tmaterial.specular.set(1, 1, 1);\n\t\tif (pbrData.hasOwnProperty('metallicFactor')) {\n\t\t\tmaterial.metalness = pbrData.metallicFactor;\n\t\t} else {\n\t\t\tmaterial.metalness = 1;\n\t\t}\n\t\tif (pbrData.hasOwnProperty('roughnessFactor')) {\n\t\t\tmaterial.gloss = pbrData.roughnessFactor;\n\t\t} else {\n\t\t\tmaterial.gloss = 1;\n\t\t}\n\t\tmaterial.glossInvert = true;\n\t\tif (pbrData.hasOwnProperty('metallicRoughnessTexture')) {\n\t\t\tconst metallicRoughnessTexture = pbrData.metallicRoughnessTexture;\n\t\t\tmaterial.metalnessMap = material.glossMap = textures[metallicRoughnessTexture.index];\n\t\t\tmaterial.metalnessMapChannel = 'b';\n\t\t\tmaterial.glossMapChannel = 'g';\n\t\t\textractTextureTransform(metallicRoughnessTexture, material, ['gloss', 'metalness']);\n\t\t}\n\t}\n\tif (gltfMaterial.hasOwnProperty('normalTexture')) {\n\t\tconst normalTexture = gltfMaterial.normalTexture;\n\t\tmaterial.normalMap = textures[normalTexture.index];\n\t\textractTextureTransform(normalTexture, material, ['normal']);\n\t\tif (normalTexture.hasOwnProperty('scale')) {\n\t\t\tmaterial.bumpiness = normalTexture.scale;\n\t\t}\n\t}\n\tif (gltfMaterial.hasOwnProperty('occlusionTexture')) {\n\t\tconst occlusionTexture = gltfMaterial.occlusionTexture;\n\t\tmaterial.aoMap = textures[occlusionTexture.index];\n\t\tmaterial.aoMapChannel = 'r';\n\t\textractTextureTransform(occlusionTexture, material, ['ao']);\n\t}\n\tif (gltfMaterial.hasOwnProperty('emissiveFactor')) {\n\t\tcolor = gltfMaterial.emissiveFactor;\n\t\tmaterial.emissive.set(Math.pow(color[0], 1 / 2.2), Math.pow(color[1], 1 / 2.2), Math.pow(color[2], 1 / 2.2));\n\t\tmaterial.emissiveTint = true;\n\t} else {\n\t\tmaterial.emissive.set(0, 0, 0);\n\t\tmaterial.emissiveTint = false;\n\t}\n\tif (gltfMaterial.hasOwnProperty('emissiveTexture')) {\n\t\tconst emissiveTexture = gltfMaterial.emissiveTexture;\n\t\tmaterial.emissiveMap = textures[emissiveTexture.index];\n\t\textractTextureTransform(emissiveTexture, material, ['emissive']);\n\t}\n\tif (gltfMaterial.hasOwnProperty('alphaMode')) {\n\t\tswitch (gltfMaterial.alphaMode) {\n\t\t\tcase 'MASK':\n\t\t\t\tmaterial.blendType = BLEND_NONE;\n\t\t\t\tif (gltfMaterial.hasOwnProperty('alphaCutoff')) {\n\t\t\t\t\tmaterial.alphaTest = gltfMaterial.alphaCutoff;\n\t\t\t\t} else {\n\t\t\t\t\tmaterial.alphaTest = 0.5;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'BLEND':\n\t\t\t\tmaterial.blendType = BLEND_NORMAL;\n\t\t\t\tmaterial.alphaTest = 1.0 / 255.0;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\tcase 'OPAQUE':\n\t\t\t\tmaterial.blendType = BLEND_NONE;\n\t\t\t\tbreak;\n\t\t}\n\t} else {\n\t\tmaterial.blendType = BLEND_NONE;\n\t}\n\tif (gltfMaterial.hasOwnProperty('doubleSided')) {\n\t\tmaterial.twoSidedLighting = gltfMaterial.doubleSided;\n\t\tmaterial.cull = gltfMaterial.doubleSided ? CULLFACE_NONE : CULLFACE_BACK;\n\t} else {\n\t\tmaterial.twoSidedLighting = false;\n\t\tmaterial.cull = CULLFACE_BACK;\n\t}\n\tconst extensions = {\n\t\t\"KHR_materials_clearcoat\": extensionClearCoat,\n\t\t\"KHR_materials_emissive_strength\": extensionEmissiveStrength,\n\t\t\"KHR_materials_ior\": extensionIor,\n\t\t\"KHR_materials_iridescence\": extensionIridescence,\n\t\t\"KHR_materials_pbrSpecularGlossiness\": extensionPbrSpecGlossiness,\n\t\t\"KHR_materials_sheen\": extensionSheen,\n\t\t\"KHR_materials_specular\": extensionSpecular,\n\t\t\"KHR_materials_transmission\": extensionTransmission,\n\t\t\"KHR_materials_unlit\": extensionUnlit,\n\t\t\"KHR_materials_volume\": extensionVolume\n\t};\n\tif (gltfMaterial.hasOwnProperty('extensions')) {\n\t\tfor (const key in gltfMaterial.extensions) {\n\t\t\tconst extensionFunc = extensions[key];\n\t\t\tif (extensionFunc !== undefined) {\n\t\t\t\textensionFunc(gltfMaterial.extensions[key], material, textures);\n\t\t\t}\n\t\t}\n\t}\n\tmaterial.update();\n\treturn material;\n};\nconst createAnimation = (gltfAnimation, animationIndex, gltfAccessors, bufferViews, nodes, meshes, gltfNodes) => {\n\tconst createAnimData = gltfAccessor => {\n\t\treturn new AnimData(getNumComponents(gltfAccessor.type), getAccessorDataFloat32(gltfAccessor, bufferViews));\n\t};\n\tconst interpMap = {\n\t\t'STEP': INTERPOLATION_STEP,\n\t\t'LINEAR': INTERPOLATION_LINEAR,\n\t\t'CUBICSPLINE': INTERPOLATION_CUBIC\n\t};\n\tconst inputMap = {};\n\tconst outputMap = {};\n\tconst curveMap = {};\n\tlet outputCounter = 1;\n\tlet i;\n\tfor (i = 0; i < gltfAnimation.samplers.length; ++i) {\n\t\tconst sampler = gltfAnimation.samplers[i];\n\t\tif (!inputMap.hasOwnProperty(sampler.input)) {\n\t\t\tinputMap[sampler.input] = createAnimData(gltfAccessors[sampler.input]);\n\t\t}\n\t\tif (!outputMap.hasOwnProperty(sampler.output)) {\n\t\t\toutputMap[sampler.output] = createAnimData(gltfAccessors[sampler.output]);\n\t\t}\n\t\tconst interpolation = sampler.hasOwnProperty('interpolation') && interpMap.hasOwnProperty(sampler.interpolation) ? interpMap[sampler.interpolation] : INTERPOLATION_LINEAR;\n\t\tconst curve = {\n\t\t\tpaths: [],\n\t\t\tinput: sampler.input,\n\t\t\toutput: sampler.output,\n\t\t\tinterpolation: interpolation\n\t\t};\n\t\tcurveMap[i] = curve;\n\t}\n\tconst quatArrays = [];\n\tconst transformSchema = {\n\t\t'translation': 'localPosition',\n\t\t'rotation': 'localRotation',\n\t\t'scale': 'localScale'\n\t};\n\tconst constructNodePath = node => {\n\t\tconst path = [];\n\t\twhile (node) {\n\t\t\tpath.unshift(node.name);\n\t\t\tnode = node.parent;\n\t\t}\n\t\treturn path;\n\t};\n\tconst createMorphTargetCurves = (curve, gltfNode, entityPath) => {\n\t\tconst out = outputMap[curve.output];\n\t\tif (!out) {\n\t\t\treturn;\n\t\t}\n\t\tlet targetNames;\n\t\tif (meshes && meshes[gltfNode.mesh]) {\n\t\t\tconst mesh = meshes[gltfNode.mesh];\n\t\t\tif (mesh.hasOwnProperty('extras') && mesh.extras.hasOwnProperty('targetNames')) {\n\t\t\t\ttargetNames = mesh.extras.targetNames;\n\t\t\t}\n\t\t}\n\t\tconst outData = out.data;\n\t\tconst morphTargetCount = outData.length / inputMap[curve.input].data.length;\n\t\tconst keyframeCount = outData.length / morphTargetCount;\n\t\tconst singleBufferSize = keyframeCount * 4;\n\t\tconst buffer = new ArrayBuffer(singleBufferSize * morphTargetCount);\n\t\tfor (let j = 0; j < morphTargetCount; j++) {\n\t\t\tvar _targetNames;\n\t\t\tconst morphTargetOutput = new Float32Array(buffer, singleBufferSize * j, keyframeCount);\n\t\t\tfor (let k = 0; k < keyframeCount; k++) {\n\t\t\t\tmorphTargetOutput[k] = outData[k * morphTargetCount + j];\n\t\t\t}\n\t\t\tconst output = new AnimData(1, morphTargetOutput);\n\t\t\tconst weightName = (_targetNames = targetNames) != null && _targetNames[j] ? `name.${targetNames[j]}` : j;\n\t\t\toutputMap[-outputCounter] = output;\n\t\t\tconst morphCurve = {\n\t\t\t\tpaths: [{\n\t\t\t\t\tentityPath: entityPath,\n\t\t\t\t\tcomponent: 'graph',\n\t\t\t\t\tpropertyPath: [`weight.${weightName}`]\n\t\t\t\t}],\n\t\t\t\tinput: curve.input,\n\t\t\t\toutput: -outputCounter,\n\t\t\t\tinterpolation: curve.interpolation\n\t\t\t};\n\t\t\toutputCounter++;\n\t\t\tcurveMap[`morphCurve-${i}-${j}`] = morphCurve;\n\t\t}\n\t};\n\tfor (i = 0; i < gltfAnimation.channels.length; ++i) {\n\t\tconst channel = gltfAnimation.channels[i];\n\t\tconst target = channel.target;\n\t\tconst curve = curveMap[channel.sampler];\n\t\tconst node = nodes[target.node];\n\t\tconst gltfNode = gltfNodes[target.node];\n\t\tconst entityPath = constructNodePath(node);\n\t\tif (target.path.startsWith('weights')) {\n\t\t\tcreateMorphTargetCurves(curve, gltfNode, entityPath);\n\t\t\tcurveMap[channel.sampler].morphCurve = true;\n\t\t} else {\n\t\t\tcurve.paths.push({\n\t\t\t\tentityPath: entityPath,\n\t\t\t\tcomponent: 'graph',\n\t\t\t\tpropertyPath: [transformSchema[target.path]]\n\t\t\t});\n\t\t}\n\t}\n\tconst inputs = [];\n\tconst outputs = [];\n\tconst curves = [];\n\tfor (const inputKey in inputMap) {\n\t\tinputs.push(inputMap[inputKey]);\n\t\tinputMap[inputKey] = inputs.length - 1;\n\t}\n\tfor (const outputKey in outputMap) {\n\t\toutputs.push(outputMap[outputKey]);\n\t\toutputMap[outputKey] = outputs.length - 1;\n\t}\n\tfor (const curveKey in curveMap) {\n\t\tconst curveData = curveMap[curveKey];\n\t\tif (curveData.morphCurve) {\n\t\t\tcontinue;\n\t\t}\n\t\tcurves.push(new AnimCurve(curveData.paths, inputMap[curveData.input], outputMap[curveData.output], curveData.interpolation));\n\t\tif (curveData.paths.length > 0 && curveData.paths[0].propertyPath[0] === 'localRotation' && curveData.interpolation !== INTERPOLATION_CUBIC) {\n\t\t\tquatArrays.push(curves[curves.length - 1].output);\n\t\t}\n\t}\n\tquatArrays.sort();\n\tlet prevIndex = null;\n\tlet data;\n\tfor (i = 0; i < quatArrays.length; ++i) {\n\t\tconst index = quatArrays[i];\n\t\tif (i === 0 || index !== prevIndex) {\n\t\t\tdata = outputs[index];\n\t\t\tif (data.components === 4) {\n\t\t\t\tconst d = data.data;\n\t\t\t\tconst len = d.length - 4;\n\t\t\t\tfor (let j = 0; j < len; j += 4) {\n\t\t\t\t\tconst dp = d[j + 0] * d[j + 4] + d[j + 1] * d[j + 5] + d[j + 2] * d[j + 6] + d[j + 3] * d[j + 7];\n\t\t\t\t\tif (dp < 0) {\n\t\t\t\t\t\td[j + 4] *= -1;\n\t\t\t\t\t\td[j + 5] *= -1;\n\t\t\t\t\t\td[j + 6] *= -1;\n\t\t\t\t\t\td[j + 7] *= -1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tprevIndex = index;\n\t\t}\n\t}\n\tlet duration = 0;\n\tfor (i = 0; i < inputs.length; i++) {\n\t\tdata = inputs[i]._data;\n\t\tduration = Math.max(duration, data.length === 0 ? 0 : data[data.length - 1]);\n\t}\n\treturn new AnimTrack(gltfAnimation.hasOwnProperty('name') ? gltfAnimation.name : 'animation_' + animationIndex, duration, inputs, outputs, curves);\n};\nconst tempMat = new Mat4();\nconst tempVec = new Vec3();\nconst createNode = (gltfNode, nodeIndex) => {\n\tconst entity = new GraphNode();\n\tif (gltfNode.hasOwnProperty('name') && gltfNode.name.length > 0) {\n\t\tentity.name = gltfNode.name;\n\t} else {\n\t\tentity.name = 'node_' + nodeIndex;\n\t}\n\tif (gltfNode.hasOwnProperty('matrix')) {\n\t\ttempMat.data.set(gltfNode.matrix);\n\t\ttempMat.getTranslation(tempVec);\n\t\tentity.setLocalPosition(tempVec);\n\t\ttempMat.getEulerAngles(tempVec);\n\t\tentity.setLocalEulerAngles(tempVec);\n\t\ttempMat.getScale(tempVec);\n\t\tentity.setLocalScale(tempVec);\n\t}\n\tif (gltfNode.hasOwnProperty('rotation')) {\n\t\tconst r = gltfNode.rotation;\n\t\tentity.setLocalRotation(r[0], r[1], r[2], r[3]);\n\t}\n\tif (gltfNode.hasOwnProperty('translation')) {\n\t\tconst t = gltfNode.translation;\n\t\tentity.setLocalPosition(t[0], t[1], t[2]);\n\t}\n\tif (gltfNode.hasOwnProperty('scale')) {\n\t\tconst s = gltfNode.scale;\n\t\tentity.setLocalScale(s[0], s[1], s[2]);\n\t}\n\treturn entity;\n};\nconst createCamera = (gltfCamera, node) => {\n\tconst projection = gltfCamera.type === 'orthographic' ? PROJECTION_ORTHOGRAPHIC : PROJECTION_PERSPECTIVE;\n\tconst gltfProperties = projection === PROJECTION_ORTHOGRAPHIC ? gltfCamera.orthographic : gltfCamera.perspective;\n\tconst componentData = {\n\t\tenabled: false,\n\t\tprojection: projection,\n\t\tnearClip: gltfProperties.znear,\n\t\taspectRatioMode: ASPECT_AUTO\n\t};\n\tif (gltfProperties.zfar) {\n\t\tcomponentData.farClip = gltfProperties.zfar;\n\t}\n\tif (projection === PROJECTION_ORTHOGRAPHIC) {\n\t\tcomponentData.orthoHeight = 0.5 * gltfProperties.ymag;\n\t\tif (gltfProperties.ymag) {\n\t\t\tcomponentData.aspectRatioMode = ASPECT_MANUAL;\n\t\t\tcomponentData.aspectRatio = gltfProperties.xmag / gltfProperties.ymag;\n\t\t}\n\t} else {\n\t\tcomponentData.fov = gltfProperties.yfov * math.RAD_TO_DEG;\n\t\tif (gltfProperties.aspectRatio) {\n\t\t\tcomponentData.aspectRatioMode = ASPECT_MANUAL;\n\t\t\tcomponentData.aspectRatio = gltfProperties.aspectRatio;\n\t\t}\n\t}\n\tconst cameraEntity = new Entity(gltfCamera.name);\n\tcameraEntity.addComponent('camera', componentData);\n\treturn cameraEntity;\n};\nconst createLight = (gltfLight, node) => {\n\tconst lightProps = {\n\t\tenabled: false,\n\t\ttype: gltfLight.type === 'point' ? 'omni' : gltfLight.type,\n\t\tcolor: gltfLight.hasOwnProperty('color') ? new Color(gltfLight.color) : Color.WHITE,\n\t\trange: gltfLight.hasOwnProperty('range') ? gltfLight.range : 9999,\n\t\tfalloffMode: LIGHTFALLOFF_INVERSESQUARED,\n\t\tintensity: gltfLight.hasOwnProperty('intensity') ? math.clamp(gltfLight.intensity, 0, 2) : 1\n\t};\n\tif (gltfLight.hasOwnProperty('spot')) {\n\t\tlightProps.innerConeAngle = gltfLight.spot.hasOwnProperty('innerConeAngle') ? gltfLight.spot.innerConeAngle * math.RAD_TO_DEG : 0;\n\t\tlightProps.outerConeAngle = gltfLight.spot.hasOwnProperty('outerConeAngle') ? gltfLight.spot.outerConeAngle * math.RAD_TO_DEG : Math.PI / 4;\n\t}\n\tif (gltfLight.hasOwnProperty(\"intensity\")) {\n\t\tlightProps.luminance = gltfLight.intensity * Light.getLightUnitConversion(lightTypes[lightProps.type], lightProps.outerConeAngle, lightProps.innerConeAngle);\n\t}\n\tconst lightEntity = new Entity(node.name);\n\tlightEntity.rotateLocal(90, 0, 0);\n\tlightEntity.addComponent('light', lightProps);\n\treturn lightEntity;\n};\nconst createSkins = (device, gltf, nodes, bufferViews) => {\n\tif (!gltf.hasOwnProperty('skins') || gltf.skins.length === 0) {\n\t\treturn [];\n\t}\n\tconst glbSkins = new Map();\n\treturn gltf.skins.map(gltfSkin => {\n\t\treturn createSkin(device, gltfSkin, gltf.accessors, bufferViews, nodes, glbSkins);\n\t});\n};\nconst createMeshes = (device, gltf, bufferViews, flipV, options) => {\n\tvar _gltf$meshes, _gltf$accessors, _gltf$bufferViews;\n\tconst vertexBufferDict = {};\n\tconst meshVariants = {};\n\tconst meshDefaultMaterials = {};\n\tconst promises = [];\n\tconst valid = !options.skipMeshes && (gltf == null || (_gltf$meshes = gltf.meshes) == null ? void 0 : _gltf$meshes.length) && (gltf == null || (_gltf$accessors = gltf.accessors) == null ? void 0 : _gltf$accessors.length) && (gltf == null || (_gltf$bufferViews = gltf.bufferViews) == null ? void 0 : _gltf$bufferViews.length);\n\tconst meshes = valid ? gltf.meshes.map(gltfMesh => {\n\t\treturn createMesh(device, gltfMesh, gltf.accessors, bufferViews, flipV, vertexBufferDict, meshVariants, meshDefaultMaterials, options, promises);\n\t}) : [];\n\treturn {\n\t\tmeshes,\n\t\tmeshVariants,\n\t\tmeshDefaultMaterials,\n\t\tpromises\n\t};\n};\nconst createMaterials = (gltf, textures, options, flipV) => {\n\tvar _options$material, _options$material$pro, _options$material2, _options$material3;\n\tif (!gltf.hasOwnProperty('materials') || gltf.materials.length === 0) {\n\t\treturn [];\n\t}\n\tconst preprocess = options == null || (_options$material = options.material) == null ? void 0 : _options$material.preprocess;\n\tconst process = (_options$material$pro = options == null || (_options$material2 = options.material) == null ? void 0 : _options$material2.process) != null ? _options$material$pro : createMaterial;\n\tconst postprocess = options == null || (_options$material3 = options.material) == null ? void 0 : _options$material3.postprocess;\n\treturn gltf.materials.map(gltfMaterial => {\n\t\tif (preprocess) {\n\t\t\tpreprocess(gltfMaterial);\n\t\t}\n\t\tconst material = process(gltfMaterial, textures, flipV);\n\t\tif (postprocess) {\n\t\t\tpostprocess(gltfMaterial, material);\n\t\t}\n\t\treturn material;\n\t});\n};\nconst createVariants = gltf => {\n\tif (!gltf.hasOwnProperty(\"extensions\") || !gltf.extensions.hasOwnProperty(\"KHR_materials_variants\")) return null;\n\tconst data = gltf.extensions.KHR_materials_variants.variants;\n\tconst variants = {};\n\tfor (let i = 0; i < data.length; i++) {\n\t\tvariants[data[i].name] = i;\n\t}\n\treturn variants;\n};\nconst createAnimations = (gltf, nodes, bufferViews, options) => {\n\tvar _options$animation, _options$animation2;\n\tif (!gltf.hasOwnProperty('animations') || gltf.animations.length === 0) {\n\t\treturn [];\n\t}\n\tconst preprocess = options == null || (_options$animation = options.animation) == null ? void 0 : _options$animation.preprocess;\n\tconst postprocess = options == null || (_options$animation2 = options.animation) == null ? void 0 : _options$animation2.postprocess;\n\treturn gltf.animations.map((gltfAnimation, index) => {\n\t\tif (preprocess) {\n\t\t\tpreprocess(gltfAnimation);\n\t\t}\n\t\tconst animation = createAnimation(gltfAnimation, index, gltf.accessors, bufferViews, nodes, gltf.meshes, gltf.nodes);\n\t\tif (postprocess) {\n\t\t\tpostprocess(gltfAnimation, animation);\n\t\t}\n\t\treturn animation;\n\t});\n};\nconst createNodes = (gltf, options) => {\n\tvar _options$node, _options$node$process, _options$node2, _options$node3;\n\tif (!gltf.hasOwnProperty('nodes') || gltf.nodes.length === 0) {\n\t\treturn [];\n\t}\n\tconst preprocess = options == null || (_options$node = options.node) == null ? void 0 : _options$node.preprocess;\n\tconst process = (_options$node$process = options == null || (_options$node2 = options.node) == null ? void 0 : _options$node2.process) != null ? _options$node$process : createNode;\n\tconst postprocess = options == null || (_options$node3 = options.node) == null ? void 0 : _options$node3.postprocess;\n\tconst nodes = gltf.nodes.map((gltfNode, index) => {\n\t\tif (preprocess) {\n\t\t\tpreprocess(gltfNode);\n\t\t}\n\t\tconst node = process(gltfNode, index);\n\t\tif (postprocess) {\n\t\t\tpostprocess(gltfNode, node);\n\t\t}\n\t\treturn node;\n\t});\n\tfor (let i = 0; i < gltf.nodes.length; ++i) {\n\t\tconst gltfNode = gltf.nodes[i];\n\t\tif (gltfNode.hasOwnProperty('children')) {\n\t\t\tconst parent = nodes[i];\n\t\t\tconst uniqueNames = {};\n\t\t\tfor (let j = 0; j < gltfNode.children.length; ++j) {\n\t\t\t\tconst child = nodes[gltfNode.children[j]];\n\t\t\t\tif (!child.parent) {\n\t\t\t\t\tif (uniqueNames.hasOwnProperty(child.name)) {\n\t\t\t\t\t\tchild.name += uniqueNames[child.name]++;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tuniqueNames[child.name] = 1;\n\t\t\t\t\t}\n\t\t\t\t\tparent.addChild(child);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn nodes;\n};\nconst createScenes = (gltf, nodes) => {\n\tvar _gltf$scenes$0$nodes;\n\tconst scenes = [];\n\tconst count = gltf.scenes.length;\n\tif (count === 1 && ((_gltf$scenes$0$nodes = gltf.scenes[0].nodes) == null ? void 0 : _gltf$scenes$0$nodes.length) === 1) {\n\t\tconst nodeIndex = gltf.scenes[0].nodes[0];\n\t\tscenes.push(nodes[nodeIndex]);\n\t} else {\n\t\tfor (let i = 0; i < count; i++) {\n\t\t\tconst scene = gltf.scenes[i];\n\t\t\tif (scene.nodes) {\n\t\t\t\tconst sceneRoot = new GraphNode(scene.name);\n\t\t\t\tfor (let n = 0; n < scene.nodes.length; n++) {\n\t\t\t\t\tconst childNode = nodes[scene.nodes[n]];\n\t\t\t\t\tsceneRoot.addChild(childNode);\n\t\t\t\t}\n\t\t\t\tscenes.push(sceneRoot);\n\t\t\t}\n\t\t}\n\t}\n\treturn scenes;\n};\nconst createCameras = (gltf, nodes, options) => {\n\tlet cameras = null;\n\tif (gltf.hasOwnProperty('nodes') && gltf.hasOwnProperty('cameras') && gltf.cameras.length > 0) {\n\t\tvar _options$camera, _options$camera$proce, _options$camera2, _options$camera3;\n\t\tconst preprocess = options == null || (_options$camera = options.camera) == null ? void 0 : _options$camera.preprocess;\n\t\tconst process = (_options$camera$proce = options == null || (_options$camera2 = options.camera) == null ? void 0 : _options$camera2.process) != null ? _options$camera$proce : createCamera;\n\t\tconst postprocess = options == null || (_options$camera3 = options.camera) == null ? void 0 : _options$camera3.postprocess;\n\t\tgltf.nodes.forEach((gltfNode, nodeIndex) => {\n\t\t\tif (gltfNode.hasOwnProperty('camera')) {\n\t\t\t\tconst gltfCamera = gltf.cameras[gltfNode.camera];\n\t\t\t\tif (gltfCamera) {\n\t\t\t\t\tif (preprocess) {\n\t\t\t\t\t\tpreprocess(gltfCamera);\n\t\t\t\t\t}\n\t\t\t\t\tconst camera = process(gltfCamera, nodes[nodeIndex]);\n\t\t\t\t\tif (postprocess) {\n\t\t\t\t\t\tpostprocess(gltfCamera, camera);\n\t\t\t\t\t}\n\t\t\t\t\tif (camera) {\n\t\t\t\t\t\tif (!cameras) cameras = new Map();\n\t\t\t\t\t\tcameras.set(gltfNode, camera);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\treturn cameras;\n};\nconst createLights = (gltf, nodes, options) => {\n\tlet lights = null;\n\tif (gltf.hasOwnProperty('nodes') && gltf.hasOwnProperty('extensions') && gltf.extensions.hasOwnProperty('KHR_lights_punctual') && gltf.extensions.KHR_lights_punctual.hasOwnProperty('lights')) {\n\t\tconst gltfLights = gltf.extensions.KHR_lights_punctual.lights;\n\t\tif (gltfLights.length) {\n\t\t\tvar _options$light, _options$light$proces, _options$light2, _options$light3;\n\t\t\tconst preprocess = options == null || (_options$light = options.light) == null ? void 0 : _options$light.preprocess;\n\t\t\tconst process = (_options$light$proces = options == null || (_options$light2 = options.light) == null ? void 0 : _options$light2.process) != null ? _options$light$proces : createLight;\n\t\t\tconst postprocess = options == null || (_options$light3 = options.light) == null ? void 0 : _options$light3.postprocess;\n\t\t\tgltf.nodes.forEach((gltfNode, nodeIndex) => {\n\t\t\t\tif (gltfNode.hasOwnProperty('extensions') && gltfNode.extensions.hasOwnProperty('KHR_lights_punctual') && gltfNode.extensions.KHR_lights_punctual.hasOwnProperty('light')) {\n\t\t\t\t\tconst lightIndex = gltfNode.extensions.KHR_lights_punctual.light;\n\t\t\t\t\tconst gltfLight = gltfLights[lightIndex];\n\t\t\t\t\tif (gltfLight) {\n\t\t\t\t\t\tif (preprocess) {\n\t\t\t\t\t\t\tpreprocess(gltfLight);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst light = process(gltfLight, nodes[nodeIndex]);\n\t\t\t\t\t\tif (postprocess) {\n\t\t\t\t\t\t\tpostprocess(gltfLight, light);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (light) {\n\t\t\t\t\t\t\tif (!lights) lights = new Map();\n\t\t\t\t\t\t\tlights.set(gltfNode, light);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\treturn lights;\n};\nconst linkSkins = (gltf, renders, skins) => {\n\tgltf.nodes.forEach(gltfNode => {\n\t\tif (gltfNode.hasOwnProperty('mesh') && gltfNode.hasOwnProperty('skin')) {\n\t\t\tconst meshGroup = renders[gltfNode.mesh].meshes;\n\t\t\tmeshGroup.forEach(mesh => {\n\t\t\t\tmesh.skin = skins[gltfNode.skin];\n\t\t\t});\n\t\t}\n\t});\n};\nconst createResources = async (device, gltf, bufferViews, textures, options) => {\n\tvar _options$global, _options$global2;\n\tconst preprocess = options == null || (_options$global = options.global) == null ? void 0 : _options$global.preprocess;\n\tconst postprocess = options == null || (_options$global2 = options.global) == null ? void 0 : _options$global2.postprocess;\n\tif (preprocess) {\n\t\tpreprocess(gltf);\n\t}\n\tconst flipV = gltf.asset && gltf.asset.generator === 'PlayCanvas';\n\tconst nodes = createNodes(gltf, options);\n\tconst scenes = createScenes(gltf, nodes);\n\tconst lights = createLights(gltf, nodes, options);\n\tconst cameras = createCameras(gltf, nodes, options);\n\tconst variants = createVariants(gltf);\n\tconst bufferViewData = await Promise.all(bufferViews);\n\tconst {\n\t\tmeshes,\n\t\tmeshVariants,\n\t\tmeshDefaultMaterials,\n\t\tpromises\n\t} = createMeshes(device, gltf, bufferViewData, flipV, options);\n\tconst animations = createAnimations(gltf, nodes, bufferViewData, options);\n\tconst textureAssets = await Promise.all(textures);\n\tconst textureInstances = textureAssets.map(t => t.resource);\n\tconst materials = createMaterials(gltf, textureInstances, options, flipV);\n\tconst skins = createSkins(device, gltf, nodes, bufferViewData);\n\tconst renders = [];\n\tfor (let i = 0; i < meshes.length; i++) {\n\t\trenders[i] = new Render();\n\t\trenders[i].meshes = meshes[i];\n\t}\n\tlinkSkins(gltf, renders, skins);\n\tconst result = new GlbResources();\n\tresult.gltf = gltf;\n\tresult.nodes = nodes;\n\tresult.scenes = scenes;\n\tresult.animations = animations;\n\tresult.textures = textureAssets;\n\tresult.materials = materials;\n\tresult.variants = variants;\n\tresult.meshVariants = meshVariants;\n\tresult.meshDefaultMaterials = meshDefaultMaterials;\n\tresult.renders = renders;\n\tresult.skins = skins;\n\tresult.lights = lights;\n\tresult.cameras = cameras;\n\tif (postprocess) {\n\t\tpostprocess(gltf, result);\n\t}\n\tawait Promise.all(promises);\n\treturn result;\n};\nconst applySampler = (texture, gltfSampler) => {\n\tconst getFilter = (filter, defaultValue) => {\n\t\tswitch (filter) {\n\t\t\tcase 9728:\n\t\t\t\treturn FILTER_NEAREST;\n\t\t\tcase 9729:\n\t\t\t\treturn FILTER_LINEAR;\n\t\t\tcase 9984:\n\t\t\t\treturn FILTER_NEAREST_MIPMAP_NEAREST;\n\t\t\tcase 9985:\n\t\t\t\treturn FILTER_LINEAR_MIPMAP_NEAREST;\n\t\t\tcase 9986:\n\t\t\t\treturn FILTER_NEAREST_MIPMAP_LINEAR;\n\t\t\tcase 9987:\n\t\t\t\treturn FILTER_LINEAR_MIPMAP_LINEAR;\n\t\t\tdefault:\n\t\t\t\treturn defaultValue;\n\t\t}\n\t};\n\tconst getWrap = (wrap, defaultValue) => {\n\t\tswitch (wrap) {\n\t\t\tcase 33071:\n\t\t\t\treturn ADDRESS_CLAMP_TO_EDGE;\n\t\t\tcase 33648:\n\t\t\t\treturn ADDRESS_MIRRORED_REPEAT;\n\t\t\tcase 10497:\n\t\t\t\treturn ADDRESS_REPEAT;\n\t\t\tdefault:\n\t\t\t\treturn defaultValue;\n\t\t}\n\t};\n\tif (texture) {\n\t\tvar _gltfSampler;\n\t\tgltfSampler = (_gltfSampler = gltfSampler) != null ? _gltfSampler : {};\n\t\ttexture.minFilter = getFilter(gltfSampler.minFilter, FILTER_LINEAR_MIPMAP_LINEAR);\n\t\ttexture.magFilter = getFilter(gltfSampler.magFilter, FILTER_LINEAR);\n\t\ttexture.addressU = getWrap(gltfSampler.wrapS, ADDRESS_REPEAT);\n\t\ttexture.addressV = getWrap(gltfSampler.wrapT, ADDRESS_REPEAT);\n\t}\n};\nlet gltfTextureUniqueId = 0;\nconst createImages = (gltf, bufferViews, urlBase, registry, options) => {\n\tvar _options$image, _options$image2, _options$image3;\n\tif (!gltf.images || gltf.images.length === 0) {\n\t\treturn [];\n\t}\n\tconst preprocess = options == null || (_options$image = options.image) == null ? void 0 : _options$image.preprocess;\n\tconst processAsync = options == null || (_options$image2 = options.image) == null ? void 0 : _options$image2.processAsync;\n\tconst postprocess = options == null || (_options$image3 = options.image) == null ? void 0 : _options$image3.postprocess;\n\tconst mimeTypeFileExtensions = {\n\t\t'image/png': 'png',\n\t\t'image/jpeg': 'jpg',\n\t\t'image/basis': 'basis',\n\t\t'image/ktx': 'ktx',\n\t\t'image/ktx2': 'ktx2',\n\t\t'image/vnd-ms.dds': 'dds'\n\t};\n\tconst loadTexture = (gltfImage, url, bufferView, mimeType, options) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst continuation = bufferViewData => {\n\t\t\t\tconst name = (gltfImage.name || 'gltf-texture') + '-' + gltfTextureUniqueId++;\n\t\t\t\tconst file = {\n\t\t\t\t\turl: url || name\n\t\t\t\t};\n\t\t\t\tif (bufferViewData) {\n\t\t\t\t\tfile.contents = bufferViewData.slice(0).buffer;\n\t\t\t\t}\n\t\t\t\tif (mimeType) {\n\t\t\t\t\tconst extension = mimeTypeFileExtensions[mimeType];\n\t\t\t\t\tif (extension) {\n\t\t\t\t\t\tfile.filename = file.url + '.' + extension;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconst asset = new Asset(name, 'texture', file, null, options);\n\t\t\t\tasset.on('load', asset => resolve(asset));\n\t\t\t\tasset.on('error', err => reject(err));\n\t\t\t\tregistry.add(asset);\n\t\t\t\tregistry.load(asset);\n\t\t\t};\n\t\t\tif (bufferView) {\n\t\t\t\tbufferView.then(bufferViewData => continuation(bufferViewData));\n\t\t\t} else {\n\t\t\t\tcontinuation(null);\n\t\t\t}\n\t\t});\n\t};\n\treturn gltf.images.map((gltfImage, i) => {\n\t\tif (preprocess) {\n\t\t\tpreprocess(gltfImage);\n\t\t}\n\t\tlet promise;\n\t\tif (processAsync) {\n\t\t\tpromise = new Promise((resolve, reject) => {\n\t\t\t\tprocessAsync(gltfImage, (err, textureAsset) => {\n\t\t\t\t\tif (err) reject(err);else resolve(textureAsset);\n\t\t\t\t});\n\t\t\t});\n\t\t} else {\n\t\t\tpromise = new Promise(resolve => {\n\t\t\t\tresolve(null);\n\t\t\t});\n\t\t}\n\t\tpromise = promise.then(textureAsset => {\n\t\t\tif (textureAsset) {\n\t\t\t\treturn textureAsset;\n\t\t\t} else if (gltfImage.hasOwnProperty('uri')) {\n\t\t\t\tif (isDataURI(gltfImage.uri)) {\n\t\t\t\t\treturn loadTexture(gltfImage, gltfImage.uri, null, getDataURIMimeType(gltfImage.uri), null);\n\t\t\t\t}\n\t\t\t\treturn loadTexture(gltfImage, ABSOLUTE_URL.test(gltfImage.uri) ? gltfImage.uri : path.join(urlBase, gltfImage.uri), null, null, {\n\t\t\t\t\tcrossOrigin: 'anonymous'\n\t\t\t\t});\n\t\t\t} else if (gltfImage.hasOwnProperty('bufferView') && gltfImage.hasOwnProperty('mimeType')) {\n\t\t\t\treturn loadTexture(gltfImage, null, bufferViews[gltfImage.bufferView], gltfImage.mimeType, null);\n\t\t\t}\n\t\t\treturn Promise.reject(new Error(`Invalid image found in gltf (neither uri or bufferView found). index=${i}`));\n\t\t});\n\t\tif (postprocess) {\n\t\t\tpromise = promise.then(textureAsset => {\n\t\t\t\tpostprocess(gltfImage, textureAsset);\n\t\t\t\treturn textureAsset;\n\t\t\t});\n\t\t}\n\t\treturn promise;\n\t});\n};\nconst createTextures = (gltf, images, options) => {\n\tvar _gltf$images, _gltf$textures, _options$texture, _options$texture2, _options$texture3;\n\tif (!(gltf != null && (_gltf$images = gltf.images) != null && _gltf$images.length) || !(gltf != null && (_gltf$textures = gltf.textures) != null && _gltf$textures.length)) {\n\t\treturn [];\n\t}\n\tconst preprocess = options == null || (_options$texture = options.texture) == null ? void 0 : _options$texture.preprocess;\n\tconst processAsync = options == null || (_options$texture2 = options.texture) == null ? void 0 : _options$texture2.processAsync;\n\tconst postprocess = options == null || (_options$texture3 = options.texture) == null ? void 0 : _options$texture3.postprocess;\n\tconst seenImages = new Set();\n\treturn gltf.textures.map(gltfTexture => {\n\t\tif (preprocess) {\n\t\t\tpreprocess(gltfTexture);\n\t\t}\n\t\tlet promise;\n\t\tif (processAsync) {\n\t\t\tpromise = new Promise((resolve, reject) => {\n\t\t\t\tprocessAsync(gltfTexture, gltf.images, (err, gltfImageIndex) => {\n\t\t\t\t\tif (err) reject(err);else resolve(gltfImageIndex);\n\t\t\t\t});\n\t\t\t});\n\t\t} else {\n\t\t\tpromise = new Promise(resolve => {\n\t\t\t\tresolve(null);\n\t\t\t});\n\t\t}\n\t\tpromise = promise.then(gltfImageIndex => {\n\t\t\tvar _ref, _ref2, _gltfImageIndex, _gltfTexture$extensio, _gltfTexture$extensio2;\n\t\t\tgltfImageIndex = (_ref = (_ref2 = (_gltfImageIndex = gltfImageIndex) != null ? _gltfImageIndex : gltfTexture == null || (_gltfTexture$extensio = gltfTexture.extensions) == null || (_gltfTexture$extensio = _gltfTexture$extensio.KHR_texture_basisu) == null ? void 0 : _gltfTexture$extensio.source) != null ? _ref2 : gltfTexture == null || (_gltfTexture$extensio2 = gltfTexture.extensions) == null || (_gltfTexture$extensio2 = _gltfTexture$extensio2.EXT_texture_webp) == null ? void 0 : _gltfTexture$extensio2.source) != null ? _ref : gltfTexture.source;\n\t\t\tconst cloneAsset = seenImages.has(gltfImageIndex);\n\t\t\tseenImages.add(gltfImageIndex);\n\t\t\treturn images[gltfImageIndex].then(imageAsset => {\n\t\t\t\tvar _gltf$samplers;\n\t\t\t\tconst asset = cloneAsset ? cloneTextureAsset(imageAsset) : imageAsset;\n\t\t\t\tapplySampler(asset.resource, ((_gltf$samplers = gltf.samplers) != null ? _gltf$samplers : [])[gltfTexture.sampler]);\n\t\t\t\treturn asset;\n\t\t\t});\n\t\t});\n\t\tif (postprocess) {\n\t\t\tpromise = promise.then(textureAsset => {\n\t\t\t\tpostprocess(gltfTexture, textureAsset);\n\t\t\t\treturn textureAsset;\n\t\t\t});\n\t\t}\n\t\treturn promise;\n\t});\n};\nconst loadBuffers = (gltf, binaryChunk, urlBase, options) => {\n\tvar _options$buffer, _options$buffer2, _options$buffer3;\n\tif (!gltf.buffers || gltf.buffers.length === 0) {\n\t\treturn [];\n\t}\n\tconst preprocess = options == null || (_options$buffer = options.buffer) == null ? void 0 : _options$buffer.preprocess;\n\tconst processAsync = options == null || (_options$buffer2 = options.buffer) == null ? void 0 : _options$buffer2.processAsync;\n\tconst postprocess = options == null || (_options$buffer3 = options.buffer) == null ? void 0 : _options$buffer3.postprocess;\n\treturn gltf.buffers.map((gltfBuffer, i) => {\n\t\tif (preprocess) {\n\t\t\tpreprocess(gltfBuffer);\n\t\t}\n\t\tlet promise;\n\t\tif (processAsync) {\n\t\t\tpromise = new Promise((resolve, reject) => {\n\t\t\t\tprocessAsync(gltfBuffer, (err, arrayBuffer) => {\n\t\t\t\t\tif (err) reject(err);else resolve(arrayBuffer);\n\t\t\t\t});\n\t\t\t});\n\t\t} else {\n\t\t\tpromise = new Promise(resolve => {\n\t\t\t\tresolve(null);\n\t\t\t});\n\t\t}\n\t\tpromise = promise.then(arrayBuffer => {\n\t\t\tif (arrayBuffer) {\n\t\t\t\treturn arrayBuffer;\n\t\t\t} else if (gltfBuffer.hasOwnProperty('uri')) {\n\t\t\t\tif (isDataURI(gltfBuffer.uri)) {\n\t\t\t\t\tconst byteString = atob(gltfBuffer.uri.split(',')[1]);\n\t\t\t\t\tconst binaryArray = new Uint8Array(byteString.length);\n\t\t\t\t\tfor (let j = 0; j < byteString.length; j++) {\n\t\t\t\t\t\tbinaryArray[j] = byteString.charCodeAt(j);\n\t\t\t\t\t}\n\t\t\t\t\treturn binaryArray;\n\t\t\t\t}\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\thttp.get(ABSOLUTE_URL.test(gltfBuffer.uri) ? gltfBuffer.uri : path.join(urlBase, gltfBuffer.uri), {\n\t\t\t\t\t\tcache: true,\n\t\t\t\t\t\tresponseType: 'arraybuffer',\n\t\t\t\t\t\tretry: false\n\t\t\t\t\t}, (err, result) => {\n\t\t\t\t\t\tif (err) reject(err);else resolve(new Uint8Array(result));\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn binaryChunk;\n\t\t});\n\t\tif (postprocess) {\n\t\t\tpromise = promise.then(buffer => {\n\t\t\t\tpostprocess(gltf.buffers[i], buffer);\n\t\t\t\treturn buffer;\n\t\t\t});\n\t\t}\n\t\treturn promise;\n\t});\n};\nconst parseGltf = (gltfChunk, callback) => {\n\tconst decodeBinaryUtf8 = array => {\n\t\tif (typeof TextDecoder !== 'undefined') {\n\t\t\treturn new TextDecoder().decode(array);\n\t\t}\n\t\tlet str = '';\n\t\tfor (let i = 0; i < array.length; i++) {\n\t\t\tstr += String.fromCharCode(array[i]);\n\t\t}\n\t\treturn decodeURIComponent(escape(str));\n\t};\n\tconst gltf = JSON.parse(decodeBinaryUtf8(gltfChunk));\n\tif (gltf.asset && gltf.asset.version && parseFloat(gltf.asset.version) < 2) {\n\t\tcallback(`Invalid gltf version. Expected version 2.0 or above but found version '${gltf.asset.version}'.`);\n\t\treturn;\n\t}\n\tcallback(null, gltf);\n};\nconst parseGlb = (glbData, callback) => {\n\tconst data = glbData instanceof ArrayBuffer ? new DataView(glbData) : new DataView(glbData.buffer, glbData.byteOffset, glbData.byteLength);\n\tconst magic = data.getUint32(0, true);\n\tconst version = data.getUint32(4, true);\n\tconst length = data.getUint32(8, true);\n\tif (magic !== 0x46546C67) {\n\t\tcallback('Invalid magic number found in glb header. Expected 0x46546C67, found 0x' + magic.toString(16));\n\t\treturn;\n\t}\n\tif (version !== 2) {\n\t\tcallback('Invalid version number found in glb header. Expected 2, found ' + version);\n\t\treturn;\n\t}\n\tif (length <= 0 || length > data.byteLength) {\n\t\tcallback('Invalid length found in glb header. Found ' + length);\n\t\treturn;\n\t}\n\tconst chunks = [];\n\tlet offset = 12;\n\twhile (offset < length) {\n\t\tconst chunkLength = data.getUint32(offset, true);\n\t\tif (offset + chunkLength + 8 > data.byteLength) {\n\t\t\tcallback(`Invalid chunk length found in glb. Found ${chunkLength}`);\n\t\t}\n\t\tconst chunkType = data.getUint32(offset + 4, true);\n\t\tconst chunkData = new Uint8Array(data.buffer, data.byteOffset + offset + 8, chunkLength);\n\t\tchunks.push({\n\t\t\tlength: chunkLength,\n\t\t\ttype: chunkType,\n\t\t\tdata: chunkData\n\t\t});\n\t\toffset += chunkLength + 8;\n\t}\n\tif (chunks.length !== 1 && chunks.length !== 2) {\n\t\tcallback('Invalid number of chunks found in glb file.');\n\t\treturn;\n\t}\n\tif (chunks[0].type !== 0x4E4F534A) {\n\t\tcallback(`Invalid chunk type found in glb file. Expected 0x4E4F534A, found 0x${chunks[0].type.toString(16)}`);\n\t\treturn;\n\t}\n\tif (chunks.length > 1 && chunks[1].type !== 0x004E4942) {\n\t\tcallback(`Invalid chunk type found in glb file. Expected 0x004E4942, found 0x${chunks[1].type.toString(16)}`);\n\t\treturn;\n\t}\n\tcallback(null, {\n\t\tgltfChunk: chunks[0].data,\n\t\tbinaryChunk: chunks.length === 2 ? chunks[1].data : null\n\t});\n};\nconst parseChunk = (filename, data, callback) => {\n\tconst hasGlbHeader = () => {\n\t\tconst u8 = new Uint8Array(data);\n\t\treturn u8[0] === 103 && u8[1] === 108 && u8[2] === 84 && u8[3] === 70;\n\t};\n\tif (filename && filename.toLowerCase().endsWith('.glb') || hasGlbHeader()) {\n\t\tparseGlb(data, callback);\n\t} else {\n\t\tcallback(null, {\n\t\t\tgltfChunk: data,\n\t\t\tbinaryChunk: null\n\t\t});\n\t}\n};\nconst createBufferViews = (gltf, buffers, options) => {\n\tvar _options$bufferView, _options$bufferView2, _options$bufferView3, _gltf$bufferViews2;\n\tconst result = [];\n\tconst preprocess = options == null || (_options$bufferView = options.bufferView) == null ? void 0 : _options$bufferView.preprocess;\n\tconst processAsync = options == null || (_options$bufferView2 = options.bufferView) == null ? void 0 : _options$bufferView2.processAsync;\n\tconst postprocess = options == null || (_options$bufferView3 = options.bufferView) == null ? void 0 : _options$bufferView3.postprocess;\n\tif (!((_gltf$bufferViews2 = gltf.bufferViews) != null && _gltf$bufferViews2.length)) {\n\t\treturn result;\n\t}\n\tfor (let i = 0; i < gltf.bufferViews.length; ++i) {\n\t\tconst gltfBufferView = gltf.bufferViews[i];\n\t\tif (preprocess) {\n\t\t\tpreprocess(gltfBufferView);\n\t\t}\n\t\tlet promise;\n\t\tif (processAsync) {\n\t\t\tpromise = new Promise((resolve, reject) => {\n\t\t\t\tprocessAsync(gltfBufferView, buffers, (err, result) => {\n\t\t\t\t\tif (err) reject(err);else resolve(result);\n\t\t\t\t});\n\t\t\t});\n\t\t} else {\n\t\t\tpromise = new Promise(resolve => {\n\t\t\t\tresolve(null);\n\t\t\t});\n\t\t}\n\t\tpromise = promise.then(buffer => {\n\t\t\tif (buffer) {\n\t\t\t\treturn buffer;\n\t\t\t}\n\t\t\treturn buffers[gltfBufferView.buffer].then(buffer => {\n\t\t\t\treturn new Uint8Array(buffer.buffer, buffer.byteOffset + (gltfBufferView.byteOffset || 0), gltfBufferView.byteLength);\n\t\t\t});\n\t\t});\n\t\tif (gltfBufferView.hasOwnProperty('byteStride')) {\n\t\t\tpromise = promise.then(typedArray => {\n\t\t\t\ttypedArray.byteStride = gltfBufferView.byteStride;\n\t\t\t\treturn typedArray;\n\t\t\t});\n\t\t}\n\t\tif (postprocess) {\n\t\t\tpromise = promise.then(typedArray => {\n\t\t\t\tpostprocess(gltfBufferView, typedArray);\n\t\t\t\treturn typedArray;\n\t\t\t});\n\t\t}\n\t\tresult.push(promise);\n\t}\n\treturn result;\n};\nclass GlbParser {\n\tstatic parse(filename, urlBase, data, device, registry, options, callback) {\n\t\tparseChunk(filename, data, (err, chunks) => {\n\t\t\tif (err) {\n\t\t\t\tcallback(err);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tparseGltf(chunks.gltfChunk, (err, gltf) => {\n\t\t\t\tif (err) {\n\t\t\t\t\tcallback(err);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst buffers = loadBuffers(gltf, chunks.binaryChunk, urlBase, options);\n\t\t\t\tconst bufferViews = createBufferViews(gltf, buffers, options);\n\t\t\t\tconst images = createImages(gltf, bufferViews, urlBase, registry, options);\n\t\t\t\tconst textures = createTextures(gltf, images, options);\n\t\t\t\tcreateResources(device, gltf, bufferViews, textures, options).then(result => callback(null, result)).catch(err => callback(err));\n\t\t\t});\n\t\t});\n\t}\n\tstatic createDefaultMaterial() {\n\t\treturn createMaterial({\n\t\t\tname: 'defaultGlbMaterial'\n\t\t}, []);\n\t}\n}\n\nexport { GlbParser };\n","import { path } from '../../core/path.js';\nimport { Quat } from '../../core/math/quat.js';\nimport { Vec3 } from '../../core/math/vec3.js';\nimport { Http, http } from '../../platform/net/http.js';\nimport { Animation, Node, Key } from '../../scene/animation/animation.js';\nimport { AnimEvents } from '../anim/evaluator/anim-events.js';\nimport { GlbParser } from '../parsers/glb-parser.js';\n\nclass AnimationHandler {\n\tconstructor(app) {\n\t\tthis.handlerType = \"animation\";\n\t\tthis.device = app.graphicsDevice;\n\t\tthis.assets = app.assets;\n\t\tthis.maxRetries = 0;\n\t}\n\tload(url, callback, asset) {\n\t\tif (typeof url === 'string') {\n\t\t\turl = {\n\t\t\t\tload: url,\n\t\t\t\toriginal: url\n\t\t\t};\n\t\t}\n\t\tconst options = {\n\t\t\tretry: this.maxRetries > 0,\n\t\t\tmaxRetries: this.maxRetries\n\t\t};\n\t\tif (url.load.startsWith('blob:') || url.load.startsWith('data:')) {\n\t\t\tif (path.getExtension(url.original).toLowerCase() === '.glb') {\n\t\t\t\toptions.responseType = Http.ResponseType.ARRAY_BUFFER;\n\t\t\t} else {\n\t\t\t\toptions.responseType = Http.ResponseType.JSON;\n\t\t\t}\n\t\t}\n\t\thttp.get(url.load, options, (err, response) => {\n\t\t\tif (err) {\n\t\t\t\tcallback(`Error loading animation resource: ${url.original} [${err}]`);\n\t\t\t} else {\n\t\t\t\tif (path.getExtension(url.original).toLowerCase() === '.glb') {\n\t\t\t\t\tvar _asset$options;\n\t\t\t\t\tGlbParser.parse('filename.glb', '', response, this.device, this.assets, (_asset$options = asset == null ? void 0 : asset.options) != null ? _asset$options : {}, (err, parseResult) => {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\tcallback(err);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar _asset$data;\n\t\t\t\t\t\t\tconst animations = parseResult.animations;\n\t\t\t\t\t\t\tif (asset != null && (_asset$data = asset.data) != null && _asset$data.events) {\n\t\t\t\t\t\t\t\tfor (let i = 0; i < animations.length; i++) {\n\t\t\t\t\t\t\t\t\tanimations[i].events = new AnimEvents(Object.values(asset.data.events));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tparseResult.destroy();\n\t\t\t\t\t\t\tcallback(null, animations);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tcallback(null, this['_parseAnimationV' + response.animation.version](response));\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\topen(url, data, asset) {\n\t\treturn data;\n\t}\n\tpatch(asset, assets) {}\n\t_parseAnimationV3(data) {\n\t\tconst animData = data.animation;\n\t\tconst anim = new Animation();\n\t\tanim.name = animData.name;\n\t\tanim.duration = animData.duration;\n\t\tfor (let i = 0; i < animData.nodes.length; i++) {\n\t\t\tconst node = new Node();\n\t\t\tconst n = animData.nodes[i];\n\t\t\tnode._name = n.name;\n\t\t\tfor (let j = 0; j < n.keys.length; j++) {\n\t\t\t\tconst k = n.keys[j];\n\t\t\t\tconst t = k.time;\n\t\t\t\tconst p = k.pos;\n\t\t\t\tconst r = k.rot;\n\t\t\t\tconst s = k.scale;\n\t\t\t\tconst pos = new Vec3(p[0], p[1], p[2]);\n\t\t\t\tconst rot = new Quat().setFromEulerAngles(r[0], r[1], r[2]);\n\t\t\t\tconst scl = new Vec3(s[0], s[1], s[2]);\n\t\t\t\tconst key = new Key(t, pos, rot, scl);\n\t\t\t\tnode._keys.push(key);\n\t\t\t}\n\t\t\tanim.addNode(node);\n\t\t}\n\t\treturn anim;\n\t}\n\t_parseAnimationV4(data) {\n\t\tconst animData = data.animation;\n\t\tconst anim = new Animation();\n\t\tanim.name = animData.name;\n\t\tanim.duration = animData.duration;\n\t\tfor (let i = 0; i < animData.nodes.length; i++) {\n\t\t\tconst node = new Node();\n\t\t\tconst n = animData.nodes[i];\n\t\t\tnode._name = n.name;\n\t\t\tconst defPos = n.defaults.p;\n\t\t\tconst defRot = n.defaults.r;\n\t\t\tconst defScl = n.defaults.s;\n\t\t\tfor (let j = 0; j < n.keys.length; j++) {\n\t\t\t\tconst k = n.keys[j];\n\t\t\t\tconst t = k.t;\n\t\t\t\tconst p = defPos ? defPos : k.p;\n\t\t\t\tconst r = defRot ? defRot : k.r;\n\t\t\t\tconst s = defScl ? defScl : k.s;\n\t\t\t\tconst pos = new Vec3(p[0], p[1], p[2]);\n\t\t\t\tconst rot = new Quat().setFromEulerAngles(r[0], r[1], r[2]);\n\t\t\t\tconst scl = new Vec3(s[0], s[1], s[2]);\n\t\t\t\tconst key = new Key(t, pos, rot, scl);\n\t\t\t\tnode._keys.push(key);\n\t\t\t}\n\t\t\tanim.addNode(node);\n\t\t}\n\t\treturn anim;\n\t}\n}\n\nexport { AnimationHandler };\n","import { Http, http } from '../../platform/net/http.js';\nimport { AnimCurve } from '../anim/evaluator/anim-curve.js';\nimport { AnimData } from '../anim/evaluator/anim-data.js';\nimport { AnimTrack } from '../anim/evaluator/anim-track.js';\n\nclass AnimClipHandler {\n\tconstructor(app) {\n\t\tthis.handlerType = \"animclip\";\n\t\tthis.maxRetries = 0;\n\t}\n\tload(url, callback) {\n\t\tif (typeof url === 'string') {\n\t\t\turl = {\n\t\t\t\tload: url,\n\t\t\t\toriginal: url\n\t\t\t};\n\t\t}\n\t\tconst options = {\n\t\t\tretry: this.maxRetries > 0,\n\t\t\tmaxRetries: this.maxRetries\n\t\t};\n\t\tif (url.load.startsWith('blob:')) {\n\t\t\toptions.responseType = Http.ResponseType.JSON;\n\t\t}\n\t\thttp.get(url.load, options, function (err, response) {\n\t\t\tif (err) {\n\t\t\t\tcallback(`Error loading animation clip resource: ${url.original} [${err}]`);\n\t\t\t} else {\n\t\t\t\tcallback(null, response);\n\t\t\t}\n\t\t});\n\t}\n\topen(url, data) {\n\t\tconst name = data.name;\n\t\tconst duration = data.duration;\n\t\tconst inputs = data.inputs.map(function (input) {\n\t\t\treturn new AnimData(1, input);\n\t\t});\n\t\tconst outputs = data.outputs.map(function (output) {\n\t\t\treturn new AnimData(output.components, output.data);\n\t\t});\n\t\tconst curves = data.curves.map(function (curve) {\n\t\t\treturn new AnimCurve([curve.path], curve.inputIndex, curve.outputIndex, curve.interpolation);\n\t\t});\n\t\treturn new AnimTrack(name, duration, inputs, outputs, curves);\n\t}\n\tpatch(asset, assets) {}\n}\n\nexport { AnimClipHandler };\n","import { Http, http } from '../../platform/net/http.js';\nimport { AnimStateGraph } from '../anim/state-graph/anim-state-graph.js';\n\nclass AnimStateGraphHandler {\n\tconstructor(app) {\n\t\tthis.handlerType = \"animstategraph\";\n\t\tthis.maxRetries = 0;\n\t}\n\tload(url, callback) {\n\t\tif (typeof url === 'string') {\n\t\t\turl = {\n\t\t\t\tload: url,\n\t\t\t\toriginal: url\n\t\t\t};\n\t\t}\n\t\tconst options = {\n\t\t\tretry: this.maxRetries > 0,\n\t\t\tmaxRetries: this.maxRetries\n\t\t};\n\t\tif (url.load.startsWith('blob:')) {\n\t\t\toptions.responseType = Http.ResponseType.JSON;\n\t\t}\n\t\thttp.get(url.load, options, function (err, response) {\n\t\t\tif (err) {\n\t\t\t\tcallback(`Error loading animation state graph resource: ${url.original} [${err}]`);\n\t\t\t} else {\n\t\t\t\tcallback(null, response);\n\t\t\t}\n\t\t});\n\t}\n\topen(url, data) {\n\t\treturn new AnimStateGraph(data);\n\t}\n\tpatch(asset, assets) {}\n}\n\nexport { AnimStateGraphHandler };\n","import { path } from '../../core/path.js';\nimport '../../core/tracing.js';\nimport { Http, http } from '../../platform/net/http.js';\nimport { hasAudioContext } from '../../platform/audio/capabilities.js';\nimport { Sound } from '../../platform/sound/sound.js';\n\nconst ie = function () {\n\tif (typeof window === 'undefined') {\n\t\treturn false;\n\t}\n\tconst ua = window.navigator.userAgent;\n\tconst msie = ua.indexOf('MSIE ');\n\tif (msie > 0) {\n\t\treturn parseInt(ua.substring(msie + 5, ua.indexOf('.', msie)), 10);\n\t}\n\tconst trident = ua.indexOf('Trident/');\n\tif (trident > 0) {\n\t\tconst rv = ua.indexOf('rv:');\n\t\treturn parseInt(ua.substring(rv + 3, ua.indexOf('.', rv)), 10);\n\t}\n\treturn false;\n}();\nconst supportedExtensions = ['.ogg', '.mp3', '.wav', '.mp4a', '.m4a', '.mp4', '.aac', '.opus'];\nclass AudioHandler {\n\tconstructor(app) {\n\t\tthis.handlerType = \"audio\";\n\t\tthis.manager = app.soundManager;\n\t\tthis.maxRetries = 0;\n\t}\n\t_isSupported(url) {\n\t\tconst ext = path.getExtension(url);\n\t\treturn supportedExtensions.indexOf(ext) > -1;\n\t}\n\tload(url, callback) {\n\t\tif (typeof url === 'string') {\n\t\t\turl = {\n\t\t\t\tload: url,\n\t\t\t\toriginal: url\n\t\t\t};\n\t\t}\n\t\tconst success = function success(resource) {\n\t\t\tcallback(null, new Sound(resource));\n\t\t};\n\t\tconst error = function error(err) {\n\t\t\tlet msg = 'Error loading audio url: ' + url.original;\n\t\t\tif (err) {\n\t\t\t\tmsg += ': ' + (err.message || err);\n\t\t\t}\n\t\t\tconsole.warn(msg);\n\t\t\tcallback(msg);\n\t\t};\n\t\tif (this._createSound) {\n\t\t\tif (!this._isSupported(url.original)) {\n\t\t\t\terror(`Audio format for ${url.original} not supported`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._createSound(url.load, success, error);\n\t\t} else {\n\t\t\terror(null);\n\t\t}\n\t}\n\topen(url, data) {\n\t\treturn data;\n\t}\n\tpatch(asset, assets) {}\n\t_createSound(url, success, error) {\n\t\tif (hasAudioContext()) {\n\t\t\tconst manager = this.manager;\n\t\t\tif (!manager.context) {\n\t\t\t\terror('Audio manager has no audio context');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst options = {\n\t\t\t\tretry: this.maxRetries > 0,\n\t\t\t\tmaxRetries: this.maxRetries\n\t\t\t};\n\t\t\tif (url.startsWith('blob:') || url.startsWith('data:')) {\n\t\t\t\toptions.responseType = Http.ResponseType.ARRAY_BUFFER;\n\t\t\t}\n\t\t\thttp.get(url, options, function (err, response) {\n\t\t\t\tif (err) {\n\t\t\t\t\terror(err);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tmanager.context.decodeAudioData(response, success, error);\n\t\t\t});\n\t\t} else {\n\t\t\tlet audio = null;\n\t\t\ttry {\n\t\t\t\taudio = new Audio();\n\t\t\t} catch (e) {\n\t\t\t\terror('No support for Audio element');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (ie) {\n\t\t\t\tdocument.body.appendChild(audio);\n\t\t\t}\n\t\t\tconst onReady = function onReady() {\n\t\t\t\taudio.removeEventListener('canplaythrough', onReady);\n\t\t\t\tif (ie) {\n\t\t\t\t\tdocument.body.removeChild(audio);\n\t\t\t\t}\n\t\t\t\tsuccess(audio);\n\t\t\t};\n\t\t\taudio.onerror = function () {\n\t\t\t\taudio.onerror = null;\n\t\t\t\tif (ie) {\n\t\t\t\t\tdocument.body.removeChild(audio);\n\t\t\t\t}\n\t\t\t\terror();\n\t\t\t};\n\t\t\taudio.addEventListener('canplaythrough', onReady);\n\t\t\taudio.src = url;\n\t\t}\n\t}\n}\n\nexport { AudioHandler };\n","import { http, Http } from '../../platform/net/http.js';\n\nclass BinaryHandler {\n\tconstructor(app) {\n\t\tthis.handlerType = \"binary\";\n\t\tthis.maxRetries = 0;\n\t}\n\tload(url, callback) {\n\t\tif (typeof url === 'string') {\n\t\t\turl = {\n\t\t\t\tload: url,\n\t\t\t\toriginal: url\n\t\t\t};\n\t\t}\n\t\thttp.get(url.load, {\n\t\t\tresponseType: Http.ResponseType.ARRAY_BUFFER,\n\t\t\tretry: this.maxRetries > 0,\n\t\t\tmaxRetries: this.maxRetries\n\t\t}, function (err, response) {\n\t\t\tif (!err) {\n\t\t\t\tcallback(null, response);\n\t\t\t} else {\n\t\t\t\tcallback(`Error loading binary resource: ${url.original} [${err}]`);\n\t\t\t}\n\t\t});\n\t}\n\topen(url, data) {\n\t\treturn data;\n\t}\n\tpatch(asset, assets) {}\n}\n\nexport { BinaryHandler };\n","import '../../core/tracing.js';\nimport { MeshInstance } from '../../scene/mesh-instance.js';\nimport { Model } from '../../scene/model.js';\nimport { MorphInstance } from '../../scene/morph-instance.js';\nimport { SkinInstance } from '../../scene/skin-instance.js';\nimport { SkinInstanceCache } from '../../scene/skin-instance-cache.js';\nimport { Entity } from '../entity.js';\nimport { Asset } from '../asset/asset.js';\n\nclass GlbContainerResource {\n\tconstructor(data, asset, assets, defaultMaterial) {\n\t\tconst createAsset = function createAsset(type, resource, index) {\n\t\t\tconst subAsset = GlbContainerResource.createAsset(asset.name, type, resource, index);\n\t\t\tassets.add(subAsset);\n\t\t\treturn subAsset;\n\t\t};\n\t\tconst renders = [];\n\t\tfor (let i = 0; i < data.renders.length; ++i) {\n\t\t\trenders.push(createAsset('render', data.renders[i], i));\n\t\t}\n\t\tconst materials = [];\n\t\tfor (let i = 0; i < data.materials.length; ++i) {\n\t\t\tmaterials.push(createAsset('material', data.materials[i], i));\n\t\t}\n\t\tconst animations = [];\n\t\tfor (let i = 0; i < data.animations.length; ++i) {\n\t\t\tanimations.push(createAsset('animation', data.animations[i], i));\n\t\t}\n\t\tthis.data = data;\n\t\tthis._model = null;\n\t\tthis._assetName = asset.name;\n\t\tthis._assets = assets;\n\t\tthis._defaultMaterial = defaultMaterial;\n\t\tthis.renders = renders;\n\t\tthis.materials = materials;\n\t\tthis.textures = data.textures;\n\t\tthis.animations = animations;\n\t}\n\tget model() {\n\t\tif (!this._model) {\n\t\t\tconst model = GlbContainerResource.createModel(this.data, this._defaultMaterial);\n\t\t\tconst modelAsset = GlbContainerResource.createAsset(this._assetName, 'model', model, 0);\n\t\t\tthis._assets.add(modelAsset);\n\t\t\tthis._model = modelAsset;\n\t\t}\n\t\treturn this._model;\n\t}\n\tstatic createAsset(assetName, type, resource, index) {\n\t\tconst subAsset = new Asset(assetName + '/' + type + '/' + index, type, {\n\t\t\turl: ''\n\t\t});\n\t\tsubAsset.resource = resource;\n\t\tsubAsset.loaded = true;\n\t\treturn subAsset;\n\t}\n\tinstantiateModelEntity(options) {\n\t\tconst entity = new Entity();\n\t\tentity.addComponent('model', Object.assign({\n\t\t\ttype: 'asset',\n\t\t\tasset: this.model\n\t\t}, options));\n\t\treturn entity;\n\t}\n\tinstantiateRenderEntity(options) {\n\t\tconst defaultMaterial = this._defaultMaterial;\n\t\tconst skinnedMeshInstances = [];\n\t\tconst createMeshInstance = function createMeshInstance(root, entity, mesh, materials, meshDefaultMaterials, skins, gltfNode) {\n\t\t\tconst materialIndex = meshDefaultMaterials[mesh.id];\n\t\t\tconst material = materialIndex === undefined ? defaultMaterial : materials[materialIndex];\n\t\t\tconst meshInstance = new MeshInstance(mesh, material);\n\t\t\tif (mesh.morph) {\n\t\t\t\tmeshInstance.morphInstance = new MorphInstance(mesh.morph);\n\t\t\t}\n\t\t\tif (gltfNode.hasOwnProperty('skin')) {\n\t\t\t\tskinnedMeshInstances.push({\n\t\t\t\t\tmeshInstance: meshInstance,\n\t\t\t\t\trootBone: root,\n\t\t\t\t\tentity: entity\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn meshInstance;\n\t\t};\n\t\tconst cloneHierarchy = (root, node, glb) => {\n\t\t\tconst entity = new Entity();\n\t\t\tnode._cloneInternal(entity);\n\t\t\tif (!root) root = entity;\n\t\t\tlet attachedMi = null;\n\t\t\tlet renderAsset = null;\n\t\t\tfor (let i = 0; i < glb.nodes.length; i++) {\n\t\t\t\tconst glbNode = glb.nodes[i];\n\t\t\t\tif (glbNode === node) {\n\t\t\t\t\tconst gltfNode = glb.gltf.nodes[i];\n\t\t\t\t\tif (gltfNode.hasOwnProperty('mesh')) {\n\t\t\t\t\t\tconst meshGroup = glb.renders[gltfNode.mesh].meshes;\n\t\t\t\t\t\trenderAsset = this.renders[gltfNode.mesh];\n\t\t\t\t\t\tfor (let mi = 0; mi < meshGroup.length; mi++) {\n\t\t\t\t\t\t\tconst mesh = meshGroup[mi];\n\t\t\t\t\t\t\tif (mesh) {\n\t\t\t\t\t\t\t\tconst cloneMi = createMeshInstance(root, entity, mesh, glb.materials, glb.meshDefaultMaterials, glb.skins, gltfNode);\n\t\t\t\t\t\t\t\tif (!attachedMi) {\n\t\t\t\t\t\t\t\t\tattachedMi = [];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tattachedMi.push(cloneMi);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (glb.lights) {\n\t\t\t\t\t\tconst lightEntity = glb.lights.get(gltfNode);\n\t\t\t\t\t\tif (lightEntity) {\n\t\t\t\t\t\t\tentity.addChild(lightEntity.clone());\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (glb.cameras) {\n\t\t\t\t\t\tconst cameraEntity = glb.cameras.get(gltfNode);\n\t\t\t\t\t\tif (cameraEntity) {\n\t\t\t\t\t\t\tcameraEntity.camera.system.cloneComponent(cameraEntity, entity);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (attachedMi) {\n\t\t\t\tentity.addComponent('render', Object.assign({\n\t\t\t\t\ttype: 'asset',\n\t\t\t\t\tmeshInstances: attachedMi,\n\t\t\t\t\trootBone: root\n\t\t\t\t}, options));\n\t\t\t\tentity.render.assignAsset(renderAsset);\n\t\t\t}\n\t\t\tconst children = node.children;\n\t\t\tfor (let i = 0; i < children.length; i++) {\n\t\t\t\tconst childClone = cloneHierarchy(root, children[i], glb);\n\t\t\t\tentity.addChild(childClone);\n\t\t\t}\n\t\t\treturn entity;\n\t\t};\n\t\tconst sceneClones = [];\n\t\tfor (const scene of this.data.scenes) {\n\t\t\tsceneClones.push(cloneHierarchy(null, scene, this.data));\n\t\t}\n\t\tskinnedMeshInstances.forEach(data => {\n\t\t\tdata.meshInstance.skinInstance = SkinInstanceCache.createCachedSkinInstance(data.meshInstance.mesh.skin, data.rootBone, data.entity);\n\t\t});\n\t\treturn GlbContainerResource.createSceneHierarchy(sceneClones, 'Entity');\n\t}\n\tgetMaterialVariants() {\n\t\treturn this.data.variants ? Object.keys(this.data.variants) : [];\n\t}\n\tapplyMaterialVariant(entity, name) {\n\t\tconst variant = name ? this.data.variants[name] : null;\n\t\tif (variant === undefined) {\n\t\t\treturn;\n\t\t}\n\t\tconst renders = entity.findComponents(\"render\");\n\t\tfor (let i = 0; i < renders.length; i++) {\n\t\t\tconst renderComponent = renders[i];\n\t\t\tthis._applyMaterialVariant(variant, renderComponent.meshInstances);\n\t\t}\n\t}\n\tapplyMaterialVariantInstances(instances, name) {\n\t\tconst variant = name ? this.data.variants[name] : null;\n\t\tif (variant === undefined) {\n\t\t\treturn;\n\t\t}\n\t\tthis._applyMaterialVariant(variant, instances);\n\t}\n\t_applyMaterialVariant(variant, instances) {\n\t\tinstances.forEach(instance => {\n\t\t\tif (variant === null) {\n\t\t\t\tinstance.material = this._defaultMaterial;\n\t\t\t} else {\n\t\t\t\tconst meshVariants = this.data.meshVariants[instance.mesh.id];\n\t\t\t\tif (meshVariants) {\n\t\t\t\t\tinstance.material = this.data.materials[meshVariants[variant]];\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\tstatic createSceneHierarchy(sceneNodes, nodeType) {\n\t\tlet root = null;\n\t\tif (sceneNodes.length === 1) {\n\t\t\troot = sceneNodes[0];\n\t\t} else {\n\t\t\troot = new nodeType('SceneGroup');\n\t\t\tfor (const scene of sceneNodes) {\n\t\t\t\troot.addChild(scene);\n\t\t\t}\n\t\t}\n\t\treturn root;\n\t}\n\tstatic createModel(glb, defaultMaterial) {\n\t\tconst createMeshInstance = function createMeshInstance(model, mesh, skins, skinInstances, materials, node, gltfNode) {\n\t\t\tconst materialIndex = glb.meshDefaultMaterials[mesh.id];\n\t\t\tconst material = materialIndex === undefined ? defaultMaterial : materials[materialIndex];\n\t\t\tconst meshInstance = new MeshInstance(mesh, material, node);\n\t\t\tif (mesh.morph) {\n\t\t\t\tconst morphInstance = new MorphInstance(mesh.morph);\n\t\t\t\tmeshInstance.morphInstance = morphInstance;\n\t\t\t\tmodel.morphInstances.push(morphInstance);\n\t\t\t}\n\t\t\tif (gltfNode.hasOwnProperty('skin')) {\n\t\t\t\tconst skinIndex = gltfNode.skin;\n\t\t\t\tconst skin = skins[skinIndex];\n\t\t\t\tmesh.skin = skin;\n\t\t\t\tconst skinInstance = skinInstances[skinIndex];\n\t\t\t\tmeshInstance.skinInstance = skinInstance;\n\t\t\t\tmodel.skinInstances.push(skinInstance);\n\t\t\t}\n\t\t\tmodel.meshInstances.push(meshInstance);\n\t\t};\n\t\tconst model = new Model();\n\t\tconst skinInstances = [];\n\t\tfor (const skin of glb.skins) {\n\t\t\tconst skinInstance = new SkinInstance(skin);\n\t\t\tskinInstance.bones = skin.bones;\n\t\t\tskinInstances.push(skinInstance);\n\t\t}\n\t\tmodel.graph = GlbContainerResource.createSceneHierarchy(glb.scenes, 'GraphNode');\n\t\tfor (let i = 0; i < glb.nodes.length; i++) {\n\t\t\tconst node = glb.nodes[i];\n\t\t\tif (node.root === model.graph) {\n\t\t\t\tconst gltfNode = glb.gltf.nodes[i];\n\t\t\t\tif (gltfNode.hasOwnProperty('mesh')) {\n\t\t\t\t\tconst meshGroup = glb.renders[gltfNode.mesh].meshes;\n\t\t\t\t\tfor (let mi = 0; mi < meshGroup.length; mi++) {\n\t\t\t\t\t\tconst mesh = meshGroup[mi];\n\t\t\t\t\t\tif (mesh) {\n\t\t\t\t\t\t\tcreateMeshInstance(model, mesh, glb.skins, skinInstances, glb.materials, node, gltfNode);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn model;\n\t}\n\tdestroy() {\n\t\tconst registry = this._assets;\n\t\tconst destroyAsset = function destroyAsset(asset) {\n\t\t\tregistry.remove(asset);\n\t\t\tasset.unload();\n\t\t};\n\t\tconst destroyAssets = function destroyAssets(assets) {\n\t\t\tassets.forEach(function (asset) {\n\t\t\t\tdestroyAsset(asset);\n\t\t\t});\n\t\t};\n\t\tif (this.animations) {\n\t\t\tdestroyAssets(this.animations);\n\t\t\tthis.animations = null;\n\t\t}\n\t\tif (this.textures) {\n\t\t\tdestroyAssets(this.textures);\n\t\t\tthis.textures = null;\n\t\t}\n\t\tif (this.materials) {\n\t\t\tdestroyAssets(this.materials);\n\t\t\tthis.materials = null;\n\t\t}\n\t\tif (this.renders) {\n\t\t\tdestroyAssets(this.renders);\n\t\t\tthis.renders = null;\n\t\t}\n\t\tif (this._model) {\n\t\t\tdestroyAsset(this._model);\n\t\t\tthis._model = null;\n\t\t}\n\t\tthis.data = null;\n\t\tthis.assets = null;\n\t}\n}\n\nexport { GlbContainerResource };\n","import { path } from '../../core/path.js';\nimport { Asset } from '../asset/asset.js';\nimport { GlbParser } from './glb-parser.js';\nimport { GlbContainerResource } from './glb-container-resource.js';\n\nclass GlbContainerParser {\n\tconstructor(device, assets, maxRetries) {\n\t\tthis._device = device;\n\t\tthis._assets = assets;\n\t\tthis._defaultMaterial = GlbParser.createDefaultMaterial();\n\t\tthis.maxRetries = maxRetries;\n\t}\n\t_getUrlWithoutParams(url) {\n\t\treturn url.indexOf('?') >= 0 ? url.split('?')[0] : url;\n\t}\n\tload(url, callback, asset) {\n\t\tAsset.fetchArrayBuffer(url.load, (err, result) => {\n\t\t\tif (err) {\n\t\t\t\tcallback(err);\n\t\t\t} else {\n\t\t\t\tGlbParser.parse(this._getUrlWithoutParams(url.original), path.extractPath(url.load), result, this._device, asset.registry, asset.options, (err, result) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tcallback(err);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcallback(null, new GlbContainerResource(result, asset, this._assets, this._defaultMaterial));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}, asset, this.maxRetries);\n\t}\n\topen(url, data, asset) {\n\t\treturn data;\n\t}\n\tpatch(asset, assets) {}\n}\n\nexport { GlbContainerParser };\n","import { path } from '../../core/path.js';\nimport { GlbContainerParser } from '../parsers/glb-container-parser.js';\n\nclass ContainerResource {\n\tinstantiateModelEntity(options) {\n\t\treturn null;\n\t}\n\tinstantiateRenderEntity(options) {\n\t\treturn null;\n\t}\n\tgetMaterialVariants() {\n\t\treturn null;\n\t}\n\tapplyMaterialVariant(entity, name) {}\n\tapplyMaterialVariantInstances(instances, name) {}\n}\nclass ContainerHandler {\n\tconstructor(app) {\n\t\tthis.handlerType = \"container\";\n\t\tthis.glbContainerParser = new GlbContainerParser(app.graphicsDevice, app.assets, 0);\n\t\tthis.parsers = {};\n\t}\n\tset maxRetries(value) {\n\t\tthis.glbContainerParser.maxRetries = value;\n\t\tfor (const parser in this.parsers) {\n\t\t\tif (this.parsers.hasOwnProperty(parser)) {\n\t\t\t\tthis.parsers[parser].maxRetries = value;\n\t\t\t}\n\t\t}\n\t}\n\tget maxRetries() {\n\t\treturn this.glbContainerParser.maxRetries;\n\t}\n\t_getUrlWithoutParams(url) {\n\t\treturn url.indexOf('?') >= 0 ? url.split('?')[0] : url;\n\t}\n\t_getParser(url) {\n\t\tconst ext = url ? path.getExtension(this._getUrlWithoutParams(url)).toLowerCase().replace('.', '') : null;\n\t\treturn this.parsers[ext] || this.glbContainerParser;\n\t}\n\tload(url, callback, asset) {\n\t\tif (typeof url === 'string') {\n\t\t\turl = {\n\t\t\t\tload: url,\n\t\t\t\toriginal: url\n\t\t\t};\n\t\t}\n\t\tthis._getParser(url.original).load(url, callback, asset);\n\t}\n\topen(url, data, asset) {\n\t\treturn this._getParser(url).open(url, data, asset);\n\t}\n\tpatch(asset, assets) {}\n}\n\nexport { ContainerHandler, ContainerResource };\n","import { http } from '../../platform/net/http.js';\n\nclass CssHandler {\n\tconstructor(app) {\n\t\tthis.handlerType = \"css\";\n\t\tthis.maxRetries = 0;\n\t}\n\tload(url, callback) {\n\t\tif (typeof url === 'string') {\n\t\t\turl = {\n\t\t\t\tload: url,\n\t\t\t\toriginal: url\n\t\t\t};\n\t\t}\n\t\thttp.get(url.load, {\n\t\t\tretry: this.maxRetries > 0,\n\t\t\tmaxRetries: this.maxRetries\n\t\t}, function (err, response) {\n\t\t\tif (!err) {\n\t\t\t\tcallback(null, response);\n\t\t\t} else {\n\t\t\t\tcallback(`Error loading css resource: ${url.original} [${err}]`);\n\t\t\t}\n\t\t});\n\t}\n\topen(url, data) {\n\t\treturn data;\n\t}\n\tpatch(asset, assets) {}\n}\n\nexport { CssHandler };\n","import { ADDRESS_CLAMP_TO_EDGE, TEXTURETYPE_RGBP, PIXELFORMAT_RGB8, PIXELFORMAT_RGBA8, TEXTURETYPE_RGBM, TEXTURETYPE_DEFAULT } from '../../platform/graphics/constants.js';\nimport { Texture } from '../../platform/graphics/texture.js';\nimport { Asset } from '../asset/asset.js';\n\nclass CubemapHandler {\n\tconstructor(app) {\n\t\tthis.handlerType = \"cubemap\";\n\t\tthis._device = app.graphicsDevice;\n\t\tthis._registry = app.assets;\n\t\tthis._loader = app.loader;\n\t}\n\tload(url, callback, asset) {\n\t\tthis.loadAssets(asset, callback);\n\t}\n\topen(url, data, asset) {\n\t\treturn asset ? asset.resource : null;\n\t}\n\tpatch(asset, registry) {\n\t\tthis.loadAssets(asset, function (err, result) {\n\t\t\tif (err) {\n\t\t\t\tregistry.fire('error', asset);\n\t\t\t\tregistry.fire('error:' + asset.id, err, asset);\n\t\t\t\tasset.fire('error', asset);\n\t\t\t}\n\t\t});\n\t}\n\tgetAssetIds(cubemapAsset) {\n\t\tconst result = [];\n\t\tresult[0] = cubemapAsset.file;\n\t\tif ((cubemapAsset.loadFaces || !cubemapAsset.file) && cubemapAsset.data && cubemapAsset.data.textures) {\n\t\t\tfor (let i = 0; i < 6; ++i) {\n\t\t\t\tresult[i + 1] = cubemapAsset.data.textures[i];\n\t\t\t}\n\t\t} else {\n\t\t\tresult[1] = result[2] = result[3] = result[4] = result[5] = result[6] = null;\n\t\t}\n\t\treturn result;\n\t}\n\tcompareAssetIds(assetIdA, assetIdB) {\n\t\tif (assetIdA && assetIdB) {\n\t\t\tif (parseInt(assetIdA, 10) === assetIdA || typeof assetIdA === 'string') {\n\t\t\t\treturn assetIdA === assetIdB;\n\t\t\t}\n\t\t\treturn assetIdA.url === assetIdB.url;\n\t\t}\n\t\treturn assetIdA !== null === (assetIdB !== null);\n\t}\n\tupdate(cubemapAsset, assetIds, assets) {\n\t\tconst assetData = cubemapAsset.data || {};\n\t\tconst oldAssets = cubemapAsset._handlerState.assets;\n\t\tconst oldResources = cubemapAsset._resources;\n\t\tlet tex, mip, i;\n\t\tconst resources = [null, null, null, null, null, null, null];\n\t\tconst getType = function getType() {\n\t\t\tif (assetData.hasOwnProperty('type')) {\n\t\t\t\treturn assetData.type;\n\t\t\t}\n\t\t\tif (assetData.hasOwnProperty('rgbm')) {\n\t\t\t\treturn assetData.rgbm ? TEXTURETYPE_RGBM : TEXTURETYPE_DEFAULT;\n\t\t\t}\n\t\t\treturn null;\n\t\t};\n\t\tif (!cubemapAsset.loaded || assets[0] !== oldAssets[0]) {\n\t\t\tif (assets[0]) {\n\t\t\t\ttex = assets[0].resource;\n\t\t\t\tif (tex.cubemap) {\n\t\t\t\t\tfor (i = 0; i < 6; ++i) {\n\t\t\t\t\t\tresources[i + 1] = new Texture(this._device, {\n\t\t\t\t\t\t\tname: cubemapAsset.name + '_prelitCubemap' + (tex.width >> i),\n\t\t\t\t\t\t\tcubemap: true,\n\t\t\t\t\t\t\ttype: getType() || tex.type,\n\t\t\t\t\t\t\twidth: tex.width >> i,\n\t\t\t\t\t\t\theight: tex.height >> i,\n\t\t\t\t\t\t\tformat: tex.format,\n\t\t\t\t\t\t\tlevels: [tex._levels[i]],\n\t\t\t\t\t\t\tfixCubemapSeams: true,\n\t\t\t\t\t\t\taddressU: ADDRESS_CLAMP_TO_EDGE,\n\t\t\t\t\t\t\taddressV: ADDRESS_CLAMP_TO_EDGE,\n\t\t\t\t\t\t\tmipmaps: i === 0\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\ttex.type = TEXTURETYPE_RGBP;\n\t\t\t\t\ttex.addressU = ADDRESS_CLAMP_TO_EDGE;\n\t\t\t\t\ttex.addressV = ADDRESS_CLAMP_TO_EDGE;\n\t\t\t\t\ttex.mipmaps = false;\n\t\t\t\t\tresources[1] = tex;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tresources[1] = oldResources[1] || null;\n\t\t\tresources[2] = oldResources[2] || null;\n\t\t\tresources[3] = oldResources[3] || null;\n\t\t\tresources[4] = oldResources[4] || null;\n\t\t\tresources[5] = oldResources[5] || null;\n\t\t\tresources[6] = oldResources[6] || null;\n\t\t}\n\t\tconst faceAssets = assets.slice(1);\n\t\tif (!cubemapAsset.loaded || !this.cmpArrays(faceAssets, oldAssets.slice(1))) {\n\t\t\tif (faceAssets.indexOf(null) === -1) {\n\t\t\t\tvar _assetData$mipmaps;\n\t\t\t\tconst faceTextures = faceAssets.map(function (asset) {\n\t\t\t\t\treturn asset.resource;\n\t\t\t\t});\n\t\t\t\tconst faceLevels = [];\n\t\t\t\tfor (mip = 0; mip < faceTextures[0]._levels.length; ++mip) {\n\t\t\t\t\tfaceLevels.push(faceTextures.map(function (faceTexture) {\n\t\t\t\t\t\treturn faceTexture._levels[mip];\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t\tconst format = faceTextures[0].format;\n\t\t\t\tconst faces = new Texture(this._device, {\n\t\t\t\t\tname: cubemapAsset.name + '_faces',\n\t\t\t\t\tcubemap: true,\n\t\t\t\t\ttype: getType() || faceTextures[0].type,\n\t\t\t\t\twidth: faceTextures[0].width,\n\t\t\t\t\theight: faceTextures[0].height,\n\t\t\t\t\tformat: format === PIXELFORMAT_RGB8 ? PIXELFORMAT_RGBA8 : format,\n\t\t\t\t\tmipmaps: (_assetData$mipmaps = assetData.mipmaps) != null ? _assetData$mipmaps : true,\n\t\t\t\t\tlevels: faceLevels,\n\t\t\t\t\tminFilter: assetData.hasOwnProperty('minFilter') ? assetData.minFilter : faceTextures[0].minFilter,\n\t\t\t\t\tmagFilter: assetData.hasOwnProperty('magFilter') ? assetData.magFilter : faceTextures[0].magFilter,\n\t\t\t\t\tanisotropy: assetData.hasOwnProperty('anisotropy') ? assetData.anisotropy : 1,\n\t\t\t\t\taddressU: ADDRESS_CLAMP_TO_EDGE,\n\t\t\t\t\taddressV: ADDRESS_CLAMP_TO_EDGE,\n\t\t\t\t\tfixCubemapSeams: !!assets[0]\n\t\t\t\t});\n\t\t\t\tresources[0] = faces;\n\t\t\t}\n\t\t} else {\n\t\t\tresources[0] = oldResources[0] || null;\n\t\t}\n\t\tif (!this.cmpArrays(resources, oldResources)) {\n\t\t\tcubemapAsset.resources = resources;\n\t\t\tcubemapAsset._handlerState.assetIds = assetIds;\n\t\t\tcubemapAsset._handlerState.assets = assets;\n\t\t\tfor (i = 0; i < oldResources.length; ++i) {\n\t\t\t\tif (oldResources[i] !== null && resources.indexOf(oldResources[i]) === -1) {\n\t\t\t\t\toldResources[i].destroy();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor (i = 0; i < oldAssets.length; ++i) {\n\t\t\tif (oldAssets[i] !== null && assets.indexOf(oldAssets[i]) === -1) {\n\t\t\t\toldAssets[i].unload();\n\t\t\t}\n\t\t}\n\t}\n\tcmpArrays(arr1, arr2) {\n\t\tif (arr1.length !== arr2.length) {\n\t\t\treturn false;\n\t\t}\n\t\tfor (let i = 0; i < arr1.length; ++i) {\n\t\t\tif (arr1[i] !== arr2[i]) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\tresolveId(value) {\n\t\tconst valueInt = parseInt(value, 10);\n\t\treturn valueInt === value || valueInt.toString() === value ? valueInt : value;\n\t}\n\tloadAssets(cubemapAsset, callback) {\n\t\tif (!cubemapAsset.hasOwnProperty('_handlerState')) {\n\t\t\tcubemapAsset._handlerState = {\n\t\t\t\tassetIds: [null, null, null, null, null, null, null],\n\t\t\t\tassets: [null, null, null, null, null, null, null]\n\t\t\t};\n\t\t}\n\t\tconst self = this;\n\t\tconst assetIds = self.getAssetIds(cubemapAsset);\n\t\tconst assets = [null, null, null, null, null, null, null];\n\t\tconst loadedAssetIds = cubemapAsset._handlerState.assetIds;\n\t\tconst loadedAssets = cubemapAsset._handlerState.assets;\n\t\tconst registry = self._registry;\n\t\tlet awaiting = 7;\n\t\tconst onLoad = function onLoad(index, asset) {\n\t\t\tassets[index] = asset;\n\t\t\tawaiting--;\n\t\t\tif (awaiting === 0) {\n\t\t\t\tself.update(cubemapAsset, assetIds, assets);\n\t\t\t\tcallback(null, cubemapAsset.resources);\n\t\t\t}\n\t\t};\n\t\tconst onError = function onError(index, err, asset) {\n\t\t\tcallback(err);\n\t\t};\n\t\tconst processTexAsset = function processTexAsset(index, texAsset) {\n\t\t\tif (texAsset.loaded) {\n\t\t\t\tonLoad(index, texAsset);\n\t\t\t} else {\n\t\t\t\tregistry.once('load:' + texAsset.id, onLoad.bind(self, index));\n\t\t\t\tregistry.once('error:' + texAsset.id, onError.bind(self, index));\n\t\t\t\tif (!texAsset.loading) {\n\t\t\t\t\tregistry.load(texAsset);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tlet texAsset;\n\t\tfor (let i = 0; i < 7; ++i) {\n\t\t\tconst assetId = this.resolveId(assetIds[i]);\n\t\t\tif (!assetId) {\n\t\t\t\tonLoad(i, null);\n\t\t\t} else if (self.compareAssetIds(assetId, loadedAssetIds[i])) {\n\t\t\t\tonLoad(i, loadedAssets[i]);\n\t\t\t} else if (parseInt(assetId, 10) === assetId) {\n\t\t\t\ttexAsset = registry.get(assetId);\n\t\t\t\tif (texAsset) {\n\t\t\t\t\tprocessTexAsset(i, texAsset);\n\t\t\t\t} else {\n\t\t\t\t\tsetTimeout(function (index, assetId_) {\n\t\t\t\t\t\tconst texAsset = registry.get(assetId_);\n\t\t\t\t\t\tif (texAsset) {\n\t\t\t\t\t\t\tprocessTexAsset(index, texAsset);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tonError(index, 'failed to find dependent cubemap asset=' + assetId_);\n\t\t\t\t\t\t}\n\t\t\t\t\t}.bind(null, i, assetId));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst file = typeof assetId === 'string' ? {\n\t\t\t\t\turl: assetId,\n\t\t\t\t\tfilename: assetId\n\t\t\t\t} : assetId;\n\t\t\t\ttexAsset = new Asset(cubemapAsset.name + '_part_' + i, 'texture', file);\n\t\t\t\tregistry.add(texAsset);\n\t\t\t\tregistry.once('load:' + texAsset.id, onLoad.bind(self, i));\n\t\t\t\tregistry.once('error:' + texAsset.id, onError.bind(self, i));\n\t\t\t\tregistry.load(texAsset);\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport { CubemapHandler };\n","class FolderHandler {\n\tconstructor() {\n\t\tthis.handlerType = \"folder\";\n\t}\n\tload(url, callback) {\n\t\tcallback(null, null);\n\t}\n\topen(url, data) {\n\t\treturn data;\n\t}\n}\n\nexport { FolderHandler };\n","import { FONT_MSDF } from './constants.js';\n\nclass Font {\n\tconstructor(textures, data) {\n\t\tthis.type = data ? data.type || FONT_MSDF : FONT_MSDF;\n\t\tthis.em = 1;\n\t\tthis.textures = textures;\n\t\tthis.intensity = 0.0;\n\t\tthis._data = null;\n\t\tthis.data = data;\n\t}\n\tset data(value) {\n\t\tthis._data = value;\n\t\tif (!value) return;\n\t\tif (this._data.intensity !== undefined) {\n\t\t\tthis.intensity = this._data.intensity;\n\t\t}\n\t\tif (!this._data.info) this._data.info = {};\n\t\tif (!this._data.version || this._data.version < 2) {\n\t\t\tthis._data.info.maps = [{\n\t\t\t\twidth: this._data.info.width,\n\t\t\t\theight: this._data.info.height\n\t\t\t}];\n\t\t\tif (this._data.chars) {\n\t\t\t\tfor (const key in this._data.chars) {\n\t\t\t\t\tthis._data.chars[key].map = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tget data() {\n\t\treturn this._data;\n\t}\n}\n\nexport { Font };\n","import { path } from '../../core/path.js';\nimport { string } from '../../core/string.js';\nimport { http } from '../../platform/net/http.js';\nimport { Font } from '../font/font.js';\n\nfunction upgradeDataSchema(data) {\n\tif (data.version < 3) {\n\t\tif (data.version < 2) {\n\t\t\tdata.info.maps = data.info.maps || [{\n\t\t\t\twidth: data.info.width,\n\t\t\t\theight: data.info.height\n\t\t\t}];\n\t\t}\n\t\tdata.chars = Object.keys(data.chars || {}).reduce(function (newChars, key) {\n\t\t\tconst existing = data.chars[key];\n\t\t\tconst newKey = existing.letter !== undefined ? existing.letter : string.fromCodePoint(key);\n\t\t\tif (data.version < 2) {\n\t\t\t\texisting.map = existing.map || 0;\n\t\t\t}\n\t\t\tnewChars[newKey] = existing;\n\t\t\treturn newChars;\n\t\t}, {});\n\t\tdata.version = 3;\n\t}\n\treturn data;\n}\nclass FontHandler {\n\tconstructor(app) {\n\t\tthis.handlerType = \"font\";\n\t\tthis._loader = app.loader;\n\t\tthis.maxRetries = 0;\n\t}\n\tload(url, callback, asset) {\n\t\tif (typeof url === 'string') {\n\t\t\turl = {\n\t\t\t\tload: url,\n\t\t\t\toriginal: url\n\t\t\t};\n\t\t}\n\t\tconst self = this;\n\t\tif (path.getExtension(url.original) === '.json') {\n\t\t\thttp.get(url.load, {\n\t\t\t\tretry: this.maxRetries > 0,\n\t\t\t\tmaxRetries: this.maxRetries\n\t\t\t}, function (err, response) {\n\t\t\t\tif (!err) {\n\t\t\t\t\tconst data = upgradeDataSchema(response);\n\t\t\t\t\tself._loadTextures(url.load.replace('.json', '.png'), data, function (err, textures) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\tcallback(err);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcallback(null, {\n\t\t\t\t\t\t\t\tdata: data,\n\t\t\t\t\t\t\t\ttextures: textures\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tcallback(`Error loading font resource: ${url.original} [${err}]`);\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tif (asset && asset.data) {\n\t\t\t\tasset.data = upgradeDataSchema(asset.data);\n\t\t\t}\n\t\t\tthis._loadTextures(url.load, asset && asset.data, callback);\n\t\t}\n\t}\n\t_loadTextures(url, data, callback) {\n\t\tconst numTextures = data.info.maps.length;\n\t\tlet numLoaded = 0;\n\t\tlet error = null;\n\t\tconst textures = new Array(numTextures);\n\t\tconst loader = this._loader;\n\t\tconst loadTexture = function loadTexture(index) {\n\t\t\tconst onLoaded = function onLoaded(err, texture) {\n\t\t\t\tif (error) return;\n\t\t\t\tif (err) {\n\t\t\t\t\terror = err;\n\t\t\t\t\tcallback(err);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\ttexture.upload();\n\t\t\t\ttextures[index] = texture;\n\t\t\t\tnumLoaded++;\n\t\t\t\tif (numLoaded === numTextures) {\n\t\t\t\t\tcallback(null, textures);\n\t\t\t\t}\n\t\t\t};\n\t\t\tif (index === 0) {\n\t\t\t\tloader.load(url, 'texture', onLoaded);\n\t\t\t} else {\n\t\t\t\tloader.load(url.replace('.png', index + '.png'), 'texture', onLoaded);\n\t\t\t}\n\t\t};\n\t\tfor (let i = 0; i < numTextures; i++) loadTexture(i);\n\t}\n\topen(url, data, asset) {\n\t\tlet font;\n\t\tif (data.textures) {\n\t\t\tfont = new Font(data.textures, data.data);\n\t\t} else {\n\t\t\tfont = new Font(data, null);\n\t\t}\n\t\treturn font;\n\t}\n\tpatch(asset, assets) {\n\t\tconst font = asset.resource;\n\t\tif (!font.data && asset.data) {\n\t\t\tfont.data = asset.data;\n\t\t} else if (!asset.data && font.data) {\n\t\t\tasset.data = font.data;\n\t\t}\n\t\tif (asset.data) {\n\t\t\tasset.data = upgradeDataSchema(asset.data);\n\t\t}\n\t}\n}\n\nexport { FontHandler };\n","class CompressUtils {\n\tstatic setCompressedPRS(entity, data, compressed) {\n\t\tconst a = compressed.singleVecs;\n\t\tlet b, i;\n\t\tconst v = data.___1;\n\t\tif (!v) {\n\t\t\tb = compressed.tripleVecs;\n\t\t\ti = data.___2;\n\t\t}\n\t\tlet n = v ? v[0] : b[i];\n\t\tentity.setLocalPosition(a[n], a[n + 1], a[n + 2]);\n\t\tn = v ? v[1] : b[i + 1];\n\t\tentity.setLocalEulerAngles(a[n], a[n + 1], a[n + 2]);\n\t\tn = v ? v[2] : b[i + 2];\n\t\tentity.setLocalScale(a[n], a[n + 1], a[n + 2]);\n\t}\n\tstatic oneCharToKey(s, data) {\n\t\tconst i = s.charCodeAt(0) - data.fieldFirstCode;\n\t\treturn data.fieldArray[i];\n\t}\n\tstatic multCharToKey(s, data) {\n\t\tlet ind = 0;\n\t\tfor (let i = 0; i < s.length; i++) {\n\t\t\tind = ind * data.fieldCodeBase + s.charCodeAt(i) - data.fieldFirstCode;\n\t\t}\n\t\treturn data.fieldArray[ind];\n\t}\n}\n\nexport { CompressUtils };\n","import { CompressUtils } from './compress-utils.js';\n\nclass Decompress {\n\tconstructor(node, data) {\n\t\tthis._node = node;\n\t\tthis._data = data;\n\t}\n\trun() {\n\t\tconst type = Object.prototype.toString.call(this._node);\n\t\tif (type === '[object Object]') {\n\t\t\tthis._handleMap();\n\t\t} else if (type === '[object Array]') {\n\t\t\tthis._handleArray();\n\t\t} else {\n\t\t\tthis._result = this._node;\n\t\t}\n\t\treturn this._result;\n\t}\n\t_handleMap() {\n\t\tthis._result = {};\n\t\tconst a = Object.keys(this._node);\n\t\ta.forEach(this._handleKey, this);\n\t}\n\t_handleKey(origKey) {\n\t\tlet newKey = origKey;\n\t\tconst len = origKey.length;\n\t\tif (len === 1) {\n\t\t\tnewKey = CompressUtils.oneCharToKey(origKey, this._data);\n\t\t} else if (len === 2) {\n\t\t\tnewKey = CompressUtils.multCharToKey(origKey, this._data);\n\t\t}\n\t\tthis._result[newKey] = new Decompress(this._node[origKey], this._data).run();\n\t}\n\t_handleArray() {\n\t\tthis._result = [];\n\t\tthis._node.forEach(this._handleArElt, this);\n\t}\n\t_handleArElt(elt) {\n\t\tconst v = new Decompress(elt, this._data).run();\n\t\tthis._result.push(v);\n\t}\n}\n\nexport { Decompress };\n","import { Entity } from '../entity.js';\nimport { CompressUtils } from '../../scene/compress/compress-utils.js';\nimport { Decompress } from '../../scene/compress/decompress.js';\nimport '../../core/tracing.js';\n\nclass SceneParser {\n\tconstructor(app, isTemplate) {\n\t\tthis._app = app;\n\t\tthis._isTemplate = isTemplate;\n\t}\n\tparse(data) {\n\t\tconst entities = {};\n\t\tlet parent = null;\n\t\tconst compressed = data.compressedFormat;\n\t\tif (compressed && !data.entDecompressed) {\n\t\t\tdata.entDecompressed = true;\n\t\t\tdata.entities = new Decompress(data.entities, compressed).run();\n\t\t}\n\t\tfor (const id in data.entities) {\n\t\t\tconst curData = data.entities[id];\n\t\t\tconst curEnt = this._createEntity(curData, compressed);\n\t\t\tentities[id] = curEnt;\n\t\t\tif (curData.parent === null) {\n\t\t\t\tparent = curEnt;\n\t\t\t}\n\t\t}\n\t\tfor (const id in data.entities) {\n\t\t\tconst curEnt = entities[id];\n\t\t\tconst children = data.entities[id].children;\n\t\t\tconst len = children.length;\n\t\t\tfor (let i = 0; i < len; i++) {\n\t\t\t\tconst childEnt = entities[children[i]];\n\t\t\t\tif (childEnt) {\n\t\t\t\t\tcurEnt.addChild(childEnt);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis._openComponentData(parent, data.entities);\n\t\treturn parent;\n\t}\n\t_createEntity(data, compressed) {\n\t\tvar _data$enabled;\n\t\tconst entity = new Entity(data.name, this._app);\n\t\tentity.setGuid(data.resource_id);\n\t\tthis._setPosRotScale(entity, data, compressed);\n\t\tentity._enabled = (_data$enabled = data.enabled) != null ? _data$enabled : true;\n\t\tif (this._isTemplate) {\n\t\t\tentity._template = true;\n\t\t} else {\n\t\t\tentity._enabledInHierarchy = entity._enabled;\n\t\t}\n\t\tentity.template = data.template;\n\t\tif (data.tags) {\n\t\t\tfor (let i = 0; i < data.tags.length; i++) {\n\t\t\t\tentity.tags.add(data.tags[i]);\n\t\t\t}\n\t\t}\n\t\tif (data.labels) {\n\t\t\tdata.labels.forEach(function (label) {\n\t\t\t\tentity.addLabel(label);\n\t\t\t});\n\t\t}\n\t\treturn entity;\n\t}\n\t_setPosRotScale(entity, data, compressed) {\n\t\tif (compressed) {\n\t\t\tCompressUtils.setCompressedPRS(entity, data, compressed);\n\t\t} else {\n\t\t\tconst p = data.position;\n\t\t\tconst r = data.rotation;\n\t\t\tconst s = data.scale;\n\t\t\tentity.setLocalPosition(p[0], p[1], p[2]);\n\t\t\tentity.setLocalEulerAngles(r[0], r[1], r[2]);\n\t\t\tentity.setLocalScale(s[0], s[1], s[2]);\n\t\t}\n\t}\n\t_openComponentData(entity, entities) {\n\t\tconst systemsList = this._app.systems.list;\n\t\tlet len = systemsList.length;\n\t\tconst entityData = entities[entity.getGuid()];\n\t\tfor (let i = 0; i < len; i++) {\n\t\t\tconst system = systemsList[i];\n\t\t\tconst componentData = entityData.components[system.id];\n\t\t\tif (componentData) {\n\t\t\t\tsystem.addComponent(entity, componentData);\n\t\t\t}\n\t\t}\n\t\tlen = entityData.children.length;\n\t\tconst children = entity._children;\n\t\tfor (let i = 0; i < len; i++) {\n\t\t\tif (children[i]) {\n\t\t\t\tchildren[i] = this._openComponentData(children[i], entities);\n\t\t\t}\n\t\t}\n\t\treturn entity;\n\t}\n}\n\nexport { SceneParser };\n","import { http } from '../../platform/net/http.js';\n\nclass SceneUtils {\n\tstatic load(url, maxRetries, callback) {\n\t\tif (typeof url === 'string') {\n\t\t\turl = {\n\t\t\t\tload: url,\n\t\t\t\toriginal: url\n\t\t\t};\n\t\t}\n\t\thttp.get(url.load, {\n\t\t\tretry: maxRetries > 0,\n\t\t\tmaxRetries: maxRetries\n\t\t}, function (err, response) {\n\t\t\tif (!err) {\n\t\t\t\tcallback(err, response);\n\t\t\t} else {\n\t\t\t\tlet errMsg = 'Error while loading scene JSON ' + url.original;\n\t\t\t\tif (err.message) {\n\t\t\t\t\terrMsg += ': ' + err.message;\n\t\t\t\t\tif (err.stack) {\n\t\t\t\t\t\terrMsg += '\\n' + err.stack;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\terrMsg += ': ' + err;\n\t\t\t\t}\n\t\t\t\tcallback(errMsg);\n\t\t\t}\n\t\t});\n\t}\n}\n\nexport { SceneUtils };\n","import { SceneParser } from '../parsers/scene.js';\nimport { SceneUtils } from './scene-utils.js';\n\nclass HierarchyHandler {\n\tconstructor(app) {\n\t\tthis.handlerType = \"hierarchy\";\n\t\tthis._app = app;\n\t\tthis.maxRetries = 0;\n\t}\n\tload(url, callback) {\n\t\tSceneUtils.load(url, this.maxRetries, callback);\n\t}\n\topen(url, data) {\n\t\tthis._app.systems.script.preloading = true;\n\t\tconst parser = new SceneParser(this._app, false);\n\t\tconst parent = parser.parse(data);\n\t\tthis._app.systems.script.preloading = false;\n\t\treturn parent;\n\t}\n}\n\nexport { HierarchyHandler };\n","import { http } from '../../platform/net/http.js';\n\nclass HtmlHandler {\n\tconstructor(app) {\n\t\tthis.handlerType = \"html\";\n\t\tthis.maxRetries = 0;\n\t}\n\tload(url, callback) {\n\t\tif (typeof url === 'string') {\n\t\t\turl = {\n\t\t\t\tload: url,\n\t\t\t\toriginal: url\n\t\t\t};\n\t\t}\n\t\thttp.get(url.load, {\n\t\t\tretry: this.maxRetries > 0,\n\t\t\tmaxRetries: this.maxRetries\n\t\t}, function (err, response) {\n\t\t\tif (!err) {\n\t\t\t\tcallback(null, response);\n\t\t\t} else {\n\t\t\t\tcallback(`Error loading html resource: ${url.original} [${err}]`);\n\t\t\t}\n\t\t});\n\t}\n\topen(url, data) {\n\t\treturn data;\n\t}\n\tpatch(asset, assets) {}\n}\n\nexport { HtmlHandler };\n","import { Http, http } from '../../platform/net/http.js';\n\nclass JsonHandler {\n\tconstructor(app) {\n\t\tthis.handlerType = \"json\";\n\t\tthis.maxRetries = 0;\n\t}\n\tload(url, callback) {\n\t\tif (typeof url === 'string') {\n\t\t\turl = {\n\t\t\t\tload: url,\n\t\t\t\toriginal: url\n\t\t\t};\n\t\t}\n\t\tconst options = {\n\t\t\tretry: this.maxRetries > 0,\n\t\t\tmaxRetries: this.maxRetries\n\t\t};\n\t\tif (url.load.startsWith('blob:')) {\n\t\t\toptions.responseType = Http.ResponseType.JSON;\n\t\t}\n\t\thttp.get(url.load, options, function (err, response) {\n\t\t\tif (!err) {\n\t\t\t\tcallback(null, response);\n\t\t\t} else {\n\t\t\t\tcallback(`Error loading JSON resource: ${url.original} [${err}]`);\n\t\t\t}\n\t\t});\n\t}\n\topen(url, data) {\n\t\treturn data;\n\t}\n\tpatch(asset, assets) {}\n}\n\nexport { JsonHandler };\n","import '../../core/tracing.js';\nimport { CULLFACE_NONE, CULLFACE_BACK, CULLFACE_FRONT, CULLFACE_FRONTANDBACK, FUNC_NEVER, FUNC_LESS, FUNC_EQUAL, FUNC_LESSEQUAL, FUNC_GREATER, FUNC_NOTEQUAL, FUNC_GREATEREQUAL, FUNC_ALWAYS } from '../../platform/graphics/constants.js';\nimport { Texture } from '../../platform/graphics/texture.js';\nimport { SPECOCC_NONE, SPECOCC_AO, SPECOCC_GLOSSDEPENDENT, BLEND_SUBTRACTIVE, BLEND_ADDITIVE, BLEND_NORMAL, BLEND_NONE, BLEND_PREMULTIPLIED, BLEND_MULTIPLICATIVE, BLEND_ADDITIVEALPHA, BLEND_MULTIPLICATIVE2X, BLEND_SCREEN, BLEND_MIN, BLEND_MAX, SPECULAR_PHONG, SPECULAR_BLINN } from '../constants.js';\nimport { standardMaterialParameterTypes, standardMaterialRemovedParameters } from './standard-material-parameters.js';\n\nclass StandardMaterialValidator {\n\tconstructor() {\n\t\tthis.removeInvalid = true;\n\t\tthis.valid = true;\n\t\tthis.enumValidators = {\n\t\t\toccludeSpecular: this._createEnumValidator([SPECOCC_NONE, SPECOCC_AO, SPECOCC_GLOSSDEPENDENT]),\n\t\t\tcull: this._createEnumValidator([CULLFACE_NONE, CULLFACE_BACK, CULLFACE_FRONT, CULLFACE_FRONTANDBACK]),\n\t\t\tblendType: this._createEnumValidator([BLEND_SUBTRACTIVE, BLEND_ADDITIVE, BLEND_NORMAL, BLEND_NONE, BLEND_PREMULTIPLIED, BLEND_MULTIPLICATIVE, BLEND_ADDITIVEALPHA, BLEND_MULTIPLICATIVE2X, BLEND_SCREEN, BLEND_MIN, BLEND_MAX]),\n\t\t\tdepthFunc: this._createEnumValidator([FUNC_NEVER, FUNC_LESS, FUNC_EQUAL, FUNC_LESSEQUAL, FUNC_GREATER, FUNC_NOTEQUAL, FUNC_GREATEREQUAL, FUNC_ALWAYS]),\n\t\t\tshadingModel: this._createEnumValidator([SPECULAR_PHONG, SPECULAR_BLINN])\n\t\t};\n\t}\n\tsetInvalid(key, data) {\n\t\tthis.valid = false;\n\t\tif (this.removeInvalid) {\n\t\t\tdelete data[key];\n\t\t}\n\t}\n\tvalidate(data) {\n\t\tconst TYPES = standardMaterialParameterTypes;\n\t\tconst REMOVED = standardMaterialRemovedParameters;\n\t\tconst pathMapping = data.mappingFormat === 'path';\n\t\tfor (const key in data) {\n\t\t\tconst type = TYPES[key];\n\t\t\tif (!type) {\n\t\t\t\tif (REMOVED[key]) {\n\t\t\t\t\tdelete data[key];\n\t\t\t\t} else {\n\t\t\t\t\tthis.valid = false;\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (type.startsWith('enum')) {\n\t\t\t\tconst enumType = type.split(':')[1];\n\t\t\t\tif (this.enumValidators[enumType]) {\n\t\t\t\t\tif (!this.enumValidators[enumType](data[key])) {\n\t\t\t\t\t\tthis.setInvalid(key, data);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (type === 'number') {\n\t\t\t\tif (typeof data[key] !== 'number') {\n\t\t\t\t\tthis.setInvalid(key, data);\n\t\t\t\t}\n\t\t\t} else if (type === 'boolean') {\n\t\t\t\tif (typeof data[key] !== 'boolean') {\n\t\t\t\t\tthis.setInvalid(key, data);\n\t\t\t\t}\n\t\t\t} else if (type === 'string') {\n\t\t\t\tif (typeof data[key] !== 'string') {\n\t\t\t\t\tthis.setInvalid(key, data);\n\t\t\t\t}\n\t\t\t} else if (type === 'vec2') {\n\t\t\t\tif (!(data[key] instanceof Array && data[key].length === 2)) {\n\t\t\t\t\tthis.setInvalid(key, data);\n\t\t\t\t}\n\t\t\t} else if (type === 'rgb') {\n\t\t\t\tif (!(data[key] instanceof Array && data[key].length === 3)) {\n\t\t\t\t\tthis.setInvalid(key, data);\n\t\t\t\t}\n\t\t\t} else if (type === 'texture') {\n\t\t\t\tif (!pathMapping) {\n\t\t\t\t\tif (!(typeof data[key] === 'number' || data[key] === null)) {\n\t\t\t\t\t\tif (!(data[key] instanceof Texture)) {\n\t\t\t\t\t\t\tthis.setInvalid(key, data);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (!(typeof data[key] === 'string' || data[key] === null)) {\n\t\t\t\t\t\tif (!(data[key] instanceof Texture)) {\n\t\t\t\t\t\t\tthis.setInvalid(key, data);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (type === 'boundingbox') {\n\t\t\t\tif (!(data[key].center && data[key].center instanceof Array && data[key].center.length === 3)) {\n\t\t\t\t\tthis.setInvalid(key, data);\n\t\t\t\t}\n\t\t\t\tif (!(data[key].halfExtents && data[key].halfExtents instanceof Array && data[key].halfExtents.length === 3)) {\n\t\t\t\t\tthis.setInvalid(key, data);\n\t\t\t\t}\n\t\t\t} else if (type === 'cubemap') {\n\t\t\t\tif (!(typeof data[key] === 'number' || data[key] === null || data[key] === undefined)) {\n\t\t\t\t\tif (!(data[key] instanceof Texture && data[key].cubemap)) {\n\t\t\t\t\t\tthis.setInvalid(key, data);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (type === 'chunks') {\n\t\t\t\tconst chunkNames = Object.keys(data[key]);\n\t\t\t\tfor (let i = 0; i < chunkNames.length; i++) {\n\t\t\t\t\tif (typeof data[key][chunkNames[i]] !== 'string') {\n\t\t\t\t\t\tthis.setInvalid(chunkNames[i], data[key]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.error('Unknown material type: ' + type);\n\t\t\t}\n\t\t}\n\t\tdata.validated = true;\n\t\treturn this.valid;\n\t}\n\t_createEnumValidator(values) {\n\t\treturn function (value) {\n\t\t\treturn values.indexOf(value) >= 0;\n\t\t};\n\t}\n}\n\nexport { StandardMaterialValidator };\n","import { extends as _extends } from '../../../_virtual/_rollupPluginBabelHelpers.js';\nimport { Color } from '../../../core/math/color.js';\nimport { Vec2 } from '../../../core/math/vec2.js';\nimport { Vec3 } from '../../../core/math/vec3.js';\nimport { Texture } from '../../../platform/graphics/texture.js';\nimport { BoundingBox } from '../../../core/shape/bounding-box.js';\nimport { SPECULAR_BLINN, SPECULAR_PHONG } from '../../../scene/constants.js';\nimport { StandardMaterial } from '../../../scene/materials/standard-material.js';\nimport { StandardMaterialValidator } from '../../../scene/materials/standard-material-validator.js';\nimport { standardMaterialParameterTypes } from '../../../scene/materials/standard-material-parameters.js';\n\nclass JsonStandardMaterialParser {\n\tconstructor() {\n\t\tthis._validator = null;\n\t}\n\tparse(input) {\n\t\tconst migrated = this.migrate(input);\n\t\tconst validated = this._validate(migrated);\n\t\tconst material = new StandardMaterial();\n\t\tthis.initialize(material, validated);\n\t\treturn material;\n\t}\n\tinitialize(material, data) {\n\t\tif (!data.validated) {\n\t\t\tdata = this._validate(data);\n\t\t}\n\t\tif (data.chunks) {\n\t\t\tmaterial.chunks = _extends({}, data.chunks);\n\t\t}\n\t\tfor (const key in data) {\n\t\t\tconst type = standardMaterialParameterTypes[key];\n\t\t\tconst value = data[key];\n\t\t\tif (type === 'vec2') {\n\t\t\t\tmaterial[key] = new Vec2(value[0], value[1]);\n\t\t\t} else if (type === 'rgb') {\n\t\t\t\tmaterial[key] = new Color(value[0], value[1], value[2]);\n\t\t\t} else if (type === 'texture') {\n\t\t\t\tif (value instanceof Texture) {\n\t\t\t\t\tmaterial[key] = value;\n\t\t\t\t} else if (!(material[key] instanceof Texture && typeof value === 'number' && value > 0)) {\n\t\t\t\t\tmaterial[key] = null;\n\t\t\t\t}\n\t\t\t} else if (type === 'cubemap') {\n\t\t\t\tif (value instanceof Texture) {\n\t\t\t\t\tmaterial[key] = value;\n\t\t\t\t} else if (!(material[key] instanceof Texture && typeof value === 'number' && value > 0)) {\n\t\t\t\t\tmaterial[key] = null;\n\t\t\t\t}\n\t\t\t\tif (key === 'cubeMap' && !value) {\n\t\t\t\t\tmaterial.prefilteredCubemaps = null;\n\t\t\t\t}\n\t\t\t} else if (type === 'boundingbox') {\n\t\t\t\tconst center = new Vec3(value.center[0], value.center[1], value.center[2]);\n\t\t\t\tconst halfExtents = new Vec3(value.halfExtents[0], value.halfExtents[1], value.halfExtents[2]);\n\t\t\t\tmaterial[key] = new BoundingBox(center, halfExtents);\n\t\t\t} else {\n\t\t\t\tmaterial[key] = data[key];\n\t\t\t}\n\t\t}\n\t\tmaterial.update();\n\t}\n\tmigrate(data) {\n\t\tif (data.shadingModel === undefined) {\n\t\t\tif (data.shader === 'blinn') {\n\t\t\t\tdata.shadingModel = SPECULAR_BLINN;\n\t\t\t} else {\n\t\t\t\tdata.shadingModel = SPECULAR_PHONG;\n\t\t\t}\n\t\t}\n\t\tif (data.shader) delete data.shader;\n\t\tif (data.mapping_format) {\n\t\t\tdata.mappingFormat = data.mapping_format;\n\t\t\tdelete data.mapping_format;\n\t\t}\n\t\tlet i;\n\t\tconst RENAMED_PROPERTIES = [['bumpMapFactor', 'bumpiness'], ['aoUvSet', 'aoMapUv'], ['aoMapVertexColor', 'aoVertexColor'], ['diffuseMapVertexColor', 'diffuseVertexColor'], ['emissiveMapVertexColor', 'emissiveVertexColor'], ['specularMapVertexColor', 'specularVertexColor'], ['metalnessMapVertexColor', 'metalnessVertexColor'], ['opacityMapVertexColor', 'opacityVertexColor'], ['glossMapVertexColor', 'glossVertexColor'], ['lightMapVertexColor', 'lightVertexColor'], ['diffuseMapTint', 'diffuseTint'], ['specularMapTint', 'specularTint'], ['emissiveMapTint', 'emissiveTint'], ['metalnessMapTint', 'metalnessTint'], ['clearCoatGlossiness', 'clearCoatGloss']];\n\t\tfor (i = 0; i < RENAMED_PROPERTIES.length; i++) {\n\t\t\tconst _old = RENAMED_PROPERTIES[i][0];\n\t\t\tconst _new = RENAMED_PROPERTIES[i][1];\n\t\t\tif (data[_old] !== undefined) {\n\t\t\t\tif (data[_new] === undefined) {\n\t\t\t\t\tdata[_new] = data[_old];\n\t\t\t\t}\n\t\t\t\tdelete data[_old];\n\t\t\t}\n\t\t}\n\t\tconst DEPRECATED_PROPERTIES = ['fresnelFactor', 'shadowSampleType'];\n\t\tfor (i = 0; i < DEPRECATED_PROPERTIES.length; i++) {\n\t\t\tconst name = DEPRECATED_PROPERTIES[i];\n\t\t\tif (data.hasOwnProperty(name)) {\n\t\t\t\tdelete data[name];\n\t\t\t}\n\t\t}\n\t\treturn data;\n\t}\n\t_validate(data) {\n\t\tif (!data.validated) {\n\t\t\tif (!this._validator) {\n\t\t\t\tthis._validator = new StandardMaterialValidator();\n\t\t\t}\n\t\t\tthis._validator.validate(data);\n\t\t}\n\t\treturn data;\n\t}\n}\n\nexport { JsonStandardMaterialParser };\n","import { http } from '../../platform/net/http.js';\nimport { PIXELFORMAT_RGBA8 } from '../../platform/graphics/constants.js';\nimport { Texture } from '../../platform/graphics/texture.js';\nimport { SPECULAR_PHONG } from '../../scene/constants.js';\nimport { standardMaterialTextureParameters, standardMaterialCubemapParameters } from '../../scene/materials/standard-material-parameters.js';\nimport { AssetReference } from '../asset/asset-reference.js';\nimport { JsonStandardMaterialParser } from '../parsers/material/json-standard-material.js';\n\nconst PLACEHOLDER_MAP = {\n\taoMap: 'white',\n\tdiffuseMap: 'gray',\n\tspecularMap: 'gray',\n\tspecularityFactorMap: 'white',\n\tmetalnessMap: 'black',\n\tglossMap: 'gray',\n\tsheenMap: 'black',\n\tsheenGlossinessMap: 'gray',\n\tclearCoatMap: 'black',\n\tclearCoatGlossMap: 'gray',\n\tclearCoatNormalMap: 'normal',\n\trefractionMap: 'white',\n\temissiveMap: 'gray',\n\tnormalMap: 'normal',\n\theightMap: 'gray',\n\topacityMap: 'gray',\n\tsphereMap: 'gray',\n\tlightMap: 'white'\n};\nclass MaterialHandler {\n\tconstructor(app) {\n\t\tthis.handlerType = \"material\";\n\t\tthis._assets = app.assets;\n\t\tthis._device = app.graphicsDevice;\n\t\tthis._placeholderTextures = null;\n\t\tthis._parser = new JsonStandardMaterialParser();\n\t\tthis.maxRetries = 0;\n\t}\n\tload(url, callback) {\n\t\tif (typeof url === 'string') {\n\t\t\turl = {\n\t\t\t\tload: url,\n\t\t\t\toriginal: url\n\t\t\t};\n\t\t}\n\t\thttp.get(url.load, {\n\t\t\tretry: this.maxRetries > 0,\n\t\t\tmaxRetries: this.maxRetries\n\t\t}, function (err, response) {\n\t\t\tif (!err) {\n\t\t\t\tif (callback) {\n\t\t\t\t\tresponse._engine = true;\n\t\t\t\t\tcallback(null, response);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (callback) {\n\t\t\t\t\tcallback(`Error loading material: ${url.original} [${err}]`);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\topen(url, data) {\n\t\tconst material = this._parser.parse(data);\n\t\tif (data._engine) {\n\t\t\tmaterial._data = data;\n\t\t\tdelete data._engine;\n\t\t}\n\t\treturn material;\n\t}\n\t_createPlaceholders() {\n\t\tthis._placeholderTextures = {};\n\t\tconst textures = {\n\t\t\twhite: [255, 255, 255, 255],\n\t\t\tgray: [128, 128, 128, 255],\n\t\t\tblack: [0, 0, 0, 255],\n\t\t\tnormal: [128, 128, 255, 255]\n\t\t};\n\t\tfor (const key in textures) {\n\t\t\tif (!textures.hasOwnProperty(key)) continue;\n\t\t\tthis._placeholderTextures[key] = new Texture(this._device, {\n\t\t\t\twidth: 2,\n\t\t\t\theight: 2,\n\t\t\t\tformat: PIXELFORMAT_RGBA8,\n\t\t\t\tname: 'material_placeholder'\n\t\t\t});\n\t\t\tconst pixels = this._placeholderTextures[key].lock();\n\t\t\tfor (let i = 0; i < 4; i++) {\n\t\t\t\tfor (let c = 0; c < 4; c++) {\n\t\t\t\t\tpixels[i * 4 + c] = textures[key][c];\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._placeholderTextures[key].unlock();\n\t\t}\n\t}\n\tpatch(asset, assets) {\n\t\tif (asset.resource._data) {\n\t\t\tasset._data = asset.resource._data;\n\t\t\tdelete asset.resource._data;\n\t\t}\n\t\tasset.data.name = asset.name;\n\t\tasset.resource.name = asset.name;\n\t\tthis._bindAndAssignAssets(asset, assets);\n\t\tasset.off('unload', this._onAssetUnload, this);\n\t\tasset.on('unload', this._onAssetUnload, this);\n\t}\n\t_onAssetUnload(asset) {\n\t\tdelete asset.data.parameters;\n\t\tdelete asset.data.chunks;\n\t\tdelete asset.data.name;\n\t}\n\t_assignTexture(parameterName, materialAsset, texture) {\n\t\tmaterialAsset.resource[parameterName] = texture;\n\t}\n\t_getPlaceholderTexture(parameterName) {\n\t\tif (!this._placeholderTextures) {\n\t\t\tthis._createPlaceholders();\n\t\t}\n\t\tconst placeholder = PLACEHOLDER_MAP[parameterName];\n\t\tconst texture = this._placeholderTextures[placeholder];\n\t\treturn texture;\n\t}\n\t_assignPlaceholderTexture(parameterName, materialAsset) {\n\t\tmaterialAsset.resource[parameterName] = this._getPlaceholderTexture(parameterName);\n\t}\n\t_onTextureLoad(parameterName, materialAsset, textureAsset) {\n\t\tthis._assignTexture(parameterName, materialAsset, textureAsset.resource);\n\t\tmaterialAsset.resource.update();\n\t}\n\t_onTextureAdd(parameterName, materialAsset, textureAsset) {\n\t\tthis._assets.load(textureAsset);\n\t}\n\t_onTextureRemoveOrUnload(parameterName, materialAsset, textureAsset) {\n\t\tconst material = materialAsset.resource;\n\t\tif (material) {\n\t\t\tif (materialAsset.resource[parameterName] === textureAsset.resource) {\n\t\t\t\tthis._assignPlaceholderTexture(parameterName, materialAsset);\n\t\t\t\tmaterial.update();\n\t\t\t}\n\t\t}\n\t}\n\t_assignCubemap(parameterName, materialAsset, textures) {\n\t\tmaterialAsset.resource[parameterName] = textures[0];\n\t\tif (parameterName === 'cubeMap') {\n\t\t\tconst prefiltered = textures.slice(1);\n\t\t\tif (prefiltered.every(t => t)) {\n\t\t\t\tmaterialAsset.resource.prefilteredCubemaps = prefiltered;\n\t\t\t} else if (prefiltered[0]) {\n\t\t\t\tmaterialAsset.resource.envAtlas = prefiltered[0];\n\t\t\t}\n\t\t}\n\t}\n\t_onCubemapLoad(parameterName, materialAsset, cubemapAsset) {\n\t\tthis._assignCubemap(parameterName, materialAsset, cubemapAsset.resources);\n\t\tthis._parser.initialize(materialAsset.resource, materialAsset.data);\n\t}\n\t_onCubemapAdd(parameterName, materialAsset, cubemapAsset) {\n\t\tif (materialAsset.data.shadingModel === SPECULAR_PHONG) {\n\t\t\tmaterialAsset.loadFaces = true;\n\t\t}\n\t\tthis._assets.load(cubemapAsset);\n\t}\n\t_onCubemapRemoveOrUnload(parameterName, materialAsset, cubemapAsset) {\n\t\tconst material = materialAsset.resource;\n\t\tif (materialAsset.data.prefilteredCubeMap128 === cubemapAsset.resources[1]) {\n\t\t\tthis._assignCubemap(parameterName, materialAsset, [null, null, null, null, null, null, null]);\n\t\t\tmaterial.update();\n\t\t}\n\t}\n\t_bindAndAssignAssets(materialAsset, assets) {\n\t\tconst data = this._parser.migrate(materialAsset.data);\n\t\tconst material = materialAsset.resource;\n\t\tconst pathMapping = data.mappingFormat === 'path';\n\t\tconst TEXTURES = standardMaterialTextureParameters;\n\t\tlet i, name, assetReference;\n\t\tfor (i = 0; i < TEXTURES.length; i++) {\n\t\t\tname = TEXTURES[i];\n\t\t\tassetReference = material._assetReferences[name];\n\t\t\tconst dataAssetId = data[name];\n\t\t\tconst materialTexture = material[name];\n\t\t\tconst isPlaceHolderTexture = materialTexture === this._getPlaceholderTexture(name);\n\t\t\tconst dataValidated = data.validated;\n\t\t\tif (dataAssetId && (!materialTexture || !dataValidated || isPlaceHolderTexture)) {\n\t\t\t\tif (!assetReference) {\n\t\t\t\t\tassetReference = new AssetReference(name, materialAsset, assets, {\n\t\t\t\t\t\tload: this._onTextureLoad,\n\t\t\t\t\t\tadd: this._onTextureAdd,\n\t\t\t\t\t\tremove: this._onTextureRemoveOrUnload,\n\t\t\t\t\t\tunload: this._onTextureRemoveOrUnload\n\t\t\t\t\t}, this);\n\t\t\t\t\tmaterial._assetReferences[name] = assetReference;\n\t\t\t\t}\n\t\t\t\tif (pathMapping) {\n\t\t\t\t\tassetReference.url = materialAsset.getAbsoluteUrl(dataAssetId);\n\t\t\t\t} else {\n\t\t\t\t\tassetReference.id = dataAssetId;\n\t\t\t\t}\n\t\t\t\tif (assetReference.asset) {\n\t\t\t\t\tif (assetReference.asset.resource) {\n\t\t\t\t\t\tthis._assignTexture(name, materialAsset, assetReference.asset.resource);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._assignPlaceholderTexture(name, materialAsset);\n\t\t\t\t\t}\n\t\t\t\t\tassets.load(assetReference.asset);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (assetReference) {\n\t\t\t\t\tif (pathMapping) {\n\t\t\t\t\t\tassetReference.url = null;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tassetReference.id = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst CUBEMAPS = standardMaterialCubemapParameters;\n\t\tfor (i = 0; i < CUBEMAPS.length; i++) {\n\t\t\tname = CUBEMAPS[i];\n\t\t\tassetReference = material._assetReferences[name];\n\t\t\tif (data[name] && !materialAsset.data.prefilteredCubeMap128) {\n\t\t\t\tif (!assetReference) {\n\t\t\t\t\tassetReference = new AssetReference(name, materialAsset, assets, {\n\t\t\t\t\t\tload: this._onCubemapLoad,\n\t\t\t\t\t\tadd: this._onCubemapAdd,\n\t\t\t\t\t\tremove: this._onCubemapRemoveOrUnload,\n\t\t\t\t\t\tunload: this._onCubemapRemoveOrUnload\n\t\t\t\t\t}, this);\n\t\t\t\t\tmaterial._assetReferences[name] = assetReference;\n\t\t\t\t}\n\t\t\t\tif (pathMapping) {\n\t\t\t\t\tassetReference.url = data[name];\n\t\t\t\t} else {\n\t\t\t\t\tassetReference.id = data[name];\n\t\t\t\t}\n\t\t\t\tif (assetReference.asset) {\n\t\t\t\t\tif (assetReference.asset.loaded) {\n\t\t\t\t\t\tthis._assignCubemap(name, materialAsset, assetReference.asset.resources);\n\t\t\t\t\t}\n\t\t\t\t\tassets.load(assetReference.asset);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis._parser.initialize(material, data);\n\t}\n}\n\nexport { MaterialHandler };\n","import { GlbContainerResource } from './glb-container-resource.js';\nimport { GlbParser } from './glb-parser.js';\n\nclass GlbModelParser {\n\tconstructor(modelHandler) {\n\t\tthis._device = modelHandler.device;\n\t\tthis._defaultMaterial = modelHandler.defaultMaterial;\n\t\tthis._assets = modelHandler.assets;\n\t}\n\tparse(data, callback, asset) {\n\t\tvar _asset$options;\n\t\tGlbParser.parse('filename.glb', '', data, this._device, this._assets, (_asset$options = asset == null ? void 0 : asset.options) != null ? _asset$options : {}, (err, result) => {\n\t\t\tif (err) {\n\t\t\t\tcallback(err);\n\t\t\t} else {\n\t\t\t\tconst model = GlbContainerResource.createModel(result, this._defaultMaterial);\n\t\t\t\tresult.destroy();\n\t\t\t\tcallback(null, model);\n\t\t\t}\n\t\t});\n\t}\n}\n\nexport { GlbModelParser };\n","class PartitionedVertex {\n\tconstructor() {\n\t\tthis.index = 0;\n\t\tthis.boneIndices = [0, 0, 0, 0];\n\t}\n}\nclass SkinPartition {\n\tconstructor() {\n\t\tthis.partition = 0;\n\t\tthis.vertexStart = 0;\n\t\tthis.vertexCount = 0;\n\t\tthis.indexStart = 0;\n\t\tthis.indexCount = 0;\n\t\tthis.boneIndices = [];\n\t\tthis.vertices = [];\n\t\tthis.indices = [];\n\t\tthis.indexMap = {};\n\t\tthis.originalMesh = null;\n\t}\n\taddVertex(vertex, idx, vertexArray) {\n\t\tlet remappedIndex = -1;\n\t\tif (this.indexMap[idx] !== undefined) {\n\t\t\tremappedIndex = this.indexMap[idx];\n\t\t\tthis.indices.push(remappedIndex);\n\t\t} else {\n\t\t\tfor (let influence = 0; influence < 4; influence++) {\n\t\t\t\tif (vertexArray.blendWeight.data[idx * 4 + influence] === 0) continue;\n\t\t\t\tconst originalBoneIndex = vertexArray.blendIndices.data[vertex.index * 4 + influence];\n\t\t\t\tvertex.boneIndices[influence] = this.getBoneRemap(originalBoneIndex);\n\t\t\t}\n\t\t\tremappedIndex = this.vertices.length;\n\t\t\tthis.indices.push(remappedIndex);\n\t\t\tthis.vertices.push(vertex);\n\t\t\tthis.indexMap[idx] = remappedIndex;\n\t\t}\n\t}\n\taddPrimitive(vertices, vertexIndices, vertexArray, boneLimit) {\n\t\tconst bonesToAdd = [];\n\t\tlet bonesToAddCount = 0;\n\t\tconst vertexCount = vertices.length;\n\t\tfor (let i = 0; i < vertexCount; i++) {\n\t\t\tconst vertex = vertices[i];\n\t\t\tconst idx = vertex.index;\n\t\t\tfor (let influence = 0; influence < 4; influence++) {\n\t\t\t\tif (vertexArray.blendWeight.data[idx * 4 + influence] > 0) {\n\t\t\t\t\tconst boneIndex = vertexArray.blendIndices.data[idx * 4 + influence];\n\t\t\t\t\tlet needToAdd = true;\n\t\t\t\t\tfor (let j = 0; j < bonesToAddCount; j++) {\n\t\t\t\t\t\tif (bonesToAdd[j] === boneIndex) {\n\t\t\t\t\t\t\tneedToAdd = false;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (needToAdd) {\n\t\t\t\t\t\tbonesToAdd[bonesToAddCount] = boneIndex;\n\t\t\t\t\t\tconst boneRemap = this.getBoneRemap(boneIndex);\n\t\t\t\t\t\tbonesToAddCount += boneRemap === -1 ? 1 : 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (this.boneIndices.length + bonesToAddCount > boneLimit) {\n\t\t\treturn false;\n\t\t}\n\t\tfor (let i = 0; i < bonesToAddCount; i++) {\n\t\t\tthis.boneIndices.push(bonesToAdd[i]);\n\t\t}\n\t\tfor (let i = 0; i < vertexCount; i++) {\n\t\t\tthis.addVertex(vertices[i], vertexIndices[i], vertexArray);\n\t\t}\n\t\treturn true;\n\t}\n\tgetBoneRemap(boneIndex) {\n\t\tfor (let i = 0; i < this.boneIndices.length; i++) {\n\t\t\tif (this.boneIndices[i] === boneIndex) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t}\n}\nfunction indicesToReferences(model) {\n\tconst vertices = model.vertices;\n\tconst skins = model.skins;\n\tconst meshes = model.meshes;\n\tconst meshInstances = model.meshInstances;\n\tfor (let i = 0; i < meshes.length; i++) {\n\t\tmeshes[i].vertices = vertices[meshes[i].vertices];\n\t\tif (meshes[i].skin !== undefined) {\n\t\t\tmeshes[i].skin = skins[meshes[i].skin];\n\t\t}\n\t}\n\tfor (let i = 0; i < meshInstances.length; i++) {\n\t\tmeshInstances[i].mesh = meshes[meshInstances[i].mesh];\n\t}\n}\nfunction referencesToIndices(model) {\n\tconst vertices = model.vertices;\n\tconst skins = model.skins;\n\tconst meshes = model.meshes;\n\tconst meshInstances = model.meshInstances;\n\tfor (let i = 0; i < meshes.length; i++) {\n\t\tmeshes[i].vertices = vertices.indexOf(meshes[i].vertices);\n\t\tif (meshes[i].skin !== undefined) {\n\t\t\tmeshes[i].skin = skins.indexOf(meshes[i].skin);\n\t\t}\n\t}\n\tfor (let i = 0; i < meshInstances.length; i++) {\n\t\tmeshInstances[i].mesh = meshes.indexOf(meshInstances[i].mesh);\n\t}\n}\nfunction partitionSkin(model, materialMappings, boneLimit) {\n\tlet i, j, k, index;\n\tindicesToReferences(model);\n\tconst vertexArrays = model.vertices;\n\tconst skins = model.skins;\n\tlet mesh;\n\tconst meshes = model.meshes;\n\tconst meshInstances = model.meshInstances;\n\tconst getVertex = function getVertex(idx) {\n\t\tconst vert = new PartitionedVertex();\n\t\tvert.index = idx;\n\t\treturn vert;\n\t};\n\tfor (i = skins.length - 1; i >= 0; i--) {\n\t\tif (skins[i].boneNames.length > boneLimit) {\n\t\t\tconst skin = skins.splice(i, 1)[0];\n\t\t\tconst meshesToSplit = [];\n\t\t\tfor (j = 0; j < meshes.length; j++) {\n\t\t\t\tif (meshes[j].skin === skin) {\n\t\t\t\t\tmeshesToSplit.push(meshes[j]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (j = 0; j < meshesToSplit.length; j++) {\n\t\t\t\tindex = meshes.indexOf(meshesToSplit[j]);\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\tmeshes.splice(index, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (meshesToSplit.length === 0) {\n\t\t\t\tthrow new Error('partitionSkin: There should be at least one mesh that references a skin');\n\t\t\t}\n\t\t\tconst vertexArray = meshesToSplit[0].vertices;\n\t\t\tfor (j = 1; j < meshesToSplit.length; j++) {\n\t\t\t\tif (meshesToSplit[j].vertices !== vertexArray) {\n\t\t\t\t\tthrow new Error('partitionSkin: All meshes that share a skin should also share the same vertex buffer');\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet partition;\n\t\t\tconst partitions = [];\n\t\t\tconst primitiveVertices = [];\n\t\t\tconst primitiveIndices = [];\n\t\t\tlet basePartition = 0;\n\t\t\tfor (j = 0; j < meshesToSplit.length; j++) {\n\t\t\t\tmesh = meshesToSplit[j];\n\t\t\t\tconst indices = mesh.indices;\n\t\t\t\tfor (let iIndex = mesh.base; iIndex < mesh.base + mesh.count;) {\n\t\t\t\t\tindex = indices[iIndex++];\n\t\t\t\t\tprimitiveVertices[0] = getVertex(index);\n\t\t\t\t\tprimitiveIndices[0] = index;\n\t\t\t\t\tindex = indices[iIndex++];\n\t\t\t\t\tprimitiveVertices[1] = getVertex(index);\n\t\t\t\t\tprimitiveIndices[1] = index;\n\t\t\t\t\tindex = indices[iIndex++];\n\t\t\t\t\tprimitiveVertices[2] = getVertex(index);\n\t\t\t\t\tprimitiveIndices[2] = index;\n\t\t\t\t\tlet added = false;\n\t\t\t\t\tfor (let iBonePartition = basePartition; iBonePartition < partitions.length; iBonePartition++) {\n\t\t\t\t\t\tpartition = partitions[iBonePartition];\n\t\t\t\t\t\tif (partition.addPrimitive(primitiveVertices, primitiveIndices, vertexArray, boneLimit)) {\n\t\t\t\t\t\t\tadded = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (!added) {\n\t\t\t\t\t\tpartition = new SkinPartition();\n\t\t\t\t\t\tpartition.originalMesh = mesh;\n\t\t\t\t\t\tpartition.addPrimitive(primitiveVertices, primitiveIndices, vertexArray, boneLimit);\n\t\t\t\t\t\tpartitions.push(partition);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbasePartition = partitions.length;\n\t\t\t}\n\t\t\tconst partitionedVertices = [];\n\t\t\tconst partitionedIndices = [];\n\t\t\tfor (j = 0; j < partitions.length; j++) {\n\t\t\t\tpartition = partitions[j];\n\t\t\t\tif (partition.vertices.length && partition.indices.length) {\n\t\t\t\t\tconst vertexStart = partitionedVertices.length;\n\t\t\t\t\tconst vertexCount = partition.vertices.length;\n\t\t\t\t\tconst indexStart = partitionedIndices.length;\n\t\t\t\t\tconst indexCount = partition.indices.length;\n\t\t\t\t\tpartition.partition = j;\n\t\t\t\t\tpartition.vertexStart = vertexStart;\n\t\t\t\t\tpartition.vertexCount = vertexCount;\n\t\t\t\t\tpartition.indexStart = indexStart;\n\t\t\t\t\tpartition.indexCount = indexCount;\n\t\t\t\t\tlet iSour;\n\t\t\t\t\tlet iDest;\n\t\t\t\t\tiSour = 0;\n\t\t\t\t\tiDest = vertexStart;\n\t\t\t\t\twhile (iSour < vertexCount) {\n\t\t\t\t\t\tpartitionedVertices[iDest++] = partition.vertices[iSour++];\n\t\t\t\t\t}\n\t\t\t\t\tiSour = 0;\n\t\t\t\t\tiDest = indexStart;\n\t\t\t\t\twhile (iSour < indexCount) {\n\t\t\t\t\t\tpartitionedIndices[iDest++] = partition.indices[iSour++] + vertexStart;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst splitSkins = [];\n\t\t\tfor (j = 0; j < partitions.length; j++) {\n\t\t\t\tpartition = partitions[j];\n\t\t\t\tconst ibp = [];\n\t\t\t\tconst boneNames = [];\n\t\t\t\tfor (k = 0; k < partition.boneIndices.length; k++) {\n\t\t\t\t\tibp.push(skin.inverseBindMatrices[partition.boneIndices[k]]);\n\t\t\t\t\tboneNames.push(skin.boneNames[partition.boneIndices[k]]);\n\t\t\t\t}\n\t\t\t\tconst splitSkin = {\n\t\t\t\t\tinverseBindMatrices: ibp,\n\t\t\t\t\tboneNames: boneNames\n\t\t\t\t};\n\t\t\t\tsplitSkins.push(splitSkin);\n\t\t\t\tskins.push(splitSkin);\n\t\t\t}\n\t\t\tlet attrib, attribName, data, components;\n\t\t\tconst splitVertexArray = {};\n\t\t\tfor (attribName in vertexArray) {\n\t\t\t\tsplitVertexArray[attribName] = {\n\t\t\t\t\tcomponents: vertexArray[attribName].components,\n\t\t\t\t\tdata: [],\n\t\t\t\t\ttype: vertexArray[attribName].type\n\t\t\t\t};\n\t\t\t}\n\t\t\tfor (attribName in vertexArray) {\n\t\t\t\tif (attribName === 'blendIndices') {\n\t\t\t\t\tconst dstBoneIndices = splitVertexArray[attribName].data;\n\t\t\t\t\tfor (j = 0; j < partitionedVertices.length; j++) {\n\t\t\t\t\t\tconst srcBoneIndices = partitionedVertices[j].boneIndices;\n\t\t\t\t\t\tdstBoneIndices.push(srcBoneIndices[0], srcBoneIndices[1], srcBoneIndices[2], srcBoneIndices[3]);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tattrib = vertexArray[attribName];\n\t\t\t\t\tdata = attrib.data;\n\t\t\t\t\tcomponents = attrib.components;\n\t\t\t\t\tfor (j = 0; j < partitionedVertices.length; j++) {\n\t\t\t\t\t\tindex = partitionedVertices[j].index;\n\t\t\t\t\t\tfor (k = 0; k < components; k++) {\n\t\t\t\t\t\t\tsplitVertexArray[attribName].data.push(data[index * components + k]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tvertexArrays[vertexArrays.indexOf(vertexArray)] = splitVertexArray;\n\t\t\tfor (j = 0; j < partitions.length; j++) {\n\t\t\t\tpartition = partitions[j];\n\t\t\t\tmesh = {\n\t\t\t\t\taabb: {\n\t\t\t\t\t\tmin: [0, 0, 0],\n\t\t\t\t\t\tmax: [0, 0, 0]\n\t\t\t\t\t},\n\t\t\t\t\tvertices: splitVertexArray,\n\t\t\t\t\tskin: splitSkins[j],\n\t\t\t\t\tindices: partitionedIndices.splice(0, partition.indexCount),\n\t\t\t\t\ttype: 'triangles',\n\t\t\t\t\tbase: 0,\n\t\t\t\t\tcount: partition.indexCount\n\t\t\t\t};\n\t\t\t\tmeshes.push(mesh);\n\t\t\t\tfor (k = meshInstances.length - 1; k >= 0; k--) {\n\t\t\t\t\tif (meshInstances[k].mesh === partition.originalMesh) {\n\t\t\t\t\t\tmeshInstances.push({\n\t\t\t\t\t\t\tmesh: mesh,\n\t\t\t\t\t\t\tnode: meshInstances[k].node\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (materialMappings) {\n\t\t\t\t\t\t\tmaterialMappings.push({\n\t\t\t\t\t\t\t\tmaterial: materialMappings[k].material,\n\t\t\t\t\t\t\t\tpath: materialMappings[k].path\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (j = 0; j < partitions.length; j++) {\n\t\t\t\tpartition = partitions[j];\n\t\t\t\tfor (k = meshInstances.length - 1; k >= 0; k--) {\n\t\t\t\t\tif (meshInstances[k].mesh === partition.originalMesh) {\n\t\t\t\t\t\tmeshInstances.splice(k, 1);\n\t\t\t\t\t\tif (materialMappings) {\n\t\t\t\t\t\t\tmaterialMappings.splice(k, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treferencesToIndices(model);\n}\n\nexport { partitionSkin };\n","import { Mat4 } from '../../core/math/mat4.js';\nimport { Vec3 } from '../../core/math/vec3.js';\nimport { BoundingBox } from '../../core/shape/bounding-box.js';\nimport { SEMANTIC_COLOR, INDEXFORMAT_UINT32, INDEXFORMAT_UINT16, PRIMITIVE_POINTS, PRIMITIVE_LINES, PRIMITIVE_LINELOOP, PRIMITIVE_LINESTRIP, PRIMITIVE_TRIANGLES, PRIMITIVE_TRISTRIP, PRIMITIVE_TRIFAN, TYPE_INT8, TYPE_UINT8, TYPE_INT16, TYPE_UINT16, TYPE_INT32, TYPE_UINT32, TYPE_FLOAT32, SEMANTIC_POSITION, SEMANTIC_NORMAL, SEMANTIC_TANGENT, SEMANTIC_BLENDWEIGHT, SEMANTIC_BLENDINDICES, SEMANTIC_TEXCOORD0, SEMANTIC_TEXCOORD1, SEMANTIC_TEXCOORD2, SEMANTIC_TEXCOORD3, SEMANTIC_TEXCOORD4, SEMANTIC_TEXCOORD5, SEMANTIC_TEXCOORD6, SEMANTIC_TEXCOORD7 } from '../../platform/graphics/constants.js';\nimport { IndexBuffer } from '../../platform/graphics/index-buffer.js';\nimport { VertexBuffer } from '../../platform/graphics/vertex-buffer.js';\nimport { VertexFormat } from '../../platform/graphics/vertex-format.js';\nimport { VertexIterator } from '../../platform/graphics/vertex-iterator.js';\nimport { partitionSkin } from '../../scene/skin-partition.js';\nimport { GraphNode } from '../../scene/graph-node.js';\nimport { Mesh } from '../../scene/mesh.js';\nimport { MeshInstance } from '../../scene/mesh-instance.js';\nimport { Model } from '../../scene/model.js';\nimport { Morph } from '../../scene/morph.js';\nimport { MorphInstance } from '../../scene/morph-instance.js';\nimport { MorphTarget } from '../../scene/morph-target.js';\nimport { Skin } from '../../scene/skin.js';\nimport { SkinInstance } from '../../scene/skin-instance.js';\n\nconst JSON_PRIMITIVE_TYPE = {\n\t'points': PRIMITIVE_POINTS,\n\t'lines': PRIMITIVE_LINES,\n\t'lineloop': PRIMITIVE_LINELOOP,\n\t'linestrip': PRIMITIVE_LINESTRIP,\n\t'triangles': PRIMITIVE_TRIANGLES,\n\t'trianglestrip': PRIMITIVE_TRISTRIP,\n\t'trianglefan': PRIMITIVE_TRIFAN\n};\nconst JSON_VERTEX_ELEMENT_TYPE = {\n\t'int8': TYPE_INT8,\n\t'uint8': TYPE_UINT8,\n\t'int16': TYPE_INT16,\n\t'uint16': TYPE_UINT16,\n\t'int32': TYPE_INT32,\n\t'uint32': TYPE_UINT32,\n\t'float32': TYPE_FLOAT32\n};\nclass JsonModelParser {\n\tconstructor(modelHandler) {\n\t\tthis._device = modelHandler.device;\n\t\tthis._defaultMaterial = modelHandler.defaultMaterial;\n\t}\n\tparse(data, callback) {\n\t\tconst modelData = data.model;\n\t\tif (!modelData) {\n\t\t\tcallback(null, null);\n\t\t\treturn;\n\t\t}\n\t\tif (modelData.version <= 1) {\n\t\t\tcallback('JsonModelParser#parse: Trying to parse unsupported model format.');\n\t\t\treturn;\n\t\t}\n\t\tconst nodes = this._parseNodes(data);\n\t\tconst skins = this._parseSkins(data, nodes);\n\t\tconst vertexBuffers = this._parseVertexBuffers(data);\n\t\tconst indices = this._parseIndexBuffers(data, vertexBuffers);\n\t\tconst morphs = this._parseMorphs(data, nodes, vertexBuffers);\n\t\tconst meshes = this._parseMeshes(data, skins.skins, morphs.morphs, vertexBuffers, indices.buffer, indices.data);\n\t\tconst meshInstances = this._parseMeshInstances(data, nodes, meshes, skins.skins, skins.instances, morphs.morphs, morphs.instances);\n\t\tconst model = new Model();\n\t\tmodel.graph = nodes[0];\n\t\tmodel.meshInstances = meshInstances;\n\t\tmodel.skinInstances = skins.instances;\n\t\tmodel.morphInstances = morphs.instances;\n\t\tmodel.getGraph().syncHierarchy();\n\t\tcallback(null, model);\n\t}\n\t_parseNodes(data) {\n\t\tconst modelData = data.model;\n\t\tconst nodes = [];\n\t\tlet i;\n\t\tfor (i = 0; i < modelData.nodes.length; i++) {\n\t\t\tconst nodeData = modelData.nodes[i];\n\t\t\tconst node = new GraphNode(nodeData.name);\n\t\t\tnode.setLocalPosition(nodeData.position[0], nodeData.position[1], nodeData.position[2]);\n\t\t\tnode.setLocalEulerAngles(nodeData.rotation[0], nodeData.rotation[1], nodeData.rotation[2]);\n\t\t\tnode.setLocalScale(nodeData.scale[0], nodeData.scale[1], nodeData.scale[2]);\n\t\t\tnode.scaleCompensation = !!nodeData.scaleCompensation;\n\t\t\tnodes.push(node);\n\t\t}\n\t\tfor (i = 1; i < modelData.parents.length; i++) {\n\t\t\tnodes[modelData.parents[i]].addChild(nodes[i]);\n\t\t}\n\t\treturn nodes;\n\t}\n\t_parseSkins(data, nodes) {\n\t\tconst modelData = data.model;\n\t\tconst skins = [];\n\t\tconst skinInstances = [];\n\t\tlet i, j;\n\t\tif (!this._device.supportsBoneTextures && modelData.skins.length > 0) {\n\t\t\tconst boneLimit = this._device.getBoneLimit();\n\t\t\tpartitionSkin(modelData, null, boneLimit);\n\t\t}\n\t\tfor (i = 0; i < modelData.skins.length; i++) {\n\t\t\tconst skinData = modelData.skins[i];\n\t\t\tconst inverseBindMatrices = [];\n\t\t\tfor (j = 0; j < skinData.inverseBindMatrices.length; j++) {\n\t\t\t\tconst ibm = skinData.inverseBindMatrices[j];\n\t\t\t\tinverseBindMatrices[j] = new Mat4().set(ibm);\n\t\t\t}\n\t\t\tconst skin = new Skin(this._device, inverseBindMatrices, skinData.boneNames);\n\t\t\tskins.push(skin);\n\t\t\tconst skinInstance = new SkinInstance(skin);\n\t\t\tconst bones = [];\n\t\t\tfor (j = 0; j < skin.boneNames.length; j++) {\n\t\t\t\tconst boneName = skin.boneNames[j];\n\t\t\t\tconst bone = nodes[0].findByName(boneName);\n\t\t\t\tbones.push(bone);\n\t\t\t}\n\t\t\tskinInstance.bones = bones;\n\t\t\tskinInstances.push(skinInstance);\n\t\t}\n\t\treturn {\n\t\t\tskins: skins,\n\t\t\tinstances: skinInstances\n\t\t};\n\t}\n\t_getMorphVertexCount(modelData, morphIndex, vertexBuffers) {\n\t\tfor (let i = 0; i < modelData.meshes.length; i++) {\n\t\t\tconst meshData = modelData.meshes[i];\n\t\t\tif (meshData.morph === morphIndex) {\n\t\t\t\tconst vertexBuffer = vertexBuffers[meshData.vertices];\n\t\t\t\treturn vertexBuffer.numVertices;\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\t_parseMorphs(data, nodes, vertexBuffers) {\n\t\tconst modelData = data.model;\n\t\tconst morphs = [];\n\t\tconst morphInstances = [];\n\t\tlet i, j, vertexCount;\n\t\tlet targets, morphTarget, morphTargetArray;\n\t\tif (modelData.morphs) {\n\t\t\tconst sparseToFull = function sparseToFull(data, indices, totalCount) {\n\t\t\t\tconst full = new Float32Array(totalCount * 3);\n\t\t\t\tfor (let s = 0; s < indices.length; s++) {\n\t\t\t\t\tconst dstIndex = indices[s] * 3;\n\t\t\t\t\tfull[dstIndex] = data[s * 3];\n\t\t\t\t\tfull[dstIndex + 1] = data[s * 3 + 1];\n\t\t\t\t\tfull[dstIndex + 2] = data[s * 3 + 2];\n\t\t\t\t}\n\t\t\t\treturn full;\n\t\t\t};\n\t\t\tfor (i = 0; i < modelData.morphs.length; i++) {\n\t\t\t\ttargets = modelData.morphs[i].targets;\n\t\t\t\tmorphTargetArray = [];\n\t\t\t\tvertexCount = this._getMorphVertexCount(modelData, i, vertexBuffers);\n\t\t\t\tfor (j = 0; j < targets.length; j++) {\n\t\t\t\t\tconst targetAabb = targets[j].aabb;\n\t\t\t\t\tconst min = targetAabb.min;\n\t\t\t\t\tconst max = targetAabb.max;\n\t\t\t\t\tconst aabb = new BoundingBox(new Vec3((max[0] + min[0]) * 0.5, (max[1] + min[1]) * 0.5, (max[2] + min[2]) * 0.5), new Vec3((max[0] - min[0]) * 0.5, (max[1] - min[1]) * 0.5, (max[2] - min[2]) * 0.5));\n\t\t\t\t\tconst indices = targets[j].indices;\n\t\t\t\t\tlet deltaPositions = targets[j].deltaPositions;\n\t\t\t\t\tlet deltaNormals = targets[j].deltaNormals;\n\t\t\t\t\tif (indices) {\n\t\t\t\t\t\tdeltaPositions = sparseToFull(deltaPositions, indices, vertexCount);\n\t\t\t\t\t\tdeltaNormals = sparseToFull(deltaNormals, indices, vertexCount);\n\t\t\t\t\t}\n\t\t\t\t\tmorphTarget = new MorphTarget({\n\t\t\t\t\t\tdeltaPositions: deltaPositions,\n\t\t\t\t\t\tdeltaNormals: deltaNormals,\n\t\t\t\t\t\tname: targets[j].name,\n\t\t\t\t\t\taabb: aabb\n\t\t\t\t\t});\n\t\t\t\t\tmorphTargetArray.push(morphTarget);\n\t\t\t\t}\n\t\t\t\tconst morph = new Morph(morphTargetArray, this._device);\n\t\t\t\tmorphs.push(morph);\n\t\t\t\tconst morphInstance = new MorphInstance(morph);\n\t\t\t\tmorphInstances.push(morphInstance);\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\tmorphs: morphs,\n\t\t\tinstances: morphInstances\n\t\t};\n\t}\n\t_parseVertexBuffers(data) {\n\t\tconst modelData = data.model;\n\t\tconst vertexBuffers = [];\n\t\tconst attributeMap = {\n\t\t\tposition: SEMANTIC_POSITION,\n\t\t\tnormal: SEMANTIC_NORMAL,\n\t\t\ttangent: SEMANTIC_TANGENT,\n\t\t\tblendWeight: SEMANTIC_BLENDWEIGHT,\n\t\t\tblendIndices: SEMANTIC_BLENDINDICES,\n\t\t\tcolor: SEMANTIC_COLOR,\n\t\t\ttexCoord0: SEMANTIC_TEXCOORD0,\n\t\t\ttexCoord1: SEMANTIC_TEXCOORD1,\n\t\t\ttexCoord2: SEMANTIC_TEXCOORD2,\n\t\t\ttexCoord3: SEMANTIC_TEXCOORD3,\n\t\t\ttexCoord4: SEMANTIC_TEXCOORD4,\n\t\t\ttexCoord5: SEMANTIC_TEXCOORD5,\n\t\t\ttexCoord6: SEMANTIC_TEXCOORD6,\n\t\t\ttexCoord7: SEMANTIC_TEXCOORD7\n\t\t};\n\t\tfor (let i = 0; i < modelData.vertices.length; i++) {\n\t\t\tconst vertexData = modelData.vertices[i];\n\t\t\tconst formatDesc = [];\n\t\t\tfor (const attributeName in vertexData) {\n\t\t\t\tconst attribute = vertexData[attributeName];\n\t\t\t\tformatDesc.push({\n\t\t\t\t\tsemantic: attributeMap[attributeName],\n\t\t\t\t\tcomponents: attribute.components,\n\t\t\t\t\ttype: JSON_VERTEX_ELEMENT_TYPE[attribute.type],\n\t\t\t\t\tnormalize: attributeMap[attributeName] === SEMANTIC_COLOR\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst vertexFormat = new VertexFormat(this._device, formatDesc);\n\t\t\tconst numVertices = vertexData.position.data.length / vertexData.position.components;\n\t\t\tconst vertexBuffer = new VertexBuffer(this._device, vertexFormat, numVertices);\n\t\t\tconst iterator = new VertexIterator(vertexBuffer);\n\t\t\tfor (let j = 0; j < numVertices; j++) {\n\t\t\t\tfor (const attributeName in vertexData) {\n\t\t\t\t\tconst attribute = vertexData[attributeName];\n\t\t\t\t\tswitch (attribute.components) {\n\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\titerator.element[attributeMap[attributeName]].set(attribute.data[j]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\titerator.element[attributeMap[attributeName]].set(attribute.data[j * 2], 1.0 - attribute.data[j * 2 + 1]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\titerator.element[attributeMap[attributeName]].set(attribute.data[j * 3], attribute.data[j * 3 + 1], attribute.data[j * 3 + 2]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t\titerator.element[attributeMap[attributeName]].set(attribute.data[j * 4], attribute.data[j * 4 + 1], attribute.data[j * 4 + 2], attribute.data[j * 4 + 3]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\titerator.next();\n\t\t\t}\n\t\t\titerator.end();\n\t\t\tvertexBuffers.push(vertexBuffer);\n\t\t}\n\t\treturn vertexBuffers;\n\t}\n\t_parseIndexBuffers(data, vertexBuffers) {\n\t\tconst modelData = data.model;\n\t\tlet indexBuffer = null;\n\t\tlet indexData = null;\n\t\tlet i;\n\t\tlet numIndices = 0;\n\t\tfor (i = 0; i < modelData.meshes.length; i++) {\n\t\t\tconst meshData = modelData.meshes[i];\n\t\t\tif (meshData.indices !== undefined) {\n\t\t\t\tnumIndices += meshData.indices.length;\n\t\t\t}\n\t\t}\n\t\tlet maxVerts = 0;\n\t\tfor (i = 0; i < vertexBuffers.length; i++) {\n\t\t\tmaxVerts = Math.max(maxVerts, vertexBuffers[i].numVertices);\n\t\t}\n\t\tif (numIndices > 0) {\n\t\t\tif (maxVerts > 0xFFFF && this._device.extUintElement) {\n\t\t\t\tindexBuffer = new IndexBuffer(this._device, INDEXFORMAT_UINT32, numIndices);\n\t\t\t\tindexData = new Uint32Array(indexBuffer.lock());\n\t\t\t} else {\n\t\t\t\tindexBuffer = new IndexBuffer(this._device, INDEXFORMAT_UINT16, numIndices);\n\t\t\t\tindexData = new Uint16Array(indexBuffer.lock());\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\tbuffer: indexBuffer,\n\t\t\tdata: indexData\n\t\t};\n\t}\n\t_parseMeshes(data, skins, morphs, vertexBuffers, indexBuffer, indexData) {\n\t\tconst modelData = data.model;\n\t\tconst meshes = [];\n\t\tlet indexBase = 0;\n\t\tfor (let i = 0; i < modelData.meshes.length; i++) {\n\t\t\tconst meshData = modelData.meshes[i];\n\t\t\tconst meshAabb = meshData.aabb;\n\t\t\tconst min = meshAabb.min;\n\t\t\tconst max = meshAabb.max;\n\t\t\tconst aabb = new BoundingBox(new Vec3((max[0] + min[0]) * 0.5, (max[1] + min[1]) * 0.5, (max[2] + min[2]) * 0.5), new Vec3((max[0] - min[0]) * 0.5, (max[1] - min[1]) * 0.5, (max[2] - min[2]) * 0.5));\n\t\t\tconst indexed = meshData.indices !== undefined;\n\t\t\tconst mesh = new Mesh(this._device);\n\t\t\tmesh.vertexBuffer = vertexBuffers[meshData.vertices];\n\t\t\tmesh.indexBuffer[0] = indexed ? indexBuffer : null;\n\t\t\tmesh.primitive[0].type = JSON_PRIMITIVE_TYPE[meshData.type];\n\t\t\tmesh.primitive[0].base = indexed ? meshData.base + indexBase : meshData.base;\n\t\t\tmesh.primitive[0].count = meshData.count;\n\t\t\tmesh.primitive[0].indexed = indexed;\n\t\t\tmesh.skin = meshData.skin !== undefined ? skins[meshData.skin] : null;\n\t\t\tmesh.morph = meshData.morph !== undefined ? morphs[meshData.morph] : null;\n\t\t\tmesh.aabb = aabb;\n\t\t\tif (indexed) {\n\t\t\t\tindexData.set(meshData.indices, indexBase);\n\t\t\t\tindexBase += meshData.indices.length;\n\t\t\t}\n\t\t\tmeshes.push(mesh);\n\t\t}\n\t\tif (indexBuffer !== null) {\n\t\t\tindexBuffer.unlock();\n\t\t}\n\t\treturn meshes;\n\t}\n\t_parseMeshInstances(data, nodes, meshes, skins, skinInstances, morphs, morphInstances) {\n\t\tconst modelData = data.model;\n\t\tconst meshInstances = [];\n\t\tlet i;\n\t\tfor (i = 0; i < modelData.meshInstances.length; i++) {\n\t\t\tconst meshInstanceData = modelData.meshInstances[i];\n\t\t\tconst node = nodes[meshInstanceData.node];\n\t\t\tconst mesh = meshes[meshInstanceData.mesh];\n\t\t\tconst meshInstance = new MeshInstance(mesh, this._defaultMaterial, node);\n\t\t\tif (mesh.skin) {\n\t\t\t\tconst skinIndex = skins.indexOf(mesh.skin);\n\t\t\t\tmeshInstance.skinInstance = skinInstances[skinIndex];\n\t\t\t}\n\t\t\tif (mesh.morph) {\n\t\t\t\tconst morphIndex = morphs.indexOf(mesh.morph);\n\t\t\t\tmeshInstance.morphInstance = morphInstances[morphIndex];\n\t\t\t}\n\t\t\tmeshInstances.push(meshInstance);\n\t\t}\n\t\treturn meshInstances;\n\t}\n}\n\nexport { JsonModelParser };\n","import { path } from '../../core/path.js';\nimport { Http, http } from '../../platform/net/http.js';\nimport { getDefaultMaterial } from '../../scene/materials/default-material.js';\nimport { GlbModelParser } from '../parsers/glb-model.js';\nimport { JsonModelParser } from '../parsers/json-model.js';\n\nclass ModelHandler {\n\tconstructor(app) {\n\t\tthis.handlerType = \"model\";\n\t\tthis._parsers = [];\n\t\tthis.device = app.graphicsDevice;\n\t\tthis.assets = app.assets;\n\t\tthis.defaultMaterial = getDefaultMaterial(this.device);\n\t\tthis.maxRetries = 0;\n\t\tthis.addParser(new JsonModelParser(this), function (url, data) {\n\t\t\treturn path.getExtension(url) === '.json';\n\t\t});\n\t\tthis.addParser(new GlbModelParser(this), function (url, data) {\n\t\t\treturn path.getExtension(url) === '.glb';\n\t\t});\n\t}\n\tload(url, callback, asset) {\n\t\tif (typeof url === 'string') {\n\t\t\turl = {\n\t\t\t\tload: url,\n\t\t\t\toriginal: url\n\t\t\t};\n\t\t}\n\t\tconst options = {\n\t\t\tretry: this.maxRetries > 0,\n\t\t\tmaxRetries: this.maxRetries\n\t\t};\n\t\tif (url.load.startsWith('blob:') || url.load.startsWith('data:')) {\n\t\t\tif (path.getExtension(url.original).toLowerCase() === '.glb') {\n\t\t\t\toptions.responseType = Http.ResponseType.ARRAY_BUFFER;\n\t\t\t} else {\n\t\t\t\toptions.responseType = Http.ResponseType.JSON;\n\t\t\t}\n\t\t}\n\t\thttp.get(url.load, options, (err, response) => {\n\t\t\tif (!callback) return;\n\t\t\tif (!err) {\n\t\t\t\tfor (let i = 0; i < this._parsers.length; i++) {\n\t\t\t\t\tconst p = this._parsers[i];\n\t\t\t\t\tif (p.decider(url.original, response)) {\n\t\t\t\t\t\tp.parser.parse(response, (err, parseResult) => {\n\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\tcallback(err);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcallback(null, parseResult);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, asset);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcallback(\"No parsers found\");\n\t\t\t} else {\n\t\t\t\tcallback(`Error loading model: ${url.original} [${err}]`);\n\t\t\t}\n\t\t});\n\t}\n\topen(url, data) {\n\t\treturn data;\n\t}\n\tpatch(asset, assets) {\n\t\tif (!asset.resource) return;\n\t\tconst data = asset.data;\n\t\tconst self = this;\n\t\tasset.resource.meshInstances.forEach(function (meshInstance, i) {\n\t\t\tif (data.mapping) {\n\t\t\t\tconst handleMaterial = function handleMaterial(asset) {\n\t\t\t\t\tif (asset.resource) {\n\t\t\t\t\t\tmeshInstance.material = asset.resource;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tasset.once('load', handleMaterial);\n\t\t\t\t\t\tassets.load(asset);\n\t\t\t\t\t}\n\t\t\t\t\tasset.once('remove', function (asset) {\n\t\t\t\t\t\tif (meshInstance.material === asset.resource) {\n\t\t\t\t\t\t\tmeshInstance.material = self.defaultMaterial;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t\tif (!data.mapping[i]) {\n\t\t\t\t\tmeshInstance.material = self.defaultMaterial;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst id = data.mapping[i].material;\n\t\t\t\tconst url = data.mapping[i].path;\n\t\t\t\tlet material;\n\t\t\t\tif (id !== undefined) {\n\t\t\t\t\tif (!id) {\n\t\t\t\t\t\tmeshInstance.material = self.defaultMaterial;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmaterial = assets.get(id);\n\t\t\t\t\t\tif (material) {\n\t\t\t\t\t\t\thandleMaterial(material);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tassets.once('add:' + id, handleMaterial);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (url) {\n\t\t\t\t\tconst path = asset.getAbsoluteUrl(data.mapping[i].path);\n\t\t\t\t\tmaterial = assets.getByUrl(path);\n\t\t\t\t\tif (material) {\n\t\t\t\t\t\thandleMaterial(material);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tassets.once('add:url:' + path, handleMaterial);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\taddParser(parser, decider) {\n\t\tthis._parsers.push({\n\t\t\tparser: parser,\n\t\t\tdecider: decider\n\t\t});\n\t}\n}\n\nexport { ModelHandler };\n","import { SceneUtils } from './scene-utils.js';\nimport { SceneParser } from '../parsers/scene.js';\n\nclass SceneHandler {\n\tconstructor(app) {\n\t\tthis.handlerType = \"scene\";\n\t\tthis._app = app;\n\t\tthis.maxRetries = 0;\n\t}\n\tload(url, callback) {\n\t\tSceneUtils.load(url, this.maxRetries, callback);\n\t}\n\topen(url, data) {\n\t\tthis._app.systems.script.preloading = true;\n\t\tconst parser = new SceneParser(this._app, false);\n\t\tconst parent = parser.parse(data);\n\t\tconst scene = this._app.scene;\n\t\tscene.root = parent;\n\t\tthis._app.applySceneSettings(data.settings);\n\t\tthis._app.systems.script.preloading = false;\n\t\treturn scene;\n\t}\n\tpatch(asset, assets) {}\n}\n\nexport { SceneHandler };\n","import { script } from '../script.js';\nimport { ScriptTypes } from '../script/script-types.js';\nimport { ResourceLoader } from './loader.js';\n\nclass ScriptHandler {\n\tconstructor(app) {\n\t\tthis.handlerType = \"script\";\n\t\tthis._app = app;\n\t\tthis._scripts = {};\n\t\tthis._cache = {};\n\t}\n\tclearCache() {\n\t\tfor (const key in this._cache) {\n\t\t\tconst element = this._cache[key];\n\t\t\tconst parent = element.parentNode;\n\t\t\tif (parent) parent.removeChild(element);\n\t\t}\n\t\tthis._cache = {};\n\t}\n\tload(url, callback) {\n\t\tif (typeof url === 'string') {\n\t\t\turl = {\n\t\t\t\tload: url,\n\t\t\t\toriginal: url\n\t\t\t};\n\t\t}\n\t\tconst self = this;\n\t\tscript.app = this._app;\n\t\tthis._loadScript(url.load, (err, url, extra) => {\n\t\t\tif (!err) {\n\t\t\t\tif (script.legacy) {\n\t\t\t\t\tlet Type = null;\n\t\t\t\t\tif (ScriptTypes._types.length) {\n\t\t\t\t\t\tType = ScriptTypes._types.pop();\n\t\t\t\t\t}\n\t\t\t\t\tif (Type) {\n\t\t\t\t\t\tthis._scripts[url] = Type;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tType = null;\n\t\t\t\t\t}\n\t\t\t\t\tcallback(null, Type, extra);\n\t\t\t\t} else {\n\t\t\t\t\tconst obj = {};\n\t\t\t\t\tfor (let i = 0; i < ScriptTypes._types.length; i++) obj[ScriptTypes._types[i].name] = ScriptTypes._types[i];\n\t\t\t\t\tScriptTypes._types.length = 0;\n\t\t\t\t\tcallback(null, obj, extra);\n\t\t\t\t\tdelete self._loader._cache[ResourceLoader.makeKey(url, 'script')];\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tcallback(err);\n\t\t\t}\n\t\t});\n\t}\n\topen(url, data) {\n\t\treturn data;\n\t}\n\tpatch(asset, assets) {}\n\t_loadScript(url, callback) {\n\t\tconst head = document.head;\n\t\tconst element = document.createElement('script');\n\t\tthis._cache[url] = element;\n\t\telement.async = false;\n\t\telement.addEventListener('error', function (e) {\n\t\t\tcallback(`Script: ${e.target.src} failed to load`);\n\t\t}, false);\n\t\tlet done = false;\n\t\telement.onload = element.onreadystatechange = function () {\n\t\t\tif (!done && (!this.readyState || this.readyState === 'loaded' || this.readyState === 'complete')) {\n\t\t\t\tdone = true;\n\t\t\t\tcallback(null, url, element);\n\t\t\t}\n\t\t};\n\t\telement.src = url;\n\t\thead.appendChild(element);\n\t}\n}\n\nexport { ScriptHandler };\n","import { http } from '../../platform/net/http.js';\n\nclass ShaderHandler {\n\tconstructor(app) {\n\t\tthis.handlerType = \"shader\";\n\t\tthis.maxRetries = 0;\n\t}\n\tload(url, callback) {\n\t\tif (typeof url === 'string') {\n\t\t\turl = {\n\t\t\t\tload: url,\n\t\t\t\toriginal: url\n\t\t\t};\n\t\t}\n\t\thttp.get(url.load, {\n\t\t\tretry: this.maxRetries > 0,\n\t\t\tmaxRetries: this.maxRetries\n\t\t}, function (err, response) {\n\t\t\tif (!err) {\n\t\t\t\tcallback(null, response);\n\t\t\t} else {\n\t\t\t\tcallback(`Error loading shader resource: ${url.original} [${err}]`);\n\t\t\t}\n\t\t});\n\t}\n\topen(url, data) {\n\t\treturn data;\n\t}\n\tpatch(asset, assets) {}\n}\n\nexport { ShaderHandler };\n","import { path } from '../../core/path.js';\nimport { http } from '../../platform/net/http.js';\nimport { Sprite } from '../../scene/sprite.js';\n\nfunction onTextureAtlasLoaded(atlasAsset) {\n\tconst spriteAsset = this;\n\tif (spriteAsset.resource) {\n\t\tspriteAsset.resource.atlas = atlasAsset.resource;\n\t}\n}\nfunction onTextureAtlasAdded(atlasAsset) {\n\tconst spriteAsset = this;\n\tspriteAsset.registry.load(atlasAsset);\n}\nclass SpriteHandler {\n\tconstructor(app) {\n\t\tthis.handlerType = \"sprite\";\n\t\tthis._assets = app.assets;\n\t\tthis._device = app.graphicsDevice;\n\t\tthis.maxRetries = 0;\n\t}\n\tload(url, callback) {\n\t\tif (typeof url === 'string') {\n\t\t\turl = {\n\t\t\t\tload: url,\n\t\t\t\toriginal: url\n\t\t\t};\n\t\t}\n\t\tif (path.getExtension(url.original) === '.json') {\n\t\t\thttp.get(url.load, {\n\t\t\t\tretry: this.maxRetries > 0,\n\t\t\t\tmaxRetries: this.maxRetries\n\t\t\t}, function (err, response) {\n\t\t\t\tif (!err) {\n\t\t\t\t\tcallback(null, response);\n\t\t\t\t} else {\n\t\t\t\t\tcallback(err);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\topen(url, data) {\n\t\tconst sprite = new Sprite(this._device);\n\t\tif (url) {\n\t\t\tsprite.__data = data;\n\t\t}\n\t\treturn sprite;\n\t}\n\tpatch(asset, assets) {\n\t\tconst sprite = asset.resource;\n\t\tif (sprite.__data) {\n\t\t\tasset.data.pixelsPerUnit = sprite.__data.pixelsPerUnit;\n\t\t\tasset.data.renderMode = sprite.__data.renderMode;\n\t\t\tasset.data.frameKeys = sprite.__data.frameKeys;\n\t\t\tif (sprite.__data.textureAtlasAsset) {\n\t\t\t\tconst atlas = assets.getByUrl(sprite.__data.textureAtlasAsset);\n\t\t\t\tif (atlas) {\n\t\t\t\t\tasset.data.textureAtlasAsset = atlas.id;\n\t\t\t\t} else {\n\t\t\t\t\tconsole.warn('Could not find textureatlas with url: ' + sprite.__data.textureAtlasAsset);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tsprite.startUpdate();\n\t\tsprite.renderMode = asset.data.renderMode;\n\t\tsprite.pixelsPerUnit = asset.data.pixelsPerUnit;\n\t\tsprite.frameKeys = asset.data.frameKeys;\n\t\tthis._updateAtlas(asset);\n\t\tsprite.endUpdate();\n\t\tasset.off('change', this._onAssetChange, this);\n\t\tasset.on('change', this._onAssetChange, this);\n\t}\n\t_updateAtlas(asset) {\n\t\tconst sprite = asset.resource;\n\t\tif (!asset.data.textureAtlasAsset) {\n\t\t\tsprite.atlas = null;\n\t\t\treturn;\n\t\t}\n\t\tthis._assets.off('load:' + asset.data.textureAtlasAsset, onTextureAtlasLoaded, asset);\n\t\tthis._assets.on('load:' + asset.data.textureAtlasAsset, onTextureAtlasLoaded, asset);\n\t\tconst atlasAsset = this._assets.get(asset.data.textureAtlasAsset);\n\t\tif (atlasAsset && atlasAsset.resource) {\n\t\t\tsprite.atlas = atlasAsset.resource;\n\t\t} else {\n\t\t\tif (!atlasAsset) {\n\t\t\t\tthis._assets.off('add:' + asset.data.textureAtlasAsset, onTextureAtlasAdded, asset);\n\t\t\t\tthis._assets.on('add:' + asset.data.textureAtlasAsset, onTextureAtlasAdded, asset);\n\t\t\t} else {\n\t\t\t\tthis._assets.load(atlasAsset);\n\t\t\t}\n\t\t}\n\t}\n\t_onAssetChange(asset, attribute, value, oldValue) {\n\t\tif (attribute === 'data') {\n\t\t\tif (value && value.textureAtlasAsset && oldValue && value.textureAtlasAsset !== oldValue.textureAtlasAsset) {\n\t\t\t\tthis._assets.off('load:' + oldValue.textureAtlasAsset, onTextureAtlasLoaded, asset);\n\t\t\t\tthis._assets.off('add:' + oldValue.textureAtlasAsset, onTextureAtlasAdded, asset);\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport { SpriteHandler };\n","import { SceneParser } from './parsers/scene.js';\n\nclass Template {\n\tconstructor(app, data) {\n\t\tthis._app = void 0;\n\t\tthis._data = void 0;\n\t\tthis._templateRoot = null;\n\t\tthis._app = app;\n\t\tthis._data = data;\n\t}\n\tinstantiate() {\n\t\tif (!this._templateRoot) {\n\t\t\tthis._parseTemplate();\n\t\t}\n\t\treturn this._templateRoot.clone();\n\t}\n\t_parseTemplate() {\n\t\tconst parser = new SceneParser(this._app, true);\n\t\tthis._templateRoot = parser.parse(this._data);\n\t}\n}\n\nexport { Template };\n","import { http } from '../../platform/net/http.js';\nimport { Template } from '../template.js';\n\nclass TemplateHandler {\n\tconstructor(app) {\n\t\tthis.handlerType = \"template\";\n\t\tthis._app = app;\n\t\tthis.maxRetries = 0;\n\t}\n\tload(url, callback) {\n\t\tif (typeof url === 'string') {\n\t\t\turl = {\n\t\t\t\tload: url,\n\t\t\t\toriginal: url\n\t\t\t};\n\t\t}\n\t\tconst options = {\n\t\t\tretry: this.maxRetries > 0,\n\t\t\tmaxRetries: this.maxRetries\n\t\t};\n\t\thttp.get(url.load, options, function (err, response) {\n\t\t\tif (err) {\n\t\t\t\tcallback('Error requesting template: ' + url.original);\n\t\t\t} else {\n\t\t\t\tcallback(err, response);\n\t\t\t}\n\t\t});\n\t}\n\topen(url, data) {\n\t\treturn new Template(this._app, data);\n\t}\n}\n\nexport { TemplateHandler };\n","import { http } from '../../platform/net/http.js';\n\nclass TextHandler {\n\tconstructor(app) {\n\t\tthis.handlerType = \"text\";\n\t\tthis.maxRetries = 0;\n\t}\n\tload(url, callback) {\n\t\tif (typeof url === 'string') {\n\t\t\turl = {\n\t\t\t\tload: url,\n\t\t\t\toriginal: url\n\t\t\t};\n\t\t}\n\t\thttp.get(url.load, {\n\t\t\tretry: this.maxRetries > 0,\n\t\t\tmaxRetries: this.maxRetries\n\t\t}, function (err, response) {\n\t\t\tif (!err) {\n\t\t\t\tcallback(null, response);\n\t\t\t} else {\n\t\t\t\tcallback(`Error loading text resource: ${url.original} [${err}]`);\n\t\t\t}\n\t\t});\n\t}\n\topen(url, data) {\n\t\treturn data;\n\t}\n\tpatch(asset, assets) {}\n}\n\nexport { TextHandler };\n","import { path } from '../../core/path.js';\nimport { Vec2 } from '../../core/math/vec2.js';\nimport { Vec4 } from '../../core/math/vec4.js';\nimport { TEXTURETYPE_RGBM, TEXTURETYPE_DEFAULT, ADDRESS_REPEAT, ADDRESS_CLAMP_TO_EDGE, ADDRESS_MIRRORED_REPEAT, FILTER_NEAREST, FILTER_LINEAR, FILTER_NEAREST_MIPMAP_NEAREST, FILTER_LINEAR_MIPMAP_NEAREST, FILTER_NEAREST_MIPMAP_LINEAR, FILTER_LINEAR_MIPMAP_LINEAR } from '../../platform/graphics/constants.js';\nimport { http } from '../../platform/net/http.js';\nimport { TextureAtlas } from '../../scene/texture-atlas.js';\n\nconst JSON_ADDRESS_MODE = {\n\t'repeat': ADDRESS_REPEAT,\n\t'clamp': ADDRESS_CLAMP_TO_EDGE,\n\t'mirror': ADDRESS_MIRRORED_REPEAT\n};\nconst JSON_FILTER_MODE = {\n\t'nearest': FILTER_NEAREST,\n\t'linear': FILTER_LINEAR,\n\t'nearest_mip_nearest': FILTER_NEAREST_MIPMAP_NEAREST,\n\t'linear_mip_nearest': FILTER_LINEAR_MIPMAP_NEAREST,\n\t'nearest_mip_linear': FILTER_NEAREST_MIPMAP_LINEAR,\n\t'linear_mip_linear': FILTER_LINEAR_MIPMAP_LINEAR\n};\nconst regexFrame = /^data\\.frames\\.(\\d+)$/;\nclass TextureAtlasHandler {\n\tconstructor(app) {\n\t\tthis.handlerType = \"textureatlas\";\n\t\tthis._loader = app.loader;\n\t\tthis.maxRetries = 0;\n\t}\n\tload(url, callback) {\n\t\tif (typeof url === 'string') {\n\t\t\turl = {\n\t\t\t\tload: url,\n\t\t\t\toriginal: url\n\t\t\t};\n\t\t}\n\t\tconst self = this;\n\t\tconst handler = this._loader.getHandler('texture');\n\t\tif (path.getExtension(url.original) === '.json') {\n\t\t\thttp.get(url.load, {\n\t\t\t\tretry: this.maxRetries > 0,\n\t\t\t\tmaxRetries: this.maxRetries\n\t\t\t}, function (err, response) {\n\t\t\t\tif (!err) {\n\t\t\t\t\tconst textureUrl = url.original.replace('.json', '.png');\n\t\t\t\t\tself._loader.load(textureUrl, 'texture', function (err, texture) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\tcallback(err);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcallback(null, {\n\t\t\t\t\t\t\t\tdata: response,\n\t\t\t\t\t\t\t\ttexture: texture\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tcallback(err);\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\thandler.load(url, callback);\n\t\t}\n\t}\n\topen(url, data) {\n\t\tconst resource = new TextureAtlas();\n\t\tif (data.texture && data.data) {\n\t\t\tresource.texture = data.texture;\n\t\t\tresource.__data = data.data;\n\t\t} else {\n\t\t\tconst handler = this._loader.getHandler('texture');\n\t\t\tconst texture = handler.open(url, data);\n\t\t\tif (!texture) return null;\n\t\t\tresource.texture = texture;\n\t\t}\n\t\treturn resource;\n\t}\n\tpatch(asset, assets) {\n\t\tif (!asset.resource) {\n\t\t\treturn;\n\t\t}\n\t\tif (asset.resource.__data) {\n\t\t\tif (asset.resource.__data.minfilter !== undefined) asset.data.minfilter = asset.resource.__data.minfilter;\n\t\t\tif (asset.resource.__data.magfilter !== undefined) asset.data.magfilter = asset.resource.__data.magfilter;\n\t\t\tif (asset.resource.__data.addressu !== undefined) asset.data.addressu = asset.resource.__data.addressu;\n\t\t\tif (asset.resource.__data.addressv !== undefined) asset.data.addressv = asset.resource.__data.addressv;\n\t\t\tif (asset.resource.__data.mipmaps !== undefined) asset.data.mipmaps = asset.resource.__data.mipmaps;\n\t\t\tif (asset.resource.__data.anisotropy !== undefined) asset.data.anisotropy = asset.resource.__data.anisotropy;\n\t\t\tif (asset.resource.__data.rgbm !== undefined) asset.data.rgbm = !!asset.resource.__data.rgbm;\n\t\t\tasset.data.frames = asset.resource.__data.frames;\n\t\t\tdelete asset.resource.__data;\n\t\t}\n\t\tconst texture = asset.resource.texture;\n\t\tif (texture) {\n\t\t\ttexture.name = asset.name;\n\t\t\tif (asset.data.hasOwnProperty('minfilter') && texture.minFilter !== JSON_FILTER_MODE[asset.data.minfilter]) texture.minFilter = JSON_FILTER_MODE[asset.data.minfilter];\n\t\t\tif (asset.data.hasOwnProperty('magfilter') && texture.magFilter !== JSON_FILTER_MODE[asset.data.magfilter]) texture.magFilter = JSON_FILTER_MODE[asset.data.magfilter];\n\t\t\tif (asset.data.hasOwnProperty('addressu') && texture.addressU !== JSON_ADDRESS_MODE[asset.data.addressu]) texture.addressU = JSON_ADDRESS_MODE[asset.data.addressu];\n\t\t\tif (asset.data.hasOwnProperty('addressv') && texture.addressV !== JSON_ADDRESS_MODE[asset.data.addressv]) texture.addressV = JSON_ADDRESS_MODE[asset.data.addressv];\n\t\t\tif (asset.data.hasOwnProperty('mipmaps') && texture.mipmaps !== asset.data.mipmaps) texture.mipmaps = asset.data.mipmaps;\n\t\t\tif (asset.data.hasOwnProperty('anisotropy') && texture.anisotropy !== asset.data.anisotropy) texture.anisotropy = asset.data.anisotropy;\n\t\t\tif (asset.data.hasOwnProperty('rgbm')) {\n\t\t\t\tconst type = asset.data.rgbm ? TEXTURETYPE_RGBM : TEXTURETYPE_DEFAULT;\n\t\t\t\tif (texture.type !== type) {\n\t\t\t\t\ttexture.type = type;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tasset.resource.texture = texture;\n\t\tconst frames = {};\n\t\tfor (const key in asset.data.frames) {\n\t\t\tconst frame = asset.data.frames[key];\n\t\t\tframes[key] = {\n\t\t\t\trect: new Vec4(frame.rect),\n\t\t\t\tpivot: new Vec2(frame.pivot),\n\t\t\t\tborder: new Vec4(frame.border)\n\t\t\t};\n\t\t}\n\t\tasset.resource.frames = frames;\n\t\tasset.off('change', this._onAssetChange, this);\n\t\tasset.on('change', this._onAssetChange, this);\n\t}\n\t_onAssetChange(asset, attribute, value) {\n\t\tlet frame;\n\t\tif (attribute === 'data' || attribute === 'data.frames') {\n\t\t\tconst frames = {};\n\t\t\tfor (const key in value.frames) {\n\t\t\t\tframe = value.frames[key];\n\t\t\t\tframes[key] = {\n\t\t\t\t\trect: new Vec4(frame.rect),\n\t\t\t\t\tpivot: new Vec2(frame.pivot),\n\t\t\t\t\tborder: new Vec4(frame.border)\n\t\t\t\t};\n\t\t\t}\n\t\t\tasset.resource.frames = frames;\n\t\t} else {\n\t\t\tconst match = attribute.match(regexFrame);\n\t\t\tif (match) {\n\t\t\t\tconst frameKey = match[1];\n\t\t\t\tif (value) {\n\t\t\t\t\tif (!asset.resource.frames[frameKey]) {\n\t\t\t\t\t\tasset.resource.frames[frameKey] = {\n\t\t\t\t\t\t\trect: new Vec4(value.rect),\n\t\t\t\t\t\t\tpivot: new Vec2(value.pivot),\n\t\t\t\t\t\t\tborder: new Vec4(value.border)\n\t\t\t\t\t\t};\n\t\t\t\t\t} else {\n\t\t\t\t\t\tframe = asset.resource.frames[frameKey];\n\t\t\t\t\t\tframe.rect.set(value.rect[0], value.rect[1], value.rect[2], value.rect[3]);\n\t\t\t\t\t\tframe.pivot.set(value.pivot[0], value.pivot[1]);\n\t\t\t\t\t\tframe.border.set(value.border[0], value.border[1], value.border[2], value.border[3]);\n\t\t\t\t\t}\n\t\t\t\t\tasset.resource.fire('set:frame', frameKey, asset.resource.frames[frameKey]);\n\t\t\t\t} else {\n\t\t\t\t\tif (asset.resource.frames[frameKey]) {\n\t\t\t\t\t\tdelete asset.resource.frames[frameKey];\n\t\t\t\t\t\tasset.resource.fire('remove:frame', frameKey);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport { TextureAtlasHandler };\n","function BasisWorker() {\n\tconst BASIS_FORMAT = {\n\t\tcTFETC1: 0,\n\t\tcTFETC2: 1,\n\t\tcTFBC1: 2,\n\t\tcTFBC3: 3,\n\t\tcTFPVRTC1_4_RGB: 8,\n\t\tcTFPVRTC1_4_RGBA: 9,\n\t\tcTFASTC_4x4: 10,\n\t\tcTFATC_RGB: 11,\n\t\tcTFATC_RGBA_INTERPOLATED_ALPHA: 12,\n\t\tcTFRGBA32: 13,\n\t\tcTFRGB565: 14,\n\t\tcTFRGBA4444: 16\n\t};\n\tconst opaqueMapping = {\n\t\tastc: BASIS_FORMAT.cTFASTC_4x4,\n\t\tdxt: BASIS_FORMAT.cTFBC1,\n\t\tetc1: BASIS_FORMAT.cTFETC1,\n\t\tetc2: BASIS_FORMAT.cTFETC1,\n\t\tpvr: BASIS_FORMAT.cTFPVRTC1_4_RGB,\n\t\tatc: BASIS_FORMAT.cTFATC_RGB,\n\t\tnone: BASIS_FORMAT.cTFRGB565\n\t};\n\tconst alphaMapping = {\n\t\tastc: BASIS_FORMAT.cTFASTC_4x4,\n\t\tdxt: BASIS_FORMAT.cTFBC3,\n\t\tetc1: BASIS_FORMAT.cTFRGBA4444,\n\t\tetc2: BASIS_FORMAT.cTFETC2,\n\t\tpvr: BASIS_FORMAT.cTFPVRTC1_4_RGBA,\n\t\tatc: BASIS_FORMAT.cTFATC_RGBA_INTERPOLATED_ALPHA,\n\t\tnone: BASIS_FORMAT.cTFRGBA4444\n\t};\n\tconst PIXEL_FORMAT = {\n\t\tETC1: 21,\n\t\tETC2_RGB: 22,\n\t\tETC2_RGBA: 23,\n\t\tDXT1: 8,\n\t\tDXT5: 10,\n\t\tPVRTC_4BPP_RGB_1: 26,\n\t\tPVRTC_4BPP_RGBA_1: 27,\n\t\tASTC_4x4: 28,\n\t\tATC_RGB: 29,\n\t\tATC_RGBA: 30,\n\t\tR8_G8_B8_A8: 7,\n\t\tR5_G6_B5: 3,\n\t\tR4_G4_B4_A4: 5\n\t};\n\tconst basisToEngineMapping = (basisFormat, deviceDetails) => {\n\t\tswitch (basisFormat) {\n\t\t\tcase BASIS_FORMAT.cTFETC1:\n\t\t\t\treturn deviceDetails.formats.etc1 ? PIXEL_FORMAT.ETC1 : PIXEL_FORMAT.ETC2_RGB;\n\t\t\tcase BASIS_FORMAT.cTFETC2:\n\t\t\t\treturn PIXEL_FORMAT.ETC2_RGBA;\n\t\t\tcase BASIS_FORMAT.cTFBC1:\n\t\t\t\treturn PIXEL_FORMAT.DXT1;\n\t\t\tcase BASIS_FORMAT.cTFBC3:\n\t\t\t\treturn PIXEL_FORMAT.DXT5;\n\t\t\tcase BASIS_FORMAT.cTFPVRTC1_4_RGB:\n\t\t\t\treturn PIXEL_FORMAT.PVRTC_4BPP_RGB_1;\n\t\t\tcase BASIS_FORMAT.cTFPVRTC1_4_RGBA:\n\t\t\t\treturn PIXEL_FORMAT.PVRTC_4BPP_RGBA_1;\n\t\t\tcase BASIS_FORMAT.cTFASTC_4x4:\n\t\t\t\treturn PIXEL_FORMAT.ASTC_4x4;\n\t\t\tcase BASIS_FORMAT.cTFATC_RGB:\n\t\t\t\treturn PIXEL_FORMAT.ATC_RGB;\n\t\t\tcase BASIS_FORMAT.cTFATC_RGBA_INTERPOLATED_ALPHA:\n\t\t\t\treturn PIXEL_FORMAT.ATC_RGBA;\n\t\t\tcase BASIS_FORMAT.cTFRGBA32:\n\t\t\t\treturn PIXEL_FORMAT.R8_G8_B8_A8;\n\t\t\tcase BASIS_FORMAT.cTFRGB565:\n\t\t\t\treturn PIXEL_FORMAT.R5_G6_B5;\n\t\t\tcase BASIS_FORMAT.cTFRGBA4444:\n\t\t\t\treturn PIXEL_FORMAT.R4_G4_B4_A4;\n\t\t}\n\t};\n\tconst unswizzleGGGR = data => {\n\t\tconst genB = function genB(R, G) {\n\t\t\tconst r = R * (2.0 / 255.0) - 1.0;\n\t\t\tconst g = G * (2.0 / 255.0) - 1.0;\n\t\t\tconst b = Math.sqrt(1.0 - Math.min(1.0, r * r + g * g));\n\t\t\treturn Math.max(0, Math.min(255, Math.floor((b + 1.0) * 0.5 * 255.0)));\n\t\t};\n\t\tfor (let offset = 0; offset < data.length; offset += 4) {\n\t\t\tconst R = data[offset + 3];\n\t\t\tconst G = data[offset + 1];\n\t\t\tdata[offset + 0] = R;\n\t\t\tdata[offset + 2] = genB(R, G);\n\t\t\tdata[offset + 3] = 255;\n\t\t}\n\t\treturn data;\n\t};\n\tconst pack565 = data => {\n\t\tconst result = new Uint16Array(data.length / 4);\n\t\tfor (let offset = 0; offset < data.length; offset += 4) {\n\t\t\tconst R = data[offset + 0];\n\t\t\tconst G = data[offset + 1];\n\t\t\tconst B = data[offset + 2];\n\t\t\tresult[offset / 4] = (R & 0xf8) << 8 | (G & 0xfc) << 3 | B >> 3;\n\t\t}\n\t\treturn result;\n\t};\n\tconst isPOT = (width, height) => {\n\t\treturn (width & width - 1) === 0 && (height & height - 1) === 0;\n\t};\n\tconst performanceNow = () => {\n\t\treturn typeof performance !== 'undefined' ? performance.now() : 0;\n\t};\n\tlet basis;\n\tlet rgbPriority;\n\tlet rgbaPriority;\n\tconst chooseTargetFormat = (deviceDetails, hasAlpha, isUASTC) => {\n\t\tif (isUASTC) {\n\t\t\tif (deviceDetails.formats.astc) {\n\t\t\t\treturn 'astc';\n\t\t\t}\n\t\t} else {\n\t\t\tif (hasAlpha) {\n\t\t\t\tif (deviceDetails.formats.etc2) {\n\t\t\t\t\treturn 'etc2';\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (deviceDetails.formats.etc1 || deviceDetails.formats.etc2) {\n\t\t\t\t\treturn 'etc1';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst testInOrder = priority => {\n\t\t\tfor (let i = 0; i < priority.length; ++i) {\n\t\t\t\tconst format = priority[i];\n\t\t\t\tif (deviceDetails.formats[format]) {\n\t\t\t\t\treturn format;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn 'none';\n\t\t};\n\t\treturn testInOrder(hasAlpha ? rgbaPriority : rgbPriority);\n\t};\n\tconst dimensionsValid = (width, height, format, webgl2) => {\n\t\tswitch (format) {\n\t\t\tcase BASIS_FORMAT.cTFETC1:\n\t\t\tcase BASIS_FORMAT.cTFETC2:\n\t\t\t\treturn true;\n\t\t\tcase BASIS_FORMAT.cTFBC1:\n\t\t\tcase BASIS_FORMAT.cTFBC3:\n\t\t\t\treturn (width & 0x3) === 0 && (height & 0x3) === 0;\n\t\t\tcase BASIS_FORMAT.cTFPVRTC1_4_RGB:\n\t\t\tcase BASIS_FORMAT.cTFPVRTC1_4_RGBA:\n\t\t\t\treturn isPOT(width, height) && (width === height || webgl2);\n\t\t\tcase BASIS_FORMAT.cTFASTC_4x4:\n\t\t\t\treturn true;\n\t\t\tcase BASIS_FORMAT.cTFATC_RGB:\n\t\t\tcase BASIS_FORMAT.cTFATC_RGBA_INTERPOLATED_ALPHA:\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t};\n\tconst transcodeKTX2 = (url, data, options) => {\n\t\tif (!basis.KTX2File) {\n\t\t\tthrow new Error('Basis transcoder module does not include support for KTX2.');\n\t\t}\n\t\tconst funcStart = performanceNow();\n\t\tconst basisFile = new basis.KTX2File(new Uint8Array(data));\n\t\tconst width = basisFile.getWidth();\n\t\tconst height = basisFile.getHeight();\n\t\tconst levels = basisFile.getLevels();\n\t\tconst hasAlpha = !!basisFile.getHasAlpha();\n\t\tconst isUASTC = basisFile.isUASTC && basisFile.isUASTC();\n\t\tif (!width || !height || !levels) {\n\t\t\tbasisFile.close();\n\t\t\tbasisFile.delete();\n\t\t\tthrow new Error(`Invalid image dimensions url=${url} width=${width} height=${height} levels=${levels}`);\n\t\t}\n\t\tconst format = chooseTargetFormat(options.deviceDetails, hasAlpha, isUASTC);\n\t\tconst unswizzle = !!options.isGGGR && format === 'pvr';\n\t\tlet basisFormat;\n\t\tif (unswizzle) {\n\t\t\tbasisFormat = BASIS_FORMAT.cTFRGBA32;\n\t\t} else {\n\t\t\tbasisFormat = hasAlpha ? alphaMapping[format] : opaqueMapping[format];\n\t\t\tif (!dimensionsValid(width, height, basisFormat, options.deviceDetails.webgl2)) {\n\t\t\t\tbasisFormat = hasAlpha ? BASIS_FORMAT.cTFRGBA32 : BASIS_FORMAT.cTFRGB565;\n\t\t\t}\n\t\t}\n\t\tif (!basisFile.startTranscoding()) {\n\t\t\tbasisFile.close();\n\t\t\tbasisFile.delete();\n\t\t\tthrow new Error('Failed to start transcoding url=' + url);\n\t\t}\n\t\tlet i;\n\t\tconst levelData = [];\n\t\tfor (let mip = 0; mip < levels; ++mip) {\n\t\t\tconst dstSize = basisFile.getImageTranscodedSizeInBytes(mip, 0, 0, basisFormat);\n\t\t\tconst dst = new Uint8Array(dstSize);\n\t\t\tif (!basisFile.transcodeImage(dst, mip, 0, 0, basisFormat, 0, -1, -1)) {\n\t\t\t\tbasisFile.close();\n\t\t\t\tbasisFile.delete();\n\t\t\t\tthrow new Error('Failed to transcode image url=' + url);\n\t\t\t}\n\t\t\tconst is16BitFormat = basisFormat === BASIS_FORMAT.cTFRGB565 || basisFormat === BASIS_FORMAT.cTFRGBA4444;\n\t\t\tlevelData.push(is16BitFormat ? new Uint16Array(dst.buffer) : dst);\n\t\t}\n\t\tbasisFile.close();\n\t\tbasisFile.delete();\n\t\tif (unswizzle) {\n\t\t\tbasisFormat = BASIS_FORMAT.cTFRGB565;\n\t\t\tfor (i = 0; i < levelData.length; ++i) {\n\t\t\t\tlevelData[i] = pack565(unswizzleGGGR(levelData[i]));\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\tformat: basisToEngineMapping(basisFormat, options.deviceDetails),\n\t\t\twidth: width,\n\t\t\theight: height,\n\t\t\tlevels: levelData,\n\t\t\tcubemap: false,\n\t\t\ttranscodeTime: performanceNow() - funcStart,\n\t\t\turl: url,\n\t\t\tunswizzledGGGR: unswizzle\n\t\t};\n\t};\n\tconst transcodeBasis = (url, data, options) => {\n\t\tconst funcStart = performanceNow();\n\t\tconst basisFile = new basis.BasisFile(new Uint8Array(data));\n\t\tconst width = basisFile.getImageWidth(0, 0);\n\t\tconst height = basisFile.getImageHeight(0, 0);\n\t\tconst images = basisFile.getNumImages();\n\t\tconst levels = basisFile.getNumLevels(0);\n\t\tconst hasAlpha = !!basisFile.getHasAlpha();\n\t\tconst isUASTC = basisFile.isUASTC && basisFile.isUASTC();\n\t\tif (!width || !height || !images || !levels) {\n\t\t\tbasisFile.close();\n\t\t\tbasisFile.delete();\n\t\t\tthrow new Error(`Invalid image dimensions url=${url} width=${width} height=${height} images=${images} levels=${levels}`);\n\t\t}\n\t\tconst format = chooseTargetFormat(options.deviceDetails, hasAlpha, isUASTC);\n\t\tconst unswizzle = !!options.isGGGR && format === 'pvr';\n\t\tlet basisFormat;\n\t\tif (unswizzle) {\n\t\t\tbasisFormat = BASIS_FORMAT.cTFRGBA32;\n\t\t} else {\n\t\t\tbasisFormat = hasAlpha ? alphaMapping[format] : opaqueMapping[format];\n\t\t\tif (!dimensionsValid(width, height, basisFormat, options.deviceDetails.webgl2)) {\n\t\t\t\tbasisFormat = hasAlpha ? BASIS_FORMAT.cTFRGBA32 : BASIS_FORMAT.cTFRGB565;\n\t\t\t}\n\t\t}\n\t\tif (!basisFile.startTranscoding()) {\n\t\t\tbasisFile.close();\n\t\t\tbasisFile.delete();\n\t\t\tthrow new Error('Failed to start transcoding url=' + url);\n\t\t}\n\t\tlet i;\n\t\tconst levelData = [];\n\t\tfor (let mip = 0; mip < levels; ++mip) {\n\t\t\tconst dstSize = basisFile.getImageTranscodedSizeInBytes(0, mip, basisFormat);\n\t\t\tconst dst = new Uint8Array(dstSize);\n\t\t\tif (!basisFile.transcodeImage(dst, 0, mip, basisFormat, 0, 0)) {\n\t\t\t\tif (mip === levels - 1 && dstSize === levelData[mip - 1].buffer.byteLength) {\n\t\t\t\t\tdst.set(new Uint8Array(levelData[mip - 1].buffer));\n\t\t\t\t\tconsole.warn('Failed to transcode last mipmap level, using previous level instead url=' + url);\n\t\t\t\t} else {\n\t\t\t\t\tbasisFile.close();\n\t\t\t\t\tbasisFile.delete();\n\t\t\t\t\tthrow new Error('Failed to transcode image url=' + url);\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst is16BitFormat = basisFormat === BASIS_FORMAT.cTFRGB565 || basisFormat === BASIS_FORMAT.cTFRGBA4444;\n\t\t\tlevelData.push(is16BitFormat ? new Uint16Array(dst.buffer) : dst);\n\t\t}\n\t\tbasisFile.close();\n\t\tbasisFile.delete();\n\t\tif (unswizzle) {\n\t\t\tbasisFormat = BASIS_FORMAT.cTFRGB565;\n\t\t\tfor (i = 0; i < levelData.length; ++i) {\n\t\t\t\tlevelData[i] = pack565(unswizzleGGGR(levelData[i]));\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\tformat: basisToEngineMapping(basisFormat, options.deviceDetails),\n\t\t\twidth: width,\n\t\t\theight: height,\n\t\t\tlevels: levelData,\n\t\t\tcubemap: false,\n\t\t\ttranscodeTime: performanceNow() - funcStart,\n\t\t\turl: url,\n\t\t\tunswizzledGGGR: unswizzle\n\t\t};\n\t};\n\tconst transcode = (url, data, options) => {\n\t\treturn options.isKTX2 ? transcodeKTX2(url, data, options) : transcodeBasis(url, data, options);\n\t};\n\tconst workerTranscode = (url, data, options) => {\n\t\ttry {\n\t\t\tconst result = transcode(url, data, options);\n\t\t\tresult.levels = result.levels.map(v => v.buffer);\n\t\t\tself.postMessage({\n\t\t\t\turl: url,\n\t\t\t\tdata: result\n\t\t\t}, result.levels);\n\t\t} catch (err) {\n\t\t\tself.postMessage({\n\t\t\t\turl: url,\n\t\t\t\terr: err\n\t\t\t}, null);\n\t\t}\n\t};\n\tconst workerInit = (config, callback) => {\n\t\tconst instantiateWasmFunc = (imports, successCallback) => {\n\t\t\tWebAssembly.instantiate(config.module, imports).then(result => {\n\t\t\t\tsuccessCallback(result);\n\t\t\t}).catch(reason => {\n\t\t\t\tconsole.error('instantiate failed + ' + reason);\n\t\t\t});\n\t\t\treturn {};\n\t\t};\n\t\tself.BASIS(config.module ? {\n\t\t\tinstantiateWasm: instantiateWasmFunc\n\t\t} : null).then(instance => {\n\t\t\tinstance.initializeBasis();\n\t\t\tbasis = instance;\n\t\t\trgbPriority = config.rgbPriority;\n\t\t\trgbaPriority = config.rgbaPriority;\n\t\t\tcallback(null);\n\t\t});\n\t};\n\tconst queue = [];\n\tself.onmessage = message => {\n\t\tconst data = message.data;\n\t\tswitch (data.type) {\n\t\t\tcase 'init':\n\t\t\t\tworkerInit(data.config, () => {\n\t\t\t\t\tfor (let i = 0; i < queue.length; ++i) {\n\t\t\t\t\t\tworkerTranscode(queue[i].url, queue[i].data, queue[i].options);\n\t\t\t\t\t}\n\t\t\t\t\tqueue.length = 0;\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'transcode':\n\t\t\t\tif (basis) {\n\t\t\t\t\tworkerTranscode(data.url, data.data, data.options);\n\t\t\t\t} else {\n\t\t\t\t\tqueue.push(data);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t};\n}\n\nexport { BasisWorker };\n","import { WasmModule } from '../../core/wasm-module.js';\nimport '../../core/tracing.js';\nimport { PIXELFORMAT_RGB565, PIXELFORMAT_RGBA4 } from '../../platform/graphics/constants.js';\nimport { BasisWorker } from './basis-worker.js';\nimport { http } from '../../platform/net/http.js';\n\nconst getCompressionFormats = device => {\n\treturn {\n\t\tastc: !!device.extCompressedTextureASTC,\n\t\tatc: !!device.extCompressedTextureATC,\n\t\tdxt: !!device.extCompressedTextureS3TC,\n\t\tetc1: !!device.extCompressedTextureETC1,\n\t\tetc2: !!device.extCompressedTextureETC,\n\t\tpvr: !!device.extCompressedTexturePVRTC\n\t};\n};\nconst prepareWorkerModules = (config, callback) => {\n\tconst getWorkerBlob = basisCode => {\n\t\tconst code = ['/* basis */', basisCode, \"\", '(' + BasisWorker.toString() + ')()\\n\\n'].join('\\n');\n\t\treturn new Blob([code], {\n\t\t\ttype: 'application/javascript'\n\t\t});\n\t};\n\tconst wasmSupported = () => {\n\t\ttry {\n\t\t\tif (typeof WebAssembly === 'object' && typeof WebAssembly.instantiate === 'function') {\n\t\t\t\tconst module = new WebAssembly.Module(Uint8Array.of(0x0, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00));\n\t\t\t\tif (module instanceof WebAssembly.Module) return new WebAssembly.Instance(module) instanceof WebAssembly.Instance;\n\t\t\t}\n\t\t} catch (e) {}\n\t\treturn false;\n\t};\n\tconst sendResponse = (basisCode, module) => {\n\t\tcallback(null, {\n\t\t\tworkerUrl: URL.createObjectURL(getWorkerBlob(basisCode)),\n\t\t\tmodule: module,\n\t\t\trgbPriority: config.rgbPriority,\n\t\t\trgbaPriority: config.rgbaPriority\n\t\t});\n\t};\n\tconst options = {\n\t\tcache: true,\n\t\tresponseType: 'text',\n\t\tretry: config.maxRetries > 0,\n\t\tmaxRetries: config.maxRetries\n\t};\n\tif (config.glueUrl && config.wasmUrl && wasmSupported()) {\n\t\tlet basisCode = null;\n\t\tlet module = null;\n\t\thttp.get(config.glueUrl, options, (err, response) => {\n\t\t\tif (err) {\n\t\t\t\tcallback(err);\n\t\t\t} else {\n\t\t\t\tif (module) {\n\t\t\t\t\tsendResponse(response, module);\n\t\t\t\t} else {\n\t\t\t\t\tbasisCode = response;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tconst fetchPromise = fetch(config.wasmUrl);\n\t\tconst compileManual = () => {\n\t\t\tfetchPromise.then(result => result.arrayBuffer()).then(buffer => WebAssembly.compile(buffer)).then(module_ => {\n\t\t\t\tif (basisCode) {\n\t\t\t\t\tsendResponse(basisCode, module_);\n\t\t\t\t} else {\n\t\t\t\t\tmodule = module_;\n\t\t\t\t}\n\t\t\t}).catch(err => {\n\t\t\t\tcallback(err, null);\n\t\t\t});\n\t\t};\n\t\tif (WebAssembly.compileStreaming) {\n\t\t\tWebAssembly.compileStreaming(fetchPromise).then(module_ => {\n\t\t\t\tif (basisCode) {\n\t\t\t\t\tsendResponse(basisCode, module_);\n\t\t\t\t} else {\n\t\t\t\t\tmodule = module_;\n\t\t\t\t}\n\t\t\t}).catch(err => {\n\t\t\t\tcompileManual();\n\t\t\t});\n\t\t} else {\n\t\t\tcompileManual();\n\t\t}\n\t} else {\n\t\thttp.get(config.fallbackUrl, options, (err, response) => {\n\t\t\tif (err) {\n\t\t\t\tcallback(err, null);\n\t\t\t} else {\n\t\t\t\tsendResponse(response, null);\n\t\t\t}\n\t\t});\n\t}\n};\nclass BasisQueue {\n\tconstructor() {\n\t\tthis.callbacks = {};\n\t\tthis.queue = [];\n\t\tthis.clients = [];\n\t}\n\tenqueueJob(url, data, callback, options) {\n\t\tif (this.callbacks.hasOwnProperty(url)) {\n\t\t\tthis.callbacks[url].push(callback);\n\t\t} else {\n\t\t\tthis.callbacks[url] = [callback];\n\t\t\tconst job = {\n\t\t\t\turl: url,\n\t\t\t\tdata: data,\n\t\t\t\toptions: options\n\t\t\t};\n\t\t\tif (this.clients.length > 0) {\n\t\t\t\tthis.clients.shift().run(job);\n\t\t\t} else {\n\t\t\t\tthis.queue.push(job);\n\t\t\t}\n\t\t}\n\t}\n\tenqueueClient(client) {\n\t\tif (this.queue.length > 0) {\n\t\t\tclient.run(this.queue.shift());\n\t\t} else {\n\t\t\tthis.clients.push(client);\n\t\t}\n\t}\n\thandleResponse(url, err, data) {\n\t\tconst callback = this.callbacks[url];\n\t\tif (err) {\n\t\t\tfor (let i = 0; i < callback.length; ++i) {\n\t\t\t\tcallback[i](err);\n\t\t\t}\n\t\t} else {\n\t\t\tif (data.format === PIXELFORMAT_RGB565 || data.format === PIXELFORMAT_RGBA4) {\n\t\t\t\tdata.levels = data.levels.map(function (v) {\n\t\t\t\t\treturn new Uint16Array(v);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tdata.levels = data.levels.map(function (v) {\n\t\t\t\t\treturn new Uint8Array(v);\n\t\t\t\t});\n\t\t\t}\n\t\t\tfor (let i = 0; i < callback.length; ++i) {\n\t\t\t\tcallback[i](null, data);\n\t\t\t}\n\t\t}\n\t\tdelete this.callbacks[url];\n\t}\n}\nclass BasisClient {\n\tconstructor(queue, config, eager) {\n\t\tthis.queue = queue;\n\t\tthis.worker = new Worker(config.workerUrl);\n\t\tthis.worker.addEventListener('message', message => {\n\t\t\tconst data = message.data;\n\t\t\tthis.queue.handleResponse(data.url, data.err, data.data);\n\t\t\tif (!this.eager) {\n\t\t\t\tthis.queue.enqueueClient(this);\n\t\t\t}\n\t\t});\n\t\tthis.worker.postMessage({\n\t\t\ttype: 'init',\n\t\t\tconfig: config\n\t\t});\n\t\tthis.eager = eager;\n\t}\n\trun(job) {\n\t\tconst transfer = [];\n\t\tif (job.data instanceof ArrayBuffer) {\n\t\t\ttransfer.push(job.data);\n\t\t}\n\t\tthis.worker.postMessage({\n\t\t\ttype: 'transcode',\n\t\t\turl: job.url,\n\t\t\tformat: job.format,\n\t\t\tdata: job.data,\n\t\t\toptions: job.options\n\t\t}, transfer);\n\t\tif (this.eager) {\n\t\t\tthis.queue.enqueueClient(this);\n\t\t}\n\t}\n}\nconst defaultNumWorkers = 1;\nconst defaultRgbPriority = ['etc1', 'etc2', 'astc', 'dxt', 'pvr', 'atc'];\nconst defaultRgbaPriority = ['astc', 'dxt', 'etc2', 'pvr', 'atc'];\nconst defaultMaxRetries = 5;\nconst queue = new BasisQueue();\nlet lazyConfig = null;\nlet initializing = false;\nfunction basisInitialize(config) {\n\tif (initializing) {\n\t\treturn;\n\t}\n\tif (!config) {\n\t\tconfig = lazyConfig || {};\n\t} else if (config.lazyInit) {\n\t\tlazyConfig = config;\n\t\treturn;\n\t}\n\tif (!config.glueUrl || !config.wasmUrl || !config.fallbackUrl) {\n\t\tconst moduleConfig = WasmModule.getConfig('BASIS');\n\t\tif (moduleConfig) {\n\t\t\tconfig = {\n\t\t\t\tglueUrl: moduleConfig.glueUrl,\n\t\t\t\twasmUrl: moduleConfig.wasmUrl,\n\t\t\t\tfallbackUrl: moduleConfig.fallbackUrl,\n\t\t\t\tnumWorkers: moduleConfig.numWorkers\n\t\t\t};\n\t\t}\n\t}\n\tif (config.glueUrl || config.wasmUrl || config.fallbackUrl) {\n\t\tinitializing = true;\n\t\tconst numWorkers = Math.max(1, Math.min(16, config.numWorkers || defaultNumWorkers));\n\t\tconst eagerWorkers = config.numWorkers === 1 || (config.hasOwnProperty('eagerWorkers') ? config.eagerWorkers : true);\n\t\tconfig.rgbPriority = config.rgbPriority || defaultRgbPriority;\n\t\tconfig.rgbaPriority = config.rgbaPriority || defaultRgbaPriority;\n\t\tconfig.maxRetries = config.hasOwnProperty('maxRetries') ? config.maxRetries : defaultMaxRetries;\n\t\tprepareWorkerModules(config, (err, clientConfig) => {\n\t\t\tif (err) {\n\t\t\t\tconsole.error(`failed to initialize basis worker: ${err}`);\n\t\t\t} else {\n\t\t\t\tfor (let i = 0; i < numWorkers; ++i) {\n\t\t\t\t\tqueue.enqueueClient(new BasisClient(queue, clientConfig, eagerWorkers));\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\nlet deviceDetails = null;\nfunction basisTranscode(device, url, data, callback, options) {\n\tbasisInitialize();\n\tif (!deviceDetails) {\n\t\tdeviceDetails = {\n\t\t\twebgl2: device.isWebGL2,\n\t\t\tformats: getCompressionFormats(device)\n\t\t};\n\t}\n\tqueue.enqueueJob(url, data, callback, {\n\t\tdeviceDetails: deviceDetails,\n\t\tisGGGR: !!(options != null && options.isGGGR),\n\t\tisKTX2: !!(options != null && options.isKTX2)\n\t});\n\treturn initializing;\n}\n\nexport { basisInitialize, basisTranscode };\n","import { extends as _extends } from '../../../_virtual/_rollupPluginBabelHelpers.js';\nimport { ADDRESS_CLAMP_TO_EDGE, ADDRESS_REPEAT } from '../../../platform/graphics/constants.js';\nimport { Texture } from '../../../platform/graphics/texture.js';\nimport { Asset } from '../../asset/asset.js';\nimport { basisTranscode } from '../../handlers/basis.js';\n\nclass BasisParser {\n\tconstructor(registry, device) {\n\t\tthis.device = device;\n\t\tthis.maxRetries = 0;\n\t}\n\tload(url, callback, asset) {\n\t\tconst device = this.device;\n\t\tconst transcode = data => {\n\t\t\tvar _asset$file;\n\t\t\tconst basisModuleFound = basisTranscode(device, url.load, data, callback, {\n\t\t\t\tisGGGR: ((asset == null || (_asset$file = asset.file) == null || (_asset$file = _asset$file.variants) == null || (_asset$file = _asset$file.basis) == null ? void 0 : _asset$file.opt) & 8) !== 0\n\t\t\t});\n\t\t\tif (!basisModuleFound) {\n\t\t\t\tcallback(`Basis module not found. Asset '${asset.name}' basis texture variant will not be loaded.`);\n\t\t\t}\n\t\t};\n\t\tAsset.fetchArrayBuffer(url.load, (err, result) => {\n\t\t\tif (err) {\n\t\t\t\tcallback(err);\n\t\t\t} else {\n\t\t\t\ttranscode(result);\n\t\t\t}\n\t\t}, asset, this.maxRetries);\n\t}\n\topen(url, data, device, textureOptions = {}) {\n\t\tconst texture = new Texture(device, _extends({\n\t\t\tname: url,\n\t\t\taddressU: data.cubemap ? ADDRESS_CLAMP_TO_EDGE : ADDRESS_REPEAT,\n\t\t\taddressV: data.cubemap ? ADDRESS_CLAMP_TO_EDGE : ADDRESS_REPEAT,\n\t\t\twidth: data.width,\n\t\t\theight: data.height,\n\t\t\tformat: data.format,\n\t\t\tcubemap: data.cubemap,\n\t\t\tlevels: data.levels\n\t\t}, textureOptions));\n\t\ttexture.upload();\n\t\treturn texture;\n\t}\n}\n\nexport { BasisParser };\n","import { extends as _extends } from '../../../_virtual/_rollupPluginBabelHelpers.js';\nimport { PIXELFORMAT_RGBA8 } from '../../../platform/graphics/constants.js';\nimport { Texture } from '../../../platform/graphics/texture.js';\nimport { http } from '../../../platform/net/http.js';\nimport { ABSOLUTE_URL } from '../../asset/constants.js';\n\nclass ImgParser {\n\tconstructor(registry, device) {\n\t\tthis.crossOrigin = registry.prefix ? 'anonymous' : null;\n\t\tthis.maxRetries = 0;\n\t\tthis.device = device;\n\t}\n\tload(url, callback, asset) {\n\t\tvar _asset$file;\n\t\tconst hasContents = !!(asset != null && (_asset$file = asset.file) != null && _asset$file.contents);\n\t\tif (hasContents) {\n\t\t\tif (this.device.supportsImageBitmap) {\n\t\t\t\tthis._loadImageBitmapFromBlob(new Blob([asset.file.contents]), callback);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\turl = {\n\t\t\t\tload: URL.createObjectURL(new Blob([asset.file.contents])),\n\t\t\t\toriginal: url.original\n\t\t\t};\n\t\t}\n\t\tconst handler = (err, result) => {\n\t\t\tif (hasContents) {\n\t\t\t\tURL.revokeObjectURL(url.load);\n\t\t\t}\n\t\t\tcallback(err, result);\n\t\t};\n\t\tlet crossOrigin;\n\t\tif (asset && asset.options && asset.options.hasOwnProperty('crossOrigin')) {\n\t\t\tcrossOrigin = asset.options.crossOrigin;\n\t\t} else if (ABSOLUTE_URL.test(url.load)) {\n\t\t\tcrossOrigin = this.crossOrigin;\n\t\t}\n\t\tif (this.device.supportsImageBitmap) {\n\t\t\tthis._loadImageBitmap(url.load, url.original, crossOrigin, handler);\n\t\t} else {\n\t\t\tthis._loadImage(url.load, url.original, crossOrigin, handler);\n\t\t}\n\t}\n\topen(url, data, device, textureOptions = {}) {\n\t\tconst texture = new Texture(device, _extends({\n\t\t\tname: url,\n\t\t\twidth: data.width,\n\t\t\theight: data.height,\n\t\t\tformat: PIXELFORMAT_RGBA8\n\t\t}, textureOptions));\n\t\ttexture.setSource(data);\n\t\treturn texture;\n\t}\n\t_loadImage(url, originalUrl, crossOrigin, callback) {\n\t\tconst image = new Image();\n\t\tif (crossOrigin) {\n\t\t\timage.crossOrigin = crossOrigin;\n\t\t}\n\t\tlet retries = 0;\n\t\tconst maxRetries = this.maxRetries;\n\t\tlet retryTimeout;\n\t\timage.onload = function () {\n\t\t\tcallback(null, image);\n\t\t};\n\t\timage.onerror = function () {\n\t\t\tif (retryTimeout) return;\n\t\t\tif (maxRetries > 0 && ++retries <= maxRetries) {\n\t\t\t\tconst retryDelay = Math.pow(2, retries) * 100;\n\t\t\t\tconsole.log(`Error loading Texture from: '${originalUrl}' - Retrying in ${retryDelay}ms...`);\n\t\t\t\tconst idx = url.indexOf('?');\n\t\t\t\tconst separator = idx >= 0 ? '&' : '?';\n\t\t\t\tretryTimeout = setTimeout(function () {\n\t\t\t\t\timage.src = url + separator + 'retry=' + Date.now();\n\t\t\t\t\tretryTimeout = null;\n\t\t\t\t}, retryDelay);\n\t\t\t} else {\n\t\t\t\tcallback(`Error loading Texture from: '${originalUrl}'`);\n\t\t\t}\n\t\t};\n\t\timage.src = url;\n\t}\n\t_loadImageBitmap(url, originalUrl, crossOrigin, callback) {\n\t\tconst options = {\n\t\t\tcache: true,\n\t\t\tresponseType: 'blob',\n\t\t\tretry: this.maxRetries > 0,\n\t\t\tmaxRetries: this.maxRetries\n\t\t};\n\t\thttp.get(url, options, (err, blob) => {\n\t\t\tif (err) {\n\t\t\t\tcallback(err);\n\t\t\t} else {\n\t\t\t\tthis._loadImageBitmapFromBlob(blob, callback);\n\t\t\t}\n\t\t});\n\t}\n\t_loadImageBitmapFromBlob(blob, callback) {\n\t\tcreateImageBitmap(blob, {\n\t\t\tpremultiplyAlpha: 'none',\n\t\t\tcolorSpaceConversion: 'none'\n\t\t}).then(imageBitmap => callback(null, imageBitmap)).catch(e => callback(e));\n\t}\n}\n\nexport { ImgParser };\n","import { extends as _extends } from '../../../_virtual/_rollupPluginBabelHelpers.js';\nimport '../../../core/tracing.js';\nimport { ADDRESS_CLAMP_TO_EDGE, ADDRESS_REPEAT, PIXELFORMAT_DXT1, PIXELFORMAT_DXT3, PIXELFORMAT_DXT5, PIXELFORMAT_ETC1, PIXELFORMAT_ETC2_RGB, PIXELFORMAT_ETC2_RGBA, PIXELFORMAT_PVRTC_4BPP_RGB_1, PIXELFORMAT_PVRTC_2BPP_RGB_1, PIXELFORMAT_PVRTC_4BPP_RGBA_1, PIXELFORMAT_PVRTC_2BPP_RGBA_1, PIXELFORMAT_RGB8, PIXELFORMAT_RGBA8, PIXELFORMAT_SRGB, PIXELFORMAT_SRGBA, PIXELFORMAT_111110F, PIXELFORMAT_RGB16F, PIXELFORMAT_RGBA16F } from '../../../platform/graphics/constants.js';\nimport { Texture } from '../../../platform/graphics/texture.js';\nimport { Asset } from '../../asset/asset.js';\n\nconst IDENTIFIER = [0x58544BAB, 0xBB313120, 0x0A1A0A0D];\nconst KNOWN_FORMATS = {\n\t0x83F0: PIXELFORMAT_DXT1,\n\t0x83F2: PIXELFORMAT_DXT3,\n\t0x83F3: PIXELFORMAT_DXT5,\n\t0x8D64: PIXELFORMAT_ETC1,\n\t0x9274: PIXELFORMAT_ETC2_RGB,\n\t0x9278: PIXELFORMAT_ETC2_RGBA,\n\t0x8C00: PIXELFORMAT_PVRTC_4BPP_RGB_1,\n\t0x8C01: PIXELFORMAT_PVRTC_2BPP_RGB_1,\n\t0x8C02: PIXELFORMAT_PVRTC_4BPP_RGBA_1,\n\t0x8C03: PIXELFORMAT_PVRTC_2BPP_RGBA_1,\n\t0x8051: PIXELFORMAT_RGB8,\n\t0x8058: PIXELFORMAT_RGBA8,\n\t0x8C41: PIXELFORMAT_SRGB,\n\t0x8C43: PIXELFORMAT_SRGBA,\n\t0x8C3A: PIXELFORMAT_111110F,\n\t0x881B: PIXELFORMAT_RGB16F,\n\t0x881A: PIXELFORMAT_RGBA16F\n};\nfunction createContainer(pixelFormat, buffer, byteOffset, byteSize) {\n\treturn pixelFormat === PIXELFORMAT_111110F ? new Uint32Array(buffer, byteOffset, byteSize / 4) : new Uint8Array(buffer, byteOffset, byteSize);\n}\nclass KtxParser {\n\tconstructor(registry) {\n\t\tthis.maxRetries = 0;\n\t}\n\tload(url, callback, asset) {\n\t\tAsset.fetchArrayBuffer(url.load, callback, asset, this.maxRetries);\n\t}\n\topen(url, data, device, textureOptions = {}) {\n\t\tconst textureData = this.parse(data);\n\t\tif (!textureData) {\n\t\t\treturn null;\n\t\t}\n\t\tconst texture = new Texture(device, _extends({\n\t\t\tname: url,\n\t\t\taddressU: textureData.cubemap ? ADDRESS_CLAMP_TO_EDGE : ADDRESS_REPEAT,\n\t\t\taddressV: textureData.cubemap ? ADDRESS_CLAMP_TO_EDGE : ADDRESS_REPEAT,\n\t\t\twidth: textureData.width,\n\t\t\theight: textureData.height,\n\t\t\tformat: textureData.format,\n\t\t\tcubemap: textureData.cubemap,\n\t\t\tlevels: textureData.levels\n\t\t}, textureOptions));\n\t\ttexture.upload();\n\t\treturn texture;\n\t}\n\tparse(data) {\n\t\tconst dataU32 = new Uint32Array(data);\n\t\tif (IDENTIFIER[0] !== dataU32[0] || IDENTIFIER[1] !== dataU32[1] || IDENTIFIER[2] !== dataU32[2]) {\n\t\t\treturn null;\n\t\t}\n\t\tconst header = {\n\t\t\tendianness: dataU32[3],\n\t\t\tglType: dataU32[4],\n\t\t\tglTypeSize: dataU32[5],\n\t\t\tglFormat: dataU32[6],\n\t\t\tglInternalFormat: dataU32[7],\n\t\t\tglBaseInternalFormat: dataU32[8],\n\t\t\tpixelWidth: dataU32[9],\n\t\t\tpixelHeight: dataU32[10],\n\t\t\tpixelDepth: dataU32[11],\n\t\t\tnumberOfArrayElements: dataU32[12],\n\t\t\tnumberOfFaces: dataU32[13],\n\t\t\tnumberOfMipmapLevels: dataU32[14],\n\t\t\tbytesOfKeyValueData: dataU32[15]\n\t\t};\n\t\tif (header.pixelDepth > 1) {\n\t\t\treturn null;\n\t\t}\n\t\tif (header.numberOfArrayElements !== 0) {\n\t\t\treturn null;\n\t\t}\n\t\tconst format = KNOWN_FORMATS[header.glInternalFormat];\n\t\tif (format === undefined) {\n\t\t\treturn null;\n\t\t}\n\t\tlet offset = 16 + header.bytesOfKeyValueData / 4;\n\t\tconst isCubemap = header.numberOfFaces > 1;\n\t\tconst levels = [];\n\t\tfor (let mipmapLevel = 0; mipmapLevel < (header.numberOfMipmapLevels || 1); mipmapLevel++) {\n\t\t\tconst imageSizeInBytes = dataU32[offset++];\n\t\t\tif (isCubemap) {\n\t\t\t\tlevels.push([]);\n\t\t\t}\n\t\t\tconst target = isCubemap ? levels[mipmapLevel] : levels;\n\t\t\tfor (let face = 0; face < (isCubemap ? 6 : 1); ++face) {\n\t\t\t\ttarget.push(createContainer(format, data, offset * 4, imageSizeInBytes));\n\t\t\t\toffset += imageSizeInBytes + 3 >> 2;\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\tformat: format,\n\t\t\twidth: header.pixelWidth,\n\t\t\theight: header.pixelHeight,\n\t\t\tlevels: levels,\n\t\t\tcubemap: isCubemap\n\t\t};\n\t}\n}\n\nexport { KtxParser };\n","import { extends as _extends } from '../../../_virtual/_rollupPluginBabelHelpers.js';\nimport '../../../core/tracing.js';\nimport { ReadStream } from '../../../core/read-stream.js';\nimport { ADDRESS_CLAMP_TO_EDGE, ADDRESS_REPEAT } from '../../../platform/graphics/constants.js';\nimport { Texture } from '../../../platform/graphics/texture.js';\nimport { Asset } from '../../asset/asset.js';\nimport { basisTranscode } from '../../handlers/basis.js';\n\nconst KHRConstants = {\n\tKHR_DF_MODEL_ETC1S: 163,\n\tKHR_DF_MODEL_UASTC: 166\n};\nclass Ktx2Parser {\n\tconstructor(registry, device) {\n\t\tthis.maxRetries = 0;\n\t\tthis.device = device;\n\t}\n\tload(url, callback, asset) {\n\t\tAsset.fetchArrayBuffer(url.load, (err, result) => {\n\t\t\tif (err) {\n\t\t\t\tcallback(err, result);\n\t\t\t} else {\n\t\t\t\tthis.parse(result, url, callback, asset);\n\t\t\t}\n\t\t}, asset, this.maxRetries);\n\t}\n\topen(url, data, device, textureOptions = {}) {\n\t\tconst texture = new Texture(device, _extends({\n\t\t\tname: url,\n\t\t\taddressU: data.cubemap ? ADDRESS_CLAMP_TO_EDGE : ADDRESS_REPEAT,\n\t\t\taddressV: data.cubemap ? ADDRESS_CLAMP_TO_EDGE : ADDRESS_REPEAT,\n\t\t\twidth: data.width,\n\t\t\theight: data.height,\n\t\t\tformat: data.format,\n\t\t\tcubemap: data.cubemap,\n\t\t\tlevels: data.levels\n\t\t}, textureOptions));\n\t\ttexture.upload();\n\t\treturn texture;\n\t}\n\tparse(arraybuffer, url, callback, asset) {\n\t\tconst rs = new ReadStream(arraybuffer);\n\t\tconst magic = [rs.readU32be(), rs.readU32be(), rs.readU32be()];\n\t\tif (magic[0] !== 0xAB4B5458 || magic[1] !== 0x203230BB || magic[2] !== 0x0D0A1A0A) {\n\t\t\treturn null;\n\t\t}\n\t\tconst header = {\n\t\t\tvkFormat: rs.readU32(),\n\t\t\ttypeSize: rs.readU32(),\n\t\t\tpixelWidth: rs.readU32(),\n\t\t\tpixelHeight: rs.readU32(),\n\t\t\tpixelDepth: rs.readU32(),\n\t\t\tlayerCount: rs.readU32(),\n\t\t\tfaceCount: rs.readU32(),\n\t\t\tlevelCount: rs.readU32(),\n\t\t\tsupercompressionScheme: rs.readU32()\n\t\t};\n\t\tconst index = {\n\t\t\tdfdByteOffset: rs.readU32(),\n\t\t\tdfdByteLength: rs.readU32(),\n\t\t\tkvdByteOffset: rs.readU32(),\n\t\t\tkvdByteLength: rs.readU32(),\n\t\t\tsgdByteOffset: rs.readU64(),\n\t\t\tsgdByteLength: rs.readU64()\n\t\t};\n\t\tconst levels = [];\n\t\tfor (let i = 0; i < Math.max(1, header.levelCount); ++i) {\n\t\t\tlevels.push({\n\t\t\t\tbyteOffset: rs.readU64(),\n\t\t\t\tbyteLength: rs.readU64(),\n\t\t\t\tuncompressedByteLength: rs.readU64()\n\t\t\t});\n\t\t}\n\t\tconst dfdTotalSize = rs.readU32();\n\t\tif (dfdTotalSize !== index.kvdByteOffset - index.dfdByteOffset) {\n\t\t\treturn null;\n\t\t}\n\t\trs.skip(8);\n\t\tconst colorModel = rs.readU8();\n\t\trs.skip(index.dfdByteLength - 9);\n\t\trs.skip(index.kvdByteLength);\n\t\tif (header.supercompressionScheme === 1 || colorModel === KHRConstants.KHR_DF_MODEL_UASTC) {\n\t\t\tvar _asset$file;\n\t\t\tconst basisModuleFound = basisTranscode(this.device, url.load, arraybuffer, callback, {\n\t\t\t\tisGGGR: ((asset == null || (_asset$file = asset.file) == null || (_asset$file = _asset$file.variants) == null || (_asset$file = _asset$file.basis) == null ? void 0 : _asset$file.opt) & 8) !== 0,\n\t\t\t\tisKTX2: true\n\t\t\t});\n\t\t\tif (!basisModuleFound) {\n\t\t\t\tcallback('Basis module not found. Asset \"' + asset.name + '\" basis texture variant will not be loaded.');\n\t\t\t}\n\t\t} else {\n\t\t\tcallback('unsupported KTX2 pixel format');\n\t\t}\n\t}\n}\n\nexport { Ktx2Parser };\n","import { extends as _extends } from '../../../_virtual/_rollupPluginBabelHelpers.js';\nimport '../../../core/tracing.js';\nimport { PIXELFORMAT_RGB8, ADDRESS_CLAMP_TO_EDGE, ADDRESS_REPEAT, PIXELFORMAT_DXT1, PIXELFORMAT_DXT5, PIXELFORMAT_RGBA16F, PIXELFORMAT_RGBA32F, PIXELFORMAT_ETC1, PIXELFORMAT_PVRTC_2BPP_RGB_1, PIXELFORMAT_PVRTC_2BPP_RGBA_1, PIXELFORMAT_PVRTC_4BPP_RGB_1, PIXELFORMAT_PVRTC_4BPP_RGBA_1, PIXELFORMAT_RGBA8 } from '../../../platform/graphics/constants.js';\nimport { Texture } from '../../../platform/graphics/texture.js';\nimport { Asset } from '../../asset/asset.js';\n\nclass DdsParser {\n\tconstructor(registry) {\n\t\tthis.maxRetries = 0;\n\t}\n\tload(url, callback, asset) {\n\t\tAsset.fetchArrayBuffer(url.load, callback, asset, this.maxRetries);\n\t}\n\topen(url, data, device, textureOptions = {}) {\n\t\tconst header = new Uint32Array(data, 0, 128 / 4);\n\t\tconst width = header[4];\n\t\tconst height = header[3];\n\t\tconst mips = Math.max(header[7], 1);\n\t\tconst isFourCc = header[20] === 4;\n\t\tconst fcc = header[21];\n\t\tconst bpp = header[22];\n\t\tconst isCubemap = header[28] === 65024;\n\t\tconst FCC_DXT1 = 827611204;\n\t\tconst FCC_DXT5 = 894720068;\n\t\tconst FCC_FP16 = 113;\n\t\tconst FCC_FP32 = 116;\n\t\tconst FCC_ETC1 = 826496069;\n\t\tconst FCC_PVRTC_2BPP_RGB_1 = 825438800;\n\t\tconst FCC_PVRTC_2BPP_RGBA_1 = 825504336;\n\t\tconst FCC_PVRTC_4BPP_RGB_1 = 825439312;\n\t\tconst FCC_PVRTC_4BPP_RGBA_1 = 825504848;\n\t\tlet compressed = false;\n\t\tlet etc1 = false;\n\t\tlet pvrtc2 = false;\n\t\tlet pvrtc4 = false;\n\t\tlet format = null;\n\t\tlet componentSize = 1;\n\t\tlet texture;\n\t\tif (isFourCc) {\n\t\t\tif (fcc === FCC_DXT1) {\n\t\t\t\tformat = PIXELFORMAT_DXT1;\n\t\t\t\tcompressed = true;\n\t\t\t} else if (fcc === FCC_DXT5) {\n\t\t\t\tformat = PIXELFORMAT_DXT5;\n\t\t\t\tcompressed = true;\n\t\t\t} else if (fcc === FCC_FP16) {\n\t\t\t\tformat = PIXELFORMAT_RGBA16F;\n\t\t\t\tcomponentSize = 2;\n\t\t\t} else if (fcc === FCC_FP32) {\n\t\t\t\tformat = PIXELFORMAT_RGBA32F;\n\t\t\t\tcomponentSize = 4;\n\t\t\t} else if (fcc === FCC_ETC1) {\n\t\t\t\tformat = PIXELFORMAT_ETC1;\n\t\t\t\tcompressed = true;\n\t\t\t\tetc1 = true;\n\t\t\t} else if (fcc === FCC_PVRTC_2BPP_RGB_1 || fcc === FCC_PVRTC_2BPP_RGBA_1) {\n\t\t\t\tformat = fcc === FCC_PVRTC_2BPP_RGB_1 ? PIXELFORMAT_PVRTC_2BPP_RGB_1 : PIXELFORMAT_PVRTC_2BPP_RGBA_1;\n\t\t\t\tcompressed = true;\n\t\t\t\tpvrtc2 = true;\n\t\t\t} else if (fcc === FCC_PVRTC_4BPP_RGB_1 || fcc === FCC_PVRTC_4BPP_RGBA_1) {\n\t\t\t\tformat = fcc === FCC_PVRTC_4BPP_RGB_1 ? PIXELFORMAT_PVRTC_4BPP_RGB_1 : PIXELFORMAT_PVRTC_4BPP_RGBA_1;\n\t\t\t\tcompressed = true;\n\t\t\t\tpvrtc4 = true;\n\t\t\t}\n\t\t} else {\n\t\t\tif (bpp === 32) {\n\t\t\t\tformat = PIXELFORMAT_RGBA8;\n\t\t\t}\n\t\t}\n\t\tif (!format) {\n\t\t\ttexture = new Texture(device, {\n\t\t\t\twidth: 4,\n\t\t\t\theight: 4,\n\t\t\t\tformat: PIXELFORMAT_RGB8,\n\t\t\t\tname: 'dds-legacy-empty'\n\t\t\t});\n\t\t\treturn texture;\n\t\t}\n\t\ttexture = new Texture(device, _extends({\n\t\t\tname: url,\n\t\t\taddressU: isCubemap ? ADDRESS_CLAMP_TO_EDGE : ADDRESS_REPEAT,\n\t\t\taddressV: isCubemap ? ADDRESS_CLAMP_TO_EDGE : ADDRESS_REPEAT,\n\t\t\twidth: width,\n\t\t\theight: height,\n\t\t\tformat: format,\n\t\t\tcubemap: isCubemap,\n\t\t\tmipmaps: mips > 1\n\t\t}, textureOptions));\n\t\tlet offset = 128;\n\t\tconst faces = isCubemap ? 6 : 1;\n\t\tlet mipSize;\n\t\tconst DXT_BLOCK_WIDTH = 4;\n\t\tconst DXT_BLOCK_HEIGHT = 4;\n\t\tconst blockSize = fcc === FCC_DXT1 ? 8 : 16;\n\t\tlet numBlocksAcross, numBlocksDown, numBlocks;\n\t\tfor (let face = 0; face < faces; face++) {\n\t\t\tlet mipWidth = width;\n\t\t\tlet mipHeight = height;\n\t\t\tfor (let i = 0; i < mips; i++) {\n\t\t\t\tif (compressed) {\n\t\t\t\t\tif (etc1) {\n\t\t\t\t\t\tmipSize = Math.floor((mipWidth + 3) / 4) * Math.floor((mipHeight + 3) / 4) * 8;\n\t\t\t\t\t} else if (pvrtc2) {\n\t\t\t\t\t\tmipSize = Math.max(mipWidth, 16) * Math.max(mipHeight, 8) / 4;\n\t\t\t\t\t} else if (pvrtc4) {\n\t\t\t\t\t\tmipSize = Math.max(mipWidth, 8) * Math.max(mipHeight, 8) / 2;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnumBlocksAcross = Math.floor((mipWidth + DXT_BLOCK_WIDTH - 1) / DXT_BLOCK_WIDTH);\n\t\t\t\t\t\tnumBlocksDown = Math.floor((mipHeight + DXT_BLOCK_HEIGHT - 1) / DXT_BLOCK_HEIGHT);\n\t\t\t\t\t\tnumBlocks = numBlocksAcross * numBlocksDown;\n\t\t\t\t\t\tmipSize = numBlocks * blockSize;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tmipSize = mipWidth * mipHeight * 4;\n\t\t\t\t}\n\t\t\t\tconst mipBuff = format === PIXELFORMAT_RGBA32F ? new Float32Array(data, offset, mipSize) : format === PIXELFORMAT_RGBA16F ? new Uint16Array(data, offset, mipSize) : new Uint8Array(data, offset, mipSize);\n\t\t\t\tif (!isCubemap) {\n\t\t\t\t\ttexture._levels[i] = mipBuff;\n\t\t\t\t} else {\n\t\t\t\t\tif (!texture._levels[i]) texture._levels[i] = [];\n\t\t\t\t\ttexture._levels[i][face] = mipBuff;\n\t\t\t\t}\n\t\t\t\toffset += mipSize * componentSize;\n\t\t\t\tmipWidth = Math.max(mipWidth * 0.5, 1);\n\t\t\t\tmipHeight = Math.max(mipHeight * 0.5, 1);\n\t\t\t}\n\t\t}\n\t\ttexture.upload();\n\t\treturn texture;\n\t}\n}\n\nexport { DdsParser };\n","import { extends as _extends } from '../../../_virtual/_rollupPluginBabelHelpers.js';\nimport '../../../core/tracing.js';\nimport { ReadStream } from '../../../core/read-stream.js';\nimport { ADDRESS_REPEAT, ADDRESS_CLAMP_TO_EDGE, FILTER_NEAREST, PIXELFORMAT_RGBA8, TEXTURETYPE_RGBE } from '../../../platform/graphics/constants.js';\nimport { Texture } from '../../../platform/graphics/texture.js';\nimport { Asset } from '../../asset/asset.js';\n\nclass HdrParser {\n\tconstructor(registry) {\n\t\tthis.maxRetries = 0;\n\t}\n\tload(url, callback, asset) {\n\t\tAsset.fetchArrayBuffer(url.load, callback, asset, this.maxRetries);\n\t}\n\topen(url, data, device, textureOptions = {}) {\n\t\tconst textureData = this.parse(data);\n\t\tif (!textureData) {\n\t\t\treturn null;\n\t\t}\n\t\tconst texture = new Texture(device, _extends({\n\t\t\tname: url,\n\t\t\taddressU: ADDRESS_REPEAT,\n\t\t\taddressV: ADDRESS_CLAMP_TO_EDGE,\n\t\t\tminFilter: FILTER_NEAREST,\n\t\t\tmagFilter: FILTER_NEAREST,\n\t\t\twidth: textureData.width,\n\t\t\theight: textureData.height,\n\t\t\tlevels: textureData.levels,\n\t\t\tformat: PIXELFORMAT_RGBA8,\n\t\t\ttype: TEXTURETYPE_RGBE,\n\t\t\tmipmaps: false\n\t\t}, textureOptions));\n\t\ttexture.upload();\n\t\treturn texture;\n\t}\n\tparse(data) {\n\t\tconst readStream = new ReadStream(data);\n\t\tconst magic = readStream.readLine();\n\t\tif (!magic.startsWith('#?RADIANCE')) {\n\t\t\treturn null;\n\t\t}\n\t\tconst variables = {};\n\t\twhile (true) {\n\t\t\tconst line = readStream.readLine();\n\t\t\tif (line.length === 0) {\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tconst parts = line.split('=');\n\t\t\t\tif (parts.length === 2) {\n\t\t\t\t\tvariables[parts[0]] = parts[1];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (!variables.hasOwnProperty('FORMAT')) {\n\t\t\treturn null;\n\t\t}\n\t\tconst resolution = readStream.readLine().split(' ');\n\t\tif (resolution.length !== 4) {\n\t\t\treturn null;\n\t\t}\n\t\tconst height = parseInt(resolution[1], 10);\n\t\tconst width = parseInt(resolution[3], 10);\n\t\tconst pixels = this._readPixels(readStream, width, height, resolution[0] === '-Y');\n\t\tif (!pixels) {\n\t\t\treturn null;\n\t\t}\n\t\treturn {\n\t\t\twidth: width,\n\t\t\theight: height,\n\t\t\tlevels: [pixels]\n\t\t};\n\t}\n\t_readPixels(readStream, width, height, flipY) {\n\t\tif (width < 8 || width > 0x7fff) {\n\t\t\treturn this._readPixelsFlat(readStream, width, height);\n\t\t}\n\t\tconst rgbe = [0, 0, 0, 0];\n\t\treadStream.readArray(rgbe);\n\t\tif (rgbe[0] !== 2 || rgbe[1] !== 2 || (rgbe[2] & 0x80) !== 0) {\n\t\t\treadStream.skip(-4);\n\t\t\treturn this._readPixelsFlat(readStream, width, height);\n\t\t}\n\t\tconst buffer = new ArrayBuffer(width * height * 4);\n\t\tconst view = new Uint8Array(buffer);\n\t\tlet scanstart = flipY ? 0 : width * 4 * (height - 1);\n\t\tlet x, y, i, channel, count, value;\n\t\tfor (y = 0; y < height; ++y) {\n\t\t\tif (y) {\n\t\t\t\treadStream.readArray(rgbe);\n\t\t\t}\n\t\t\tif ((rgbe[2] << 8) + rgbe[3] !== width) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tfor (channel = 0; channel < 4; ++channel) {\n\t\t\t\tx = 0;\n\t\t\t\twhile (x < width) {\n\t\t\t\t\tcount = readStream.readU8();\n\t\t\t\t\tif (count > 128) {\n\t\t\t\t\t\tcount -= 128;\n\t\t\t\t\t\tif (x + count > width) {\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvalue = readStream.readU8();\n\t\t\t\t\t\tfor (i = 0; i < count; ++i) {\n\t\t\t\t\t\t\tview[scanstart + channel + 4 * x++] = value;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (count === 0 || x + count > width) {\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfor (i = 0; i < count; ++i) {\n\t\t\t\t\t\t\tview[scanstart + channel + 4 * x++] = readStream.readU8();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tscanstart += width * 4 * (flipY ? 1 : -1);\n\t\t}\n\t\treturn view;\n\t}\n\t_readPixelsFlat(readStream, width, height) {\n\t\treturn readStream.remainingBytes === width * height * 4 ? new Uint8Array(readStream.arraybuffer, readStream.offset) : null;\n\t}\n}\n\nexport { HdrParser };\n","import { path } from '../../core/path.js';\nimport { TEXTURETYPE_RGBM, TEXTURETYPE_SWIZZLEGGGR, PIXELFORMAT_RGB8, ADDRESS_REPEAT, ADDRESS_CLAMP_TO_EDGE, ADDRESS_MIRRORED_REPEAT, FILTER_NEAREST, FILTER_LINEAR, FILTER_NEAREST_MIPMAP_NEAREST, FILTER_LINEAR_MIPMAP_NEAREST, FILTER_NEAREST_MIPMAP_LINEAR, FILTER_LINEAR_MIPMAP_LINEAR, TEXTURETYPE_DEFAULT, TEXTURETYPE_RGBE, TEXTURETYPE_RGBP, PIXELFORMAT_RGBA8, PIXELFORMAT_RGBA32F } from '../../platform/graphics/constants.js';\nimport { Texture } from '../../platform/graphics/texture.js';\nimport { TextureUtils } from '../../platform/graphics/texture-utils.js';\nimport { BasisParser } from '../parsers/texture/basis.js';\nimport { ImgParser } from '../parsers/texture/img.js';\nimport { KtxParser } from '../parsers/texture/ktx.js';\nimport { Ktx2Parser } from '../parsers/texture/ktx2.js';\nimport { DdsParser } from '../parsers/texture/dds.js';\nimport { HdrParser } from '../parsers/texture/hdr.js';\n\nconst JSON_ADDRESS_MODE = {\n\t'repeat': ADDRESS_REPEAT,\n\t'clamp': ADDRESS_CLAMP_TO_EDGE,\n\t'mirror': ADDRESS_MIRRORED_REPEAT\n};\nconst JSON_FILTER_MODE = {\n\t'nearest': FILTER_NEAREST,\n\t'linear': FILTER_LINEAR,\n\t'nearest_mip_nearest': FILTER_NEAREST_MIPMAP_NEAREST,\n\t'linear_mip_nearest': FILTER_LINEAR_MIPMAP_NEAREST,\n\t'nearest_mip_linear': FILTER_NEAREST_MIPMAP_LINEAR,\n\t'linear_mip_linear': FILTER_LINEAR_MIPMAP_LINEAR\n};\nconst JSON_TEXTURE_TYPE = {\n\t'default': TEXTURETYPE_DEFAULT,\n\t'rgbm': TEXTURETYPE_RGBM,\n\t'rgbe': TEXTURETYPE_RGBE,\n\t'rgbp': TEXTURETYPE_RGBP,\n\t'swizzleGGGR': TEXTURETYPE_SWIZZLEGGGR\n};\nclass TextureParser {\n\tload(url, callback, asset) {\n\t\tthrow new Error('not implemented');\n\t}\n\topen(url, data, device) {\n\t\tthrow new Error('not implemented');\n\t}\n}\nconst _completePartialMipmapChain = function _completePartialMipmapChain(texture) {\n\tconst requiredMipLevels = TextureUtils.calcMipLevelsCount(texture._width, texture._height);\n\tconst isHtmlElement = function isHtmlElement(object) {\n\t\treturn object instanceof HTMLCanvasElement || object instanceof HTMLImageElement || object instanceof HTMLVideoElement;\n\t};\n\tif (!(texture._format === PIXELFORMAT_RGBA8 || texture._format === PIXELFORMAT_RGBA32F) || texture._volume || texture._compressed || texture._levels.length === 1 || texture._levels.length === requiredMipLevels || isHtmlElement(texture._cubemap ? texture._levels[0][0] : texture._levels[0])) {\n\t\treturn;\n\t}\n\tconst downsample = function downsample(width, height, data) {\n\t\tconst sampledWidth = Math.max(1, width >> 1);\n\t\tconst sampledHeight = Math.max(1, height >> 1);\n\t\tconst sampledData = new data.constructor(sampledWidth * sampledHeight * 4);\n\t\tconst xs = Math.floor(width / sampledWidth);\n\t\tconst ys = Math.floor(height / sampledHeight);\n\t\tconst xsys = xs * ys;\n\t\tfor (let y = 0; y < sampledHeight; ++y) {\n\t\t\tfor (let x = 0; x < sampledWidth; ++x) {\n\t\t\t\tfor (let e = 0; e < 4; ++e) {\n\t\t\t\t\tlet sum = 0;\n\t\t\t\t\tfor (let sy = 0; sy < ys; ++sy) {\n\t\t\t\t\t\tfor (let sx = 0; sx < xs; ++sx) {\n\t\t\t\t\t\t\tsum += data[(x * xs + sx + (y * ys + sy) * width) * 4 + e];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tsampledData[(x + y * sampledWidth) * 4 + e] = sum / xsys;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn sampledData;\n\t};\n\tfor (let level = texture._levels.length; level < requiredMipLevels; ++level) {\n\t\tconst width = Math.max(1, texture._width >> level - 1);\n\t\tconst height = Math.max(1, texture._height >> level - 1);\n\t\tif (texture._cubemap) {\n\t\t\tconst mips = [];\n\t\t\tfor (let face = 0; face < 6; ++face) {\n\t\t\t\tmips.push(downsample(width, height, texture._levels[level - 1][face]));\n\t\t\t}\n\t\t\ttexture._levels.push(mips);\n\t\t} else {\n\t\t\ttexture._levels.push(downsample(width, height, texture._levels[level - 1]));\n\t\t}\n\t}\n\ttexture._levelsUpdated = texture._cubemap ? [[true, true, true, true, true, true]] : [true];\n};\nclass TextureHandler {\n\tconstructor(app) {\n\t\tthis.handlerType = \"texture\";\n\t\tconst assets = app.assets;\n\t\tconst device = app.graphicsDevice;\n\t\tthis._device = device;\n\t\tthis._assets = assets;\n\t\tthis.imgParser = new ImgParser(assets, device);\n\t\tthis.parsers = {\n\t\t\tdds: new DdsParser(assets),\n\t\t\tktx: new KtxParser(assets),\n\t\t\tktx2: new Ktx2Parser(assets, device),\n\t\t\tbasis: new BasisParser(assets, device),\n\t\t\thdr: new HdrParser(assets)\n\t\t};\n\t}\n\tset crossOrigin(value) {\n\t\tthis.imgParser.crossOrigin = value;\n\t}\n\tget crossOrigin() {\n\t\treturn this.imgParser.crossOrigin;\n\t}\n\tset maxRetries(value) {\n\t\tthis.imgParser.maxRetries = value;\n\t\tfor (const parser in this.parsers) {\n\t\t\tif (this.parsers.hasOwnProperty(parser)) {\n\t\t\t\tthis.parsers[parser].maxRetries = value;\n\t\t\t}\n\t\t}\n\t}\n\tget maxRetries() {\n\t\treturn this.imgParser.maxRetries;\n\t}\n\t_getUrlWithoutParams(url) {\n\t\treturn url.indexOf('?') >= 0 ? url.split('?')[0] : url;\n\t}\n\t_getParser(url) {\n\t\tconst ext = path.getExtension(this._getUrlWithoutParams(url)).toLowerCase().replace('.', '');\n\t\treturn this.parsers[ext] || this.imgParser;\n\t}\n\t_getTextureOptions(asset) {\n\t\tconst options = {};\n\t\tif (asset) {\n\t\t\tvar _asset$name;\n\t\t\tif (((_asset$name = asset.name) == null ? void 0 : _asset$name.length) > 0) {\n\t\t\t\toptions.name = asset.name;\n\t\t\t}\n\t\t\tconst assetData = asset.data;\n\t\t\tif (assetData.hasOwnProperty('minfilter')) {\n\t\t\t\toptions.minFilter = JSON_FILTER_MODE[assetData.minfilter];\n\t\t\t}\n\t\t\tif (assetData.hasOwnProperty('magfilter')) {\n\t\t\t\toptions.magFilter = JSON_FILTER_MODE[assetData.magfilter];\n\t\t\t}\n\t\t\tif (assetData.hasOwnProperty('addressu')) {\n\t\t\t\toptions.addressU = JSON_ADDRESS_MODE[assetData.addressu];\n\t\t\t}\n\t\t\tif (assetData.hasOwnProperty('addressv')) {\n\t\t\t\toptions.addressV = JSON_ADDRESS_MODE[assetData.addressv];\n\t\t\t}\n\t\t\tif (assetData.hasOwnProperty('mipmaps')) {\n\t\t\t\toptions.mipmaps = assetData.mipmaps;\n\t\t\t}\n\t\t\tif (assetData.hasOwnProperty('anisotropy')) {\n\t\t\t\toptions.anisotropy = assetData.anisotropy;\n\t\t\t}\n\t\t\tif (assetData.hasOwnProperty('flipY')) {\n\t\t\t\toptions.flipY = !!assetData.flipY;\n\t\t\t}\n\t\t\tif (assetData.hasOwnProperty('type')) {\n\t\t\t\toptions.type = JSON_TEXTURE_TYPE[assetData.type];\n\t\t\t} else if (assetData.hasOwnProperty('rgbm') && assetData.rgbm) {\n\t\t\t\toptions.type = TEXTURETYPE_RGBM;\n\t\t\t} else if (asset.file && (asset.file.opt & 8) !== 0) {\n\t\t\t\toptions.type = TEXTURETYPE_SWIZZLEGGGR;\n\t\t\t}\n\t\t}\n\t\treturn options;\n\t}\n\tload(url, callback, asset) {\n\t\tif (typeof url === 'string') {\n\t\t\turl = {\n\t\t\t\tload: url,\n\t\t\t\toriginal: url\n\t\t\t};\n\t\t}\n\t\tthis._getParser(url.original).load(url, callback, asset);\n\t}\n\topen(url, data, asset) {\n\t\tif (!url) return undefined;\n\t\tconst textureOptions = this._getTextureOptions(asset);\n\t\tlet texture = this._getParser(url).open(url, data, this._device, textureOptions);\n\t\tif (texture === null) {\n\t\t\ttexture = new Texture(this._device, {\n\t\t\t\twidth: 4,\n\t\t\t\theight: 4,\n\t\t\t\tformat: PIXELFORMAT_RGB8\n\t\t\t});\n\t\t} else {\n\t\t\t_completePartialMipmapChain(texture);\n\t\t\tif (data.unswizzledGGGR) {\n\t\t\t\tasset.file.variants.basis.opt &= ~8;\n\t\t\t}\n\t\t}\n\t\treturn texture;\n\t}\n\tpatch(asset, assets) {\n\t\tconst texture = asset.resource;\n\t\tif (!texture) {\n\t\t\treturn;\n\t\t}\n\t\tconst options = this._getTextureOptions(asset);\n\t\tfor (const key of Object.keys(options)) {\n\t\t\ttexture[key] = options[key];\n\t\t}\n\t}\n}\n\nexport { TextureHandler, TextureParser };\n","const XRTYPE_INLINE = 'inline';\nconst XRTYPE_VR = 'immersive-vr';\nconst XRTYPE_AR = 'immersive-ar';\nconst XRSPACE_VIEWER = 'viewer';\nconst XRSPACE_LOCAL = 'local';\nconst XRSPACE_LOCALFLOOR = 'local-floor';\nconst XRSPACE_BOUNDEDFLOOR = 'bounded-floor';\nconst XRSPACE_UNBOUNDED = 'unbounded';\nconst XRTARGETRAY_GAZE = 'gaze';\nconst XRTARGETRAY_SCREEN = 'screen';\nconst XRTARGETRAY_POINTER = 'tracked-pointer';\nconst XRHAND_NONE = 'none';\nconst XRHAND_LEFT = 'left';\nconst XRHAND_RIGHT = 'right';\nconst XRTRACKABLE_POINT = 'point';\nconst XRTRACKABLE_PLANE = 'plane';\nconst XRTRACKABLE_MESH = 'mesh';\nconst XRDEPTHSENSINGUSAGE_CPU = 'cpu-optimized';\nconst XRDEPTHSENSINGUSAGE_GPU = 'gpu-optimized';\nconst XRDEPTHSENSINGFORMAT_L8A8 = 'luminance-alpha';\nconst XRDEPTHSENSINGFORMAT_F32 = 'float32';\n\nexport { XRDEPTHSENSINGFORMAT_F32, XRDEPTHSENSINGFORMAT_L8A8, XRDEPTHSENSINGUSAGE_CPU, XRDEPTHSENSINGUSAGE_GPU, XRHAND_LEFT, XRHAND_NONE, XRHAND_RIGHT, XRSPACE_BOUNDEDFLOOR, XRSPACE_LOCAL, XRSPACE_LOCALFLOOR, XRSPACE_UNBOUNDED, XRSPACE_VIEWER, XRTARGETRAY_GAZE, XRTARGETRAY_POINTER, XRTARGETRAY_SCREEN, XRTRACKABLE_MESH, XRTRACKABLE_PLANE, XRTRACKABLE_POINT, XRTYPE_AR, XRTYPE_INLINE, XRTYPE_VR };\n","import { EventHandler } from '../../core/event-handler.js';\nimport { platform } from '../../core/platform.js';\nimport { Mat4 } from '../../core/math/mat4.js';\nimport { PIXELFORMAT_LA8, ADDRESS_CLAMP_TO_EDGE, FILTER_LINEAR } from '../../platform/graphics/constants.js';\nimport { Texture } from '../../platform/graphics/texture.js';\nimport { XRDEPTHSENSINGUSAGE_CPU, XRDEPTHSENSINGUSAGE_GPU } from './constants.js';\n\nclass XrDepthSensing extends EventHandler {\n\tconstructor(manager) {\n\t\tsuper();\n\t\tthis._manager = void 0;\n\t\tthis._available = false;\n\t\tthis._depthInfoCpu = null;\n\t\tthis._depthInfoGpu = null;\n\t\tthis._usage = null;\n\t\tthis._dataFormat = null;\n\t\tthis._matrixDirty = false;\n\t\tthis._matrix = new Mat4();\n\t\tthis._emptyBuffer = new Uint8Array(32);\n\t\tthis._depthBuffer = null;\n\t\tthis._texture = void 0;\n\t\tthis._manager = manager;\n\t\tthis._texture = new Texture(this._manager.app.graphicsDevice, {\n\t\t\tformat: PIXELFORMAT_LA8,\n\t\t\tmipmaps: false,\n\t\t\taddressU: ADDRESS_CLAMP_TO_EDGE,\n\t\t\taddressV: ADDRESS_CLAMP_TO_EDGE,\n\t\t\tminFilter: FILTER_LINEAR,\n\t\t\tmagFilter: FILTER_LINEAR,\n\t\t\tname: 'XRDepthSensing'\n\t\t});\n\t\tif (this.supported) {\n\t\t\tthis._manager.on('start', this._onSessionStart, this);\n\t\t\tthis._manager.on('end', this._onSessionEnd, this);\n\t\t}\n\t}\n\tdestroy() {\n\t\tthis._texture.destroy();\n\t\tthis._texture = null;\n\t}\n\t_onSessionStart() {\n\t\tconst session = this._manager.session;\n\t\ttry {\n\t\t\tthis._usage = session.depthUsage;\n\t\t\tthis._dataFormat = session.depthDataFormat;\n\t\t} catch (ex) {\n\t\t\tthis._usage = null;\n\t\t\tthis._dataFormat = null;\n\t\t\tthis._available = false;\n\t\t\tthis.fire('error', ex);\n\t\t}\n\t}\n\t_onSessionEnd() {\n\t\tthis._depthInfoCpu = null;\n\t\tthis._depthInfoGpu = null;\n\t\tthis._usage = null;\n\t\tthis._dataFormat = null;\n\t\tif (this._available) {\n\t\t\tthis._available = false;\n\t\t\tthis.fire('unavailable');\n\t\t}\n\t\tthis._depthBuffer = null;\n\t\tthis._texture._width = 4;\n\t\tthis._texture._height = 4;\n\t\tthis._texture._levels[0] = this._emptyBuffer;\n\t\tthis._texture.upload();\n\t}\n\t_updateTexture() {\n\t\tconst depthInfo = this._depthInfoCpu || this._depthInfoGpu;\n\t\tif (depthInfo) {\n\t\t\tlet resized = false;\n\t\t\tif (depthInfo.width !== this._texture.width || depthInfo.height !== this._texture.height) {\n\t\t\t\tthis._texture._width = depthInfo.width;\n\t\t\t\tthis._texture._height = depthInfo.height;\n\t\t\t\tthis._matrixDirty = true;\n\t\t\t\tresized = true;\n\t\t\t}\n\t\t\tif (this._depthInfoCpu) {\n\t\t\t\tconst dataBuffer = this._depthInfoCpu.data;\n\t\t\t\tthis._depthBuffer = new Uint8Array(dataBuffer);\n\t\t\t\tthis._texture._levels[0] = this._depthBuffer;\n\t\t\t\tthis._texture.upload();\n\t\t\t} else if (this._depthInfoGpu) {\n\t\t\t\tthis._texture._levels[0] = this._depthInfoGpu.texture;\n\t\t\t\tthis._texture.upload();\n\t\t\t}\n\t\t\tif (resized) this.fire('resize', depthInfo.width, depthInfo.height);\n\t\t} else if (this._depthBuffer) {\n\t\t\tthis._depthBuffer = null;\n\t\t\tthis._texture._width = 4;\n\t\t\tthis._texture._height = 4;\n\t\t\tthis._texture._levels[0] = this._emptyBuffer;\n\t\t\tthis._texture.upload();\n\t\t}\n\t}\n\tupdate(frame, view) {\n\t\tif (!this._usage) return;\n\t\tlet depthInfoCpu = null;\n\t\tlet depthInfoGpu = null;\n\t\tif (this._usage === XRDEPTHSENSINGUSAGE_CPU && view) {\n\t\t\tdepthInfoCpu = frame.getDepthInformation(view);\n\t\t} else if (this._usage === XRDEPTHSENSINGUSAGE_GPU && view) {\n\t\t\tdepthInfoGpu = frame.getDepthInformation(view);\n\t\t}\n\t\tif (this._depthInfoCpu && !depthInfoCpu || !this._depthInfoCpu && depthInfoCpu || this.depthInfoGpu && !depthInfoGpu || !this._depthInfoGpu && depthInfoGpu) {\n\t\t\tthis._matrixDirty = true;\n\t\t}\n\t\tthis._depthInfoCpu = depthInfoCpu;\n\t\tthis._depthInfoGpu = depthInfoGpu;\n\t\tthis._updateTexture();\n\t\tif (this._matrixDirty) {\n\t\t\tthis._matrixDirty = false;\n\t\t\tconst depthInfo = this._depthInfoCpu || this._depthInfoGpu;\n\t\t\tif (depthInfo) {\n\t\t\t\tthis._matrix.data.set(depthInfo.normDepthBufferFromNormView.matrix);\n\t\t\t} else {\n\t\t\t\tthis._matrix.setIdentity();\n\t\t\t}\n\t\t}\n\t\tif ((this._depthInfoCpu || this._depthInfoGpu) && !this._available) {\n\t\t\tthis._available = true;\n\t\t\tthis.fire('available');\n\t\t} else if (!this._depthInfoCpu && !this._depthInfoGpu && this._available) {\n\t\t\tthis._available = false;\n\t\t\tthis.fire('unavailable');\n\t\t}\n\t}\n\tgetDepth(u, v) {\n\t\tif (!this._depthInfoCpu) return null;\n\t\treturn this._depthInfoCpu.getDepthInMeters(u, v);\n\t}\n\tget supported() {\n\t\treturn platform.browser && !!window.XRDepthInformation;\n\t}\n\tget available() {\n\t\treturn this._available;\n\t}\n\tget usage() {\n\t\treturn this._usage;\n\t}\n\tget dataFormat() {\n\t\treturn this._dataFormat;\n\t}\n\tget width() {\n\t\tconst depthInfo = this._depthInfoCpu || this._depthInfoGpu;\n\t\treturn depthInfo && depthInfo.width || 0;\n\t}\n\tget height() {\n\t\tconst depthInfo = this._depthInfoCpu || this._depthInfoGpu;\n\t\treturn depthInfo && depthInfo.height || 0;\n\t}\n\tget texture() {\n\t\treturn this._texture;\n\t}\n\tget uvMatrix() {\n\t\treturn this._matrix;\n\t}\n\tget rawValueToMeters() {\n\t\tconst depthInfo = this._depthInfoCpu || this._depthInfoGpu;\n\t\treturn depthInfo && depthInfo.rawValueToMeters || 0;\n\t}\n}\n\nexport { XrDepthSensing };\n","import { platform } from '../../core/platform.js';\n\nclass XrDomOverlay {\n\tconstructor(manager) {\n\t\tthis._manager = void 0;\n\t\tthis._supported = platform.browser && !!window.XRDOMOverlayState;\n\t\tthis._root = null;\n\t\tthis._manager = manager;\n\t}\n\tget supported() {\n\t\treturn this._supported;\n\t}\n\tget available() {\n\t\treturn this._supported && this._manager.active && this._manager._session.domOverlayState !== null;\n\t}\n\tget state() {\n\t\tif (!this._supported || !this._manager.active || !this._manager._session.domOverlayState) return null;\n\t\treturn this._manager._session.domOverlayState.type;\n\t}\n\tset root(value) {\n\t\tif (!this._supported || this._manager.active) return;\n\t\tthis._root = value;\n\t}\n\tget root() {\n\t\treturn this._root;\n\t}\n}\n\nexport { XrDomOverlay };\n","import { EventHandler } from '../../core/event-handler.js';\nimport { Quat } from '../../core/math/quat.js';\nimport { Vec3 } from '../../core/math/vec3.js';\n\nconst poolVec3 = [];\nconst poolQuat = [];\nclass XrHitTestSource extends EventHandler {\n\tconstructor(manager, xrHitTestSource, transient) {\n\t\tsuper();\n\t\tthis.manager = void 0;\n\t\tthis._xrHitTestSource = void 0;\n\t\tthis._transient = void 0;\n\t\tthis.manager = manager;\n\t\tthis._xrHitTestSource = xrHitTestSource;\n\t\tthis._transient = transient;\n\t}\n\tremove() {\n\t\tif (!this._xrHitTestSource) return;\n\t\tconst sources = this.manager.hitTest.sources;\n\t\tconst ind = sources.indexOf(this);\n\t\tif (ind !== -1) sources.splice(ind, 1);\n\t\tthis.onStop();\n\t}\n\tonStop() {\n\t\tthis._xrHitTestSource.cancel();\n\t\tthis._xrHitTestSource = null;\n\t\tthis.fire('remove');\n\t\tthis.manager.hitTest.fire('remove', this);\n\t}\n\tupdate(frame) {\n\t\tif (this._transient) {\n\t\t\tconst transientResults = frame.getHitTestResultsForTransientInput(this._xrHitTestSource);\n\t\t\tfor (let i = 0; i < transientResults.length; i++) {\n\t\t\t\tconst transientResult = transientResults[i];\n\t\t\t\tlet inputSource;\n\t\t\t\tif (transientResult.inputSource) inputSource = this.manager.input._getByInputSource(transientResult.inputSource);\n\t\t\t\tthis.updateHitResults(transientResult.results, inputSource);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.updateHitResults(frame.getHitTestResults(this._xrHitTestSource));\n\t\t}\n\t}\n\tupdateHitResults(results, inputSource) {\n\t\tvar _poolVec3$pop, _poolVec3$pop2, _poolQuat$pop;\n\t\tif (inputSource && !inputSource.hitTestSourcesSet.has(this)) return;\n\t\tconst origin = (_poolVec3$pop = poolVec3.pop()) != null ? _poolVec3$pop : new Vec3();\n\t\tif (inputSource) {\n\t\t\torigin.copy(inputSource.getOrigin());\n\t\t} else {\n\t\t\torigin.copy(this.manager.camera.getPosition());\n\t\t}\n\t\tlet candidateDistance = Infinity;\n\t\tlet candidateHitTestResult = null;\n\t\tconst position = (_poolVec3$pop2 = poolVec3.pop()) != null ? _poolVec3$pop2 : new Vec3();\n\t\tconst rotation = (_poolQuat$pop = poolQuat.pop()) != null ? _poolQuat$pop : new Quat();\n\t\tfor (let i = 0; i < results.length; i++) {\n\t\t\tconst pose = results[i].getPose(this.manager._referenceSpace);\n\t\t\tconst distance = origin.distance(pose.transform.position);\n\t\t\tif (distance >= candidateDistance) continue;\n\t\t\tcandidateDistance = distance;\n\t\t\tcandidateHitTestResult = results[i];\n\t\t\tposition.copy(pose.transform.position);\n\t\t\trotation.copy(pose.transform.orientation);\n\t\t}\n\t\tthis.fire('result', position, rotation, inputSource, candidateHitTestResult);\n\t\tthis.manager.hitTest.fire('result', this, position, rotation, inputSource, candidateHitTestResult);\n\t\tpoolVec3.push(origin);\n\t\tpoolVec3.push(position);\n\t\tpoolQuat.push(rotation);\n\t}\n}\n\nexport { XrHitTestSource };\n","import { platform } from '../../core/platform.js';\nimport { EventHandler } from '../../core/event-handler.js';\nimport { XRTYPE_AR, XRSPACE_VIEWER } from './constants.js';\nimport { XrHitTestSource } from './xr-hit-test-source.js';\n\nclass XrHitTest extends EventHandler {\n\tconstructor(manager) {\n\t\tsuper();\n\t\tthis.manager = void 0;\n\t\tthis._supported = platform.browser && !!(window.XRSession && window.XRSession.prototype.requestHitTestSource);\n\t\tthis._session = null;\n\t\tthis.sources = [];\n\t\tthis.manager = manager;\n\t\tif (this._supported) {\n\t\t\tthis.manager.on('start', this._onSessionStart, this);\n\t\t\tthis.manager.on('end', this._onSessionEnd, this);\n\t\t}\n\t}\n\t_onSessionStart() {\n\t\tif (this.manager.type !== XRTYPE_AR) return;\n\t\tthis._session = this.manager.session;\n\t}\n\t_onSessionEnd() {\n\t\tif (!this._session) return;\n\t\tthis._session = null;\n\t\tfor (let i = 0; i < this.sources.length; i++) {\n\t\t\tthis.sources[i].onStop();\n\t\t}\n\t\tthis.sources = [];\n\t}\n\tisAvailable(callback, fireError) {\n\t\tlet err;\n\t\tif (!this._supported) err = new Error('XR HitTest is not supported');\n\t\tif (!this._session) err = new Error('XR Session is not started (1)');\n\t\tif (this.manager.type !== XRTYPE_AR) err = new Error('XR HitTest is available only for AR');\n\t\tif (err) {\n\t\t\tif (callback) callback(err);\n\t\t\tif (fireError) fireError.fire('error', err);\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\tstart(options = {}) {\n\t\tif (!this.isAvailable(options.callback, this)) return;\n\t\tif (!options.profile && !options.spaceType) options.spaceType = XRSPACE_VIEWER;\n\t\tlet xrRay;\n\t\tconst offsetRay = options.offsetRay;\n\t\tif (offsetRay) {\n\t\t\tconst origin = new DOMPoint(offsetRay.origin.x, offsetRay.origin.y, offsetRay.origin.z, 1.0);\n\t\t\tconst direction = new DOMPoint(offsetRay.direction.x, offsetRay.direction.y, offsetRay.direction.z, 0.0);\n\t\t\txrRay = new XRRay(origin, direction);\n\t\t}\n\t\tconst callback = options.callback;\n\t\tif (options.spaceType) {\n\t\t\tthis._session.requestReferenceSpace(options.spaceType).then(referenceSpace => {\n\t\t\t\tif (!this._session) {\n\t\t\t\t\tconst err = new Error('XR Session is not started (2)');\n\t\t\t\t\tif (callback) callback(err);\n\t\t\t\t\tthis.fire('error', err);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis._session.requestHitTestSource({\n\t\t\t\t\tspace: referenceSpace,\n\t\t\t\t\tentityTypes: options.entityTypes || undefined,\n\t\t\t\t\toffsetRay: xrRay\n\t\t\t\t}).then(xrHitTestSource => {\n\t\t\t\t\tthis._onHitTestSource(xrHitTestSource, false, callback);\n\t\t\t\t}).catch(ex => {\n\t\t\t\t\tif (callback) callback(ex);\n\t\t\t\t\tthis.fire('error', ex);\n\t\t\t\t});\n\t\t\t}).catch(ex => {\n\t\t\t\tif (callback) callback(ex);\n\t\t\t\tthis.fire('error', ex);\n\t\t\t});\n\t\t} else {\n\t\t\tthis._session.requestHitTestSourceForTransientInput({\n\t\t\t\tprofile: options.profile,\n\t\t\t\tentityTypes: options.entityTypes || undefined,\n\t\t\t\toffsetRay: xrRay\n\t\t\t}).then(xrHitTestSource => {\n\t\t\t\tthis._onHitTestSource(xrHitTestSource, true, callback);\n\t\t\t}).catch(ex => {\n\t\t\t\tif (callback) callback(ex);\n\t\t\t\tthis.fire('error', ex);\n\t\t\t});\n\t\t}\n\t}\n\t_onHitTestSource(xrHitTestSource, transient, callback) {\n\t\tif (!this._session) {\n\t\t\txrHitTestSource.cancel();\n\t\t\tconst err = new Error('XR Session is not started (3)');\n\t\t\tif (callback) callback(err);\n\t\t\tthis.fire('error', err);\n\t\t\treturn;\n\t\t}\n\t\tconst hitTestSource = new XrHitTestSource(this.manager, xrHitTestSource, transient);\n\t\tthis.sources.push(hitTestSource);\n\t\tif (callback) callback(null, hitTestSource);\n\t\tthis.fire('add', hitTestSource);\n\t}\n\tupdate(frame) {\n\t\tfor (let i = 0; i < this.sources.length; i++) {\n\t\t\tthis.sources[i].update(frame);\n\t\t}\n\t}\n\tget supported() {\n\t\treturn this._supported;\n\t}\n}\n\nexport { XrHitTest };\n","import { EventHandler } from '../../core/event-handler.js';\nimport { Vec3 } from '../../core/math/vec3.js';\nimport { Quat } from '../../core/math/quat.js';\n\nclass XrTrackedImage extends EventHandler {\n\tconstructor(image, width) {\n\t\tsuper();\n\t\tthis._image = void 0;\n\t\tthis._width = void 0;\n\t\tthis._bitmap = null;\n\t\tthis._measuredWidth = 0;\n\t\tthis._trackable = false;\n\t\tthis._tracking = false;\n\t\tthis._emulated = false;\n\t\tthis._pose = null;\n\t\tthis._position = new Vec3();\n\t\tthis._rotation = new Quat();\n\t\tthis._image = image;\n\t\tthis._width = width;\n\t}\n\tget image() {\n\t\treturn this._image;\n\t}\n\tset width(value) {\n\t\tthis._width = value;\n\t}\n\tget width() {\n\t\treturn this._width;\n\t}\n\tget trackable() {\n\t\treturn this._trackable;\n\t}\n\tget tracking() {\n\t\treturn this._tracking;\n\t}\n\tget emulated() {\n\t\treturn this._emulated;\n\t}\n\tprepare() {\n\t\tif (this._bitmap) {\n\t\t\treturn {\n\t\t\t\timage: this._bitmap,\n\t\t\t\twidthInMeters: this._width\n\t\t\t};\n\t\t}\n\t\treturn createImageBitmap(this._image).then(bitmap => {\n\t\t\tthis._bitmap = bitmap;\n\t\t\treturn {\n\t\t\t\timage: this._bitmap,\n\t\t\t\twidthInMeters: this._width\n\t\t\t};\n\t\t});\n\t}\n\tdestroy() {\n\t\tthis._image = null;\n\t\tthis._pose = null;\n\t\tif (this._bitmap) {\n\t\t\tthis._bitmap.close();\n\t\t\tthis._bitmap = null;\n\t\t}\n\t}\n\tgetPosition() {\n\t\tif (this._pose) this._position.copy(this._pose.transform.position);\n\t\treturn this._position;\n\t}\n\tgetRotation() {\n\t\tif (this._pose) this._rotation.copy(this._pose.transform.orientation);\n\t\treturn this._rotation;\n\t}\n}\n\nexport { XrTrackedImage };\n","import { EventHandler } from '../../core/event-handler.js';\nimport { platform } from '../../core/platform.js';\nimport { XrTrackedImage } from './xr-tracked-image.js';\n\nclass XrImageTracking extends EventHandler {\n\tconstructor(manager) {\n\t\tsuper();\n\t\tthis._manager = void 0;\n\t\tthis._supported = platform.browser && !!window.XRImageTrackingResult;\n\t\tthis._available = false;\n\t\tthis._images = [];\n\t\tthis._manager = manager;\n\t\tif (this._supported) {\n\t\t\tthis._manager.on('start', this._onSessionStart, this);\n\t\t\tthis._manager.on('end', this._onSessionEnd, this);\n\t\t}\n\t}\n\tadd(image, width) {\n\t\tif (!this._supported || this._manager.active) return null;\n\t\tconst trackedImage = new XrTrackedImage(image, width);\n\t\tthis._images.push(trackedImage);\n\t\treturn trackedImage;\n\t}\n\tremove(trackedImage) {\n\t\tif (this._manager.active) return;\n\t\tconst ind = this._images.indexOf(trackedImage);\n\t\tif (ind !== -1) {\n\t\t\ttrackedImage.destroy();\n\t\t\tthis._images.splice(ind, 1);\n\t\t}\n\t}\n\t_onSessionStart() {\n\t\tthis._manager.session.getTrackedImageScores().then(images => {\n\t\t\tthis._available = true;\n\t\t\tfor (let i = 0; i < images.length; i++) {\n\t\t\t\tthis._images[i]._trackable = images[i] === 'trackable';\n\t\t\t}\n\t\t}).catch(err => {\n\t\t\tthis._available = false;\n\t\t\tthis.fire('error', err);\n\t\t});\n\t}\n\t_onSessionEnd() {\n\t\tthis._available = false;\n\t\tfor (let i = 0; i < this._images.length; i++) {\n\t\t\tconst image = this._images[i];\n\t\t\timage._pose = null;\n\t\t\timage._measuredWidth = 0;\n\t\t\tif (image._tracking) {\n\t\t\t\timage._tracking = false;\n\t\t\t\timage.fire('untracked');\n\t\t\t}\n\t\t}\n\t}\n\tprepareImages(callback) {\n\t\tif (this._images.length) {\n\t\t\tPromise.all(this._images.map(function (trackedImage) {\n\t\t\t\treturn trackedImage.prepare();\n\t\t\t})).then(function (bitmaps) {\n\t\t\t\tcallback(null, bitmaps);\n\t\t\t}).catch(function (err) {\n\t\t\t\tcallback(err, null);\n\t\t\t});\n\t\t} else {\n\t\t\tcallback(null, null);\n\t\t}\n\t}\n\tupdate(frame) {\n\t\tif (!this._available) return;\n\t\tconst results = frame.getImageTrackingResults();\n\t\tconst index = {};\n\t\tfor (let i = 0; i < results.length; i++) {\n\t\t\tindex[results[i].index] = results[i];\n\t\t\tconst trackedImage = this._images[results[i].index];\n\t\t\ttrackedImage._emulated = results[i].trackingState === 'emulated';\n\t\t\ttrackedImage._measuredWidth = results[i].measuredWidthInMeters;\n\t\t\ttrackedImage._pose = frame.getPose(results[i].imageSpace, this._manager._referenceSpace);\n\t\t}\n\t\tfor (let i = 0; i < this._images.length; i++) {\n\t\t\tif (this._images[i]._tracking && !index[i]) {\n\t\t\t\tthis._images[i]._tracking = false;\n\t\t\t\tthis._images[i].fire('untracked');\n\t\t\t} else if (!this._images[i]._tracking && index[i]) {\n\t\t\t\tthis._images[i]._tracking = true;\n\t\t\t\tthis._images[i].fire('tracked');\n\t\t\t}\n\t\t}\n\t}\n\tget supported() {\n\t\treturn this._supported;\n\t}\n\tget available() {\n\t\treturn this._available;\n\t}\n\tget images() {\n\t\treturn this._images;\n\t}\n}\n\nexport { XrImageTracking };\n","class XrFinger {\n\tconstructor(index, hand) {\n\t\tthis._index = void 0;\n\t\tthis._hand = void 0;\n\t\tthis._joints = [];\n\t\tthis._tip = null;\n\t\tthis._index = index;\n\t\tthis._hand = hand;\n\t\tthis._hand._fingers.push(this);\n\t}\n\tget index() {\n\t\treturn this._index;\n\t}\n\tget hand() {\n\t\treturn this._hand;\n\t}\n\tget joints() {\n\t\treturn this._joints;\n\t}\n\tget tip() {\n\t\treturn this._tip;\n\t}\n}\n\nexport { XrFinger };\n","import { platform } from '../../core/platform.js';\nimport { Mat4 } from '../../core/math/mat4.js';\nimport { Quat } from '../../core/math/quat.js';\nimport { Vec3 } from '../../core/math/vec3.js';\n\nconst tipJointIds = platform.browser && window.XRHand ? ['thumb-tip', 'index-finger-tip', 'middle-finger-tip', 'ring-finger-tip', 'pinky-finger-tip'] : [];\nconst tipJointIdsIndex = {};\nfor (let i = 0; i < tipJointIds.length; i++) {\n\ttipJointIdsIndex[tipJointIds[i]] = true;\n}\nclass XrJoint {\n\tconstructor(index, id, hand, finger = null) {\n\t\tthis._index = void 0;\n\t\tthis._id = void 0;\n\t\tthis._hand = void 0;\n\t\tthis._finger = void 0;\n\t\tthis._wrist = void 0;\n\t\tthis._tip = void 0;\n\t\tthis._radius = null;\n\t\tthis._localTransform = new Mat4();\n\t\tthis._worldTransform = new Mat4();\n\t\tthis._localPosition = new Vec3();\n\t\tthis._localRotation = new Quat();\n\t\tthis._position = new Vec3();\n\t\tthis._rotation = new Quat();\n\t\tthis._dirtyLocal = true;\n\t\tthis._index = index;\n\t\tthis._id = id;\n\t\tthis._hand = hand;\n\t\tthis._finger = finger;\n\t\tthis._wrist = id === 'wrist';\n\t\tthis._tip = this._finger && !!tipJointIdsIndex[id];\n\t}\n\tupdate(pose) {\n\t\tthis._dirtyLocal = true;\n\t\tthis._radius = pose.radius;\n\t\tthis._localPosition.copy(pose.transform.position);\n\t\tthis._localRotation.copy(pose.transform.orientation);\n\t}\n\t_updateTransforms() {\n\t\tif (this._dirtyLocal) {\n\t\t\tthis._dirtyLocal = false;\n\t\t\tthis._localTransform.setTRS(this._localPosition, this._localRotation, Vec3.ONE);\n\t\t}\n\t\tconst manager = this._hand._manager;\n\t\tconst parent = manager.camera.parent;\n\t\tif (parent) {\n\t\t\tthis._worldTransform.mul2(parent.getWorldTransform(), this._localTransform);\n\t\t} else {\n\t\t\tthis._worldTransform.copy(this._localTransform);\n\t\t}\n\t}\n\tgetPosition() {\n\t\tthis._updateTransforms();\n\t\tthis._worldTransform.getTranslation(this._position);\n\t\treturn this._position;\n\t}\n\tgetRotation() {\n\t\tthis._updateTransforms();\n\t\tthis._rotation.setFromMat4(this._worldTransform);\n\t\treturn this._rotation;\n\t}\n\tget index() {\n\t\treturn this._index;\n\t}\n\tget hand() {\n\t\treturn this._hand;\n\t}\n\tget finger() {\n\t\treturn this._finger;\n\t}\n\tget wrist() {\n\t\treturn this._wrist;\n\t}\n\tget tip() {\n\t\treturn this._tip;\n\t}\n\tget radius() {\n\t\treturn this._radius || 0.005;\n\t}\n}\n\nexport { XrJoint };\n","import { EventHandler } from '../../core/event-handler.js';\nimport { platform } from '../../core/platform.js';\nimport { Vec3 } from '../../core/math/vec3.js';\nimport { XRHAND_LEFT } from './constants.js';\nimport { XrFinger } from './xr-finger.js';\nimport { XrJoint } from './xr-joint.js';\n\nlet fingerJointIds = [];\nconst vecA = new Vec3();\nconst vecB = new Vec3();\nconst vecC = new Vec3();\nif (platform.browser && window.XRHand) {\n\tfingerJointIds = [['thumb-metacarpal', 'thumb-phalanx-proximal', 'thumb-phalanx-distal', 'thumb-tip'], ['index-finger-metacarpal', 'index-finger-phalanx-proximal', 'index-finger-phalanx-intermediate', 'index-finger-phalanx-distal', 'index-finger-tip'], ['middle-finger-metacarpal', 'middle-finger-phalanx-proximal', 'middle-finger-phalanx-intermediate', 'middle-finger-phalanx-distal', 'middle-finger-tip'], ['ring-finger-metacarpal', 'ring-finger-phalanx-proximal', 'ring-finger-phalanx-intermediate', 'ring-finger-phalanx-distal', 'ring-finger-tip'], ['pinky-finger-metacarpal', 'pinky-finger-phalanx-proximal', 'pinky-finger-phalanx-intermediate', 'pinky-finger-phalanx-distal', 'pinky-finger-tip']];\n}\nclass XrHand extends EventHandler {\n\tconstructor(inputSource) {\n\t\tsuper();\n\t\tthis._manager = void 0;\n\t\tthis._inputSource = void 0;\n\t\tthis._tracking = false;\n\t\tthis._fingers = [];\n\t\tthis._joints = [];\n\t\tthis._jointsById = {};\n\t\tthis._tips = [];\n\t\tthis._wrist = null;\n\t\tconst xrHand = inputSource._xrInputSource.hand;\n\t\tthis._manager = inputSource._manager;\n\t\tthis._inputSource = inputSource;\n\t\tif (xrHand.get('wrist')) {\n\t\t\tconst joint = new XrJoint(0, 'wrist', this, null);\n\t\t\tthis._wrist = joint;\n\t\t\tthis._joints.push(joint);\n\t\t\tthis._jointsById.wrist = joint;\n\t\t}\n\t\tfor (let f = 0; f < fingerJointIds.length; f++) {\n\t\t\tconst finger = new XrFinger(f, this);\n\t\t\tfor (let j = 0; j < fingerJointIds[f].length; j++) {\n\t\t\t\tconst jointId = fingerJointIds[f][j];\n\t\t\t\tif (!xrHand.get(jointId)) continue;\n\t\t\t\tconst joint = new XrJoint(j, jointId, this, finger);\n\t\t\t\tthis._joints.push(joint);\n\t\t\t\tthis._jointsById[jointId] = joint;\n\t\t\t\tif (joint.tip) {\n\t\t\t\t\tthis._tips.push(joint);\n\t\t\t\t\tfinger._tip = joint;\n\t\t\t\t}\n\t\t\t\tfinger._joints.push(joint);\n\t\t\t}\n\t\t}\n\t}\n\tupdate(frame) {\n\t\tconst xrInputSource = this._inputSource._xrInputSource;\n\t\tfor (let j = 0; j < this._joints.length; j++) {\n\t\t\tconst joint = this._joints[j];\n\t\t\tconst jointSpace = xrInputSource.hand.get(joint._id);\n\t\t\tif (jointSpace) {\n\t\t\t\tlet pose;\n\t\t\t\tif (frame.session.visibilityState !== 'hidden') pose = frame.getJointPose(jointSpace, this._manager._referenceSpace);\n\t\t\t\tif (pose) {\n\t\t\t\t\tjoint.update(pose);\n\t\t\t\t\tif (joint.wrist && !this._tracking) {\n\t\t\t\t\t\tthis._tracking = true;\n\t\t\t\t\t\tthis.fire('tracking');\n\t\t\t\t\t}\n\t\t\t\t} else if (joint.wrist) {\n\t\t\t\t\tif (this._tracking) {\n\t\t\t\t\t\tthis._tracking = false;\n\t\t\t\t\t\tthis.fire('trackinglost');\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst j1 = this._jointsById['thumb-metacarpal'];\n\t\tconst j4 = this._jointsById['thumb-tip'];\n\t\tconst j6 = this._jointsById['index-finger-phalanx-proximal'];\n\t\tconst j9 = this._jointsById['index-finger-tip'];\n\t\tconst j16 = this._jointsById['ring-finger-phalanx-proximal'];\n\t\tconst j21 = this._jointsById['pinky-finger-phalanx-proximal'];\n\t\tif (j1 && j4 && j6 && j9 && j16 && j21) {\n\t\t\tthis._inputSource._dirtyRay = true;\n\t\t\tthis._inputSource._rayLocal.origin.lerp(j4._localPosition, j9._localPosition, 0.5);\n\t\t\tlet jointL = j1;\n\t\t\tlet jointR = j21;\n\t\t\tif (this._inputSource.handedness === XRHAND_LEFT) {\n\t\t\t\tconst t = jointL;\n\t\t\t\tjointL = jointR;\n\t\t\t\tjointR = t;\n\t\t\t}\n\t\t\tvecA.sub2(jointL._localPosition, this._wrist._localPosition);\n\t\t\tvecB.sub2(jointR._localPosition, this._wrist._localPosition);\n\t\t\tvecC.cross(vecA, vecB).normalize();\n\t\t\tvecA.lerp(j6._localPosition, j16._localPosition, 0.5);\n\t\t\tvecA.sub(this._wrist._localPosition).normalize();\n\t\t\tthis._inputSource._rayLocal.direction.lerp(vecC, vecA, 0.5).normalize();\n\t\t}\n\t\tconst squeezing = this._fingerIsClosed(1) && this._fingerIsClosed(2) && this._fingerIsClosed(3) && this._fingerIsClosed(4);\n\t\tif (squeezing) {\n\t\t\tif (!this._inputSource._squeezing) {\n\t\t\t\tthis._inputSource._squeezing = true;\n\t\t\t\tthis._inputSource.fire('squeezestart');\n\t\t\t\tthis._manager.input.fire('squeezestart', this._inputSource);\n\t\t\t}\n\t\t} else {\n\t\t\tif (this._inputSource._squeezing) {\n\t\t\t\tthis._inputSource._squeezing = false;\n\t\t\t\tthis._inputSource.fire('squeeze');\n\t\t\t\tthis._manager.input.fire('squeeze', this._inputSource);\n\t\t\t\tthis._inputSource.fire('squeezeend');\n\t\t\t\tthis._manager.input.fire('squeezeend', this._inputSource);\n\t\t\t}\n\t\t}\n\t}\n\t_fingerIsClosed(index) {\n\t\tconst finger = this._fingers[index];\n\t\tvecA.sub2(finger.joints[0]._localPosition, finger.joints[1]._localPosition).normalize();\n\t\tvecB.sub2(finger.joints[2]._localPosition, finger.joints[3]._localPosition).normalize();\n\t\treturn vecA.dot(vecB) < -0.8;\n\t}\n\tgetJointById(id) {\n\t\treturn this._jointsById[id] || null;\n\t}\n\tget fingers() {\n\t\treturn this._fingers;\n\t}\n\tget joints() {\n\t\treturn this._joints;\n\t}\n\tget tips() {\n\t\treturn this._tips;\n\t}\n\tget wrist() {\n\t\treturn this._wrist;\n\t}\n\tget tracking() {\n\t\treturn this._tracking;\n\t}\n}\n\nexport { XrHand };\n","import { EventHandler } from '../../core/event-handler.js';\nimport { Mat4 } from '../../core/math/mat4.js';\nimport { Quat } from '../../core/math/quat.js';\nimport { Vec3 } from '../../core/math/vec3.js';\nimport { Ray } from '../../core/shape/ray.js';\nimport { XrHand } from './xr-hand.js';\n\nconst quat = new Quat();\nlet ids = 0;\nclass XrInputSource extends EventHandler {\n\tconstructor(manager, xrInputSource) {\n\t\tsuper();\n\t\tthis._id = void 0;\n\t\tthis._manager = void 0;\n\t\tthis._xrInputSource = void 0;\n\t\tthis._ray = new Ray();\n\t\tthis._rayLocal = new Ray();\n\t\tthis._grip = false;\n\t\tthis._hand = null;\n\t\tthis._localTransform = null;\n\t\tthis._worldTransform = null;\n\t\tthis._position = new Vec3();\n\t\tthis._rotation = new Quat();\n\t\tthis._localPosition = null;\n\t\tthis._localRotation = null;\n\t\tthis._dirtyLocal = true;\n\t\tthis._dirtyRay = false;\n\t\tthis._selecting = false;\n\t\tthis._squeezing = false;\n\t\tthis._elementInput = true;\n\t\tthis._elementEntity = null;\n\t\tthis._hitTestSources = [];\n\t\tthis.hitTestSourcesSet = new Set();\n\t\tthis._id = ++ids;\n\t\tthis._manager = manager;\n\t\tthis._xrInputSource = xrInputSource;\n\t\tif (xrInputSource.hand) this._hand = new XrHand(this);\n\t}\n\tget id() {\n\t\treturn this._id;\n\t}\n\tget inputSource() {\n\t\treturn this._xrInputSource;\n\t}\n\tget targetRayMode() {\n\t\treturn this._xrInputSource.targetRayMode;\n\t}\n\tget handedness() {\n\t\treturn this._xrInputSource.handedness;\n\t}\n\tget profiles() {\n\t\treturn this._xrInputSource.profiles;\n\t}\n\tget grip() {\n\t\treturn this._grip;\n\t}\n\tget hand() {\n\t\treturn this._hand;\n\t}\n\tget gamepad() {\n\t\treturn this._xrInputSource.gamepad || null;\n\t}\n\tget selecting() {\n\t\treturn this._selecting;\n\t}\n\tget squeezing() {\n\t\treturn this._squeezing;\n\t}\n\tset elementInput(value) {\n\t\tif (this._elementInput === value) return;\n\t\tthis._elementInput = value;\n\t\tif (!this._elementInput) this._elementEntity = null;\n\t}\n\tget elementInput() {\n\t\treturn this._elementInput;\n\t}\n\tget elementEntity() {\n\t\treturn this._elementEntity;\n\t}\n\tget hitTestSources() {\n\t\treturn this._hitTestSources;\n\t}\n\tupdate(frame) {\n\t\tif (this._hand) {\n\t\t\tthis._hand.update(frame);\n\t\t} else {\n\t\t\tif (this._xrInputSource.gripSpace) {\n\t\t\t\tconst gripPose = frame.getPose(this._xrInputSource.gripSpace, this._manager._referenceSpace);\n\t\t\t\tif (gripPose) {\n\t\t\t\t\tif (!this._grip) {\n\t\t\t\t\t\tthis._grip = true;\n\t\t\t\t\t\tthis._localTransform = new Mat4();\n\t\t\t\t\t\tthis._worldTransform = new Mat4();\n\t\t\t\t\t\tthis._localPosition = new Vec3();\n\t\t\t\t\t\tthis._localRotation = new Quat();\n\t\t\t\t\t}\n\t\t\t\t\tthis._dirtyLocal = true;\n\t\t\t\t\tthis._localPosition.copy(gripPose.transform.position);\n\t\t\t\t\tthis._localRotation.copy(gripPose.transform.orientation);\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst targetRayPose = frame.getPose(this._xrInputSource.targetRaySpace, this._manager._referenceSpace);\n\t\t\tif (targetRayPose) {\n\t\t\t\tthis._dirtyRay = true;\n\t\t\t\tthis._rayLocal.origin.copy(targetRayPose.transform.position);\n\t\t\t\tthis._rayLocal.direction.set(0, 0, -1);\n\t\t\t\tquat.copy(targetRayPose.transform.orientation);\n\t\t\t\tquat.transformVector(this._rayLocal.direction, this._rayLocal.direction);\n\t\t\t}\n\t\t}\n\t}\n\t_updateTransforms() {\n\t\tif (this._dirtyLocal) {\n\t\t\tthis._dirtyLocal = false;\n\t\t\tthis._localTransform.setTRS(this._localPosition, this._localRotation, Vec3.ONE);\n\t\t}\n\t\tconst parent = this._manager.camera.parent;\n\t\tif (parent) {\n\t\t\tthis._worldTransform.mul2(parent.getWorldTransform(), this._localTransform);\n\t\t} else {\n\t\t\tthis._worldTransform.copy(this._localTransform);\n\t\t}\n\t}\n\t_updateRayTransforms() {\n\t\tconst dirty = this._dirtyRay;\n\t\tthis._dirtyRay = false;\n\t\tconst parent = this._manager.camera.parent;\n\t\tif (parent) {\n\t\t\tconst parentTransform = this._manager.camera.parent.getWorldTransform();\n\t\t\tparentTransform.getTranslation(this._position);\n\t\t\tthis._rotation.setFromMat4(parentTransform);\n\t\t\tthis._rotation.transformVector(this._rayLocal.origin, this._ray.origin);\n\t\t\tthis._ray.origin.add(this._position);\n\t\t\tthis._rotation.transformVector(this._rayLocal.direction, this._ray.direction);\n\t\t} else if (dirty) {\n\t\t\tthis._ray.origin.copy(this._rayLocal.origin);\n\t\t\tthis._ray.direction.copy(this._rayLocal.direction);\n\t\t}\n\t}\n\tgetPosition() {\n\t\tif (!this._position) return null;\n\t\tthis._updateTransforms();\n\t\tthis._worldTransform.getTranslation(this._position);\n\t\treturn this._position;\n\t}\n\tgetLocalPosition() {\n\t\treturn this._localPosition;\n\t}\n\tgetRotation() {\n\t\tif (!this._rotation) return null;\n\t\tthis._updateTransforms();\n\t\tthis._rotation.setFromMat4(this._worldTransform);\n\t\treturn this._rotation;\n\t}\n\tgetLocalRotation() {\n\t\treturn this._localRotation;\n\t}\n\tgetOrigin() {\n\t\tthis._updateRayTransforms();\n\t\treturn this._ray.origin;\n\t}\n\tgetDirection() {\n\t\tthis._updateRayTransforms();\n\t\treturn this._ray.direction;\n\t}\n\thitTestStart(options = {}) {\n\t\toptions.profile = this._xrInputSource.profiles[0];\n\t\tconst callback = options.callback;\n\t\toptions.callback = (err, hitTestSource) => {\n\t\t\tif (hitTestSource) this.onHitTestSourceAdd(hitTestSource);\n\t\t\tif (callback) callback(err, hitTestSource);\n\t\t};\n\t\tthis._manager.hitTest.start(options);\n\t}\n\tonHitTestSourceAdd(hitTestSource) {\n\t\tthis.hitTestSourcesSet.add(hitTestSource);\n\t\tthis._hitTestSources.push(hitTestSource);\n\t\tthis.fire('hittest:add', hitTestSource);\n\t\thitTestSource.on('result', function (position, rotation, inputSource) {\n\t\t\tif (inputSource !== this) return;\n\t\t\tthis.fire('hittest:result', hitTestSource, position, rotation);\n\t\t}, this);\n\t\thitTestSource.once('remove', function () {\n\t\t\tthis.onHitTestSourceRemove(hitTestSource);\n\t\t\tthis.fire('hittest:remove', hitTestSource);\n\t\t}, this);\n\t}\n\tonHitTestSourceRemove(hitTestSource) {\n\t\tthis.hitTestSourcesSet.delete(hitTestSource);\n\t\tconst ind = this._hitTestSources.indexOf(hitTestSource);\n\t\tif (ind !== -1) this._hitTestSources.splice(ind, 1);\n\t}\n}\n\nexport { XrInputSource };\n","import { EventHandler } from '../../core/event-handler.js';\nimport { XrInputSource } from './xr-input-source.js';\n\nclass XrInput extends EventHandler {\n\tconstructor(manager) {\n\t\tsuper();\n\t\tthis.manager = void 0;\n\t\tthis._inputSources = [];\n\t\tthis._onInputSourcesChangeEvt = void 0;\n\t\tthis.manager = manager;\n\t\tthis._onInputSourcesChangeEvt = evt => {\n\t\t\tthis._onInputSourcesChange(evt);\n\t\t};\n\t\tthis.manager.on('start', this._onSessionStart, this);\n\t\tthis.manager.on('end', this._onSessionEnd, this);\n\t}\n\t_onSessionStart() {\n\t\tconst session = this.manager.session;\n\t\tsession.addEventListener('inputsourceschange', this._onInputSourcesChangeEvt);\n\t\tsession.addEventListener('select', evt => {\n\t\t\tconst inputSource = this._getByInputSource(evt.inputSource);\n\t\t\tinputSource.update(evt.frame);\n\t\t\tinputSource.fire('select', evt);\n\t\t\tthis.fire('select', inputSource, evt);\n\t\t});\n\t\tsession.addEventListener('selectstart', evt => {\n\t\t\tconst inputSource = this._getByInputSource(evt.inputSource);\n\t\t\tinputSource.update(evt.frame);\n\t\t\tinputSource._selecting = true;\n\t\t\tinputSource.fire('selectstart', evt);\n\t\t\tthis.fire('selectstart', inputSource, evt);\n\t\t});\n\t\tsession.addEventListener('selectend', evt => {\n\t\t\tconst inputSource = this._getByInputSource(evt.inputSource);\n\t\t\tinputSource.update(evt.frame);\n\t\t\tinputSource._selecting = false;\n\t\t\tinputSource.fire('selectend', evt);\n\t\t\tthis.fire('selectend', inputSource, evt);\n\t\t});\n\t\tsession.addEventListener('squeeze', evt => {\n\t\t\tconst inputSource = this._getByInputSource(evt.inputSource);\n\t\t\tinputSource.update(evt.frame);\n\t\t\tinputSource.fire('squeeze', evt);\n\t\t\tthis.fire('squeeze', inputSource, evt);\n\t\t});\n\t\tsession.addEventListener('squeezestart', evt => {\n\t\t\tconst inputSource = this._getByInputSource(evt.inputSource);\n\t\t\tinputSource.update(evt.frame);\n\t\t\tinputSource._squeezing = true;\n\t\t\tinputSource.fire('squeezestart', evt);\n\t\t\tthis.fire('squeezestart', inputSource, evt);\n\t\t});\n\t\tsession.addEventListener('squeezeend', evt => {\n\t\t\tconst inputSource = this._getByInputSource(evt.inputSource);\n\t\t\tinputSource.update(evt.frame);\n\t\t\tinputSource._squeezing = false;\n\t\t\tinputSource.fire('squeezeend', evt);\n\t\t\tthis.fire('squeezeend', inputSource, evt);\n\t\t});\n\t\tconst inputSources = session.inputSources;\n\t\tfor (let i = 0; i < inputSources.length; i++) {\n\t\t\tthis._addInputSource(inputSources[i]);\n\t\t}\n\t}\n\t_onSessionEnd() {\n\t\tlet i = this._inputSources.length;\n\t\twhile (i--) {\n\t\t\tconst inputSource = this._inputSources[i];\n\t\t\tthis._inputSources.splice(i, 1);\n\t\t\tinputSource.fire('remove');\n\t\t\tthis.fire('remove', inputSource);\n\t\t}\n\t\tconst session = this.manager.session;\n\t\tsession.removeEventListener('inputsourceschange', this._onInputSourcesChangeEvt);\n\t}\n\t_onInputSourcesChange(evt) {\n\t\tfor (let i = 0; i < evt.removed.length; i++) {\n\t\t\tthis._removeInputSource(evt.removed[i]);\n\t\t}\n\t\tfor (let i = 0; i < evt.added.length; i++) {\n\t\t\tthis._addInputSource(evt.added[i]);\n\t\t}\n\t}\n\t_getByInputSource(xrInputSource) {\n\t\tfor (let i = 0; i < this._inputSources.length; i++) {\n\t\t\tif (this._inputSources[i].inputSource === xrInputSource) {\n\t\t\t\treturn this._inputSources[i];\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\t_addInputSource(xrInputSource) {\n\t\tif (this._getByInputSource(xrInputSource)) return;\n\t\tconst inputSource = new XrInputSource(this.manager, xrInputSource);\n\t\tthis._inputSources.push(inputSource);\n\t\tthis.fire('add', inputSource);\n\t}\n\t_removeInputSource(xrInputSource) {\n\t\tfor (let i = 0; i < this._inputSources.length; i++) {\n\t\t\tif (this._inputSources[i].inputSource !== xrInputSource) continue;\n\t\t\tconst inputSource = this._inputSources[i];\n\t\t\tthis._inputSources.splice(i, 1);\n\t\t\tlet h = inputSource.hitTestSources.length;\n\t\t\twhile (h--) {\n\t\t\t\tinputSource.hitTestSources[h].remove();\n\t\t\t}\n\t\t\tinputSource.fire('remove');\n\t\t\tthis.fire('remove', inputSource);\n\t\t\treturn;\n\t\t}\n\t}\n\tupdate(frame) {\n\t\tfor (let i = 0; i < this._inputSources.length; i++) {\n\t\t\tthis._inputSources[i].update(frame);\n\t\t}\n\t}\n\tget inputSources() {\n\t\treturn this._inputSources;\n\t}\n}\n\nexport { XrInput };\n","import { EventHandler } from '../../core/event-handler.js';\nimport { Color } from '../../core/math/color.js';\nimport { Mat4 } from '../../core/math/mat4.js';\nimport { Quat } from '../../core/math/quat.js';\nimport { Vec3 } from '../../core/math/vec3.js';\nimport { XRTYPE_AR } from './constants.js';\n\nconst vec3A = new Vec3();\nconst vec3B = new Vec3();\nconst mat4A = new Mat4();\nconst mat4B = new Mat4();\nclass XrLightEstimation extends EventHandler {\n\tconstructor(manager) {\n\t\tsuper();\n\t\tthis._manager = void 0;\n\t\tthis._supported = false;\n\t\tthis._available = false;\n\t\tthis._lightProbeRequested = false;\n\t\tthis._lightProbe = null;\n\t\tthis._intensity = 0;\n\t\tthis._rotation = new Quat();\n\t\tthis._color = new Color();\n\t\tthis._sphericalHarmonics = new Float32Array(27);\n\t\tthis._manager = manager;\n\t\tthis._manager.on('start', this._onSessionStart, this);\n\t\tthis._manager.on('end', this._onSessionEnd, this);\n\t}\n\t_onSessionStart() {\n\t\tconst supported = !!this._manager.session.requestLightProbe;\n\t\tif (!supported) return;\n\t\tthis._supported = true;\n\t}\n\t_onSessionEnd() {\n\t\tthis._supported = false;\n\t\tthis._available = false;\n\t\tthis._lightProbeRequested = false;\n\t\tthis._lightProbe = null;\n\t}\n\tstart() {\n\t\tlet err;\n\t\tif (!this._manager.session) err = new Error('XR session is not running');\n\t\tif (!err && this._manager.type !== XRTYPE_AR) err = new Error('XR session type is not AR');\n\t\tif (!err && !this._supported) err = new Error('light-estimation is not supported');\n\t\tif (!err && this._lightProbe || this._lightProbeRequested) err = new Error('light estimation is already requested');\n\t\tif (err) {\n\t\t\tthis.fire('error', err);\n\t\t\treturn;\n\t\t}\n\t\tthis._lightProbeRequested = true;\n\t\tthis._manager.session.requestLightProbe().then(lightProbe => {\n\t\t\tconst wasRequested = this._lightProbeRequested;\n\t\t\tthis._lightProbeRequested = false;\n\t\t\tif (this._manager.active) {\n\t\t\t\tif (wasRequested) {\n\t\t\t\t\tthis._lightProbe = lightProbe;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.fire('error', new Error('XR session is not active'));\n\t\t\t}\n\t\t}).catch(ex => {\n\t\t\tthis._lightProbeRequested = false;\n\t\t\tthis.fire('error', ex);\n\t\t});\n\t}\n\tend() {\n\t\tthis._lightProbeRequested = false;\n\t\tthis._lightProbe = null;\n\t\tthis._available = false;\n\t}\n\tupdate(frame) {\n\t\tif (!this._lightProbe) return;\n\t\tconst lightEstimate = frame.getLightEstimate(this._lightProbe);\n\t\tif (!lightEstimate) return;\n\t\tif (!this._available) {\n\t\t\tthis._available = true;\n\t\t\tthis.fire('available');\n\t\t}\n\t\tconst pli = lightEstimate.primaryLightIntensity;\n\t\tthis._intensity = Math.max(1.0, Math.max(pli.x, Math.max(pli.y, pli.z)));\n\t\tvec3A.copy(pli).mulScalar(1 / this._intensity);\n\t\tthis._color.set(vec3A.x, vec3A.y, vec3A.z);\n\t\tvec3A.set(0, 0, 0);\n\t\tvec3B.copy(lightEstimate.primaryLightDirection);\n\t\tmat4A.setLookAt(vec3B, vec3A, Vec3.UP);\n\t\tmat4B.setFromAxisAngle(Vec3.RIGHT, 90);\n\t\tmat4A.mul(mat4B);\n\t\tthis._rotation.setFromMat4(mat4A);\n\t\tthis._sphericalHarmonics.set(lightEstimate.sphericalHarmonicsCoefficients);\n\t}\n\tget supported() {\n\t\treturn this._supported;\n\t}\n\tget available() {\n\t\treturn this._available;\n\t}\n\tget intensity() {\n\t\treturn this._available ? this._intensity : null;\n\t}\n\tget color() {\n\t\treturn this._available ? this._color : null;\n\t}\n\tget rotation() {\n\t\treturn this._available ? this._rotation : null;\n\t}\n\tget sphericalHarmonics() {\n\t\treturn this._available ? this._sphericalHarmonics : null;\n\t}\n}\n\nexport { XrLightEstimation };\n","import { EventHandler } from '../../core/event-handler.js';\nimport { Quat } from '../../core/math/quat.js';\nimport { Vec3 } from '../../core/math/vec3.js';\n\nlet ids = 0;\nclass XrPlane extends EventHandler {\n\tconstructor(planeDetection, xrPlane) {\n\t\tsuper();\n\t\tthis._id = void 0;\n\t\tthis._planeDetection = void 0;\n\t\tthis._xrPlane = void 0;\n\t\tthis._lastChangedTime = void 0;\n\t\tthis._orientation = void 0;\n\t\tthis._position = new Vec3();\n\t\tthis._rotation = new Quat();\n\t\tthis._id = ++ids;\n\t\tthis._planeDetection = planeDetection;\n\t\tthis._xrPlane = xrPlane;\n\t\tthis._lastChangedTime = xrPlane.lastChangedTime;\n\t\tthis._orientation = xrPlane.orientation;\n\t}\n\tdestroy() {\n\t\tif (!this._xrPlane) return;\n\t\tthis._xrPlane = null;\n\t\tthis.fire('remove');\n\t}\n\tupdate(frame) {\n\t\tconst manager = this._planeDetection._manager;\n\t\tconst pose = frame.getPose(this._xrPlane.planeSpace, manager._referenceSpace);\n\t\tif (pose) {\n\t\t\tthis._position.copy(pose.transform.position);\n\t\t\tthis._rotation.copy(pose.transform.orientation);\n\t\t}\n\t\tif (this._lastChangedTime !== this._xrPlane.lastChangedTime) {\n\t\t\tthis._lastChangedTime = this._xrPlane.lastChangedTime;\n\t\t\tthis.fire('change');\n\t\t}\n\t}\n\tgetPosition() {\n\t\treturn this._position;\n\t}\n\tgetRotation() {\n\t\treturn this._rotation;\n\t}\n\tget id() {\n\t\treturn this._id;\n\t}\n\tget orientation() {\n\t\treturn this._orientation;\n\t}\n\tget points() {\n\t\treturn this._xrPlane.polygon;\n\t}\n\tget label() {\n\t\treturn this._xrPlane.semanticLabel || '';\n\t}\n}\n\nexport { XrPlane };\n","import { platform } from '../../core/platform.js';\nimport { EventHandler } from '../../core/event-handler.js';\nimport { XrPlane } from './xr-plane.js';\n\nclass XrPlaneDetection extends EventHandler {\n\tconstructor(manager) {\n\t\tsuper();\n\t\tthis._manager = void 0;\n\t\tthis._supported = platform.browser && !!window.XRPlane;\n\t\tthis._available = false;\n\t\tthis._planesIndex = new Map();\n\t\tthis._planes = [];\n\t\tthis._manager = manager;\n\t\tif (this._supported) {\n\t\t\tthis._manager.on('start', this._onSessionStart, this);\n\t\t\tthis._manager.on('end', this._onSessionEnd, this);\n\t\t}\n\t}\n\t_onSessionStart() {\n\t\tconst available = this._supported && this._manager.session.enabledFeatures.indexOf('plane-detection') !== -1;\n\t\tif (available) {\n\t\t\tthis._available = true;\n\t\t\tthis.fire('available');\n\t\t}\n\t}\n\t_onSessionEnd() {\n\t\tfor (let i = 0; i < this._planes.length; i++) {\n\t\t\tthis._planes[i].destroy();\n\t\t\tthis.fire('remove', this._planes[i]);\n\t\t}\n\t\tthis._planesIndex.clear();\n\t\tthis._planes.length = 0;\n\t\tif (this._available) {\n\t\t\tthis._available = false;\n\t\t\tthis.fire('unavailable');\n\t\t}\n\t}\n\tupdate(frame) {\n\t\tif (!this._supported || !this._available) return;\n\t\tconst detectedPlanes = frame.detectedPlanes;\n\t\tfor (const [xrPlane, plane] of this._planesIndex) {\n\t\t\tif (detectedPlanes.has(xrPlane)) continue;\n\t\t\tthis._planesIndex.delete(xrPlane);\n\t\t\tthis._planes.splice(this._planes.indexOf(plane), 1);\n\t\t\tplane.destroy();\n\t\t\tthis.fire('remove', plane);\n\t\t}\n\t\tfor (const xrPlane of detectedPlanes) {\n\t\t\tlet plane = this._planesIndex.get(xrPlane);\n\t\t\tif (!plane) {\n\t\t\t\tplane = new XrPlane(this, xrPlane);\n\t\t\t\tthis._planesIndex.set(xrPlane, plane);\n\t\t\t\tthis._planes.push(plane);\n\t\t\t\tplane.update(frame);\n\t\t\t\tthis.fire('add', plane);\n\t\t\t} else {\n\t\t\t\tplane.update(frame);\n\t\t\t}\n\t\t}\n\t}\n\tget supported() {\n\t\treturn this._supported;\n\t}\n\tget available() {\n\t\treturn this._available;\n\t}\n\tget planes() {\n\t\treturn this._planes;\n\t}\n}\n\nexport { XrPlaneDetection };\n","import { EventHandler } from '../../core/event-handler.js';\nimport { Vec3 } from '../../core/math/vec3.js';\nimport { Quat } from '../../core/math/quat.js';\n\nclass XrAnchor extends EventHandler {\n\tconstructor(anchors, xrAnchor, uuid = null) {\n\t\tsuper();\n\t\tthis._position = new Vec3();\n\t\tthis._rotation = new Quat();\n\t\tthis._uuid = null;\n\t\tthis._uuidRequests = null;\n\t\tthis._anchors = anchors;\n\t\tthis._xrAnchor = xrAnchor;\n\t\tthis._uuid = uuid;\n\t}\n\tdestroy() {\n\t\tif (!this._xrAnchor) return;\n\t\tconst xrAnchor = this._xrAnchor;\n\t\tthis._xrAnchor.delete();\n\t\tthis._xrAnchor = null;\n\t\tthis.fire('destroy', xrAnchor, this);\n\t}\n\tupdate(frame) {\n\t\tif (!this._xrAnchor) return;\n\t\tconst pose = frame.getPose(this._xrAnchor.anchorSpace, this._anchors.manager._referenceSpace);\n\t\tif (pose) {\n\t\t\tif (this._position.equals(pose.transform.position) && this._rotation.equals(pose.transform.orientation)) return;\n\t\t\tthis._position.copy(pose.transform.position);\n\t\t\tthis._rotation.copy(pose.transform.orientation);\n\t\t\tthis.fire('change');\n\t\t}\n\t}\n\tgetPosition() {\n\t\treturn this._position;\n\t}\n\tgetRotation() {\n\t\treturn this._rotation;\n\t}\n\tpersist(callback) {\n\t\tif (!this._anchors.persistence) {\n\t\t\tcallback == null || callback(new Error('Persistent Anchors are not supported'), null);\n\t\t\treturn;\n\t\t}\n\t\tif (this._uuid) {\n\t\t\tcallback == null || callback(null, this._uuid);\n\t\t\treturn;\n\t\t}\n\t\tif (this._uuidRequests) {\n\t\t\tif (callback) this._uuidRequests.push(callback);\n\t\t\treturn;\n\t\t}\n\t\tthis._uuidRequests = [];\n\t\tthis._xrAnchor.requestPersistentHandle().then(uuid => {\n\t\t\tthis._uuid = uuid;\n\t\t\tthis._anchors._indexByUuid.set(this._uuid, this);\n\t\t\tcallback == null || callback(null, uuid);\n\t\t\tfor (let i = 0; i < this._uuidRequests.length; i++) {\n\t\t\t\tthis._uuidRequests[i](null, uuid);\n\t\t\t}\n\t\t\tthis._uuidRequests = null;\n\t\t\tthis.fire('persist', uuid);\n\t\t}).catch(ex => {\n\t\t\tcallback == null || callback(ex, null);\n\t\t\tfor (let i = 0; i < this._uuidRequests.length; i++) {\n\t\t\t\tthis._uuidRequests[i](ex);\n\t\t\t}\n\t\t\tthis._uuidRequests = null;\n\t\t});\n\t}\n\tforget(callback) {\n\t\tif (!this._uuid) {\n\t\t\tcallback == null || callback(new Error('Anchor is not persistent'));\n\t\t\treturn;\n\t\t}\n\t\tthis._anchors.forget(this._uuid, ex => {\n\t\t\tthis._uuid = null;\n\t\t\tcallback == null || callback(ex);\n\t\t\tthis.fire('forget');\n\t\t});\n\t}\n\tget uuid() {\n\t\treturn this._uuid;\n\t}\n\tget persistent() {\n\t\treturn !!this._uuid;\n\t}\n}\n\nexport { XrAnchor };\n","import { EventHandler } from '../../core/event-handler.js';\nimport { platform } from '../../core/platform.js';\nimport { XrAnchor } from './xr-anchor.js';\n\nclass XrAnchors extends EventHandler {\n\tconstructor(manager) {\n\t\tvar _window;\n\t\tsuper();\n\t\tthis._supported = platform.browser && !!window.XRAnchor;\n\t\tthis._persistence = platform.browser && !!((_window = window) != null && (_window = _window.XRSession) != null && _window.prototype.restorePersistentAnchor);\n\t\tthis._creationQueue = [];\n\t\tthis._index = new Map();\n\t\tthis._indexByUuid = new Map();\n\t\tthis._list = [];\n\t\tthis._callbacksAnchors = new Map();\n\t\tthis.manager = manager;\n\t\tif (this._supported) {\n\t\t\tthis.manager.on('end', this._onSessionEnd, this);\n\t\t}\n\t}\n\t_onSessionEnd() {\n\t\tfor (let _i = 0; _i < this._creationQueue.length; _i++) {\n\t\t\tif (!this._creationQueue[_i].callback) continue;\n\t\t\tthis._creationQueue[_i].callback(new Error('session ended'), null);\n\t\t}\n\t\tthis._creationQueue.length = 0;\n\t\tthis._index.clear();\n\t\tthis._indexByUuid.clear();\n\t\tlet i = this._list.length;\n\t\twhile (i--) {\n\t\t\tthis._list[i].destroy();\n\t\t}\n\t\tthis._list.length = 0;\n\t}\n\t_createAnchor(xrAnchor, uuid = null) {\n\t\tconst anchor = new XrAnchor(this, xrAnchor, uuid);\n\t\tthis._index.set(xrAnchor, anchor);\n\t\tif (uuid) this._indexByUuid.set(uuid, anchor);\n\t\tthis._list.push(anchor);\n\t\tanchor.once('destroy', this._onAnchorDestroy, this);\n\t\treturn anchor;\n\t}\n\t_onAnchorDestroy(xrAnchor, anchor) {\n\t\tthis._index.delete(xrAnchor);\n\t\tif (anchor.uuid) this._indexByUuid.delete(anchor.uuid);\n\t\tconst ind = this._list.indexOf(anchor);\n\t\tif (ind !== -1) this._list.splice(ind, 1);\n\t\tthis.fire('destroy', anchor);\n\t}\n\tcreate(position, rotation, callback) {\n\t\tif (window.XRHitTestResult && position instanceof XRHitTestResult) {\n\t\t\tconst hitResult = position;\n\t\t\tcallback = rotation;\n\t\t\tif (!this._supported) {\n\t\t\t\tcallback == null || callback(new Error('Anchors API is not supported'), null);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!hitResult.createAnchor) {\n\t\t\t\tcallback == null || callback(new Error('Creating Anchor from Hit Test is not supported'), null);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\thitResult.createAnchor().then(xrAnchor => {\n\t\t\t\tconst anchor = this._createAnchor(xrAnchor);\n\t\t\t\tcallback == null || callback(null, anchor);\n\t\t\t\tthis.fire('add', anchor);\n\t\t\t}).catch(ex => {\n\t\t\t\tcallback == null || callback(ex, null);\n\t\t\t\tthis.fire('error', ex);\n\t\t\t});\n\t\t} else {\n\t\t\tthis._creationQueue.push({\n\t\t\t\ttransform: new XRRigidTransform(position, rotation),\n\t\t\t\tcallback: callback\n\t\t\t});\n\t\t}\n\t}\n\trestore(uuid, callback) {\n\t\tif (!this._persistence) {\n\t\t\tcallback == null || callback(new Error('Anchor Persistence is not supported'), null);\n\t\t\treturn;\n\t\t}\n\t\tif (!this.manager.active) {\n\t\t\tcallback == null || callback(new Error('WebXR session is not active'), null);\n\t\t\treturn;\n\t\t}\n\t\tthis.manager.session.restorePersistentAnchor(uuid).then(xrAnchor => {\n\t\t\tconst anchor = this._createAnchor(xrAnchor, uuid);\n\t\t\tcallback == null || callback(null, anchor);\n\t\t\tthis.fire('add', anchor);\n\t\t}).catch(ex => {\n\t\t\tcallback == null || callback(ex, null);\n\t\t\tthis.fire('error', ex);\n\t\t});\n\t}\n\tforget(uuid, callback) {\n\t\tif (!this._persistence) {\n\t\t\tcallback == null || callback(new Error('Anchor Persistence is not supported'));\n\t\t\treturn;\n\t\t}\n\t\tif (!this.manager.active) {\n\t\t\tcallback == null || callback(new Error('WebXR session is not active'));\n\t\t\treturn;\n\t\t}\n\t\tthis.manager.session.deletePersistentAnchor(uuid).then(() => {\n\t\t\tcallback == null || callback(null);\n\t\t}).catch(ex => {\n\t\t\tcallback == null || callback(ex);\n\t\t\tthis.fire('error', ex);\n\t\t});\n\t}\n\tupdate(frame) {\n\t\tif (this._creationQueue.length) {\n\t\t\tfor (let i = 0; i < this._creationQueue.length; i++) {\n\t\t\t\tconst request = this._creationQueue[i];\n\t\t\t\tframe.createAnchor(request.transform, this.manager._referenceSpace).then(xrAnchor => {\n\t\t\t\t\tif (request.callback) this._callbacksAnchors.set(xrAnchor, request.callback);\n\t\t\t\t}).catch(ex => {\n\t\t\t\t\tif (request.callback) request.callback(ex, null);\n\t\t\t\t\tthis.fire('error', ex);\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis._creationQueue.length = 0;\n\t\t}\n\t\tfor (const [xrAnchor, anchor] of this._index) {\n\t\t\tif (frame.trackedAnchors.has(xrAnchor)) continue;\n\t\t\tthis._index.delete(xrAnchor);\n\t\t\tanchor.destroy();\n\t\t}\n\t\tfor (let i = 0; i < this._list.length; i++) {\n\t\t\tthis._list[i].update(frame);\n\t\t}\n\t\tfor (const xrAnchor of frame.trackedAnchors) {\n\t\t\tif (this._index.has(xrAnchor)) continue;\n\t\t\ttry {\n\t\t\t\tconst tmp = xrAnchor.anchorSpace;\n\t\t\t} catch (ex) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst anchor = this._createAnchor(xrAnchor);\n\t\t\tanchor.update(frame);\n\t\t\tconst callback = this._callbacksAnchors.get(xrAnchor);\n\t\t\tif (callback) {\n\t\t\t\tthis._callbacksAnchors.delete(xrAnchor);\n\t\t\t\tcallback(null, anchor);\n\t\t\t}\n\t\t\tthis.fire('add', anchor);\n\t\t}\n\t}\n\tget supported() {\n\t\treturn this._supported;\n\t}\n\tget persistence() {\n\t\treturn this._persistence;\n\t}\n\tget uuids() {\n\t\tif (!this._persistence) return null;\n\t\tif (!this.manager.active) return null;\n\t\treturn this.manager.session.persistentAnchors;\n\t}\n\tget list() {\n\t\treturn this._list;\n\t}\n}\n\nexport { XrAnchors };\n","import '../../core/tracing.js';\nimport { EventHandler } from '../../core/event-handler.js';\nimport { platform } from '../../core/platform.js';\nimport { Mat3 } from '../../core/math/mat3.js';\nimport { Mat4 } from '../../core/math/mat4.js';\nimport { Quat } from '../../core/math/quat.js';\nimport { Vec3 } from '../../core/math/vec3.js';\nimport { Vec4 } from '../../core/math/vec4.js';\nimport { XRTYPE_INLINE, XRTYPE_VR, XRTYPE_AR, XRDEPTHSENSINGUSAGE_CPU, XRDEPTHSENSINGFORMAT_L8A8 } from './constants.js';\nimport { XrDepthSensing } from './xr-depth-sensing.js';\nimport { XrDomOverlay } from './xr-dom-overlay.js';\nimport { XrHitTest } from './xr-hit-test.js';\nimport { XrImageTracking } from './xr-image-tracking.js';\nimport { XrInput } from './xr-input.js';\nimport { XrLightEstimation } from './xr-light-estimation.js';\nimport { XrPlaneDetection } from './xr-plane-detection.js';\nimport { XrAnchors } from './xr-anchors.js';\n\nclass XrManager extends EventHandler {\n\tconstructor(app) {\n\t\tsuper();\n\t\tthis.app = void 0;\n\t\tthis._supported = platform.browser && !!navigator.xr;\n\t\tthis._available = {};\n\t\tthis._type = null;\n\t\tthis._spaceType = null;\n\t\tthis._session = null;\n\t\tthis._baseLayer = null;\n\t\tthis._referenceSpace = null;\n\t\tthis.depthSensing = void 0;\n\t\tthis.domOverlay = void 0;\n\t\tthis.hitTest = void 0;\n\t\tthis.imageTracking = void 0;\n\t\tthis.planeDetection = void 0;\n\t\tthis.input = void 0;\n\t\tthis.lightEstimation = void 0;\n\t\tthis.anchors = void 0;\n\t\tthis._camera = null;\n\t\tthis.views = [];\n\t\tthis.viewsPool = [];\n\t\tthis._localPosition = new Vec3();\n\t\tthis._localRotation = new Quat();\n\t\tthis._depthNear = 0.1;\n\t\tthis._depthFar = 1000;\n\t\tthis._width = 0;\n\t\tthis._height = 0;\n\t\tthis.app = app;\n\t\tthis._available[XRTYPE_INLINE] = false;\n\t\tthis._available[XRTYPE_VR] = false;\n\t\tthis._available[XRTYPE_AR] = false;\n\t\tthis.depthSensing = new XrDepthSensing(this);\n\t\tthis.domOverlay = new XrDomOverlay(this);\n\t\tthis.hitTest = new XrHitTest(this);\n\t\tthis.imageTracking = new XrImageTracking(this);\n\t\tthis.planeDetection = new XrPlaneDetection(this);\n\t\tthis.input = new XrInput(this);\n\t\tthis.lightEstimation = new XrLightEstimation(this);\n\t\tthis.anchors = new XrAnchors(this);\n\t\tif (this._supported) {\n\t\t\tnavigator.xr.addEventListener('devicechange', () => {\n\t\t\t\tthis._deviceAvailabilityCheck();\n\t\t\t});\n\t\t\tthis._deviceAvailabilityCheck();\n\t\t}\n\t}\n\tdestroy() {\n\t\tthis.depthSensing.destroy();\n\t\tthis.depthSensing = null;\n\t}\n\tstart(camera, type, spaceType, options) {\n\t\tlet callback = options;\n\t\tif (typeof options === 'object') callback = options.callback;\n\t\tif (!this._available[type]) {\n\t\t\tif (callback) callback(new Error('XR is not available'));\n\t\t\treturn;\n\t\t}\n\t\tif (this._session) {\n\t\t\tif (callback) callback(new Error('XR session is already started'));\n\t\t\treturn;\n\t\t}\n\t\tthis._camera = camera;\n\t\tthis._camera.camera.xr = this;\n\t\tthis._type = type;\n\t\tthis._spaceType = spaceType;\n\t\tthis._setClipPlanes(camera.nearClip, camera.farClip);\n\t\tconst opts = {\n\t\t\trequiredFeatures: [spaceType],\n\t\t\toptionalFeatures: []\n\t\t};\n\t\tif (type === XRTYPE_AR) {\n\t\t\topts.optionalFeatures.push('light-estimation');\n\t\t\topts.optionalFeatures.push('hit-test');\n\t\t\tif (options) {\n\t\t\t\tif (options.imageTracking && this.imageTracking.supported) opts.optionalFeatures.push('image-tracking');\n\t\t\t\tif (options.planeDetection) opts.optionalFeatures.push('plane-detection');\n\t\t\t}\n\t\t\tif (this.domOverlay.supported && this.domOverlay.root) {\n\t\t\t\topts.optionalFeatures.push('dom-overlay');\n\t\t\t\topts.domOverlay = {\n\t\t\t\t\troot: this.domOverlay.root\n\t\t\t\t};\n\t\t\t}\n\t\t\tif (options && options.anchors && this.anchors.supported) {\n\t\t\t\topts.optionalFeatures.push('anchors');\n\t\t\t}\n\t\t\tif (options && options.depthSensing && this.depthSensing.supported) {\n\t\t\t\topts.optionalFeatures.push('depth-sensing');\n\t\t\t\tconst usagePreference = [XRDEPTHSENSINGUSAGE_CPU];\n\t\t\t\tconst dataFormatPreference = [XRDEPTHSENSINGFORMAT_L8A8];\n\t\t\t\tif (options.depthSensing.usagePreference) {\n\t\t\t\t\tconst ind = usagePreference.indexOf(options.depthSensing.usagePreference);\n\t\t\t\t\tif (ind !== -1) usagePreference.splice(ind, 1);\n\t\t\t\t\tusagePreference.unshift(options.depthSensing.usagePreference);\n\t\t\t\t}\n\t\t\t\tif (options.depthSensing.dataFormatPreference) {\n\t\t\t\t\tconst ind = dataFormatPreference.indexOf(options.depthSensing.dataFormatPreference);\n\t\t\t\t\tif (ind !== -1) dataFormatPreference.splice(ind, 1);\n\t\t\t\t\tdataFormatPreference.unshift(options.depthSensing.dataFormatPreference);\n\t\t\t\t}\n\t\t\t\topts.depthSensing = {\n\t\t\t\t\tusagePreference: usagePreference,\n\t\t\t\t\tdataFormatPreference: dataFormatPreference\n\t\t\t\t};\n\t\t\t}\n\t\t} else if (type === XRTYPE_VR) {\n\t\t\topts.optionalFeatures.push('hand-tracking');\n\t\t}\n\t\tif (options && options.optionalFeatures) opts.optionalFeatures = opts.optionalFeatures.concat(options.optionalFeatures);\n\t\tif (this.imageTracking.supported && this.imageTracking.images.length) {\n\t\t\tthis.imageTracking.prepareImages((err, trackedImages) => {\n\t\t\t\tif (err) {\n\t\t\t\t\tif (callback) callback(err);\n\t\t\t\t\tthis.fire('error', err);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (trackedImages !== null) opts.trackedImages = trackedImages;\n\t\t\t\tthis._onStartOptionsReady(type, spaceType, opts, callback);\n\t\t\t});\n\t\t} else {\n\t\t\tthis._onStartOptionsReady(type, spaceType, opts, callback);\n\t\t}\n\t}\n\t_onStartOptionsReady(type, spaceType, options, callback) {\n\t\tnavigator.xr.requestSession(type, options).then(session => {\n\t\t\tthis._onSessionStart(session, spaceType, callback);\n\t\t}).catch(ex => {\n\t\t\tthis._camera.camera.xr = null;\n\t\t\tthis._camera = null;\n\t\t\tthis._type = null;\n\t\t\tthis._spaceType = null;\n\t\t\tif (callback) callback(ex);\n\t\t\tthis.fire('error', ex);\n\t\t});\n\t}\n\tend(callback) {\n\t\tif (!this._session) {\n\t\t\tif (callback) callback(new Error('XR Session is not initialized'));\n\t\t\treturn;\n\t\t}\n\t\tif (callback) this.once('end', callback);\n\t\tthis._session.end();\n\t}\n\tisAvailable(type) {\n\t\treturn this._available[type];\n\t}\n\t_deviceAvailabilityCheck() {\n\t\tfor (const key in this._available) {\n\t\t\tthis._sessionSupportCheck(key);\n\t\t}\n\t}\n\tinitiateRoomCapture(callback) {\n\t\tif (!this._session) {\n\t\t\tcallback(new Error('Session is not active'));\n\t\t\treturn;\n\t\t}\n\t\tif (!this._session.initiateRoomCapture) {\n\t\t\tcallback(new Error('Session does not support manual room capture'));\n\t\t\treturn;\n\t\t}\n\t\tthis._session.initiateRoomCapture().then(() => {\n\t\t\tif (callback) callback(null);\n\t\t}).catch(err => {\n\t\t\tif (callback) callback(err);\n\t\t});\n\t}\n\t_sessionSupportCheck(type) {\n\t\tnavigator.xr.isSessionSupported(type).then(available => {\n\t\t\tif (this._available[type] === available) return;\n\t\t\tthis._available[type] = available;\n\t\t\tthis.fire('available', type, available);\n\t\t\tthis.fire('available:' + type, available);\n\t\t}).catch(ex => {\n\t\t\tthis.fire('error', ex);\n\t\t});\n\t}\n\t_onSessionStart(session, spaceType, callback) {\n\t\tlet failed = false;\n\t\tthis._session = session;\n\t\tconst onVisibilityChange = () => {\n\t\t\tthis.fire('visibility:change', session.visibilityState);\n\t\t};\n\t\tconst onClipPlanesChange = () => {\n\t\t\tthis._setClipPlanes(this._camera.nearClip, this._camera.farClip);\n\t\t};\n\t\tconst onEnd = () => {\n\t\t\tif (this._camera) {\n\t\t\t\tthis._camera.off('set_nearClip', onClipPlanesChange);\n\t\t\t\tthis._camera.off('set_farClip', onClipPlanesChange);\n\t\t\t\tthis._camera.camera.xr = null;\n\t\t\t\tthis._camera = null;\n\t\t\t}\n\t\t\tsession.removeEventListener('end', onEnd);\n\t\t\tsession.removeEventListener('visibilitychange', onVisibilityChange);\n\t\t\tif (!failed) this.fire('end');\n\t\t\tthis._session = null;\n\t\t\tthis._referenceSpace = null;\n\t\t\tthis.views = [];\n\t\t\tthis._width = 0;\n\t\t\tthis._height = 0;\n\t\t\tthis._type = null;\n\t\t\tthis._spaceType = null;\n\t\t\tthis.app.tick();\n\t\t};\n\t\tsession.addEventListener('end', onEnd);\n\t\tsession.addEventListener('visibilitychange', onVisibilityChange);\n\t\tthis._camera.on('set_nearClip', onClipPlanesChange);\n\t\tthis._camera.on('set_farClip', onClipPlanesChange);\n\t\tconst framebufferScaleFactor = this.app.graphicsDevice.maxPixelRatio / window.devicePixelRatio;\n\t\tthis._baseLayer = new XRWebGLLayer(session, this.app.graphicsDevice.gl, {\n\t\t\talpha: true,\n\t\t\tdepth: true,\n\t\t\tstencil: true,\n\t\t\tframebufferScaleFactor: framebufferScaleFactor,\n\t\t\tantialias: false\n\t\t});\n\t\tsession.updateRenderState({\n\t\t\tbaseLayer: this._baseLayer,\n\t\t\tdepthNear: this._depthNear,\n\t\t\tdepthFar: this._depthFar\n\t\t});\n\t\tsession.requestReferenceSpace(spaceType).then(referenceSpace => {\n\t\t\tthis._referenceSpace = referenceSpace;\n\t\t\tthis.app.tick();\n\t\t\tif (callback) callback(null);\n\t\t\tthis.fire('start');\n\t\t}).catch(ex => {\n\t\t\tfailed = true;\n\t\t\tsession.end();\n\t\t\tif (callback) callback(ex);\n\t\t\tthis.fire('error', ex);\n\t\t});\n\t}\n\t_setClipPlanes(near, far) {\n\t\tif (this._depthNear === near && this._depthFar === far) return;\n\t\tthis._depthNear = near;\n\t\tthis._depthFar = far;\n\t\tif (!this._session) return;\n\t\tthis._session.updateRenderState({\n\t\t\tdepthNear: this._depthNear,\n\t\t\tdepthFar: this._depthFar\n\t\t});\n\t}\n\tupdate(frame) {\n\t\tif (!this._session) return false;\n\t\tconst width = frame.session.renderState.baseLayer.framebufferWidth;\n\t\tconst height = frame.session.renderState.baseLayer.framebufferHeight;\n\t\tif (this._width !== width || this._height !== height) {\n\t\t\tthis._width = width;\n\t\t\tthis._height = height;\n\t\t\tthis.app.graphicsDevice.setResolution(width, height);\n\t\t}\n\t\tconst pose = frame.getViewerPose(this._referenceSpace);\n\t\tif (!pose) return false;\n\t\tconst lengthOld = this.views.length;\n\t\tconst lengthNew = pose.views.length;\n\t\twhile (lengthNew > this.views.length) {\n\t\t\tlet view = this.viewsPool.pop();\n\t\t\tif (!view) {\n\t\t\t\tview = {\n\t\t\t\t\tviewport: new Vec4(),\n\t\t\t\t\tprojMat: new Mat4(),\n\t\t\t\t\tviewMat: new Mat4(),\n\t\t\t\t\tviewOffMat: new Mat4(),\n\t\t\t\t\tviewInvMat: new Mat4(),\n\t\t\t\t\tviewInvOffMat: new Mat4(),\n\t\t\t\t\tprojViewOffMat: new Mat4(),\n\t\t\t\t\tviewMat3: new Mat3(),\n\t\t\t\t\tposition: new Float32Array(3),\n\t\t\t\t\trotation: new Quat()\n\t\t\t\t};\n\t\t\t}\n\t\t\tthis.views.push(view);\n\t\t}\n\t\twhile (lengthNew < this.views.length) {\n\t\t\tthis.viewsPool.push(this.views.pop());\n\t\t}\n\t\tconst posePosition = pose.transform.position;\n\t\tconst poseOrientation = pose.transform.orientation;\n\t\tthis._localPosition.set(posePosition.x, posePosition.y, posePosition.z);\n\t\tthis._localRotation.set(poseOrientation.x, poseOrientation.y, poseOrientation.z, poseOrientation.w);\n\t\tconst layer = frame.session.renderState.baseLayer;\n\t\tfor (let i = 0; i < pose.views.length; i++) {\n\t\t\tconst viewRaw = pose.views[i];\n\t\t\tconst view = this.views[i];\n\t\t\tconst viewport = layer.getViewport(viewRaw);\n\t\t\tview.viewport.x = viewport.x;\n\t\t\tview.viewport.y = viewport.y;\n\t\t\tview.viewport.z = viewport.width;\n\t\t\tview.viewport.w = viewport.height;\n\t\t\tview.projMat.set(viewRaw.projectionMatrix);\n\t\t\tview.viewMat.set(viewRaw.transform.inverse.matrix);\n\t\t\tview.viewInvMat.set(viewRaw.transform.matrix);\n\t\t}\n\t\tif (lengthOld === 0 && this.views.length > 0) {\n\t\t\tconst viewProjMat = new Mat4();\n\t\t\tconst view = this.views[0];\n\t\t\tviewProjMat.copy(view.projMat);\n\t\t\tconst data = viewProjMat.data;\n\t\t\tconst fov = 2.0 * Math.atan(1.0 / data[5]) * 180.0 / Math.PI;\n\t\t\tconst aspectRatio = data[5] / data[0];\n\t\t\tconst farClip = data[14] / (data[10] + 1);\n\t\t\tconst nearClip = data[14] / (data[10] - 1);\n\t\t\tconst horizontalFov = false;\n\t\t\tconst camera = this._camera.camera;\n\t\t\tcamera.setXrProperties({\n\t\t\t\taspectRatio,\n\t\t\t\tfarClip,\n\t\t\t\tfov,\n\t\t\t\thorizontalFov,\n\t\t\t\tnearClip\n\t\t\t});\n\t\t}\n\t\tthis._camera.camera._node.setLocalPosition(this._localPosition);\n\t\tthis._camera.camera._node.setLocalRotation(this._localRotation);\n\t\tthis.input.update(frame);\n\t\tif (this._type === XRTYPE_AR) {\n\t\t\tif (this.hitTest.supported) this.hitTest.update(frame);\n\t\t\tif (this.lightEstimation.supported) this.lightEstimation.update(frame);\n\t\t\tif (this.depthSensing.supported) this.depthSensing.update(frame, pose && pose.views[0]);\n\t\t\tif (this.imageTracking.supported) this.imageTracking.update(frame);\n\t\t\tif (this.anchors.supported) this.anchors.update(frame);\n\t\t\tif (this.planeDetection.supported) this.planeDetection.update(frame);\n\t\t}\n\t\tthis.fire('update', frame);\n\t\treturn true;\n\t}\n\tget supported() {\n\t\treturn this._supported;\n\t}\n\tget active() {\n\t\treturn !!this._session;\n\t}\n\tget type() {\n\t\treturn this._type;\n\t}\n\tget spaceType() {\n\t\treturn this._spaceType;\n\t}\n\tget session() {\n\t\treturn this._session;\n\t}\n\tget camera() {\n\t\treturn this._camera ? this._camera.entity : null;\n\t}\n\tget visibilityState() {\n\t\tif (!this._session) return null;\n\t\treturn this._session.visibilityState;\n\t}\n}\n\nexport { XrManager };\n","import { platform } from '../core/platform.js';\nimport { WebglGraphicsDevice } from '../platform/graphics/webgl/webgl-graphics-device.js';\nimport { SoundManager } from '../platform/sound/manager.js';\nimport { Lightmapper } from './lightmapper/lightmapper.js';\nimport { BatchManager } from '../scene/batching/batch-manager.js';\nimport { AppBase } from './app-base.js';\nimport { AppOptions } from './app-options.js';\nimport { script } from './script.js';\nimport { AnimationComponentSystem } from './components/animation/system.js';\nimport { AnimComponentSystem } from './components/anim/system.js';\nimport { AudioListenerComponentSystem } from './components/audio-listener/system.js';\nimport { AudioSourceComponentSystem } from './components/audio-source/system.js';\nimport { ButtonComponentSystem } from './components/button/system.js';\nimport { CollisionComponentSystem } from './components/collision/system.js';\nimport { ElementComponentSystem } from './components/element/system.js';\nimport { JointComponentSystem } from './components/joint/system.js';\nimport { LayoutChildComponentSystem } from './components/layout-child/system.js';\nimport { LayoutGroupComponentSystem } from './components/layout-group/system.js';\nimport { ModelComponentSystem } from './components/model/system.js';\nimport { ParticleSystemComponentSystem } from './components/particle-system/system.js';\nimport { RenderComponentSystem } from './components/render/system.js';\nimport { RigidBodyComponentSystem } from './components/rigid-body/system.js';\nimport { ScreenComponentSystem } from './components/screen/system.js';\nimport { ScriptLegacyComponentSystem } from './components/script-legacy/system.js';\nimport { ScrollViewComponentSystem } from './components/scroll-view/system.js';\nimport { ScrollbarComponentSystem } from './components/scrollbar/system.js';\nimport { SoundComponentSystem } from './components/sound/system.js';\nimport { SpriteComponentSystem } from './components/sprite/system.js';\nimport { ZoneComponentSystem } from './components/zone/system.js';\nimport { CameraComponentSystem } from './components/camera/system.js';\nimport { LightComponentSystem } from './components/light/system.js';\nimport { ScriptComponentSystem } from './components/script/system.js';\nimport { RenderHandler } from './handlers/render.js';\nimport { AnimationHandler } from './handlers/animation.js';\nimport { AnimClipHandler } from './handlers/anim-clip.js';\nimport { AnimStateGraphHandler } from './handlers/anim-state-graph.js';\nimport { AudioHandler } from './handlers/audio.js';\nimport { BinaryHandler } from './handlers/binary.js';\nimport { ContainerHandler } from './handlers/container.js';\nimport { CssHandler } from './handlers/css.js';\nimport { CubemapHandler } from './handlers/cubemap.js';\nimport { FolderHandler } from './handlers/folder.js';\nimport { FontHandler } from './handlers/font.js';\nimport { HierarchyHandler } from './handlers/hierarchy.js';\nimport { HtmlHandler } from './handlers/html.js';\nimport { JsonHandler } from './handlers/json.js';\nimport { MaterialHandler } from './handlers/material.js';\nimport { ModelHandler } from './handlers/model.js';\nimport { SceneHandler } from './handlers/scene.js';\nimport { ScriptHandler } from './handlers/script.js';\nimport { ShaderHandler } from './handlers/shader.js';\nimport { SpriteHandler } from './handlers/sprite.js';\nimport { TemplateHandler } from './handlers/template.js';\nimport { TextHandler } from './handlers/text.js';\nimport { TextureAtlasHandler } from './handlers/texture-atlas.js';\nimport { TextureHandler } from './handlers/texture.js';\nimport { XrManager } from './xr/xr-manager.js';\n\nclass Application extends AppBase {\n\tconstructor(canvas, options = {}) {\n\t\tsuper(canvas);\n\t\tconst appOptions = new AppOptions();\n\t\tappOptions.graphicsDevice = this.createDevice(canvas, options);\n\t\tthis.addComponentSystems(appOptions);\n\t\tthis.addResourceHandles(appOptions);\n\t\tappOptions.elementInput = options.elementInput;\n\t\tappOptions.keyboard = options.keyboard;\n\t\tappOptions.mouse = options.mouse;\n\t\tappOptions.touch = options.touch;\n\t\tappOptions.gamepads = options.gamepads;\n\t\tappOptions.scriptPrefix = options.scriptPrefix;\n\t\tappOptions.assetPrefix = options.assetPrefix;\n\t\tappOptions.scriptsOrder = options.scriptsOrder;\n\t\tappOptions.soundManager = new SoundManager();\n\t\tappOptions.lightmapper = Lightmapper;\n\t\tappOptions.batchManager = BatchManager;\n\t\tappOptions.xr = XrManager;\n\t\tthis.init(appOptions);\n\t}\n\tcreateDevice(canvas, options) {\n\t\tif (!options.graphicsDeviceOptions) {\n\t\t\toptions.graphicsDeviceOptions = {};\n\t\t}\n\t\tif (platform.browser && !!navigator.xr) {\n\t\t\toptions.graphicsDeviceOptions.xrCompatible = true;\n\t\t}\n\t\toptions.graphicsDeviceOptions.alpha = options.graphicsDeviceOptions.alpha || false;\n\t\treturn new WebglGraphicsDevice(canvas, options.graphicsDeviceOptions);\n\t}\n\taddComponentSystems(appOptions) {\n\t\tappOptions.componentSystems = [RigidBodyComponentSystem, CollisionComponentSystem, JointComponentSystem, AnimationComponentSystem, AnimComponentSystem, ModelComponentSystem, RenderComponentSystem, CameraComponentSystem, LightComponentSystem, script.legacy ? ScriptLegacyComponentSystem : ScriptComponentSystem, AudioSourceComponentSystem, SoundComponentSystem, AudioListenerComponentSystem, ParticleSystemComponentSystem, ScreenComponentSystem, ElementComponentSystem, ButtonComponentSystem, ScrollViewComponentSystem, ScrollbarComponentSystem, SpriteComponentSystem, LayoutGroupComponentSystem, LayoutChildComponentSystem, ZoneComponentSystem];\n\t}\n\taddResourceHandles(appOptions) {\n\t\tappOptions.resourceHandlers = [RenderHandler, AnimationHandler, AnimClipHandler, AnimStateGraphHandler, ModelHandler, MaterialHandler, TextureHandler, TextHandler, JsonHandler, AudioHandler, ScriptHandler, SceneHandler, CubemapHandler, HtmlHandler, CssHandler, ShaderHandler, HierarchyHandler, FolderHandler, FontHandler, BinaryHandler, TextureAtlasHandler, SpriteHandler, TemplateHandler, ContainerHandler];\n\t}\n}\n\nexport { Application };\n","import * as pc from 'playcanvas';\r\n\r\n// create a PlayCanvas application\r\nconst canvas = document.createElement('canvas');\r\ndocument.body.append(canvas);\r\nconst app = new pc.Application(canvas);\r\n\r\n// fill the available space at full resolution\r\napp.setCanvasFillMode(pc.FILLMODE_FILL_WINDOW);\r\napp.setCanvasResolution(pc.RESOLUTION_AUTO);\r\n\r\n// ensure canvas is resized when window changes size\r\nwindow.addEventListener('resize', () => app.resizeCanvas());\r\n\r\n// create box entity\r\nconst box = new pc.Entity('cube');\r\nbox.addComponent('model', {\r\n  type: 'box',\r\n});\r\napp.root.addChild(box);\r\n\r\n// create camera entity\r\nconst camera = new pc.Entity('camera');\r\ncamera.addComponent('camera', {\r\n  clearColor: new pc.Color(0.1, 0.1, 0.1),\r\n});\r\napp.root.addChild(camera);\r\ncamera.setPosition(0, 0, 3);\r\n\r\n// create directional light entity\r\nconst light = new pc.Entity('light');\r\nlight.addComponent('light');\r\napp.root.addChild(light);\r\nlight.setEulerAngles(45, 0, 0);\r\n\r\n// rotate the box according to the delta time since the last frame\r\napp.on('update', (dt) => box.rotate(10 * dt, 20 * dt, 30 * dt));\r\n\r\napp.start();\r\n"],"names":["glErrorShadow","error","msg","log","synthesizeGLError","err","opt_msg","wrapGLError","gl","f","WebGLVertexArrayObjectOES","ext","n","attrib","OESVertexArrayObject","self","original","pname","index","vao","target","buffer","indx","size","type","normalized","stride","offset","contextWasLost","ii","arrayObject","oldVAO","newVAO","currentBinding","maxAttrib","oldAttrib","bufferChanged","setupVertexArrayObject","exts","original_getSupportedExtensions","list","original_getExtension","name","TRACEID_GPU_TIMINGS","version","revision","_typeLookup","result","names","i","obj","extend","ex","prop","copy","Tracing","channel","enabled","EventHandle","handler","callback","scope","once","value","EventHandler","callbackActive","evt","key","callbacks","arg1","arg2","arg3","arg4","arg5","arg6","arg7","arg8","callbacksInitial","existingCallback","ind","_callbacks","_this$_callbacks$get","events","ev","guid","c","r","path","num","one","two","pathname","lead","trail","parts","cleaned","lastDelimiterIndex","detectPassiveEvents","opts","ua","environment","platformName","browserName","xbox","touch","gamepads","workers","passiveEvents","platform","ASCII_LOWERCASE","ASCII_UPPERCASE","ASCII_LETTERS","HIGH_SURROGATE_BEGIN","HIGH_SURROGATE_END","LOW_SURROGATE_BEGIN","LOW_SURROGATE_END","ZERO_WIDTH_JOINER","REGIONAL_INDICATOR_BEGIN","REGIONAL_INDICATOR_END","FITZPATRICK_MODIFIER_BEGIN","FITZPATRICK_MODIFIER_END","DIACRITICAL_MARKS_BEGIN","DIACRITICAL_MARKS_END","VARIATION_MODIFIER_BEGIN","VARIATION_MODIFIER_END","getCodePointData","string","first","second","isCodeBetween","begin","end","codeData","code","numCharsToTakeForNextSymbol","s","args","codePointData","arr","codePoint","length","output","take","ch","char","chars","current","units","IndexedList","item","location","idx","cachedResult","func","uninitToken","Impl","url","moduleName","config","loadUrl","module","instance","WasmModule","_Impl$modules","ReadStream","arraybuffer","bytes","amount","numChars","view","SortedLoopArray","left","right","search","middle","a","b","sortBy","Tags","parent","changed","tags","multiple","t","flat","tmp","now","re","URI","uri","queryParams","queryParam","pair","params","q","CURVE_LINEAR","CURVE_SMOOTHSTEP","CURVE_CATMULL","CURVE_CARDINAL","CURVE_SPLINE","CURVE_STEP","math","min","max","g","alpha","x","val","diff","numToRound","inclusive","_class","Color","cstr","rhs","lhs","hex","CurveEvaluator","curve","time","forceReset","keys","len","d","s1_","s2_","s1","s2","a_","d_","tension","p0","p1","m0","m1","t2","twot","omt","omt2","Curve","data","precision","values","step","CurveSet","arg","numCurves","oneDiv255","floatView","int32View","FloatPacking","bits","m","e","array","numBytes","enc1","enc2","enc3","exponent","Vec3","y","z","scalar","lx","ly","lz","rx","ry","rz","epsilon","src","lengthSq","invLength","a_dot_b","b_dot_b","Mat3","dst","l","a0","a1","a2","a4","a5","a6","a8","a9","a10","b11","b21","b31","b12","b22","b32","b13","b23","b33","det","invDet","vec","res","Vec2","degrees","angle","Vec4","w","_halfSize","scale","Mat4","halfSize","fov","aspect","znear","fovIsHorizontal","a00","a01","a02","a03","a11","a12","a13","a20","a21","a22","a23","a30","a31","a32","a33","b0","b1","b2","b3","position","up","bottom","top","zfar","temp1","temp2","temp3","temp4","near","far","axis","tx","ty","width","height","normal","distance","b00","b01","b02","b03","b04","b05","b06","b07","b08","b09","b10","qx","qy","qz","qw","sx","sy","sz","x2","y2","z2","xx","xy","xz","yy","yz","zz","wx","wy","wz","ey","ez","c1","c2","s3","c3","eulers","halfPi","Quat","rad","q1x","q1y","q1z","q1w","q2x","q2y","q2z","q2w","sa","ca","halfToRad","cx","cy","cz","m00","m01","m02","m10","m11","m12","m20","m21","m22","rs","tr","from","to","dotProduct","lw","rw","cosHalfTheta","halfTheta","sinHalfTheta","ratioA","ratioB","ix","iy","iz","iw","tmpVecA","tmpVecB","tmpVecC","tmpVecD","tmpVecE","BoundingBox","center","halfExtents","other","tc","tcx","tcy","tcz","th","thx","thy","thz","tminx","tmaxx","tminy","tmaxy","tminz","tmaxz","oc","ocx","ocy","ocz","oh","ohx","ohy","ohz","ominx","omaxx","ominy","omaxy","ominz","omaxz","aMax","aMin","bMax","bMin","ray","point","tMin","tMax","dir","realMin","realMax","minMax","maxMin","intersects","cross","prod","absDiff","absDir","rayDir","aabb","ignoreScale","ac","ar","mx0","mx1","mx2","my0","my1","my2","mz0","mz1","mz2","vertices","numVerts","minx","miny","minz","maxx","maxy","maxz","sphere","boxMin","boxMax","sq","out","pn","expandMin","expandMax","BoundingSphere","radius","lenSq","discr","totalRadius","Frustum","matrix","vpm","plane","planes","p","sr","sc","scx","scy","scz","Ray","origin","direction","Plane","start","d0","d1","denominator","DISTANCE_LINEAR","DISTANCE_INVERSE","DISTANCE_EXPONENTIAL","ADDRESS_REPEAT","ADDRESS_CLAMP_TO_EDGE","ADDRESS_MIRRORED_REPEAT","BLENDMODE_ZERO","BLENDMODE_ONE","BLENDMODE_SRC_COLOR","BLENDMODE_DST_COLOR","BLENDMODE_ONE_MINUS_DST_COLOR","BLENDMODE_SRC_ALPHA","BLENDMODE_ONE_MINUS_SRC_ALPHA","BLENDEQUATION_ADD","BLENDEQUATION_REVERSE_SUBTRACT","BLENDEQUATION_MIN","BLENDEQUATION_MAX","BUFFER_STATIC","BUFFER_DYNAMIC","BUFFER_STREAM","BUFFER_GPUDYNAMIC","CLEARFLAG_COLOR","CLEARFLAG_DEPTH","CLEARFLAG_STENCIL","CULLFACE_NONE","CULLFACE_BACK","CULLFACE_FRONT","CULLFACE_FRONTANDBACK","FILTER_NEAREST","FILTER_LINEAR","FILTER_NEAREST_MIPMAP_NEAREST","FILTER_NEAREST_MIPMAP_LINEAR","FILTER_LINEAR_MIPMAP_NEAREST","FILTER_LINEAR_MIPMAP_LINEAR","FUNC_NEVER","FUNC_LESS","FUNC_EQUAL","FUNC_LESSEQUAL","FUNC_GREATER","FUNC_NOTEQUAL","FUNC_GREATEREQUAL","FUNC_ALWAYS","INDEXFORMAT_UINT8","INDEXFORMAT_UINT16","INDEXFORMAT_UINT32","PIXELFORMAT_A8","PIXELFORMAT_L8","PIXELFORMAT_LA8","PIXELFORMAT_RGB565","PIXELFORMAT_RGBA5551","PIXELFORMAT_RGBA4","PIXELFORMAT_RGB8","PIXELFORMAT_RGBA8","PIXELFORMAT_DXT1","PIXELFORMAT_DXT3","PIXELFORMAT_DXT5","PIXELFORMAT_RGB16F","PIXELFORMAT_RGBA16F","PIXELFORMAT_RGB32F","PIXELFORMAT_RGBA32F","PIXELFORMAT_R32F","PIXELFORMAT_DEPTH","PIXELFORMAT_DEPTHSTENCIL","PIXELFORMAT_111110F","PIXELFORMAT_SRGB","PIXELFORMAT_SRGBA","PIXELFORMAT_ETC1","PIXELFORMAT_ETC2_RGB","PIXELFORMAT_ETC2_RGBA","PIXELFORMAT_PVRTC_2BPP_RGB_1","PIXELFORMAT_PVRTC_2BPP_RGBA_1","PIXELFORMAT_PVRTC_4BPP_RGB_1","PIXELFORMAT_PVRTC_4BPP_RGBA_1","PIXELFORMAT_ASTC_4x4","PIXELFORMAT_ATC_RGB","PIXELFORMAT_ATC_RGBA","PIXELFORMAT_BGRA8","pixelFormatInfo","isCompressedPixelFormat","format","getPixelFormatArrayType","PRIMITIVE_POINTS","PRIMITIVE_LINES","PRIMITIVE_LINELOOP","PRIMITIVE_LINESTRIP","PRIMITIVE_TRIANGLES","PRIMITIVE_TRISTRIP","PRIMITIVE_TRIFAN","SEMANTIC_POSITION","SEMANTIC_NORMAL","SEMANTIC_TANGENT","SEMANTIC_BLENDWEIGHT","SEMANTIC_BLENDINDICES","SEMANTIC_COLOR","SEMANTIC_TEXCOORD","SEMANTIC_TEXCOORD0","SEMANTIC_TEXCOORD1","SEMANTIC_TEXCOORD2","SEMANTIC_TEXCOORD3","SEMANTIC_TEXCOORD4","SEMANTIC_TEXCOORD5","SEMANTIC_TEXCOORD6","SEMANTIC_TEXCOORD7","SEMANTIC_ATTR","SEMANTIC_ATTR0","SEMANTIC_ATTR1","SEMANTIC_ATTR2","SEMANTIC_ATTR3","SEMANTIC_ATTR4","SEMANTIC_ATTR5","SEMANTIC_ATTR6","SEMANTIC_ATTR7","SEMANTIC_ATTR8","SEMANTIC_ATTR9","SEMANTIC_ATTR10","SEMANTIC_ATTR11","SEMANTIC_ATTR12","SEMANTIC_ATTR13","SEMANTIC_ATTR14","SEMANTIC_ATTR15","SHADERTAG_MATERIAL","STENCILOP_KEEP","STENCILOP_REPLACE","STENCILOP_INCREMENT","STENCILOP_DECREMENT","TEXTURELOCK_WRITE","TEXTURETYPE_DEFAULT","TEXTURETYPE_RGBM","TEXTURETYPE_RGBE","TEXTURETYPE_RGBP","TEXTURETYPE_SWIZZLEGGGR","TEXTUREDIMENSION_2D","TEXTUREDIMENSION_CUBE","TEXTUREDIMENSION_3D","SAMPLETYPE_FLOAT","SAMPLETYPE_UNFILTERABLE_FLOAT","SAMPLETYPE_DEPTH","TEXTUREPROJECTION_NONE","TEXTUREPROJECTION_CUBE","TEXTUREPROJECTION_EQUIRECT","TEXTUREPROJECTION_OCTAHEDRAL","TYPE_INT8","TYPE_UINT8","TYPE_INT16","TYPE_UINT16","TYPE_INT32","TYPE_UINT32","TYPE_FLOAT32","UNIFORMTYPE_BOOL","UNIFORMTYPE_INT","UNIFORMTYPE_FLOAT","UNIFORMTYPE_VEC2","UNIFORMTYPE_VEC3","UNIFORMTYPE_VEC4","UNIFORMTYPE_IVEC2","UNIFORMTYPE_IVEC3","UNIFORMTYPE_IVEC4","UNIFORMTYPE_BVEC2","UNIFORMTYPE_BVEC3","UNIFORMTYPE_BVEC4","UNIFORMTYPE_MAT2","UNIFORMTYPE_MAT3","UNIFORMTYPE_MAT4","UNIFORMTYPE_TEXTURE2D","UNIFORMTYPE_TEXTURECUBE","UNIFORMTYPE_FLOATARRAY","UNIFORMTYPE_TEXTURE2D_SHADOW","UNIFORMTYPE_TEXTURECUBE_SHADOW","UNIFORMTYPE_TEXTURE3D","UNIFORMTYPE_VEC2ARRAY","UNIFORMTYPE_VEC3ARRAY","UNIFORMTYPE_VEC4ARRAY","UNIFORMTYPE_MAT4ARRAY","UNIFORMTYPE_TEXTURE2D_ARRAY","uniformTypeToName","DEVICETYPE_WEBGL1","DEVICETYPE_WEBGL2","SHADERSTAGE_VERTEX","SHADERSTAGE_FRAGMENT","BINDGROUP_MESH","BINDGROUP_VIEW","bindGroupNames","UNIFORM_BUFFER_DEFAULT_SLOT_NAME","typedArrayTypes","typedArrayTypesByteSize","typedArrayIndexFormats","typedArrayIndexFormatsByteSize","semanticToLocation","CHUNKAPI_1_65","_extends","source","BitPacking","storage","shift","mask","shifted","opMask","factorMask","colorOpShift","colorSrcFactorShift","colorDstFactorShift","alphaOpShift","alphaSrcFactorShift","alphaDstFactorShift","redWriteShift","greenWriteShift","blueWriteShift","alphaWriteShift","blendShift","allWriteMasks","allWriteShift","BlendState","blend","colorOp","colorSrcFactor","colorDstFactor","alphaOp","alphaSrcFactor","alphaDstFactor","redWrite","greenWrite","blueWrite","alphaWrite","op","srcFactor","dstFactor","funcMask","funcShift","writeShift","DepthState","write","Version","idCounter","VersionedObject","ScopeId","ScopeSpace","uniformName","uniform","id","VertexBuffer","graphicsDevice","numVertices","usage","initialData","device","vram","hashCode","str","hash","hash32Fnv1a","StringIds","stringIds","webgpuValidElementSizes","VertexFormat","description","vertexCount","total","desc","elementSize","_elementDesc$asInt","_elementDesc$normaliz","elementDesc","asInt","normalize","element","stringElementBatch","stringElementsBatch","stringElementRender","stringElementsRender","StencilParameters","options","_options$func","_options$ref","_options$readMask","_options$writeMask","_options$fail","_options$zfail","_options$zpass","_func","_ref","_fail","_zfail","_zpass","_readMask","_writeMask","GraphicsDevice","canvas","_this$initOptions","_this$initOptions$dep","_this$initOptions2","_this$initOptions2$st","_this$initOptions3","_this$initOptions3$an","_this$initOptions4","_this$initOptions4$po","vertexFormat","positions","_this$quadVertexBuffe","_this$dynamicBuffers","_this$gpuProfiler","shader","stencilFront","stencilBack","blendState","depthState","cullMode","renderTarget","indexBuffer","vertexBuffer","texture","pixelRatio","h","fullscreen","ratio","maxBones","renderPass","formats","filterable","RenderTarget","_options$face","_this$_colorBuffer","_this$_depthBuffer","_this$_colorBuffers","_options$samples","_options$autoResolve","_options$flipY","_arg2","_arg3","_options$depth","_options$stencil","colorBuffer","maxSamples","_this$_colorBuffer2","_this$_depthBuffer2","_this$_depthBuffer3","_this$_colorBuffers2","_this$_depthBuffer4","_this$_colorBuffers3","color","depth","_this$_colorBuffers4","_this$_colorBuffer3","_this$_depthBuffer5","_this$_colorBuffer4","_this$_depthBuffer6","uniformTypeToNumElements","UniformFormat","count","alignment","UniformBufferFormat","uniforms","bindGroup","bindIndex","typeString","textureDimensionInfo","BindBufferFormat","visibility","BindTextureFormat","textureDimension","sampleType","BindGroupFormat","bufferFormats","textureFormats","storageTextureFormats","_options$compute","bf","tf","textureType","TextureUtils","dimension","mipLevel","_pixelFormatInfo$get$","_pixelFormatInfo$get","_formatInfo$blockSize","formatInfo","pixelSize","blockSize","blockWidth","blockHeight","blockDepth","mipmaps","cubemap","KEYWORD","DEFINE","EXTENSION","UNDEF","IF","ENDIF","IDENTIFIER","DEFINED","INVALID","Preprocessor","stripUnusedColorAttachments","line","defines","counts","regex","matches","match","_counts$get","intDefines","originalSource","stack","keyword","define","expression","identifier","undef","extension","iff","evaluated","endif","blockInfo","blockCode","endifCommand","correct","invert","defined","exists","Shader","definition","BindGroup","defaultUniformBuffer","uniformBuffer","textureFormat","storageTextureFormat","DynamicBufferAllocation","_updateFunctions","UniformBuffer","persistent","_this$impl","uniformFormat","updateFunction","allocation","oldGpuBuffer","GpuProfiler","renderVersion","timings","allocations","slot","Texture","_options$name","_options$width","_options$height","_options$format","_options$storage","_options$cubemap","_options$fixCubemapSe","_options$premultiplyA","_options$mipmaps","_options$minFilter","_options$magFilter","_options$anisotropy","_options$addressU","_options$addressV","_options$addressW","_options$compareOnRea","_options$compareFunc","_options$volume","_options$arrayLength","flag","v","addressW","mips","flipY","premultiplyAlpha","levels","invalid","face","_this$impl$uploadImme","promises","_this$device$readPixe","_this$device","level","promise","WebglBuffer","glUsage","WebglVertexBuffer","WebglIndexBuffer","WebglShaderInput","locationId","DeviceCache","onCreate","_this$_cache$get","_this$_cache$get2","_vertexShaderBuiltins","CompiledShaderCache","ShaderBatchCache","_vertexShaderCache","_fragmentShaderCache","_shaderBatchCache","WebglShader","shaders","glProgram","attrs","outNames","attr","semantic","loc","isVertexShader","shaderCache","glShader","message","numAttributes","info","shaderInput","numUniforms","shaderType","infoLog","lines","downsampleImage","image","srcW","srcH","dstW","dstH","WebglTexture","textureUnit","j","mipObject","resMult","requiredMipLevels","texData","FramebufferPair","msaaFB","resolveFB","WebglRenderTarget","_this$colorMrtFramebu","framebuffer","buffers","_target$_colorBuffers","_target$_colorBuffers2","_device$extDrawBuffer","_device$extDrawBuffer2","colorBufferCount","attachmentBaseConstant","depthBuffer","depthFormat","_target$_colorBuffers3","_target$_colorBuffers4","internalFormat","srcFramebuffer","dstFramebuffer","fbPair","gles2PS","gles3PS","gles3VS","webgpuPS","webgpuVS","sharedFS","_attrib2Semantic","ShaderUtils","_options$attributes","getDefines","gpu","gl2","gl1","isVertex","deviceIntro","attachmentsDefine","vertDefines","vertCode","fragDefines","fragCode","attribs","forcePrecision","vsCode","found","endOfLine","startOfAttribName","attribName","FrameQueriesInfo","query","WebglGpuProfiler","frameQueriesInfo","_this$freeQueries$pop","frameQueries","previousQueriesInfo","previousQueries","lastQuery","available","disjoint","duration","invalidateAttachments","_fullScreenQuadVS","_precisionTest1PS","_precisionTest2PS","_outputTexture2D","quadWithShader","oldRt","testRenderable","pixelFormat","testTextureHalfFloatUpdatable","testTextureFloatHighPrecision","shader1","shader2","textureOptions","tex1","targ1","tex2","targ2","prevFramebuffer","pixels","WebglGraphicsDevice","_options$antialias","event","firefoxVersion","isChrome","isSafari","isMac","scopeX","scopeY","scopeZ","scopeW","uniformValue","frameBuffer","alphaBits","resolutionChanged","vertexShaderPrecisionHighpFloat","vertexShaderPrecisionMediumpFloat","fragmentShaderPrecisionHighpFloat","fragmentShaderPrecisionMediumpFloat","highpAvailable","mediumpAvailable","_gl$getSupportedExten","_this$extDrawBuffers","_contextAttribs$antia","_contextAttribs$stenc","userAgent","contextAttribs","maliRendererRegex","samsungModelRegex","antialiasSupported","_this$gpuProfiler2","fb","dest","_this$backBuffer","prevRt","_renderPass$renderTar","rt","colorOps","depthStencilOps","clearFlags","clearOptions","_renderPass$colorOps","_this$renderTarget","unit","targetImpl","impl","textureTarget","textureObject","flags","filter","vertexBuffers","useCache","elements","bufferId","primitive","numInstances","keepBuffers","sampler","samplerValue","numTextures","scopeId","uniformVersion","programVersion","samplers","mode","_options$flags","defaultOptions","_options$color","stencil","_this$renderTarget$co","_impl$_glFormat","_impl$_glPixelType","clientWaitAsync","interval_ms","sync","resolve","reject","test","pixelType","buf","state","on","constBias","slopeBias","enable","ref","fail","zfail","zpass","writeMask","currentBlendState","glBlendEquation","_stencilFront","_stencilBack","currentDepthState","mapObj","IndexBuffer","numIndices","bytesPerIndex","lock","indices","ColorAttachmentOps","DepthStencilAttachmentOps","RenderPass","_renderTarget$_colorB","_this$options$scaleX","_this$options$scaleY","numColorOps","_this$options$resizeS","resizeSource","depthValue","stencilValue","realPass","set1","set2","set3","set4","arraySet1","inputArray","inputIndex","arraySet2","arraySet3","arraySet4","arrayGet1","outputArray","outputIndex","arrayGet2","arrayGet3","arrayGet4","VertexIteratorAccessor","vertexElement","VertexIterator","accessors","numAccessors","accessor","numComponents","copyCount","EVENT_MOUSEWHEEL","Http","method","postdata","errored","contentType","bFirstItem","encodedKey","encodedValue","timestamp","xhr","header","responseType","response","retryDelay","http","hasAudioContext","Channel","manager","sound","_options$loop","_options$pitch","context","loop","volume","pitch","MAX_DISTANCE","Channel3d","panner","velocity","factor","distanceModel","fallOff","posOne","posTwo","refDistance","maxDistance","rolloffFactor","lpos","Listener","listener","orientation","CONTEXT_STATE_RUNNING","USER_INPUT_EVENTS","SoundManager","_this$_context","eventName","Sound","resource","STATE_PLAYING","STATE_PAUSED","STATE_STOPPED","capTime","SoundInstance","suspend","isPlaying","wasPlaying","firstNode","lastNode","speakers","SoundInstance3d","rollOffFactor","BLEND_SUBTRACTIVE","BLEND_ADDITIVE","BLEND_NORMAL","BLEND_NONE","BLEND_PREMULTIPLIED","BLEND_MULTIPLICATIVE","BLEND_ADDITIVEALPHA","BLEND_MULTIPLICATIVE2X","BLEND_SCREEN","BLEND_MIN","BLEND_MAX","FOG_NONE","FOG_LINEAR","FRESNEL_SCHLICK","LAYER_HUD","LAYER_FX","LAYER_WORLD","LAYERID_WORLD","LAYERID_DEPTH","LAYERID_SKYBOX","LAYERID_IMMEDIATE","LAYERID_UI","LIGHTTYPE_DIRECTIONAL","LIGHTTYPE_OMNI","LIGHTTYPE_SPOT","LIGHTSHAPE_PUNCTUAL","LIGHTSHAPE_RECT","LIGHTSHAPE_DISK","LIGHTSHAPE_SPHERE","LIGHTFALLOFF_LINEAR","LIGHTFALLOFF_INVERSESQUARED","SHADOW_PCF3","SHADOW_VSM8","SHADOW_VSM16","SHADOW_VSM32","SHADOW_PCF5","SHADOW_PCF1","SHADOW_PCSS","shadowTypeToString","BLUR_GAUSSIAN","PARTICLESORT_NONE","PARTICLEMODE_GPU","EMITTERSHAPE_BOX","EMITTERSHAPE_SPHERE","PARTICLEORIENTATION_SCREEN","PARTICLEORIENTATION_WORLD","PROJECTION_PERSPECTIVE","PROJECTION_ORTHOGRAPHIC","RENDERSTYLE_SOLID","RENDERSTYLE_WIREFRAME","RENDERSTYLE_POINTS","CUBEPROJ_NONE","CUBEPROJ_BOX","SPECULAR_PHONG","SPECULAR_BLINN","DETAILMODE_MUL","GAMMA_NONE","GAMMA_SRGB","GAMMA_SRGBFAST","GAMMA_SRGBHDR","TONEMAP_LINEAR","TONEMAP_FILMIC","TONEMAP_HEJL","TONEMAP_ACES","TONEMAP_ACES2","SPECOCC_NONE","SPECOCC_AO","SPECOCC_GLOSSDEPENDENT","SHADERDEF_NOSHADOW","SHADERDEF_SKIN","SHADERDEF_UV0","SHADERDEF_UV1","SHADERDEF_VCOLOR","SHADERDEF_INSTANCING","SHADERDEF_LM","SHADERDEF_DIRLM","SHADERDEF_SCREENSPACE","SHADERDEF_TANGENTS","SHADERDEF_MORPH_POSITION","SHADERDEF_MORPH_NORMAL","SHADERDEF_MORPH_TEXTURE_BASED","SHADERDEF_LMAMBIENT","SHADOWUPDATE_NONE","SHADOWUPDATE_THISFRAME","SHADOWUPDATE_REALTIME","SORTKEY_FORWARD","SORTKEY_DEPTH","MASK_AFFECT_DYNAMIC","MASK_AFFECT_LIGHTMAPPED","MASK_BAKE","SHADER_FORWARD","SHADER_FORWARDHDR","SHADER_DEPTH","SHADER_PICK","SHADER_SHADOW","SPRITE_RENDERMODE_SIMPLE","SPRITE_RENDERMODE_SLICED","SPRITE_RENDERMODE_TILED","BAKE_COLORDIR","VIEW_CENTER","SORTMODE_NONE","SORTMODE_MANUAL","SORTMODE_MATERIALMESH","SORTMODE_BACK2FRONT","SORTMODE_FRONT2BACK","SORTMODE_CUSTOM","ASPECT_AUTO","ASPECT_MANUAL","ORIENTATION_HORIZONTAL","ORIENTATION_VERTICAL","RefCountedObject","GraphicsDeviceAccess","GeometryData","GeometryVertexStream","componentCount","dataType","dataTypeNormalize","Mesh","morph","morphTargets","boneMin","boneMax","boneUsed","numBones","maxMorphX","maxMorphY","maxMorphZ","iterator","posElement","weightsElement","indicesElement","k","boneIndex","minMorphX","minMorphY","minMorphZ","dx","dy","dz","positionElement","verticesDynamic","indicesDynamic","maxVertices","maxIndices","done","stream","normals","uvs","colors","streamIndices","il","primitiveType","updateBoundingBox","destroyVB","destroyIB","vertexDesc","allocateVertexCount","createFormat","srcIndices","renderStyle","offsets","base","seen","i1","i2","wireBuffer","primitiveUv1Padding","primitiveUv1PaddingScale","shapePrimitives","calculateNormals","triangleCount","p2","p3","p1p2","p1p3","faceNormal","i3","nx","ny","nz","invLen","calculateTangents","v1","v2","v3","w1","w2","w3","sdir","tdir","tan1","tan2","tangents","x1","y1","z1","_t","_t2","area","t1","temp","ndott","createMesh","mesh","createTorus","_opts$tubeRadius","_opts$ringRadius","_opts$segments","_opts$sides","_opts$calculateTangen","rc","segments","sides","calcTangents","u","third","fourth","_createConeData","baseRadius","peakRadius","heightSegments","capSegments","roundedCaps","pos","bottomToTop","norm","tangent","uvs1","theta","sinTheta","cosTheta","_v","latitudeBands","longitudeBands","capOffset","lat","lon","phi","sinPhi","createCylinder","_opts$radius","_opts$height","_opts$heightSegments","_opts$capSegments","_opts$calculateTangen2","createCapsule","_opts$radius2","_opts$height2","_opts$heightSegments2","_opts$sides2","_opts$calculateTangen3","createCone","_opts$baseRadius","_opts$peakRadius","_opts$height3","_opts$heightSegments3","_opts$capSegments2","_opts$calculateTangen4","createSphere","_opts$radius3","_opts$latitudeBands","_opts$longitudeBands","_opts$calculateTangen5","createPlane","_opts$halfExtents","_opts$widthSegments","_opts$lengthSegments","_opts$calculateTangen6","he","ws","ls","vcounter","createBox","_opts$halfExtents2","_opts$widthSegments2","_opts$lengthSegments2","_opts$heightSegments4","_opts$calculateTangen7","hs","corners","faceAxes","faceNormals","generateFace","side","uSegments","vSegments","getShapePrimitive","primData","ShaderProcessorOptions","viewUniformFormat","viewBindGroupFormat","groupFormat","_this$vertexFormat","_this$vertexFormat2","alphaTestPS","ambientConstantPS","ambientEnvPS","ambientSHPS","aoPS","aoDetailMapPS","aoDiffuseOccPS","aoSpecOccPS","aoSpecOccConstPS","aoSpecOccConstSimplePS","aoSpecOccSimplePS","basePS","baseVS","baseNineSlicedPS","baseNineSlicedVS","baseNineSlicedTiledPS","biasConstPS","blurVSMPS","clearCoatPS","clearCoatGlossPS","clearCoatNormalPS","clusteredLightUtilsPS","clusteredLightCookiesPS","clusteredLightShadowsPS","clusteredLightPS","combinePS","cookiePS","cubeMapProjectBoxPS","cubeMapProjectNonePS","cubeMapRotatePS","debugOutputPS","debugProcessFrontendPS","decodePS","detailModesPS","diffusePS","diffuseDetailMapPS","emissivePS","encodePS","endPS","endVS","envAtlasPS","envConstPS","envMultiplyPS","extensionPS","extensionVS","falloffInvSquaredPS","falloffLinearPS","fixCubemapSeamsNonePS","fixCubemapSeamsStretchPS","floatUnpackingPS","fogExpPS","fogExp2PS","fogLinearPS","fogNonePS","fresnelSchlickPS","fullscreenQuadPS","fullscreenQuadVS","gamma1_0PS","gamma2_2PS","glossPS","iridescenceDiffractionPS","iridescencePS","iridescenceThicknessPS","instancingVS","iorPS","lightDiffuseLambertPS","lightDirPointPS","lightmapAddPS","lightmapDirAddPS","lightmapDirPS","lightmapSinglePS","lightSpecularAnisoGGXPS","lightSpecularBlinnPS","lightSpecularPhongPS","lightSheenPS","linearizeDepthPS","litShaderArgsPS","ltcPS","metalnessPS","msdfPS","metalnessModulatePS","msdfVS","normalVS","normalDetailMapPS","normalInstancedVS","normalMapPS","normalSkinnedVS","normalXYPS","normalXYZPS","opacityPS","outputPS","outputAlphaPS","outputAlphaOpaquePS","outputAlphaPremulPS","outputTex2DPS","packDepthPS","sheenPS","sheenGlossPS","parallaxPS","particlePS","particleVS","particleAnimFrameClampVS","particleAnimFrameLoopVS","particleAnimTexVS","particleInputFloatPS","particleInputRgba8PS","particleOutputFloatPS","particleOutputRgba8PS","particleUpdaterAABBPS","particleUpdaterEndPS","particleUpdaterInitPS","particleUpdaterNoRespawnPS","particleUpdaterOnStopPS","particleUpdaterRespawnPS","particleUpdaterSpherePS","particleUpdaterStartPS","particle_billboardVS","particle_blendAddPS","particle_blendMultiplyPS","particle_blendNormalPS","particle_cpuVS","particle_cpu_endVS","particle_customFaceVS","particle_endPS","particle_endVS","particle_halflambertPS","particle_initVS","particle_lambertPS","particle_lightingPS","particle_localShiftVS","particle_meshVS","particle_normalVS","particle_normalMapPS","particle_pointAlongVS","particle_softPS","particle_softVS","particle_stretchVS","particle_TBNVS","particle_wrapVS","reflDirPS","reflDirAnisoPS","reflectionCCPS","reflectionCubePS","reflectionEnvHQPS","reflectionEnvPS","reflectionSpherePS","reflectionSphereLowPS","reflectionSheenPS","refractionCubePS","refractionDynamicPS","reprojectPS","screenDepthPS","shadowCascadesPS","shadowEVSMPS","shadowEVSMnPS","shadowPCSSPS","shadowSampleCoordPS","shadowStandardPS","shadowStandardGL2PS","shadowVSM8PS","shadowVSM_commonPS","skinBatchConstVS","skinBatchTexVS","skinConstVS","skinTexVS","skyboxEnvPS","skyboxHDRPS","skyboxVS","specularPS","sphericalPS","specularityFactorPS","spotPS","startPS","startVS","startNineSlicedPS","startNineSlicedTiledPS","storeEVSMPS","tangentBinormalVS","TBNPS","TBNderivativePS","TBNfastPS","TBNObjectSpacePS","textureSamplePS","thicknessPS","tonemappingAcesPS","tonemappingAces2PS","tonemappingFilmicPS","tonemappingHejlPS","tonemappingLinearPS","tonemappingNonePS","transformVS","transformDeclVS","transmissionPS","uv0VS","uv1VS","viewDirPS","viewNormalVS","shaderChunks","programLibraryDeviceCache","getProgramLibrary","setProgramLibrary","library","ShaderGenerator","chunks","createShader","vsName","fsName","useTransformFeedback","createShaderFromCode","fsCode","uniqueName","attributes","programLibrary","ShaderGeneratorPassThrough","shaderDefinition","processShader","processingOptions","_shaderDefinition$nam","materialGenerator","libraryModuleName","variant","_quadPrimitive","_tempViewport","_tempScissor","QuadRender","ubFormat","bindGroupFormat","_this$uniformBuffer","_this$bindGroup","viewport","scissor","_scissor","_bindGroup$defaultUni","RenderPassQuad","quad","rect","scissorRect","_tempRect","drawQuadWithShader","shaderPassDeviceCache","ShaderPassInfo","define1","define2","ShaderPass","add","ShaderGeneratorBasic","shaderPassDefines","vshader","fshader","basic","defaultMaterialDeviceCache","getDefaultMaterial","setDefaultMaterial","material","blendModes","Material","transparent","meshInstances","blendMode","_source$stencilFront","scene","objDefs","unused","pass","sortedLights","uniformObject","param","parameters","paramName","parameter","meshInstance","defaultMaterial","BasicMaterial","Batch","dynamic","batchGroupId","layers","layer","BatchGroup","maxAabbSize","_invMatrix","SkinInstance","skin","rootBone","numPixels","entity","bones","boneName","bone","rootNode","skinUpdateIndex","mp","pe","SkinBatchInstance","nodes","scaleCompensatePosTransform","scaleCompensatePos","scaleCompensateRot","scaleCompensateRot2","scaleCompensateScale","scaleCompensateScaleForParent","tmpMat4","tmpQuat","invParentWtm","rotation","invParentRot","GraphNode","normalMat","_this$_parent","node","clone","children","child","results","fn","descendants","testValue","queryNode","checkNode","imax","thisArg","_this$_parent2","parentRot","wPos","wRot","nameHierarchy","enabledInHierarchy","parentWorldScale","parentToUseScaleFrom","tmatrix","ux","uy","uz","rot","RefCountedCache","refCount","object","LightmapCache","_tmpAabb","_tempBoneAabb","_tempSphere","_meshSet","InstancingData","numObjects","ShaderInstance","group","_group$defaultUniform","ShaderCacheEntry","MeshInstance","localAabb","toWorldSpace","morphAabb","_shaderCache$i","shaderPass","lightHash","shaderInstance","passEntry","mat","shaderDefs","variantKey","prevMat","calculateSortDistance","_this$_morphInstance","toggles","_this$_skinInstance","_this$morphInstance","camera","blendType","cull","passFlags","old","passFlag","paramsIdentical","equalParamSets","params1","params2","_triFanIndices","_triStripIndices","mat3","getScaleSign","mi","BatchManager","root","newBatchList","groups","batch","groupId","groupMeshInstances","valid","groupIds","newDirtyGroups","lists","groupData","translucent","halfMaxAabbSize","maxInstanceCount","maxNumVertices","testAabb","skipTranslucentAabb","sf","meshInstancesLeftA","meshInstancesLeftB","skipMesh","defs","vertCount","drawOrder","scaleSign","vertexFormatBatchingHash","indexed","streams","batchNumVerts","batchNumIndices","elems","boneLimit","batchData","indexBase","indexData","verticesOffset","indexOffset","transform","indexArrayType","subarray","totalComponents","srcFormat","batchGroup","clonedMeshInstances","batch2","_colorUniformNames","RenderPassColorGrab","targetRT","sourceTexture","sourceFormat","sourceRenderTarget","_camera$renderTarget$","_camera$renderTarget","_camera$renderTarget2","_depthUniformNames","RenderPassDepthGrab","isDepth","_camera$renderTarget$2","_camera$renderTarget3","useDepthBuffer","webgl1DepthClearColor","tempMeshInstances","lights","RenderPassDepth","renderer","sourceRT","_sourceRT$width","_sourceRT$height","subLayerEnabled","isTransparent","culledInstances","_meshInstance$materia","_deviceCoord","_point","_invViewProjMat","_frustumPoints","Camera","_this$renderPassColor","_this$renderPassDepth","newValue","_this$xr","_this$xr2","_this$xr3","_this$xr4","_this$xr5","wtm","_this$renderPassColor2","_this$renderPassDepth2","worldCoord","cw","screenCoord","range","invView","cameraPos","ev100","viewAngle","sphereViewHeight","screenViewHeight","points","properties","LitShaderOptions","LitMaterialOptionsBuilder","litOptions","hasSkybox","lightsFiltered","lType","light","ChunkBuilder","chunk","decodeTable","encodeTable","ChunkUtils","encoding","_viewMat","_viewProjMat","_viewportMatrix","LightCamera","lightType","cookieCamera","cookieNode","cookieMatrix","rectViewport","tempVec3","tempAreaLightSizes","areaHalfAxisWidth","areaHalfAxisHeight","TextureIndex8","TextureIndexFloat","LightsBuffer","clusterTextureFormat","prefix","floatOffset","pixelsPerLight8","pixelsPerLightFloat","maxAttenuation","maxColorValue","delta","spot","data8","isSpot","castShadows","shadowIntensity","gammaCorrection","isCookie","invMaxColorValue","isDynamic","isLightmapped","lightRenderData","biases","normPos","lightProjectionMatrix","matData","isRgb","atlasViewport","areaSizes","lightIndex","hasAtlasViewport","isArea","data8Start","dataFloat","dataFloatStart","builtinAttributes","builtinVaryings","LitShader","userChunks","chunkName","codes","uv","checkId","varName","shape","useUv","useUnmodifiedUv","mapTransforms","codeBody","maxUvSets","mapTransform","morphIdType","varyings","shadowType","mayPackDepth","mustPackDepth","usePackedDepth","isVsm","applySlopeScaleBias","usePerspectiveDepth","hasModifiedDepth","decl","backend","shadowTypeUsed","numShadowLights","shadowedDirectionalLightUsed","useVsm","usePcss","hasAreaLights","areaLutsPrecision","lightShape","hasTBN","scode","useOldAmbient","addAmbient","hasPointLights","usesLinearFalloff","usesInvSquaredFalloff","usesSpot","usesCookie","usesCookieNow","shapeString","pcssShadows","vsmShadows","pcfShadows","shadowReadMode","evsmExp","coordCode","shadowMatrix","shadowCoordArgs","penumbraSizeArg","calcFresnel","structCode","backendCode","mergedCode","frontendDecl","frontendCode","frontendFunc","lightingUv","_this$handleCompatibi","LitOptionsUtils","_options$chunks","tempMin3","tempMax3","tempBox","ClusterLight","WorldClusters","lightingParams","numCells","totalPixels","boundsDelta","clusteredLight","maxLights","usedLights","runtimeLight","zeroAngleSpotlight","divX","divZ","limit","clusters","pixelsPerCellCount","xStart","xEnd","yStart","yEnd","zStart","zEnd","clusterIndex","ShadowMap","targets","shadowMap","resolution","_tempArray","_tempArray2","_viewport","Slot","LightTextureAtlas","_this$shadowAtlas","_this$cookieAtlas","_this$cookieRenderTar","scissorOffset","shadowBuffer","numLights","atlasSplit","gridSize","splitCount","invSize","nextLevelSplit","invSizeNext","rectNext","localLights","cookiesEnabled","shadowsEnabled","needsShadowAtlas","needsCookieAtlas","lightShadow","lightCookie","faceCount","smallSize","slotIndex","slotReassigned","slots","assignCount","previousSlot","_previousSlot","usedCount","lightCubeDir","LightCube","ambientLight","weight","lightColor","ShadowMapCache","shadowMaps","isCubeMap","RenderPassShadowLocalNonClustered","shadowRenderer","applyVsm","ShadowRendererLocal","comp","casters","isClustered","shadowCam","shadowCamNode","lightNode","filterSize","shadowLights","shadowCamera","frameGraph","RenderPassShadowDirectional","allCascadesRendering","shadowUpdateOverrides","visibleSceneAabb","shadowCamView","aabbPoints","_depthRange","getDepthRange","cameraViewMatrix","aabbMin","aabbMax","ShadowRendererDirectional","nearDist","cascade","frustumNearDist","frustumFarDist","frustumPoints","cameraWorldMat","dist","lightDir","sizeRatio","scaledUp","scaledRight","dot","scaledDir","emptyAabb","visibleCasters","depthRange","farDist","fraction","linearDist","logDist","directionalLights","gauss","sigma","gaussWeights","kernelSize","halfWidth","sum","tempSet","shadowCamViewProj","pixelOffset","blurScissorRect","viewportMatrix","ShadowRenderer","lightTextureAtlas","packed","hwPcf","visible","gpuOrGl2","useShadowSampler","_this$shadowPassCache","shadowPassInfo","shadowPassName","shadowPass","shadowShader","style","needs","clearRenderTarget","renderTargetIndex","clear","insideRenderPass","isVsm8","blurMode","blurShader","blurVS","blurFS","blurShaderName","origShadowMap","tempShadowMap","tempRt","tempClusterArray","WorldClustersAllocator","cluster","empty","renderPasses","passCount","renderActions","ra","existingRenderAction","_tempClusterArray$pop","lighting","renderAction","textureBlitVertexShader","textureBlitFragmentShader","textureCubeBlitFragmentShader","_invViewProjMatrices","RenderPassCookieRenderer","cubeSlotsOffsets","_this$_quadRenderer2D","_this$_quadRendererCu","filteredLights","projMat","viewMat","renderTargetWidth","RenderPassShadowLocalClustered","shadowRendererLocal","RenderPassUpdateClustered","_skinUpdateIndex","boneTextureSize","viewProjMat","viewInvMat","viewMat3","tempSphere","_flipYMat","_tempLightSet","_tempLayerSet","_fixProjRangeMat","_tempProjMat0","_tempProjMat1","_tempProjMat2","_tempProjMat3","_tempSet","_tempMeshInstances","_tempMeshInstancesSkinned","Renderer","drawCallA","drawCallB","keyA","keyB","pixelWidth","pixelHeight","viewCount","views","projMatSkybox","clearColor","clearDepth","clearStencil","forceWrite","cullFaces","flipFactor","drawCall","flipFaces","drawCalls","drawCallsCount","si","morphInst","morphInstance","vb","boneTexture","vp","textures","viewBindGroups","ub","bg","viewBindGroup","meshBindGroup","modelMatrix","instancingData","opaque","doCull","stats","clusteredLightingEnabled","physicalUnits","screenSize","cameraLayers","cameraLayer","layerDirLights","numCameras","currentRenderTarget","cameraChanged","layerIds","onlyLitShaders","updateShaders","layerCount","meshInst","lightCount","shaderVersion","RenderAction","_goldenAngle","random","numPoints","getProjectionName","projection","packFloat32ToRGBA8","encX","encY","encZ","encW","packSamples","samples","numSamples","off","hemisphereSamplePhong","dstVec","specularPower","hemisphereSampleLambert","hemisphereSampleGGX","D_GGX","NoH","linearRoughness","generatePhongSamples","H","generateLambertSamples","sourceTotalPixels","pixelsPerSample","pdf","requiredSamplesGGX","getRequiredSamplesGGX","table","generateGGXSamples","roughness","L","N","requiredSamples","createSamplesTex","packedSamples","SimpleCache","destroyContent","missFunc","samplesCache","deviceCache","getCachedTexture","getSamplesFnc","generateLambertSamplesTex","generatePhongSamplesTex","generateGGXSamplesTex","reprojectTexture","_options","funcNames","distribution","processFunc","prefilterSamples","decodeFunc","encodeFunc","sourceFunc","targetFunc","shaderKey","constantParams","constantParams2","uvModParam","innerWidth","innerHeight","samplesTex","_options2","fixCubemapSeams","calcLevels","supportsFloat16","supportsFloat32","lightingSourcePixelFormat","lightingPixelFormat","createCubemap","EnvLighting","sources","StandardMaterialOptions","_matTex2D","buildPropertiesList","ShaderGeneratorStandard","props","transformPropName","uVPropName","transformId","uvChannel","isMainPass","float","vertex","map","propName","mapping","mapPropName","identifierPropName","channelPropName","vertexColorChannelPropName","tintPropName","vertexColorPropName","detailModePropName","invertName","tintOption","vertexColorOption","textureOption","textureIdentifier","detailModeOption","subCode","samplerName","alias","isFloatTint","isVecTint","invertOption","chan","chr","addLen","isForwardPass","litShader","textureMapping","mname","cname","tname","uname","uvSet","baseName","lightmapDir","lightmapChunkPropName","standard","arraysEqual","notWhite","notBlack","StandardMaterialOptionsBuilder","stdMat","minimalOptions","hasUv0","hasUv1","hasVcolor","uniqueTextureMap","isOpacity","vname","vcname","iname","allow","mapId","_stdMat$diffuseMap","_stdMat$diffuseDetail","_stdMat$emissiveMap","_stdMat$lightMap","diffuseTint","useSpecular","useSpecularColor","specularTint","specularityFactorTint","emissiveTintColor","emissiveTintIntensity","isPackedNormalMap","isPhong","usingSceneEnv","envAtlas","xform","xforms","_textureParameter","vertexColor","standardMaterialParameterTypes","standardMaterialTextureParameters","standardMaterialCubemapParameters","standardMaterialRemovedParameters","_props","_uniforms","_params","StandardMaterial","paramsName","prevParams","allocFunc","getUniform","shaderPassInfo","asset","defineUniform","getUniformFunc","definePropInternal","constructorFunc","setterFunc","getterFunc","defineValueProp","internalName","dirtyShaderFunc","oldValue","defineAggProp","defineProp","_defineTex2D","mapTiling","mapOffset","mapRotation","tiling","cr","uniform0","uniform1","_defineColor","defaultValue","_defineFloat","_defineObject","_defineFlag","_defineMaterialProps","bboxMin","minUniform","bboxMax","maxUniform","cubemaps","complete","RenderPassRenderActions","layerComposition","autoClears","firstRa","firstRenderAction","cameraPass","_renderAction$renderT","_camera$camera$shader","_camera$camera$shader2","draws","RenderPassPostprocessing","_drawCallList","vogelDiskPrecalculationSamples","vogelSpherePrecalculationSamples","ForwardRenderer","cnt","campos","hWidth","hHeight","dirs","directional","projectionCompensation","pixelsPerMeter","cameraParams","omni","fovRatio","usedDirLights","omnis","numOmnis","spts","numSpts","_layer$getLightHash","addCall","isNewMaterial","lightMaskChanged","prevMaterial","prevObjDefs","prevLightMask","lightMask","preparedCalls","drawCallback","skipMaterial","preparedCallsCount","_drawCall$stencilFron","_drawCall$stencilBack","newMaterial","allDrawCalls","webgl1","startIndex","newStart","depthPass","isDepthLayer","isGrabPass","nextRenderAction","isNextLayerGrabPass","endIndex","sortManual","sortMaterialMesh","sortBackToFront","sortFrontToBack","sortCallbacks","layerCounter","lightKeys","_tempMaterials","CulledInstances","Layer","_options$enabled","_options$opaqueSortMo","_options$transparentS","_options$shaderPass","skipShadowCasters","destMeshInstances","destMeshInstancesSet","sceneShaderVer","shadowCasters","shadowCastersSet","splitLights","useIds","isLocalLight","camPos","camFwd","meshPos","tempx","tempy","tempz","instances","sortMode","cameraNode","sortPos","sortDir","cmpPriority","sortPriority","LayerComposition","renderActionCount","cameraFirstRenderAction","cameraFirstRenderActionIndex","lastRenderAction","postProcessMarked","renderActionIndex","used","needsCameraClear","needsLayerClear","fromCamera","thisCamera","_this$layerOpaqueInde","_this$layerTransparen","_this$layerIdMap$get","_this$layerNameMap$ge","layersA","layersB","order","topLayerA","topLayerB","tmpVec","tmpBiases","chanId","lightTypes","directionalCascades","LightRenderData","Light","stype","supportsDepthShadow","radAngle","rd","outerAngle","innerAngle","falloffEnd","falloffStart","farClip","cosAngle","box","scl","finalColor","linearFinalColor","LightingParams","supportsAreaLights","maxTextureSize","dirtyLightsFnc","render","_render$lightingShado","_render$lightingCooki","_render$lightingAreaL","_render$lightingShado2","_render$lightingCooki2","_render$lightingMaxLi","_render$lightingShado3","textureMorphVertexShader","blendStateAdditive","MorphInstance","createRT","textureVar","fragmentShader","fs","srcTextureName","submitBatch","blending","activeTarget","tex","posIndex","nrmIndex","activeCount","absWeight","maxActiveTargets","Model","graph","cameras","materials","srcNodes","cloneNodes","cloneGraph","_duplicate","newNode","cloneMeshInstances","cloneSkinInstances","cloneMorphInstances","cloneSkinInstance","cloneMorphInstance","nodeIndex","cloneMeshInstance","skinInstanceIndex","morphInstanceIndex","Morph","preferHighPrecision","renderableHalf","renderableFloat","textureHalf","textureFloat","targetAabb","deltaArrays","ids","usedDataIndices","floatRounding","freeIndex","dataCount","vertexUsed","useUintIds","deltaInfos","morphTextureWidth","morphTextureHeight","halfFloat","float2Half","textureData","dstIndex","formatDesc","_this$vertexBufferIds","MorphTarget","_this$_vertexBufferPo","_this$_vertexBufferNo","_this$texturePosition","_this$textureNormals","ShaderGeneratorParticle","executionDefine","faceVS","particle","nonUniformScale","uniformScale","particleTexChannels","rotMat","rotMatInv","randomPosTformed","randomPos","rndFactor3Vec","particlePosPrev","velocityVec","localVelocityVec","velocityVec2","localVelocityVec2","radialVelocityVec","particlePos","particleFinalPos","moveDirVec","tmpVec3","frac","saturate","glMod","encodeFloatRGBA","encodeFloatRG","ParticleCPUUpdater","emitter","particleTex","spawnMatrix","extentsInnerRatioUniform","emitterPos","rX","rY","rZ","rW","edgeX","edgeY","edgeZ","spawnBoundsSphereInnerRatio","startSpawnTime","packX","packY","packZ","packA","rg0","ba0","rg1","ba1","maxNegLife","maxPosLife","rgba3","vbToSort","isOnStop","fullMat","posCam","vertSize","cf","cc","rotSpeed","rotSpeed2","scale2","alpha2","radialSpeed","radialSpeed2","precision1","rndFactor","particleRate","particleLifetime","life","nlife","alphaDiv","particleEnabled","vbOffset","quadX","quadY","quadZ","vbStride","particleDistance","spawnMatrix3","emitterMatrix3","emitterMatrix3Inv","ParticleGPUUpdater","gd","emitterScale","maxVel","emitterMatrix","texIN","texOUT","particleVerts","_createTexture","pixelData","mult8Bit","mipFilter","default0Curve","default1Curve","default0Curve3","default1Curve3","particleTexHeight","setPropertyTarget","setPropertyOptions","setProperty","pName","defaultVal","pack3NFloats","packTextureXYZ_NXYZ","qXYZ","qXYZ2","packTextureRGBA","qRGB","qA","packTexture5Floats","qB","qC","qD","qE","packTexture2Floats","calcEndTime","interval","subGraph","A","B","maxUnsignedGraphValue","outUMax","chans","normalizeGraph","uMax","divGraphFrom2Curves","curve1","curve2","sub","particleEmitterDeviceCache","ParticleEmitter","dtex","xgrad","ygrad","recalculateLocalBounds","nodeWT","maxR","maxScale","stepWeight","wVels","lVels","accumX","accumY","accumZ","accumR","accumW","iSort","shaderCodeStart","shaderCodeRespawn","shaderCodeNoRespawn","shaderCodeOnStop","wasVisible","umax","umax2","lumax","lumax2","rumax","rumax2","lmaxVel","maxRad","programLib","hasNormal","dev","inTools","binormal","numParticles","psysVertCount","psysIndexCount","particleFormat","meshData","texCoordOffset","elem","vert","vertID","baseIndex","origLoop","lifetimeFraction","iterations","stepDelta","tilesParams","animIndexParams","ShaderGeneratorSkybox","mip2size","skybox","Sky","skyLayer","identityGraphNode","ImmediateBatch","destPos","destCol","col","visibleList","ImmediateBatches","tempPoints","Immediate","depthTest","batches","fragment","graphNode","layerMeshInstances","numSegments","sin0","cos0","sin1","cos1","batchLayer","Scene","prev","isIdentity","settings","_render$skyboxIntensi","_render$skyboxLuminan","_render$skyboxMip","_render$clusteredLigh","physics","setting","_this$sky","Skin","ibp","boneNames","spriteNormals","spriteIndices","Sprite","createMeshFunc","frame","texWidth","texHeight","hp","lu","bv","ru","tv","frames","frameKey","TextureAtlas","Key","Node","Animation","InterpolatedKey","Skeleton","addInterpolatedKeys","interpKey","numNodes","nodeName","foundKey","currKeyIndex","k1","k2","skel1","skel2","key1","key2","dstKey","ProgramLibrary","standardMaterial","generator","def","_options$litOptions","_options$litOptions2","_def$name","lcopy","userMaterialId","generationKeyString","generationKey","processingKeyString","processingKey","totalKey","processedShader","generatedShaderDef","passName","opt","defaultMat","text","cachedShader","cache","bakeDirLmEndPS","bakeLmEndPS","dilatePS","bilateralDeNoisePS","shaderChunksLightmapper","FILLMODE_FILL_WINDOW","FILLMODE_KEEP_ASPECT","RESOLUTION_AUTO","RESOLUTION_FIXED","currentApplication","getApplication","setApplication","app","ScriptTypes","Type","isLegacy","_legacy","_createdLoadingScreen","script","ScriptType","FrameGraph","passes","beforePasses","afterPasses","renderTargetMap","prevPass","lastCubeTexture","lastCubeRenderPass","thisTexture","AreaLightCacheEntry","texture0","texture1","_this$texture","_this$texture2","AreaLightLuts","postfix","texture2","ltcMat1","ltcMat2","buildTexture","offsetScale","ret","convertToHalfFloat","convertToUint","srcData1","srcData2","data1","data2","o1","o2","DEFAULT_LOCALE","DEFAULT_LOCALE_FALLBACKS","PLURALS","definePluralFn","locales","getLang","locale","replaceLang","desiredLang","findAvailableLocale","desiredLocale","availableLocales","fallback","lang","mod10","mod100","DEFAULT_PLURAL_FN","getPluralFn","ABSOLUTE_URL","AssetFile","filename","contents","assetIdCounter","VARIANT_SUPPORT","VARIANT_DEFAULT_PRIORITY","Asset","file","_this$registry","bundles","_b$file","oldFile","newFile","_old","separator","relativePath","assetId","maxRetries","_asset$file","TagsCache","tag","items","tagsRest","missingIndex","sort","AssetRegistry","loader","filters","assets","_asset$file2","_asset$file3","_asset$file4","_opened","_loaded","extra","startLoad","loadedAsset","modelAsset","continuation","basename","mappingUrl","onMaterialLoaded","materialAsset","onTextureLoaded","texParams","nameOld","BundleRegistry","bundleAssetId","bundleAsset","urls","numFiles","decodedUrl","requests","bundle","ComponentSystemRegistry","system","Bundle","files","Untar","UntarScope","isWorker","utfDecoder","asciiDecoder","PaxHeader","fields","paxArray","bytesRead","spaceIndex","fieldLength","field","fieldName","fieldValue","UntarInternal","arrayBuffer","headersDataView","headers","ustarFormat","normalFile","blob","remainder","namePrefix","filenamePrefix","workerUrl","getWorkerUrl","UntarWorker","BundleHandler","ResourceLoader","handleLoad","urlObj","normalizedUrl","fileUrlFromBundle","onLoad","I18nParser","entry","I18n","_i","idNum","translations","pluralFn","parsed","messages","ScriptRegistry","scriptName","components","scriptInstances","scriptInstancesInitialized","component","scriptInstance","nameOrType","scriptType","_enableList","Entity","enableFirst","duplicatedIdsMap","resolveDuplicatedEntityReferenceProperties","oldChild","newChild","oldSubtreeRoot","oldEntity","newEntity","componentName","entityProperties","propertyName","oldEntityReferenceId","newEntityReferenceId","_new","SceneRegistryItem","SceneRegistry","sceneItem","storeInCache","onBeforeAddHierarchy","ApplicationStats","_getApplication$light","batcher","Progress","AppBase","appOptions","defaultLayerComposition","resourceHandler","componentSystem","makeTick","scenes","progress","_done","onAssetLoad","onAssetError","sceneData","scripts","scriptUrl","composition","sublayer","grp","scriptsIndex","bundlesIndex","priorityScripts","_scripts","_index","entities","dt","ms","prims","windowWidth","windowHeight","winR","gravity","onSkyboxRemoved","onSkyboxChanged","_this$lightmapper","_this$batcher","minPoint","maxPoint","_this$lightmapper2","_this$_soundManager","canvasId","scriptHandler","_frameEndData","_app","application","_application$xr","currentTime","shouldRenderFrame","_application$xr2","AppOptions","BakeLight","shadowMapCache","_tempPoint","BakeLightSimple","numVirtualLights","directionalSpreadAngle","gamma","linearIntensity","BakeLightAmbient","lightEntity","fullIntensity","BakeMeshNode","DENOISE_FILTER_SIZE","LightmapFilters","textureWidth","textureHeight","filterRange","filterSmoothness","normpdf","kernel","kSize","bZnorm","MAX_LIGHTMAP_SIZE","PASS_COLOR","PASS_DIR","tempVec","Lightmapper","_this$camera","srcParams","bakeNodes","destroyRT","bakeLmEndChunk","allNodes","_node$model","_node$model2","_node$render","notInstancedMeshInstances","meshes","sizeMult","srcArea","lightmapSizeMultiplier","areaMult","bounds","totalArea","startTime","startShaders","startFboTime","startCompileTime","nowTime","bakeNode","allLights","bakeLights","sceneLights","bakeLight","casterBounds","lightAffectsNode","frustumSize","nodeVisible","lightArray","shadowMapRendered","castShadow","dilateShader","filterLightmap","nodeRT","lightmap","tempRT","tempTex","rcv","shadersUpdatedOn1stPass","isAmbientLight","isDirectional","virtualLightIndex","clusterLights","lightmapSize","passMaterial","Component","schema","descriptor","record","ComponentSystem","componentData","convertValue","matchingProperties","INTERPOLATION_STEP","INTERPOLATION_LINEAR","INTERPOLATION_CUBIC","AnimCache","input","interpolation","idx0","idx1","hermite","AnimSnapshot","animTrack","curves","outputs","AnimClip","track","speed","playing","eventHandler","signChanged","blendWeight","blendOrder","frameEndTime","eventFrame","frameStartTime","initialCursor","deltaTime","ANIM_INTERRUPTION_NONE","ANIM_INTERRUPTION_PREV","ANIM_INTERRUPTION_NEXT","ANIM_INTERRUPTION_PREV_NEXT","ANIM_INTERRUPTION_NEXT_PREV","ANIM_GREATER_THAN","ANIM_LESS_THAN","ANIM_GREATER_THAN_EQUAL_TO","ANIM_LESS_THAN_EQUAL_TO","ANIM_EQUAL_TO","ANIM_NOT_EQUAL_TO","ANIM_PARAMETER_INTEGER","ANIM_PARAMETER_FLOAT","ANIM_PARAMETER_BOOLEAN","ANIM_PARAMETER_TRIGGER","ANIM_BLEND_1D","ANIM_BLEND_2D_DIRECTIONAL","ANIM_BLEND_2D_CARTESIAN","ANIM_BLEND_DIRECT","ANIM_STATE_START","ANIM_STATE_END","ANIM_STATE_ANY","ANIM_CONTROL_STATES","ANIM_LAYER_OVERWRITE","ANIM_LAYER_ADDITIVE","AnimBlend","additive","it","lessFunc","AnimTargetValue","aV1","aV2","aV","AnimEvaluator","binder","clip","snapshot","inputs","paths","resolved","clips","outputAnimation","animTarget","AnimEvents","AnimTrack","animEvents","AnimBinder","pathSegments","character","escape","curr","entityPath","propertyPath","AnimTarget","targetPath","DefaultAnimBinder","checkMaskValue","maskItem","flatten","findMeshInstances","weightName","setters","callSetters","textureName","textureAsset","rootNodeNames","currEntityPath","valueCount","componentType","encodedPath","activeNodes","AnimationComponent","animName","assetIds","blendTime","prevAnim","currAnim","animEvaluator","model","modelComponent","animationNames","animations","hasJson","hasGlb","animation","onAssetReady","onAssetAdd","attribute","restarted","registry","skeleton","AnimationComponentData","_schema","AnimationComponentSystem","property","clonedAnimations","clonedAnimationsIndex","animationsIndex","AnimNode","totalWeight","weightedSpeed","AnimBlendTree","syncAnimations","createTree","findParameter","paramsEqual","updatedParameter","AnimBlendTree1D","weightedDurationSum","child2Distance","parameterDistance","AnimBlendTreeCartesian2D","pointKey","weightSum","pi","minj","pipj","AnimBlendTreeDirectional2D","pLength","piLength","pjLength","weightedChildDuration","AnimBlendTreeDirect","AnimState","controller","blendTree","currNode","pathString","indexOfAnimation","trackClipName","trackClip","AnimTransition","priority","conditions","exitTime","transitionOffset","interruptionSource","AnimController","states","transitions","activate","consumeTrigger","transition","stateName","playable","maxDuration","activeClip","sourceStateName","destinationStateName","condition","progressBefore","startTransition","interpolatedTime","activeState","hasTransitionOffset","timeInState","timeInStateBefore","offsetTime","newStateName","stateWeight","activeClips","totalClips","v4","AnimComponentBinder","animComponent","layerName","layerIndex","propertyComponent","entityHierarchy","currEntity","resolveLeaf","steps","packFunc","setterFuncName","baseValues","objKey","propertyHierarchy","materialPropertyName","setter","animDataType","animDataComponents","AnimComponentLayer","normalizedWeight","layerPlaying","nodePath","AnimStateGraph","layerId","dataLayer","dataLayerTransition","conditionKeys","paramId","AnimComponent","_id","_asset","prevAnimationAssets","prevMasks","animBinder","stateGraph","paramKeys","paramKey","containsBlendTree","stateKey","animationAsset","targetKey","_this$addLayer","singleFrame","trigger","oldAnim","AnimComponentData","AnimComponentSystem","complexProperties","maskData","maskKey","masks","pathArr","clonePath","AudioListenerComponent","AudioListenerComponentData","AudioListenerComponentSystem","AudioSourceComponent","newAssets","paused","suspended","currentSource","_error","AudioSourceComponentData","AudioSourceComponentSystem","EntityReference","parentComponent","entityPropertyName","eventConfig","externalEventConfig","internalEventConfig","externalEventListenerConfigs","internalEventListenerConfigs","listenerDescription","listenerDescriptionParts","sourceName","onOrOff","allComponentSystems","nextEntityGuid","nextEntity","listenerMap","isDestroying","isAdding","BUTTON_TRANSITION_MODE_TINT","BUTTON_TRANSITION_MODE_SPRITE_CHANGE","ELEMENTTYPE_GROUP","ELEMENTTYPE_IMAGE","ELEMENTTYPE_TEXT","FITMODE_STRETCH","FITMODE_CONTAIN","FITMODE_COVER","VisualState","STATES_TO_TINT_NAMES","STATES_TO_SPRITE_ASSET_NAMES","STATES_TO_SPRITE_FRAME_NAMES","ButtonComponent","opacity","spriteAsset","spriteFrame","force","oldVisualState","newVisualState","tintName","tintColor","spriteAssetName","spriteFrameName","transitionMode","color3","toColor3","elapsedTime","elapsedProportion","lerpColor","color4","ButtonComponentData","ButtonComponentSystem","_vec3","_quat","CollisionComponent","compound","shapes","ancestor","dirty","bodyComponent","lo","CollisionComponentData","BODYTYPE_STATIC","BODYTYPE_DYNAMIC","BODYTYPE_KINEMATIC","BODYFLAG_KINEMATIC_OBJECT","BODYFLAG_NORESPONSE_OBJECT","BODYSTATE_ACTIVE_TAG","BODYSTATE_DISABLE_DEACTIVATION","BODYSTATE_DISABLE_SIMULATION","BODYGROUP_DYNAMIC","BODYGROUP_STATIC","BODYGROUP_KINEMATIC","BODYGROUP_TRIGGER","BODYMASK_ALL","BODYMASK_NOT_STATIC","_ammoVec1","_ammoQuat","_ammoTransform","Trigger","mass","bodyPos","bodyRot","body","systems","mat4","quat","tempGraphNode","CollisionSystemImpl","firstCompoundChild","CollisionBoxSystemImpl","ammoHe","CollisionSphereSystemImpl","CollisionCapsuleSystemImpl","_data$axis","_data$radius","_data$height","CollisionCylinderSystemImpl","_data$axis2","_data$radius2","_data$height2","CollisionConeSystemImpl","_data$axis3","_data$radius3","_data$height3","CollisionMeshSystemImpl","triMesh","numTriangles","useQuantizedAabbCompression","triMeshShape","scaling","previousPropertyValue","onAssetFullyReady","loadAndHandleAsset","containerAsset","worldScale","previousScale","numShapes","CollisionCompoundSystemImpl","CollisionComponentSystem","_data","collision","previousType","newType","relative","ammoQuat","ao","newOrigin","_vertexFormatDeviceCache","ImageRenderable","getLastChild","last","lastChild","visibleFn","screenSpace","ImageElement","screen","previous","nineSliced","nineTiled","vertexData","actualRatio","frameData","borderWidthScale","borderHeightScale","ppu","scaleMulX","scaleMulY","scaleX","scaleY","vertexDataF32","atlasTextureWidth","atlasTextureHeight","nineSlice","atlasAssetId","sprite","atlasAsset","stencilParams","sp","newAspectRatio","_prev","LocalizedAsset","localizedAssetId","FONT_MSDF","FONT_BITMAP","EOF_TOKEN","ERROR_TOKEN","TEXT_TOKEN","OPEN_BRACKET_TOKEN","CLOSE_BRACKET_TOKEN","EQUALS_TOKEN","STRING_TOKEN","IDENTIFIER_TOKEN","WHITESPACE_TOKEN","WHITESPACE_CHARS","IDENTIFIER_REGEX","Scanner","symbols","token","tokenStrings","Parser","merge","combineTags","resolveMarkupTags","numSymbols","edges","tagStack","removeTags","addTags","edgeKeys","resolvedTags","edge","prevTag","resolvedTag","evaluateMarkup","parser","stripped_symbols","invalidTag","resolved_tags","Markup","MeshInfo","createTextMesh","meshInfo","LINE_BREAK_CHAR","WHITESPACE_CHAR","WORD_BOUNDARY_CHAR","ALPHANUMERIC_CHAR","CJK_CHAR","NO_LINE_BREAK_CJK_CHAR","CONTROL_CHARS","CONTROL_GLYPH_DATA","colorTmp","vec2Tmp","TextElement","pivot","unicodeConverterFunc","rtlReorderFunc","getColorThicknessHash","thickness","getColorOffsetHash","paletteMap","outlinePaletteMap","shadowPaletteMap","outline","_color","outlineHash","shadow","_color2","offX","offY","shadowHash","charactersPerTexture","removedModel","screenCulled","msdf","nextchar","json","minFont","maxFont","autoFit","MAGIC","_x","_y","_z","_xMinusTrailingWhitespace","wordStartX","wordStartIndex","lineStartIndex","numWordsThisLine","numCharsThisLine","numBreaksThisLine","splitHorizontalAnchors","maxLineWidth","fontMinY","fontMaxY","breakLine","lineBreakIndex","lineBreakX","sliceStart","sliceEnd","retryUpdateMeshes","color_r","color_g","color_b","outline_color_rg","outline_color_ba","outline_thickness","shadow_color_rg","shadow_color_ba","shadow_offset_xy","advance","quadsize","dataScale","kerning","kernTable","kernLeft","isWhitespace","meshInfoId","candidateLineWidth","backtrack","backtrackStart","backtrackEnd","backChar","backCharData","backMeshInfo","fontSize","colorIdx","outlineIdx","shadowIdx","ha","va","prevQuad","hoffset","voffset","_quad","_quad2","tmp0","tmp1","vertMax","maps","font","space","symbolIndex","startChars","endChars","previousFontType","charId","newFontSize","initialized","rangeStart","rangeEnd","vecA","vecB","matA","matB","matC","matD","ElementComponent","_this$system$app$batc","_this$system$app$batc2","wt","wb","screenCorners","wr","wl","margin","prevX","prevY","mx","my","parentBottomLeft","localPos","pvt","resx","resy","px","py","parentWorldTransform","depthOffset","pivotOffset","next","previousScreen","renderableElement","currentMask","_children$i$element","_children$i$element2","oldComp","newComp","_this$system$app$batc3","_this$system$app$batc4","propagateCalculatedWidth","propagateCalculatedHeight","newWidth","newHeight","updateMargins","mo","clipL","clipR","clipT","clipB","sw","sh","cameraWidth","cameraHeight","hitCorners","_this$system$app$batc5","_define","ElementComponentData","ElementComponentSystem","splitHorAnchors","splitVerAnchors","_marginChange","shouldForceSetAnchor","textAttibutes","nineSliceTiled","MOTION_FREE","MOTION_LIMITED","MOTION_LOCKED","JointComponent","enableCollision","limits","pcTransform","ammoTransform","ammoVec","constraint","bodyA","jointWtm","invEntityAWtm","frameA","bodyB","invEntityBWtm","frameB","functionMap","propInternal","JointComponentData","JointComponentSystem","LayoutChildComponent","LayoutChildComponentData","LayoutChildComponentSystem","layoutChild","FITTING_NONE","FITTING_STRETCH","FITTING_SHRINK","FITTING_BOTH","AXIS_MAPPINGS","OPPOSITE_ORIENTATION","PROPERTY_DEFAULTS","FITTING_ACTION","availableSpace","createCalculator","minExtentA","minExtentB","maxExtentA","calculateAll","allElements","layoutOptions","shouldIncludeInLayout","resetAnchors","reverseLinesIfRequired","splitLines","sizes","calculateSizesOnAxisB","calculateSizesOnAxisA","calculateBasePositions","applyAlignmentAndPadding","applySizesAndPositions","createLayoutInfo","layoutChildComponent","anchor","getElementSizeProperties","runningSize","allowOverrun","idealElementSize","reverseAxisA","reverseAxisB","lineIndex","sizesAllLines","sizesThisLine","idealRequiredSpace","calculateTotalSpace","fittingAction","determineFittingAction","stretchSizesToFitContainer","shrinkSizesToFitContainer","largestElementsForEachLine","largestSizesForEachLine","elementIndex","sizesThisElement","sizesForThisElement","currentSize","availableSize","elementFittingAction","fittingMode","totalSizes","sumValues","totalSpacing","ascendingMaxSizeOrder","getTraversalOrder","fittingProportions","getNormalizedValues","fittingProportionSums","createSumArray","remainingUndershoot","targetIncrease","calculateAdjustment","targetSize","maxSize","actualSize","actualIncrease","appliedIncrease","descendingMinSizeOrder","inverseFittingProportions","invertNormalizedValues","inverseFittingProportionSums","remainingOvershoot","targetReduction","minSize","actualReduction","appliedReduction","remainingAdjustment","proportion","sumOfRemainingProportions","cursor","positionsAllLines","positionsThisLine","alignmentA","alignmentB","paddingA","paddingB","axisAOffset","axisBOffset","withinLineAxisBOffset","layoutWidth","layoutHeight","xOffset","yOffset","sizeProperties","minWidth","getProperty","minHeight","maxWidth","maxHeight","clamp","fitWidthProportion","fitHeightProportion","accumulator","normalizedValues","numItems","invertedValues","numValues","orderBy","descending","assignIndex","itemA","itemB","getIndex","sumArray","CALCULATE_FNS","LayoutCalculator","calculateFn","getElement","isEnabledAndHasEnabledElement","LayoutGroupComponent","onOff","container","containerWidth","containerHeight","layoutInfo","LayoutGroupComponentData","MAX_ITERATIONS","LayoutGroupComponentSystem","layoutGroup","iterationCount","queue","componentA","componentB","ModelComponent","assetMapping","idOrPath","isAsset","_app$batcher","_app$batcher2","ModelComponentData","ModelComponentSystem","meshInstancesClone","SIMPLE_PROPERTIES","COMPLEX_PROPERTIES","GRAPH_PROPERTIES","ASSET_PROPERTIES","depthLayer","ParticleSystemComponent","ParticleSystemComponentData","ParticleSystemComponentSystem","types","sourceProp","numSteps","SkinInstanceCachedObject","skinInstance","SkinInstanceCache","skinInst","cachedObjArray","cachedObj","cachedObjIndex","AssetReference","RenderComponent","oldRender","RenderComponentData","_properties","RenderComponentSystem","srcMeshInstances","ObjectPool","_ammoVec2","_quat1","_quat2","RigidBodyComponent","damping","friction","restitution","linearFactor","angularFactor","pz","motionState","invertedAo","entityRot","RigidBodyComponentData","ammoRayStart","ammoRayEnd","RaycastResult","hitFraction","SingleContactResult","contactPoint","ContactPoint","localPoint","localPointOther","pointOther","impulse","ContactResult","contacts","RigidBodyComponentSystem","checkForCollisionsPointer","rigidbody","localInertia","bodyInfo","rayCallback","collisionObj","collisionObjs","hitFractions","numHits","isNewCollision","localPointA","localPointB","positionWorldOnA","positionWorldOnB","normalWorldOnB","contact","frameCollision","entityCollision","entityRigidbody","others","world","timeStep","dispatcher","numManifolds","manifold","body0","body1","wb0","wb1","e0","e1","flags0","flags1","numContacts","forwardContacts","reverseContacts","newCollision","e0Events","e1Events","e0BodyEvents","e1BodyEvents","globalEvents","btContactPoint","reverseContactPoint","forwardResult","reverseResult","triggers","compounds","kinematic","SCALEMODE_NONE","SCALEMODE_BLEND","_transform","ScreenComponent","prevDrawOrder","referenceResolution","ScreenComponentData","ScreenComponentSystem","ScriptLegacyComponent","functionName","onlyUpdateAttributes","cached","_url","_unprefixed","ScriptLegacyComponentData","INITIALIZE","POST_INITIALIZE","UPDATE","POST_UPDATE","FIXED_UPDATE","TOOLS_UPDATE","ON_ENABLE","ON_DISABLE","ScriptLegacyComponentSystem","dict","updateList","dataStore","instanceName","preRegistered","scriptComponent","previousAttributes","oldAttribute","curveType","_inputScreenPosition","_inputWorldPosition","_ray","_plane","_normal","_entityRotation","OPPOSITE_AXIS","ElementDragHelper","isOn","currentMousePosition","devicePixelRatio","isWithin2DScreen","screenScale","dragScale","deltaMousePosition","deltaHandlePosition","currentPosition","constrainedAxis","SCROLL_MODE_CLAMP","SCROLL_MODE_BOUNCE","SCROLL_MODE_INFINITE","SCROLLBAR_VISIBILITY_SHOW_ALWAYS","SCROLLBAR_VISIBILITY_SHOW_WHEN_REQUIRED","_tempScrollValue","ScrollViewComponent","scrollValueX","scrollValueY","resetVelocity","xChanged","yChanged","scrollValue","hasChanged","sign","contentEntity","prevContentSize","currContentSize","prevMaxOffset","currMaxOffset","contentPosition","scrollbarEntity","isScrollingEnabled","requestedVisibility","maxOffsetH","maxOffsetV","contentSize","viewportSize","handleSize","overshoot","entityReference","maxScrollValue","overshootPixels","wheelEvent","normalizedDeltaX","normalizedDeltaY","scrollX","scrollY","_disableInput","ScrollViewComponentData","DEFAULT_DRAG_THRESHOLD","ScrollViewComponentSystem","ScrollbarComponent","handleEntity","handleElement","handlePosition","ScrollbarComponentData","ScrollbarComponentSystem","instanceOptions","SoundSlot","playWhenLoaded","resumed","stopped","oldAsset","assetDuration","SoundComponent","isFactor","oldLength","playingBeforeDisable","SoundComponentData","SoundComponentSystem","srcComponent","srcSlots","srcSlot","cloneData","store","SPRITETYPE_SIMPLE","SPRITETYPE_ANIMATED","SpriteAnimationClip","fps","PARAM_EMISSIVE_MAP","PARAM_OPACITY_MAP","PARAM_EMISSIVE","PARAM_OPACITY","PARAM_INNER_OFFSET","PARAM_OUTER_SCALE","PARAM_ATLAS_RECT","SpriteComponent","_this$_node","posX","posY","SpriteComponentData","SpriteComponentSystem","_data$opacity","_data$opacity2","ZoneComponent","ZoneComponentData","ZoneComponentSystem","PostEffect","effect","inputTarget","PostEffectQueue","_renderTarget$width","_renderTarget$height","useDepth","hdr","effects","isFirstEffect","newEntry","fx","destTarget","_renderTarget$width2","_renderTarget$height2","_renderTarget$width3","_renderTarget$height3","desiredWidth","desiredHeight","CameraComponent","_this$_camera$shaderP","layerComp","screenx","screeny","cameraz","spaceType","CameraComponentData","CameraComponentSystem","_lightProps","_lightPropsDefault","LightComponent","forceLoad","_defineProperty","setFunc","skipEqualsCheck","_defineProps","LightComponentData","_propsDefault","LightComponentSystem","vecLookup","rawToValue","vecType","CurveType","ScriptAttributes","raw","evtName","oldCopy","SCRIPT_INITIALIZE","SCRIPT_POST_INITIALIZE","SCRIPT_UPDATE","SCRIPT_POST_UPDATE","SCRIPT_SWAP","ScriptComponent","wasLooping","looping","wasLoopingBefore","scriptsLength","attributeName","useGuid","newAttributes","newGuidArray","scriptData","scriptInstanceOld","oldScriptComponent","newScriptComponent","newAttributesRaw","oldAttributes","newJsonValue","indOld","ScriptComponentData","METHOD_INITIALIZE_ATTRIBUTES","METHOD_INITIALIZE","METHOD_POST_INITIALIZE","METHOD_UPDATE","METHOD_POST_UPDATE","executionOrderCounter","ScriptComponentSystem","Render","onContainerAssetLoaded","renderAsset","containerResource","onContainerAssetAdded","onContainerAssetRemoved","RenderHandler","AnimCurve","AnimData","DracoWorker","jsUrl","wasmUrl","draco","wrap","typedArray","componentSizeInBytes","attributeSizeInBytes","attributeOrder","generateNormals","subtract","srcOffset","v0","decodeMesh","inputBuffer","decoder","status","shortIndices","indicesSize","indicesPtr","_attributeOrder$a$att","_attributeOrder$b$att","totalVertexSize","hasNormals","normalOffset","sizeInBytes","ptrSize","ptr","decode","workQueue","imports","successCallback","reason","downloadMaxRetries","JobQueue","worker","job","index2","index1","downloadScript","compileModule","compileManual","compileStreaming","defaultNumWorkers","jobQueue","initializeWorkers","moduleConfig","dracoSource","dracoModule","numWorkers","dracoDecode","GlbResources","isDataURI","getDataURIMimeType","getNumComponents","accessorType","getComponentType","getComponentSizeInBytes","getComponentDataType","gltfToEngineSemanticMap","getDequantizeFunc","srcType","dequantizeArray","dstArray","srcArray","convFunc","getAccessorData","gltfAccessor","bufferViews","sparse","indicesAccessor","valuesAccessor","baseAccessor","targetIndex","bufferView","bytesPerElement","tmpArray","dstOffset","getAccessorDataFloat32","float32Data","getAccessorBoundingBox","ctype","getPrimitiveType","generateIndices","dummyIndices","sourceDesc","srcStride","normalsTemp","flipTexCoordVs","floatOffsets","shortOffsets","byteOffsets","flip","cloneTexture","shallowCopyLevels","mip","cloneTextureAsset","createVertexBufferInternal","flipV","positionDesc","sourceOffset","isCorrectlyInterleaved","targetArray","sourceArray","targetStride","sourceStride","kend","createVertexBuffer","vertexBufferDict","useAttributes","attribIds","vbKey","accessorData","createSkin","gltfSkin","glbSkins","bindMatrix","joints","numJoints","inverseBindMatrices","ibmData","ibmValues","createDracoMesh","meshVariants","meshDefaultMaterials","_primitive$extensions","_accessor$normalized","dracoExt","decompressedData","_primitive$attributes","indexFormat","variants","tempMapping","gltfMesh","assetOptions","_primitive$extensions2","extractTextureTransform","_source$extensions","texCoord","zeros","ones","textureTransform","tilingVec","offsetVec","extensionPbrSpecGlossiness","diffuseTexture","specularGlossinessTexture","extensionClearCoat","clearcoatTexture","clearcoatRoughnessTexture","clearcoatNormalTexture","extensionUnlit","extensionSpecular","extensionIor","extensionTransmission","extensionSheen","extensionVolume","extensionEmissiveStrength","extensionIridescence","createMaterial","gltfMaterial","pbrData","baseColorTexture","metallicRoughnessTexture","normalTexture","occlusionTexture","emissiveTexture","extensions","extensionFunc","createAnimation","gltfAnimation","animationIndex","gltfAccessors","gltfNodes","createAnimData","interpMap","inputMap","outputMap","curveMap","outputCounter","quatArrays","transformSchema","constructNodePath","createMorphTargetCurves","gltfNode","targetNames","outData","morphTargetCount","keyframeCount","singleBufferSize","_targetNames","morphTargetOutput","morphCurve","inputKey","outputKey","curveKey","curveData","prevIndex","tempMat","createNode","createCamera","gltfCamera","gltfProperties","cameraEntity","createLight","gltfLight","lightProps","createSkins","gltf","createMeshes","_gltf$meshes","_gltf$accessors","_gltf$bufferViews","createMaterials","_options$material","_options$material$pro","_options$material2","_options$material3","preprocess","process","postprocess","createVariants","createAnimations","_options$animation","_options$animation2","createNodes","_options$node","_options$node$process","_options$node2","_options$node3","uniqueNames","createScenes","_gltf$scenes$0$nodes","sceneRoot","childNode","createCameras","_options$camera","_options$camera$proce","_options$camera2","_options$camera3","createLights","gltfLights","_options$light","_options$light$proces","_options$light2","_options$light3","linkSkins","renders","skins","createResources","_options$global","_options$global2","bufferViewData","textureAssets","textureInstances","applySampler","gltfSampler","getFilter","getWrap","_gltfSampler","gltfTextureUniqueId","createImages","urlBase","_options$image","_options$image2","_options$image3","processAsync","mimeTypeFileExtensions","loadTexture","gltfImage","mimeType","createTextures","images","_gltf$images","_gltf$textures","_options$texture","_options$texture2","_options$texture3","seenImages","gltfTexture","gltfImageIndex","_ref2","_gltfImageIndex","_gltfTexture$extensio","_gltfTexture$extensio2","cloneAsset","imageAsset","_gltf$samplers","loadBuffers","binaryChunk","_options$buffer","_options$buffer2","_options$buffer3","gltfBuffer","byteString","binaryArray","parseGltf","gltfChunk","parseGlb","glbData","magic","chunkLength","chunkType","chunkData","parseChunk","hasGlbHeader","u8","createBufferViews","_options$bufferView","_options$bufferView2","_options$bufferView3","_gltf$bufferViews2","gltfBufferView","GlbParser","AnimationHandler","_asset$options","parseResult","_asset$data","animData","anim","defPos","defRot","defScl","AnimClipHandler","AnimStateGraphHandler","ie","msie","rv","supportedExtensions","AudioHandler","success","audio","onReady","BinaryHandler","GlbContainerResource","createAsset","subAsset","assetName","skinnedMeshInstances","createMeshInstance","materialIndex","cloneHierarchy","glb","attachedMi","meshGroup","cloneMi","childClone","sceneClones","renderComponent","sceneNodes","nodeType","skinInstances","skinIndex","destroyAsset","destroyAssets","GlbContainerParser","ContainerHandler","CssHandler","CubemapHandler","cubemapAsset","assetIdA","assetIdB","assetData","oldAssets","oldResources","resources","getType","faceAssets","_assetData$mipmaps","faceTextures","faceLevels","faceTexture","faces","arr1","arr2","valueInt","loadedAssetIds","loadedAssets","awaiting","onError","processTexAsset","texAsset","assetId_","FolderHandler","Font","upgradeDataSchema","newChars","existing","newKey","FontHandler","numLoaded","onLoaded","CompressUtils","compressed","Decompress","origKey","elt","SceneParser","isTemplate","curData","curEnt","childEnt","_data$enabled","label","systemsList","entityData","SceneUtils","errMsg","HierarchyHandler","HtmlHandler","JsonHandler","StandardMaterialValidator","TYPES","REMOVED","pathMapping","enumType","chunkNames","JsonStandardMaterialParser","migrated","validated","RENAMED_PROPERTIES","DEPRECATED_PROPERTIES","PLACEHOLDER_MAP","MaterialHandler","parameterName","placeholder","prefiltered","TEXTURES","assetReference","dataAssetId","materialTexture","isPlaceHolderTexture","dataValidated","CUBEMAPS","GlbModelParser","modelHandler","PartitionedVertex","SkinPartition","vertexArray","remappedIndex","influence","originalBoneIndex","vertexIndices","bonesToAdd","bonesToAddCount","needToAdd","boneRemap","indicesToReferences","referencesToIndices","partitionSkin","materialMappings","vertexArrays","getVertex","meshesToSplit","partition","partitions","primitiveVertices","primitiveIndices","basePartition","iIndex","added","iBonePartition","partitionedVertices","partitionedIndices","vertexStart","indexStart","indexCount","iSour","iDest","splitSkins","splitSkin","splitVertexArray","dstBoneIndices","srcBoneIndices","JSON_PRIMITIVE_TYPE","JSON_VERTEX_ELEMENT_TYPE","JsonModelParser","modelData","morphs","nodeData","skinData","ibm","morphIndex","morphInstances","morphTarget","morphTargetArray","sparseToFull","totalCount","full","deltaPositions","deltaNormals","attributeMap","maxVerts","meshAabb","meshInstanceData","ModelHandler","handleMaterial","decider","SceneHandler","ScriptHandler","head","ShaderHandler","onTextureAtlasLoaded","onTextureAtlasAdded","SpriteHandler","atlas","Template","TemplateHandler","TextHandler","JSON_ADDRESS_MODE","JSON_FILTER_MODE","regexFrame","TextureAtlasHandler","textureUrl","BasisWorker","BASIS_FORMAT","opaqueMapping","alphaMapping","PIXEL_FORMAT","basisToEngineMapping","basisFormat","deviceDetails","unswizzleGGGR","genB","R","G","pack565","isPOT","performanceNow","basis","rgbPriority","rgbaPriority","chooseTargetFormat","hasAlpha","isUASTC","dimensionsValid","webgl2","transcodeKTX2","funcStart","basisFile","unswizzle","levelData","dstSize","is16BitFormat","transcodeBasis","transcode","workerTranscode","workerInit","instantiateWasmFunc","getCompressionFormats","prepareWorkerModules","getWorkerBlob","basisCode","wasmSupported","sendResponse","fetchPromise","module_","BasisQueue","client","BasisClient","eager","transfer","defaultRgbPriority","defaultRgbaPriority","defaultMaxRetries","lazyConfig","initializing","basisInitialize","eagerWorkers","clientConfig","basisTranscode","BasisParser","ImgParser","hasContents","crossOrigin","originalUrl","retries","retryTimeout","imageBitmap","KNOWN_FORMATS","createContainer","byteOffset","byteSize","KtxParser","dataU32","isCubemap","mipmapLevel","imageSizeInBytes","KHRConstants","Ktx2Parser","colorModel","DdsParser","isFourCc","fcc","bpp","FCC_DXT1","FCC_DXT5","FCC_FP16","FCC_FP32","FCC_ETC1","FCC_PVRTC_2BPP_RGB_1","FCC_PVRTC_2BPP_RGBA_1","FCC_PVRTC_4BPP_RGB_1","FCC_PVRTC_4BPP_RGBA_1","etc1","pvrtc2","pvrtc4","componentSize","mipSize","DXT_BLOCK_WIDTH","DXT_BLOCK_HEIGHT","numBlocksAcross","numBlocksDown","numBlocks","mipWidth","mipHeight","mipBuff","HdrParser","readStream","variables","rgbe","scanstart","JSON_TEXTURE_TYPE","_completePartialMipmapChain","isHtmlElement","downsample","sampledWidth","sampledHeight","sampledData","xs","ys","xsys","TextureHandler","_asset$name","XRTYPE_INLINE","XRTYPE_VR","XRTYPE_AR","XRSPACE_VIEWER","XRHAND_LEFT","XRDEPTHSENSINGUSAGE_CPU","XRDEPTHSENSINGUSAGE_GPU","XRDEPTHSENSINGFORMAT_L8A8","XrDepthSensing","session","depthInfo","resized","dataBuffer","depthInfoCpu","depthInfoGpu","XrDomOverlay","poolVec3","poolQuat","XrHitTestSource","xrHitTestSource","transient","transientResults","transientResult","inputSource","_poolVec3$pop","_poolVec3$pop2","_poolQuat$pop","candidateDistance","candidateHitTestResult","pose","XrHitTest","fireError","xrRay","offsetRay","referenceSpace","hitTestSource","XrTrackedImage","bitmap","XrImageTracking","trackedImage","bitmaps","XrFinger","hand","tipJointIds","tipJointIdsIndex","XrJoint","finger","fingerJointIds","vecC","XrHand","xrHand","joint","jointId","xrInputSource","jointSpace","j1","j4","j6","j9","j16","j21","jointL","jointR","XrInputSource","gripPose","targetRayPose","parentTransform","XrInput","inputSources","vec3A","vec3B","mat4A","mat4B","XrLightEstimation","lightProbe","wasRequested","lightEstimate","pli","XrPlane","planeDetection","xrPlane","XrPlaneDetection","detectedPlanes","XrAnchor","anchors","xrAnchor","uuid","XrAnchors","_window","hitResult","request","XrManager","usagePreference","dataFormatPreference","trackedImages","failed","onVisibilityChange","onClipPlanesChange","onEnd","framebufferScaleFactor","lengthOld","lengthNew","posePosition","poseOrientation","viewRaw","aspectRatio","nearClip","horizontalFov","Application","pc.Application","pc.FILLMODE_FILL_WINDOW","pc.RESOLUTION_AUTO","pc.Entity","pc.Color"],"mappings":"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oB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECApBC,GAAwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAxBC,GAA0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECA1BC,GAA0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECA1BC,GAAmB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAnB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AAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECARC,GAAwB;AAAA;AAAA;AAAA;AAAA,ECAxBC,GAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAlBC,GAAgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAhBC,GAAmB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAnBC,GAAgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAhBC,GAAmB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAnBC,GAA0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECA1BC,GAAuB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAvBC,GAAuB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAvBC,GAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAfC,GAAmB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAnBC,GAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAlBC,GAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECARC,GAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAdC,GAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECATC,GAAsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAtBC,GAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECATC,GAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAXC,GAAoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECApBC,GAAoB;AAAA;AAAA;AAAA;AAAA;AAAA,ECApBC,GAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAdC,GAAkB;AAAA;AAAA;AAAA;AAAA;AAAA,ECAlBC,GAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAbC,GAAc;AAAA;AAAA;AAAA;AAAA,ECAdC,GAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAZC,GAAW;AAAA,ECAXC,GAAgB;AAAA;AAAA,ECAhBC,GAAsB;AAAA;AAAA,ECAtBC,GAAsB;AAAA;AAAA;AAAA,ECAtBC,GAAgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAhBC,GAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAdC,GAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAVC,GAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAfC,GAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAbC,GAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAbC,GAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAbC,GAA2B;AAAA;AAAA,ECA3BC,GAA0B;AAAA;AAAA,ECA1BC,GAAoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECApBC,GAAuB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAvBC,GAAuB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAvBC,GAAwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAxBC,GAAwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAxBC,GAAwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAxBC,GAAuB;AAAA;AAAA;AAAA,ECAvBC,GAAwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAxBC,GAA6B;AAAA;AAAA;AAAA;AAAA;AAAA,ECA7BC,GAA0B;AAAA;AAAA,ECA1BC,GAA2B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECA3BC,GAA0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECA1BC,GAAyB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAzBC,GAAuB;AAAA;AAAA;AAAA,ECAvBC,GAAsB;AAAA;AAAA;AAAA;AAAA,ECAtBC,GAA2B;AAAA;AAAA;AAAA,ECA3BC,GAAyB;AAAA;AAAA,ECAzBC,GAAiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAjBC,GAAqB;AAAA;AAAA;AAAA;AAAA,ECArBC,GAAwB;AAAA;AAAA;AAAA,ECAxBC,GAAiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAjBC,GAAiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAjBC,GAAyB;AAAA;AAAA;AAAA;AAAA;AAAA,ECAzBC,GAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAlBC,GAAqB;AAAA;AAAA;AAAA,ECArBC,GAAsB;AAAA;AAAA;AAAA;AAAA;AAAA,ECAtBC,GAAwB;AAAA;AAAA,ECAxBC,GAAkB;AAAA;AAAA;AAAA;AAAA;AAAA,ECAlBC,GAAoB;AAAA;AAAA,ECApBC,GAAuB;AAAA;AAAA;AAAA,ECAvBC,GAAwB;AAAA;AAAA,ECAxBC,GAAkB;AAAA;AAAA;AAAA;AAAA;AAAA,ECAlBC,GAAkB;AAAA;AAAA,ECAlBC,GAAqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECArBC,GAAiB;AAAA;AAAA;AAAA,ECAjBC,GAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAlBC,GAAY;AAAA;AAAA;AAAA;AAAA,ECAZC,GAAiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAjBC,GAAiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAjBC,GAAmB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAnBC,GAAoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECApBC,GAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAlBC,GAAqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECArBC,GAAwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAxBC,GAAoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECApBC,GAAmB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAnBC,GAAsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECGtBC,GAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAuBhBtH,EAAQ;AAAA,EACRK,EAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EC3BNkH,GAAgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAhBC,GAAmB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAnBC,GAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAfC,GAAgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAhBC,GAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAfC,GAAsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAtBC,GAAmB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAnBC,GAAsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAtBC,GAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAfC,GAAqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECArBC,GAAmB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAnBC,GAAiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAjBC,GAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAdC,GAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAZC,GAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAdC,GAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAdC,GAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAXC,GAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAbC,GAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAdC,GAAsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAtBC,GAAS;AAAA;AAAA;AAAA;AAAA;AAAA,ECATC,GAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAVC,GAAU;AAAA;AAAA;AAAA,ECAVC,GAAoB;AAAA;AAAA;AAAA,ECApBC,GAAyB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAzBC,GAAc;AAAA;AAAA;AAAA;AAAA;AAAA,ECAdC,GAAoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECApBC,GAAQ;AAAA;AAAA;AAAA;AAAA,ECARC,GAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAlBC,GAAY;AAAA;AAAA;AAAA;AAAA,ECAZC,GAAmB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAnBC,GAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAlBC,GAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAdC,GAAoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECApBC,GAAqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECArBC,GAAsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAtBC,GAAoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECApBC,GAAsB;AAAA;AAAA;AAAA;AAAA;AAAA,ECAtBC,GAAoB;AAAA;AAAA;AAAA;AAAA,ECApBC,GAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAdC,GAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAlBC,GAAiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434,435,436,437,438,439,440,441,442,443,444,445,446,447,448,449,450,451,452,453,454,455,456,457,458,459,460,461,462,463,464,465,466,467,468,469,470,471,472,473,474,475,476,477,478,479,480,481,482,483,484,485,486,487,488,489,490,491,492,493,494,495,496,497,498,499,500,501,502,503,504,505,506,507,508,509,510,511,512,513,514,515,516,517,518,519,520,521,522,523,524,525,526,527,528,529,530,531,532,533,534,535,536,537,538,539,540,541,542,543,544,545,546,547,548,549,550,551,552,553,554,555,556,557,558,559,560,561,562,563,564,565,566,567,568,569,570,571,572,573,574,575,576,577,578,579,580,581,582,583,584,585,586,587,588,589,590,591,592,593,594,595,596,597,598,599,600,601,602,603,604,605,606,607,608,609,610,611,612,613]}